var FH=Object.defineProperty;var BH=(e,t,n)=>t in e?FH(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var zn=(e,t,n)=>BH(e,typeof t!="symbol"?t+"":t,n);function UH(e,t){for(var n=0;n<t.length;n++){const o=t[n];if(typeof o!="string"&&!Array.isArray(o)){for(const u in o)if(u!=="default"&&!(u in e)){const d=Object.getOwnPropertyDescriptor(o,u);d&&Object.defineProperty(e,u,d.get?d:{enumerable:!0,get:()=>o[u]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function n(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(u){if(u.ep)return;u.ep=!0;const d=n(u);fetch(u.href,d)}})();function zh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var T2={exports:{}},kv={},E2={exports:{}},bi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KR;function VH(){if(KR)return bi;KR=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),g=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),P=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),D=Symbol.iterator;function F(et){return et===null||typeof et!="object"?null:(et=D&&et[D]||et["@@iterator"],typeof et=="function"?et:null)}var $={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Z=Object.assign,q={};function X(et,zt,Zn){this.props=et,this.context=zt,this.refs=q,this.updater=Zn||$}X.prototype.isReactComponent={},X.prototype.setState=function(et,zt){if(typeof et!="object"&&typeof et!="function"&&et!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,et,zt,"setState")},X.prototype.forceUpdate=function(et){this.updater.enqueueForceUpdate(this,et,"forceUpdate")};function re(){}re.prototype=X.prototype;function le(et,zt,Zn){this.props=et,this.context=zt,this.refs=q,this.updater=Zn||$}var ue=le.prototype=new re;ue.constructor=le,Z(ue,X.prototype),ue.isPureReactComponent=!0;var ye=Array.isArray,ge=Object.prototype.hasOwnProperty,we={current:null},Le={key:!0,ref:!0,__self:!0,__source:!0};function Ze(et,zt,Zn){var $n,fr={},kn=null,Bt=null;if(zt!=null)for($n in zt.ref!==void 0&&(Bt=zt.ref),zt.key!==void 0&&(kn=""+zt.key),zt)ge.call(zt,$n)&&!Le.hasOwnProperty($n)&&(fr[$n]=zt[$n]);var En=arguments.length-2;if(En===1)fr.children=Zn;else if(1<En){for(var Tt=Array(En),wn=0;wn<En;wn++)Tt[wn]=arguments[wn+2];fr.children=Tt}if(et&&et.defaultProps)for($n in En=et.defaultProps,En)fr[$n]===void 0&&(fr[$n]=En[$n]);return{$$typeof:e,type:et,key:kn,ref:Bt,props:fr,_owner:we.current}}function Ge(et,zt){return{$$typeof:e,type:et.type,key:zt,ref:et.ref,props:et.props,_owner:et._owner}}function gt(et){return typeof et=="object"&&et!==null&&et.$$typeof===e}function lt(et){var zt={"=":"=0",":":"=2"};return"$"+et.replace(/[=:]/g,function(Zn){return zt[Zn]})}var qe=/\/+/g;function en(et,zt){return typeof et=="object"&&et!==null&&et.key!=null?lt(""+et.key):zt.toString(36)}function Jt(et,zt,Zn,$n,fr){var kn=typeof et;(kn==="undefined"||kn==="boolean")&&(et=null);var Bt=!1;if(et===null)Bt=!0;else switch(kn){case"string":case"number":Bt=!0;break;case"object":switch(et.$$typeof){case e:case t:Bt=!0}}if(Bt)return Bt=et,fr=fr(Bt),et=$n===""?"."+en(Bt,0):$n,ye(fr)?(Zn="",et!=null&&(Zn=et.replace(qe,"$&/")+"/"),Jt(fr,zt,Zn,"",function(wn){return wn})):fr!=null&&(gt(fr)&&(fr=Ge(fr,Zn+(!fr.key||Bt&&Bt.key===fr.key?"":(""+fr.key).replace(qe,"$&/")+"/")+et)),zt.push(fr)),1;if(Bt=0,$n=$n===""?".":$n+":",ye(et))for(var En=0;En<et.length;En++){kn=et[En];var Tt=$n+en(kn,En);Bt+=Jt(kn,zt,Zn,Tt,fr)}else if(Tt=F(et),typeof Tt=="function")for(et=Tt.call(et),En=0;!(kn=et.next()).done;)kn=kn.value,Tt=$n+en(kn,En++),Bt+=Jt(kn,zt,Zn,Tt,fr);else if(kn==="object")throw zt=String(et),Error("Objects are not valid as a React child (found: "+(zt==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":zt)+"). If you meant to render a collection of children, use an array instead.");return Bt}function Nt(et,zt,Zn){if(et==null)return et;var $n=[],fr=0;return Jt(et,$n,"","",function(kn){return zt.call(Zn,kn,fr++)}),$n}function St(et){if(et._status===-1){var zt=et._result;zt=zt(),zt.then(function(Zn){(et._status===0||et._status===-1)&&(et._status=1,et._result=Zn)},function(Zn){(et._status===0||et._status===-1)&&(et._status=2,et._result=Zn)}),et._status===-1&&(et._status=0,et._result=zt)}if(et._status===1)return et._result.default;throw et._result}var an={current:null},Kt={transition:null},hn={ReactCurrentDispatcher:an,ReactCurrentBatchConfig:Kt,ReactCurrentOwner:we};function Xt(){throw Error("act(...) is not supported in production builds of React.")}return bi.Children={map:Nt,forEach:function(et,zt,Zn){Nt(et,function(){zt.apply(this,arguments)},Zn)},count:function(et){var zt=0;return Nt(et,function(){zt++}),zt},toArray:function(et){return Nt(et,function(zt){return zt})||[]},only:function(et){if(!gt(et))throw Error("React.Children.only expected to receive a single React element child.");return et}},bi.Component=X,bi.Fragment=n,bi.Profiler=u,bi.PureComponent=le,bi.StrictMode=o,bi.Suspense=E,bi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hn,bi.act=Xt,bi.cloneElement=function(et,zt,Zn){if(et==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+et+".");var $n=Z({},et.props),fr=et.key,kn=et.ref,Bt=et._owner;if(zt!=null){if(zt.ref!==void 0&&(kn=zt.ref,Bt=we.current),zt.key!==void 0&&(fr=""+zt.key),et.type&&et.type.defaultProps)var En=et.type.defaultProps;for(Tt in zt)ge.call(zt,Tt)&&!Le.hasOwnProperty(Tt)&&($n[Tt]=zt[Tt]===void 0&&En!==void 0?En[Tt]:zt[Tt])}var Tt=arguments.length-2;if(Tt===1)$n.children=Zn;else if(1<Tt){En=Array(Tt);for(var wn=0;wn<Tt;wn++)En[wn]=arguments[wn+2];$n.children=En}return{$$typeof:e,type:et.type,key:fr,ref:kn,props:$n,_owner:Bt}},bi.createContext=function(et){return et={$$typeof:g,_currentValue:et,_currentValue2:et,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},et.Provider={$$typeof:d,_context:et},et.Consumer=et},bi.createElement=Ze,bi.createFactory=function(et){var zt=Ze.bind(null,et);return zt.type=et,zt},bi.createRef=function(){return{current:null}},bi.forwardRef=function(et){return{$$typeof:i,render:et}},bi.isValidElement=gt,bi.lazy=function(et){return{$$typeof:I,_payload:{_status:-1,_result:et},_init:St}},bi.memo=function(et,zt){return{$$typeof:P,type:et,compare:zt===void 0?null:zt}},bi.startTransition=function(et){var zt=Kt.transition;Kt.transition={};try{et()}finally{Kt.transition=zt}},bi.unstable_act=Xt,bi.useCallback=function(et,zt){return an.current.useCallback(et,zt)},bi.useContext=function(et){return an.current.useContext(et)},bi.useDebugValue=function(){},bi.useDeferredValue=function(et){return an.current.useDeferredValue(et)},bi.useEffect=function(et,zt){return an.current.useEffect(et,zt)},bi.useId=function(){return an.current.useId()},bi.useImperativeHandle=function(et,zt,Zn){return an.current.useImperativeHandle(et,zt,Zn)},bi.useInsertionEffect=function(et,zt){return an.current.useInsertionEffect(et,zt)},bi.useLayoutEffect=function(et,zt){return an.current.useLayoutEffect(et,zt)},bi.useMemo=function(et,zt){return an.current.useMemo(et,zt)},bi.useReducer=function(et,zt,Zn){return an.current.useReducer(et,zt,Zn)},bi.useRef=function(et){return an.current.useRef(et)},bi.useState=function(et){return an.current.useState(et)},bi.useSyncExternalStore=function(et,zt,Zn){return an.current.useSyncExternalStore(et,zt,Zn)},bi.useTransition=function(){return an.current.useTransition()},bi.version="18.3.1",bi}var JR;function Ey(){return JR||(JR=1,E2.exports=VH()),E2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QR;function $H(){if(QR)return kv;QR=1;var e=Ey(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,u=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function g(i,E,P){var I,D={},F=null,$=null;P!==void 0&&(F=""+P),E.key!==void 0&&(F=""+E.key),E.ref!==void 0&&($=E.ref);for(I in E)o.call(E,I)&&!d.hasOwnProperty(I)&&(D[I]=E[I]);if(i&&i.defaultProps)for(I in E=i.defaultProps,E)D[I]===void 0&&(D[I]=E[I]);return{$$typeof:t,type:i,key:F,ref:$,props:D,_owner:u.current}}return kv.Fragment=n,kv.jsx=g,kv.jsxs=g,kv}var eO;function HH(){return eO||(eO=1,T2.exports=$H()),T2.exports}var b=HH(),te=Ey();const sw=zh(te),GH=UH({__proto__:null,default:sw},[te]);var eb={},A2={exports:{}},Kl={},C2={exports:{}},P2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tO;function WH(){return tO||(tO=1,(function(e){function t(Kt,hn){var Xt=Kt.length;Kt.push(hn);e:for(;0<Xt;){var et=Xt-1>>>1,zt=Kt[et];if(0<u(zt,hn))Kt[et]=hn,Kt[Xt]=zt,Xt=et;else break e}}function n(Kt){return Kt.length===0?null:Kt[0]}function o(Kt){if(Kt.length===0)return null;var hn=Kt[0],Xt=Kt.pop();if(Xt!==hn){Kt[0]=Xt;e:for(var et=0,zt=Kt.length,Zn=zt>>>1;et<Zn;){var $n=2*(et+1)-1,fr=Kt[$n],kn=$n+1,Bt=Kt[kn];if(0>u(fr,Xt))kn<zt&&0>u(Bt,fr)?(Kt[et]=Bt,Kt[kn]=Xt,et=kn):(Kt[et]=fr,Kt[$n]=Xt,et=$n);else if(kn<zt&&0>u(Bt,Xt))Kt[et]=Bt,Kt[kn]=Xt,et=kn;else break e}}return hn}function u(Kt,hn){var Xt=Kt.sortIndex-hn.sortIndex;return Xt!==0?Xt:Kt.id-hn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var g=Date,i=g.now();e.unstable_now=function(){return g.now()-i}}var E=[],P=[],I=1,D=null,F=3,$=!1,Z=!1,q=!1,X=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(Kt){for(var hn=n(P);hn!==null;){if(hn.callback===null)o(P);else if(hn.startTime<=Kt)o(P),hn.sortIndex=hn.expirationTime,t(E,hn);else break;hn=n(P)}}function ye(Kt){if(q=!1,ue(Kt),!Z)if(n(E)!==null)Z=!0,St(ge);else{var hn=n(P);hn!==null&&an(ye,hn.startTime-Kt)}}function ge(Kt,hn){Z=!1,q&&(q=!1,re(Ze),Ze=-1),$=!0;var Xt=F;try{for(ue(hn),D=n(E);D!==null&&(!(D.expirationTime>hn)||Kt&&!lt());){var et=D.callback;if(typeof et=="function"){D.callback=null,F=D.priorityLevel;var zt=et(D.expirationTime<=hn);hn=e.unstable_now(),typeof zt=="function"?D.callback=zt:D===n(E)&&o(E),ue(hn)}else o(E);D=n(E)}if(D!==null)var Zn=!0;else{var $n=n(P);$n!==null&&an(ye,$n.startTime-hn),Zn=!1}return Zn}finally{D=null,F=Xt,$=!1}}var we=!1,Le=null,Ze=-1,Ge=5,gt=-1;function lt(){return!(e.unstable_now()-gt<Ge)}function qe(){if(Le!==null){var Kt=e.unstable_now();gt=Kt;var hn=!0;try{hn=Le(!0,Kt)}finally{hn?en():(we=!1,Le=null)}}else we=!1}var en;if(typeof le=="function")en=function(){le(qe)};else if(typeof MessageChannel<"u"){var Jt=new MessageChannel,Nt=Jt.port2;Jt.port1.onmessage=qe,en=function(){Nt.postMessage(null)}}else en=function(){X(qe,0)};function St(Kt){Le=Kt,we||(we=!0,en())}function an(Kt,hn){Ze=X(function(){Kt(e.unstable_now())},hn)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Kt){Kt.callback=null},e.unstable_continueExecution=function(){Z||$||(Z=!0,St(ge))},e.unstable_forceFrameRate=function(Kt){0>Kt||125<Kt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ge=0<Kt?Math.floor(1e3/Kt):5},e.unstable_getCurrentPriorityLevel=function(){return F},e.unstable_getFirstCallbackNode=function(){return n(E)},e.unstable_next=function(Kt){switch(F){case 1:case 2:case 3:var hn=3;break;default:hn=F}var Xt=F;F=hn;try{return Kt()}finally{F=Xt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Kt,hn){switch(Kt){case 1:case 2:case 3:case 4:case 5:break;default:Kt=3}var Xt=F;F=Kt;try{return hn()}finally{F=Xt}},e.unstable_scheduleCallback=function(Kt,hn,Xt){var et=e.unstable_now();switch(typeof Xt=="object"&&Xt!==null?(Xt=Xt.delay,Xt=typeof Xt=="number"&&0<Xt?et+Xt:et):Xt=et,Kt){case 1:var zt=-1;break;case 2:zt=250;break;case 5:zt=1073741823;break;case 4:zt=1e4;break;default:zt=5e3}return zt=Xt+zt,Kt={id:I++,callback:hn,priorityLevel:Kt,startTime:Xt,expirationTime:zt,sortIndex:-1},Xt>et?(Kt.sortIndex=Xt,t(P,Kt),n(E)===null&&Kt===n(P)&&(q?(re(Ze),Ze=-1):q=!0,an(ye,Xt-et))):(Kt.sortIndex=zt,t(E,Kt),Z||$||(Z=!0,St(ge))),Kt},e.unstable_shouldYield=lt,e.unstable_wrapCallback=function(Kt){var hn=F;return function(){var Xt=F;F=hn;try{return Kt.apply(this,arguments)}finally{F=Xt}}}})(P2)),P2}var nO;function qH(){return nO||(nO=1,C2.exports=WH()),C2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rO;function ZH(){if(rO)return Kl;rO=1;var e=Ey(),t=qH();function n(v){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+v,R=1;R<arguments.length;R++)S+="&args[]="+encodeURIComponent(arguments[R]);return"Minified React error #"+v+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,u={};function d(v,S){g(v,S),g(v+"Capture",S)}function g(v,S){for(u[v]=S,v=0;v<S.length;v++)o.add(S[v])}var i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,P=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I={},D={};function F(v){return E.call(D,v)?!0:E.call(I,v)?!1:P.test(v)?D[v]=!0:(I[v]=!0,!1)}function $(v,S,R,U){if(R!==null&&R.type===0)return!1;switch(typeof S){case"function":case"symbol":return!0;case"boolean":return U?!1:R!==null?!R.acceptsBooleans:(v=v.toLowerCase().slice(0,5),v!=="data-"&&v!=="aria-");default:return!1}}function Z(v,S,R,U){if(S===null||typeof S>"u"||$(v,S,R,U))return!0;if(U)return!1;if(R!==null)switch(R.type){case 3:return!S;case 4:return S===!1;case 5:return isNaN(S);case 6:return isNaN(S)||1>S}return!1}function q(v,S,R,U,K,ae,Ee){this.acceptsBooleans=S===2||S===3||S===4,this.attributeName=U,this.attributeNamespace=K,this.mustUseProperty=R,this.propertyName=v,this.type=S,this.sanitizeURL=ae,this.removeEmptyString=Ee}var X={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(v){X[v]=new q(v,0,!1,v,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(v){var S=v[0];X[S]=new q(S,1,!1,v[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(v){X[v]=new q(v,2,!1,v.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(v){X[v]=new q(v,2,!1,v,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(v){X[v]=new q(v,3,!1,v.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(v){X[v]=new q(v,3,!0,v,null,!1,!1)}),["capture","download"].forEach(function(v){X[v]=new q(v,4,!1,v,null,!1,!1)}),["cols","rows","size","span"].forEach(function(v){X[v]=new q(v,6,!1,v,null,!1,!1)}),["rowSpan","start"].forEach(function(v){X[v]=new q(v,5,!1,v.toLowerCase(),null,!1,!1)});var re=/[\-:]([a-z])/g;function le(v){return v[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(v){var S=v.replace(re,le);X[S]=new q(S,1,!1,v,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(v){var S=v.replace(re,le);X[S]=new q(S,1,!1,v,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(v){var S=v.replace(re,le);X[S]=new q(S,1,!1,v,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(v){X[v]=new q(v,1,!1,v.toLowerCase(),null,!1,!1)}),X.xlinkHref=new q("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(v){X[v]=new q(v,1,!1,v.toLowerCase(),null,!0,!0)});function ue(v,S,R,U){var K=X.hasOwnProperty(S)?X[S]:null;(K!==null?K.type!==0:U||!(2<S.length)||S[0]!=="o"&&S[0]!=="O"||S[1]!=="n"&&S[1]!=="N")&&(Z(S,R,K,U)&&(R=null),U||K===null?F(S)&&(R===null?v.removeAttribute(S):v.setAttribute(S,""+R)):K.mustUseProperty?v[K.propertyName]=R===null?K.type===3?!1:"":R:(S=K.attributeName,U=K.attributeNamespace,R===null?v.removeAttribute(S):(K=K.type,R=K===3||K===4&&R===!0?"":""+R,U?v.setAttributeNS(U,S,R):v.setAttribute(S,R))))}var ye=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ge=Symbol.for("react.element"),we=Symbol.for("react.portal"),Le=Symbol.for("react.fragment"),Ze=Symbol.for("react.strict_mode"),Ge=Symbol.for("react.profiler"),gt=Symbol.for("react.provider"),lt=Symbol.for("react.context"),qe=Symbol.for("react.forward_ref"),en=Symbol.for("react.suspense"),Jt=Symbol.for("react.suspense_list"),Nt=Symbol.for("react.memo"),St=Symbol.for("react.lazy"),an=Symbol.for("react.offscreen"),Kt=Symbol.iterator;function hn(v){return v===null||typeof v!="object"?null:(v=Kt&&v[Kt]||v["@@iterator"],typeof v=="function"?v:null)}var Xt=Object.assign,et;function zt(v){if(et===void 0)try{throw Error()}catch(R){var S=R.stack.trim().match(/\n( *(at )?)/);et=S&&S[1]||""}return`
`+et+v}var Zn=!1;function $n(v,S){if(!v||Zn)return"";Zn=!0;var R=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch(Vt){var U=Vt}Reflect.construct(v,[],S)}else{try{S.call()}catch(Vt){U=Vt}v.call(S.prototype)}else{try{throw Error()}catch(Vt){U=Vt}v()}}catch(Vt){if(Vt&&U&&typeof Vt.stack=="string"){for(var K=Vt.stack.split(`
`),ae=U.stack.split(`
`),Ee=K.length-1,Je=ae.length-1;1<=Ee&&0<=Je&&K[Ee]!==ae[Je];)Je--;for(;1<=Ee&&0<=Je;Ee--,Je--)if(K[Ee]!==ae[Je]){if(Ee!==1||Je!==1)do if(Ee--,Je--,0>Je||K[Ee]!==ae[Je]){var ct=`
`+K[Ee].replace(" at new "," at ");return v.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",v.displayName)),ct}while(1<=Ee&&0<=Je);break}}}finally{Zn=!1,Error.prepareStackTrace=R}return(v=v?v.displayName||v.name:"")?zt(v):""}function fr(v){switch(v.tag){case 5:return zt(v.type);case 16:return zt("Lazy");case 13:return zt("Suspense");case 19:return zt("SuspenseList");case 0:case 2:case 15:return v=$n(v.type,!1),v;case 11:return v=$n(v.type.render,!1),v;case 1:return v=$n(v.type,!0),v;default:return""}}function kn(v){if(v==null)return null;if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v;switch(v){case Le:return"Fragment";case we:return"Portal";case Ge:return"Profiler";case Ze:return"StrictMode";case en:return"Suspense";case Jt:return"SuspenseList"}if(typeof v=="object")switch(v.$$typeof){case lt:return(v.displayName||"Context")+".Consumer";case gt:return(v._context.displayName||"Context")+".Provider";case qe:var S=v.render;return v=v.displayName,v||(v=S.displayName||S.name||"",v=v!==""?"ForwardRef("+v+")":"ForwardRef"),v;case Nt:return S=v.displayName||null,S!==null?S:kn(v.type)||"Memo";case St:S=v._payload,v=v._init;try{return kn(v(S))}catch{}}return null}function Bt(v){var S=v.type;switch(v.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return v=S.render,v=v.displayName||v.name||"",S.displayName||(v!==""?"ForwardRef("+v+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kn(S);case 8:return S===Ze?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function En(v){switch(typeof v){case"boolean":case"number":case"string":case"undefined":return v;case"object":return v;default:return""}}function Tt(v){var S=v.type;return(v=v.nodeName)&&v.toLowerCase()==="input"&&(S==="checkbox"||S==="radio")}function wn(v){var S=Tt(v)?"checked":"value",R=Object.getOwnPropertyDescriptor(v.constructor.prototype,S),U=""+v[S];if(!v.hasOwnProperty(S)&&typeof R<"u"&&typeof R.get=="function"&&typeof R.set=="function"){var K=R.get,ae=R.set;return Object.defineProperty(v,S,{configurable:!0,get:function(){return K.call(this)},set:function(Ee){U=""+Ee,ae.call(this,Ee)}}),Object.defineProperty(v,S,{enumerable:R.enumerable}),{getValue:function(){return U},setValue:function(Ee){U=""+Ee},stopTracking:function(){v._valueTracker=null,delete v[S]}}}}function mr(v){v._valueTracker||(v._valueTracker=wn(v))}function tn(v){if(!v)return!1;var S=v._valueTracker;if(!S)return!0;var R=S.getValue(),U="";return v&&(U=Tt(v)?v.checked?"true":"false":v.value),v=U,v!==R?(S.setValue(v),!0):!1}function Ii(v){if(v=v||(typeof document<"u"?document:void 0),typeof v>"u")return null;try{return v.activeElement||v.body}catch{return v.body}}function Hn(v,S){var R=S.checked;return Xt({},S,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:R??v._wrapperState.initialChecked})}function nr(v,S){var R=S.defaultValue==null?"":S.defaultValue,U=S.checked!=null?S.checked:S.defaultChecked;R=En(S.value!=null?S.value:R),v._wrapperState={initialChecked:U,initialValue:R,controlled:S.type==="checkbox"||S.type==="radio"?S.checked!=null:S.value!=null}}function Mi(v,S){S=S.checked,S!=null&&ue(v,"checked",S,!1)}function Sn(v,S){Mi(v,S);var R=En(S.value),U=S.type;if(R!=null)U==="number"?(R===0&&v.value===""||v.value!=R)&&(v.value=""+R):v.value!==""+R&&(v.value=""+R);else if(U==="submit"||U==="reset"){v.removeAttribute("value");return}S.hasOwnProperty("value")?Fi(v,S.type,R):S.hasOwnProperty("defaultValue")&&Fi(v,S.type,En(S.defaultValue)),S.checked==null&&S.defaultChecked!=null&&(v.defaultChecked=!!S.defaultChecked)}function si(v,S,R){if(S.hasOwnProperty("value")||S.hasOwnProperty("defaultValue")){var U=S.type;if(!(U!=="submit"&&U!=="reset"||S.value!==void 0&&S.value!==null))return;S=""+v._wrapperState.initialValue,R||S===v.value||(v.value=S),v.defaultValue=S}R=v.name,R!==""&&(v.name=""),v.defaultChecked=!!v._wrapperState.initialChecked,R!==""&&(v.name=R)}function Fi(v,S,R){(S!=="number"||Ii(v.ownerDocument)!==v)&&(R==null?v.defaultValue=""+v._wrapperState.initialValue:v.defaultValue!==""+R&&(v.defaultValue=""+R))}var js=Array.isArray;function us(v,S,R,U){if(v=v.options,S){S={};for(var K=0;K<R.length;K++)S["$"+R[K]]=!0;for(R=0;R<v.length;R++)K=S.hasOwnProperty("$"+v[R].value),v[R].selected!==K&&(v[R].selected=K),K&&U&&(v[R].defaultSelected=!0)}else{for(R=""+En(R),S=null,K=0;K<v.length;K++){if(v[K].value===R){v[K].selected=!0,U&&(v[K].defaultSelected=!0);return}S!==null||v[K].disabled||(S=v[K])}S!==null&&(S.selected=!0)}}function ha(v,S){if(S.dangerouslySetInnerHTML!=null)throw Error(n(91));return Xt({},S,{value:void 0,defaultValue:void 0,children:""+v._wrapperState.initialValue})}function ja(v,S){var R=S.value;if(R==null){if(R=S.children,S=S.defaultValue,R!=null){if(S!=null)throw Error(n(92));if(js(R)){if(1<R.length)throw Error(n(93));R=R[0]}S=R}S==null&&(S=""),R=S}v._wrapperState={initialValue:En(R)}}function za(v,S){var R=En(S.value),U=En(S.defaultValue);R!=null&&(R=""+R,R!==v.value&&(v.value=R),S.defaultValue==null&&v.defaultValue!==R&&(v.defaultValue=R)),U!=null&&(v.defaultValue=""+U)}function Na(v){var S=v.textContent;S===v._wrapperState.initialValue&&S!==""&&S!==null&&(v.value=S)}function Es(v){switch(v){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zs(v,S){return v==null||v==="http://www.w3.org/1999/xhtml"?Es(S):v==="http://www.w3.org/2000/svg"&&S==="foreignObject"?"http://www.w3.org/1999/xhtml":v}var fl,Fa=(function(v){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(S,R,U,K){MSApp.execUnsafeLocalFunction(function(){return v(S,R,U,K)})}:v})(function(v,S){if(v.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in v)v.innerHTML=S;else{for(fl=fl||document.createElement("div"),fl.innerHTML="<svg>"+S.valueOf().toString()+"</svg>",S=fl.firstChild;v.firstChild;)v.removeChild(v.firstChild);for(;S.firstChild;)v.appendChild(S.firstChild)}});function no(v,S){if(S){var R=v.firstChild;if(R&&R===v.lastChild&&R.nodeType===3){R.nodeValue=S;return}}v.textContent=S}var os={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pl=["Webkit","ms","Moz","O"];Object.keys(os).forEach(function(v){pl.forEach(function(S){S=S+v.charAt(0).toUpperCase()+v.substring(1),os[S]=os[v]})});function $h(v,S,R){return S==null||typeof S=="boolean"||S===""?"":R||typeof S!="number"||S===0||os.hasOwnProperty(v)&&os[v]?(""+S).trim():S+"px"}function ac(v,S){v=v.style;for(var R in S)if(S.hasOwnProperty(R)){var U=R.indexOf("--")===0,K=$h(R,S[R],U);R==="float"&&(R="cssFloat"),U?v.setProperty(R,K):v[R]=K}}var Ol=Xt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ml(v,S){if(S){if(Ol[v]&&(S.children!=null||S.dangerouslySetInnerHTML!=null))throw Error(n(137,v));if(S.dangerouslySetInnerHTML!=null){if(S.children!=null)throw Error(n(60));if(typeof S.dangerouslySetInnerHTML!="object"||!("__html"in S.dangerouslySetInnerHTML))throw Error(n(61))}if(S.style!=null&&typeof S.style!="object")throw Error(n(62))}}function lc(v,S){if(v.indexOf("-")===-1)return typeof S.is=="string";switch(v){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vi=null;function hs(v){return v=v.target||v.srcElement||window,v.correspondingUseElement&&(v=v.correspondingUseElement),v.nodeType===3?v.parentNode:v}var ku=null,Ba=null,_o=null;function Hh(v){if(v=ld(v)){if(typeof ku!="function")throw Error(n(280));var S=v.stateNode;S&&(S=Fp(S),ku(v.stateNode,v.type,S))}}function Gh(v){Ba?_o?_o.push(v):_o=[v]:Ba=v}function Wd(){if(Ba){var v=Ba,S=_o;if(_o=Ba=null,Hh(v),S)for(v=0;v<S.length;v++)Hh(S[v])}}function It(v,S){return v(S)}function Dl(){}var qd=!1;function Ru(v,S,R){if(qd)return v(S,R);qd=!0;try{return It(v,S,R)}finally{qd=!1,(Ba!==null||_o!==null)&&(Dl(),Wd())}}function $e(v,S){var R=v.stateNode;if(R===null)return null;var U=Fp(R);if(U===null)return null;R=U[S];e:switch(S){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(U=!U.disabled)||(v=v.type,U=!(v==="button"||v==="input"||v==="select"||v==="textarea")),v=!U;break e;default:v=!1}if(v)return null;if(R&&typeof R!="function")throw Error(n(231,S,typeof R));return R}var oe=!1;if(i)try{var de={};Object.defineProperty(de,"passive",{get:function(){oe=!0}}),window.addEventListener("test",de,de),window.removeEventListener("test",de,de)}catch{oe=!1}function Se(v,S,R,U,K,ae,Ee,Je,ct){var Vt=Array.prototype.slice.call(arguments,3);try{S.apply(R,Vt)}catch(pn){this.onError(pn)}}var ze=!1,De=null,Oe=!1,rt=null,Ve={onError:function(v){ze=!0,De=v}};function ot(v,S,R,U,K,ae,Ee,Je,ct){ze=!1,De=null,Se.apply(Ve,arguments)}function jt(v,S,R,U,K,ae,Ee,Je,ct){if(ot.apply(this,arguments),ze){if(ze){var Vt=De;ze=!1,De=null}else throw Error(n(198));Oe||(Oe=!0,rt=Vt)}}function _t(v){var S=v,R=v;if(v.alternate)for(;S.return;)S=S.return;else{v=S;do S=v,(S.flags&4098)!==0&&(R=S.return),v=S.return;while(v)}return S.tag===3?R:null}function gn(v){if(v.tag===13){var S=v.memoizedState;if(S===null&&(v=v.alternate,v!==null&&(S=v.memoizedState)),S!==null)return S.dehydrated}return null}function Rn(v){if(_t(v)!==v)throw Error(n(188))}function Fn(v){var S=v.alternate;if(!S){if(S=_t(v),S===null)throw Error(n(188));return S!==v?null:v}for(var R=v,U=S;;){var K=R.return;if(K===null)break;var ae=K.alternate;if(ae===null){if(U=K.return,U!==null){R=U;continue}break}if(K.child===ae.child){for(ae=K.child;ae;){if(ae===R)return Rn(K),v;if(ae===U)return Rn(K),S;ae=ae.sibling}throw Error(n(188))}if(R.return!==U.return)R=K,U=ae;else{for(var Ee=!1,Je=K.child;Je;){if(Je===R){Ee=!0,R=K,U=ae;break}if(Je===U){Ee=!0,U=K,R=ae;break}Je=Je.sibling}if(!Ee){for(Je=ae.child;Je;){if(Je===R){Ee=!0,R=ae,U=K;break}if(Je===U){Ee=!0,U=ae,R=K;break}Je=Je.sibling}if(!Ee)throw Error(n(189))}}if(R.alternate!==U)throw Error(n(190))}if(R.tag!==3)throw Error(n(188));return R.stateNode.current===R?v:S}function gr(v){return v=Fn(v),v!==null?or(v):null}function or(v){if(v.tag===5||v.tag===6)return v;for(v=v.child;v!==null;){var S=or(v);if(S!==null)return S;v=v.sibling}return null}var xr=t.unstable_scheduleCallback,Xr=t.unstable_cancelCallback,_r=t.unstable_shouldYield,zi=t.unstable_requestPaint,Ur=t.unstable_now,ts=t.unstable_getCurrentPriorityLevel,$r=t.unstable_ImmediatePriority,Or=t.unstable_UserBlockingPriority,wi=t.unstable_NormalPriority,Oi=t.unstable_LowPriority,ti=t.unstable_IdlePriority,ds=null,Yi=null;function da(v){if(Yi&&typeof Yi.onCommitFiberRoot=="function")try{Yi.onCommitFiberRoot(ds,v,void 0,(v.current.flags&128)===128)}catch{}}var Ns=Math.clz32?Math.clz32:d_,ro=Math.log,Wh=Math.LN2;function d_(v){return v>>>=0,v===0?32:31-(ro(v)/Wh|0)|0}var gl=64,cc=4194304;function uc(v){switch(v&-v){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return v&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return v}}function Fc(v,S){var R=v.pendingLanes;if(R===0)return 0;var U=0,K=v.suspendedLanes,ae=v.pingedLanes,Ee=R&268435455;if(Ee!==0){var Je=Ee&~K;Je!==0?U=uc(Je):(ae&=Ee,ae!==0&&(U=uc(ae)))}else Ee=R&~K,Ee!==0?U=uc(Ee):ae!==0&&(U=uc(ae));if(U===0)return 0;if(S!==0&&S!==U&&(S&K)===0&&(K=U&-U,ae=S&-S,K>=ae||K===16&&(ae&4194240)!==0))return S;if((U&4)!==0&&(U|=R&16),S=v.entangledLanes,S!==0)for(v=v.entanglements,S&=U;0<S;)R=31-Ns(S),K=1<<R,U|=v[R],S&=~K;return U}function Bc(v,S){switch(v){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zd(v,S){for(var R=v.suspendedLanes,U=v.pingedLanes,K=v.expirationTimes,ae=v.pendingLanes;0<ae;){var Ee=31-Ns(ae),Je=1<<Ee,ct=K[Ee];ct===-1?((Je&R)===0||(Je&U)!==0)&&(K[Ee]=Bc(Je,S)):ct<=S&&(v.expiredLanes|=Je),ae&=~Je}}function Xd(v){return v=v.pendingLanes&-1073741825,v!==0?v:v&1073741824?1073741824:0}function _l(){var v=gl;return gl<<=1,(gl&4194240)===0&&(gl=64),v}function Yd(v){for(var S=[],R=0;31>R;R++)S.push(v);return S}function Uc(v,S,R){v.pendingLanes|=S,S!==536870912&&(v.suspendedLanes=0,v.pingedLanes=0),v=v.eventTimes,S=31-Ns(S),v[S]=R}function fa(v,S){var R=v.pendingLanes&~S;v.pendingLanes=S,v.suspendedLanes=0,v.pingedLanes=0,v.expiredLanes&=S,v.mutableReadLanes&=S,v.entangledLanes&=S,S=v.entanglements;var U=v.eventTimes;for(v=v.expirationTimes;0<R;){var K=31-Ns(R),ae=1<<K;S[K]=0,U[K]=-1,v[K]=-1,R&=~ae}}function pa(v,S){var R=v.entangledLanes|=S;for(v=v.entanglements;R;){var U=31-Ns(R),K=1<<U;K&S|v[U]&S&&(v[U]|=S),R&=~K}}var ni=0;function Ua(v){return v&=-v,1<v?4<v?(v&268435455)!==0?16:536870912:4:1}var io,hc,Tp,qh,dc,Ou=!1,Vc=[],ma=null,As=null,Ll=null,$c=new Map,jl=new Map,yl=[],Um="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Kd(v,S){switch(v){case"focusin":case"focusout":ma=null;break;case"dragenter":case"dragleave":As=null;break;case"mouseover":case"mouseout":Ll=null;break;case"pointerover":case"pointerout":$c.delete(S.pointerId);break;case"gotpointercapture":case"lostpointercapture":jl.delete(S.pointerId)}}function br(v,S,R,U,K,ae){return v===null||v.nativeEvent!==ae?(v={blockedOn:S,domEventName:R,eventSystemFlags:U,nativeEvent:ae,targetContainers:[K]},S!==null&&(S=ld(S),S!==null&&hc(S)),v):(v.eventSystemFlags|=U,S=v.targetContainers,K!==null&&S.indexOf(K)===-1&&S.push(K),v)}function Zh(v,S,R,U,K){switch(S){case"focusin":return ma=br(ma,v,S,R,U,K),!0;case"dragenter":return As=br(As,v,S,R,U,K),!0;case"mouseover":return Ll=br(Ll,v,S,R,U,K),!0;case"pointerover":var ae=K.pointerId;return $c.set(ae,br($c.get(ae)||null,v,S,R,U,K)),!0;case"gotpointercapture":return ae=K.pointerId,jl.set(ae,br(jl.get(ae)||null,v,S,R,U,K)),!0}return!1}function Vm(v){var S=ea(v.target);if(S!==null){var R=_t(S);if(R!==null){if(S=R.tag,S===13){if(S=gn(R),S!==null){v.blockedOn=S,dc(v.priority,function(){Tp(R)});return}}else if(S===3&&R.stateNode.current.memoizedState.isDehydrated){v.blockedOn=R.tag===3?R.stateNode.containerInfo:null;return}}}v.blockedOn=null}function Jd(v){if(v.blockedOn!==null)return!1;for(var S=v.targetContainers;0<S.length;){var R=Xh(v.domEventName,v.eventSystemFlags,S[0],v.nativeEvent);if(R===null){R=v.nativeEvent;var U=new R.constructor(R.type,R);vi=U,R.target.dispatchEvent(U),vi=null}else return S=ld(R),S!==null&&hc(S),v.blockedOn=R,!1;S.shift()}return!0}function Qd(v,S,R){Jd(v)&&R.delete(S)}function Hc(){Ou=!1,ma!==null&&Jd(ma)&&(ma=null),As!==null&&Jd(As)&&(As=null),Ll!==null&&Jd(Ll)&&(Ll=null),$c.forEach(Qd),jl.forEach(Qd)}function zl(v,S){v.blockedOn===S&&(v.blockedOn=null,Ou||(Ou=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Hc)))}function fc(v){function S(K){return zl(K,v)}if(0<Vc.length){zl(Vc[0],v);for(var R=1;R<Vc.length;R++){var U=Vc[R];U.blockedOn===v&&(U.blockedOn=null)}}for(ma!==null&&zl(ma,v),As!==null&&zl(As,v),Ll!==null&&zl(Ll,v),$c.forEach(S),jl.forEach(S),R=0;R<yl.length;R++)U=yl[R],U.blockedOn===v&&(U.blockedOn=null);for(;0<yl.length&&(R=yl[0],R.blockedOn===null);)Vm(R),R.blockedOn===null&&yl.shift()}var pc=ye.ReactCurrentBatchConfig,ef=!0;function Du(v,S,R,U){var K=ni,ae=pc.transition;pc.transition=null;try{ni=1,tf(v,S,R,U)}finally{ni=K,pc.transition=ae}}function f_(v,S,R,U){var K=ni,ae=pc.transition;pc.transition=null;try{ni=4,tf(v,S,R,U)}finally{ni=K,pc.transition=ae}}function tf(v,S,R,U){if(ef){var K=Xh(v,S,R,U);if(K===null)Wm(v,S,U,mc,R),Kd(v,U);else if(Zh(K,v,S,R,U))U.stopPropagation();else if(Kd(v,U),S&4&&-1<Um.indexOf(v)){for(;K!==null;){var ae=ld(K);if(ae!==null&&io(ae),ae=Xh(v,S,R,U),ae===null&&Wm(v,S,U,mc,R),ae===K)break;K=ae}K!==null&&U.stopPropagation()}else Wm(v,S,U,null,R)}}var mc=null;function Xh(v,S,R,U){if(mc=null,v=hs(U),v=ea(v),v!==null)if(S=_t(v),S===null)v=null;else if(R=S.tag,R===13){if(v=gn(S),v!==null)return v;v=null}else if(R===3){if(S.stateNode.current.memoizedState.isDehydrated)return S.tag===3?S.stateNode.containerInfo:null;v=null}else S!==v&&(v=null);return mc=v,null}function Va(v){switch(v){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ts()){case $r:return 1;case Or:return 4;case wi:case Oi:return 16;case ti:return 536870912;default:return 16}default:return 16}}var $a=null,Yh=null,yo=null;function Gc(){if(yo)return yo;var v,S=Yh,R=S.length,U,K="value"in $a?$a.value:$a.textContent,ae=K.length;for(v=0;v<R&&S[v]===K[v];v++);var Ee=R-v;for(U=1;U<=Ee&&S[R-U]===K[ae-U];U++);return yo=K.slice(v,1<U?1-U:void 0)}function vo(v){var S=v.keyCode;return"charCode"in v?(v=v.charCode,v===0&&S===13&&(v=13)):v=S,v===10&&(v=13),32<=v||v===13?v:0}function Kh(){return!0}function nf(){return!1}function Lo(v){function S(R,U,K,ae,Ee){this._reactName=R,this._targetInst=K,this.type=U,this.nativeEvent=ae,this.target=Ee,this.currentTarget=null;for(var Je in v)v.hasOwnProperty(Je)&&(R=v[Je],this[Je]=R?R(ae):ae[Je]);return this.isDefaultPrevented=(ae.defaultPrevented!=null?ae.defaultPrevented:ae.returnValue===!1)?Kh:nf,this.isPropagationStopped=nf,this}return Xt(S.prototype,{preventDefault:function(){this.defaultPrevented=!0;var R=this.nativeEvent;R&&(R.preventDefault?R.preventDefault():typeof R.returnValue!="unknown"&&(R.returnValue=!1),this.isDefaultPrevented=Kh)},stopPropagation:function(){var R=this.nativeEvent;R&&(R.stopPropagation?R.stopPropagation():typeof R.cancelBubble!="unknown"&&(R.cancelBubble=!0),this.isPropagationStopped=Kh)},persist:function(){},isPersistent:Kh}),S}var Ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(v){return v.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rf=Lo(Ir),Jh=Xt({},Ir,{view:0,detail:0}),Ep=Lo(Jh),An,sf,so,Ko=Xt({},Jh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lf,button:0,buttons:0,relatedTarget:function(v){return v.relatedTarget===void 0?v.fromElement===v.srcElement?v.toElement:v.fromElement:v.relatedTarget},movementX:function(v){return"movementX"in v?v.movementX:(v!==so&&(so&&v.type==="mousemove"?(An=v.screenX-so.screenX,sf=v.screenY-so.screenY):sf=An=0,so=v),An)},movementY:function(v){return"movementY"in v?v.movementY:sf}}),of=Lo(Ko),Nl=Xt({},Ko,{dataTransfer:0}),_n=Lo(Nl),Nr=Xt({},Jh,{relatedTarget:0}),zr=Lo(Nr),Jo=Xt({},Ir,{animationName:0,elapsedTime:0,pseudoElement:0}),Lu=Lo(Jo),Dr=Xt({},Ir,{clipboardData:function(v){return"clipboardData"in v?v.clipboardData:window.clipboardData}}),Ap=Lo(Dr),Wc=Xt({},Ir,{data:0}),Qh=Lo(Wc),oo={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ns={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$y={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function af(v){var S=this.nativeEvent;return S.getModifierState?S.getModifierState(v):(v=$y[v])?!!S[v]:!1}function lf(){return af}var cf=Xt({},Jh,{key:function(v){if(v.key){var S=oo[v.key]||v.key;if(S!=="Unidentified")return S}return v.type==="keypress"?(v=vo(v),v===13?"Enter":String.fromCharCode(v)):v.type==="keydown"||v.type==="keyup"?ns[v.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lf,charCode:function(v){return v.type==="keypress"?vo(v):0},keyCode:function(v){return v.type==="keydown"||v.type==="keyup"?v.keyCode:0},which:function(v){return v.type==="keypress"?vo(v):v.type==="keydown"||v.type==="keyup"?v.keyCode:0}}),uf=Lo(cf),qc=Xt({},Ko,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hf=Lo(qc),xo=Xt({},Jh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lf}),vl=Lo(xo),jo=Xt({},Ir,{propertyName:0,elapsedTime:0,pseudoElement:0}),p_=Lo(jo),ed=Xt({},Ko,{deltaX:function(v){return"deltaX"in v?v.deltaX:"wheelDeltaX"in v?-v.wheelDeltaX:0},deltaY:function(v){return"deltaY"in v?v.deltaY:"wheelDeltaY"in v?-v.wheelDeltaY:"wheelDelta"in v?-v.wheelDelta:0},deltaZ:0,deltaMode:0}),fs=Lo(ed),zo=[9,13,27,32],Gn=i&&"CompositionEvent"in window,Qt=null;i&&"documentMode"in document&&(Qt=document.documentMode);var df=i&&"TextEvent"in window&&!Qt,In=i&&(!Gn||Qt&&8<Qt&&11>=Qt),Zc=" ",ju=!1;function Dn(v,S){switch(v){case"keyup":return zo.indexOf(S.keyCode)!==-1;case"keydown":return S.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cp(v){return v=v.detail,typeof v=="object"&&"data"in v?v.data:null}var Fl=!1;function ff(v,S){switch(v){case"compositionend":return Cp(S);case"keypress":return S.which!==32?null:(ju=!0,Zc);case"textInput":return v=S.data,v===Zc&&ju?null:v;default:return null}}function $m(v,S){if(Fl)return v==="compositionend"||!Gn&&Dn(v,S)?(v=Gc(),yo=Yh=$a=null,Fl=!1,v):null;switch(v){case"paste":return null;case"keypress":if(!(S.ctrlKey||S.altKey||S.metaKey)||S.ctrlKey&&S.altKey){if(S.char&&1<S.char.length)return S.char;if(S.which)return String.fromCharCode(S.which)}return null;case"compositionend":return In&&S.locale!=="ko"?null:S.data;default:return null}}var Pp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hi(v){var S=v&&v.nodeName&&v.nodeName.toLowerCase();return S==="input"?!!Pp[v.type]:S==="textarea"}function Ip(v,S,R,U){Gh(U),S=Dp(S,"onChange"),0<S.length&&(R=new rf("onChange","change",null,R,U),v.push({event:R,listeners:S}))}var ga=null,Cs=null;function Xc(v){bf(v,0)}function ps(v){var S=Gu(v);if(tn(S))return v}function m_(v,S){if(v==="change")return S}var td=!1;if(i){var Hm;if(i){var nd="oninput"in document;if(!nd){var zu=document.createElement("div");zu.setAttribute("oninput","return;"),nd=typeof zu.oninput=="function"}Hm=nd}else Hm=!1;td=Hm&&(!document.documentMode||9<document.documentMode)}function Ha(){ga&&(ga.detachEvent("onpropertychange",g_),Cs=ga=null)}function g_(v){if(v.propertyName==="value"&&ps(Cs)){var S=[];Ip(S,Cs,v,hs(v)),Ru(Xc,S)}}function rd(v,S,R){v==="focusin"?(Ha(),ga=S,Cs=R,ga.attachEvent("onpropertychange",g_)):v==="focusout"&&Ha()}function __(v){if(v==="selectionchange"||v==="keyup"||v==="keydown")return ps(Cs)}function Mp(v,S){if(v==="click")return ps(S)}function kp(v,S){if(v==="input"||v==="change")return ps(S)}function Yc(v,S){return v===S&&(v!==0||1/v===1/S)||v!==v&&S!==S}var ao=typeof Object.is=="function"?Object.is:Yc;function pf(v,S){if(ao(v,S))return!0;if(typeof v!="object"||v===null||typeof S!="object"||S===null)return!1;var R=Object.keys(v),U=Object.keys(S);if(R.length!==U.length)return!1;for(U=0;U<R.length;U++){var K=R[U];if(!E.call(S,K)||!ao(v[K],S[K]))return!1}return!0}function y_(v){for(;v&&v.firstChild;)v=v.firstChild;return v}function mf(v,S){var R=y_(v);v=0;for(var U;R;){if(R.nodeType===3){if(U=v+R.textContent.length,v<=S&&U>=S)return{node:R,offset:S-v};v=U}e:{for(;R;){if(R.nextSibling){R=R.nextSibling;break e}R=R.parentNode}R=void 0}R=y_(R)}}function Gm(v,S){return v&&S?v===S?!0:v&&v.nodeType===3?!1:S&&S.nodeType===3?Gm(v,S.parentNode):"contains"in v?v.contains(S):v.compareDocumentPosition?!!(v.compareDocumentPosition(S)&16):!1:!1}function gf(){for(var v=window,S=Ii();S instanceof v.HTMLIFrameElement;){try{var R=typeof S.contentWindow.location.href=="string"}catch{R=!1}if(R)v=S.contentWindow;else break;S=Ii(v.document)}return S}function Qo(v){var S=v&&v.nodeName&&v.nodeName.toLowerCase();return S&&(S==="input"&&(v.type==="text"||v.type==="search"||v.type==="tel"||v.type==="url"||v.type==="password")||S==="textarea"||v.contentEditable==="true")}function v_(v){var S=gf(),R=v.focusedElem,U=v.selectionRange;if(S!==R&&R&&R.ownerDocument&&Gm(R.ownerDocument.documentElement,R)){if(U!==null&&Qo(R)){if(S=U.start,v=U.end,v===void 0&&(v=S),"selectionStart"in R)R.selectionStart=S,R.selectionEnd=Math.min(v,R.value.length);else if(v=(S=R.ownerDocument||document)&&S.defaultView||window,v.getSelection){v=v.getSelection();var K=R.textContent.length,ae=Math.min(U.start,K);U=U.end===void 0?ae:Math.min(U.end,K),!v.extend&&ae>U&&(K=U,U=ae,ae=K),K=mf(R,ae);var Ee=mf(R,U);K&&Ee&&(v.rangeCount!==1||v.anchorNode!==K.node||v.anchorOffset!==K.offset||v.focusNode!==Ee.node||v.focusOffset!==Ee.offset)&&(S=S.createRange(),S.setStart(K.node,K.offset),v.removeAllRanges(),ae>U?(v.addRange(S),v.extend(Ee.node,Ee.offset)):(S.setEnd(Ee.node,Ee.offset),v.addRange(S)))}}for(S=[],v=R;v=v.parentNode;)v.nodeType===1&&S.push({element:v,left:v.scrollLeft,top:v.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<S.length;R++)v=S[R],v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}var x_=i&&"documentMode"in document&&11>=document.documentMode,Nu=null,gc=null,_c=null,_f=!1;function Rp(v,S,R){var U=R.window===R?R.document:R.nodeType===9?R:R.ownerDocument;_f||Nu==null||Nu!==Ii(U)||(U=Nu,"selectionStart"in U&&Qo(U)?U={start:U.selectionStart,end:U.selectionEnd}:(U=(U.ownerDocument&&U.ownerDocument.defaultView||window).getSelection(),U={anchorNode:U.anchorNode,anchorOffset:U.anchorOffset,focusNode:U.focusNode,focusOffset:U.focusOffset}),_c&&pf(_c,U)||(_c=U,U=Dp(gc,"onSelect"),0<U.length&&(S=new rf("onSelect","select",null,S,R),v.push({event:S,listeners:U}),S.target=Nu)))}function yc(v,S){var R={};return R[v.toLowerCase()]=S.toLowerCase(),R["Webkit"+v]="webkit"+S,R["Moz"+v]="moz"+S,R}var xl={animationend:yc("Animation","AnimationEnd"),animationiteration:yc("Animation","AnimationIteration"),animationstart:yc("Animation","AnimationStart"),transitionend:yc("Transition","TransitionEnd")},yf={},vf={};i&&(vf=document.createElement("div").style,"AnimationEvent"in window||(delete xl.animationend.animation,delete xl.animationiteration.animation,delete xl.animationstart.animation),"TransitionEvent"in window||delete xl.transitionend.transition);function bo(v){if(yf[v])return yf[v];if(!xl[v])return v;var S=xl[v],R;for(R in S)if(S.hasOwnProperty(R)&&R in vf)return yf[v]=S[R];return v}var xf=bo("animationend"),Ft=bo("animationiteration"),Op=bo("animationstart"),Fu=bo("transitionend"),Bu=new Map,id="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ga(v,S){Bu.set(v,S),d(S,[v])}for(var Wa=0;Wa<id.length;Wa++){var sd=id[Wa],qa=sd.toLowerCase(),yr=sd[0].toUpperCase()+sd.slice(1);Ga(qa,"on"+yr)}Ga(xf,"onAnimationEnd"),Ga(Ft,"onAnimationIteration"),Ga(Op,"onAnimationStart"),Ga("dblclick","onDoubleClick"),Ga("focusin","onFocus"),Ga("focusout","onBlur"),Ga(Fu,"onTransitionEnd"),g("onMouseEnter",["mouseout","mouseover"]),g("onMouseLeave",["mouseout","mouseover"]),g("onPointerEnter",["pointerout","pointerover"]),g("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bl));function b_(v,S,R){var U=v.type||"unknown-event";v.currentTarget=R,jt(U,S,void 0,v),v.currentTarget=null}function bf(v,S){S=(S&4)!==0;for(var R=0;R<v.length;R++){var U=v[R],K=U.event;U=U.listeners;e:{var ae=void 0;if(S)for(var Ee=U.length-1;0<=Ee;Ee--){var Je=U[Ee],ct=Je.instance,Vt=Je.currentTarget;if(Je=Je.listener,ct!==ae&&K.isPropagationStopped())break e;b_(K,Je,Vt),ae=ct}else for(Ee=0;Ee<U.length;Ee++){if(Je=U[Ee],ct=Je.instance,Vt=Je.currentTarget,Je=Je.listener,ct!==ae&&K.isPropagationStopped())break e;b_(K,Je,Vt),ae=ct}}}if(Oe)throw v=rt,Oe=!1,rt=null,v}function Ki(v,S){var R=S[Np];R===void 0&&(R=S[Np]=new Set);var U=v+"__bubble";R.has(U)||(w_(S,v,2,!1),R.add(U))}function hi(v,S,R){var U=0;S&&(U|=4),w_(R,v,U,S)}var wf="_reactListening"+Math.random().toString(36).slice(2);function Uu(v){if(!v[wf]){v[wf]=!0,o.forEach(function(R){R!=="selectionchange"&&(Hy.has(R)||hi(R,!1,v),hi(R,!0,v))});var S=v.nodeType===9?v:v.ownerDocument;S===null||S[wf]||(S[wf]=!0,hi("selectionchange",!1,S))}}function w_(v,S,R,U){switch(Va(S)){case 1:var K=Du;break;case 4:K=f_;break;default:K=tf}R=K.bind(null,S,R,v),K=void 0,!oe||S!=="touchstart"&&S!=="touchmove"&&S!=="wheel"||(K=!0),U?K!==void 0?v.addEventListener(S,R,{capture:!0,passive:K}):v.addEventListener(S,R,!0):K!==void 0?v.addEventListener(S,R,{passive:K}):v.addEventListener(S,R,!1)}function Wm(v,S,R,U,K){var ae=U;if((S&1)===0&&(S&2)===0&&U!==null)e:for(;;){if(U===null)return;var Ee=U.tag;if(Ee===3||Ee===4){var Je=U.stateNode.containerInfo;if(Je===K||Je.nodeType===8&&Je.parentNode===K)break;if(Ee===4)for(Ee=U.return;Ee!==null;){var ct=Ee.tag;if((ct===3||ct===4)&&(ct=Ee.stateNode.containerInfo,ct===K||ct.nodeType===8&&ct.parentNode===K))return;Ee=Ee.return}for(;Je!==null;){if(Ee=ea(Je),Ee===null)return;if(ct=Ee.tag,ct===5||ct===6){U=ae=Ee;continue e}Je=Je.parentNode}}U=U.return}Ru(function(){var Vt=ae,pn=hs(R),yn=[];e:{var vn=Bu.get(v);if(vn!==void 0){var Kn=rf,ir=v;switch(v){case"keypress":if(vo(R)===0)break e;case"keydown":case"keyup":Kn=uf;break;case"focusin":ir="focus",Kn=zr;break;case"focusout":ir="blur",Kn=zr;break;case"beforeblur":case"afterblur":Kn=zr;break;case"click":if(R.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Kn=of;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Kn=_n;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Kn=vl;break;case xf:case Ft:case Op:Kn=Lu;break;case Fu:Kn=p_;break;case"scroll":Kn=Ep;break;case"wheel":Kn=fs;break;case"copy":case"cut":case"paste":Kn=Ap;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Kn=hf}var cr=(S&4)!==0,as=!cr&&v==="scroll",Et=cr?vn!==null?vn+"Capture":null:vn;cr=[];for(var pt=Vt,Lt;pt!==null;){Lt=pt;var Pn=Lt.stateNode;if(Lt.tag===5&&Pn!==null&&(Lt=Pn,Et!==null&&(Pn=$e(pt,Et),Pn!=null&&cr.push(Sf(pt,Pn,Lt)))),as)break;pt=pt.return}0<cr.length&&(vn=new Kn(vn,ir,null,R,pn),yn.push({event:vn,listeners:cr}))}}if((S&7)===0){e:{if(vn=v==="mouseover"||v==="pointerover",Kn=v==="mouseout"||v==="pointerout",vn&&R!==vi&&(ir=R.relatedTarget||R.fromElement)&&(ea(ir)||ir[ya]))break e;if((Kn||vn)&&(vn=pn.window===pn?pn:(vn=pn.ownerDocument)?vn.defaultView||vn.parentWindow:window,Kn?(ir=R.relatedTarget||R.toElement,Kn=Vt,ir=ir?ea(ir):null,ir!==null&&(as=_t(ir),ir!==as||ir.tag!==5&&ir.tag!==6)&&(ir=null)):(Kn=null,ir=Vt),Kn!==ir)){if(cr=of,Pn="onMouseLeave",Et="onMouseEnter",pt="mouse",(v==="pointerout"||v==="pointerover")&&(cr=hf,Pn="onPointerLeave",Et="onPointerEnter",pt="pointer"),as=Kn==null?vn:Gu(Kn),Lt=ir==null?vn:Gu(ir),vn=new cr(Pn,pt+"leave",Kn,R,pn),vn.target=as,vn.relatedTarget=Lt,Pn=null,ea(pn)===Vt&&(cr=new cr(Et,pt+"enter",ir,R,pn),cr.target=Lt,cr.relatedTarget=as,Pn=cr),as=Pn,Kn&&ir)t:{for(cr=Kn,Et=ir,pt=0,Lt=cr;Lt;Lt=Vu(Lt))pt++;for(Lt=0,Pn=Et;Pn;Pn=Vu(Pn))Lt++;for(;0<pt-Lt;)cr=Vu(cr),pt--;for(;0<Lt-pt;)Et=Vu(Et),Lt--;for(;pt--;){if(cr===Et||Et!==null&&cr===Et.alternate)break t;cr=Vu(cr),Et=Vu(Et)}cr=null}else cr=null;Kn!==null&&S_(yn,vn,Kn,cr,!1),ir!==null&&as!==null&&S_(yn,as,ir,cr,!0)}}e:{if(vn=Vt?Gu(Vt):window,Kn=vn.nodeName&&vn.nodeName.toLowerCase(),Kn==="select"||Kn==="input"&&vn.type==="file")var pr=m_;else if(Hi(vn))if(td)pr=kp;else{pr=__;var Cr=rd}else(Kn=vn.nodeName)&&Kn.toLowerCase()==="input"&&(vn.type==="checkbox"||vn.type==="radio")&&(pr=Mp);if(pr&&(pr=pr(v,Vt))){Ip(yn,pr,R,pn);break e}Cr&&Cr(v,vn,Vt),v==="focusout"&&(Cr=vn._wrapperState)&&Cr.controlled&&vn.type==="number"&&Fi(vn,"number",vn.value)}switch(Cr=Vt?Gu(Vt):window,v){case"focusin":(Hi(Cr)||Cr.contentEditable==="true")&&(Nu=Cr,gc=Vt,_c=null);break;case"focusout":_c=gc=Nu=null;break;case"mousedown":_f=!0;break;case"contextmenu":case"mouseup":case"dragend":_f=!1,Rp(yn,R,pn);break;case"selectionchange":if(x_)break;case"keydown":case"keyup":Rp(yn,R,pn)}var Pr;if(Gn)e:{switch(v){case"compositionstart":var Tr="onCompositionStart";break e;case"compositionend":Tr="onCompositionEnd";break e;case"compositionupdate":Tr="onCompositionUpdate";break e}Tr=void 0}else Fl?Dn(v,R)&&(Tr="onCompositionEnd"):v==="keydown"&&R.keyCode===229&&(Tr="onCompositionStart");Tr&&(In&&R.locale!=="ko"&&(Fl||Tr!=="onCompositionStart"?Tr==="onCompositionEnd"&&Fl&&(Pr=Gc()):($a=pn,Yh="value"in $a?$a.value:$a.textContent,Fl=!0)),Cr=Dp(Vt,Tr),0<Cr.length&&(Tr=new Qh(Tr,v,null,R,pn),yn.push({event:Tr,listeners:Cr}),Pr?Tr.data=Pr:(Pr=Cp(R),Pr!==null&&(Tr.data=Pr)))),(Pr=df?ff(v,R):$m(v,R))&&(Vt=Dp(Vt,"onBeforeInput"),0<Vt.length&&(pn=new Qh("onBeforeInput","beforeinput",null,R,pn),yn.push({event:pn,listeners:Vt}),pn.data=Pr))}bf(yn,S)})}function Sf(v,S,R){return{instance:v,listener:S,currentTarget:R}}function Dp(v,S){for(var R=S+"Capture",U=[];v!==null;){var K=v,ae=K.stateNode;K.tag===5&&ae!==null&&(K=ae,ae=$e(v,R),ae!=null&&U.unshift(Sf(v,ae,K)),ae=$e(v,S),ae!=null&&U.push(Sf(v,ae,K))),v=v.return}return U}function Vu(v){if(v===null)return null;do v=v.return;while(v&&v.tag!==5);return v||null}function S_(v,S,R,U,K){for(var ae=S._reactName,Ee=[];R!==null&&R!==U;){var Je=R,ct=Je.alternate,Vt=Je.stateNode;if(ct!==null&&ct===U)break;Je.tag===5&&Vt!==null&&(Je=Vt,K?(ct=$e(R,ae),ct!=null&&Ee.unshift(Sf(R,ct,Je))):K||(ct=$e(R,ae),ct!=null&&Ee.push(Sf(R,ct,Je)))),R=R.return}Ee.length!==0&&v.push({event:S,listeners:Ee})}var Lp=/\r\n?/g,Gy=/\u0000|\uFFFD/g;function qm(v){return(typeof v=="string"?v:""+v).replace(Lp,`
`).replace(Gy,"")}function od(v,S,R){if(S=qm(S),qm(v)!==S&&R)throw Error(n(425))}function $u(){}var Tf=null,vc=null;function Kc(v,S){return v==="textarea"||v==="noscript"||typeof S.children=="string"||typeof S.children=="number"||typeof S.dangerouslySetInnerHTML=="object"&&S.dangerouslySetInnerHTML!==null&&S.dangerouslySetInnerHTML.__html!=null}var ad=typeof setTimeout=="function"?setTimeout:void 0,jp=typeof clearTimeout=="function"?clearTimeout:void 0,Hu=typeof Promise=="function"?Promise:void 0,T_=typeof queueMicrotask=="function"?queueMicrotask:typeof Hu<"u"?function(v){return Hu.resolve(null).then(v).catch(Zm)}:ad;function Zm(v){setTimeout(function(){throw v})}function zp(v,S){var R=S,U=0;do{var K=R.nextSibling;if(v.removeChild(R),K&&K.nodeType===8)if(R=K.data,R==="/$"){if(U===0){v.removeChild(K),fc(S);return}U--}else R!=="$"&&R!=="$?"&&R!=="$!"||U++;R=K}while(R);fc(S)}function _a(v){for(;v!=null;v=v.nextSibling){var S=v.nodeType;if(S===1||S===3)break;if(S===8){if(S=v.data,S==="$"||S==="$!"||S==="$?")break;if(S==="/$")return null}}return v}function Ef(v){v=v.previousSibling;for(var S=0;v;){if(v.nodeType===8){var R=v.data;if(R==="$"||R==="$!"||R==="$?"){if(S===0)return v;S--}else R==="/$"&&S++}v=v.previousSibling}return null}var xc=Math.random().toString(36).slice(2),Za="__reactFiber$"+xc,Jc="__reactProps$"+xc,ya="__reactContainer$"+xc,Np="__reactEvents$"+xc,E_="__reactListeners$"+xc,A_="__reactHandles$"+xc;function ea(v){var S=v[Za];if(S)return S;for(var R=v.parentNode;R;){if(S=R[ya]||R[Za]){if(R=S.alternate,S.child!==null||R!==null&&R.child!==null)for(v=Ef(v);v!==null;){if(R=v[Za])return R;v=Ef(v)}return S}v=R,R=v.parentNode}return null}function ld(v){return v=v[Za]||v[ya],!v||v.tag!==5&&v.tag!==6&&v.tag!==13&&v.tag!==3?null:v}function Gu(v){if(v.tag===5||v.tag===6)return v.stateNode;throw Error(n(33))}function Fp(v){return v[Jc]||null}var Xm=[],Qc=-1;function bl(v){return{current:v}}function Bi(v){0>Qc||(v.current=Xm[Qc],Xm[Qc]=null,Qc--)}function Si(v,S){Qc++,Xm[Qc]=v.current,v.current=S}var Ul={},Hs=bl(Ul),ta=bl(!1),va=Ul;function Xa(v,S){var R=v.type.contextTypes;if(!R)return Ul;var U=v.stateNode;if(U&&U.__reactInternalMemoizedUnmaskedChildContext===S)return U.__reactInternalMemoizedMaskedChildContext;var K={},ae;for(ae in R)K[ae]=S[ae];return U&&(v=v.stateNode,v.__reactInternalMemoizedUnmaskedChildContext=S,v.__reactInternalMemoizedMaskedChildContext=K),K}function No(v){return v=v.childContextTypes,v!=null}function wo(){Bi(ta),Bi(Hs)}function Af(v,S,R){if(Hs.current!==Ul)throw Error(n(168));Si(Hs,S),Si(ta,R)}function cd(v,S,R){var U=v.stateNode;if(S=S.childContextTypes,typeof U.getChildContext!="function")return R;U=U.getChildContext();for(var K in U)if(!(K in S))throw Error(n(108,Bt(v)||"Unknown",K));return Xt({},R,U)}function Wu(v){return v=(v=v.stateNode)&&v.__reactInternalMemoizedMergedChildContext||Ul,va=Hs.current,Si(Hs,v),Si(ta,ta.current),!0}function Bp(v,S,R){var U=v.stateNode;if(!U)throw Error(n(169));R?(v=cd(v,S,va),U.__reactInternalMemoizedMergedChildContext=v,Bi(ta),Bi(Hs),Si(Hs,v)):Bi(ta),Si(ta,R)}var wl=null,qu=!1,Zu=!1;function Xu(v){wl===null?wl=[v]:wl.push(v)}function Ym(v){qu=!0,Xu(v)}function Ya(){if(!Zu&&wl!==null){Zu=!0;var v=0,S=ni;try{var R=wl;for(ni=1;v<R.length;v++){var U=R[v];do U=U(!0);while(U!==null)}wl=null,qu=!1}catch(K){throw wl!==null&&(wl=wl.slice(v+1)),xr($r,Ya),K}finally{ni=S,Zu=!1}}return null}var eu=[],Yu=0,ud=null,Vl=0,Ka=[],Ja=0,Ku=null,Qa=1,bc="";function Ju(v,S){eu[Yu++]=Vl,eu[Yu++]=ud,ud=v,Vl=S}function Up(v,S,R){Ka[Ja++]=Qa,Ka[Ja++]=bc,Ka[Ja++]=Ku,Ku=v;var U=Qa;v=bc;var K=32-Ns(U)-1;U&=~(1<<K),R+=1;var ae=32-Ns(S)+K;if(30<ae){var Ee=K-K%5;ae=(U&(1<<Ee)-1).toString(32),U>>=Ee,K-=Ee,Qa=1<<32-Ns(S)+K|R<<K|U,bc=ae+v}else Qa=1<<ae|R<<K|U,bc=v}function Cf(v){v.return!==null&&(Ju(v,1),Up(v,1,0))}function Pf(v){for(;v===ud;)ud=eu[--Yu],eu[Yu]=null,Vl=eu[--Yu],eu[Yu]=null;for(;v===Ku;)Ku=Ka[--Ja],Ka[Ja]=null,bc=Ka[--Ja],Ka[Ja]=null,Qa=Ka[--Ja],Ka[Ja]=null}var Gs=null,na=null,qi=!1,xa=null;function If(v,S){var R=Gr(5,null,null,0);R.elementType="DELETED",R.stateNode=S,R.return=v,S=v.deletions,S===null?(v.deletions=[R],v.flags|=16):S.push(R)}function tu(v,S){switch(v.tag){case 5:var R=v.type;return S=S.nodeType!==1||R.toLowerCase()!==S.nodeName.toLowerCase()?null:S,S!==null?(v.stateNode=S,Gs=v,na=_a(S.firstChild),!0):!1;case 6:return S=v.pendingProps===""||S.nodeType!==3?null:S,S!==null?(v.stateNode=S,Gs=v,na=null,!0):!1;case 13:return S=S.nodeType!==8?null:S,S!==null?(R=Ku!==null?{id:Qa,overflow:bc}:null,v.memoizedState={dehydrated:S,treeContext:R,retryLane:1073741824},R=Gr(18,null,null,0),R.stateNode=S,R.return=v,v.child=R,Gs=v,na=null,!0):!1;default:return!1}}function wc(v){return(v.mode&1)!==0&&(v.flags&128)===0}function $l(v){if(qi){var S=na;if(S){var R=S;if(!tu(v,S)){if(wc(v))throw Error(n(418));S=_a(R.nextSibling);var U=Gs;S&&tu(v,S)?If(U,R):(v.flags=v.flags&-4097|2,qi=!1,Gs=v)}}else{if(wc(v))throw Error(n(418));v.flags=v.flags&-4097|2,qi=!1,Gs=v}}}function Vp(v){for(v=v.return;v!==null&&v.tag!==5&&v.tag!==3&&v.tag!==13;)v=v.return;Gs=v}function Qu(v){if(v!==Gs)return!1;if(!qi)return Vp(v),qi=!0,!1;var S;if((S=v.tag!==3)&&!(S=v.tag!==5)&&(S=v.type,S=S!=="head"&&S!=="body"&&!Kc(v.type,v.memoizedProps)),S&&(S=na)){if(wc(v))throw $p(),Error(n(418));for(;S;)If(v,S),S=_a(S.nextSibling)}if(Vp(v),v.tag===13){if(v=v.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(n(317));e:{for(v=v.nextSibling,S=0;v;){if(v.nodeType===8){var R=v.data;if(R==="/$"){if(S===0){na=_a(v.nextSibling);break e}S--}else R!=="$"&&R!=="$!"&&R!=="$?"||S++}v=v.nextSibling}na=null}}else na=Gs?_a(v.stateNode.nextSibling):null;return!0}function $p(){for(var v=na;v;)v=_a(v.nextSibling)}function nu(){na=Gs=null,qi=!1}function hd(v){xa===null?xa=[v]:xa.push(v)}var Hp=ye.ReactCurrentBatchConfig;function eh(v,S,R){if(v=R.ref,v!==null&&typeof v!="function"&&typeof v!="object"){if(R._owner){if(R=R._owner,R){if(R.tag!==1)throw Error(n(309));var U=R.stateNode}if(!U)throw Error(n(147,v));var K=U,ae=""+v;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===ae?S.ref:(S=function(Ee){var Je=K.refs;Ee===null?delete Je[ae]:Je[ae]=Ee},S._stringRef=ae,S)}if(typeof v!="string")throw Error(n(284));if(!R._owner)throw Error(n(290,v))}return v}function th(v,S){throw v=Object.prototype.toString.call(S),Error(n(31,v==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":v))}function nh(v){var S=v._init;return S(v._payload)}function C_(v){function S(Et,pt){if(v){var Lt=Et.deletions;Lt===null?(Et.deletions=[pt],Et.flags|=16):Lt.push(pt)}}function R(Et,pt){if(!v)return null;for(;pt!==null;)S(Et,pt),pt=pt.sibling;return null}function U(Et,pt){for(Et=new Map;pt!==null;)pt.key!==null?Et.set(pt.key,pt):Et.set(pt.index,pt),pt=pt.sibling;return Et}function K(Et,pt){return Et=Gi(Et,pt),Et.index=0,Et.sibling=null,Et}function ae(Et,pt,Lt){return Et.index=Lt,v?(Lt=Et.alternate,Lt!==null?(Lt=Lt.index,Lt<pt?(Et.flags|=2,pt):Lt):(Et.flags|=2,pt)):(Et.flags|=1048576,pt)}function Ee(Et){return v&&Et.alternate===null&&(Et.flags|=2),Et}function Je(Et,pt,Lt,Pn){return pt===null||pt.tag!==6?(pt=Eo(Lt,Et.mode,Pn),pt.return=Et,pt):(pt=K(pt,Lt),pt.return=Et,pt)}function ct(Et,pt,Lt,Pn){var pr=Lt.type;return pr===Le?pn(Et,pt,Lt.props.children,Pn,Lt.key):pt!==null&&(pt.elementType===pr||typeof pr=="object"&&pr!==null&&pr.$$typeof===St&&nh(pr)===pt.type)?(Pn=K(pt,Lt.props),Pn.ref=eh(Et,pt,Lt),Pn.return=Et,Pn):(Pn=To(Lt.type,Lt.key,Lt.props,null,Et.mode,Pn),Pn.ref=eh(Et,pt,Lt),Pn.return=Et,Pn)}function Vt(Et,pt,Lt,Pn){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==Lt.containerInfo||pt.stateNode.implementation!==Lt.implementation?(pt=Ys(Lt,Et.mode,Pn),pt.return=Et,pt):(pt=K(pt,Lt.children||[]),pt.return=Et,pt)}function pn(Et,pt,Lt,Pn,pr){return pt===null||pt.tag!==7?(pt=Us(Lt,Et.mode,Pn,pr),pt.return=Et,pt):(pt=K(pt,Lt),pt.return=Et,pt)}function yn(Et,pt,Lt){if(typeof pt=="string"&&pt!==""||typeof pt=="number")return pt=Eo(""+pt,Et.mode,Lt),pt.return=Et,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case ge:return Lt=To(pt.type,pt.key,pt.props,null,Et.mode,Lt),Lt.ref=eh(Et,null,pt),Lt.return=Et,Lt;case we:return pt=Ys(pt,Et.mode,Lt),pt.return=Et,pt;case St:var Pn=pt._init;return yn(Et,Pn(pt._payload),Lt)}if(js(pt)||hn(pt))return pt=Us(pt,Et.mode,Lt,null),pt.return=Et,pt;th(Et,pt)}return null}function vn(Et,pt,Lt,Pn){var pr=pt!==null?pt.key:null;if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return pr!==null?null:Je(Et,pt,""+Lt,Pn);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case ge:return Lt.key===pr?ct(Et,pt,Lt,Pn):null;case we:return Lt.key===pr?Vt(Et,pt,Lt,Pn):null;case St:return pr=Lt._init,vn(Et,pt,pr(Lt._payload),Pn)}if(js(Lt)||hn(Lt))return pr!==null?null:pn(Et,pt,Lt,Pn,null);th(Et,Lt)}return null}function Kn(Et,pt,Lt,Pn,pr){if(typeof Pn=="string"&&Pn!==""||typeof Pn=="number")return Et=Et.get(Lt)||null,Je(pt,Et,""+Pn,pr);if(typeof Pn=="object"&&Pn!==null){switch(Pn.$$typeof){case ge:return Et=Et.get(Pn.key===null?Lt:Pn.key)||null,ct(pt,Et,Pn,pr);case we:return Et=Et.get(Pn.key===null?Lt:Pn.key)||null,Vt(pt,Et,Pn,pr);case St:var Cr=Pn._init;return Kn(Et,pt,Lt,Cr(Pn._payload),pr)}if(js(Pn)||hn(Pn))return Et=Et.get(Lt)||null,pn(pt,Et,Pn,pr,null);th(pt,Pn)}return null}function ir(Et,pt,Lt,Pn){for(var pr=null,Cr=null,Pr=pt,Tr=pt=0,fo=null;Pr!==null&&Tr<Lt.length;Tr++){Pr.index>Tr?(fo=Pr,Pr=null):fo=Pr.sibling;var Ci=vn(Et,Pr,Lt[Tr],Pn);if(Ci===null){Pr===null&&(Pr=fo);break}v&&Pr&&Ci.alternate===null&&S(Et,Pr),pt=ae(Ci,pt,Tr),Cr===null?pr=Ci:Cr.sibling=Ci,Cr=Ci,Pr=fo}if(Tr===Lt.length)return R(Et,Pr),qi&&Ju(Et,Tr),pr;if(Pr===null){for(;Tr<Lt.length;Tr++)Pr=yn(Et,Lt[Tr],Pn),Pr!==null&&(pt=ae(Pr,pt,Tr),Cr===null?pr=Pr:Cr.sibling=Pr,Cr=Pr);return qi&&Ju(Et,Tr),pr}for(Pr=U(Et,Pr);Tr<Lt.length;Tr++)fo=Kn(Pr,Et,Tr,Lt[Tr],Pn),fo!==null&&(v&&fo.alternate!==null&&Pr.delete(fo.key===null?Tr:fo.key),pt=ae(fo,pt,Tr),Cr===null?pr=fo:Cr.sibling=fo,Cr=fo);return v&&Pr.forEach(function(xh){return S(Et,xh)}),qi&&Ju(Et,Tr),pr}function cr(Et,pt,Lt,Pn){var pr=hn(Lt);if(typeof pr!="function")throw Error(n(150));if(Lt=pr.call(Lt),Lt==null)throw Error(n(151));for(var Cr=pr=null,Pr=pt,Tr=pt=0,fo=null,Ci=Lt.next();Pr!==null&&!Ci.done;Tr++,Ci=Lt.next()){Pr.index>Tr?(fo=Pr,Pr=null):fo=Pr.sibling;var xh=vn(Et,Pr,Ci.value,Pn);if(xh===null){Pr===null&&(Pr=fo);break}v&&Pr&&xh.alternate===null&&S(Et,Pr),pt=ae(xh,pt,Tr),Cr===null?pr=xh:Cr.sibling=xh,Cr=xh,Pr=fo}if(Ci.done)return R(Et,Pr),qi&&Ju(Et,Tr),pr;if(Pr===null){for(;!Ci.done;Tr++,Ci=Lt.next())Ci=yn(Et,Ci.value,Pn),Ci!==null&&(pt=ae(Ci,pt,Tr),Cr===null?pr=Ci:Cr.sibling=Ci,Cr=Ci);return qi&&Ju(Et,Tr),pr}for(Pr=U(Et,Pr);!Ci.done;Tr++,Ci=Lt.next())Ci=Kn(Pr,Et,Tr,Ci.value,Pn),Ci!==null&&(v&&Ci.alternate!==null&&Pr.delete(Ci.key===null?Tr:Ci.key),pt=ae(Ci,pt,Tr),Cr===null?pr=Ci:Cr.sibling=Ci,Cr=Ci);return v&&Pr.forEach(function(dS){return S(Et,dS)}),qi&&Ju(Et,Tr),pr}function as(Et,pt,Lt,Pn){if(typeof Lt=="object"&&Lt!==null&&Lt.type===Le&&Lt.key===null&&(Lt=Lt.props.children),typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case ge:e:{for(var pr=Lt.key,Cr=pt;Cr!==null;){if(Cr.key===pr){if(pr=Lt.type,pr===Le){if(Cr.tag===7){R(Et,Cr.sibling),pt=K(Cr,Lt.props.children),pt.return=Et,Et=pt;break e}}else if(Cr.elementType===pr||typeof pr=="object"&&pr!==null&&pr.$$typeof===St&&nh(pr)===Cr.type){R(Et,Cr.sibling),pt=K(Cr,Lt.props),pt.ref=eh(Et,Cr,Lt),pt.return=Et,Et=pt;break e}R(Et,Cr);break}else S(Et,Cr);Cr=Cr.sibling}Lt.type===Le?(pt=Us(Lt.props.children,Et.mode,Pn,Lt.key),pt.return=Et,Et=pt):(Pn=To(Lt.type,Lt.key,Lt.props,null,Et.mode,Pn),Pn.ref=eh(Et,pt,Lt),Pn.return=Et,Et=Pn)}return Ee(Et);case we:e:{for(Cr=Lt.key;pt!==null;){if(pt.key===Cr)if(pt.tag===4&&pt.stateNode.containerInfo===Lt.containerInfo&&pt.stateNode.implementation===Lt.implementation){R(Et,pt.sibling),pt=K(pt,Lt.children||[]),pt.return=Et,Et=pt;break e}else{R(Et,pt);break}else S(Et,pt);pt=pt.sibling}pt=Ys(Lt,Et.mode,Pn),pt.return=Et,Et=pt}return Ee(Et);case St:return Cr=Lt._init,as(Et,pt,Cr(Lt._payload),Pn)}if(js(Lt))return ir(Et,pt,Lt,Pn);if(hn(Lt))return cr(Et,pt,Lt,Pn);th(Et,Lt)}return typeof Lt=="string"&&Lt!==""||typeof Lt=="number"?(Lt=""+Lt,pt!==null&&pt.tag===6?(R(Et,pt.sibling),pt=K(pt,Lt),pt.return=Et,Et=pt):(R(Et,pt),pt=Eo(Lt,Et.mode,Pn),pt.return=Et,Et=pt),Ee(Et)):R(Et,pt)}return as}var ba=C_(!0),Km=C_(!1),Gp=bl(null),rh=null,ru=null,el=null;function ih(){el=ru=rh=null}function Hl(v){var S=Gp.current;Bi(Gp),v._currentValue=S}function Mf(v,S,R){for(;v!==null;){var U=v.alternate;if((v.childLanes&S)!==S?(v.childLanes|=S,U!==null&&(U.childLanes|=S)):U!==null&&(U.childLanes&S)!==S&&(U.childLanes|=S),v===R)break;v=v.return}}function Sc(v,S){rh=v,el=ru=null,v=v.dependencies,v!==null&&v.firstContext!==null&&((v.lanes&S)!==0&&(So=!0),v.firstContext=null)}function Fo(v){var S=v._currentValue;if(el!==v)if(v={context:v,memoizedValue:S,next:null},ru===null){if(rh===null)throw Error(n(308));ru=v,rh.dependencies={lanes:0,firstContext:v}}else ru=ru.next=v;return S}var Sl=null;function dd(v){Sl===null?Sl=[v]:Sl.push(v)}function Jm(v,S,R,U){var K=S.interleaved;return K===null?(R.next=R,dd(S)):(R.next=K.next,K.next=R),S.interleaved=R,Bo(v,U)}function Bo(v,S){v.lanes|=S;var R=v.alternate;for(R!==null&&(R.lanes|=S),R=v,v=v.return;v!==null;)v.childLanes|=S,R=v.alternate,R!==null&&(R.childLanes|=S),R=v,v=v.return;return R.tag===3?R.stateNode:null}var wa=!1;function nn(v){v.updateQueue={baseState:v.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wp(v,S){v=v.updateQueue,S.updateQueue===v&&(S.updateQueue={baseState:v.baseState,firstBaseUpdate:v.firstBaseUpdate,lastBaseUpdate:v.lastBaseUpdate,shared:v.shared,effects:v.effects})}function lo(v,S){return{eventTime:v,lane:S,tag:0,payload:null,callback:null,next:null}}function Uo(v,S,R){var U=v.updateQueue;if(U===null)return null;if(U=U.shared,(w&2)!==0){var K=U.pending;return K===null?S.next=S:(S.next=K.next,K.next=S),U.pending=S,Bo(v,R)}return K=U.interleaved,K===null?(S.next=S,dd(U)):(S.next=K.next,K.next=S),U.interleaved=S,Bo(v,R)}function Tl(v,S,R){if(S=S.updateQueue,S!==null&&(S=S.shared,(R&4194240)!==0)){var U=S.lanes;U&=v.pendingLanes,R|=U,S.lanes=R,pa(v,R)}}function Cn(v,S){var R=v.updateQueue,U=v.alternate;if(U!==null&&(U=U.updateQueue,R===U)){var K=null,ae=null;if(R=R.firstBaseUpdate,R!==null){do{var Ee={eventTime:R.eventTime,lane:R.lane,tag:R.tag,payload:R.payload,callback:R.callback,next:null};ae===null?K=ae=Ee:ae=ae.next=Ee,R=R.next}while(R!==null);ae===null?K=ae=S:ae=ae.next=S}else K=ae=S;R={baseState:U.baseState,firstBaseUpdate:K,lastBaseUpdate:ae,shared:U.shared,effects:U.effects},v.updateQueue=R;return}v=R.lastBaseUpdate,v===null?R.firstBaseUpdate=S:v.next=S,R.lastBaseUpdate=S}function fd(v,S,R,U){var K=v.updateQueue;wa=!1;var ae=K.firstBaseUpdate,Ee=K.lastBaseUpdate,Je=K.shared.pending;if(Je!==null){K.shared.pending=null;var ct=Je,Vt=ct.next;ct.next=null,Ee===null?ae=Vt:Ee.next=Vt,Ee=ct;var pn=v.alternate;pn!==null&&(pn=pn.updateQueue,Je=pn.lastBaseUpdate,Je!==Ee&&(Je===null?pn.firstBaseUpdate=Vt:Je.next=Vt,pn.lastBaseUpdate=ct))}if(ae!==null){var yn=K.baseState;Ee=0,pn=Vt=ct=null,Je=ae;do{var vn=Je.lane,Kn=Je.eventTime;if((U&vn)===vn){pn!==null&&(pn=pn.next={eventTime:Kn,lane:0,tag:Je.tag,payload:Je.payload,callback:Je.callback,next:null});e:{var ir=v,cr=Je;switch(vn=S,Kn=R,cr.tag){case 1:if(ir=cr.payload,typeof ir=="function"){yn=ir.call(Kn,yn,vn);break e}yn=ir;break e;case 3:ir.flags=ir.flags&-65537|128;case 0:if(ir=cr.payload,vn=typeof ir=="function"?ir.call(Kn,yn,vn):ir,vn==null)break e;yn=Xt({},yn,vn);break e;case 2:wa=!0}}Je.callback!==null&&Je.lane!==0&&(v.flags|=64,vn=K.effects,vn===null?K.effects=[Je]:vn.push(Je))}else Kn={eventTime:Kn,lane:vn,tag:Je.tag,payload:Je.payload,callback:Je.callback,next:null},pn===null?(Vt=pn=Kn,ct=yn):pn=pn.next=Kn,Ee|=vn;if(Je=Je.next,Je===null){if(Je=K.shared.pending,Je===null)break;vn=Je,Je=vn.next,vn.next=null,K.lastBaseUpdate=vn,K.shared.pending=null}}while(!0);if(pn===null&&(ct=yn),K.baseState=ct,K.firstBaseUpdate=Vt,K.lastBaseUpdate=pn,S=K.shared.interleaved,S!==null){K=S;do Ee|=K.lane,K=K.next;while(K!==S)}else ae===null&&(K.shared.lanes=0);Y|=Ee,v.lanes=Ee,v.memoizedState=yn}}function Qm(v,S,R){if(v=S.effects,S.effects=null,v!==null)for(S=0;S<v.length;S++){var U=v[S],K=U.callback;if(K!==null){if(U.callback=null,U=R,typeof K!="function")throw Error(n(191,K));K.call(U)}}}var iu={},Sa=bl(iu),su=bl(iu),kf=bl(iu);function ou(v){if(v===iu)throw Error(n(174));return v}function eg(v,S){switch(Si(kf,S),Si(su,v),Si(Sa,iu),v=S.nodeType,v){case 9:case 11:S=(S=S.documentElement)?S.namespaceURI:zs(null,"");break;default:v=v===8?S.parentNode:S,S=v.namespaceURI||null,v=v.tagName,S=zs(S,v)}Bi(Sa),Si(Sa,S)}function pd(){Bi(Sa),Bi(su),Bi(kf)}function Vo(v){ou(kf.current);var S=ou(Sa.current),R=zs(S,v.type);S!==R&&(Si(su,v),Si(Sa,R))}function Rf(v){su.current===v&&(Bi(Sa),Bi(su))}var Qr=bl(0);function El(v){for(var S=v;S!==null;){if(S.tag===13){var R=S.memoizedState;if(R!==null&&(R=R.dehydrated,R===null||R.data==="$?"||R.data==="$!"))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var qp=[];function Of(){for(var v=0;v<qp.length;v++)qp[v]._workInProgressVersionPrimary=null;qp.length=0}var md=ye.ReactCurrentDispatcher,gd=ye.ReactCurrentBatchConfig,Ta=0,Ai=null,wr=null,rs=null,_d=!1,yd=!1,Ea=0,tg=0;function ms(){throw Error(n(321))}function Tc(v,S){if(S===null)return!1;for(var R=0;R<S.length&&R<v.length;R++)if(!ao(v[R],S[R]))return!1;return!0}function Ec(v,S,R,U,K,ae){if(Ta=ae,Ai=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,md.current=v===null||v.memoizedState===null?uu:ug,v=R(U,K),yd){ae=0;do{if(yd=!1,Ea=0,25<=ae)throw Error(n(301));ae+=1,rs=wr=null,S.updateQueue=null,md.current=Xp,v=R(U,K)}while(yd)}if(md.current=Gl,S=wr!==null&&wr.next!==null,Ta=0,rs=wr=Ai=null,_d=!1,S)throw Error(n(300));return v}function kt(){var v=Ea!==0;return Ea=0,v}function $t(){var v={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rs===null?Ai.memoizedState=rs=v:rs=rs.next=v,rs}function co(){if(wr===null){var v=Ai.alternate;v=v!==null?v.memoizedState:null}else v=wr.next;var S=rs===null?Ai.memoizedState:rs.next;if(S!==null)rs=S,wr=v;else{if(v===null)throw Error(n(310));wr=v,v={memoizedState:wr.memoizedState,baseState:wr.baseState,baseQueue:wr.baseQueue,queue:wr.queue,next:null},rs===null?Ai.memoizedState=rs=v:rs=rs.next=v}return rs}function di(v,S){return typeof S=="function"?S(v):S}function He(v){var S=co(),R=S.queue;if(R===null)throw Error(n(311));R.lastRenderedReducer=v;var U=wr,K=U.baseQueue,ae=R.pending;if(ae!==null){if(K!==null){var Ee=K.next;K.next=ae.next,ae.next=Ee}U.baseQueue=K=ae,R.pending=null}if(K!==null){ae=K.next,U=U.baseState;var Je=Ee=null,ct=null,Vt=ae;do{var pn=Vt.lane;if((Ta&pn)===pn)ct!==null&&(ct=ct.next={lane:0,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),U=Vt.hasEagerState?Vt.eagerState:v(U,Vt.action);else{var yn={lane:pn,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null};ct===null?(Je=ct=yn,Ee=U):ct=ct.next=yn,Ai.lanes|=pn,Y|=pn}Vt=Vt.next}while(Vt!==null&&Vt!==ae);ct===null?Ee=U:ct.next=Je,ao(U,S.memoizedState)||(So=!0),S.memoizedState=U,S.baseState=Ee,S.baseQueue=ct,R.lastRenderedState=U}if(v=R.interleaved,v!==null){K=v;do ae=K.lane,Ai.lanes|=ae,Y|=ae,K=K.next;while(K!==v)}else K===null&&(R.lanes=0);return[S.memoizedState,R.dispatch]}function vd(v){var S=co(),R=S.queue;if(R===null)throw Error(n(311));R.lastRenderedReducer=v;var U=R.dispatch,K=R.pending,ae=S.memoizedState;if(K!==null){R.pending=null;var Ee=K=K.next;do ae=v(ae,Ee.action),Ee=Ee.next;while(Ee!==K);ao(ae,S.memoizedState)||(So=!0),S.memoizedState=ae,S.baseQueue===null&&(S.baseState=ae),R.lastRenderedState=ae}return[ae,U]}function au(){}function Df(v,S){var R=Ai,U=co(),K=S(),ae=!ao(U.memoizedState,K);if(ae&&(U.memoizedState=K,So=!0),U=U.queue,Sd(tl.bind(null,R,U,v),[v]),U.getSnapshot!==S||ae||rs!==null&&rs.memoizedState.tag&1){if(R.flags|=2048,bd(9,ng.bind(null,R,U,K,S),void 0,null),A===null)throw Error(n(349));(Ta&30)!==0||xd(R,S,K)}return K}function xd(v,S,R){v.flags|=16384,v={getSnapshot:S,value:R},S=Ai.updateQueue,S===null?(S={lastEffect:null,stores:null},Ai.updateQueue=S,S.stores=[v]):(R=S.stores,R===null?S.stores=[v]:R.push(v))}function ng(v,S,R,U){S.value=R,S.getSnapshot=U,sh(S)&&rg(v)}function tl(v,S,R){return R(function(){sh(S)&&rg(v)})}function sh(v){var S=v.getSnapshot;v=v.value;try{var R=S();return!ao(v,R)}catch{return!0}}function rg(v){var S=Bo(v,1);S!==null&&Ye(S,v,1,-1)}function P_(v){var S=$t();return typeof v=="function"&&(v=v()),S.memoizedState=S.baseState=v,v={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:di,lastRenderedState:v},S.queue=v,v=v.dispatch=vr.bind(null,Ai,v),[S.memoizedState,v]}function bd(v,S,R,U){return v={tag:v,create:S,destroy:R,deps:U,next:null},S=Ai.updateQueue,S===null?(S={lastEffect:null,stores:null},Ai.updateQueue=S,S.lastEffect=v.next=v):(R=S.lastEffect,R===null?S.lastEffect=v.next=v:(U=R.next,R.next=v,v.next=U,S.lastEffect=v)),v}function Lf(){return co().memoizedState}function wd(v,S,R,U){var K=$t();Ai.flags|=v,K.memoizedState=bd(1|S,R,void 0,U===void 0?null:U)}function jf(v,S,R,U){var K=co();U=U===void 0?null:U;var ae=void 0;if(wr!==null){var Ee=wr.memoizedState;if(ae=Ee.destroy,U!==null&&Tc(U,Ee.deps)){K.memoizedState=bd(S,R,ae,U);return}}Ai.flags|=v,K.memoizedState=bd(1|S,R,ae,U)}function ig(v,S){return wd(8390656,8,v,S)}function Sd(v,S){return jf(2048,8,v,S)}function Td(v,S){return jf(4,2,v,S)}function oh(v,S){return jf(4,4,v,S)}function Zp(v,S){if(typeof S=="function")return v=v(),S(v),function(){S(null)};if(S!=null)return v=v(),S.current=v,function(){S.current=null}}function sg(v,S,R){return R=R!=null?R.concat([v]):null,jf(4,4,Zp.bind(null,S,v),R)}function og(){}function ag(v,S){var R=co();S=S===void 0?null:S;var U=R.memoizedState;return U!==null&&S!==null&&Tc(S,U[1])?U[0]:(R.memoizedState=[v,S],v)}function lg(v,S){var R=co();S=S===void 0?null:S;var U=R.memoizedState;return U!==null&&S!==null&&Tc(S,U[1])?U[0]:(v=v(),R.memoizedState=[v,S],v)}function Ws(v,S,R){return(Ta&21)===0?(v.baseState&&(v.baseState=!1,So=!0),v.memoizedState=R):(ao(R,S)||(R=_l(),Ai.lanes|=R,Y|=R,v.baseState=!0),S)}function lu(v,S){var R=ni;ni=R!==0&&4>R?R:4,v(!0);var U=gd.transition;gd.transition={};try{v(!1),S()}finally{ni=R,gd.transition=U}}function ah(){return co().memoizedState}function oi(v,S,R){var U=At(v);if(R={lane:U,action:R,hasEagerState:!1,eagerState:null,next:null},cg(v))Ac(S,R);else if(R=Jm(v,S,R,U),R!==null){var K=Qe();Ye(R,v,U,K),cu(R,S,U)}}function vr(v,S,R){var U=At(v),K={lane:U,action:R,hasEagerState:!1,eagerState:null,next:null};if(cg(v))Ac(S,K);else{var ae=v.alternate;if(v.lanes===0&&(ae===null||ae.lanes===0)&&(ae=S.lastRenderedReducer,ae!==null))try{var Ee=S.lastRenderedState,Je=ae(Ee,R);if(K.hasEagerState=!0,K.eagerState=Je,ao(Je,Ee)){var ct=S.interleaved;ct===null?(K.next=K,dd(S)):(K.next=ct.next,ct.next=K),S.interleaved=K;return}}catch{}finally{}R=Jm(v,S,K,U),R!==null&&(K=Qe(),Ye(R,v,U,K),cu(R,S,U))}}function cg(v){var S=v.alternate;return v===Ai||S!==null&&S===Ai}function Ac(v,S){yd=_d=!0;var R=v.pending;R===null?S.next=S:(S.next=R.next,R.next=S),v.pending=S}function cu(v,S,R){if((R&4194240)!==0){var U=S.lanes;U&=v.pendingLanes,R|=U,S.lanes=R,pa(v,R)}}var Gl={readContext:Fo,useCallback:ms,useContext:ms,useEffect:ms,useImperativeHandle:ms,useInsertionEffect:ms,useLayoutEffect:ms,useMemo:ms,useReducer:ms,useRef:ms,useState:ms,useDebugValue:ms,useDeferredValue:ms,useTransition:ms,useMutableSource:ms,useSyncExternalStore:ms,useId:ms,unstable_isNewReconciler:!1},uu={readContext:Fo,useCallback:function(v,S){return $t().memoizedState=[v,S===void 0?null:S],v},useContext:Fo,useEffect:ig,useImperativeHandle:function(v,S,R){return R=R!=null?R.concat([v]):null,wd(4194308,4,Zp.bind(null,S,v),R)},useLayoutEffect:function(v,S){return wd(4194308,4,v,S)},useInsertionEffect:function(v,S){return wd(4,2,v,S)},useMemo:function(v,S){var R=$t();return S=S===void 0?null:S,v=v(),R.memoizedState=[v,S],v},useReducer:function(v,S,R){var U=$t();return S=R!==void 0?R(S):S,U.memoizedState=U.baseState=S,v={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:v,lastRenderedState:S},U.queue=v,v=v.dispatch=oi.bind(null,Ai,v),[U.memoizedState,v]},useRef:function(v){var S=$t();return v={current:v},S.memoizedState=v},useState:P_,useDebugValue:og,useDeferredValue:function(v){return $t().memoizedState=v},useTransition:function(){var v=P_(!1),S=v[0];return v=lu.bind(null,v[1]),$t().memoizedState=v,[S,v]},useMutableSource:function(){},useSyncExternalStore:function(v,S,R){var U=Ai,K=$t();if(qi){if(R===void 0)throw Error(n(407));R=R()}else{if(R=S(),A===null)throw Error(n(349));(Ta&30)!==0||xd(U,S,R)}K.memoizedState=R;var ae={value:R,getSnapshot:S};return K.queue=ae,ig(tl.bind(null,U,ae,v),[v]),U.flags|=2048,bd(9,ng.bind(null,U,ae,R,S),void 0,null),R},useId:function(){var v=$t(),S=A.identifierPrefix;if(qi){var R=bc,U=Qa;R=(U&~(1<<32-Ns(U)-1)).toString(32)+R,S=":"+S+"R"+R,R=Ea++,0<R&&(S+="H"+R.toString(32)),S+=":"}else R=tg++,S=":"+S+"r"+R.toString(32)+":";return v.memoizedState=S},unstable_isNewReconciler:!1},ug={readContext:Fo,useCallback:ag,useContext:Fo,useEffect:Sd,useImperativeHandle:sg,useInsertionEffect:Td,useLayoutEffect:oh,useMemo:lg,useReducer:He,useRef:Lf,useState:function(){return He(di)},useDebugValue:og,useDeferredValue:function(v){var S=co();return Ws(S,wr.memoizedState,v)},useTransition:function(){var v=He(di)[0],S=co().memoizedState;return[v,S]},useMutableSource:au,useSyncExternalStore:Df,useId:ah,unstable_isNewReconciler:!1},Xp={readContext:Fo,useCallback:ag,useContext:Fo,useEffect:Sd,useImperativeHandle:sg,useInsertionEffect:Td,useLayoutEffect:oh,useMemo:lg,useReducer:vd,useRef:Lf,useState:function(){return vd(di)},useDebugValue:og,useDeferredValue:function(v){var S=co();return wr===null?S.memoizedState=v:Ws(S,wr.memoizedState,v)},useTransition:function(){var v=vd(di)[0],S=co().memoizedState;return[v,S]},useMutableSource:au,useSyncExternalStore:Df,useId:ah,unstable_isNewReconciler:!1};function Aa(v,S){if(v&&v.defaultProps){S=Xt({},S),v=v.defaultProps;for(var R in v)S[R]===void 0&&(S[R]=v[R]);return S}return S}function Ed(v,S,R,U){S=v.memoizedState,R=R(U,S),R=R==null?S:Xt({},S,R),v.memoizedState=R,v.lanes===0&&(v.updateQueue.baseState=R)}var qs={isMounted:function(v){return(v=v._reactInternals)?_t(v)===v:!1},enqueueSetState:function(v,S,R){v=v._reactInternals;var U=Qe(),K=At(v),ae=lo(U,K);ae.payload=S,R!=null&&(ae.callback=R),S=Uo(v,ae,K),S!==null&&(Ye(S,v,K,U),Tl(S,v,K))},enqueueReplaceState:function(v,S,R){v=v._reactInternals;var U=Qe(),K=At(v),ae=lo(U,K);ae.tag=1,ae.payload=S,R!=null&&(ae.callback=R),S=Uo(v,ae,K),S!==null&&(Ye(S,v,K,U),Tl(S,v,K))},enqueueForceUpdate:function(v,S){v=v._reactInternals;var R=Qe(),U=At(v),K=lo(R,U);K.tag=2,S!=null&&(K.callback=S),S=Uo(v,K,U),S!==null&&(Ye(S,v,U,R),Tl(S,v,U))}};function Cc(v,S,R,U,K,ae,Ee){return v=v.stateNode,typeof v.shouldComponentUpdate=="function"?v.shouldComponentUpdate(U,ae,Ee):S.prototype&&S.prototype.isPureReactComponent?!pf(R,U)||!pf(K,ae):!0}function lh(v,S,R){var U=!1,K=Ul,ae=S.contextType;return typeof ae=="object"&&ae!==null?ae=Fo(ae):(K=No(S)?va:Hs.current,U=S.contextTypes,ae=(U=U!=null)?Xa(v,K):Ul),S=new S(R,ae),v.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=qs,v.stateNode=S,S._reactInternals=v,U&&(v=v.stateNode,v.__reactInternalMemoizedUnmaskedChildContext=K,v.__reactInternalMemoizedMaskedChildContext=ae),S}function zf(v,S,R,U){v=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(R,U),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(R,U),S.state!==v&&qs.enqueueReplaceState(S,S.state,null)}function Nf(v,S,R,U){var K=v.stateNode;K.props=R,K.state=v.memoizedState,K.refs={},nn(v);var ae=S.contextType;typeof ae=="object"&&ae!==null?K.context=Fo(ae):(ae=No(S)?va:Hs.current,K.context=Xa(v,ae)),K.state=v.memoizedState,ae=S.getDerivedStateFromProps,typeof ae=="function"&&(Ed(v,S,ae,R),K.state=v.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(S=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),S!==K.state&&qs.enqueueReplaceState(K,K.state,null),fd(v,R,K,U),K.state=v.memoizedState),typeof K.componentDidMount=="function"&&(v.flags|=4194308)}function hu(v,S){try{var R="",U=S;do R+=fr(U),U=U.return;while(U);var K=R}catch(ae){K=`
Error generating stack: `+ae.message+`
`+ae.stack}return{value:v,source:S,stack:K,digest:null}}function Ca(v,S,R){return{value:v,source:null,stack:R??null,digest:S??null}}function du(v,S){try{console.error(S.value)}catch(R){setTimeout(function(){throw R})}}var is=typeof WeakMap=="function"?WeakMap:Map;function ch(v,S,R){R=lo(-1,R),R.tag=3,R.payload={element:null};var U=S.value;return R.callback=function(){Pe||(Pe=!0,Ae=U),du(v,S)},R}function Ff(v,S,R){R=lo(-1,R),R.tag=3;var U=v.type.getDerivedStateFromError;if(typeof U=="function"){var K=S.value;R.payload=function(){return U(K)},R.callback=function(){du(v,S)}}var ae=v.stateNode;return ae!==null&&typeof ae.componentDidCatch=="function"&&(R.callback=function(){du(v,S),typeof U!="function"&&(Ie===null?Ie=new Set([this]):Ie.add(this));var Ee=S.stack;this.componentDidCatch(S.value,{componentStack:Ee!==null?Ee:""})}),R}function Yp(v,S,R){var U=v.pingCache;if(U===null){U=v.pingCache=new is;var K=new Set;U.set(S,K)}else K=U.get(S),K===void 0&&(K=new Set,U.set(S,K));K.has(R)||(K.add(R),v=fi.bind(null,v,S,R),S.then(v,v))}function Kp(v){do{var S;if((S=v.tag===13)&&(S=v.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return v;v=v.return}while(v!==null);return null}function ss(v,S,R,U,K){return(v.mode&1)===0?(v===S?v.flags|=65536:(v.flags|=128,R.flags|=131072,R.flags&=-52805,R.tag===1&&(R.alternate===null?R.tag=17:(S=lo(-1,1),S.tag=2,Uo(R,S,1))),R.lanes|=1),v):(v.flags|=65536,v.lanes=K,v)}var Bf=ye.ReactCurrentOwner,So=!1;function Fs(v,S,R,U){S.child=v===null?Km(S,null,R,U):ba(S,v.child,R,U)}function fu(v,S,R,U,K){R=R.render;var ae=S.ref;return Sc(S,K),U=Ec(v,S,R,U,ae,K),R=kt(),v!==null&&!So?(S.updateQueue=v.updateQueue,S.flags&=-2053,v.lanes&=~K,Wl(v,S,K)):(qi&&R&&Cf(S),S.flags|=1,Fs(v,S,U,K),S.child)}function Jp(v,S,R,U,K){if(v===null){var ae=R.type;return typeof ae=="function"&&!ai(ae)&&ae.defaultProps===void 0&&R.compare===null&&R.defaultProps===void 0?(S.tag=15,S.type=ae,Uf(v,S,ae,U,K)):(v=To(R.type,null,U,S,S.mode,K),v.ref=S.ref,v.return=S,S.child=v)}if(ae=v.child,(v.lanes&K)===0){var Ee=ae.memoizedProps;if(R=R.compare,R=R!==null?R:pf,R(Ee,U)&&v.ref===S.ref)return Wl(v,S,K)}return S.flags|=1,v=Gi(ae,U),v.ref=S.ref,v.return=S,S.child=v}function Uf(v,S,R,U,K){if(v!==null){var ae=v.memoizedProps;if(pf(ae,U)&&v.ref===S.ref)if(So=!1,S.pendingProps=U=ae,(v.lanes&K)!==0)(v.flags&131072)!==0&&(So=!0);else return S.lanes=v.lanes,Wl(v,S,K)}return Cd(v,S,R,U,K)}function Ad(v,S,R){var U=S.pendingProps,K=U.children,ae=v!==null?v.memoizedState:null;if(U.mode==="hidden")if((S.mode&1)===0)S.memoizedState={baseLanes:0,cachePool:null,transitions:null},Si(B,z),z|=R;else{if((R&1073741824)===0)return v=ae!==null?ae.baseLanes|R:R,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:v,cachePool:null,transitions:null},S.updateQueue=null,Si(B,z),z|=v,null;S.memoizedState={baseLanes:0,cachePool:null,transitions:null},U=ae!==null?ae.baseLanes:R,Si(B,z),z|=U}else ae!==null?(U=ae.baseLanes|R,S.memoizedState=null):U=R,Si(B,z),z|=U;return Fs(v,S,K,R),S.child}function uh(v,S){var R=S.ref;(v===null&&R!==null||v!==null&&v.ref!==R)&&(S.flags|=512,S.flags|=2097152)}function Cd(v,S,R,U,K){var ae=No(R)?va:Hs.current;return ae=Xa(S,ae),Sc(S,K),R=Ec(v,S,R,U,ae,K),U=kt(),v!==null&&!So?(S.updateQueue=v.updateQueue,S.flags&=-2053,v.lanes&=~K,Wl(v,S,K)):(qi&&U&&Cf(S),S.flags|=1,Fs(v,S,R,K),S.child)}function Vf(v,S,R,U,K){if(No(R)){var ae=!0;Wu(S)}else ae=!1;if(Sc(S,K),S.stateNode===null)Id(v,S),lh(S,R,U),Nf(S,R,U,K),U=!0;else if(v===null){var Ee=S.stateNode,Je=S.memoizedProps;Ee.props=Je;var ct=Ee.context,Vt=R.contextType;typeof Vt=="object"&&Vt!==null?Vt=Fo(Vt):(Vt=No(R)?va:Hs.current,Vt=Xa(S,Vt));var pn=R.getDerivedStateFromProps,yn=typeof pn=="function"||typeof Ee.getSnapshotBeforeUpdate=="function";yn||typeof Ee.UNSAFE_componentWillReceiveProps!="function"&&typeof Ee.componentWillReceiveProps!="function"||(Je!==U||ct!==Vt)&&zf(S,Ee,U,Vt),wa=!1;var vn=S.memoizedState;Ee.state=vn,fd(S,U,Ee,K),ct=S.memoizedState,Je!==U||vn!==ct||ta.current||wa?(typeof pn=="function"&&(Ed(S,R,pn,U),ct=S.memoizedState),(Je=wa||Cc(S,R,Je,U,vn,ct,Vt))?(yn||typeof Ee.UNSAFE_componentWillMount!="function"&&typeof Ee.componentWillMount!="function"||(typeof Ee.componentWillMount=="function"&&Ee.componentWillMount(),typeof Ee.UNSAFE_componentWillMount=="function"&&Ee.UNSAFE_componentWillMount()),typeof Ee.componentDidMount=="function"&&(S.flags|=4194308)):(typeof Ee.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=U,S.memoizedState=ct),Ee.props=U,Ee.state=ct,Ee.context=Vt,U=Je):(typeof Ee.componentDidMount=="function"&&(S.flags|=4194308),U=!1)}else{Ee=S.stateNode,Wp(v,S),Je=S.memoizedProps,Vt=S.type===S.elementType?Je:Aa(S.type,Je),Ee.props=Vt,yn=S.pendingProps,vn=Ee.context,ct=R.contextType,typeof ct=="object"&&ct!==null?ct=Fo(ct):(ct=No(R)?va:Hs.current,ct=Xa(S,ct));var Kn=R.getDerivedStateFromProps;(pn=typeof Kn=="function"||typeof Ee.getSnapshotBeforeUpdate=="function")||typeof Ee.UNSAFE_componentWillReceiveProps!="function"&&typeof Ee.componentWillReceiveProps!="function"||(Je!==yn||vn!==ct)&&zf(S,Ee,U,ct),wa=!1,vn=S.memoizedState,Ee.state=vn,fd(S,U,Ee,K);var ir=S.memoizedState;Je!==yn||vn!==ir||ta.current||wa?(typeof Kn=="function"&&(Ed(S,R,Kn,U),ir=S.memoizedState),(Vt=wa||Cc(S,R,Vt,U,vn,ir,ct)||!1)?(pn||typeof Ee.UNSAFE_componentWillUpdate!="function"&&typeof Ee.componentWillUpdate!="function"||(typeof Ee.componentWillUpdate=="function"&&Ee.componentWillUpdate(U,ir,ct),typeof Ee.UNSAFE_componentWillUpdate=="function"&&Ee.UNSAFE_componentWillUpdate(U,ir,ct)),typeof Ee.componentDidUpdate=="function"&&(S.flags|=4),typeof Ee.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof Ee.componentDidUpdate!="function"||Je===v.memoizedProps&&vn===v.memoizedState||(S.flags|=4),typeof Ee.getSnapshotBeforeUpdate!="function"||Je===v.memoizedProps&&vn===v.memoizedState||(S.flags|=1024),S.memoizedProps=U,S.memoizedState=ir),Ee.props=U,Ee.state=ir,Ee.context=ct,U=Vt):(typeof Ee.componentDidUpdate!="function"||Je===v.memoizedProps&&vn===v.memoizedState||(S.flags|=4),typeof Ee.getSnapshotBeforeUpdate!="function"||Je===v.memoizedProps&&vn===v.memoizedState||(S.flags|=1024),U=!1)}return $f(v,S,R,U,ae,K)}function $f(v,S,R,U,K,ae){uh(v,S);var Ee=(S.flags&128)!==0;if(!U&&!Ee)return K&&Bp(S,R,!1),Wl(v,S,ae);U=S.stateNode,Bf.current=S;var Je=Ee&&typeof R.getDerivedStateFromError!="function"?null:U.render();return S.flags|=1,v!==null&&Ee?(S.child=ba(S,v.child,null,ae),S.child=ba(S,null,Je,ae)):Fs(v,S,Je,ae),S.memoizedState=U.state,K&&Bp(S,R,!0),S.child}function hh(v){var S=v.stateNode;S.pendingContext?Af(v,S.pendingContext,S.pendingContext!==S.context):S.context&&Af(v,S.context,!1),eg(v,S.containerInfo)}function dh(v,S,R,U,K){return nu(),hd(K),S.flags|=256,Fs(v,S,R,U),S.child}var Pd={dehydrated:null,treeContext:null,retryLane:0};function Qp(v){return{baseLanes:v,cachePool:null,transitions:null}}function em(v,S,R){var U=S.pendingProps,K=Qr.current,ae=!1,Ee=(S.flags&128)!==0,Je;if((Je=Ee)||(Je=v!==null&&v.memoizedState===null?!1:(K&2)!==0),Je?(ae=!0,S.flags&=-129):(v===null||v.memoizedState!==null)&&(K|=1),Si(Qr,K&1),v===null)return $l(S),v=S.memoizedState,v!==null&&(v=v.dehydrated,v!==null)?((S.mode&1)===0?S.lanes=1:v.data==="$!"?S.lanes=8:S.lanes=1073741824,null):(Ee=U.children,v=U.fallback,ae?(U=S.mode,ae=S.child,Ee={mode:"hidden",children:Ee},(U&1)===0&&ae!==null?(ae.childLanes=0,ae.pendingProps=Ee):ae=ho(Ee,U,0,null),v=Us(v,U,R,null),ae.return=S,v.return=S,ae.sibling=v,S.child=ae,S.child.memoizedState=Qp(R),S.memoizedState=Pd,v):tm(S,Ee));if(K=v.memoizedState,K!==null&&(Je=K.dehydrated,Je!==null))return I_(v,S,Ee,U,Je,K,R);if(ae){ae=U.fallback,Ee=S.mode,K=v.child,Je=K.sibling;var ct={mode:"hidden",children:U.children};return(Ee&1)===0&&S.child!==K?(U=S.child,U.childLanes=0,U.pendingProps=ct,S.deletions=null):(U=Gi(K,ct),U.subtreeFlags=K.subtreeFlags&14680064),Je!==null?ae=Gi(Je,ae):(ae=Us(ae,Ee,R,null),ae.flags|=2),ae.return=S,U.return=S,U.sibling=ae,S.child=U,U=ae,ae=S.child,Ee=v.child.memoizedState,Ee=Ee===null?Qp(R):{baseLanes:Ee.baseLanes|R,cachePool:null,transitions:Ee.transitions},ae.memoizedState=Ee,ae.childLanes=v.childLanes&~R,S.memoizedState=Pd,U}return ae=v.child,v=ae.sibling,U=Gi(ae,{mode:"visible",children:U.children}),(S.mode&1)===0&&(U.lanes=R),U.return=S,U.sibling=null,v!==null&&(R=S.deletions,R===null?(S.deletions=[v],S.flags|=16):R.push(v)),S.child=U,S.memoizedState=null,U}function tm(v,S){return S=ho({mode:"visible",children:S},v.mode,0,null),S.return=v,v.child=S}function fh(v,S,R,U){return U!==null&&hd(U),ba(S,v.child,null,R),v=tm(S,S.pendingProps.children),v.flags|=2,S.memoizedState=null,v}function I_(v,S,R,U,K,ae,Ee){if(R)return S.flags&256?(S.flags&=-257,U=Ca(Error(n(422))),fh(v,S,Ee,U)):S.memoizedState!==null?(S.child=v.child,S.flags|=128,null):(ae=U.fallback,K=S.mode,U=ho({mode:"visible",children:U.children},K,0,null),ae=Us(ae,K,Ee,null),ae.flags|=2,U.return=S,ae.return=S,U.sibling=ae,S.child=U,(S.mode&1)!==0&&ba(S,v.child,null,Ee),S.child.memoizedState=Qp(Ee),S.memoizedState=Pd,ae);if((S.mode&1)===0)return fh(v,S,Ee,null);if(K.data==="$!"){if(U=K.nextSibling&&K.nextSibling.dataset,U)var Je=U.dgst;return U=Je,ae=Error(n(419)),U=Ca(ae,U,void 0),fh(v,S,Ee,U)}if(Je=(Ee&v.childLanes)!==0,So||Je){if(U=A,U!==null){switch(Ee&-Ee){case 4:K=2;break;case 16:K=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:K=32;break;case 536870912:K=268435456;break;default:K=0}K=(K&(U.suspendedLanes|Ee))!==0?0:K,K!==0&&K!==ae.retryLane&&(ae.retryLane=K,Bo(v,K),Ye(U,v,K,-1))}return Un(),U=Ca(Error(n(421))),fh(v,S,Ee,U)}return K.data==="$?"?(S.flags|=128,S.child=v.child,S=gs.bind(null,v),K._reactRetry=S,null):(v=ae.treeContext,na=_a(K.nextSibling),Gs=S,qi=!0,xa=null,v!==null&&(Ka[Ja++]=Qa,Ka[Ja++]=bc,Ka[Ja++]=Ku,Qa=v.id,bc=v.overflow,Ku=S),S=tm(S,U.children),S.flags|=4096,S)}function hg(v,S,R){v.lanes|=S;var U=v.alternate;U!==null&&(U.lanes|=S),Mf(v.return,S,R)}function nm(v,S,R,U,K){var ae=v.memoizedState;ae===null?v.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:U,tail:R,tailMode:K}:(ae.isBackwards=S,ae.rendering=null,ae.renderingStartTime=0,ae.last=U,ae.tail=R,ae.tailMode=K)}function dg(v,S,R){var U=S.pendingProps,K=U.revealOrder,ae=U.tail;if(Fs(v,S,U.children,R),U=Qr.current,(U&2)!==0)U=U&1|2,S.flags|=128;else{if(v!==null&&(v.flags&128)!==0)e:for(v=S.child;v!==null;){if(v.tag===13)v.memoizedState!==null&&hg(v,R,S);else if(v.tag===19)hg(v,R,S);else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===S)break e;for(;v.sibling===null;){if(v.return===null||v.return===S)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}U&=1}if(Si(Qr,U),(S.mode&1)===0)S.memoizedState=null;else switch(K){case"forwards":for(R=S.child,K=null;R!==null;)v=R.alternate,v!==null&&El(v)===null&&(K=R),R=R.sibling;R=K,R===null?(K=S.child,S.child=null):(K=R.sibling,R.sibling=null),nm(S,!1,K,R,ae);break;case"backwards":for(R=null,K=S.child,S.child=null;K!==null;){if(v=K.alternate,v!==null&&El(v)===null){S.child=K;break}v=K.sibling,K.sibling=R,R=K,K=v}nm(S,!0,R,null,ae);break;case"together":nm(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Id(v,S){(S.mode&1)===0&&v!==null&&(v.alternate=null,S.alternate=null,S.flags|=2)}function Wl(v,S,R){if(v!==null&&(S.dependencies=v.dependencies),Y|=S.lanes,(R&S.childLanes)===0)return null;if(v!==null&&S.child!==v.child)throw Error(n(153));if(S.child!==null){for(v=S.child,R=Gi(v,v.pendingProps),S.child=R,R.return=S;v.sibling!==null;)v=v.sibling,R=R.sibling=Gi(v,v.pendingProps),R.return=S;R.sibling=null}return S.child}function M_(v,S,R){switch(S.tag){case 3:hh(S),nu();break;case 5:Vo(S);break;case 1:No(S.type)&&Wu(S);break;case 4:eg(S,S.stateNode.containerInfo);break;case 10:var U=S.type._context,K=S.memoizedProps.value;Si(Gp,U._currentValue),U._currentValue=K;break;case 13:if(U=S.memoizedState,U!==null)return U.dehydrated!==null?(Si(Qr,Qr.current&1),S.flags|=128,null):(R&S.child.childLanes)!==0?em(v,S,R):(Si(Qr,Qr.current&1),v=Wl(v,S,R),v!==null?v.sibling:null);Si(Qr,Qr.current&1);break;case 19:if(U=(R&S.childLanes)!==0,(v.flags&128)!==0){if(U)return dg(v,S,R);S.flags|=128}if(K=S.memoizedState,K!==null&&(K.rendering=null,K.tail=null,K.lastEffect=null),Si(Qr,Qr.current),U)break;return null;case 22:case 23:return S.lanes=0,Ad(v,S,R)}return Wl(v,S,R)}var fg,rm,k_,R_;fg=function(v,S){for(var R=S.child;R!==null;){if(R.tag===5||R.tag===6)v.appendChild(R.stateNode);else if(R.tag!==4&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===S)break;for(;R.sibling===null;){if(R.return===null||R.return===S)return;R=R.return}R.sibling.return=R.return,R=R.sibling}},rm=function(){},k_=function(v,S,R,U){var K=v.memoizedProps;if(K!==U){v=S.stateNode,ou(Sa.current);var ae=null;switch(R){case"input":K=Hn(v,K),U=Hn(v,U),ae=[];break;case"select":K=Xt({},K,{value:void 0}),U=Xt({},U,{value:void 0}),ae=[];break;case"textarea":K=ha(v,K),U=ha(v,U),ae=[];break;default:typeof K.onClick!="function"&&typeof U.onClick=="function"&&(v.onclick=$u)}ml(R,U);var Ee;R=null;for(Vt in K)if(!U.hasOwnProperty(Vt)&&K.hasOwnProperty(Vt)&&K[Vt]!=null)if(Vt==="style"){var Je=K[Vt];for(Ee in Je)Je.hasOwnProperty(Ee)&&(R||(R={}),R[Ee]="")}else Vt!=="dangerouslySetInnerHTML"&&Vt!=="children"&&Vt!=="suppressContentEditableWarning"&&Vt!=="suppressHydrationWarning"&&Vt!=="autoFocus"&&(u.hasOwnProperty(Vt)?ae||(ae=[]):(ae=ae||[]).push(Vt,null));for(Vt in U){var ct=U[Vt];if(Je=K!=null?K[Vt]:void 0,U.hasOwnProperty(Vt)&&ct!==Je&&(ct!=null||Je!=null))if(Vt==="style")if(Je){for(Ee in Je)!Je.hasOwnProperty(Ee)||ct&&ct.hasOwnProperty(Ee)||(R||(R={}),R[Ee]="");for(Ee in ct)ct.hasOwnProperty(Ee)&&Je[Ee]!==ct[Ee]&&(R||(R={}),R[Ee]=ct[Ee])}else R||(ae||(ae=[]),ae.push(Vt,R)),R=ct;else Vt==="dangerouslySetInnerHTML"?(ct=ct?ct.__html:void 0,Je=Je?Je.__html:void 0,ct!=null&&Je!==ct&&(ae=ae||[]).push(Vt,ct)):Vt==="children"?typeof ct!="string"&&typeof ct!="number"||(ae=ae||[]).push(Vt,""+ct):Vt!=="suppressContentEditableWarning"&&Vt!=="suppressHydrationWarning"&&(u.hasOwnProperty(Vt)?(ct!=null&&Vt==="onScroll"&&Ki("scroll",v),ae||Je===ct||(ae=[])):(ae=ae||[]).push(Vt,ct))}R&&(ae=ae||[]).push("style",R);var Vt=ae;(S.updateQueue=Vt)&&(S.flags|=4)}},R_=function(v,S,R,U){R!==U&&(S.flags|=4)};function Hf(v,S){if(!qi)switch(v.tailMode){case"hidden":S=v.tail;for(var R=null;S!==null;)S.alternate!==null&&(R=S),S=S.sibling;R===null?v.tail=null:R.sibling=null;break;case"collapsed":R=v.tail;for(var U=null;R!==null;)R.alternate!==null&&(U=R),R=R.sibling;U===null?S||v.tail===null?v.tail=null:v.tail.sibling=null:U.sibling=null}}function Rr(v){var S=v.alternate!==null&&v.alternate.child===v.child,R=0,U=0;if(S)for(var K=v.child;K!==null;)R|=K.lanes|K.childLanes,U|=K.subtreeFlags&14680064,U|=K.flags&14680064,K.return=v,K=K.sibling;else for(K=v.child;K!==null;)R|=K.lanes|K.childLanes,U|=K.subtreeFlags,U|=K.flags,K.return=v,K=K.sibling;return v.subtreeFlags|=U,v.childLanes=R,S}function Gf(v,S,R){var U=S.pendingProps;switch(Pf(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(S),null;case 1:return No(S.type)&&wo(),Rr(S),null;case 3:return U=S.stateNode,pd(),Bi(ta),Bi(Hs),Of(),U.pendingContext&&(U.context=U.pendingContext,U.pendingContext=null),(v===null||v.child===null)&&(Qu(S)?S.flags|=4:v===null||v.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,xa!==null&&(vt(xa),xa=null))),rm(v,S),Rr(S),null;case 5:Rf(S);var K=ou(kf.current);if(R=S.type,v!==null&&S.stateNode!=null)k_(v,S,R,U,K),v.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!U){if(S.stateNode===null)throw Error(n(166));return Rr(S),null}if(v=ou(Sa.current),Qu(S)){U=S.stateNode,R=S.type;var ae=S.memoizedProps;switch(U[Za]=S,U[Jc]=ae,v=(S.mode&1)!==0,R){case"dialog":Ki("cancel",U),Ki("close",U);break;case"iframe":case"object":case"embed":Ki("load",U);break;case"video":case"audio":for(K=0;K<Bl.length;K++)Ki(Bl[K],U);break;case"source":Ki("error",U);break;case"img":case"image":case"link":Ki("error",U),Ki("load",U);break;case"details":Ki("toggle",U);break;case"input":nr(U,ae),Ki("invalid",U);break;case"select":U._wrapperState={wasMultiple:!!ae.multiple},Ki("invalid",U);break;case"textarea":ja(U,ae),Ki("invalid",U)}ml(R,ae),K=null;for(var Ee in ae)if(ae.hasOwnProperty(Ee)){var Je=ae[Ee];Ee==="children"?typeof Je=="string"?U.textContent!==Je&&(ae.suppressHydrationWarning!==!0&&od(U.textContent,Je,v),K=["children",Je]):typeof Je=="number"&&U.textContent!==""+Je&&(ae.suppressHydrationWarning!==!0&&od(U.textContent,Je,v),K=["children",""+Je]):u.hasOwnProperty(Ee)&&Je!=null&&Ee==="onScroll"&&Ki("scroll",U)}switch(R){case"input":mr(U),si(U,ae,!0);break;case"textarea":mr(U),Na(U);break;case"select":case"option":break;default:typeof ae.onClick=="function"&&(U.onclick=$u)}U=K,S.updateQueue=U,U!==null&&(S.flags|=4)}else{Ee=K.nodeType===9?K:K.ownerDocument,v==="http://www.w3.org/1999/xhtml"&&(v=Es(R)),v==="http://www.w3.org/1999/xhtml"?R==="script"?(v=Ee.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild)):typeof U.is=="string"?v=Ee.createElement(R,{is:U.is}):(v=Ee.createElement(R),R==="select"&&(Ee=v,U.multiple?Ee.multiple=!0:U.size&&(Ee.size=U.size))):v=Ee.createElementNS(v,R),v[Za]=S,v[Jc]=U,fg(v,S,!1,!1),S.stateNode=v;e:{switch(Ee=lc(R,U),R){case"dialog":Ki("cancel",v),Ki("close",v),K=U;break;case"iframe":case"object":case"embed":Ki("load",v),K=U;break;case"video":case"audio":for(K=0;K<Bl.length;K++)Ki(Bl[K],v);K=U;break;case"source":Ki("error",v),K=U;break;case"img":case"image":case"link":Ki("error",v),Ki("load",v),K=U;break;case"details":Ki("toggle",v),K=U;break;case"input":nr(v,U),K=Hn(v,U),Ki("invalid",v);break;case"option":K=U;break;case"select":v._wrapperState={wasMultiple:!!U.multiple},K=Xt({},U,{value:void 0}),Ki("invalid",v);break;case"textarea":ja(v,U),K=ha(v,U),Ki("invalid",v);break;default:K=U}ml(R,K),Je=K;for(ae in Je)if(Je.hasOwnProperty(ae)){var ct=Je[ae];ae==="style"?ac(v,ct):ae==="dangerouslySetInnerHTML"?(ct=ct?ct.__html:void 0,ct!=null&&Fa(v,ct)):ae==="children"?typeof ct=="string"?(R!=="textarea"||ct!=="")&&no(v,ct):typeof ct=="number"&&no(v,""+ct):ae!=="suppressContentEditableWarning"&&ae!=="suppressHydrationWarning"&&ae!=="autoFocus"&&(u.hasOwnProperty(ae)?ct!=null&&ae==="onScroll"&&Ki("scroll",v):ct!=null&&ue(v,ae,ct,Ee))}switch(R){case"input":mr(v),si(v,U,!1);break;case"textarea":mr(v),Na(v);break;case"option":U.value!=null&&v.setAttribute("value",""+En(U.value));break;case"select":v.multiple=!!U.multiple,ae=U.value,ae!=null?us(v,!!U.multiple,ae,!1):U.defaultValue!=null&&us(v,!!U.multiple,U.defaultValue,!0);break;default:typeof K.onClick=="function"&&(v.onclick=$u)}switch(R){case"button":case"input":case"select":case"textarea":U=!!U.autoFocus;break e;case"img":U=!0;break e;default:U=!1}}U&&(S.flags|=4)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return Rr(S),null;case 6:if(v&&S.stateNode!=null)R_(v,S,v.memoizedProps,U);else{if(typeof U!="string"&&S.stateNode===null)throw Error(n(166));if(R=ou(kf.current),ou(Sa.current),Qu(S)){if(U=S.stateNode,R=S.memoizedProps,U[Za]=S,(ae=U.nodeValue!==R)&&(v=Gs,v!==null))switch(v.tag){case 3:od(U.nodeValue,R,(v.mode&1)!==0);break;case 5:v.memoizedProps.suppressHydrationWarning!==!0&&od(U.nodeValue,R,(v.mode&1)!==0)}ae&&(S.flags|=4)}else U=(R.nodeType===9?R:R.ownerDocument).createTextNode(U),U[Za]=S,S.stateNode=U}return Rr(S),null;case 13:if(Bi(Qr),U=S.memoizedState,v===null||v.memoizedState!==null&&v.memoizedState.dehydrated!==null){if(qi&&na!==null&&(S.mode&1)!==0&&(S.flags&128)===0)$p(),nu(),S.flags|=98560,ae=!1;else if(ae=Qu(S),U!==null&&U.dehydrated!==null){if(v===null){if(!ae)throw Error(n(318));if(ae=S.memoizedState,ae=ae!==null?ae.dehydrated:null,!ae)throw Error(n(317));ae[Za]=S}else nu(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;Rr(S),ae=!1}else xa!==null&&(vt(xa),xa=null),ae=!0;if(!ae)return S.flags&65536?S:null}return(S.flags&128)!==0?(S.lanes=R,S):(U=U!==null,U!==(v!==null&&v.memoizedState!==null)&&U&&(S.child.flags|=8192,(S.mode&1)!==0&&(v===null||(Qr.current&1)!==0?G===0&&(G=3):Un())),S.updateQueue!==null&&(S.flags|=4),Rr(S),null);case 4:return pd(),rm(v,S),v===null&&Uu(S.stateNode.containerInfo),Rr(S),null;case 10:return Hl(S.type._context),Rr(S),null;case 17:return No(S.type)&&wo(),Rr(S),null;case 19:if(Bi(Qr),ae=S.memoizedState,ae===null)return Rr(S),null;if(U=(S.flags&128)!==0,Ee=ae.rendering,Ee===null)if(U)Hf(ae,!1);else{if(G!==0||v!==null&&(v.flags&128)!==0)for(v=S.child;v!==null;){if(Ee=El(v),Ee!==null){for(S.flags|=128,Hf(ae,!1),U=Ee.updateQueue,U!==null&&(S.updateQueue=U,S.flags|=4),S.subtreeFlags=0,U=R,R=S.child;R!==null;)ae=R,v=U,ae.flags&=14680066,Ee=ae.alternate,Ee===null?(ae.childLanes=0,ae.lanes=v,ae.child=null,ae.subtreeFlags=0,ae.memoizedProps=null,ae.memoizedState=null,ae.updateQueue=null,ae.dependencies=null,ae.stateNode=null):(ae.childLanes=Ee.childLanes,ae.lanes=Ee.lanes,ae.child=Ee.child,ae.subtreeFlags=0,ae.deletions=null,ae.memoizedProps=Ee.memoizedProps,ae.memoizedState=Ee.memoizedState,ae.updateQueue=Ee.updateQueue,ae.type=Ee.type,v=Ee.dependencies,ae.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),R=R.sibling;return Si(Qr,Qr.current&1|2),S.child}v=v.sibling}ae.tail!==null&&Ur()>me&&(S.flags|=128,U=!0,Hf(ae,!1),S.lanes=4194304)}else{if(!U)if(v=El(Ee),v!==null){if(S.flags|=128,U=!0,R=v.updateQueue,R!==null&&(S.updateQueue=R,S.flags|=4),Hf(ae,!0),ae.tail===null&&ae.tailMode==="hidden"&&!Ee.alternate&&!qi)return Rr(S),null}else 2*Ur()-ae.renderingStartTime>me&&R!==1073741824&&(S.flags|=128,U=!0,Hf(ae,!1),S.lanes=4194304);ae.isBackwards?(Ee.sibling=S.child,S.child=Ee):(R=ae.last,R!==null?R.sibling=Ee:S.child=Ee,ae.last=Ee)}return ae.tail!==null?(S=ae.tail,ae.rendering=S,ae.tail=S.sibling,ae.renderingStartTime=Ur(),S.sibling=null,R=Qr.current,Si(Qr,U?R&1|2:R&1),S):(Rr(S),null);case 22:case 23:return cn(),U=S.memoizedState!==null,v!==null&&v.memoizedState!==null!==U&&(S.flags|=8192),U&&(S.mode&1)!==0?(z&1073741824)!==0&&(Rr(S),S.subtreeFlags&6&&(S.flags|=8192)):Rr(S),null;case 24:return null;case 25:return null}throw Error(n(156,S.tag))}function Wy(v,S){switch(Pf(S),S.tag){case 1:return No(S.type)&&wo(),v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 3:return pd(),Bi(ta),Bi(Hs),Of(),v=S.flags,(v&65536)!==0&&(v&128)===0?(S.flags=v&-65537|128,S):null;case 5:return Rf(S),null;case 13:if(Bi(Qr),v=S.memoizedState,v!==null&&v.dehydrated!==null){if(S.alternate===null)throw Error(n(340));nu()}return v=S.flags,v&65536?(S.flags=v&-65537|128,S):null;case 19:return Bi(Qr),null;case 4:return pd(),null;case 10:return Hl(S.type._context),null;case 22:case 23:return cn(),null;case 24:return null;default:return null}}var im=!1,Bs=!1,Wf=typeof WeakSet=="function"?WeakSet:Set,er=null;function pu(v,S){var R=v.ref;if(R!==null)if(typeof R=="function")try{R(null)}catch(U){tr(v,S,U)}else R.current=null}function ph(v,S,R){try{R()}catch(U){tr(v,S,U)}}var Al=!1;function qf(v,S){if(Tf=ef,v=gf(),Qo(v)){if("selectionStart"in v)var R={start:v.selectionStart,end:v.selectionEnd};else e:{R=(R=v.ownerDocument)&&R.defaultView||window;var U=R.getSelection&&R.getSelection();if(U&&U.rangeCount!==0){R=U.anchorNode;var K=U.anchorOffset,ae=U.focusNode;U=U.focusOffset;try{R.nodeType,ae.nodeType}catch{R=null;break e}var Ee=0,Je=-1,ct=-1,Vt=0,pn=0,yn=v,vn=null;t:for(;;){for(var Kn;yn!==R||K!==0&&yn.nodeType!==3||(Je=Ee+K),yn!==ae||U!==0&&yn.nodeType!==3||(ct=Ee+U),yn.nodeType===3&&(Ee+=yn.nodeValue.length),(Kn=yn.firstChild)!==null;)vn=yn,yn=Kn;for(;;){if(yn===v)break t;if(vn===R&&++Vt===K&&(Je=Ee),vn===ae&&++pn===U&&(ct=Ee),(Kn=yn.nextSibling)!==null)break;yn=vn,vn=yn.parentNode}yn=Kn}R=Je===-1||ct===-1?null:{start:Je,end:ct}}else R=null}R=R||{start:0,end:0}}else R=null;for(vc={focusedElem:v,selectionRange:R},ef=!1,er=S;er!==null;)if(S=er,v=S.child,(S.subtreeFlags&1028)!==0&&v!==null)v.return=S,er=v;else for(;er!==null;){S=er;try{var ir=S.alternate;if((S.flags&1024)!==0)switch(S.tag){case 0:case 11:case 15:break;case 1:if(ir!==null){var cr=ir.memoizedProps,as=ir.memoizedState,Et=S.stateNode,pt=Et.getSnapshotBeforeUpdate(S.elementType===S.type?cr:Aa(S.type,cr),as);Et.__reactInternalSnapshotBeforeUpdate=pt}break;case 3:var Lt=S.stateNode.containerInfo;Lt.nodeType===1?Lt.textContent="":Lt.nodeType===9&&Lt.documentElement&&Lt.removeChild(Lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Pn){tr(S,S.return,Pn)}if(v=S.sibling,v!==null){v.return=S.return,er=v;break}er=S.return}return ir=Al,Al=!1,ir}function ki(v,S,R){var U=S.updateQueue;if(U=U!==null?U.lastEffect:null,U!==null){var K=U=U.next;do{if((K.tag&v)===v){var ae=K.destroy;K.destroy=void 0,ae!==void 0&&ph(S,R,ae)}K=K.next}while(K!==U)}}function Pa(v,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var R=S=S.next;do{if((R.tag&v)===v){var U=R.create;R.destroy=U()}R=R.next}while(R!==S)}}function mh(v){var S=v.ref;if(S!==null){var R=v.stateNode;switch(v.tag){case 5:v=R;break;default:v=R}typeof S=="function"?S(v):S.current=v}}function Md(v){var S=v.alternate;S!==null&&(v.alternate=null,Md(S)),v.child=null,v.deletions=null,v.sibling=null,v.tag===5&&(S=v.stateNode,S!==null&&(delete S[Za],delete S[Jc],delete S[Np],delete S[E_],delete S[A_])),v.stateNode=null,v.return=null,v.dependencies=null,v.memoizedProps=null,v.memoizedState=null,v.pendingProps=null,v.stateNode=null,v.updateQueue=null}function pg(v){return v.tag===5||v.tag===3||v.tag===4}function O_(v){e:for(;;){for(;v.sibling===null;){if(v.return===null||pg(v.return))return null;v=v.return}for(v.sibling.return=v.return,v=v.sibling;v.tag!==5&&v.tag!==6&&v.tag!==18;){if(v.flags&2||v.child===null||v.tag===4)continue e;v.child.return=v,v=v.child}if(!(v.flags&2))return v.stateNode}}function gh(v,S,R){var U=v.tag;if(U===5||U===6)v=v.stateNode,S?R.nodeType===8?R.parentNode.insertBefore(v,S):R.insertBefore(v,S):(R.nodeType===8?(S=R.parentNode,S.insertBefore(v,R)):(S=R,S.appendChild(v)),R=R._reactRootContainer,R!=null||S.onclick!==null||(S.onclick=$u));else if(U!==4&&(v=v.child,v!==null))for(gh(v,S,R),v=v.sibling;v!==null;)gh(v,S,R),v=v.sibling}function mg(v,S,R){var U=v.tag;if(U===5||U===6)v=v.stateNode,S?R.insertBefore(v,S):R.appendChild(v);else if(U!==4&&(v=v.child,v!==null))for(mg(v,S,R),v=v.sibling;v!==null;)mg(v,S,R),v=v.sibling}var uo=null,ra=!1;function nl(v,S,R){for(R=R.child;R!==null;)ia(v,S,R),R=R.sibling}function ia(v,S,R){if(Yi&&typeof Yi.onCommitFiberUnmount=="function")try{Yi.onCommitFiberUnmount(ds,R)}catch{}switch(R.tag){case 5:Bs||pu(R,S);case 6:var U=uo,K=ra;uo=null,nl(v,S,R),uo=U,ra=K,uo!==null&&(ra?(v=uo,R=R.stateNode,v.nodeType===8?v.parentNode.removeChild(R):v.removeChild(R)):uo.removeChild(R.stateNode));break;case 18:uo!==null&&(ra?(v=uo,R=R.stateNode,v.nodeType===8?zp(v.parentNode,R):v.nodeType===1&&zp(v,R),fc(v)):zp(uo,R.stateNode));break;case 4:U=uo,K=ra,uo=R.stateNode.containerInfo,ra=!0,nl(v,S,R),uo=U,ra=K;break;case 0:case 11:case 14:case 15:if(!Bs&&(U=R.updateQueue,U!==null&&(U=U.lastEffect,U!==null))){K=U=U.next;do{var ae=K,Ee=ae.destroy;ae=ae.tag,Ee!==void 0&&((ae&2)!==0||(ae&4)!==0)&&ph(R,S,Ee),K=K.next}while(K!==U)}nl(v,S,R);break;case 1:if(!Bs&&(pu(R,S),U=R.stateNode,typeof U.componentWillUnmount=="function"))try{U.props=R.memoizedProps,U.state=R.memoizedState,U.componentWillUnmount()}catch(Je){tr(R,S,Je)}nl(v,S,R);break;case 21:nl(v,S,R);break;case 22:R.mode&1?(Bs=(U=Bs)||R.memoizedState!==null,nl(v,S,R),Bs=U):nl(v,S,R);break;default:nl(v,S,R)}}function mu(v){var S=v.updateQueue;if(S!==null){v.updateQueue=null;var R=v.stateNode;R===null&&(R=v.stateNode=new Wf),S.forEach(function(U){var K=pi.bind(null,v,U);R.has(U)||(R.add(U),U.then(K,K))})}}function Zs(v,S){var R=S.deletions;if(R!==null)for(var U=0;U<R.length;U++){var K=R[U];try{var ae=v,Ee=S,Je=Ee;e:for(;Je!==null;){switch(Je.tag){case 5:uo=Je.stateNode,ra=!1;break e;case 3:uo=Je.stateNode.containerInfo,ra=!0;break e;case 4:uo=Je.stateNode.containerInfo,ra=!0;break e}Je=Je.return}if(uo===null)throw Error(n(160));ia(ae,Ee,K),uo=null,ra=!1;var ct=K.alternate;ct!==null&&(ct.return=null),K.return=null}catch(Vt){tr(K,S,Vt)}}if(S.subtreeFlags&12854)for(S=S.child;S!==null;)ql(S,v),S=S.sibling}function ql(v,S){var R=v.alternate,U=v.flags;switch(v.tag){case 0:case 11:case 14:case 15:if(Zs(S,v),Xs(v),U&4){try{ki(3,v,v.return),Pa(3,v)}catch(cr){tr(v,v.return,cr)}try{ki(5,v,v.return)}catch(cr){tr(v,v.return,cr)}}break;case 1:Zs(S,v),Xs(v),U&512&&R!==null&&pu(R,R.return);break;case 5:if(Zs(S,v),Xs(v),U&512&&R!==null&&pu(R,R.return),v.flags&32){var K=v.stateNode;try{no(K,"")}catch(cr){tr(v,v.return,cr)}}if(U&4&&(K=v.stateNode,K!=null)){var ae=v.memoizedProps,Ee=R!==null?R.memoizedProps:ae,Je=v.type,ct=v.updateQueue;if(v.updateQueue=null,ct!==null)try{Je==="input"&&ae.type==="radio"&&ae.name!=null&&Mi(K,ae),lc(Je,Ee);var Vt=lc(Je,ae);for(Ee=0;Ee<ct.length;Ee+=2){var pn=ct[Ee],yn=ct[Ee+1];pn==="style"?ac(K,yn):pn==="dangerouslySetInnerHTML"?Fa(K,yn):pn==="children"?no(K,yn):ue(K,pn,yn,Vt)}switch(Je){case"input":Sn(K,ae);break;case"textarea":za(K,ae);break;case"select":var vn=K._wrapperState.wasMultiple;K._wrapperState.wasMultiple=!!ae.multiple;var Kn=ae.value;Kn!=null?us(K,!!ae.multiple,Kn,!1):vn!==!!ae.multiple&&(ae.defaultValue!=null?us(K,!!ae.multiple,ae.defaultValue,!0):us(K,!!ae.multiple,ae.multiple?[]:"",!1))}K[Jc]=ae}catch(cr){tr(v,v.return,cr)}}break;case 6:if(Zs(S,v),Xs(v),U&4){if(v.stateNode===null)throw Error(n(162));K=v.stateNode,ae=v.memoizedProps;try{K.nodeValue=ae}catch(cr){tr(v,v.return,cr)}}break;case 3:if(Zs(S,v),Xs(v),U&4&&R!==null&&R.memoizedState.isDehydrated)try{fc(S.containerInfo)}catch(cr){tr(v,v.return,cr)}break;case 4:Zs(S,v),Xs(v);break;case 13:Zs(S,v),Xs(v),K=v.child,K.flags&8192&&(ae=K.memoizedState!==null,K.stateNode.isHidden=ae,!ae||K.alternate!==null&&K.alternate.memoizedState!==null||(he=Ur())),U&4&&mu(v);break;case 22:if(pn=R!==null&&R.memoizedState!==null,v.mode&1?(Bs=(Vt=Bs)||pn,Zs(S,v),Bs=Vt):Zs(S,v),Xs(v),U&8192){if(Vt=v.memoizedState!==null,(v.stateNode.isHidden=Vt)&&!pn&&(v.mode&1)!==0)for(er=v,pn=v.child;pn!==null;){for(yn=er=pn;er!==null;){switch(vn=er,Kn=vn.child,vn.tag){case 0:case 11:case 14:case 15:ki(4,vn,vn.return);break;case 1:pu(vn,vn.return);var ir=vn.stateNode;if(typeof ir.componentWillUnmount=="function"){U=vn,R=vn.return;try{S=U,ir.props=S.memoizedProps,ir.state=S.memoizedState,ir.componentWillUnmount()}catch(cr){tr(U,R,cr)}}break;case 5:pu(vn,vn.return);break;case 22:if(vn.memoizedState!==null){qy(yn);continue}}Kn!==null?(Kn.return=vn,er=Kn):qy(yn)}pn=pn.sibling}e:for(pn=null,yn=v;;){if(yn.tag===5){if(pn===null){pn=yn;try{K=yn.stateNode,Vt?(ae=K.style,typeof ae.setProperty=="function"?ae.setProperty("display","none","important"):ae.display="none"):(Je=yn.stateNode,ct=yn.memoizedProps.style,Ee=ct!=null&&ct.hasOwnProperty("display")?ct.display:null,Je.style.display=$h("display",Ee))}catch(cr){tr(v,v.return,cr)}}}else if(yn.tag===6){if(pn===null)try{yn.stateNode.nodeValue=Vt?"":yn.memoizedProps}catch(cr){tr(v,v.return,cr)}}else if((yn.tag!==22&&yn.tag!==23||yn.memoizedState===null||yn===v)&&yn.child!==null){yn.child.return=yn,yn=yn.child;continue}if(yn===v)break e;for(;yn.sibling===null;){if(yn.return===null||yn.return===v)break e;pn===yn&&(pn=null),yn=yn.return}pn===yn&&(pn=null),yn.sibling.return=yn.return,yn=yn.sibling}}break;case 19:Zs(S,v),Xs(v),U&4&&mu(v);break;case 21:break;default:Zs(S,v),Xs(v)}}function Xs(v){var S=v.flags;if(S&2){try{e:{for(var R=v.return;R!==null;){if(pg(R)){var U=R;break e}R=R.return}throw Error(n(160))}switch(U.tag){case 5:var K=U.stateNode;U.flags&32&&(no(K,""),U.flags&=-33);var ae=O_(v);mg(v,ae,K);break;case 3:case 4:var Ee=U.stateNode.containerInfo,Je=O_(v);gh(v,Je,Ee);break;default:throw Error(n(161))}}catch(ct){tr(v,v.return,ct)}v.flags&=-3}S&4096&&(v.flags&=-4097)}function _h(v,S,R){er=v,rl(v)}function rl(v,S,R){for(var U=(v.mode&1)!==0;er!==null;){var K=er,ae=K.child;if(K.tag===22&&U){var Ee=K.memoizedState!==null||im;if(!Ee){var Je=K.alternate,ct=Je!==null&&Je.memoizedState!==null||Bs;Je=im;var Vt=Bs;if(im=Ee,(Bs=ct)&&!Vt)for(er=K;er!==null;)Ee=er,ct=Ee.child,Ee.tag===22&&Ee.memoizedState!==null?m(K):ct!==null?(ct.return=Ee,er=ct):m(K);for(;ae!==null;)er=ae,rl(ae),ae=ae.sibling;er=K,im=Je,Bs=Vt}gg(v)}else(K.subtreeFlags&8772)!==0&&ae!==null?(ae.return=K,er=ae):gg(v)}}function gg(v){for(;er!==null;){var S=er;if((S.flags&8772)!==0){var R=S.alternate;try{if((S.flags&8772)!==0)switch(S.tag){case 0:case 11:case 15:Bs||Pa(5,S);break;case 1:var U=S.stateNode;if(S.flags&4&&!Bs)if(R===null)U.componentDidMount();else{var K=S.elementType===S.type?R.memoizedProps:Aa(S.type,R.memoizedProps);U.componentDidUpdate(K,R.memoizedState,U.__reactInternalSnapshotBeforeUpdate)}var ae=S.updateQueue;ae!==null&&Qm(S,ae,U);break;case 3:var Ee=S.updateQueue;if(Ee!==null){if(R=null,S.child!==null)switch(S.child.tag){case 5:R=S.child.stateNode;break;case 1:R=S.child.stateNode}Qm(S,Ee,R)}break;case 5:var Je=S.stateNode;if(R===null&&S.flags&4){R=Je;var ct=S.memoizedProps;switch(S.type){case"button":case"input":case"select":case"textarea":ct.autoFocus&&R.focus();break;case"img":ct.src&&(R.src=ct.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(S.memoizedState===null){var Vt=S.alternate;if(Vt!==null){var pn=Vt.memoizedState;if(pn!==null){var yn=pn.dehydrated;yn!==null&&fc(yn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Bs||S.flags&512&&mh(S)}catch(vn){tr(S,S.return,vn)}}if(S===v){er=null;break}if(R=S.sibling,R!==null){R.return=S.return,er=R;break}er=S.return}}function qy(v){for(;er!==null;){var S=er;if(S===v){er=null;break}var R=S.sibling;if(R!==null){R.return=S.return,er=R;break}er=S.return}}function m(v){for(;er!==null;){var S=er;try{switch(S.tag){case 0:case 11:case 15:var R=S.return;try{Pa(4,S)}catch(ct){tr(S,R,ct)}break;case 1:var U=S.stateNode;if(typeof U.componentDidMount=="function"){var K=S.return;try{U.componentDidMount()}catch(ct){tr(S,K,ct)}}var ae=S.return;try{mh(S)}catch(ct){tr(S,ae,ct)}break;case 5:var Ee=S.return;try{mh(S)}catch(ct){tr(S,Ee,ct)}}}catch(ct){tr(S,S.return,ct)}if(S===v){er=null;break}var Je=S.sibling;if(Je!==null){Je.return=S.return,er=Je;break}er=S.return}}var s=Math.ceil,c=ye.ReactCurrentDispatcher,p=ye.ReactCurrentOwner,x=ye.ReactCurrentBatchConfig,w=0,A=null,M=null,O=0,z=0,B=bl(0),G=0,V=null,Y=0,J=0,Q=0,ce=null,ne=null,he=0,me=1/0,ve=null,Pe=!1,Ae=null,Ie=null,Ce=!1,Te=null,Me=0,Ke=0,Be=null,at=-1,Xe=0;function Qe(){return(w&6)!==0?Ur():at!==-1?at:at=Ur()}function At(v){return(v.mode&1)===0?1:(w&2)!==0&&O!==0?O&-O:Hp.transition!==null?(Xe===0&&(Xe=_l()),Xe):(v=ni,v!==0||(v=window.event,v=v===void 0?16:Va(v.type)),v)}function Ye(v,S,R,U){if(50<Ke)throw Ke=0,Be=null,Error(n(185));Uc(v,R,U),((w&2)===0||v!==A)&&(v===A&&((w&2)===0&&(J|=R),G===4&&Gt(v,O)),je(v,U),R===1&&w===0&&(S.mode&1)===0&&(me=Ur()+500,qu&&Ya()))}function je(v,S){var R=v.callbackNode;Zd(v,S);var U=Fc(v,v===A?O:0);if(U===0)R!==null&&Xr(R),v.callbackNode=null,v.callbackPriority=0;else if(S=U&-U,v.callbackPriority!==S){if(R!=null&&Xr(R),S===1)v.tag===0?Ym(Pt.bind(null,v)):Xu(Pt.bind(null,v)),T_(function(){(w&6)===0&&Ya()}),R=null;else{switch(Ua(U)){case 1:R=$r;break;case 4:R=Or;break;case 16:R=wi;break;case 536870912:R=ti;break;default:R=wi}R=Mn(R,ut.bind(null,v))}v.callbackPriority=S,v.callbackNode=R}}function ut(v,S){if(at=-1,Xe=0,(w&6)!==0)throw Error(n(327));var R=v.callbackNode;if(Sr()&&v.callbackNode!==R)return null;var U=Fc(v,v===A?O:0);if(U===0)return null;if((U&30)!==0||(U&v.expiredLanes)!==0||S)S=Wn(v,U);else{S=U;var K=w;w|=2;var ae=jn();(A!==v||O!==S)&&(ve=null,me=Ur()+500,ln(v,S));do try{Bn();break}catch(Je){un(v,Je)}while(!0);ih(),c.current=ae,w=K,M!==null?S=0:(A=null,O=0,S=G)}if(S!==0){if(S===2&&(K=Xd(v),K!==0&&(U=K,S=tt(v,K))),S===1)throw R=V,ln(v,0),Gt(v,U),je(v,Ur()),R;if(S===6)Gt(v,U);else{if(K=v.current.alternate,(U&30)===0&&!Dt(K)&&(S=Wn(v,U),S===2&&(ae=Xd(v),ae!==0&&(U=ae,S=tt(v,ae))),S===1))throw R=V,ln(v,0),Gt(v,U),je(v,Ur()),R;switch(v.finishedWork=K,v.finishedLanes=U,S){case 0:case 1:throw Error(n(345));case 2:Hr(v,ne,ve);break;case 3:if(Gt(v,U),(U&130023424)===U&&(S=he+500-Ur(),10<S)){if(Fc(v,0)!==0)break;if(K=v.suspendedLanes,(K&U)!==U){Qe(),v.pingedLanes|=v.suspendedLanes&K;break}v.timeoutHandle=ad(Hr.bind(null,v,ne,ve),S);break}Hr(v,ne,ve);break;case 4:if(Gt(v,U),(U&4194240)===U)break;for(S=v.eventTimes,K=-1;0<U;){var Ee=31-Ns(U);ae=1<<Ee,Ee=S[Ee],Ee>K&&(K=Ee),U&=~ae}if(U=K,U=Ur()-U,U=(120>U?120:480>U?480:1080>U?1080:1920>U?1920:3e3>U?3e3:4320>U?4320:1960*s(U/1960))-U,10<U){v.timeoutHandle=ad(Hr.bind(null,v,ne,ve),U);break}Hr(v,ne,ve);break;case 5:Hr(v,ne,ve);break;default:throw Error(n(329))}}}return je(v,Ur()),v.callbackNode===R?ut.bind(null,v):null}function tt(v,S){var R=ce;return v.current.memoizedState.isDehydrated&&(ln(v,S).flags|=256),v=Wn(v,S),v!==2&&(S=ne,ne=R,S!==null&&vt(S)),v}function vt(v){ne===null?ne=v:ne.push.apply(ne,v)}function Dt(v){for(var S=v;;){if(S.flags&16384){var R=S.updateQueue;if(R!==null&&(R=R.stores,R!==null))for(var U=0;U<R.length;U++){var K=R[U],ae=K.getSnapshot;K=K.value;try{if(!ao(ae(),K))return!1}catch{return!1}}}if(R=S.child,S.subtreeFlags&16384&&R!==null)R.return=S,S=R;else{if(S===v)break;for(;S.sibling===null;){if(S.return===null||S.return===v)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Gt(v,S){for(S&=~Q,S&=~J,v.suspendedLanes|=S,v.pingedLanes&=~S,v=v.expirationTimes;0<S;){var R=31-Ns(S),U=1<<R;v[R]=-1,S&=~U}}function Pt(v){if((w&6)!==0)throw Error(n(327));Sr();var S=Fc(v,0);if((S&1)===0)return je(v,Ur()),null;var R=Wn(v,S);if(v.tag!==0&&R===2){var U=Xd(v);U!==0&&(S=U,R=tt(v,U))}if(R===1)throw R=V,ln(v,0),Gt(v,S),je(v,Ur()),R;if(R===6)throw Error(n(345));return v.finishedWork=v.current.alternate,v.finishedLanes=S,Hr(v,ne,ve),je(v,Ur()),null}function wt(v,S){var R=w;w|=1;try{return v(S)}finally{w=R,w===0&&(me=Ur()+500,qu&&Ya())}}function dn(v){Te!==null&&Te.tag===0&&(w&6)===0&&Sr();var S=w;w|=1;var R=x.transition,U=ni;try{if(x.transition=null,ni=1,v)return v()}finally{ni=U,x.transition=R,w=S,(w&6)===0&&Ya()}}function cn(){z=B.current,Bi(B)}function ln(v,S){v.finishedWork=null,v.finishedLanes=0;var R=v.timeoutHandle;if(R!==-1&&(v.timeoutHandle=-1,jp(R)),M!==null)for(R=M.return;R!==null;){var U=R;switch(Pf(U),U.tag){case 1:U=U.type.childContextTypes,U!=null&&wo();break;case 3:pd(),Bi(ta),Bi(Hs),Of();break;case 5:Rf(U);break;case 4:pd();break;case 13:Bi(Qr);break;case 19:Bi(Qr);break;case 10:Hl(U.type._context);break;case 22:case 23:cn()}R=R.return}if(A=v,M=v=Gi(v.current,null),O=z=S,G=0,V=null,Q=J=Y=0,ne=ce=null,Sl!==null){for(S=0;S<Sl.length;S++)if(R=Sl[S],U=R.interleaved,U!==null){R.interleaved=null;var K=U.next,ae=R.pending;if(ae!==null){var Ee=ae.next;ae.next=K,U.next=Ee}R.pending=U}Sl=null}return v}function un(v,S){do{var R=M;try{if(ih(),md.current=Gl,_d){for(var U=Ai.memoizedState;U!==null;){var K=U.queue;K!==null&&(K.pending=null),U=U.next}_d=!1}if(Ta=0,rs=wr=Ai=null,yd=!1,Ea=0,p.current=null,R===null||R.return===null){G=1,V=S,M=null;break}e:{var ae=v,Ee=R.return,Je=R,ct=S;if(S=O,Je.flags|=32768,ct!==null&&typeof ct=="object"&&typeof ct.then=="function"){var Vt=ct,pn=Je,yn=pn.tag;if((pn.mode&1)===0&&(yn===0||yn===11||yn===15)){var vn=pn.alternate;vn?(pn.updateQueue=vn.updateQueue,pn.memoizedState=vn.memoizedState,pn.lanes=vn.lanes):(pn.updateQueue=null,pn.memoizedState=null)}var Kn=Kp(Ee);if(Kn!==null){Kn.flags&=-257,ss(Kn,Ee,Je,ae,S),Kn.mode&1&&Yp(ae,Vt,S),S=Kn,ct=Vt;var ir=S.updateQueue;if(ir===null){var cr=new Set;cr.add(ct),S.updateQueue=cr}else ir.add(ct);break e}else{if((S&1)===0){Yp(ae,Vt,S),Un();break e}ct=Error(n(426))}}else if(qi&&Je.mode&1){var as=Kp(Ee);if(as!==null){(as.flags&65536)===0&&(as.flags|=256),ss(as,Ee,Je,ae,S),hd(hu(ct,Je));break e}}ae=ct=hu(ct,Je),G!==4&&(G=2),ce===null?ce=[ae]:ce.push(ae),ae=Ee;do{switch(ae.tag){case 3:ae.flags|=65536,S&=-S,ae.lanes|=S;var Et=ch(ae,ct,S);Cn(ae,Et);break e;case 1:Je=ct;var pt=ae.type,Lt=ae.stateNode;if((ae.flags&128)===0&&(typeof pt.getDerivedStateFromError=="function"||Lt!==null&&typeof Lt.componentDidCatch=="function"&&(Ie===null||!Ie.has(Lt)))){ae.flags|=65536,S&=-S,ae.lanes|=S;var Pn=Ff(ae,Je,S);Cn(ae,Pn);break e}}ae=ae.return}while(ae!==null)}Lr(R)}catch(pr){S=pr,M===R&&R!==null&&(M=R=R.return);continue}break}while(!0)}function jn(){var v=c.current;return c.current=Gl,v===null?Gl:v}function Un(){(G===0||G===3||G===2)&&(G=4),A===null||(Y&268435455)===0&&(J&268435455)===0||Gt(A,O)}function Wn(v,S){var R=w;w|=2;var U=jn();(A!==v||O!==S)&&(ve=null,ln(v,S));do try{Fr();break}catch(K){un(v,K)}while(!0);if(ih(),w=R,c.current=U,M!==null)throw Error(n(261));return A=null,O=0,G}function Fr(){for(;M!==null;)Ar(M)}function Bn(){for(;M!==null&&!_r();)Ar(M)}function Ar(v){var S=Yn(v.alternate,v,z);v.memoizedProps=v.pendingProps,S===null?Lr(v):M=S,p.current=null}function Lr(v){var S=v;do{var R=S.alternate;if(v=S.return,(S.flags&32768)===0){if(R=Gf(R,S,z),R!==null){M=R;return}}else{if(R=Wy(R,S),R!==null){R.flags&=32767,M=R;return}if(v!==null)v.flags|=32768,v.subtreeFlags=0,v.deletions=null;else{G=6,M=null;return}}if(S=S.sibling,S!==null){M=S;return}M=S=v}while(S!==null);G===0&&(G=5)}function Hr(v,S,R){var U=ni,K=x.transition;try{x.transition=null,ni=1,Xn(v,S,R,U)}finally{x.transition=K,ni=U}return null}function Xn(v,S,R,U){do Sr();while(Te!==null);if((w&6)!==0)throw Error(n(327));R=v.finishedWork;var K=v.finishedLanes;if(R===null)return null;if(v.finishedWork=null,v.finishedLanes=0,R===v.current)throw Error(n(177));v.callbackNode=null,v.callbackPriority=0;var ae=R.lanes|R.childLanes;if(fa(v,ae),v===A&&(M=A=null,O=0),(R.subtreeFlags&2064)===0&&(R.flags&2064)===0||Ce||(Ce=!0,Mn(wi,function(){return Sr(),null})),ae=(R.flags&15990)!==0,(R.subtreeFlags&15990)!==0||ae){ae=x.transition,x.transition=null;var Ee=ni;ni=1;var Je=w;w|=4,p.current=null,qf(v,R),ql(R,v),v_(vc),ef=!!Tf,vc=Tf=null,v.current=R,_h(R),zi(),w=Je,ni=Ee,x.transition=ae}else v.current=R;if(Ce&&(Ce=!1,Te=v,Me=K),ae=v.pendingLanes,ae===0&&(Ie=null),da(R.stateNode),je(v,Ur()),S!==null)for(U=v.onRecoverableError,R=0;R<S.length;R++)K=S[R],U(K.value,{componentStack:K.stack,digest:K.digest});if(Pe)throw Pe=!1,v=Ae,Ae=null,v;return(Me&1)!==0&&v.tag!==0&&Sr(),ae=v.pendingLanes,(ae&1)!==0?v===Be?Ke++:(Ke=0,Be=v):Ke=0,Ya(),null}function Sr(){if(Te!==null){var v=Ua(Me),S=x.transition,R=ni;try{if(x.transition=null,ni=16>v?16:v,Te===null)var U=!1;else{if(v=Te,Te=null,Me=0,(w&6)!==0)throw Error(n(331));var K=w;for(w|=4,er=v.current;er!==null;){var ae=er,Ee=ae.child;if((er.flags&16)!==0){var Je=ae.deletions;if(Je!==null){for(var ct=0;ct<Je.length;ct++){var Vt=Je[ct];for(er=Vt;er!==null;){var pn=er;switch(pn.tag){case 0:case 11:case 15:ki(8,pn,ae)}var yn=pn.child;if(yn!==null)yn.return=pn,er=yn;else for(;er!==null;){pn=er;var vn=pn.sibling,Kn=pn.return;if(Md(pn),pn===Vt){er=null;break}if(vn!==null){vn.return=Kn,er=vn;break}er=Kn}}}var ir=ae.alternate;if(ir!==null){var cr=ir.child;if(cr!==null){ir.child=null;do{var as=cr.sibling;cr.sibling=null,cr=as}while(cr!==null)}}er=ae}}if((ae.subtreeFlags&2064)!==0&&Ee!==null)Ee.return=ae,er=Ee;else e:for(;er!==null;){if(ae=er,(ae.flags&2048)!==0)switch(ae.tag){case 0:case 11:case 15:ki(9,ae,ae.return)}var Et=ae.sibling;if(Et!==null){Et.return=ae.return,er=Et;break e}er=ae.return}}var pt=v.current;for(er=pt;er!==null;){Ee=er;var Lt=Ee.child;if((Ee.subtreeFlags&2064)!==0&&Lt!==null)Lt.return=Ee,er=Lt;else e:for(Ee=pt;er!==null;){if(Je=er,(Je.flags&2048)!==0)try{switch(Je.tag){case 0:case 11:case 15:Pa(9,Je)}}catch(pr){tr(Je,Je.return,pr)}if(Je===Ee){er=null;break e}var Pn=Je.sibling;if(Pn!==null){Pn.return=Je.return,er=Pn;break e}er=Je.return}}if(w=K,Ya(),Yi&&typeof Yi.onPostCommitFiberRoot=="function")try{Yi.onPostCommitFiberRoot(ds,v)}catch{}U=!0}return U}finally{ni=R,x.transition=S}}return!1}function Mr(v,S,R){S=hu(R,S),S=ch(v,S,1),v=Uo(v,S,1),S=Qe(),v!==null&&(Uc(v,1,S),je(v,S))}function tr(v,S,R){if(v.tag===3)Mr(v,v,R);else for(;S!==null;){if(S.tag===3){Mr(S,v,R);break}else if(S.tag===1){var U=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof U.componentDidCatch=="function"&&(Ie===null||!Ie.has(U))){v=hu(R,v),v=Ff(S,v,1),S=Uo(S,v,1),v=Qe(),S!==null&&(Uc(S,1,v),je(S,v));break}}S=S.return}}function fi(v,S,R){var U=v.pingCache;U!==null&&U.delete(S),S=Qe(),v.pingedLanes|=v.suspendedLanes&R,A===v&&(O&R)===R&&(G===4||G===3&&(O&130023424)===O&&500>Ur()-he?ln(v,0):Q|=R),je(v,S)}function Di(v,S){S===0&&((v.mode&1)===0?S=1:(S=cc,cc<<=1,(cc&130023424)===0&&(cc=4194304)));var R=Qe();v=Bo(v,S),v!==null&&(Uc(v,S,R),je(v,R))}function gs(v){var S=v.memoizedState,R=0;S!==null&&(R=S.retryLane),Di(v,R)}function pi(v,S){var R=0;switch(v.tag){case 13:var U=v.stateNode,K=v.memoizedState;K!==null&&(R=K.retryLane);break;case 19:U=v.stateNode;break;default:throw Error(n(314))}U!==null&&U.delete(S),Di(v,R)}var Yn;Yn=function(v,S,R){if(v!==null)if(v.memoizedProps!==S.pendingProps||ta.current)So=!0;else{if((v.lanes&R)===0&&(S.flags&128)===0)return So=!1,M_(v,S,R);So=(v.flags&131072)!==0}else So=!1,qi&&(S.flags&1048576)!==0&&Up(S,Vl,S.index);switch(S.lanes=0,S.tag){case 2:var U=S.type;Id(v,S),v=S.pendingProps;var K=Xa(S,Hs.current);Sc(S,R),K=Ec(null,S,U,v,K,R);var ae=kt();return S.flags|=1,typeof K=="object"&&K!==null&&typeof K.render=="function"&&K.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,No(U)?(ae=!0,Wu(S)):ae=!1,S.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,nn(S),K.updater=qs,S.stateNode=K,K._reactInternals=S,Nf(S,U,v,R),S=$f(null,S,U,!0,ae,R)):(S.tag=0,qi&&ae&&Cf(S),Fs(null,S,K,R),S=S.child),S;case 16:U=S.elementType;e:{switch(Id(v,S),v=S.pendingProps,K=U._init,U=K(U._payload),S.type=U,K=S.tag=Zi(U),v=Aa(U,v),K){case 0:S=Cd(null,S,U,v,R);break e;case 1:S=Vf(null,S,U,v,R);break e;case 11:S=fu(null,S,U,v,R);break e;case 14:S=Jp(null,S,U,Aa(U.type,v),R);break e}throw Error(n(306,U,""))}return S;case 0:return U=S.type,K=S.pendingProps,K=S.elementType===U?K:Aa(U,K),Cd(v,S,U,K,R);case 1:return U=S.type,K=S.pendingProps,K=S.elementType===U?K:Aa(U,K),Vf(v,S,U,K,R);case 3:e:{if(hh(S),v===null)throw Error(n(387));U=S.pendingProps,ae=S.memoizedState,K=ae.element,Wp(v,S),fd(S,U,null,R);var Ee=S.memoizedState;if(U=Ee.element,ae.isDehydrated)if(ae={element:U,isDehydrated:!1,cache:Ee.cache,pendingSuspenseBoundaries:Ee.pendingSuspenseBoundaries,transitions:Ee.transitions},S.updateQueue.baseState=ae,S.memoizedState=ae,S.flags&256){K=hu(Error(n(423)),S),S=dh(v,S,U,R,K);break e}else if(U!==K){K=hu(Error(n(424)),S),S=dh(v,S,U,R,K);break e}else for(na=_a(S.stateNode.containerInfo.firstChild),Gs=S,qi=!0,xa=null,R=Km(S,null,U,R),S.child=R;R;)R.flags=R.flags&-3|4096,R=R.sibling;else{if(nu(),U===K){S=Wl(v,S,R);break e}Fs(v,S,U,R)}S=S.child}return S;case 5:return Vo(S),v===null&&$l(S),U=S.type,K=S.pendingProps,ae=v!==null?v.memoizedProps:null,Ee=K.children,Kc(U,K)?Ee=null:ae!==null&&Kc(U,ae)&&(S.flags|=32),uh(v,S),Fs(v,S,Ee,R),S.child;case 6:return v===null&&$l(S),null;case 13:return em(v,S,R);case 4:return eg(S,S.stateNode.containerInfo),U=S.pendingProps,v===null?S.child=ba(S,null,U,R):Fs(v,S,U,R),S.child;case 11:return U=S.type,K=S.pendingProps,K=S.elementType===U?K:Aa(U,K),fu(v,S,U,K,R);case 7:return Fs(v,S,S.pendingProps,R),S.child;case 8:return Fs(v,S,S.pendingProps.children,R),S.child;case 12:return Fs(v,S,S.pendingProps.children,R),S.child;case 10:e:{if(U=S.type._context,K=S.pendingProps,ae=S.memoizedProps,Ee=K.value,Si(Gp,U._currentValue),U._currentValue=Ee,ae!==null)if(ao(ae.value,Ee)){if(ae.children===K.children&&!ta.current){S=Wl(v,S,R);break e}}else for(ae=S.child,ae!==null&&(ae.return=S);ae!==null;){var Je=ae.dependencies;if(Je!==null){Ee=ae.child;for(var ct=Je.firstContext;ct!==null;){if(ct.context===U){if(ae.tag===1){ct=lo(-1,R&-R),ct.tag=2;var Vt=ae.updateQueue;if(Vt!==null){Vt=Vt.shared;var pn=Vt.pending;pn===null?ct.next=ct:(ct.next=pn.next,pn.next=ct),Vt.pending=ct}}ae.lanes|=R,ct=ae.alternate,ct!==null&&(ct.lanes|=R),Mf(ae.return,R,S),Je.lanes|=R;break}ct=ct.next}}else if(ae.tag===10)Ee=ae.type===S.type?null:ae.child;else if(ae.tag===18){if(Ee=ae.return,Ee===null)throw Error(n(341));Ee.lanes|=R,Je=Ee.alternate,Je!==null&&(Je.lanes|=R),Mf(Ee,R,S),Ee=ae.sibling}else Ee=ae.child;if(Ee!==null)Ee.return=ae;else for(Ee=ae;Ee!==null;){if(Ee===S){Ee=null;break}if(ae=Ee.sibling,ae!==null){ae.return=Ee.return,Ee=ae;break}Ee=Ee.return}ae=Ee}Fs(v,S,K.children,R),S=S.child}return S;case 9:return K=S.type,U=S.pendingProps.children,Sc(S,R),K=Fo(K),U=U(K),S.flags|=1,Fs(v,S,U,R),S.child;case 14:return U=S.type,K=Aa(U,S.pendingProps),K=Aa(U.type,K),Jp(v,S,U,K,R);case 15:return Uf(v,S,S.type,S.pendingProps,R);case 17:return U=S.type,K=S.pendingProps,K=S.elementType===U?K:Aa(U,K),Id(v,S),S.tag=1,No(U)?(v=!0,Wu(S)):v=!1,Sc(S,R),lh(S,U,K),Nf(S,U,K,R),$f(null,S,U,!0,v,R);case 19:return dg(v,S,R);case 22:return Ad(v,S,R)}throw Error(n(156,S.tag))};function Mn(v,S){return xr(v,S)}function Br(v,S,R,U){this.tag=v,this.key=R,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=U,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gr(v,S,R,U){return new Br(v,S,R,U)}function ai(v){return v=v.prototype,!(!v||!v.isReactComponent)}function Zi(v){if(typeof v=="function")return ai(v)?1:0;if(v!=null){if(v=v.$$typeof,v===qe)return 11;if(v===Nt)return 14}return 2}function Gi(v,S){var R=v.alternate;return R===null?(R=Gr(v.tag,S,v.key,v.mode),R.elementType=v.elementType,R.type=v.type,R.stateNode=v.stateNode,R.alternate=v,v.alternate=R):(R.pendingProps=S,R.type=v.type,R.flags=0,R.subtreeFlags=0,R.deletions=null),R.flags=v.flags&14680064,R.childLanes=v.childLanes,R.lanes=v.lanes,R.child=v.child,R.memoizedProps=v.memoizedProps,R.memoizedState=v.memoizedState,R.updateQueue=v.updateQueue,S=v.dependencies,R.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},R.sibling=v.sibling,R.index=v.index,R.ref=v.ref,R}function To(v,S,R,U,K,ae){var Ee=2;if(U=v,typeof v=="function")ai(v)&&(Ee=1);else if(typeof v=="string")Ee=5;else e:switch(v){case Le:return Us(R.children,K,ae,S);case Ze:Ee=8,K|=8;break;case Ge:return v=Gr(12,R,S,K|2),v.elementType=Ge,v.lanes=ae,v;case en:return v=Gr(13,R,S,K),v.elementType=en,v.lanes=ae,v;case Jt:return v=Gr(19,R,S,K),v.elementType=Jt,v.lanes=ae,v;case an:return ho(R,K,ae,S);default:if(typeof v=="object"&&v!==null)switch(v.$$typeof){case gt:Ee=10;break e;case lt:Ee=9;break e;case qe:Ee=11;break e;case Nt:Ee=14;break e;case St:Ee=16,U=null;break e}throw Error(n(130,v==null?v:typeof v,""))}return S=Gr(Ee,R,S,K),S.elementType=v,S.type=U,S.lanes=ae,S}function Us(v,S,R,U){return v=Gr(7,v,U,S),v.lanes=R,v}function ho(v,S,R,U){return v=Gr(22,v,U,S),v.elementType=an,v.lanes=R,v.stateNode={isHidden:!1},v}function Eo(v,S,R){return v=Gr(6,v,null,S),v.lanes=R,v}function Ys(v,S,R){return S=Gr(4,v.children!==null?v.children:[],v.key,S),S.lanes=R,S.stateNode={containerInfo:v.containerInfo,pendingChildren:null,implementation:v.implementation},S}function il(v,S,R,U,K){this.tag=S,this.containerInfo=v,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yd(0),this.expirationTimes=Yd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yd(0),this.identifierPrefix=U,this.onRecoverableError=K,this.mutableSourceEagerHydrationData=null}function Ia(v,S,R,U,K,ae,Ee,Je,ct){return v=new il(v,S,R,Je,ct),S===1?(S=1,ae===!0&&(S|=8)):S=0,ae=Gr(3,null,null,S),v.current=ae,ae.stateNode=v,ae.memoizedState={element:U,isDehydrated:R,cache:null,transitions:null,pendingSuspenseBoundaries:null},nn(ae),v}function Li(v,S,R){var U=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:we,key:U==null?null:""+U,children:v,containerInfo:S,implementation:R}}function ji(v){if(!v)return Ul;v=v._reactInternals;e:{if(_t(v)!==v||v.tag!==1)throw Error(n(170));var S=v;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(No(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(n(171))}if(v.tag===1){var R=v.type;if(No(R))return cd(v,R,S)}return S}function mi(v,S,R,U,K,ae,Ee,Je,ct){return v=Ia(R,U,!0,v,K,ae,Ee,Je,ct),v.context=ji(null),R=v.current,U=Qe(),K=At(R),ae=lo(U,K),ae.callback=S??null,Uo(R,ae,K),v.current.lanes=K,Uc(v,K,U),je(v,U),v}function Wi(v,S,R,U){var K=S.current,ae=Qe(),Ee=At(K);return R=ji(R),S.context===null?S.context=R:S.pendingContext=R,S=lo(ae,Ee),S.payload={element:v},U=U===void 0?null:U,U!==null&&(S.callback=U),v=Uo(K,S,Ee),v!==null&&(Ye(v,K,Ee,ae),Tl(v,K,Ee)),Ee}function Ji(v){if(v=v.current,!v.child)return null;switch(v.child.tag){case 5:return v.child.stateNode;default:return v.child.stateNode}}function Ui(v,S){if(v=v.memoizedState,v!==null&&v.dehydrated!==null){var R=v.retryLane;v.retryLane=R!==0&&R<S?R:S}}function Ps(v,S){Ui(v,S),(v=v.alternate)&&Ui(v,S)}function Zl(){return null}var Xl=typeof reportError=="function"?reportError:function(v){console.error(v)};function Ma(v){this._internalRoot=v}Cl.prototype.render=Ma.prototype.render=function(v){var S=this._internalRoot;if(S===null)throw Error(n(409));Wi(v,S,null,null)},Cl.prototype.unmount=Ma.prototype.unmount=function(){var v=this._internalRoot;if(v!==null){this._internalRoot=null;var S=v.containerInfo;dn(function(){Wi(null,v,null,null)}),S[ya]=null}};function Cl(v){this._internalRoot=v}Cl.prototype.unstable_scheduleHydration=function(v){if(v){var S=qh();v={blockedOn:null,target:v,priority:S};for(var R=0;R<yl.length&&S!==0&&S<yl[R].priority;R++);yl.splice(R,0,v),R===0&&Vm(v)}};function Yl(v){return!(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)}function ka(v){return!(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11&&(v.nodeType!==8||v.nodeValue!==" react-mount-point-unstable "))}function yh(){}function Pc(v,S,R,U,K){if(K){if(typeof U=="function"){var ae=U;U=function(){var Vt=Ji(Ee);ae.call(Vt)}}var Ee=mi(S,U,v,0,null,!1,!1,"",yh);return v._reactRootContainer=Ee,v[ya]=Ee.current,Uu(v.nodeType===8?v.parentNode:v),dn(),Ee}for(;K=v.lastChild;)v.removeChild(K);if(typeof U=="function"){var Je=U;U=function(){var Vt=Ji(ct);Je.call(Vt)}}var ct=Ia(v,0,!1,null,null,!1,!1,"",yh);return v._reactRootContainer=ct,v[ya]=ct.current,Uu(v.nodeType===8?v.parentNode:v),dn(function(){Wi(S,ct,R,U)}),ct}function Ra(v,S,R,U,K){var ae=R._reactRootContainer;if(ae){var Ee=ae;if(typeof K=="function"){var Je=K;K=function(){var ct=Ji(Ee);Je.call(ct)}}Wi(S,Ee,v,K)}else Ee=Pc(R,S,v,K,U);return Ji(Ee)}io=function(v){switch(v.tag){case 3:var S=v.stateNode;if(S.current.memoizedState.isDehydrated){var R=uc(S.pendingLanes);R!==0&&(pa(S,R|1),je(S,Ur()),(w&6)===0&&(me=Ur()+500,Ya()))}break;case 13:dn(function(){var U=Bo(v,1);if(U!==null){var K=Qe();Ye(U,v,1,K)}}),Ps(v,1)}},hc=function(v){if(v.tag===13){var S=Bo(v,134217728);if(S!==null){var R=Qe();Ye(S,v,134217728,R)}Ps(v,134217728)}},Tp=function(v){if(v.tag===13){var S=At(v),R=Bo(v,S);if(R!==null){var U=Qe();Ye(R,v,S,U)}Ps(v,S)}},qh=function(){return ni},dc=function(v,S){var R=ni;try{return ni=v,S()}finally{ni=R}},ku=function(v,S,R){switch(S){case"input":if(Sn(v,R),S=R.name,R.type==="radio"&&S!=null){for(R=v;R.parentNode;)R=R.parentNode;for(R=R.querySelectorAll("input[name="+JSON.stringify(""+S)+'][type="radio"]'),S=0;S<R.length;S++){var U=R[S];if(U!==v&&U.form===v.form){var K=Fp(U);if(!K)throw Error(n(90));tn(U),Sn(U,K)}}}break;case"textarea":za(v,R);break;case"select":S=R.value,S!=null&&us(v,!!R.multiple,S,!1)}},It=wt,Dl=dn;var Ic={usingClientEntryPoint:!1,Events:[ld,Gu,Fp,Gh,Wd,wt]},gu={findFiberByHostInstance:ea,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ao={bundleType:gu.bundleType,version:gu.version,rendererPackageName:gu.rendererPackageName,rendererConfig:gu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ye.ReactCurrentDispatcher,findHostInstanceByFiber:function(v){return v=gr(v),v===null?null:v.stateNode},findFiberByHostInstance:gu.findFiberByHostInstance||Zl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vh.isDisabled&&vh.supportsFiber)try{ds=vh.inject(Ao),Yi=vh}catch{}}return Kl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ic,Kl.createPortal=function(v,S){var R=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yl(S))throw Error(n(200));return Li(v,S,null,R)},Kl.createRoot=function(v,S){if(!Yl(v))throw Error(n(299));var R=!1,U="",K=Xl;return S!=null&&(S.unstable_strictMode===!0&&(R=!0),S.identifierPrefix!==void 0&&(U=S.identifierPrefix),S.onRecoverableError!==void 0&&(K=S.onRecoverableError)),S=Ia(v,1,!1,null,null,R,!1,U,K),v[ya]=S.current,Uu(v.nodeType===8?v.parentNode:v),new Ma(S)},Kl.findDOMNode=function(v){if(v==null)return null;if(v.nodeType===1)return v;var S=v._reactInternals;if(S===void 0)throw typeof v.render=="function"?Error(n(188)):(v=Object.keys(v).join(","),Error(n(268,v)));return v=gr(S),v=v===null?null:v.stateNode,v},Kl.flushSync=function(v){return dn(v)},Kl.hydrate=function(v,S,R){if(!ka(S))throw Error(n(200));return Ra(null,v,S,!0,R)},Kl.hydrateRoot=function(v,S,R){if(!Yl(v))throw Error(n(405));var U=R!=null&&R.hydratedSources||null,K=!1,ae="",Ee=Xl;if(R!=null&&(R.unstable_strictMode===!0&&(K=!0),R.identifierPrefix!==void 0&&(ae=R.identifierPrefix),R.onRecoverableError!==void 0&&(Ee=R.onRecoverableError)),S=mi(S,null,v,1,R??null,K,!1,ae,Ee),v[ya]=S.current,Uu(v),U)for(v=0;v<U.length;v++)R=U[v],K=R._getVersion,K=K(R._source),S.mutableSourceEagerHydrationData==null?S.mutableSourceEagerHydrationData=[R,K]:S.mutableSourceEagerHydrationData.push(R,K);return new Cl(S)},Kl.render=function(v,S,R){if(!ka(S))throw Error(n(200));return Ra(null,v,S,!1,R)},Kl.unmountComponentAtNode=function(v){if(!ka(v))throw Error(n(40));return v._reactRootContainer?(dn(function(){Ra(null,null,v,!1,function(){v._reactRootContainer=null,v[ya]=null})}),!0):!1},Kl.unstable_batchedUpdates=wt,Kl.unstable_renderSubtreeIntoContainer=function(v,S,R,U){if(!ka(R))throw Error(n(200));if(v==null||v._reactInternals===void 0)throw Error(n(38));return Ra(v,S,R,!1,U)},Kl.version="18.3.1-next-f1338f8080-20240426",Kl}var iO;function V3(){if(iO)return A2.exports;iO=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),A2.exports=ZH(),A2.exports}var sO;function XH(){if(sO)return eb;sO=1;var e=V3();return eb.createRoot=e.createRoot,eb.hydrateRoot=e.hydrateRoot,eb}var YH=XH();const KH=zh(YH);/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var oO="popstate";function JH(e={}){function t(o,u){let{pathname:d,search:g,hash:i}=o.location;return LE("",{pathname:d,search:g,hash:i},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function n(o,u){return typeof u=="string"?u:hx(u)}return eG(t,n,null,e)}function Ds(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Au(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function QH(){return Math.random().toString(36).substring(2,10)}function aO(e,t){return{usr:e.state,key:e.key,idx:t}}function LE(e,t,n=null,o){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?Ay(t):t,state:n,key:t&&t.key||o||QH()}}function hx({pathname:e="/",search:t="",hash:n=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function Ay(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let o=e.indexOf("?");o>=0&&(t.search=e.substring(o),e=e.substring(0,o)),e&&(t.pathname=e)}return t}function eG(e,t,n,o={}){let{window:u=document.defaultView,v5Compat:d=!1}=o,g=u.history,i="POP",E=null,P=I();P==null&&(P=0,g.replaceState({...g.state,idx:P},""));function I(){return(g.state||{idx:null}).idx}function D(){i="POP";let X=I(),re=X==null?null:X-P;P=X,E&&E({action:i,location:q.location,delta:re})}function F(X,re){i="PUSH";let le=LE(q.location,X,re);P=I()+1;let ue=aO(le,P),ye=q.createHref(le);try{g.pushState(ue,"",ye)}catch(ge){if(ge instanceof DOMException&&ge.name==="DataCloneError")throw ge;u.location.assign(ye)}d&&E&&E({action:i,location:q.location,delta:1})}function $(X,re){i="REPLACE";let le=LE(q.location,X,re);P=I();let ue=aO(le,P),ye=q.createHref(le);g.replaceState(ue,"",ye),d&&E&&E({action:i,location:q.location,delta:0})}function Z(X){return tG(X)}let q={get action(){return i},get location(){return e(u,g)},listen(X){if(E)throw new Error("A history only accepts one active listener");return u.addEventListener(oO,D),E=X,()=>{u.removeEventListener(oO,D),E=null}},createHref(X){return t(u,X)},createURL:Z,encodeLocation(X){let re=Z(X);return{pathname:re.pathname,search:re.search,hash:re.hash}},push:F,replace:$,go(X){return g.go(X)}};return q}function tG(e,t=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ds(n,"No window.location.(origin|href) available to create URL");let o=typeof e=="string"?e:hx(e);return o=o.replace(/ $/,"%20"),!t&&o.startsWith("//")&&(o=n+o),new URL(o,n)}function $3(e,t,n="/"){return nG(e,t,n,!1)}function nG(e,t,n,o){let u=typeof t=="string"?Ay(t):t,d=up(u.pathname||"/",n);if(d==null)return null;let g=H3(e);rG(g);let i=null;for(let E=0;i==null&&E<g.length;++E){let P=pG(d);i=dG(g[E],P,o)}return i}function H3(e,t=[],n=[],o="",u=!1){let d=(g,i,E=u,P)=>{let I={relativePath:P===void 0?g.path||"":P,caseSensitive:g.caseSensitive===!0,childrenIndex:i,route:g};if(I.relativePath.startsWith("/")){if(!I.relativePath.startsWith(o)&&E)return;Ds(I.relativePath.startsWith(o),`Absolute route path "${I.relativePath}" nested under path "${o}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),I.relativePath=I.relativePath.slice(o.length)}let D=lp([o,I.relativePath]),F=n.concat(I);g.children&&g.children.length>0&&(Ds(g.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${D}".`),H3(g.children,t,F,D,E)),!(g.path==null&&!g.index)&&t.push({path:D,score:uG(D,g.index),routesMeta:F})};return e.forEach((g,i)=>{var E;if(g.path===""||!((E=g.path)!=null&&E.includes("?")))d(g,i);else for(let P of G3(g.path))d(g,i,!0,P)}),t}function G3(e){let t=e.split("/");if(t.length===0)return[];let[n,...o]=t,u=n.endsWith("?"),d=n.replace(/\?$/,"");if(o.length===0)return u?[d,""]:[d];let g=G3(o.join("/")),i=[];return i.push(...g.map(E=>E===""?d:[d,E].join("/"))),u&&i.push(...g),i.map(E=>e.startsWith("/")&&E===""?"/":E)}function rG(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:hG(t.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}var iG=/^:[\w-]+$/,sG=3,oG=2,aG=1,lG=10,cG=-2,lO=e=>e==="*";function uG(e,t){let n=e.split("/"),o=n.length;return n.some(lO)&&(o+=cG),t&&(o+=oG),n.filter(u=>!lO(u)).reduce((u,d)=>u+(iG.test(d)?sG:d===""?aG:lG),o)}function hG(e,t){return e.length===t.length&&e.slice(0,-1).every((o,u)=>o===t[u])?e[e.length-1]-t[t.length-1]:0}function dG(e,t,n=!1){let{routesMeta:o}=e,u={},d="/",g=[];for(let i=0;i<o.length;++i){let E=o[i],P=i===o.length-1,I=d==="/"?t:t.slice(d.length)||"/",D=r1({path:E.relativePath,caseSensitive:E.caseSensitive,end:P},I),F=E.route;if(!D&&P&&n&&!o[o.length-1].route.index&&(D=r1({path:E.relativePath,caseSensitive:E.caseSensitive,end:!1},I)),!D)return null;Object.assign(u,D.params),g.push({params:u,pathname:lp([d,D.pathname]),pathnameBase:yG(lp([d,D.pathnameBase])),route:F}),D.pathnameBase!=="/"&&(d=lp([d,D.pathnameBase]))}return g}function r1(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,o]=fG(e.path,e.caseSensitive,e.end),u=t.match(n);if(!u)return null;let d=u[0],g=d.replace(/(.)\/+$/,"$1"),i=u.slice(1);return{params:o.reduce((P,{paramName:I,isOptional:D},F)=>{if(I==="*"){let Z=i[F]||"";g=d.slice(0,d.length-Z.length).replace(/(.)\/+$/,"$1")}const $=i[F];return D&&!$?P[I]=void 0:P[I]=($||"").replace(/%2F/g,"/"),P},{}),pathname:d,pathnameBase:g,pattern:e}}function fG(e,t=!1,n=!0){Au(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let o=[],u="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,i,E)=>(o.push({paramName:i,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(o.push({paramName:"*"}),u+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?u+="\\/*$":e!==""&&e!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,t?void 0:"i"),o]}function pG(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Au(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function up(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,o=e.charAt(n);return o&&o!=="/"?null:e.slice(n)||"/"}function mG(e,t="/"){let{pathname:n,search:o="",hash:u=""}=typeof e=="string"?Ay(e):e;return{pathname:n?n.startsWith("/")?n:gG(n,t):t,search:vG(o),hash:xG(u)}}function gG(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(u=>{u===".."?n.length>1&&n.pop():u!=="."&&n.push(u)}),n.length>1?n.join("/"):"/"}function I2(e,t,n,o){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(o)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _G(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function eC(e){let t=_G(e);return t.map((n,o)=>o===t.length-1?n.pathname:n.pathnameBase)}function tC(e,t,n,o=!1){let u;typeof e=="string"?u=Ay(e):(u={...e},Ds(!u.pathname||!u.pathname.includes("?"),I2("?","pathname","search",u)),Ds(!u.pathname||!u.pathname.includes("#"),I2("#","pathname","hash",u)),Ds(!u.search||!u.search.includes("#"),I2("#","search","hash",u)));let d=e===""||u.pathname==="",g=d?"/":u.pathname,i;if(g==null)i=n;else{let D=t.length-1;if(!o&&g.startsWith("..")){let F=g.split("/");for(;F[0]==="..";)F.shift(),D-=1;u.pathname=F.join("/")}i=D>=0?t[D]:"/"}let E=mG(u,i),P=g&&g!=="/"&&g.endsWith("/"),I=(d||g===".")&&n.endsWith("/");return!E.pathname.endsWith("/")&&(P||I)&&(E.pathname+="/"),E}var lp=e=>e.join("/").replace(/\/\/+/g,"/"),yG=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),vG=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,xG=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function bG(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var W3=["POST","PUT","PATCH","DELETE"];new Set(W3);var wG=["GET",...W3];new Set(wG);var Cy=te.createContext(null);Cy.displayName="DataRouter";var ow=te.createContext(null);ow.displayName="DataRouterState";te.createContext(!1);var q3=te.createContext({isTransitioning:!1});q3.displayName="ViewTransition";var SG=te.createContext(new Map);SG.displayName="Fetchers";var TG=te.createContext(null);TG.displayName="Await";var Nh=te.createContext(null);Nh.displayName="Navigation";var jx=te.createContext(null);jx.displayName="Location";var Fh=te.createContext({outlet:null,matches:[],isDataRoute:!1});Fh.displayName="Route";var nC=te.createContext(null);nC.displayName="RouteError";function EG(e,{relative:t}={}){Ds(Py(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:o}=te.useContext(Nh),{hash:u,pathname:d,search:g}=zx(e,{relative:t}),i=d;return n!=="/"&&(i=d==="/"?n:lp([n,d])),o.createHref({pathname:i,search:g,hash:u})}function Py(){return te.useContext(jx)!=null}function Bh(){return Ds(Py(),"useLocation() may be used only in the context of a <Router> component."),te.useContext(jx).location}var Z3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function X3(e){te.useContext(Nh).static||te.useLayoutEffect(e)}function rC(){let{isDataRoute:e}=te.useContext(Fh);return e?NG():AG()}function AG(){Ds(Py(),"useNavigate() may be used only in the context of a <Router> component.");let e=te.useContext(Cy),{basename:t,navigator:n}=te.useContext(Nh),{matches:o}=te.useContext(Fh),{pathname:u}=Bh(),d=JSON.stringify(eC(o)),g=te.useRef(!1);return X3(()=>{g.current=!0}),te.useCallback((E,P={})=>{if(Au(g.current,Z3),!g.current)return;if(typeof E=="number"){n.go(E);return}let I=tC(E,JSON.parse(d),u,P.relative==="path");e==null&&t!=="/"&&(I.pathname=I.pathname==="/"?t:lp([t,I.pathname])),(P.replace?n.replace:n.push)(I,P.state,P)},[t,n,d,u,e])}te.createContext(null);function Y3(){let{matches:e}=te.useContext(Fh),t=e[e.length-1];return t?t.params:{}}function zx(e,{relative:t}={}){let{matches:n}=te.useContext(Fh),{pathname:o}=Bh(),u=JSON.stringify(eC(n));return te.useMemo(()=>tC(e,JSON.parse(u),o,t==="path"),[e,u,o,t])}function CG(e,t){return K3(e,t)}function K3(e,t,n,o,u){var le;Ds(Py(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:d}=te.useContext(Nh),{matches:g}=te.useContext(Fh),i=g[g.length-1],E=i?i.params:{},P=i?i.pathname:"/",I=i?i.pathnameBase:"/",D=i&&i.route;{let ue=D&&D.path||"";J3(P,!D||ue.endsWith("*")||ue.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${P}" (under <Route path="${ue}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ue}"> to <Route path="${ue==="/"?"*":`${ue}/*`}">.`)}let F=Bh(),$;if(t){let ue=typeof t=="string"?Ay(t):t;Ds(I==="/"||((le=ue.pathname)==null?void 0:le.startsWith(I)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${I}" but pathname "${ue.pathname}" was given in the \`location\` prop.`),$=ue}else $=F;let Z=$.pathname||"/",q=Z;if(I!=="/"){let ue=I.replace(/^\//,"").split("/");q="/"+Z.replace(/^\//,"").split("/").slice(ue.length).join("/")}let X=$3(e,{pathname:q});Au(D||X!=null,`No routes matched location "${$.pathname}${$.search}${$.hash}" `),Au(X==null||X[X.length-1].route.element!==void 0||X[X.length-1].route.Component!==void 0||X[X.length-1].route.lazy!==void 0,`Matched leaf route at location "${$.pathname}${$.search}${$.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let re=RG(X&&X.map(ue=>Object.assign({},ue,{params:Object.assign({},E,ue.params),pathname:lp([I,d.encodeLocation?d.encodeLocation(ue.pathname).pathname:ue.pathname]),pathnameBase:ue.pathnameBase==="/"?I:lp([I,d.encodeLocation?d.encodeLocation(ue.pathnameBase).pathname:ue.pathnameBase])})),g,n,o,u);return t&&re?te.createElement(jx.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...$},navigationType:"POP"}},re):re}function PG(){let e=zG(),t=bG(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o="rgba(200,200,200, 0.5)",u={padding:"0.5rem",backgroundColor:o},d={padding:"2px 4px",backgroundColor:o},g=null;return console.error("Error handled by React Router default ErrorBoundary:",e),g=te.createElement(te.Fragment,null,te.createElement("p",null," Hey developer "),te.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",te.createElement("code",{style:d},"ErrorBoundary")," or"," ",te.createElement("code",{style:d},"errorElement")," prop on your route.")),te.createElement(te.Fragment,null,te.createElement("h2",null,"Unexpected Application Error!"),te.createElement("h3",{style:{fontStyle:"italic"}},t),n?te.createElement("pre",{style:u},n):null,g)}var IG=te.createElement(PG,null),MG=class extends te.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error("React Router caught the following error during render",e)}render(){return this.state.error!==void 0?te.createElement(Fh.Provider,{value:this.props.routeContext},te.createElement(nC.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function kG({routeContext:e,match:t,children:n}){let o=te.useContext(Cy);return o&&o.static&&o.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=t.route.id),te.createElement(Fh.Provider,{value:e},n)}function RG(e,t=[],n=null,o=null,u=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let d=e,g=n==null?void 0:n.errors;if(g!=null){let P=d.findIndex(I=>I.route.id&&(g==null?void 0:g[I.route.id])!==void 0);Ds(P>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(g).join(",")}`),d=d.slice(0,Math.min(d.length,P+1))}let i=!1,E=-1;if(n)for(let P=0;P<d.length;P++){let I=d[P];if((I.route.HydrateFallback||I.route.hydrateFallbackElement)&&(E=P),I.route.id){let{loaderData:D,errors:F}=n,$=I.route.loader&&!D.hasOwnProperty(I.route.id)&&(!F||F[I.route.id]===void 0);if(I.route.lazy||$){i=!0,E>=0?d=d.slice(0,E+1):d=[d[0]];break}}}return d.reduceRight((P,I,D)=>{let F,$=!1,Z=null,q=null;n&&(F=g&&I.route.id?g[I.route.id]:void 0,Z=I.route.errorElement||IG,i&&(E<0&&D===0?(J3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),$=!0,q=null):E===D&&($=!0,q=I.route.hydrateFallbackElement||null)));let X=t.concat(d.slice(0,D+1)),re=()=>{let le;return F?le=Z:$?le=q:I.route.Component?le=te.createElement(I.route.Component,null):I.route.element?le=I.route.element:le=P,te.createElement(kG,{match:I,routeContext:{outlet:P,matches:X,isDataRoute:n!=null},children:le})};return n&&(I.route.ErrorBoundary||I.route.errorElement||D===0)?te.createElement(MG,{location:n.location,revalidation:n.revalidation,component:Z,error:F,children:re(),routeContext:{outlet:null,matches:X,isDataRoute:!0},unstable_onError:o}):re()},null)}function iC(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OG(e){let t=te.useContext(Cy);return Ds(t,iC(e)),t}function DG(e){let t=te.useContext(ow);return Ds(t,iC(e)),t}function LG(e){let t=te.useContext(Fh);return Ds(t,iC(e)),t}function sC(e){let t=LG(e),n=t.matches[t.matches.length-1];return Ds(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function jG(){return sC("useRouteId")}function zG(){var o;let e=te.useContext(nC),t=DG("useRouteError"),n=sC("useRouteError");return e!==void 0?e:(o=t.errors)==null?void 0:o[n]}function NG(){let{router:e}=OG("useNavigate"),t=sC("useNavigate"),n=te.useRef(!1);return X3(()=>{n.current=!0}),te.useCallback(async(u,d={})=>{Au(n.current,Z3),n.current&&(typeof u=="number"?e.navigate(u):await e.navigate(u,{fromRouteId:t,...d}))},[e,t])}var cO={};function J3(e,t,n){!t&&!cO[e]&&(cO[e]=!0,Au(!1,n))}te.memo(FG);function FG({routes:e,future:t,state:n,unstable_onError:o}){return K3(e,void 0,n,o,t)}function jE({to:e,replace:t,state:n,relative:o}){Ds(Py(),"<Navigate> may be used only in the context of a <Router> component.");let{static:u}=te.useContext(Nh);Au(!u,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:d}=te.useContext(Fh),{pathname:g}=Bh(),i=rC(),E=tC(e,eC(d),g,o==="path"),P=JSON.stringify(E);return te.useEffect(()=>{i(JSON.parse(P),{replace:t,state:n,relative:o})},[i,P,o,t,n]),null}function Kf(e){Ds(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function BG({basename:e="/",children:t=null,location:n,navigationType:o="POP",navigator:u,static:d=!1}){Ds(!Py(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let g=e.replace(/^\/*/,"/"),i=te.useMemo(()=>({basename:g,navigator:u,static:d,future:{}}),[g,u,d]);typeof n=="string"&&(n=Ay(n));let{pathname:E="/",search:P="",hash:I="",state:D=null,key:F="default"}=n,$=te.useMemo(()=>{let Z=up(E,g);return Z==null?null:{location:{pathname:Z,search:P,hash:I,state:D,key:F},navigationType:o}},[g,E,P,I,D,F,o]);return Au($!=null,`<Router basename="${g}"> is not able to match the URL "${E}${P}${I}" because it does not start with the basename, so the <Router> won't render anything.`),$==null?null:te.createElement(Nh.Provider,{value:i},te.createElement(jx.Provider,{children:t,value:$}))}function UG({children:e,location:t}){return CG(zE(e),t)}function zE(e,t=[]){let n=[];return te.Children.forEach(e,(o,u)=>{if(!te.isValidElement(o))return;let d=[...t,u];if(o.type===te.Fragment){n.push.apply(n,zE(o.props.children,d));return}Ds(o.type===Kf,`[${typeof o.type=="string"?o.type:o.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ds(!o.props.index||!o.props.children,"An index route cannot have child routes.");let g={id:o.props.id||d.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,hydrateFallbackElement:o.props.hydrateFallbackElement,HydrateFallback:o.props.HydrateFallback,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.hasErrorBoundary===!0||o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(g.children=zE(o.props.children,d)),n.push(g)}),n}var zb="get",Nb="application/x-www-form-urlencoded";function aw(e){return e!=null&&typeof e.tagName=="string"}function VG(e){return aw(e)&&e.tagName.toLowerCase()==="button"}function $G(e){return aw(e)&&e.tagName.toLowerCase()==="form"}function HG(e){return aw(e)&&e.tagName.toLowerCase()==="input"}function GG(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function WG(e,t){return e.button===0&&(!t||t==="_self")&&!GG(e)}function NE(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let o=e[n];return t.concat(Array.isArray(o)?o.map(u=>[n,u]):[[n,o]])},[]))}function qG(e,t){let n=NE(e);return t&&t.forEach((o,u)=>{n.has(u)||t.getAll(u).forEach(d=>{n.append(u,d)})}),n}var tb=null;function ZG(){if(tb===null)try{new FormData(document.createElement("form"),0),tb=!1}catch{tb=!0}return tb}var XG=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function M2(e){return e!=null&&!XG.has(e)?(Au(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nb}"`),null):e}function YG(e,t){let n,o,u,d,g;if($G(e)){let i=e.getAttribute("action");o=i?up(i,t):null,n=e.getAttribute("method")||zb,u=M2(e.getAttribute("enctype"))||Nb,d=new FormData(e)}else if(VG(e)||HG(e)&&(e.type==="submit"||e.type==="image")){let i=e.form;if(i==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let E=e.getAttribute("formaction")||i.getAttribute("action");if(o=E?up(E,t):null,n=e.getAttribute("formmethod")||i.getAttribute("method")||zb,u=M2(e.getAttribute("formenctype"))||M2(i.getAttribute("enctype"))||Nb,d=new FormData(i,e),!ZG()){let{name:P,type:I,value:D}=e;if(I==="image"){let F=P?`${P}.`:"";d.append(`${F}x`,"0"),d.append(`${F}y`,"0")}else P&&d.append(P,D)}}else{if(aw(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=zb,o=null,u=Nb,g=e}return d&&u==="text/plain"&&(g=d,d=void 0),{action:o,method:n.toLowerCase(),encType:u,formData:d,body:g}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function oC(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function KG(e,t,n){let o=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return o.pathname==="/"?o.pathname=`_root.${n}`:t&&up(o.pathname,t)==="/"?o.pathname=`${t.replace(/\/$/,"")}/_root.${n}`:o.pathname=`${o.pathname.replace(/\/$/,"")}.${n}`,o}async function JG(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function QG(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function eW(e,t,n){let o=await Promise.all(e.map(async u=>{let d=t.routes[u.route.id];if(d){let g=await JG(d,n);return g.links?g.links():[]}return[]}));return iW(o.flat(1).filter(QG).filter(u=>u.rel==="stylesheet"||u.rel==="preload").map(u=>u.rel==="stylesheet"?{...u,rel:"prefetch",as:"style"}:{...u,rel:"prefetch"}))}function uO(e,t,n,o,u,d){let g=(E,P)=>n[P]?E.route.id!==n[P].route.id:!0,i=(E,P)=>{var I;return n[P].pathname!==E.pathname||((I=n[P].route.path)==null?void 0:I.endsWith("*"))&&n[P].params["*"]!==E.params["*"]};return d==="assets"?t.filter((E,P)=>g(E,P)||i(E,P)):d==="data"?t.filter((E,P)=>{var D;let I=o.routes[E.route.id];if(!I||!I.hasLoader)return!1;if(g(E,P)||i(E,P))return!0;if(E.route.shouldRevalidate){let F=E.route.shouldRevalidate({currentUrl:new URL(u.pathname+u.search+u.hash,window.origin),currentParams:((D=n[0])==null?void 0:D.params)||{},nextUrl:new URL(e,window.origin),nextParams:E.params,defaultShouldRevalidate:!0});if(typeof F=="boolean")return F}return!0}):[]}function tW(e,t,{includeHydrateFallback:n}={}){return nW(e.map(o=>{let u=t.routes[o.route.id];if(!u)return[];let d=[u.module];return u.clientActionModule&&(d=d.concat(u.clientActionModule)),u.clientLoaderModule&&(d=d.concat(u.clientLoaderModule)),n&&u.hydrateFallbackModule&&(d=d.concat(u.hydrateFallbackModule)),u.imports&&(d=d.concat(u.imports)),d}).flat(1))}function nW(e){return[...new Set(e)]}function rW(e){let t={},n=Object.keys(e).sort();for(let o of n)t[o]=e[o];return t}function iW(e,t){let n=new Set;return new Set(t),e.reduce((o,u)=>{let d=JSON.stringify(rW(u));return n.has(d)||(n.add(d),o.push({key:d,link:u})),o},[])}function Q3(){let e=te.useContext(Cy);return oC(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function sW(){let e=te.useContext(ow);return oC(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var aC=te.createContext(void 0);aC.displayName="FrameworkContext";function eF(){let e=te.useContext(aC);return oC(e,"You must render this element inside a <HydratedRouter> element"),e}function oW(e,t){let n=te.useContext(aC),[o,u]=te.useState(!1),[d,g]=te.useState(!1),{onFocus:i,onBlur:E,onMouseEnter:P,onMouseLeave:I,onTouchStart:D}=t,F=te.useRef(null);te.useEffect(()=>{if(e==="render"&&g(!0),e==="viewport"){let q=re=>{re.forEach(le=>{g(le.isIntersecting)})},X=new IntersectionObserver(q,{threshold:.5});return F.current&&X.observe(F.current),()=>{X.disconnect()}}},[e]),te.useEffect(()=>{if(o){let q=setTimeout(()=>{g(!0)},100);return()=>{clearTimeout(q)}}},[o]);let $=()=>{u(!0)},Z=()=>{u(!1),g(!1)};return n?e!=="intent"?[d,F,{}]:[d,F,{onFocus:Rv(i,$),onBlur:Rv(E,Z),onMouseEnter:Rv(P,$),onMouseLeave:Rv(I,Z),onTouchStart:Rv(D,$)}]:[!1,F,{}]}function Rv(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function aW({page:e,...t}){let{router:n}=Q3(),o=te.useMemo(()=>$3(n.routes,e,n.basename),[n.routes,e,n.basename]);return o?te.createElement(cW,{page:e,matches:o,...t}):null}function lW(e){let{manifest:t,routeModules:n}=eF(),[o,u]=te.useState([]);return te.useEffect(()=>{let d=!1;return eW(e,t,n).then(g=>{d||u(g)}),()=>{d=!0}},[e,t,n]),o}function cW({page:e,matches:t,...n}){let o=Bh(),{manifest:u,routeModules:d}=eF(),{basename:g}=Q3(),{loaderData:i,matches:E}=sW(),P=te.useMemo(()=>uO(e,t,E,u,o,"data"),[e,t,E,u,o]),I=te.useMemo(()=>uO(e,t,E,u,o,"assets"),[e,t,E,u,o]),D=te.useMemo(()=>{if(e===o.pathname+o.search+o.hash)return[];let Z=new Set,q=!1;if(t.forEach(re=>{var ue;let le=u.routes[re.route.id];!le||!le.hasLoader||(!P.some(ye=>ye.route.id===re.route.id)&&re.route.id in i&&((ue=d[re.route.id])!=null&&ue.shouldRevalidate)||le.hasClientLoader?q=!0:Z.add(re.route.id))}),Z.size===0)return[];let X=KG(e,g,"data");return q&&Z.size>0&&X.searchParams.set("_routes",t.filter(re=>Z.has(re.route.id)).map(re=>re.route.id).join(",")),[X.pathname+X.search]},[g,i,o,u,P,t,e,d]),F=te.useMemo(()=>tW(I,u),[I,u]),$=lW(I);return te.createElement(te.Fragment,null,D.map(Z=>te.createElement("link",{key:Z,rel:"prefetch",as:"fetch",href:Z,...n})),F.map(Z=>te.createElement("link",{key:Z,rel:"modulepreload",href:Z,...n})),$.map(({key:Z,link:q})=>te.createElement("link",{key:Z,nonce:n.nonce,...q})))}function uW(...e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}var tF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{tF&&(window.__reactRouterVersion="7.9.1")}catch{}function hW({basename:e,children:t,window:n}){let o=te.useRef();o.current==null&&(o.current=JH({window:n,v5Compat:!0}));let u=o.current,[d,g]=te.useState({action:u.action,location:u.location}),i=te.useCallback(E=>{te.startTransition(()=>g(E))},[g]);return te.useLayoutEffect(()=>u.listen(i),[u,i]),te.createElement(BG,{basename:e,children:t,location:d.location,navigationType:d.action,navigator:u})}var nF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,La=te.forwardRef(function({onClick:t,discover:n="render",prefetch:o="none",relative:u,reloadDocument:d,replace:g,state:i,target:E,to:P,preventScrollReset:I,viewTransition:D,...F},$){let{basename:Z}=te.useContext(Nh),q=typeof P=="string"&&nF.test(P),X,re=!1;if(typeof P=="string"&&q&&(X=P,tF))try{let Ge=new URL(window.location.href),gt=P.startsWith("//")?new URL(Ge.protocol+P):new URL(P),lt=up(gt.pathname,Z);gt.origin===Ge.origin&&lt!=null?P=lt+gt.search+gt.hash:re=!0}catch{Au(!1,`<Link to="${P}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let le=EG(P,{relative:u}),[ue,ye,ge]=oW(o,F),we=mW(P,{replace:g,state:i,target:E,preventScrollReset:I,relative:u,viewTransition:D});function Le(Ge){t&&t(Ge),Ge.defaultPrevented||we(Ge)}let Ze=te.createElement("a",{...F,...ge,href:X||le,onClick:re||d?t:Le,ref:uW($,ye),target:E,"data-discover":!q&&n==="render"?"true":void 0});return ue&&!q?te.createElement(te.Fragment,null,Ze,te.createElement(aW,{page:le})):Ze});La.displayName="Link";var dW=te.forwardRef(function({"aria-current":t="page",caseSensitive:n=!1,className:o="",end:u=!1,style:d,to:g,viewTransition:i,children:E,...P},I){let D=zx(g,{relative:P.relative}),F=Bh(),$=te.useContext(ow),{navigator:Z,basename:q}=te.useContext(Nh),X=$!=null&&xW(D)&&i===!0,re=Z.encodeLocation?Z.encodeLocation(D).pathname:D.pathname,le=F.pathname,ue=$&&$.navigation&&$.navigation.location?$.navigation.location.pathname:null;n||(le=le.toLowerCase(),ue=ue?ue.toLowerCase():null,re=re.toLowerCase()),ue&&q&&(ue=up(ue,q)||ue);const ye=re!=="/"&&re.endsWith("/")?re.length-1:re.length;let ge=le===re||!u&&le.startsWith(re)&&le.charAt(ye)==="/",we=ue!=null&&(ue===re||!u&&ue.startsWith(re)&&ue.charAt(re.length)==="/"),Le={isActive:ge,isPending:we,isTransitioning:X},Ze=ge?t:void 0,Ge;typeof o=="function"?Ge=o(Le):Ge=[o,ge?"active":null,we?"pending":null,X?"transitioning":null].filter(Boolean).join(" ");let gt=typeof d=="function"?d(Le):d;return te.createElement(La,{...P,"aria-current":Ze,className:Ge,ref:I,style:gt,to:g,viewTransition:i},typeof E=="function"?E(Le):E)});dW.displayName="NavLink";var fW=te.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:o,replace:u,state:d,method:g=zb,action:i,onSubmit:E,relative:P,preventScrollReset:I,viewTransition:D,...F},$)=>{let Z=yW(),q=vW(i,{relative:P}),X=g.toLowerCase()==="get"?"get":"post",re=typeof i=="string"&&nF.test(i),le=ue=>{if(E&&E(ue),ue.defaultPrevented)return;ue.preventDefault();let ye=ue.nativeEvent.submitter,ge=(ye==null?void 0:ye.getAttribute("formmethod"))||g;Z(ye||ue.currentTarget,{fetcherKey:t,method:ge,navigate:n,replace:u,state:d,relative:P,preventScrollReset:I,viewTransition:D})};return te.createElement("form",{ref:$,method:X,action:q,onSubmit:o?E:le,...F,"data-discover":!re&&e==="render"?"true":void 0})});fW.displayName="Form";function pW(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rF(e){let t=te.useContext(Cy);return Ds(t,pW(e)),t}function mW(e,{target:t,replace:n,state:o,preventScrollReset:u,relative:d,viewTransition:g}={}){let i=rC(),E=Bh(),P=zx(e,{relative:d});return te.useCallback(I=>{if(WG(I,t)){I.preventDefault();let D=n!==void 0?n:hx(E)===hx(P);i(e,{replace:D,state:o,preventScrollReset:u,relative:d,viewTransition:g})}},[E,i,P,n,o,t,e,u,d,g])}function iF(e){Au(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=te.useRef(NE(e)),n=te.useRef(!1),o=Bh(),u=te.useMemo(()=>qG(o.search,n.current?null:t.current),[o.search]),d=rC(),g=te.useCallback((i,E)=>{const P=NE(typeof i=="function"?i(new URLSearchParams(u)):i);n.current=!0,d("?"+P,E)},[d,u]);return[u,g]}var gW=0,_W=()=>`__${String(++gW)}__`;function yW(){let{router:e}=rF("useSubmit"),{basename:t}=te.useContext(Nh),n=jG();return te.useCallback(async(o,u={})=>{let{action:d,method:g,encType:i,formData:E,body:P}=YG(o,t);if(u.navigate===!1){let I=u.fetcherKey||_W();await e.fetch(I,n,u.action||d,{preventScrollReset:u.preventScrollReset,formData:E,body:P,formMethod:u.method||g,formEncType:u.encType||i,flushSync:u.flushSync})}else await e.navigate(u.action||d,{preventScrollReset:u.preventScrollReset,formData:E,body:P,formMethod:u.method||g,formEncType:u.encType||i,replace:u.replace,state:u.state,fromRouteId:n,flushSync:u.flushSync,viewTransition:u.viewTransition})},[e,t,n])}function vW(e,{relative:t}={}){let{basename:n}=te.useContext(Nh),o=te.useContext(Fh);Ds(o,"useFormAction must be used inside a RouteContext");let[u]=o.matches.slice(-1),d={...zx(e||".",{relative:t})},g=Bh();if(e==null){d.search=g.search;let i=new URLSearchParams(d.search),E=i.getAll("index");if(E.some(I=>I==="")){i.delete("index"),E.filter(D=>D).forEach(D=>i.append("index",D));let I=i.toString();d.search=I?`?${I}`:""}}return(!e||e===".")&&u.route.index&&(d.search=d.search?d.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(d.pathname=d.pathname==="/"?n:lp([n,d.pathname])),hx(d)}function xW(e,{relative:t}={}){let n=te.useContext(q3);Ds(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:o}=rF("useViewTransitionState"),u=zx(e,{relative:t});if(!n.isTransitioning)return!1;let d=up(n.currentLocation.pathname,o)||n.currentLocation.pathname,g=up(n.nextLocation.pathname,o)||n.nextLocation.pathname;return r1(u.pathname,g)!=null||r1(u.pathname,d)!=null}var sF=V3();/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bW=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wW=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,o)=>o?o.toUpperCase():n.toLowerCase()),hO=e=>{const t=wW(e);return t.charAt(0).toUpperCase()+t.slice(1)},oF=(...e)=>e.filter((t,n,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===n).join(" ").trim(),SW=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var TW={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EW=te.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:u="",children:d,iconNode:g,...i},E)=>te.createElement("svg",{ref:E,...TW,width:t,height:t,stroke:e,strokeWidth:o?Number(n)*24/Number(t):n,className:oF("lucide",u),...!d&&!SW(i)&&{"aria-hidden":"true"},...i},[...g.map(([P,I])=>te.createElement(P,I)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=(e,t)=>{const n=te.forwardRef(({className:o,...u},d)=>te.createElement(EW,{ref:d,iconNode:t,className:oF(`lucide-${bW(hO(e))}`,`lucide-${e}`,o),...u}));return n.displayName=hO(e),n};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AW=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],uy=Qn("activity",AW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CW=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],aF=Qn("arrow-left",CW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PW=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],IW=Qn("arrow-right",PW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MW=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],kW=Qn("award",MW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RW=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],dO=Qn("briefcase",RW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OW=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],DW=Qn("building-2",OW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LW=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],lF=Qn("building",LW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jW=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],hp=Qn("calendar",jW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zW=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],NW=Qn("chart-line",zW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FW=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],lC=Qn("chart-column",FW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BW=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 16c.5-2 1.5-7 4-7 2 0 2 3 4 3 2.5 0 4.5-5 5-7",key:"lw07rv"}]],cF=Qn("chart-spline",BW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UW=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],s_=Qn("check",UW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VW=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Iy=Qn("chevron-down",VW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $W=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],cC=Qn("chevron-left",$W);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HW=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Fd=Qn("chevron-right",HW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GW=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],uF=Qn("chevron-up",GW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WW=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Sm=Qn("circle-alert",WW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qW=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ZW=Qn("circle-check-big",qW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XW=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],fO=Qn("circle-check",XW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YW=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],KW=Qn("circle-help",YW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JW=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pO=Qn("circle",JW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QW=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Wg=Qn("clock",QW);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e7=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],lw=Qn("cloud-off",e7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t7=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M3 20a5 5 0 1 1 8.9-4H13a3 3 0 0 1 2 5.24",key:"1qmrp3"}],["path",{d:"M11 20v2",key:"174qtz"}],["path",{d:"M7 19v2",key:"12npes"}]],hF=Qn("cloud-sun-rain",t7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n7=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],qg=Qn("cloud",n7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r7=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],hy=Qn("database",r7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i7=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],s7=Qn("download",i7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o7=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],Zg=Qn("droplets",o7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a7=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Nd=Qn("external-link",a7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l7=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],k2=Qn("eye-off",l7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c7=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Fb=Qn("eye",c7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u7=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],h7=Qn("funnel",u7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d7=[["path",{d:"M22 5V2l-5.89 5.89",key:"1eenpo"}],["circle",{cx:"16.6",cy:"15.89",r:"3",key:"xjtalx"}],["circle",{cx:"8.11",cy:"7.4",r:"3",key:"u2fv6i"}],["circle",{cx:"12.35",cy:"11.65",r:"3",key:"i6i8g7"}],["circle",{cx:"13.91",cy:"5.85",r:"3",key:"6ye0dv"}],["circle",{cx:"18.15",cy:"10.09",r:"3",key:"snx9no"}],["circle",{cx:"6.56",cy:"13.2",r:"3",key:"17x4xg"}],["circle",{cx:"10.8",cy:"17.44",r:"3",key:"1hogw9"}],["circle",{cx:"5",cy:"19",r:"3",key:"1sn6vo"}]],$d=Qn("grape",d7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f7=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],dF=Qn("history",f7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p7=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],uC=Qn("info",p7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m7=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],R2=Qn("layers",m7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g7=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],_7=Qn("layout-dashboard",g7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y7=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],v7=Qn("leaf",y7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x7=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],O2=Qn("lock",x7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b7=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],mO=Qn("log-out",b7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w7=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],cw=Qn("mail",w7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S7=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],aa=Qn("map-pin",S7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T7=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],gO=Qn("map",T7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E7=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],A7=Qn("menu",E7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C7=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],P7=Qn("message-square",C7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I7=[["path",{d:"M5 12h14",key:"1ays0h"}]],fF=Qn("minus",I7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M7=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],k7=Qn("moon",M7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R7=[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]],O7=Qn("mountain",R7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D7=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],L7=Qn("plus",D7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j7=[["path",{d:"M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5",key:"x6z5xu"}],["path",{d:"M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12",key:"1x4zh5"}],["path",{d:"m14 16-3 3 3 3",key:"f6jyew"}],["path",{d:"M8.293 13.596 7.196 9.5 3.1 10.598",key:"wf1obh"}],["path",{d:"m9.344 5.811 1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.784 1.784 0 0 1 1.546.888l3.943 6.843",key:"9tzpgr"}],["path",{d:"m13.378 9.633 4.096 1.098 1.097-4.096",key:"1oe83g"}]],z7=Qn("recycle",j7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N7=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],sc=Qn("refresh-cw",N7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F7=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],B7=Qn("save",F7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U7=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],V7=Qn("search",U7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $7=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],H7=Qn("send",$7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G7=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],_O=Qn("settings",G7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W7=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],pF=Qn("shield-alert",W7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q7=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],dy=Qn("shield-check",q7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z7=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]],X7=Qn("shield-x",Z7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y7=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Fg=Qn("shield",Y7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K7=[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]],J7=Qn("sprout",K7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q7=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Xg=Qn("sun",Q7);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eq=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],tq=Qn("target",eq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nq=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],fy=Qn("thermometer",nq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rq=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],mF=Qn("trending-down",rq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iq=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],Am=Qn("trending-up",iq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sq=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],o_=Qn("triangle-alert",sq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oq=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],aq=Qn("user-check",oq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lq=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],cq=Qn("user-plus",lq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uq=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Bb=Qn("user",uq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hq=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],FE=Qn("users",hq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dq=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],fq=Qn("wifi",dq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pq=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],mq=Qn("wind",pq);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gq=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],hl=Qn("x",gq);var Ub={exports:{}},_q=Ub.exports,yO;function yq(){return yO||(yO=1,(function(e,t){(function(n,o){e.exports=o()})(_q,(function(){var n,o,u;function d(i,E){if(!n)n=E;else if(!o)o=E;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",I={};n(I),u=E(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}d(["exports"],(function(i){var E=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function I(l,r){var a=r[0],h=r[1],f=r[2],_=r[3],y=a*_-f*h;return y?(l[0]=_*(y=1/y),l[1]=-h*y,l[2]=-f*y,l[3]=a*y,l):null}function D(){var l=new P(9);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function F(l,r){var a=r[0],h=r[1],f=r[2],_=r[3],y=r[4],T=r[5],C=r[6],k=r[7],L=r[8];return l[0]=y*L-T*k,l[1]=f*k-h*L,l[2]=h*T-f*y,l[3]=T*C-_*L,l[4]=a*L-f*C,l[5]=f*_-a*T,l[6]=_*k-y*C,l[7]=h*C-a*k,l[8]=a*y-h*_,l}function $(l,r,a){var h=r[0],f=r[1],_=r[2],y=r[3],T=r[4],C=r[5],k=r[6],L=r[7],j=r[8],N=a[0],H=a[1],W=a[2],ee=a[3],ie=a[4],se=a[5],fe=a[6],pe=a[7],_e=a[8];return l[0]=N*h+H*y+W*k,l[1]=N*f+H*T+W*L,l[2]=N*_+H*C+W*j,l[3]=ee*h+ie*y+se*k,l[4]=ee*f+ie*T+se*L,l[5]=ee*_+ie*C+se*j,l[6]=fe*h+pe*y+_e*k,l[7]=fe*f+pe*T+_e*L,l[8]=fe*_+pe*C+_e*j,l}function Z(){var l=new P(16);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function q(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function X(l,r){var a=r[0],h=r[1],f=r[2],_=r[3],y=r[4],T=r[5],C=r[6],k=r[7],L=r[8],j=r[9],N=r[10],H=r[11],W=r[12],ee=r[13],ie=r[14],se=r[15],fe=a*T-h*y,pe=a*C-f*y,_e=a*k-_*y,ke=h*C-f*T,Re=h*k-_*T,Ne=f*k-_*C,Fe=L*ee-j*W,Ue=L*ie-N*W,ft=L*se-H*W,We=j*ie-N*ee,mt=j*se-H*ee,Ct=N*se-H*ie,yt=fe*Ct-pe*mt+_e*We+ke*ft-Re*Ue+Ne*Fe;return yt?(l[0]=(T*Ct-C*mt+k*We)*(yt=1/yt),l[1]=(f*mt-h*Ct-_*We)*yt,l[2]=(ee*Ne-ie*Re+se*ke)*yt,l[3]=(N*Re-j*Ne-H*ke)*yt,l[4]=(C*ft-y*Ct-k*Ue)*yt,l[5]=(a*Ct-f*ft+_*Ue)*yt,l[6]=(ie*_e-W*Ne-se*pe)*yt,l[7]=(L*Ne-N*_e+H*pe)*yt,l[8]=(y*mt-T*ft+k*Fe)*yt,l[9]=(h*ft-a*mt-_*Fe)*yt,l[10]=(W*Re-ee*_e+se*fe)*yt,l[11]=(j*_e-L*Re-H*fe)*yt,l[12]=(T*Ue-y*We-C*Fe)*yt,l[13]=(a*We-h*Ue+f*Fe)*yt,l[14]=(ee*pe-W*ke-ie*fe)*yt,l[15]=(L*ke-j*pe+N*fe)*yt,l):null}function re(l,r,a){var h=r[0],f=r[1],_=r[2],y=r[3],T=r[4],C=r[5],k=r[6],L=r[7],j=r[8],N=r[9],H=r[10],W=r[11],ee=r[12],ie=r[13],se=r[14],fe=r[15],pe=a[0],_e=a[1],ke=a[2],Re=a[3];return l[0]=pe*h+_e*T+ke*j+Re*ee,l[1]=pe*f+_e*C+ke*N+Re*ie,l[2]=pe*_+_e*k+ke*H+Re*se,l[3]=pe*y+_e*L+ke*W+Re*fe,l[4]=(pe=a[4])*h+(_e=a[5])*T+(ke=a[6])*j+(Re=a[7])*ee,l[5]=pe*f+_e*C+ke*N+Re*ie,l[6]=pe*_+_e*k+ke*H+Re*se,l[7]=pe*y+_e*L+ke*W+Re*fe,l[8]=(pe=a[8])*h+(_e=a[9])*T+(ke=a[10])*j+(Re=a[11])*ee,l[9]=pe*f+_e*C+ke*N+Re*ie,l[10]=pe*_+_e*k+ke*H+Re*se,l[11]=pe*y+_e*L+ke*W+Re*fe,l[12]=(pe=a[12])*h+(_e=a[13])*T+(ke=a[14])*j+(Re=a[15])*ee,l[13]=pe*f+_e*C+ke*N+Re*ie,l[14]=pe*_+_e*k+ke*H+Re*se,l[15]=pe*y+_e*L+ke*W+Re*fe,l}function le(l,r,a){var h,f,_,y,T,C,k,L,j,N,H,W,ee=a[0],ie=a[1],se=a[2];return r===l?(l[12]=r[0]*ee+r[4]*ie+r[8]*se+r[12],l[13]=r[1]*ee+r[5]*ie+r[9]*se+r[13],l[14]=r[2]*ee+r[6]*ie+r[10]*se+r[14],l[15]=r[3]*ee+r[7]*ie+r[11]*se+r[15]):(f=r[1],_=r[2],y=r[3],T=r[4],C=r[5],k=r[6],L=r[7],j=r[8],N=r[9],H=r[10],W=r[11],l[0]=h=r[0],l[1]=f,l[2]=_,l[3]=y,l[4]=T,l[5]=C,l[6]=k,l[7]=L,l[8]=j,l[9]=N,l[10]=H,l[11]=W,l[12]=h*ee+T*ie+j*se+r[12],l[13]=f*ee+C*ie+N*se+r[13],l[14]=_*ee+k*ie+H*se+r[14],l[15]=y*ee+L*ie+W*se+r[15]),l}function ue(l,r,a){var h=a[0],f=a[1],_=a[2];return l[0]=r[0]*h,l[1]=r[1]*h,l[2]=r[2]*h,l[3]=r[3]*h,l[4]=r[4]*f,l[5]=r[5]*f,l[6]=r[6]*f,l[7]=r[7]*f,l[8]=r[8]*_,l[9]=r[9]*_,l[10]=r[10]*_,l[11]=r[11]*_,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l}function ye(l,r,a){var h=Math.sin(a),f=Math.cos(a),_=r[4],y=r[5],T=r[6],C=r[7],k=r[8],L=r[9],j=r[10],N=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=_*f+k*h,l[5]=y*f+L*h,l[6]=T*f+j*h,l[7]=C*f+N*h,l[8]=k*f-_*h,l[9]=L*f-y*h,l[10]=j*f-T*h,l[11]=N*f-C*h,l}function ge(l,r,a){var h=Math.sin(a),f=Math.cos(a),_=r[0],y=r[1],T=r[2],C=r[3],k=r[8],L=r[9],j=r[10],N=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=_*f-k*h,l[1]=y*f-L*h,l[2]=T*f-j*h,l[3]=C*f-N*h,l[8]=_*h+k*f,l[9]=y*h+L*f,l[10]=T*h+j*f,l[11]=C*h+N*f,l}function we(l,r,a){var h=Math.sin(a),f=Math.cos(a),_=r[0],y=r[1],T=r[2],C=r[3],k=r[4],L=r[5],j=r[6],N=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=_*f+k*h,l[1]=y*f+L*h,l[2]=T*f+j*h,l[3]=C*f+N*h,l[4]=k*f-_*h,l[5]=L*f-y*h,l[6]=j*f-T*h,l[7]=N*f-C*h,l}function Le(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Ze(l,r,a){var h,f,_,y=a[0],T=a[1],C=a[2],k=Math.sqrt(y*y+T*T+C*C);return k<E?null:(y*=k=1/k,T*=k,C*=k,h=Math.sin(r),f=Math.cos(r),l[0]=y*y*(_=1-f)+f,l[1]=T*y*_+C*h,l[2]=C*y*_-T*h,l[3]=0,l[4]=y*T*_-C*h,l[5]=T*T*_+f,l[6]=C*T*_+y*h,l[7]=0,l[8]=y*C*_+T*h,l[9]=T*C*_-y*h,l[10]=C*C*_+f,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function Ge(l,r){var a=r[0],h=r[1],f=r[2],_=r[3],y=a+a,T=h+h,C=f+f,k=a*y,L=h*y,j=h*T,N=f*y,H=f*T,W=f*C,ee=_*y,ie=_*T,se=_*C;return l[0]=1-j-W,l[1]=L+se,l[2]=N-ie,l[3]=0,l[4]=L-se,l[5]=1-k-W,l[6]=H+ee,l[7]=0,l[8]=N+ie,l[9]=H-ee,l[10]=1-k-j,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var gt=re;function lt(){var l=new P(3);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function qe(l){var r=new P(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r}function en(l){var r=l[0],a=l[1],h=l[2];return Math.sqrt(r*r+a*a+h*h)}function Jt(l,r,a){var h=new P(3);return h[0]=l,h[1]=r,h[2]=a,h}function Nt(l,r,a,h){return l[0]=r,l[1]=a,l[2]=h,l}function St(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l[2]=r[2]+a[2],l}function an(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l[2]=r[2]-a[2],l}function Kt(l,r,a){return l[0]=r[0]*a[0],l[1]=r[1]*a[1],l[2]=r[2]*a[2],l}function hn(l,r,a){return l[0]=Math.min(r[0],a[0]),l[1]=Math.min(r[1],a[1]),l[2]=Math.min(r[2],a[2]),l}function Xt(l,r,a){return l[0]=Math.max(r[0],a[0]),l[1]=Math.max(r[1],a[1]),l[2]=Math.max(r[2],a[2]),l}function et(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l}function zt(l,r,a,h){return l[0]=r[0]+a[0]*h,l[1]=r[1]+a[1]*h,l[2]=r[2]+a[2]*h,l}function Zn(l,r){var a=r[0]-l[0],h=r[1]-l[1],f=r[2]-l[2];return a*a+h*h+f*f}function $n(l){var r=l[0],a=l[1],h=l[2];return r*r+a*a+h*h}function fr(l,r){return l[0]=-r[0],l[1]=-r[1],l[2]=-r[2],l}function kn(l,r){var a=r[0],h=r[1],f=r[2],_=a*a+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),l[0]=r[0]*_,l[1]=r[1]*_,l[2]=r[2]*_,l}function Bt(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]}function En(l,r,a){var h=r[0],f=r[1],_=r[2],y=a[0],T=a[1],C=a[2];return l[0]=f*C-_*T,l[1]=_*y-h*C,l[2]=h*T-f*y,l}function Tt(l,r,a,h){var f=r[0],_=r[1],y=r[2];return l[0]=f+h*(a[0]-f),l[1]=_+h*(a[1]-_),l[2]=y+h*(a[2]-y),l}function wn(l,r,a){var h=r[0],f=r[1],_=r[2],y=a[3]*h+a[7]*f+a[11]*_+a[15];return l[0]=(a[0]*h+a[4]*f+a[8]*_+a[12])/(y=y||1),l[1]=(a[1]*h+a[5]*f+a[9]*_+a[13])/y,l[2]=(a[2]*h+a[6]*f+a[10]*_+a[14])/y,l}function mr(l,r,a){var h=r[0],f=r[1],_=r[2];return l[0]=h*a[0]+f*a[3]+_*a[6],l[1]=h*a[1]+f*a[4]+_*a[7],l[2]=h*a[2]+f*a[5]+_*a[8],l}function tn(l,r,a){var h=a[0],f=a[1],_=a[2],y=a[3],T=r[0],C=r[1],k=r[2],L=f*k-_*C,j=_*T-h*k,N=h*C-f*T;return l[0]=T+y*(L+=L)+f*(N+=N)-_*(j+=j),l[1]=C+y*j+_*L-h*N,l[2]=k+y*N+h*j-f*L,l}function Ii(l){return l[0]=0,l[1]=0,l[2]=0,l}function Hn(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]}var nr=an,Mi=Kt,Sn=en;function si(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Fi(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l[3]=r[3]*a,l}function js(l,r){var a=r[0],h=r[1],f=r[2],_=r[3],y=a*a+h*h+f*f+_*_;return y>0&&(y=1/Math.sqrt(y)),l[0]=a*y,l[1]=h*y,l[2]=f*y,l[3]=_*y,l}function us(l,r,a){var h=r[0],f=r[1],_=r[2],y=r[3];return l[0]=a[0]*h+a[4]*f+a[8]*_+a[12]*y,l[1]=a[1]*h+a[5]*f+a[9]*_+a[13]*y,l[2]=a[2]*h+a[6]*f+a[10]*_+a[14]*y,l[3]=a[3]*h+a[7]*f+a[11]*_+a[15]*y,l}function ha(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function ja(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function za(l,r,a){a*=.5;var h=r[0],f=r[1],_=r[2],y=r[3],T=Math.sin(a),C=Math.cos(a);return l[0]=h*C+y*T,l[1]=f*C+_*T,l[2]=_*C-f*T,l[3]=y*C-h*T,l}function Na(l,r,a){a*=.5;var h=r[0],f=r[1],_=r[2],y=r[3],T=Math.sin(a),C=Math.cos(a);return l[0]=h*C-_*T,l[1]=f*C+y*T,l[2]=_*C+h*T,l[3]=y*C-f*T,l}lt(),si();var Es,zs,fl,Fa=js,no=(Es=lt(),zs=Jt(1,0,0),fl=Jt(0,1,0),function(l,r,a){var h=Bt(r,a);return h<-.999999?(En(Es,zs,r),Sn(Es)<1e-6&&En(Es,fl,r),kn(Es,Es),(function(f,_,y){y*=.5;var T=Math.sin(y);f[0]=T*_[0],f[1]=T*_[1],f[2]=T*_[2],f[3]=Math.cos(y)})(l,Es,Math.PI),l):h>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(En(Es,r,a),l[0]=Es[0],l[1]=Es[1],l[2]=Es[2],l[3]=1+h,Fa(l,l))});function os(){var l=new P(2);return P!=Float32Array&&(l[0]=0,l[1]=0),l}function pl(l,r){var a=new P(2);return a[0]=l,a[1]=r,a}function $h(l,r,a){return l[0]=r,l[1]=a,l}function ac(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l}function Ol(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l}function ml(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l}function lc(l){var r=l[0],a=l[1];return Math.sqrt(r*r+a*a)}function vi(l,r){var a=r[0],h=r[1],f=a*a+h*h;return f>0&&(f=1/Math.sqrt(f)),l[0]=r[0]*f,l[1]=r[1]*f,l}function hs(l,r){return l[0]*r[0]+l[1]*r[1]}ha(),ha(),D();var ku,Ba,_o=Ol;function Hh(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}os();var Gh=(function(){if(Ba)return ku;function l(r,a,h,f){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=h,this.p2y=f}return Ba=1,ku=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(a===void 0&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,f=0;f<8;f++){var _=this.sampleCurveX(h)-r;if(Math.abs(_)<a)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var T=0,C=1;for(h=r,f=0;f<20&&(_=this.sampleCurveX(h),!(Math.abs(_-r)<a));f++)r>_?T=h:C=h,h=.5*(C-T)+T;return h},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},ku})(),Wd=Hh(Gh);function It(l,r){this.x=l,this.y=r}function Dl(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(!Dl(l[a],r[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const a in l)if(!Dl(l[a],r[a]))return!1;return!0}return l===r}It.prototype={clone(){return new It(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,a=l.y-this.y;return r*r+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),a=Math.sin(l),h=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=h,this},_rotateAround(l,r){const a=Math.cos(l),h=Math.sin(l),f=r.y+h*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-h*(this.y-r.y),this.y=f,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:It},It.convert=function(l){if(l instanceof It)return l;if(Array.isArray(l))return new It(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new It(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const qd=Math.PI/180,Ru=180/Math.PI;function $e(l){return l*qd}function oe(l){return l*Ru}const de=[[0,0],[1,0],[1,1],[0,1]];function Se(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,a=r*l;return 4*(l<.5?a:3*(l-r)+a-.75)}function ze(l,r,a,h){const f=new Wd(l,r,a,h);return function(_){return f.solve(_)}}const De=ze(.25,.1,.25,1);function Oe(l,r,a){return Math.min(a,Math.max(r,l))}function rt(l,r,a){return(a=Oe((a-l)/(r-l),0,1))*a*(3-2*a)}function Ve(l,r,a){const h=a-r,f=((l-r)%h+h)%h+r;return f===r?a:f}function ot(l,r,a){if(!l.length)return a(null,[]);let h=l.length;const f=new Array(l.length);let _=null;l.forEach(((y,T)=>{r(y,((C,k)=>{C&&(_=C),f[T]=k,--h==0&&a(_,f)}))}))}let jt=1;function _t(){return jt++}function gn(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function Rn(l,r){l.forEach((a=>{r[a]&&(r[a]=r[a].bind(r))}))}function Fn(l,r,a){const h={};for(const f in l)h[f]=r.call(this,l[f],f,l);return h}function gr(l,r,a){const h={};for(const f in l)r.call(this,l[f],f,l)&&(h[f]=l[f]);return h}function or(l){return Array.isArray(l)?l.map(or):typeof l=="object"&&l?Fn(l,or):l}function xr(l,r){for(let a=0;a<l.length;a++)if(r.indexOf(l[a])>=0)return!0;return!1}const Xr={};function _r(l){Xr[l]||(typeof console<"u"&&console.warn(l),Xr[l]=!0)}function zi(l,r,a){return(a.y-l.y)*(r.x-l.x)>(r.y-l.y)*(a.x-l.x)}function Ur(l){let r=0;for(let a,h,f=0,_=l.length,y=_-1;f<_;y=f++)a=l[f],h=l[y],r+=(h.x-a.x)*(a.y+h.y);return r}function ts([l,r,a]){const h=$e(r+90),f=$e(a);return{x:l*Math.cos(h)*Math.sin(f),y:l*Math.sin(h)*Math.sin(f),z:l*Math.cos(f),azimuthal:r,polar:a}}function $r(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function Or(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((a,h,f,_)=>{const y=f||_;return r[h]=!y||y.toLowerCase(),""})),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let wi=null;function Oi(l,r){return[l[4*r],l[4*r+1],l[4*r+2],l[4*r+3]]}function ti(l,r,a,h){for(;r<a;){const f=r+a>>1;l[f]<h?r=f+1:a=f}return r}function ds(l,r,a,h){for(;r<a;){const f=r+a>>1;l[f]<=h?r=f+1:a=f}return r}function Yi(l){return l>0?1/(1.001-l):1+l}function da(l){return l>0?1-1/(1.001-l):-l}function Ns(l,r,a){return(l-r.min)*(a.max-a.min)/(r.max-r.min)+a.min}const ro={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ro.API_URL)return null;try{const l=new URL(ro.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Wh(l){return ro.API_URL_REGEX.test(l)}function d_(l){return ro.API_SPRITE_REGEX.test(l)}let gl,cc,uc,Fc,Bc,Zd;function Xd(){return gl==null&&(gl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),gl}const _l={now:()=>Fc!==void 0?Fc:performance.now(),setNow(l){Fc=l},restoreNow(){Fc=void 0},frame(l){const r=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(l,r=0){const{width:a,height:h}=l;Bc||(Bc=document.createElement("canvas"));const f=Bc.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(a>Bc.width||h>Bc.height)&&(Bc.width=a,Bc.height=h),f.clearRect(-r,-r,a+2*r,h+2*r),f.drawImage(l,0,0,a,h),f.getImageData(-r,-r,a+2*r,h+2*r)},resolveURL:l=>(cc||(cc=document.createElement("a")),cc.href=l,cc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(uc==null&&(uc=window.matchMedia("(prefers-reduced-motion: reduce)")),uc.matches)},hasCanvasFingerprintNoise(){if(Zd!==void 0)return Zd;if(!Xd())return Zd=!1,!1;const l=new OffscreenCanvas(85,1),r=l.getContext("2d",{willReadFrequently:!0});let a=0;for(let f=0;f<l.width;++f)r.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,r.fillRect(f,0,1,1);const h=r.getImageData(0,0,l.width,l.height);a=0;for(let f=0;f<h.data.length;++f)if(f%4!=3&&a++!==h.data[f])return Zd=!0,!0;return Zd=!1,!1}};function Yd(l,r){const a=l.indexOf("?");if(a<0)return`${l}?${new URLSearchParams(r).toString()}`;const h=new URLSearchParams(l.slice(a));for(const f in r)h.set(f,r[f]);return`${l.slice(0,a)}?${h.toString()}`}function Uc(l,r={persistentParams:[]}){const a=l.indexOf("?");if(a<0)return l;const h=new URLSearchParams,f=new URLSearchParams(l.slice(a));for(const y of r.persistentParams){const T=f.get(y);T&&h.set(y,T)}const _=h.toString();return`${l.slice(0,a)}${_.length>0?`?${_}`:""}`}const fa="mapbox-tiles";let pa=500,ni=50;const Ua=["language","worldview","jobid"];let io,hc;function Tp(){try{return caches}catch{}}function qh(){const l=Tp();l&&io==null&&(io=l.open(fa))}let dc=1/0;const Ou={supported:!1,testSupport:function(l){!As&&ma&&(Ll?jl(l):Vc=l)}};let Vc,ma,As=!1,Ll=!1;const $c=typeof self<"u"?self:{};function jl(l){const r=l.createTexture();l.bindTexture(l.TEXTURE_2D,r);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,ma),l.isContextLost())return;Ou.supported=!0}catch{}l.deleteTexture(r),As=!0}$c.document&&(ma=$c.document.createElement("img"),ma.onload=function(){Vc&&jl(Vc),Vc=null,Ll=!0},ma.onerror=function(){As=!0,Vc=null},ma.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const yl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(yl);class Um extends Error{constructor(r,a,h){a===401&&Wh(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Kd=$r()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,br=function(l,r){if(!(/^file:/.test(a=l.url)||/^file:/.test(Kd())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(h,f){const _=new AbortController,y=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Kd(),referrerPolicy:h.referrerPolicy,signal:_.signal});let T=!1,C=!1;const k=(L=y.url).indexOf("sku=")>0&&Wh(L);var L;h.type==="json"&&y.headers.set("Accept","application/json");const j=(H,W,ee)=>{if(C)return;if(H&&H.message!=="SecurityError"&&_r(H.toString()),W&&ee)return N(W);const ie=Date.now();fetch(y).then((se=>{if(se.ok){const fe=k?se.clone():null;return N(se,fe,ie)}return f(new Um(se.statusText,se.status,h.url))})).catch((se=>{se.name!=="AbortError"&&f(new Error(`${se.message} ${h.url}`))}))},N=(H,W,ee)=>{(h.type==="arrayBuffer"?H.arrayBuffer():h.type==="json"?H.json():H.text()).then((ie=>{C||(W&&ee&&(function(se,fe,pe){if(qh(),io==null)return;const _e=Or(fe.headers.get("Cache-Control")||"");if(_e["no-store"])return;const ke={status:fe.status,statusText:fe.statusText,headers:new Headers};fe.headers.forEach(((Fe,Ue)=>ke.headers.set(Ue,Fe))),_e["max-age"]&&ke.headers.set("Expires",new Date(pe+1e3*_e["max-age"]).toUTCString());const Re=ke.headers.get("Expires");if(!Re||new Date(Re).getTime()-pe<42e4)return;let Ne=Uc(se.url,{persistentParams:Ua});if(fe.status===206){const Fe=se.headers.get("Range");if(!Fe)return;ke.status=200,Ne=Yd(Ne,{range:Fe})}(function(Fe,Ue){if(hc===void 0)try{new Response(new ReadableStream),hc=!0}catch{hc=!1}hc?Ue(Fe.body):Fe.blob().then(Ue).catch((ft=>_r(ft.message)))})(fe,(Fe=>{const Ue=new Response((ft=fe.status)!==200&&ft!==404&&[101,103,204,205,304].includes(ft)?null:Fe,ke);var ft;qh(),io!=null&&io.then((We=>We.put(Ne,Ue))).catch((We=>_r(We.message)))}))})(y,W,ee),T=!0,f(null,ie,H.headers.get("Cache-Control"),H.headers.get("Expires")))})).catch((ie=>{C||f(new Error(ie.message))}))};return k?(function(H,W){if(qh(),io==null)return W(null);io.then((ee=>{let ie=Uc(H.url,{persistentParams:Ua});const se=H.headers.get("Range");se&&(ie=Yd(ie,{range:se})),ee.match(ie).then((fe=>{const pe=(function(_e){if(!_e)return!1;const ke=new Date(_e.headers.get("Expires")||0),Re=Or(_e.headers.get("Cache-Control")||"");return Number(ke)>Date.now()&&!Re["no-cache"]})(fe);ee.delete(ie).catch(W),pe&&ee.put(ie,fe.clone()).catch(W),W(null,fe,pe)})).catch(W)})).catch(W)})(y,j):j(null,null),{cancel:()=>{C=!0,T||_.abort()}}})(l,r);if($r(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,r,void 0,!0)}var a;return(function(h,f){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const y in h.headers)_.setRequestHeader(y,h.headers[y]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(h.type==="json")try{y=JSON.parse(_.response)}catch(T){return f(T)}f(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else f(new Um(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}})(l,r)},Zh=function(l,r){return br(Object.assign(l,{type:"arrayBuffer"}),r)};function Vm(l){const r=document.createElement("a");return r.href=l,r.protocol===location.protocol&&r.host===location.host}const Jd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qd,Hc;Qd=[],Hc=0;const zl=function(l,r){if(Ou.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Hc>=ro.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:l,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Qd.push(_),_}Hc++;let a=!1;const h=()=>{if(!a)for(a=!0,Hc--;Qd.length&&Hc<ro.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Qd.shift(),{requestParameters:y,callback:T,cancelled:C}=_;C||(_.cancel=zl(y,T).cancel)}},f=Zh(l,((_,y,T,C)=>{h(),_?r(_):y&&(self.createImageBitmap?(function(k,L){const j=new Blob([new Uint8Array(k)],{type:"image/png"});createImageBitmap(j).then((N=>{L(null,N)})).catch((N=>{L(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(y,((k,L)=>r(k,L,T,C))):(function(k,L){const j=new Image;j.onload=()=>{L(null,j),URL.revokeObjectURL(j.src),j.onload=null,requestAnimationFrame((()=>{j.src=Jd}))},j.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Blob([new Uint8Array(k)],{type:"image/png"});j.src=k.byteLength?URL.createObjectURL(N):Jd})(y,((k,L)=>r(k,L,T,C))))}));return{cancel:()=>{f.cancel(),h()}}};var fc,pc,ef,Du={exports:{}},f_={exports:{}},tf={exports:{}},mc=(function(){if(ef)return Du.exports;ef=1;var l=(fc||(fc=1,f_.exports=function(a,h){var f,_,y,T,C,k,L,j;for(_=a.length-(f=3&a.length),y=h,C=3432918353,k=461845907,j=0;j<_;)L=255&a.charCodeAt(j)|(255&a.charCodeAt(++j))<<8|(255&a.charCodeAt(++j))<<16|(255&a.charCodeAt(++j))<<24,++j,y=27492+(65535&(T=5*(65535&(y=(y^=L=(65535&(L=(L=(65535&L)*C+(((L>>>16)*C&65535)<<16)&4294967295)<<15|L>>>17))*k+(((L>>>16)*k&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(L=0,f){case 3:L^=(255&a.charCodeAt(j+2))<<16;case 2:L^=(255&a.charCodeAt(j+1))<<8;case 1:y^=L=(65535&(L=(L=(65535&(L^=255&a.charCodeAt(j)))*C+(((L>>>16)*C&65535)<<16)&4294967295)<<15|L>>>17))*k+(((L>>>16)*k&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),f_.exports),r=(pc||(pc=1,tf.exports=function(a,h){for(var f,_=a.length,y=h^_,T=0;_>=4;)f=1540483477*(65535&(f=255&a.charCodeAt(T)|(255&a.charCodeAt(++T))<<8|(255&a.charCodeAt(++T))<<16|(255&a.charCodeAt(++T))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),_-=4,++T;switch(_){case 3:y^=(255&a.charCodeAt(T+2))<<16;case 2:y^=(255&a.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),tf.exports);return Du.exports=l,Du.exports.murmur3=l,Du.exports.murmur2=r,Du.exports})(),Xh=Hh(mc);class Va{constructor(r,...a){Object.assign(this,a[0]||{}),this.type=r}}class $a extends Va{constructor(r,a={}){super("error",Object.assign({error:r},a))}}function Yh(l,r,a){a[l]&&a[l].indexOf(r)!==-1||(a[l]=a[l]||[],a[l].push(r))}function yo(l,r,a){if(a&&a[l]){const h=a[l].indexOf(r);h!==-1&&a[l].splice(h,1)}}class Gc{on(r,a){return this._listeners=this._listeners||{},Yh(r,a,this._listeners),this}off(r,a){return yo(r,a,this._listeners),yo(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Yh(r,a,this._oneTimeListeners),this):new Promise((h=>{this.once(r,h)}))}fire(r,a){const h=typeof r=="string"?new Va(r,a):r,f=h.type;if(this.listens(f)){h.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const C of _)C.call(this,h);const y=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const C of y)yo(f,C,this._oneTimeListeners),C.call(this,h);const T=this._eventedParent;if(T){const C=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,C),T.fire(h)}}else h instanceof $a&&console.error(h.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}class vo{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new vo(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[a,h]=r.split("");return new vo({name:a,iconsetId:h})}static isEqual(r,a){return r.name===a.name&&r.iconsetId===a.iconsetId}toString(){return vo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Kh,nf={},Lo=(function(){if(Kh)return nf;Kh=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(_){return(_=Math.round(_))<0?0:_>255?255:_}function a(_){return r(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function h(_){return(y=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:y>1?1:y;var y}function f(_,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?_+(y-_)*T*6:2*T<1?y:3*T<2?_+(y-_)*(2/3-T)*6:_}try{nf.parseCSSColor=function(_){var y,T=_.replace(/ /g,"").toLowerCase();if(T in l)return l[T].slice();if(T[0]==="#")return T.length===4?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:T.length===7&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var C=T.indexOf("("),k=T.indexOf(")");if(C!==-1&&k+1===T.length){var L=T.substr(0,C),j=T.substr(C+1,k-(C+1)).split(","),N=1;switch(L){case"rgba":if(j.length!==4)return null;N=h(j.pop());case"rgb":return j.length!==3?null:[a(j[0]),a(j[1]),a(j[2]),N];case"hsla":if(j.length!==4)return null;N=h(j.pop());case"hsl":if(j.length!==3)return null;var H=(parseFloat(j[0])%360+360)%360/360,W=h(j[1]),ee=h(j[2]),ie=ee<=.5?ee*(W+1):ee+W-ee*W,se=2*ee-ie;return[r(255*f(se,ie,H+1/3)),r(255*f(se,ie,H)),r(255*f(se,ie,H-1/3)),N];default:return null}}return null}}catch{}return nf})();class Ir{constructor(r,a,h,f=1){this.r=r,this.g=a,this.b=h,this.a=f}static parse(r){if(!r)return;if(r instanceof Ir)return r;if(typeof r!="string")return;const a=Lo.parseCSSColor(r);return a?new Ir(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[r,a,h,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*a)},${Math.round(255*h)},${f})`}toNonPremultipliedRenderColor(r){const{r:a,g:h,b:f,a:_}=this;return new Jh(r,a,h,f,_)}toPremultipliedRenderColor(r){const{r:a,g:h,b:f,a:_}=this;return new Ep(r,a*_,h*_,f*_,_)}clone(){return new Ir(this.r,this.g,this.b,this.a)}}class rf{constructor(r,a,h,f,_,y=!1){if(this.premultiplied=!1,this.premultiplied=y,r){const T=r.image.height,C=T*T;this.premultiplied?(a=_===0?0:a/_*(T-1),h=_===0?0:h/_*(T-1),f=_===0?0:f/_*(T-1)):(a*=T-1,h*=T-1,f*=T-1);const k=Math.floor(a),L=Math.floor(h),j=Math.floor(f),N=Math.ceil(a),H=Math.ceil(h),W=Math.ceil(f),ee=a-k,ie=h-L,se=f-j,fe=r.image.data,pe=4*(k+L*C+j*T),_e=4*(k+L*C+W*T),ke=4*(k+H*C+j*T),Re=4*(k+H*C+W*T),Ne=4*(N+L*C+j*T),Fe=4*(N+L*C+W*T),Ue=4*(N+H*C+j*T),ft=4*(N+H*C+W*T);if(pe<0||ft>=fe.length)throw new Error("out of range");this.r=An(An(An(fe[pe],fe[_e],se),An(fe[ke],fe[Re],se),ie),An(An(fe[Ne],fe[Fe],se),An(fe[Ue],fe[ft],se),ie),ee)/255*(this.premultiplied?_:1),this.g=An(An(An(fe[pe+1],fe[_e+1],se),An(fe[ke+1],fe[Re+1],se),ie),An(An(fe[Ne+1],fe[Fe+1],se),An(fe[Ue+1],fe[ft+1],se),ie),ee)/255*(this.premultiplied?_:1),this.b=An(An(An(fe[pe+2],fe[_e+2],se),An(fe[ke+2],fe[Re+2],se),ie),An(An(fe[Ne+2],fe[Fe+2],se),An(fe[Ue+2],fe[ft+2],se),ie),ee)/255*(this.premultiplied?_:1),this.a=_}else this.r=a,this.g=h,this.b=f,this.a=_}toArray(){const{r,g:a,b:h,a:f}=this;return[255*r,255*a,255*h,f]}toHslaArray(){let{r,g:a,b:h,a:f}=this;if(this.premultiplied){if(f===0)return[0,0,0,0];const W=1/f;r*=W,a*=W,h*=W}const _=Math.min(Math.max(r,0),1),y=Math.min(Math.max(a,0),1),T=Math.min(Math.max(h,0),1),C=Math.min(_,y,T),k=Math.max(_,y,T),L=k-C,j=.5*(C+k);if(L===0)return[0,0,100*j,f];const N=j>.5?L/(2-k-C):L/(k+C);let H;switch(k){case _:H=60*((y-T)/L+(y<T?6:0));break;case y:H=60*((T-_)/L+2);break;default:H=60*((_-y)/L+4)}return[H,100*N,100*j,f]}toArray01(){const{r,g:a,b:h,a:f}=this;return[r,a,h,f]}toArray01Scaled(r){const{r:a,g:h,b:f}=this;return[a*r,h*r,f*r]}toArray01Linear(){const{r,g:a,b:h,a:f}=this;return[Math.pow(r,2.2),Math.pow(a,2.2),Math.pow(h,2.2),f]}}class Jh extends rf{constructor(r,a,h,f,_){super(r,a,h,f,_,!1)}}class Ep extends rf{constructor(r,a,h,f,_){super(r,a,h,f,_,!0)}}function An(l,r,a){return l*(1-a)+r*a}function sf(l,r,a){return l.map(((h,f)=>An(h,r[f],a)))}Ir.black=new Ir(0,0,0,1),Ir.white=new Ir(1,1,1,1),Ir.transparent=new Ir(0,0,0,0),Ir.red=new Ir(1,0,0,1),Ir.blue=new Ir(0,0,1,1);var so=Object.freeze({__proto__:null,array:sf,color:function(l,r,a){return new Ir(An(l.r,r.r,a),An(l.g,r.g,a),An(l.b,r.b,a),An(l.a,r.a,a))},number:An});class Ko extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class of{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[h,f]of a)this.bindings[h]=f}concat(r){return new of(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Nl={kind:"null"},_n={kind:"number"},Nr={kind:"string"},zr={kind:"boolean"},Jo={kind:"color"},Lu={kind:"object"},Dr={kind:"value"},Ap={kind:"collator"},Wc={kind:"formatted"},Qh={kind:"resolvedImage"};function oo(l,r){return{kind:"array",itemType:l,N:r}}function ns(l){if(l.kind==="array"){const r=ns(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const $y=[Nl,_n,Nr,zr,Jo,Wc,Lu,oo(Dr),Qh];function af(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!af(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const a of $y)if(!af(a,r))return null}}return`Expected ${ns(l)} but found ${ns(r)} instead.`}function lf(l,r){return r.some((a=>a.kind===l.kind))}function cf(l,r){return r.some((a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l))}function uf(l,r){return l.kind==="array"&&r.kind==="array"?l.N===r.N&&uf(l.itemType,r.itemType):l.kind===r.kind}class qc{constructor(r,a,h){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hf{constructor(r,a,h,f,_){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=h,this.fontStack=f,this.textColor=_}}class xo{constructor(r){this.sections=r}static fromString(r){return new xo([new hf(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||!!r.image&&r.image.hasPrimary()))}static factory(r){return r instanceof xo?r:xo.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){const f=a.image.getPrimary().id.toString();r.push(["image",f]);continue}r.push(a.text);const h={};a.fontStack&&(h["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(h["font-scale"]=a.scale),a.textColor&&(h["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(h)}return r}}class vl{constructor(r,a={}){if(this.id=vo.from(r),this.options=Object.assign({},a),a.transform){const{a:h,b:f,c:_,d:y,e:T,f:C}=a.transform;this.options.transform=new DOMMatrix([h,f,_,y,T,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:r,b:a,c:h,d:f,e:_,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:r,b:a,c:h,d:f,e:_,f:y}})}static parse(r){let a,h,f,_;try{({name:a,iconsetId:h,params:f,transform:_}=JSON.parse(r)||{})}catch{return null}if(!a)return null;const{a:y,b:T,c:C,d:k,e:L,f:j}=_||{};return new vl({name:a,iconsetId:h},{params:f,transform:new DOMMatrix([y,T,C,k,L,j])})}scaleSelf(r,a){return this.options.transform.scaleSelf(r,a),this}}class jo{constructor(r,a,h,f,_=!1){this.primaryId=vo.from(r),this.primaryOptions=a,h&&(this.secondaryId=vo.from(h)),this.secondaryOptions=f,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new vl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new vl(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?jo.build({name:r}):r}static build(r,a,h,f){return!r||typeof r=="object"&&!("name"in r)?null:new jo(r,h,a,f)}}function p_(l,r,a,h){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[l,r,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[l,r,a,h]:[l,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ed(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Ir||l instanceof qc||l instanceof xo||l instanceof jo)return!0;if(Array.isArray(l)){for(const r of l)if(!ed(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!ed(l[r]))return!1;return!0}return!1}function fs(l){if(l===null)return Nl;if(typeof l=="string")return Nr;if(typeof l=="boolean")return zr;if(typeof l=="number")return _n;if(l instanceof Ir)return Jo;if(l instanceof qc)return Ap;if(l instanceof xo)return Wc;if(l instanceof jo)return Qh;if(Array.isArray(l)){const r=l.length;let a;for(const h of l){const f=fs(h);if(a){if(a===f)continue;a=Dr;break}a=f}return oo(a||Dr,r)}return Lu}function zo(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof xo||l instanceof jo||l instanceof Ir?l.toString():JSON.stringify(l)}class Gn{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(r.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ed(r[1]))return a.error("invalid value");const h=r[1];let f=fs(h);const _=a.expectedType;return f.kind!=="array"||f.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(f=_),new Gn(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ir?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof xo?this.value.serialize():this.value}}class Qt{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const df={string:Nr,number:_n,boolean:zr,object:Lu};class In{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let h,f=1;const _=r[0];if(_==="array"){let T,C;if(r.length>2){const k=r[1];if(typeof k!="string"||!(k in df)||k==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);T=df[k],f++}else T=Dr;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=r[2],f++}h=oo(T,C)}else h=df[_];const y=[];for(;f<r.length;f++){const T=a.parse(r[f],f,Dr);if(!T)return null;y.push(T)}return new In(h,y)}evaluate(r){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(r);if(!af(this.type,fs(h)))return h;if(a===this.args.length-1)throw new Qt(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${ns(fs(h))} but was expected to be of type ${ns(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=this.type,a=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){a.push(h.kind);const f=r.N;(typeof f=="number"||this.args.length>1)&&a.push(f)}}return a.concat(this.args.map((h=>h.serialize())))}}class Zc{constructor(r){this.type=Wc,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const f=[];let _=!1;for(let y=1;y<=r.length-1;++y){const T=r[y];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let C=null;if(T["font-scale"]&&(C=a.parseObjectValue(T["font-scale"],y,"font-scale",_n),!C))return null;let k=null;if(T["text-font"]&&(k=a.parseObjectValue(T["text-font"],y,"text-font",oo(Nr)),!k))return null;let L=null;if(T["text-color"]&&(L=a.parseObjectValue(T["text-color"],y,"text-color",Jo),!L))return null;const j=f[f.length-1];j.scale=C,j.font=k,j.textColor=L}else{const C=a.parse(r[y],y,Dr);if(!C)return null;const k=C.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:C,scale:null,font:null,textColor:null})}}return new Zc(f)}evaluate(r){return new xo(this.sections.map((a=>{const h=a.content.evaluate(r);return uf(fs(h),Qh)?new hf("",h,null,null,null):new hf(zo(h),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)})))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const h={};a.scale&&(h["font-scale"]=a.scale.serialize()),a.font&&(h["text-font"]=a.font.serialize()),a.textColor&&(h["text-color"]=a.textColor.serialize()),r.push(h)}return r}}class ju{constructor(r,a,h,f){this._imageWarnHistory={},this.type=Qh,this.namePrimary=r,this.nameSecondary=a,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),f&&(this.paramsSecondary=f.params,this.iconsetIdSecondary=f.iconset?f.iconset.id:void 0)}static parse(r,a){if(r.length<2)return a.error("Expected two or more arguments.");let h=1;const f=[];function _(){if(h<r.length){const T=a.parse(r[h],h++,Nr);return T?(f.push({image:T,options:{}}),!0):(a.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(h<r.length){const C=r[h];if((T=C)===null||typeof T!="object"||Array.isArray(T))return!0;const k=C.params,L=C.iconset,j=a.concat(h);if(!k&&!L)return h++,!0;if(k){if(typeof k!="object"||k.constructor!==Object)return j.error('Image options "params" should be an object'),!1;const N={},H=j.concat(void 0,"params");for(const W in k){if(!W)return H.error("Image parameter name should be non-empty"),!1;const ee=H.concat(void 0,W).parse(k[W],void 0,Jo,void 0,{typeAnnotation:"coerce"});if(!ee)return!1;N[W]=ee}f[f.length-1].options.params=N}if(L){if(typeof L!="object"||L.constructor!==Object)return j.error('Image options "iconset" should be an object'),!1;if(!L.id)return j.error('Image options "iconset" should have an "id" property'),!1;f[f.length-1].options.iconset=L}return h++,!0}var T;return!0}for(let T=0;T<2;T++)if(!_()||!y())return;return new ju(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(r,a){const h={};if(a){for(const f in a)if(a[f])try{h[f]=a[f].evaluate(r)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(r){const a={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,f=jo.build(a,h,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(f&&r.availableImages){const _=f.getPrimary().id;if(f.available=r.availableImages.some((y=>vo.isEqual(y,_))),f.available){const y=f.getSecondary()?f.getSecondary().id:null;y&&(f.available=r.availableImages.some((T=>vo.isEqual(T,y))))}}return f}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&r(this.paramsPrimary[a]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&r(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(r,a){const h={};if(a&&(h.iconset={id:a}),r){h.params={};for(const f in r)r[f]&&(h.params[f]=r[f].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&r.push(a)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&r.push(a)}return r}}function Dn(l){return Fl(l)?"string":ff(l)?"number":$m(l)?"boolean":Array.isArray(l)?"array":l===null?"null":Cp(l)?"object":typeof l}function Cp(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function Fl(l){return typeof l=="string"||l instanceof String}function ff(l){return typeof l=="number"||l instanceof Number}function $m(l){return typeof l=="boolean"||l instanceof Boolean}const Pp={"to-boolean":zr,"to-color":Jo,"to-number":_n,"to-string":Nr};class Hi{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const h=r[0],f=[];let _=Nl;if(h==="to-array"){if(!Array.isArray(r[1]))return null;const y=r[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);_=oo(a.expectedType.itemType,y)}else{if(!(y>0&&ed(r[1][0])))return null;_=oo(fs(r[1][0]),y)}for(let T=0;T<y;T++){const C=r[1][T];let k;if(Array.isArray(C))k=a.parse(C,void 0,_.itemType);else{const L=Dn(C);if(L!==_.itemType.kind)return a.error(`Expected ${_.itemType.kind} but found ${L}.`);k=a.registry.literal.parse(["literal",C===void 0?null:C],a)}if(!k)return null;f.push(k)}}else{if((h==="to-boolean"||h==="to-string")&&r.length!==2)return a.error("Expected one argument.");_=Pp[h];for(let y=1;y<r.length;y++){const T=a.parse(r[y],y,Dr);if(!T)return null;f.push(T)}}return new Hi(_,f)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let a,h;for(const f of this.args){if(a=f.evaluate(r),h=null,a instanceof Ir)return a;if(typeof a=="string"){const _=r.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:p_(a[0],a[1],a[2],a[3]),!h))return new Ir(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Qt(h||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const h of this.args){if(a=h.evaluate(r),a===null)return 0;const f=Number(a);if(!isNaN(f))return f}throw new Qt(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?xo.fromString(zo(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?jo.build(zo(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map((a=>a.evaluate(r))):zo(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Zc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ju(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((a=>{r.push(a.serialize())})),r}}const Ip=["Unknown","Point","LineString","Polygon"];class ga{constructor(r,a,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=a,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ip[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:h,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*a-r[0])+this.featureDistanceData.bearing[1]*(f*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=Ir.parse(r)),a}getConfig(r){return this.options?this.options.get(r):null}}class Cs{constructor(r,a,h,f,_){this.name=r,this.type=a,this._evaluate=h,this.args=f,this._overloadIndex=_}evaluate(r){if(!this._evaluate){const a=Cs.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((r=>r.serialize())))}static parse(r,a){const h=r[0],f=Cs.definitions[h];if(!f)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,T=[];let C=null,k=-1;for(const[L,j]of y){if(Array.isArray(L)&&L.length!==r.length-1)continue;T.push(L),k++,C=new xc(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const N=[];let H=!1;for(let W=1;W<r.length;W++){const ee=r[W],ie=Array.isArray(L)?L[W-1]:L.type,se=C.parse(ee,1+N.length,ie);if(!se){H=!0;break}N.push(se)}if(!H)if(Array.isArray(L)&&L.length!==N.length)C.error(`Expected ${L.length} arguments, but found ${N.length} instead.`);else{for(let W=0;W<N.length;W++){const ee=Array.isArray(L)?L[W]:L.type,ie=N[W];C.concat(W+1).checkSubtype(ee,ie.type)}if(C.errors.length===0)return new Cs(h,_,j,N,k)}}if(T.length===1)a.errors.push(...C.errors);else{const L=(T.length?T:y.map((([N])=>N))).map(Xc).join(" | "),j=[];for(let N=1;N<r.length;N++){const H=a.parse(r[N],1+j.length);if(!H)return null;j.push(ns(H.type))}a.error(`Expected arguments of type ${L}, but found (${j.join(", ")}) instead.`)}return null}static register(r,a){Cs.definitions=a;for(const h in a)r[h]=Cs}}function Xc(l){return Array.isArray(l)?`(${l.map(ns).join(", ")})`:`(${ns(l.type)}...)`}class ps{constructor(r,a,h){this.type=Ap,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(r.length!==2)return a.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const f=h["case-sensitive"]===void 0?a.parse(!1,1,zr):a.parseObjectValue(h["case-sensitive"],1,"case-sensitive",zr);if(!f)return null;const _=h["diacritic-sensitive"]===void 0?a.parse(!1,1,zr):a.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",zr);if(!_)return null;let y=null;return h.locale&&(y=a.parseObjectValue(h.locale,1,"locale",Nr),!y)?null:new ps(f,_,y)}evaluate(r){return new qc(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function m_(l,r,a=0,h=l.length-1,f=Hm){for(;h>a;){if(h-a>600){const C=h-a+1,k=r-a+1,L=Math.log(C),j=.5*Math.exp(2*L/3),N=.5*Math.sqrt(L*j*(C-j)/C)*(k-C/2<0?-1:1);m_(l,r,Math.max(a,Math.floor(r-k*j/C+N)),Math.min(h,Math.floor(r+(C-k)*j/C+N)),f)}const _=l[r];let y=a,T=h;for(td(l,a,r),f(l[h],_)>0&&td(l,a,h);y<T;){for(td(l,y,T),y++,T--;f(l[y],_)<0;)y++;for(;f(l[T],_)>0;)T--}f(l[a],_)===0?td(l,a,T):(T++,td(l,T,h)),T<=r&&(a=T+1),r<=T&&(h=T-1)}}function td(l,r,a){const h=l[r];l[r]=l[a],l[a]=h}function Hm(l,r){return l<r?-1:l>r?1:0}function nd(l){let r=0;for(let a,h,f=0,_=l.length,y=_-1;f<_;y=f++)a=l[f],h=l[y],r+=(h.x-a.x)*(a.y+h.y);return r}function zu(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function Ha(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function g_(l,r,a){const h=l[0]-r[0],f=l[1]-r[1],_=l[0]-a[0],y=l[1]-a[1];return h*y-_*f==0&&h*_<=0&&f*y<=0}function rd(l,r,a=!1){let h=!1;for(let T=0,C=r.length;T<C;T++){const k=r[T];for(let L=0,j=k.length,N=j-1;L<j;N=L++){const H=k[N],W=k[L];if(g_(l,H,W))return a;(_=H)[1]>(f=l)[1]!=(y=W)[1]>f[1]&&f[0]<(y[0]-_[0])*(f[1]-_[1])/(y[1]-_[1])+_[0]&&(h=!h)}}var f,_,y;return h}function __(l,r,a,h){const f=h[0]-a[0],_=h[1]-a[1],y=(l[0]-a[0])*_-f*(l[1]-a[1]),T=(r[0]-a[0])*_-f*(r[1]-a[1]);return y>0&&T<0||y<0&&T>0}function Mp(l,r,a,h){return(f=[h[0]-a[0],h[1]-a[1]])[0]*(_=[r[0]-l[0],r[1]-l[1]])[1]-f[1]*_[0]!=0&&!(!__(l,r,a,h)||!__(a,h,l,r));var f,_}function kp(l){const r=new It(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new It(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of l[0])r.x>h.x&&(r.x=h.x),r.y>h.y&&(r.y=h.y),a.x<h.x&&(a.x=h.x),a.y<h.y&&(a.y=h.y);return{min:r,max:a}}const Yc=8192;function ao(l,r){const a=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,f=Math.pow(2,r.z);return[Math.round(a*f*Yc),Math.round(h*f*Yc)]}function pf(l,r){for(let a=0;a<r.length;a++)if(rd(l,r[a]))return!0;return!1}function y_(l,r,a){for(const h of a)for(let f=0,_=h.length,y=_-1;f<_;y=f++)if(Mp(l,r,h[y],h[f]))return!0;return!1}function mf(l,r){for(let a=0;a<l.length;++a)if(!rd(l[a],r))return!1;for(let a=0;a<l.length-1;++a)if(y_(l[a],l[a+1],r))return!1;return!0}function Gm(l,r){for(let a=0;a<r.length;a++)if(mf(l,r[a]))return!0;return!1}function gf(l,r,a){const h=[];for(let f=0;f<l.length;f++){const _=[];for(let y=0;y<l[f].length;y++){const T=ao(l[f][y],a);zu(r,T),_.push(T)}h.push(_)}return h}function Qo(l,r,a){const h=[];for(let f=0;f<l.length;f++){const _=gf(l[f],r,a);h.push(_)}return h}function v_(l,r,a,h){if(l[0]<a[0]||l[0]>a[2]){const f=.5*h;let _=l[0]-a[0]>f?-h:a[0]-l[0]>f?h:0;_===0&&(_=l[0]-a[2]>f?-h:a[2]-l[0]>f?h:0),l[0]+=_}zu(r,l)}function x_(l,r,a,h){const f=Math.pow(2,h.z)*Yc,_=[h.x*Yc,h.y*Yc],y=[];if(!l)return y;for(const T of l)for(const C of T){const k=[C.x+_[0],C.y+_[1]];v_(k,r,a,f),y.push(k)}return y}function Nu(l,r,a,h){const f=Math.pow(2,h.z)*Yc,_=[h.x*Yc,h.y*Yc],y=[];if(!l)return y;for(const C of l){const k=[];for(const L of C){const j=[L.x+_[0],L.y+_[1]];zu(r,j),k.push(j)}y.push(k)}if(r[2]-r[0]<=f/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of y)for(const k of C)v_(k,r,a,f)}var T;return y}class gc{constructor(r,a){this.type=zr,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ed(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let f=0;f<h.features.length;++f){const _=h.features[f].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new gc(h,h.features[f].geometry)}else if(h.type==="Feature"){const f=h.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new gc(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new gc(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(a,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const T=gf(h.coordinates,_,y),C=x_(a.geometry(),f,_,y);if(!Ha(f,_))return!1;for(const k of C)if(!rd(k,T))return!1}if(h.type==="MultiPolygon"){const T=Qo(h.coordinates,_,y),C=x_(a.geometry(),f,_,y);if(!Ha(f,_))return!1;for(const k of C)if(!pf(k,T))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(a,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const T=gf(h.coordinates,_,y),C=Nu(a.geometry(),f,_,y);if(!Ha(f,_))return!1;for(const k of C)if(!mf(k,T))return!1}if(h.type==="MultiPolygon"){const T=Qo(h.coordinates,_,y),C=Nu(a.geometry(),f,_,y);if(!Ha(f,_))return!1;for(const k of C)if(!Gm(k,T))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const _c={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},_f=1/298.257223563,Rp=_f*(2-_f),yc=Math.PI/180;class xl{static fromTile(r,a,h){const f=Math.PI*(1-2*(r+.5)/Math.pow(2,a)),_=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/yc;return new xl(_,h)}static get units(){return _c}constructor(r,a){if(r===void 0)throw new Error("No latitude given.");if(a&&!_c[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(_c).join(", ")}`);const h=6378.137*yc*(a?_c[a]:1),f=Math.cos(r*yc),_=1/(1-Rp*(1-f*f)),y=Math.sqrt(_);this.kx=h*y*f,this.ky=h*y*_*(1-Rp)}distance(r,a){const h=bo(r[0]-a[0])*this.kx,f=(r[1]-a[1])*this.ky;return Math.sqrt(h*h+f*f)}bearing(r,a){const h=bo(a[0]-r[0])*this.kx;return Math.atan2(h,(a[1]-r[1])*this.ky)/yc}destination(r,a,h){const f=h*yc;return this.offset(r,Math.sin(f)*a,Math.cos(f)*a)}offset(r,a,h){return[r[0]+a/this.kx,r[1]+h/this.ky]}lineDistance(r){let a=0;for(let h=0;h<r.length-1;h++)a+=this.distance(r[h],r[h+1]);return a}area(r){let a=0;for(let h=0;h<r.length;h++){const f=r[h];for(let _=0,y=f.length,T=y-1;_<y;T=_++)a+=bo(f[_][0]-f[T][0])*(f[_][1]+f[T][1])*(h?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(r,a){let h=0;if(a<=0)return r[0];for(let f=0;f<r.length-1;f++){const _=r[f],y=r[f+1],T=this.distance(_,y);if(h+=T,h>a)return vf(_,y,(a-(h-T))/T)}return r[r.length-1]}pointToSegmentDistance(r,a,h){let[f,_]=a,y=bo(h[0]-f)*this.kx,T=(h[1]-_)*this.ky;if(y!==0||T!==0){const C=(bo(r[0]-f)*this.kx*y+(r[1]-_)*this.ky*T)/(y*y+T*T);C>1?(f=h[0],_=h[1]):C>0&&(f+=y/this.kx*C,_+=T/this.ky*C)}return y=bo(r[0]-f)*this.kx,T=(r[1]-_)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(r,a){let h=1/0,f=r[0][0],_=r[0][1],y=0,T=0;for(let C=0;C<r.length-1;C++){let k=r[C][0],L=r[C][1],j=bo(r[C+1][0]-k)*this.kx,N=(r[C+1][1]-L)*this.ky,H=0;j===0&&N===0||(H=(bo(a[0]-k)*this.kx*j+(a[1]-L)*this.ky*N)/(j*j+N*N),H>1?(k=r[C+1][0],L=r[C+1][1]):H>0&&(k+=j/this.kx*H,L+=N/this.ky*H)),j=bo(a[0]-k)*this.kx,N=(a[1]-L)*this.ky;const W=j*j+N*N;W<h&&(h=W,f=k,_=L,y=C,T=H)}return{point:[f,_],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(r,a,h){let f=this.pointOnLine(h,r),_=this.pointOnLine(h,a);if(f.index>_.index||f.index===_.index&&f.t>_.t){const k=f;f=_,_=k}const y=[f.point],T=f.index+1,C=_.index;!yf(h[T],y[0])&&T<=C&&y.push(h[T]);for(let k=T+1;k<=C;k++)y.push(h[k]);return yf(h[C],_.point)||y.push(_.point),y}lineSliceAlong(r,a,h){let f=0;const _=[];for(let y=0;y<h.length-1;y++){const T=h[y],C=h[y+1],k=this.distance(T,C);if(f+=k,f>r&&_.length===0&&_.push(vf(T,C,(r-(f-k))/k)),f>=a)return _.push(vf(T,C,(a-(f-k))/k)),_;f>r&&_.push(C)}return _}bufferPoint(r,a){const h=a/this.ky,f=a/this.kx;return[r[0]-f,r[1]-h,r[0]+f,r[1]+h]}bufferBBox(r,a){const h=a/this.ky,f=a/this.kx;return[r[0]-f,r[1]-h,r[2]+f,r[3]+h]}insideBBox(r,a){return bo(r[0]-a[0])>=0&&bo(r[0]-a[2])<=0&&r[1]>=a[1]&&r[1]<=a[3]}}function yf(l,r){return l[0]===r[0]&&l[1]===r[1]}function vf(l,r,a){const h=bo(r[0]-l[0]);return[l[0]+h*a,l[1]+(r[1]-l[1])*a]}function bo(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class xf{constructor(r=[],a=((h,f)=>h<f?-1:h>f?1:0)){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:h}=this,f=a[r];for(;r>0;){const _=r-1>>1,y=a[_];if(h(f,y)>=0)break;a[r]=y,r=_}a[r]=f}_down(r){const{data:a,compare:h}=this,f=this.length>>1,_=a[r];for(;r<f;){let y=1+(r<<1);const T=y+1;if(T<this.length&&h(a[T],a[y])<0&&(y=T),h(a[y],_)>=0)break;a[r]=a[y],r=y}a[r]=_}}var Ft=8192;function Op(l,r){return r.dist-l.dist}const Fu=100,Bu=50;function id(l){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==l.length)return!1;for(let a=0;a<r.length;a++)if(r[a]!==l[a])return!1;return!0}function Ga(l){return l[1]-l[0]+1}function Wa(l,r){const a=l[1]>=l[0]&&l[1]<r;return a||console.warn("Distance Expression: Index is out of range"),a}function sd(l,r){if(l[0]>l[1])return[null,null];const a=Ga(l);if(r){if(a===2)return[l,null];const h=Math.floor(a/2);return[[l[0],l[0]+h],[l[0]+h,l[1]]]}{if(a===1)return[l,null];const h=Math.floor(a/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}}function qa(l,r){const a=[1/0,1/0,-1/0,-1/0];if(!Wa(r,l.length))return a;for(let h=r[0];h<=r[1];++h)zu(a,l[h]);return a}function yr(l){const r=[1/0,1/0,-1/0,-1/0];for(let a=0;a<l.length;++a)for(let h=0;h<l[a].length;++h)zu(r,l[a][h]);return r}function Bl(l,r,a){if(id(l)||id(r))return NaN;let h=0,f=0;return l[2]<r[0]&&(h=r[0]-l[2]),l[0]>r[2]&&(h=l[0]-r[2]),l[1]>r[3]&&(f=l[1]-r[3]),l[3]<r[1]&&(f=r[1]-l[3]),a.distance([0,0],[h,f])}function Hy(l){return 360*l-180}function b_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function bf(l,r){const a=Math.pow(2,r.z),h=(l.y/Ft+r.y)/a;return[Hy((l.x/Ft+r.x)/a),b_(h)]}function Ki(l,r){const a=[];for(let h=0;h<l.length;++h)a.push(bf(l[h],r));return a}function hi(l,r,a){const h=a.pointOnLine(r,l).point;return a.distance(l,h)}function wf(l,r,a,h,f){const _=a.slice(h[0],h[1]+1);let y=1/0;for(let T=r[0];T<=r[1];++T)if((y=Math.min(y,hi(l[T],_,f)))===0)return 0;return y}function Uu(l,r,a,h,f){const _=Math.min(f.pointToSegmentDistance(l,a,h),f.pointToSegmentDistance(r,a,h)),y=Math.min(f.pointToSegmentDistance(a,l,r),f.pointToSegmentDistance(h,l,r));return Math.min(_,y)}function w_(l,r,a,h,f){if(!Wa(r,l.length)||!Wa(h,a.length))return NaN;let _=1/0;for(let y=r[0];y<r[1];++y)for(let T=h[0];T<h[1];++T){if(Mp(l[y],l[y+1],a[T],a[T+1]))return 0;_=Math.min(_,Uu(l[y],l[y+1],a[T],a[T+1],f))}return _}function Wm(l,r,a,h,f){if(!Wa(r,l.length)||!Wa(h,a.length))return NaN;let _=1/0;for(let y=r[0];y<=r[1];++y)for(let T=h[0];T<=h[1];++T)if((_=Math.min(_,f.distance(l[y],a[T])))===0)return _;return _}function Sf(l,r,a){if(rd(l,r,!0))return 0;let h=1/0;for(const f of r){const _=f.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[_-1]&&(h=Math.min(h,a.pointToSegmentDistance(l,f[_-1],f[0])))===0||(h=Math.min(h,hi(l,f,a)))===0)return h}return h}function Dp(l,r,a,h){if(!Wa(r,l.length))return NaN;for(let _=r[0];_<=r[1];++_)if(rd(l[_],a,!0))return 0;let f=1/0;for(let _=r[0];_<r[1];++_)for(const y of a)for(let T=0,C=y.length,k=C-1;T<C;k=T++){if(Mp(l[_],l[_+1],y[k],y[T]))return 0;f=Math.min(f,Uu(l[_],l[_+1],y[k],y[T],h))}return f}function Vu(l,r){for(const a of l)for(let h=0;h<=a.length-1;++h)if(rd(a[h],r,!0))return!0;return!1}function S_(l,r,a,h=1/0){const f=yr(l),_=yr(r);if(h!==1/0&&Bl(f,_,a)>=h)return h;if(Ha(f,_)){if(Vu(l,r))return 0}else if(Vu(r,l))return 0;let y=h;for(const T of l)for(let C=0,k=T.length,L=k-1;C<k;L=C++)for(const j of r)for(let N=0,H=j.length,W=H-1;N<H;W=N++){if(Mp(T[L],T[C],j[W],j[N]))return 0;y=Math.min(y,Uu(T[L],T[C],j[W],j[N],a))}return y}function Lp(l,r,a,h,f,_,y){if(_===null||y===null)return;const T=Bl(qa(h,_),qa(f,y),a);T<r&&l.push({dist:T,range1:_,range2:y})}function Gy(l,r,a,h,f=1/0){let _=Math.min(h.distance(l[0],a[0][0]),f);if(_===0)return _;const y=new xf([{dist:0,range1:[0,l.length-1],range2:[0,0]}],Op),T=r?Bu:Fu,C=yr(a);for(;y.length;){const k=y.pop();if(k.dist>=_)continue;const L=k.range1;if(Ga(L)<=T){if(!Wa(L,l.length))return NaN;if(r){const j=Dp(l,L,a,h);if((_=Math.min(_,j))===0)return _}else for(let j=L[0];j<=L[1];++j){const N=Sf(l[j],a,h);if((_=Math.min(_,N))===0)return _}}else{const j=sd(L,r);if(j[0]!==null){const N=Bl(qa(l,j[0]),C,h);N<_&&y.push({dist:N,range1:j[0],range2:[0,0]})}if(j[1]!==null){const N=Bl(qa(l,j[1]),C,h);N<_&&y.push({dist:N,range1:j[1],range2:[0,0]})}}}return _}function qm(l,r,a,h,f,_=1/0){let y=Math.min(_,f.distance(l[0],a[0]));if(y===0)return y;const T=new xf([{dist:0,range1:[0,l.length-1],range2:[0,a.length-1]}],Op),C=r?Bu:Fu,k=h?Bu:Fu;for(;T.length;){const L=T.pop();if(L.dist>=y)continue;const j=L.range1,N=L.range2;if(Ga(j)<=C&&Ga(N)<=k){if(!Wa(j,l.length)||!Wa(N,a.length))return NaN;if(r&&h?y=Math.min(y,w_(l,j,a,N,f)):r||h?r&&!h?y=Math.min(y,wf(a,N,l,j,f)):!r&&h&&(y=Math.min(y,wf(l,j,a,N,f))):y=Math.min(y,Wm(l,j,a,N,f)),y===0)return y}else{const H=sd(j,r),W=sd(N,h);Lp(T,y,f,l,a,H[0],W[0]),Lp(T,y,f,l,a,H[0],W[1]),Lp(T,y,f,l,a,H[1],W[0]),Lp(T,y,f,l,a,H[1],W[1])}}return y}function od(l,r,a,h,f=1/0){let _=f;const y=qa(l,[0,l.length-1]);for(const T of a)if(!(_!==1/0&&Bl(y,qa(T,[0,T.length-1]),h)>=_)&&(_=Math.min(_,qm(l,r,T,!0,h,_)),_===0))return _;return _}function $u(l,r,a,h,f=1/0){let _=f;const y=qa(l,[0,l.length-1]);for(const T of a){if(_!==1/0&&Bl(y,yr(T),h)>=_)continue;const C=Gy(l,r,T,h,_);if(isNaN(C))return C;if((_=Math.min(_,C))===0)return _}return _}function Tf(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class vc{constructor(r,a){this.type=_n,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(ed(r[1])){const h=r[1];if(h.type==="FeatureCollection"){for(let f=0;f<h.features.length;++f)if(Tf(h.features[f].geometry.type))return new vc(h,h.features[f].geometry)}else if(h.type==="Feature"){if(Tf(h.geometry.type))return new vc(h,h.geometry)}else if(Tf(h.type))return new vc(h,h)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const a=r.geometry(),h=r.canonicalID();if(a!=null&&h!=null){if(r.geometryType()==="Point")return(function(f,_,y){const T=[];for(const k of f)for(const L of k)T.push(bf(L,_));const C=new xl(T[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?qm(T,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",C):y.type==="MultiLineString"?od(T,!1,y.coordinates,C):y.type==="Polygon"||y.type==="MultiPolygon"?$u(T,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,C):null})(a,h,this.geometries);if(r.geometryType()==="LineString")return(function(f,_,y){const T=[];for(const k of f){const L=[];for(const j of k)L.push(bf(j,_));T.push(L)}const C=new xl(T[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return od(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let k=1/0;for(let L=0;L<y.coordinates.length;L++){const j=od(y.coordinates[L],!0,T,C,k);if(isNaN(j))return j;if((k=Math.min(k,j))===0)return k}return k}if(y.type==="Polygon"||y.type==="MultiPolygon"){let k=1/0;for(let L=0;L<T.length;L++){const j=$u(T[L],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,C,k);if(isNaN(j))return j;if((k=Math.min(k,j))===0)return k}return k}return null})(a,h,this.geometries);if(r.geometryType()==="Polygon")return(function(f,_,y){const T=[];for(const k of(function(L,j){const N=L.length;if(N<=1)return[L];const H=[];let W,ee;for(let ie=0;ie<N;ie++){const se=nd(L[ie]);se!==0&&(L[ie].area=Math.abs(se),ee===void 0&&(ee=se<0),ee===se<0?(W&&H.push(W),W=[L[ie]]):W.push(L[ie]))}return W&&H.push(W),H})(f)){const L=[];for(let j=0;j<k.length;++j)L.push(Ki(k[j],_));T.push(L)}const C=new xl(T[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return $u(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let k=1/0;for(let L=0;L<y.coordinates.length;L++){const j=$u(y.coordinates[L],!0,T,C,k);if(isNaN(j))return j;if((k=Math.min(k,j))===0)return k}return k}return y.type==="Polygon"||y.type==="MultiPolygon"?(function(k,L,j){let N=1/0;for(const H of k)for(const W of L){const ee=S_(H,W,j,N);if(isNaN(ee))return ee;if((N=Math.min(N,ee))===0)return N}return N})(y.type==="Polygon"?[y.coordinates]:y.coordinates,T,C):null})(a,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Kc(l){if(l instanceof Cs&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof gc||l instanceof vc)return!1;if(l instanceof _a)return l.featureConstant;let r=!0;return l.eachChild((a=>{r&&!Kc(a)&&(r=!1)})),r}function ad(l){if(l instanceof Cs&&l.name==="feature-state")return!1;let r=!0;return l.eachChild((a=>{r&&!ad(a)&&(r=!1)})),r}function jp(l){if(l instanceof _a)return new Set([l.key]);let r=new Set;return l.eachChild((a=>{r=new Set([...r,...jp(a)])})),r}function Hu(l,r){if(l instanceof Cs&&r.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild((h=>{a&&!Hu(h,r)&&(a=!1)})),a}function T_(l,r,a){return[l,r,a].filter(Boolean).join("")}function Zm(l,r){switch(l){case"string":return zo(r);case"number":return+r;case"boolean":return!!r;case"color":return Ir.parse(r);case"formatted":return xo.fromString(zo(r));case"resolvedImage":return jo.build(zo(r))}return r}function zp(l,r,a,h){return h!==void 0&&(l=h*Math.round(l/h)),r!==void 0&&l<r&&(l=r),a!==void 0&&l>a&&(l=a),l}class _a{constructor(r,a,h,f=!1){this.type=r,this.key=a,this.scope=h,this.featureConstant=f}static parse(r,a){let h=a.expectedType;if(h==null&&(h=Dr),r.length<2||r.length>3)return a.error("Invalid number of arguments for 'config' expression.");const f=a.parse(r[1],1);if(!(f instanceof Gn))return a.error("Key name of 'config' expression must be a string literal.");let _,y=!0;const T=zo(f.value);if(r.length>=3){const C=a.parse(r[2],2);if(!(C instanceof Gn))return a.error("Scope of 'config' expression must be a string literal.");_=zo(C.value)}if(a.options){const C=T_(T,_,a._scope),k=a.options.get(C);k&&(y=Kc(k.value||k.default))}return new _a(h,T,_,y)}evaluate(r){const a=T_(this.key,this.scope,r.scope),h=r.getConfig(a);if(!h)return null;const{type:f,value:_,values:y,minValue:T,maxValue:C,stepValue:k}=h,L=h.default.evaluate(r);let j=L;if(_){const N=r.scope;r.scope=(N||"").split("").slice(1).join(""),j=_.evaluate(r),r.scope=N}return f&&(j=Zm(f,j)),j===void 0||T===void 0&&C===void 0&&k===void 0||(typeof j=="number"?j=zp(j,T,C,k):Array.isArray(j)&&(j=j.map((N=>typeof N=="number"?zp(N,T,C,k):N)))),_!==void 0&&j!==void 0&&y&&!y.includes(j)&&(j=L,f&&(j=Zm(f,j))),(f&&f!==this.type||j!==void 0&&!uf(fs(j),this.type))&&(j=Zm(this.type.kind,j)),j}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class Ef{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(r.length!==2||typeof r[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=r[1];return a.scope.has(h)?new Ef(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class xc{constructor(r,a=[],h,f=new of,_=[],y,T,C){this.registry=r,this.path=a,this.key=a.map((k=>typeof k=="string"?`['${k}']`:`[${k}]`)).join(""),this.scope=f,this.errors=_,this.expectedType=h,this._scope=y,this.options=T,this.iconImageUseTheme=C}parse(r,a,h,f,_={}){return a||h?this.concat(a,null,h,f)._parse(r,_):this._parse(r,_)}parseObjectValue(r,a,h,f,_,y={}){return this.concat(a,h,f,_)._parse(r,y)}_parse(r,a){function h(f,_,y){return y==="assert"?new In(_,[f]):y==="coerce"?new Hi(_,[f]):f}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(f){let _=f.parse(r,this);if(!_)return null;if(this.expectedType){const y=this.expectedType,T=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||T.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(y,T))return null}else _=h(_,y,a.typeAnnotation||"coerce");else _=h(_,y,a.typeAnnotation||"assert")}if(!(_ instanceof Gn)&&_.type.kind!=="resolvedImage"&&Za(_)){const y=new ga(this._scope,this.options,this.iconImageUseTheme);try{_=new Gn(_.type,_.evaluate(y))}catch(T){return this.error(T.message),null}}return _}return Hi.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,h,f){let _=typeof r=="number"?this.path.concat(r):this.path;_=typeof a=="string"?_.concat(a):_;const y=f?this.scope.concat(f):this.scope;return new xc(this.registry,_,h||null,y,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...a){const h=`${this.key}${a.map((f=>`[${f}]`)).join("")}`;this.errors.push(new Ko(h,r))}checkSubtype(r,a){const h=af(r,a);return h&&this.error(h),h}}function Za(l){if(l instanceof Ef)return Za(l.boundExpression);if(l instanceof Cs&&l.name==="error"||l instanceof ps||l instanceof gc||l instanceof vc||l instanceof _a)return!1;const r=l instanceof Hi||l instanceof In;let a=!0;return l.eachChild((h=>{a=r?a&&Za(h):a&&h instanceof Gn})),!!a&&Kc(l)&&Hu(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Jc(l,r){const a=l.length-1;let h,f,_=0,y=a,T=0;for(;_<=y;)if(T=Math.floor((_+y)/2),h=l[T],f=l[T+1],h<=r){if(T===a||r<f)return T;_=T+1}else{if(!(h>r))throw new Qt("Input is not a number.");y=T-1}return 0}class ya{constructor(r,a,h){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[f,_]of h)this.labels.push(f),this.outputs.push(_)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(r[1],1,_n);if(!h)return null;const f=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let y=1;y<r.length;y+=2){const T=y===1?-1/0:r[y],C=r[y+1],k=y,L=y+1;if(typeof T!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(f.length&&f[f.length-1][0]>=T)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const j=a.parse(C,L,_);if(!j)return null;_=_||j.type,f.push([T,j])}return new ya(_,h,f)}evaluate(r){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(r);const f=this.input.evaluate(r);if(f<=a[0])return h[0].evaluate(r);const _=a.length;return f>=a[_-1]?h[_-1].evaluate(r):h[Jc(a,f)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}const Np=.95047,E_=1.08883,A_=4/29,ea=6/29,ld=3*ea*ea,Gu=ea*ea*ea,Fp=Math.PI/180,Xm=180/Math.PI;function Qc(l){return l>Gu?Math.pow(l,1/3):l/ld+A_}function bl(l){return l>ea?l*l*l:ld*(l-A_)}function Bi(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Si(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Ul(l){const r=Si(l.r),a=Si(l.g),h=Si(l.b),f=Qc((.4124564*r+.3575761*a+.1804375*h)/Np),_=Qc((.2126729*r+.7151522*a+.072175*h)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-Qc((.0193339*r+.119192*a+.9503041*h)/E_)),alpha:l.a}}function Hs(l){let r=(l.l+16)/116,a=isNaN(l.a)?r:r+l.a/500,h=isNaN(l.b)?r:r-l.b/200;return r=1*bl(r),a=Np*bl(a),h=E_*bl(h),new Ir(Bi(3.2404542*a-1.5371385*r-.4985314*h),Bi(-.969266*a+1.8760108*r+.041556*h),Bi(.0556434*a-.2040259*r+1.0572252*h),l.alpha)}function ta(l,r,a){const h=r-l;return l+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const va={forward:Ul,reverse:Hs,interpolate:function(l,r,a){return{l:An(l.l,r.l,a),a:An(l.a,r.a,a),b:An(l.b,r.b,a),alpha:An(l.alpha,r.alpha,a)}}},Xa={forward:function(l){const{l:r,a,b:h}=Ul(l),f=Math.atan2(h,a)*Xm;return{h:f<0?f+360:f,c:Math.sqrt(a*a+h*h),l:r,alpha:l.a}},reverse:function(l){const r=l.h*Fp,a=l.c;return Hs({l:l.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:l.alpha})},interpolate:function(l,r,a){return{h:ta(l.h,r.h,a),c:An(l.c,r.c,a),l:An(l.l,r.l,a),alpha:An(l.alpha,r.alpha,a)}}};var No=Object.freeze({__proto__:null,hcl:Xa,lab:va});class wo{constructor(r,a,h,f,_){this.type=r,this.operator=a,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[y,T]of _)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(r,a,h,f){let _=0;if(r.name==="exponential")_=Af(a,r.base,h,f);else if(r.name==="linear")_=Af(a,1,h,f);else if(r.name==="cubic-bezier"){const y=r.controlPoints;_=new Wd(y[0],y[1],y[2],y[3]).solve(Af(a,1,h,f))}return _}static parse(r,a){let[h,f,_,...y]=r;if(!Array.isArray(f)||f.length===0)return a.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const k=f[1];if(typeof k!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:k}}else{if(f[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const k=f.slice(1);if(k.length!==4||k.some((L=>typeof L!="number"||L<0||L>1)))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:k}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,_n),!_)return null;const T=[];let C=null;h==="interpolate-hcl"||h==="interpolate-lab"?C=Jo:a.expectedType&&a.expectedType.kind!=="value"&&(C=a.expectedType);for(let k=0;k<y.length;k+=2){const L=y[k],j=y[k+1],N=k+3,H=k+4;if(typeof L!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(T.length&&T[T.length-1][0]>=L)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const W=a.parse(j,H,C);if(!W)return null;C=C||W.type,T.push([L,W])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new wo(C,h,f,_,T):a.error(`Type ${ns(C)} is not interpolatable.`)}evaluate(r){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(r);const f=this.input.evaluate(r);if(f<=a[0])return h[0].evaluate(r);const _=a.length;if(f>=a[_-1])return h[_-1].evaluate(r);const y=Jc(a,f),T=wo.interpolationFactor(this.interpolation,f,a[y],a[y+1]),C=h[y].evaluate(r),k=h[y+1].evaluate(r);return this.operator==="interpolate"?so[this.type.kind.toLowerCase()](C,k,T):this.operator==="interpolate-hcl"?Xa.reverse(Xa.interpolate(Xa.forward(C),Xa.forward(k),T)):va.reverse(va.interpolate(va.forward(C),va.forward(k),T))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a}}function Af(l,r,a,h){const f=h-a,_=l-a;return f===0?0:r===1?_/f:(Math.pow(r,_)-1)/(Math.pow(r,f)-1)}class cd{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let h=null;const f=a.expectedType;f&&f.kind!=="value"&&(h=f);const _=[];for(const T of r.slice(1)){const C=a.parse(T,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,_.push(C)}const y=f&&_.some((T=>af(f,T.type)));return new cd(y?Dr:h,_)}evaluate(r){let a,h=null,f=0;for(const _ of this.args){if(f++,h=_.evaluate(r),h&&h instanceof jo&&!h.available&&(a||(a=h),h=null,f===this.args.length))return a;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}serialize(){const r=["coalesce"];return this.eachChild((a=>{r.push(a.serialize())})),r}}class Wu{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let _=1;_<r.length-1;_+=2){const y=r[_];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=a.parse(r[_+1],_+1);if(!T)return null;h.push([y,T])}const f=a.parse(r[r.length-1],r.length-1,a.expectedType,h);return f?new Wu(h,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,h]of this.bindings)r.push(a,h.serialize());return r.push(this.result.serialize()),r}}class Bp{constructor(r,a,h){this.type=r,this.index=a,this.input=h}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,_n),f=a.parse(r[2],2,oo(a.expectedType||Dr));return h&&f?new Bp(f.type.itemType,h,f):null}evaluate(r){const a=this.index.evaluate(r),h=this.input.evaluate(r);if(a<0)throw new Qt("Array index out of bounds: negative index");if(a>=h.length)throw new Qt("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new Qt("Array index must be an integer. Use at-interpolated for fractional indices");return h[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class wl{constructor(r,a,h){this.type=r,this.index=a,this.input=h}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,_n),f=a.parse(r[2],2,oo(a.expectedType||Dr));return h&&f?new wl(f.type.itemType,h,f):null}evaluate(r){const a=this.index.evaluate(r),h=this.input.evaluate(r);if(a<0)throw new Qt(`Array index out of bounds: ${a} < 0.`);if(a>h.length-1)throw new Qt(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a===Math.floor(a))return h[a];const f=Math.floor(a),_=Math.ceil(a),y=h[f],T=h[_];if(typeof y!="number"||typeof T!="number")throw new Qt(`Cannot interpolate between non-number values at index ${a}.`);const C=a-f;return y*(1-C)+T*C}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class qu{constructor(r,a){this.type=zr,this.needle=r,this.haystack=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,Dr),f=a.parse(r[2],2,Dr);return h&&f?lf(h.type,[zr,Nr,_n,Nl,Dr])?new qu(h,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ns(h.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!cf(a,["boolean","string","number","null"]))throw new Qt(`Expected first argument to be of type boolean, string, number or null, but found ${ns(fs(a))} instead.`);if(!cf(h,["string","array"]))throw new Qt(`Expected second argument to be of type array or string, but found ${ns(fs(h))} instead.`);return h.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Zu{constructor(r,a,h){this.type=_n,this.needle=r,this.haystack=a,this.fromIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,Dr),f=a.parse(r[2],2,Dr);if(!h||!f)return null;if(!lf(h.type,[zr,Nr,_n,Nl,Dr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ns(h.type)} instead`);if(r.length===4){const _=a.parse(r[3],3,_n);return _?new Zu(h,f,_):null}return new Zu(h,f)}evaluate(r){const a=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!cf(a,["boolean","string","number","null"]))throw new Qt(`Expected first argument to be of type boolean, string, number or null, but found ${ns(fs(a))} instead.`);if(!cf(h,["string","array"]))throw new Qt(`Expected second argument to be of type array or string, but found ${ns(fs(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(r);return h.indexOf(a,f)}return h.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xu{constructor(r,a,h,f,_,y){this.inputType=r,this.type=a,this.input=h,this.cases=f,this.outputs=_,this.otherwise=y}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let h,f;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);const _={},y=[];for(let k=2;k<r.length-1;k+=2){let L=r[k];const j=r[k+1];Array.isArray(L)||(L=[L]);const N=a.concat(k);if(L.length===0)return N.error("Expected at least one branch label.");for(const W of L){if(typeof W!="number"&&typeof W!="string")return N.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,fs(W)))return null}else h=fs(W);if(_[String(W)]!==void 0)return N.error("Branch labels must be unique.");_[String(W)]=y.length}const H=a.parse(j,k,f);if(!H)return null;f=f||H.type,y.push(H)}const T=a.parse(r[1],1,Dr);if(!T)return null;const C=a.parse(r[r.length-1],r.length-1,f);return C?T.type.kind!=="value"&&a.concat(1).checkSubtype(h,T.type)?null:new Xu(h,f,T,_,y,C):null}evaluate(r){const a=this.input.evaluate(r);return(uf(fs(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),h=[],f={};for(const y of a){const T=f[this.cases[y]];T===void 0?(f[this.cases[y]]=h.length,h.push([this.cases[y],[y]])):h[T][1].push(y)}const _=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of h)r.push(T.length===1?_(T[0]):T.map(_)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class Ym{constructor(r,a,h){this.type=r,this.branches=a,this.otherwise=h}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const f=[];for(let y=1;y<r.length-1;y+=2){const T=a.parse(r[y],y,zr);if(!T)return null;const C=a.parse(r[y+1],y+1,h);if(!C)return null;f.push([T,C]),h=h||C.type}const _=a.parse(r[r.length-1],r.length-1,h);return _?new Ym(h,f,_):null}evaluate(r){for(const[a,h]of this.branches)if(a.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,h]of this.branches)r(a),r(h);r(this.otherwise)}outputDefined(){return this.branches.every((([r,a])=>a.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild((a=>{r.push(a.serialize())})),r}}class Ya{constructor(r,a,h,f){this.type=r,this.input=a,this.beginIndex=h,this.endIndex=f}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,Dr),f=a.parse(r[2],2,_n);if(!h||!f)return null;if(!lf(h.type,[oo(Dr),Nr,Dr]))return a.error(`Expected first argument to be of type array or string, but found ${ns(h.type)} instead`);if(r.length===4){const _=a.parse(r[3],3,_n);return _?new Ya(h.type,h,f,_):null}return new Ya(h.type,h,f)}evaluate(r){const a=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!cf(a,["string","array"]))throw new Qt(`Expected first argument to be of type array or string, but found ${ns(fs(a))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(r);return a.slice(h,f)}return a.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class eu{constructor(r,a){this.type=oo(Nr),this.str=r,this.delimiter=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,Nr),f=a.parse(r[2],2,Nr);return h&&f?new eu(h,f):void 0}evaluate(r){const a=this.str.evaluate(r),h=this.delimiter.evaluate(r);return a.split(h)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Yu(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function ud(l,r,a,h){return h.compare(r,a)===0}function Vl(l,r,a){const h=l!=="=="&&l!=="!=";return class gF{constructor(_,y,T){this.type=zr,this.lhs=_,this.rhs=y,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const T=_[0];let C=y.parse(_[1],1,Dr);if(!C)return null;if(!Yu(T,C.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${ns(C.type)}'.`);let k=y.parse(_[2],2,Dr);if(!k)return null;if(!Yu(T,k.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${ns(k.type)}'.`);if(C.type.kind!==k.type.kind&&C.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${ns(C.type)}' and '${ns(k.type)}'.`);h&&(C.type.kind==="value"&&k.type.kind!=="value"?C=new In(k.type,[C]):C.type.kind!=="value"&&k.type.kind==="value"&&(k=new In(C.type,[k])));let L=null;if(_.length===4){if(C.type.kind!=="string"&&k.type.kind!=="string"&&C.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(L=y.parse(_[3],3,Ap),!L)return null}return new gF(C,k,L)}evaluate(_){const y=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const C=fs(y),k=fs(T);if(C.kind!==k.kind||C.kind!=="string"&&C.kind!=="number")throw new Qt(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${C.kind}, ${k.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=fs(y),k=fs(T);if(C.kind!=="string"||k.kind!=="string")return r(_,y,T)}return this.collator?a(_,y,T,this.collator.evaluate(_)):r(_,y,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[l];return this.eachChild((y=>{_.push(y.serialize())})),_}}}const Ka=Vl("==",(function(l,r,a){return r===a}),ud),Ja=Vl("!=",(function(l,r,a){return r!==a}),(function(l,r,a,h){return!ud(0,r,a,h)})),Ku=Vl("<",(function(l,r,a){return r<a}),(function(l,r,a,h){return h.compare(r,a)<0})),Qa=Vl(">",(function(l,r,a){return r>a}),(function(l,r,a,h){return h.compare(r,a)>0})),bc=Vl("<=",(function(l,r,a){return r<=a}),(function(l,r,a,h){return h.compare(r,a)<=0})),Ju=Vl(">=",(function(l,r,a){return r>=a}),(function(l,r,a,h){return h.compare(r,a)>=0}));class Up{constructor(r,a,h,f,_,y){this.type=Nr,this.number=r,this.locale=a,this.currency=h,this.unit=f,this.minFractionDigits=_,this.maxFractionDigits=y}static parse(r,a){if(r.length!==3)return a.error("Expected two arguments.");const h=a.parse(r[1],1,_n);if(!h)return null;const f=r[2];if(typeof f!="object"||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=a.parseObjectValue(f.locale,2,"locale",Nr),!_))return null;let y=null;if(f.currency&&(y=a.parseObjectValue(f.currency,2,"currency",Nr),!y))return null;let T=null;if(f.unit&&(T=a.parseObjectValue(f.unit,2,"unit",Nr),!T))return null;let C=null;if(f["min-fraction-digits"]&&(C=a.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",_n),!C))return null;let k=null;return f["max-fraction-digits"]&&(k=a.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",_n),!k)?null:new Up(h,_,y,T,C,k)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Cf{constructor(r){this.type=_n,this.input=r}static parse(r,a){if(r.length!==2)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=a.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${ns(h.type)} instead.`):new Cf(h):null}evaluate(r){const a=this.input.evaluate(r);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Qt(`Expected value to be of type string or array, but found ${ns(fs(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild((a=>{r.push(a.serialize())})),r}}function Pf(l){return function(){l=1831565813+(l|=0)|0;let r=Math.imul(l^l>>>15,1|l);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const Gs={"==":Ka,"!=":Ja,">":Qa,"<":Ku,">=":Ju,"<=":bc,array:In,at:Bp,"at-interpolated":wl,boolean:In,case:Ym,coalesce:cd,collator:ps,format:Zc,image:ju,in:qu,"index-of":Zu,interpolate:wo,"interpolate-hcl":wo,"interpolate-lab":wo,length:Cf,let:Wu,literal:Gn,match:Xu,number:In,"number-format":Up,object:In,slice:Ya,step:ya,string:In,"to-boolean":Hi,"to-color":Hi,"to-number":Hi,"to-string":Hi,var:Ef,within:gc,distance:vc,config:_a,split:eu};function na(l,[r,a,h,f]){r=r.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const _=f?f.evaluate(l):1,y=p_(r,a,h,_);if(y)throw new Qt(y);return new Ir(r/255,a/255,h/255,_)}function qi(l,[r,a,h,f]){r=r.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const _=f?f.evaluate(l):1,y=(function(k,L,j,N){return typeof k=="number"&&k>=0&&k<=360?typeof L=="number"&&L>=0&&L<=100&&typeof j=="number"&&j>=0&&j<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[k,L,j,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[k,L,j,N]:[k,L,j]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[k,L,j,N]:[k,L,j]).join(", ")}]: 'h' must be between 0 and 360.`})(r,a,h,_);if(y)throw new Qt(y);const T=`hsla(${r}, ${a}%, ${h}%, ${_})`,C=Ir.parse(T);if(!C)throw new Qt(`Failed to parse HSLA color: ${T}`);return C}function xa(l,r){return l in r}function If(l,r){const a=r[l];return a===void 0?null:a}function tu(l){return{type:l}}function wc(l){return{result:"success",value:l}}function $l(l){return{result:"error",value:l}}function Vp(l,r){return!!l&&!!l.parameters&&l.parameters.indexOf(r)>-1}function Qu(l){return l["property-type"]==="data-driven"}function $p(l){return Vp(l.expression,"measure-light")}function nu(l){return Vp(l.expression,"zoom")}function hd(l){return!!l.expression&&l.expression.interpolated}function Hp(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function eh(l){return l}function th(l,r){const a=r.type==="color",h=l.stops&&typeof l.stops[0][0]=="object",f=h||!(h||l.property!==void 0),_=l.type||(hd(r)?"exponential":"interval");if(a&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map((k=>[k[0],Ir.parse(k[1])]))),l.default=Ir.parse(l.default?l.default:r.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!No[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let y,T,C;if(_==="exponential")y=Km;else if(_==="interval")y=ba;else if(_==="categorical"){y=C_,T=Object.create(null);for(const k of l.stops)T[k[0]]=k[1];C=typeof l.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);y=Gp}if(h){const k={},L=[];for(let H=0;H<l.stops.length;H++){const W=l.stops[H],ee=W[0].zoom;k[ee]===void 0&&(k[ee]={zoom:ee,type:l.type,property:l.property,default:l.default,stops:[]},L.push(ee)),k[ee].stops.push([W[0].value,W[1]])}const j=[];for(const H of L)j.push([k[H].zoom,th(k[H],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:wo.interpolationFactor.bind(void 0,N),zoomStops:j.map((H=>H[0])),evaluate:({zoom:H},W)=>Km({stops:j,base:l.base},r,H).evaluate(H,W)}}if(f){const k=_==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:wo.interpolationFactor.bind(void 0,k),zoomStops:l.stops.map((L=>L[0])),evaluate:({zoom:L})=>y(l,r,L,T,C)}}return{kind:"source",evaluate(k,L){const j=L&&L.properties?L.properties[l.property]:void 0;return j===void 0?nh(l.default,r.default):y(l,r,j,T,C)}}}function nh(l,r,a){return l!==void 0?l:r!==void 0?r:a!==void 0?a:void 0}function C_(l,r,a,h,f){return nh(typeof a===f?h[a]:void 0,l.default,r.default)}function ba(l,r,a){if(!ff(a))return nh(l.default,r.default);const h=l.stops.length;if(h===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[h-1][0])return l.stops[h-1][1];const f=Jc(l.stops.map((_=>_[0])),a);return l.stops[f][1]}function Km(l,r,a){const h=l.base!==void 0?l.base:1;if(!ff(a))return nh(l.default,r.default);const f=l.stops.length;if(f===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[f-1][0])return l.stops[f-1][1];const _=Jc(l.stops.map((L=>L[0])),a),y=(function(L,j,N,H){const W=H-N,ee=L-N;return W===0?0:j===1?ee/W:(Math.pow(j,ee)-1)/(Math.pow(j,W)-1)})(a,h,l.stops[_][0],l.stops[_+1][0]),T=l.stops[_][1],C=l.stops[_+1][1];let k=so[r.type]||eh;if(l.colorSpace&&l.colorSpace!=="rgb"){const L=No[l.colorSpace];k=(j,N)=>L.reverse(L.interpolate(L.forward(j),L.forward(N),y))}return typeof T.evaluate=="function"?{evaluate(...L){const j=T.evaluate.apply(void 0,L),N=C.evaluate.apply(void 0,L);if(j!==void 0&&N!==void 0)return k(j,N,y)}}:k(T,C,y)}function Gp(l,r,a){return r.type==="color"?a=Ir.parse(a):r.type==="formatted"?a=xo.fromString(a.toString()):r.type==="resolvedImage"?a=jo.build(a.toString()):Dn(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0),nh(a,l.default,r.default)}Cs.register(Gs,{error:[{kind:"error"},[Nr],(l,[r])=>{throw new Qt(r.evaluate(l))}],typeof:[Nr,[Dr],(l,[r])=>ns(fs(r.evaluate(l)))],"to-rgba":[oo(_n,4),[Jo],(l,[r])=>r.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[oo(_n,4),[Jo],(l,[r])=>r.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Jo,[_n,_n,_n],na],rgba:[Jo,[_n,_n,_n,_n],na],hsl:[Jo,[_n,_n,_n],qi],hsla:[Jo,[_n,_n,_n,_n],qi],has:{type:zr,overloads:[[[Nr],(l,[r])=>xa(r.evaluate(l),l.properties())],[[Nr,Lu],(l,[r,a])=>xa(r.evaluate(l),a.evaluate(l))]]},get:{type:Dr,overloads:[[[Nr],(l,[r])=>If(r.evaluate(l),l.properties())],[[Nr,Lu],(l,[r,a])=>If(r.evaluate(l),a.evaluate(l))]]},"feature-state":[Dr,[Nr],(l,[r])=>If(r.evaluate(l),l.featureState||{})],properties:[Lu,[],l=>l.properties()],"geometry-type":[Nr,[],l=>l.geometryType()],worldview:[Nr,[],l=>l.globals.worldview||""],id:[Dr,[],l=>l.id()],zoom:[_n,[],l=>l.globals.zoom],pitch:[_n,[],l=>l.globals.pitch||0],"distance-from-center":[_n,[],l=>l.distanceFromCenter()],"measure-light":[_n,[Nr],(l,[r])=>l.measureLight(r.evaluate(l))],"heatmap-density":[_n,[],l=>l.globals.heatmapDensity||0],"line-progress":[_n,[],l=>l.globals.lineProgress||0],"raster-value":[_n,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[_n,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[_n,[],l=>l.globals.skyRadialProgress||0],accumulated:[Dr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[_n,tu(_n),(l,r)=>{let a=0;for(const h of r)a+=h.evaluate(l);return a}],"*":[_n,tu(_n),(l,r)=>{let a=1;for(const h of r)a*=h.evaluate(l);return a}],"-":{type:_n,overloads:[[[_n,_n],(l,[r,a])=>r.evaluate(l)-a.evaluate(l)],[[_n],(l,[r])=>-r.evaluate(l)]]},"/":[_n,[_n,_n],(l,[r,a])=>r.evaluate(l)/a.evaluate(l)],"%":[_n,[_n,_n],(l,[r,a])=>r.evaluate(l)%a.evaluate(l)],ln2:[_n,[],()=>Math.LN2],pi:[_n,[],()=>Math.PI],e:[_n,[],()=>Math.E],"^":[_n,[_n,_n],(l,[r,a])=>Math.pow(r.evaluate(l),a.evaluate(l))],sqrt:[_n,[_n],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[_n,[_n],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[_n,[_n],(l,[r])=>Math.log(r.evaluate(l))],log2:[_n,[_n],(l,[r])=>Math.log2(r.evaluate(l))],sin:[_n,[_n],(l,[r])=>Math.sin(r.evaluate(l))],cos:[_n,[_n],(l,[r])=>Math.cos(r.evaluate(l))],tan:[_n,[_n],(l,[r])=>Math.tan(r.evaluate(l))],asin:[_n,[_n],(l,[r])=>Math.asin(r.evaluate(l))],acos:[_n,[_n],(l,[r])=>Math.acos(r.evaluate(l))],atan:[_n,[_n],(l,[r])=>Math.atan(r.evaluate(l))],min:[_n,tu(_n),(l,r)=>Math.min(...r.map((a=>a.evaluate(l))))],max:[_n,tu(_n),(l,r)=>Math.max(...r.map((a=>a.evaluate(l))))],abs:[_n,[_n],(l,[r])=>Math.abs(r.evaluate(l))],round:[_n,[_n],(l,[r])=>{const a=r.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[_n,[_n],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[_n,[_n],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[zr,[Nr,Dr],(l,[r,a])=>l.properties()[r.value]===a.value],"filter-id-==":[zr,[Dr],(l,[r])=>l.id()===r.value],"filter-type-==":[zr,[Nr],(l,[r])=>l.geometryType()===r.value],"filter-<":[zr,[Nr,Dr],(l,[r,a])=>{const h=l.properties()[r.value],f=a.value;return typeof h==typeof f&&h<f}],"filter-id-<":[zr,[Dr],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a<h}],"filter->":[zr,[Nr,Dr],(l,[r,a])=>{const h=l.properties()[r.value],f=a.value;return typeof h==typeof f&&h>f}],"filter-id->":[zr,[Dr],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a>h}],"filter-<=":[zr,[Nr,Dr],(l,[r,a])=>{const h=l.properties()[r.value],f=a.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[zr,[Dr],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a<=h}],"filter->=":[zr,[Nr,Dr],(l,[r,a])=>{const h=l.properties()[r.value],f=a.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[zr,[Dr],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a>=h}],"filter-has":[zr,[Dr],(l,[r])=>r.value in l.properties()],"filter-has-id":[zr,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[zr,[oo(Nr)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[zr,[oo(Dr)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[zr,[Nr,oo(Dr)],(l,[r,a])=>a.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[zr,[Nr,oo(Dr)],(l,[r,a])=>(function(h,f,_,y){for(;_<=y;){const T=_+y>>1;if(f[T]===h)return!0;f[T]>h?y=T-1:_=T+1}return!1})(l.properties()[r.value],a.value,0,a.value.length-1)],all:{type:zr,overloads:[[[zr,zr],(l,[r,a])=>r.evaluate(l)&&a.evaluate(l)],[tu(zr),(l,r)=>{for(const a of r)if(!a.evaluate(l))return!1;return!0}]]},any:{type:zr,overloads:[[[zr,zr],(l,[r,a])=>r.evaluate(l)||a.evaluate(l)],[tu(zr),(l,r)=>{for(const a of r)if(a.evaluate(l))return!0;return!1}]]},"!":[zr,[zr],(l,[r])=>!r.evaluate(l)],"is-supported-script":[zr,[Nr],(l,[r])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(r.evaluate(l))}],upcase:[Nr,[Nr],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[Nr,[Nr],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[Nr,tu(Dr),(l,r)=>r.map((a=>zo(a.evaluate(l)))).join("")],"resolved-locale":[Nr,[Ap],(l,[r])=>r.evaluate(l).resolvedLocale()],random:[_n,[_n,_n,Dr],(l,r)=>{const[a,h,f]=r.map((y=>y.evaluate(l)));if(a>h||a===h)return a;let _;if(typeof f=="string")_=(function(y){let T=0;if(y.length===0)return T;for(let C=0;C<y.length;C++)T=(T<<5)-T+y.charCodeAt(C),T|=0;return T})(f);else{if(typeof f!="number")throw new Qt(`Invalid seed input: ${f}`);_=f}return a+Pf(_)()*(h-a)}]});class rh{constructor(r,a,h,f,_){this.expression=r,this._warningHistory={},this._evaluator=new ga(h,f,_),this._defaultValue=a?(function(y){return y.type==="color"&&(Hp(y.default)||Array.isArray(y.default))?new Ir(0,0,0,0):y.type==="color"?Ir.parse(y.default)||null:y.default===void 0?null:y.default})(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=jp(r)}evaluateWithoutErrorHandling(r,a,h,f,_,y,T,C){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,h,f,_,y,T,C,k){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null,this._evaluator.iconImageUseTheme=k||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Qt(`Expected value to be one of ${Object.keys(this._enumValues).map((j=>JSON.stringify(j))).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${L.message}`)),this._defaultValue}}}function ru(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Gs}function el(l,r,a,h,f){const _=new xc(Gs,[],r?(function(T){const C={color:Jo,string:Nr,number:_n,enum:Nr,boolean:zr,formatted:Wc,resolvedImage:Qh};return T.type==="array"?oo(C[T.value]||Dr,T.length):C[T.type]})(r):void 0,void 0,void 0,a,h,f),y=_.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?wc(new rh(y,r,a,h,f)):$l(_.errors)}class ih{constructor(r,a,h,f){this.kind=r,this._styleExpression=a,this.isLightConstant=h,this.isLineProgressConstant=f,this.isStateDependent=r!=="constant"&&!ad(a.expression),this.configDependencies=jp(a.expression)}evaluateWithoutErrorHandling(r,a,h,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,h,f,_,y)}evaluate(r,a,h,f,_,y,T){return this._styleExpression.evaluate(r,a,h,f,_,y,void 0,void 0,T)}}class Hl{constructor(r,a,h,f,_,y){this.kind=r,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=r!=="camera"&&!ad(a.expression),this.isLightConstant=_,this.isLineProgressConstant=y,this.configDependencies=jp(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(r,a,h,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,h,f,_,y)}evaluate(r,a,h,f,_,y){return this._styleExpression.evaluate(r,a,h,f,_,y)}interpolationFactor(r,a,h){return this.interpolationType?wo.interpolationFactor(this.interpolationType,r,a,h):0}}function Mf(l,r,a,h,f){if((l=el(l,r,a,h,f)).result==="error")return l;const _=l.value.expression,y=Kc(_);if(!y&&!Qu(r))return $l([new Ko("","data expressions not supported")]);const T=Hu(_,["zoom","pitch","distance-from-center"]);if(!T&&!nu(r))return $l([new Ko("","zoom expressions not supported")]);const C=Hu(_,["measure-light"]);if(!C&&!$p(r))return $l([new Ko("","measure-light expression not supported")]);const k=Hu(_,["line-progress"]);if(!k&&!(function(N){return Vp(N.expression,"line-progress")})(r))return $l([new Ko("","line-progress expression not supported")]);const L=r.expression&&r.expression.relaxZoomRestriction,j=Fo(_);return j||T||L?j instanceof Ko?$l([j]):j instanceof wo&&!hd(r)?$l([new Ko("",'"interpolate" expressions cannot be used with this property')]):wc(j?new Hl(y&&k?"camera":"composite",l.value,j.labels,j instanceof wo?j.interpolation:void 0,C,k):new ih(y&&k?"constant":"source",l.value,C,k)):$l([new Ko("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Sc{constructor(r,a){this._parameters=r,this._specification=a,Object.assign(this,th(this._parameters,this._specification))}static deserialize(r){return new Sc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Fo(l){let r=null;if(l instanceof Wu)r=Fo(l.result);else if(l instanceof cd){for(const a of l.args)if(r=Fo(a),r)break}else(l instanceof ya||l instanceof wo)&&l.input instanceof Cs&&l.input.name==="zoom"&&(r=l);return r instanceof Ko||l.eachChild((a=>{const h=Fo(a);h instanceof Ko?r=h:r&&h&&r!==h&&(r=new Ko("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}var Sl,dd,Jm=(function(){if(dd)return Sl;dd=1,Sl=r;var l=3;function r(a,h,f){var _=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(h=y[1])+2*(f=y[2]);for(var T=0;T<this.d*this.d;T++){var C=y[l+T],k=y[l+T+1];_.push(C===k?null:y.subarray(C,k))}var L=y[l+_.length+1];this.keys=y.subarray(y[l+_.length],L),this.bboxes=y.subarray(L),this.insert=this._insertReadonly}else{this.d=h+2*f;for(var j=0;j<this.d*this.d;j++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=f,this.scale=h/a,this.uid=0;var N=f/h*a;this.min=-N,this.max=a+N}return r.prototype.insert=function(a,h,f,_,y){this._forEachCell(h,f,_,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(a,h,f,_,y,T){this.cells[y].push(T)},r.prototype.query=function(a,h,f,_,y){var T=this.min,C=this.max;if(a<=T&&h<=T&&C<=f&&C<=_&&!y)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(a,h,f,_,this._queryCell,k,{},y),k},r.prototype._queryCell=function(a,h,f,_,y,T,C,k){var L=this.cells[y];if(L!==null)for(var j=this.keys,N=this.bboxes,H=0;H<L.length;H++){var W=L[H];if(C[W]===void 0){var ee=4*W;(k?k(N[ee+0],N[ee+1],N[ee+2],N[ee+3]):a<=N[ee+2]&&h<=N[ee+3]&&f>=N[ee+0]&&_>=N[ee+1])?(C[W]=!0,T.push(j[W])):C[W]=!1}}},r.prototype._forEachCell=function(a,h,f,_,y,T,C,k){for(var L=this._convertToCellCoord(a),j=this._convertToCellCoord(h),N=this._convertToCellCoord(f),H=this._convertToCellCoord(_),W=L;W<=N;W++)for(var ee=j;ee<=H;ee++){var ie=this.d*ee+W;if((!k||k(this._convertFromCellCoord(W),this._convertFromCellCoord(ee),this._convertFromCellCoord(W+1),this._convertFromCellCoord(ee+1)))&&y.call(this,a,h,f,_,ie,T,C,k))return}},r.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},r.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=l+this.cells.length+1+1,f=0,_=0;_<this.cells.length;_++)f+=this.cells[_].length;var y=new Int32Array(h+f+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=h,C=0;C<a.length;C++){var k=a[C];y[l+C]=T,y.set(k,T),T+=k.length}return y[l+a.length]=T,y.set(this.keys,T),y[l+a.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},Sl})(),Bo=Hh(Jm);const wa={};function nn(l,r,a={}){Object.defineProperty(l,"_classRegistryKey",{value:r,writable:!1}),wa[r]={klass:l,omit:a.omit||[]}}nn(Object,"Object"),Bo.serialize=function(l,r){const a=l.toArrayBuffer();return r&&r.add(a),{buffer:a}},Bo.deserialize=function(l){return new Bo(l.buffer)},Object.defineProperty(Bo,"name",{value:"Grid"}),nn(Bo,"Grid"),delete It.prototype.constructor,typeof DOMMatrix<"u"&&nn(DOMMatrix,"DOMMatrix"),nn(Ir,"Color"),nn(Error,"Error"),nn(xo,"Formatted"),nn(hf,"FormattedSection"),nn(Um,"AJAXError"),nn(jo,"ResolvedImage"),nn(Sc,"StylePropertyFunction"),nn(rh,"StyleExpression",{omit:["_evaluator"]}),nn(vo,"ImageId"),nn(vl,"ImageVariant"),nn(Hl,"ZoomDependentExpression"),nn(ih,"ZoomConstantExpression"),nn(Cs,"CompoundExpression",{omit:["_evaluate"]});for(const l in Gs)wa[Gs[l]._classRegistryKey]||nn(Gs[l],`Expression${l}`);function Wp(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function lo(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Uo(l,r){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Wp(l)||lo(l))return r&&r.add(l),l;if(ArrayBuffer.isView(l))return r&&r.add(l.buffer),l;if(l instanceof ImageData)return r&&r.add(l.data.buffer),l;if(Array.isArray(l)){const a=[];for(const h of l)a.push(Uo(h,r));return a}if(l instanceof Map){const a={$name:"Map",entries:[]};for(const[h,f]of l.entries())a.entries.push(Uo(h),Uo(f,r));return a}if(l instanceof Set){const a={$name:"Set"};let h=0;for(const f of l.values())a[++h]=Uo(f);return a}if(l instanceof DOMMatrix){const a={$name:"DOMMatrix"},h=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const f of h)a[f]=l[f];return a}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const a=l.constructor,h=a._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const f=a.serialize?a.serialize(l,r):{};if(!a.serialize){for(const _ in l)l.hasOwnProperty(_)&&(wa[h].omit.indexOf(_)>=0||(f[_]=Uo(l[_],r)));l instanceof Error&&(f.message=l.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof l)}function Tl(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Wp(l)||lo(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Tl);if(typeof l=="object"){const r=l.$name||"Object";if(r==="Map"){const f=l.entries||[],_=new Map;for(let y=0;y<f.length;y+=2)_.set(Tl(f[y]),Tl(f[y+1]));return _}if(r==="Set"){const f=new Set;for(const _ of Object.keys(l))_!=="$name"&&f.add(Tl(l[_]));return f}if(r==="DOMMatrix"){let f;return f=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(f)}if(r==="BigInt")return BigInt(l.value);const{klass:a}=wa[r];if(!a)throw new Error(`Can't deserialize unregistered class "${r}".`);if(a.deserialize)return a.deserialize(l);const h=Object.create(a.prototype);for(const f of Object.keys(l))f!=="$name"&&(h[f]=Tl(l[f]));return h}throw new Error("can't deserialize object of type "+typeof l)}const Cn={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function fd(l){for(const r of l)if(Sa(r.charCodeAt(0)))return!0;return!1}function Qm(l){for(const r of l)if(!iu(r.charCodeAt(0)))return!1;return!0}function iu(l){return!(Cn.Arabic(l)||Cn["Arabic Supplement"](l)||Cn["Arabic Extended-A"](l)||Cn["Arabic Presentation Forms-A"](l)||Cn["Arabic Presentation Forms-B"](l))}function Sa(l){return!(l!==746&&l!==747&&(l<4352||!(Cn["Bopomofo Extended"](l)||Cn.Bopomofo(l)||Cn["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Cn["CJK Compatibility Ideographs"](l)||Cn["CJK Compatibility"](l)||Cn["CJK Radicals Supplement"](l)||Cn["CJK Strokes"](l)||!(!Cn["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Cn["CJK Unified Ideographs Extension A"](l)||Cn["CJK Unified Ideographs"](l)||Cn["Enclosed CJK Letters and Months"](l)||Cn["Hangul Compatibility Jamo"](l)||Cn["Hangul Jamo Extended-A"](l)||Cn["Hangul Jamo Extended-B"](l)||Cn["Hangul Jamo"](l)||Cn["Hangul Syllables"](l)||Cn.Hiragana(l)||Cn["Ideographic Description Characters"](l)||Cn.Kanbun(l)||Cn["Kangxi Radicals"](l)||Cn["Katakana Phonetic Extensions"](l)||Cn.Katakana(l)&&l!==12540||!(!Cn["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Cn["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Cn["Unified Canadian Aboriginal Syllabics"](l)||Cn["Unified Canadian Aboriginal Syllabics Extended"](l)||Cn["Vertical Forms"](l)||Cn["Yijing Hexagram Symbols"](l)||Cn["Yi Syllables"](l)||Cn["Yi Radicals"](l))))}function su(l){return!(Sa(l)||(function(r){return!!(Cn["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Cn["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Cn["Letterlike Symbols"](r)||Cn["Number Forms"](r)||Cn["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Cn["Control Pictures"](r)&&r!==9251||Cn["Optical Character Recognition"](r)||Cn["Enclosed Alphanumerics"](r)||Cn["Geometric Shapes"](r)||Cn["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Cn["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Cn["CJK Symbols and Punctuation"](r)||Cn.Katakana(r)||Cn["Private Use Area"](r)||Cn["CJK Compatibility Forms"](r)||Cn["Small Form Variants"](r)||Cn["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(l))}function kf(l){return Cn.Arabic(l)||Cn["Arabic Supplement"](l)||Cn["Arabic Extended-A"](l)||Cn["Arabic Presentation Forms-A"](l)||Cn["Arabic Presentation Forms-B"](l)}function ou(l){return l>=1424&&l<=2303||Cn["Arabic Presentation Forms-A"](l)||Cn["Arabic Presentation Forms-B"](l)}function eg(l,r){return!(!r&&ou(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Cn.Khmer(l))}function pd(l){for(const r of l)if(ou(r.charCodeAt(0)))return!0;return!1}const Vo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Rf=null,Qr=Vo.unavailable,El=null;const qp=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Qr=Vo.error),Rf&&Rf(l)};function Of(){md.fire(new Va("pluginStateChange",{pluginStatus:Qr,pluginURL:El}))}const md=new Gc,gd=function(){return Qr},Ta=function(){if(Qr!==Vo.deferred||!El)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qr=Vo.loading,Of(),El&&Zh({url:El},(l=>{l?qp(l):(Qr=Vo.loaded,Of())}))},Ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qr===Vo.loaded||Ai.applyArabicShaping!=null,isLoading:()=>Qr===Vo.loading,setState(l){Qr=l.pluginStatus,El=l.pluginURL},isParsing:()=>Qr===Vo.parsing,isParsed:()=>Qr===Vo.parsed,getPluginURL:()=>El};class wr{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return(function(a,h){for(const f of a)if(!eg(f.charCodeAt(0),h))return!1;return!0})(r,Ai.isLoaded())}}class rs{constructor(r,a,h,f,_){this.property=r,this.value=a,this.expression=(function(y,T,C,k,L){if(Hp(y))return new Sc(y,T);if(ru(y)||Array.isArray(y)&&y.length>0){const j=Mf(y,T,C,k,L);if(j.result==="error")throw new Error(j.value.map((N=>`${N.key}: ${N.message}`)).join(", "));return j.value}{let j=y;return typeof y=="string"&&T.type==="color"&&(j=Ir.parse(y)),{kind:"constant",configDependencies:new Set,evaluate:()=>j}}})(a===void 0?r.specification.default:a,r.specification,h,f,_)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,a,h,f){return this.property.possiblyEvaluate(this,r,a,h,f)}}class _d{constructor(r,a,h,f){this.property=r,this.value=new rs(r,void 0,a,h,f)}transitioned(r,a){return new Ea(this.property,this.value,a,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new Ea(this.property,this.value,null,{},0)}}class yd{constructor(r,a,h,f){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=a,this._options=h,this._iconImageUseTheme=f,this.configDependencies=new Set}getValue(r){return or(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new _d(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new rs(this._values[r].property,a===null?void 0:or(a),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,a){a&&(this._options=a);const h=this._properties.properties;if(r)for(const f in r){const _=r[f];if(f.endsWith("-transition")){const y=f.slice(0,-11);h[y]&&this.setTransition(y,_)}else h.hasOwnProperty(f)&&this.setValue(f,_)}}getTransition(r){return or(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new _d(this._values[r].property)),this._values[r].transition=or(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(r[a]=h);const f=this.getTransition(a);f!==void 0&&(r[`${a}-transition`]=f)}return r}transitioned(r,a){const h=new tg(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(r,a._values[f]);return h}untransitioned(){const r=new tg(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class Ea{constructor(r,a,h,f,_){const y=f.delay||0,T=f.duration||0;_=_||0,this.property=r,this.value=a,this.begin=_+y,this.end=this.begin+T,r.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(r,a,h){const f=r.now||0,_=this.value.possiblyEvaluate(r,a,h),y=this.prior;if(y){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return y.possiblyEvaluate(r,a,h);{const T=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,a,h),_,Se(T))}}return _}}class tg{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,h){const f=new Ec(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(r,a,h);return f}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class ms{constructor(r,a,h,f){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=a,this._options=h,this._iconImageUseTheme=f,this.configDependencies=new Set}getValue(r){return or(this._values[r].value)}setValue(r,a){this._values[r]=new rs(this._values[r].property,a===null?void 0:or(a),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(r[a]=h)}return r}possiblyEvaluate(r,a,h,f){const _=new Ec(this._properties);for(const y of Object.keys(this._values))_._values[y]=this._values[y].possiblyEvaluate(r,a,h,f);return _}}class Tc{constructor(r,a,h,f){this.property=r,this.value=a,this.parameters=h,this.iconImageUseTheme=f}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,a,h,f){return this.property.evaluate(this.value,this.parameters,r,a,h,f,this.iconImageUseTheme)}}class Ec{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class kt{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,h){const f=so[this.specification.type];return f?f(r,a,h):r}}class $t{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,h,f,_){return r.expression.kind==="constant"||r.expression.kind==="camera"?new Tc(this,{kind:"constant",value:r.expression.evaluate(a,null,{},h,f,void 0,_)},a):new Tc(this,r.expression,a,_)}interpolate(r,a,h){if(r.value.kind!=="constant"||a.value.kind!=="constant")return r;if(r.value.value===void 0||a.value.value===void 0)return new Tc(this,{kind:"constant",value:void 0},r.parameters);const f=so[this.specification.type];return f?new Tc(this,{kind:"constant",value:f(r.value.value,a.value.value,h)},r.parameters):r}evaluate(r,a,h,f,_,y,T){return r.kind==="constant"?r.value:r.evaluate(a,h,f,_,y,void 0,T)}}class co{constructor(r){this.specification=r}possiblyEvaluate(r,a,h,f){return!!r.expression.evaluate(a,null,{},h,f)}interpolate(){return!1}}class di{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new wr(0,{});for(const h in r){const f=r[h];f.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new rs(f,void 0),y=this.defaultTransitionablePropertyValues[h]=new _d(f);this.defaultTransitioningPropertyValues[h]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(a)}}}nn($t,"DataDrivenProperty"),nn(kt,"DataConstantProperty"),nn(co,"ColorRampProperty");var He=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function vd(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function au(l){if(Array.isArray(l))return l.map(au);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const a in l)r[a]=au(l[a]);return r}return vd(l)}function Df(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!Df(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function xd(l,r="",a=null,h="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Df(l)||(l=Lf(l));const f=l;let _=!0;try{_=(function(L){if(!sh(L))return L;let j=au(L);return tl(j),j=ng(j),j})(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let y=null,T=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){T=He[`filter_${h}`];const L=el(_,T,r,a);if(L.result==="error")throw new Error(L.value.map((j=>`${j.key}: ${j.message}`)).join(", "));y=(j,N,H)=>L.value.evaluate(j,N,{},H)}let C=null,k=null;if(_!==f){const L=el(f,T,r,a);if(L.result==="error")throw new Error(L.value.map((j=>`${j.key}: ${j.message}`)).join(", "));C=(j,N,H,W,ee)=>L.value.evaluate(j,N,{},H,void 0,void 0,W,ee),k=!Kc(L.value.expression)}return{filter:y,dynamicFilter:C||void 0,needGeometry:bd(_),needFeature:!!k}}function ng(l){if(!Array.isArray(l))return l;const r=(function(a){if(rg.has(a[0])){for(let h=1;h<a.length;h++)if(sh(a[h]))return!0}return a})(l);return r===!0?r:r.map((a=>ng(a)))}function tl(l){let r=!1;const a=[];if(l[0]==="case"){for(let h=1;h<l.length-1;h+=2)r=r||sh(l[h]),a.push(l[h+1]);a.push(l[l.length-1])}else if(l[0]==="match"){r=r||sh(l[1]);for(let h=2;h<l.length-1;h+=2)a.push(l[h+1]);a.push(l[l.length-1])}else if(l[0]==="step"){r=r||sh(l[1]);for(let h=1;h<l.length-1;h+=2)a.push(l[h+1])}r&&(l.length=0,l.push("any",...a));for(let h=1;h<l.length;h++)tl(l[h])}function sh(l){if(!Array.isArray(l))return!1;if((r=l[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let a=1;a<l.length;a++)if(sh(l[a]))return!0;return!1}const rg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function P_(l,r){return l<r?-1:l>r?1:0}function bd(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(bd(l[r]))return!0;return!1}function Lf(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?wd(l[1],l[2],"=="):r==="!="?Sd(wd(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?wd(l[1],l[2],r):r==="any"?(a=l.slice(1),["any"].concat(a.map(Lf))):r==="all"?["all"].concat(l.slice(1).map(Lf)):r==="none"?["all"].concat(l.slice(1).map(Lf).map(Sd)):r==="in"?jf(l[1],l.slice(2)):r==="!in"?Sd(jf(l[1],l.slice(2))):r==="has"?ig(l[1]):r!=="!has"||Sd(ig(l[1]));var a}function wd(l,r,a){switch(l){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,l,r]}}function jf(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((a=>typeof a!=typeof r[0]))?["filter-in-large",l,["literal",r.sort(P_)]]:["filter-in-small",l,["literal",r]]}}function ig(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Sd(l){return["!",l]}const Td="";function oh(l,r){return r?`${l}${Td}${r}`:l}let Zp;const sg=()=>Zp||(Zp=new di({"icon-size":new $t(He.layout_symbol["icon-size"]),"icon-image":new $t(He.layout_symbol["icon-image"]),"icon-rotate":new $t(He.layout_symbol["icon-rotate"]),"icon-offset":new $t(He.layout_symbol["icon-offset"])}));class og{constructor(r,a,h,f,_,y){const T=el(r,He.appearance.condition);if(T.result==="success"&&(this.condition=T.value),this.name=a,h){this.properties=new Ec(sg()),this.unevaluatedLayout=new ms(sg(),f,_,y);for(const C in h)this.unevaluatedLayout.setValue(C,h[C])}}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.properties&&(r.properties=this.properties),r}}const ag="-transition",lg=new Set(["fill","line","background","hillshade","raster"]);class Ws extends Gc{constructor(r,a,h,f,_,y){if(super(),this.id=r.id,this.fqid=oh(this.id,h),this.type=r.type,this.scope=h,this.lut=f,this.options=_,this.iconImageUseTheme=y,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const T=el(this.filter,He[`filter_${r.type}`]);T.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...T.value.configDependencies]))}if(r.slot&&(this.slot=r.slot),r.appearances&&r.appearances.forEach((T=>{this.appearances.push(new og(T.condition,T.name,T.properties,this.scope,_,this.iconImageUseTheme))})),a.layout&&(this._unevaluatedLayout=new ms(a.layout,this.scope,_,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new yd(a.paint,this.scope,_);for(const T in r.paint)this.setPaintProperty(T,r.paint[T]);for(const T in r.layout)this.setLayoutProperty(T,r.layout[T]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ec(a.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&lg.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a){if(this.type==="custom"&&r==="visibility")return void(this.visibility=a);const h=this._unevaluatedLayout;h._properties.properties[r]&&(h.setValue(r,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(ag)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a){const h=this._transitionablePaint,f=h._properties.properties;if(r.endsWith(ag)){const j=r.slice(0,-11);return f[j]&&h.setTransition(j,a||void 0),!1}if(!f[r])return!1;const _=h._values[r],y=_.value.isDataDriven(),T=_.value;h.setValue(r,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const C=h._values[r].value,k=C.isDataDriven(),L=r.endsWith("pattern")||r==="line-dasharray";return k||y||L||this._handleOverridablePaintPropertyUpdate(r,T,C)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,a,h){return null}_handleOverridablePaintPropertyUpdate(r,a,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map((a=>a.serialize()))),gr(r,((a,h)=>!(a===void 0||h==="layout"&&!Object.keys(a).length||h==="paint"&&!Object.keys(a).length)))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof Tc&&Qu(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=xd(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(r){}queryIntersectsFeature(r,a,h,f,_,y,T,C,k){}}const lu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ah{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class oi{constructor(){this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&a.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function vr(l,r=1){let a=0,h=0;return{members:l.map((f=>{const _=lu[f.type].BYTES_PER_ELEMENT,y=a=cg(a,Math.max(r,_)),T=f.components||1;return h=Math.max(h,_),a+=_*T,{name:f.name,type:f.type,components:T,offset:y}})),size:cg(a,Math.max(h,r)),alignment:r}}function cg(l,r){return Math.ceil(l/r)*r}class Ac extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const f=2*r;return this.int16[f+0]=a,this.int16[f+1]=h,r}}Ac.prototype.bytesPerElement=4,nn(Ac,"StructArrayLayout2i4");class cu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=3*r;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=f,r}}cu.prototype.bytesPerElement=6,nn(cu,"StructArrayLayout3i6");class Gl extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const y=4*r;return this.int16[y+0]=a,this.int16[y+1]=h,this.int16[y+2]=f,this.int16[y+3]=_,r}}Gl.prototype.bytesPerElement=8,nn(Gl,"StructArrayLayout4i8");class uu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}uu.prototype.bytesPerElement=4,nn(uu,"StructArrayLayout1f4");class ug extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=4*r,y=2*r;return this.int16[_+0]=a,this.int16[_+1]=h,this.float32[y+1]=f,r}}ug.prototype.bytesPerElement=8,nn(ug,"StructArrayLayout2i1f8");class Xp extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=4*r;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=f,r}}Xp.prototype.bytesPerElement=8,nn(Xp,"StructArrayLayout3i8");class Aa extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,h,f,_)}emplace(r,a,h,f,_,y){const T=5*r;return this.int16[T+0]=a,this.int16[T+1]=h,this.int16[T+2]=f,this.int16[T+3]=_,this.int16[T+4]=y,r}}Aa.prototype.bytesPerElement=10,nn(Aa,"StructArrayLayout5i10");class Ed extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,h,f,_,y,T)}emplace(r,a,h,f,_,y,T,C){const k=6*r,L=12*r,j=3*r;return this.int16[k+0]=a,this.int16[k+1]=h,this.uint8[L+4]=f,this.uint8[L+5]=_,this.uint8[L+6]=y,this.uint8[L+7]=T,this.float32[j+2]=C,r}}Ed.prototype.bytesPerElement=12,nn(Ed,"StructArrayLayout2i4ub1f12");class qs extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=3*r;return this.float32[_+0]=a,this.float32[_+1]=h,this.float32[_+2]=f,r}}qs.prototype.bytesPerElement=12,nn(qs,"StructArrayLayout3f12");class Cc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,h,f,_)}emplace(r,a,h,f,_,y){const T=6*r,C=3*r;return this.uint16[T+0]=a,this.uint16[T+1]=h,this.uint16[T+2]=f,this.uint16[T+3]=_,this.float32[C+2]=y,r}}Cc.prototype.bytesPerElement=12,nn(Cc,"StructArrayLayout4ui1f12");class lh extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const y=4*r;return this.uint16[y+0]=a,this.uint16[y+1]=h,this.uint16[y+2]=f,this.uint16[y+3]=_,r}}lh.prototype.bytesPerElement=8,nn(lh,"StructArrayLayout4ui8");class zf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,h,f,_,y)}emplace(r,a,h,f,_,y,T){const C=6*r;return this.int16[C+0]=a,this.int16[C+1]=h,this.int16[C+2]=f,this.int16[C+3]=_,this.int16[C+4]=y,this.int16[C+5]=T,r}}zf.prototype.bytesPerElement=12,nn(zf,"StructArrayLayout6i12");class Nf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k,L,j,N){const H=this.length;return this.resize(H+1),this.emplace(H,r,a,h,f,_,y,T,C,k,L,j,N)}emplace(r,a,h,f,_,y,T,C,k,L,j,N,H){const W=12*r;return this.int16[W+0]=a,this.int16[W+1]=h,this.int16[W+2]=f,this.int16[W+3]=_,this.uint16[W+4]=y,this.uint16[W+5]=T,this.uint16[W+6]=C,this.uint16[W+7]=k,this.int16[W+8]=L,this.int16[W+9]=j,this.int16[W+10]=N,this.int16[W+11]=H,r}}Nf.prototype.bytesPerElement=24,nn(Nf,"StructArrayLayout4i4ui4i24");class hu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,h,f,_,y)}emplace(r,a,h,f,_,y,T){const C=10*r,k=5*r;return this.int16[C+0]=a,this.int16[C+1]=h,this.int16[C+2]=f,this.float32[k+2]=_,this.float32[k+3]=y,this.float32[k+4]=T,r}}hu.prototype.bytesPerElement=20,nn(hu,"StructArrayLayout3i3f20");class Ca extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const y=4*r;return this.float32[y+0]=a,this.float32[y+1]=h,this.float32[y+2]=f,this.float32[y+3]=_,r}}Ca.prototype.bytesPerElement=16,nn(Ca,"StructArrayLayout4f16");class du extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}du.prototype.bytesPerElement=4,nn(du,"StructArrayLayout1ul4");class is extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const f=2*r;return this.uint16[f+0]=a,this.uint16[f+1]=h,r}}is.prototype.bytesPerElement=4,nn(is,"StructArrayLayout2ui4");class ch extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k,L,j,N,H){const W=this.length;return this.resize(W+1),this.emplace(W,r,a,h,f,_,y,T,C,k,L,j,N,H)}emplace(r,a,h,f,_,y,T,C,k,L,j,N,H,W){const ee=20*r,ie=10*r;return this.int16[ee+0]=a,this.int16[ee+1]=h,this.int16[ee+2]=f,this.int16[ee+3]=_,this.int16[ee+4]=y,this.float32[ie+3]=T,this.float32[ie+4]=C,this.float32[ie+5]=k,this.float32[ie+6]=L,this.int16[ee+14]=j,this.uint32[ie+8]=N,this.uint16[ee+18]=H,this.uint16[ee+19]=W,r}}ch.prototype.bytesPerElement=40,nn(ch,"StructArrayLayout5i4f1i1ul2ui40");class Ff extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,h,f,_,y,T)}emplace(r,a,h,f,_,y,T,C){const k=8*r;return this.int16[k+0]=a,this.int16[k+1]=h,this.int16[k+2]=f,this.int16[k+4]=_,this.int16[k+5]=y,this.int16[k+6]=T,this.int16[k+7]=C,r}}Ff.prototype.bytesPerElement=16,nn(Ff,"StructArrayLayout3i2i2i16");class Yp extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,h,f,_)}emplace(r,a,h,f,_,y){const T=4*r,C=8*r;return this.float32[T+0]=a,this.float32[T+1]=h,this.float32[T+2]=f,this.int16[C+6]=_,this.int16[C+7]=y,r}}Yp.prototype.bytesPerElement=16,nn(Yp,"StructArrayLayout2f1f2i16");class Kp extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,h,f,_,y)}emplace(r,a,h,f,_,y,T){const C=20*r,k=5*r;return this.uint8[C+0]=a,this.uint8[C+1]=h,this.float32[k+1]=f,this.float32[k+2]=_,this.float32[k+3]=y,this.float32[k+4]=T,r}}Kp.prototype.bytesPerElement=20,nn(Kp,"StructArrayLayout2ub4f20");class ss extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,h)}emplace(r,a,h,f){const _=3*r;return this.uint16[_+0]=a,this.uint16[_+1]=h,this.uint16[_+2]=f,r}}ss.prototype.bytesPerElement=6,nn(ss,"StructArrayLayout3ui6");class Bf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe,_e,ke){const Re=this.length;return this.resize(Re+1),this.emplace(Re,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe,_e,ke)}emplace(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe,_e,ke,Re){const Ne=30*r,Fe=15*r,Ue=60*r;return this.int16[Ne+0]=a,this.int16[Ne+1]=h,this.int16[Ne+2]=f,this.float32[Fe+2]=_,this.float32[Fe+3]=y,this.uint16[Ne+8]=T,this.uint16[Ne+9]=C,this.uint32[Fe+5]=k,this.uint32[Fe+6]=L,this.uint32[Fe+7]=j,this.uint16[Ne+16]=N,this.uint16[Ne+17]=H,this.uint16[Ne+18]=W,this.float32[Fe+10]=ee,this.float32[Fe+11]=ie,this.uint8[Ue+48]=se,this.uint8[Ue+49]=fe,this.uint8[Ue+50]=pe,this.uint32[Fe+13]=_e,this.int16[Ne+28]=ke,this.uint8[Ue+58]=Re,r}}Bf.prototype.bytesPerElement=60,nn(Bf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class So extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe,_e,ke,Re,Ne,Fe,Ue,ft,We,mt,Ct,yt,xt,Rt,ht){const bt=this.length;return this.resize(bt+1),this.emplace(bt,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe,_e,ke,Re,Ne,Fe,Ue,ft,We,mt,Ct,yt,xt,Rt,ht)}emplace(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe,_e,ke,Re,Ne,Fe,Ue,ft,We,mt,Ct,yt,xt,Rt,ht,bt){const st=20*r,nt=40*r,Ot=80*r;return this.float32[st+0]=a,this.float32[st+1]=h,this.int16[nt+4]=f,this.int16[nt+5]=_,this.int16[nt+6]=y,this.int16[nt+7]=T,this.int16[nt+8]=C,this.int16[nt+9]=k,this.int16[nt+10]=L,this.int16[nt+11]=j,this.int16[nt+12]=N,this.uint16[nt+13]=H,this.uint16[nt+14]=W,this.uint16[nt+15]=ee,this.uint16[nt+16]=ie,this.uint16[nt+17]=se,this.uint16[nt+18]=fe,this.uint16[nt+19]=pe,this.uint16[nt+20]=_e,this.uint16[nt+21]=ke,this.uint16[nt+22]=Re,this.uint16[nt+23]=Ne,this.uint16[nt+24]=Fe,this.uint16[nt+25]=Ue,this.uint16[nt+26]=ft,this.uint16[nt+27]=We,this.uint32[st+14]=mt,this.float32[st+15]=Ct,this.float32[st+16]=yt,this.float32[st+17]=xt,this.float32[st+18]=Rt,this.uint8[Ot+76]=ht,this.uint16[nt+39]=bt,r}}So.prototype.bytesPerElement=80,nn(So,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Fs extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,h,f,_,y)}emplace(r,a,h,f,_,y,T){const C=6*r;return this.float32[C+0]=a,this.float32[C+1]=h,this.float32[C+2]=f,this.float32[C+3]=_,this.float32[C+4]=y,this.float32[C+5]=T,r}}Fs.prototype.bytesPerElement=24,nn(Fs,"StructArrayLayout6f24");class fu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,h,f,_)}emplace(r,a,h,f,_,y){const T=5*r;return this.float32[T+0]=a,this.float32[T+1]=h,this.float32[T+2]=f,this.float32[T+3]=_,this.float32[T+4]=y,r}}fu.prototype.bytesPerElement=20,nn(fu,"StructArrayLayout5f20");class Jp extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,h,f,_,y,T)}emplace(r,a,h,f,_,y,T,C){const k=7*r;return this.float32[k+0]=a,this.float32[k+1]=h,this.float32[k+2]=f,this.float32[k+3]=_,this.float32[k+4]=y,this.float32[k+5]=T,this.float32[k+6]=C,r}}Jp.prototype.bytesPerElement=28,nn(Jp,"StructArrayLayout7f28");class Uf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k,L,j){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,h,f,_,y,T,C,k,L,j)}emplace(r,a,h,f,_,y,T,C,k,L,j,N){const H=11*r;return this.float32[H+0]=a,this.float32[H+1]=h,this.float32[H+2]=f,this.float32[H+3]=_,this.float32[H+4]=y,this.float32[H+5]=T,this.float32[H+6]=C,this.float32[H+7]=k,this.float32[H+8]=L,this.float32[H+9]=j,this.float32[H+10]=N,r}}Uf.prototype.bytesPerElement=44,nn(Uf,"StructArrayLayout11f44");class Ad extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k){const L=this.length;return this.resize(L+1),this.emplace(L,r,a,h,f,_,y,T,C,k)}emplace(r,a,h,f,_,y,T,C,k,L){const j=9*r;return this.float32[j+0]=a,this.float32[j+1]=h,this.float32[j+2]=f,this.float32[j+3]=_,this.float32[j+4]=y,this.float32[j+5]=T,this.float32[j+6]=C,this.float32[j+7]=k,this.float32[j+8]=L,r}}Ad.prototype.bytesPerElement=36,nn(Ad,"StructArrayLayout9f36");class uh extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const f=2*r;return this.float32[f+0]=a,this.float32[f+1]=h,r}}uh.prototype.bytesPerElement=8,nn(uh,"StructArrayLayout2f8");class Cd extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,h,f)}emplace(r,a,h,f,_){const y=6*r;return this.uint32[3*r+0]=a,this.uint16[y+2]=h,this.uint16[y+3]=f,this.uint16[y+4]=_,r}}Cd.prototype.bytesPerElement=12,nn(Cd,"StructArrayLayout1ul3ui12");class Vf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}Vf.prototype.bytesPerElement=2,nn(Vf,"StructArrayLayout1ui2");class $f extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie){const se=this.length;return this.resize(se+1),this.emplace(se,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie)}emplace(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se){const fe=16*r;return this.float32[fe+0]=a,this.float32[fe+1]=h,this.float32[fe+2]=f,this.float32[fe+3]=_,this.float32[fe+4]=y,this.float32[fe+5]=T,this.float32[fe+6]=C,this.float32[fe+7]=k,this.float32[fe+8]=L,this.float32[fe+9]=j,this.float32[fe+10]=N,this.float32[fe+11]=H,this.float32[fe+12]=W,this.float32[fe+13]=ee,this.float32[fe+14]=ie,this.float32[fe+15]=se,r}}$f.prototype.bytesPerElement=64,nn($f,"StructArrayLayout16f64");class hh extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,f,_,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,h,f,_,y,T)}emplace(r,a,h,f,_,y,T,C){const k=10*r,L=5*r;return this.uint16[k+0]=a,this.uint16[k+1]=h,this.uint16[k+2]=f,this.uint16[k+3]=_,this.float32[L+2]=y,this.float32[L+3]=T,this.float32[L+4]=C,r}}hh.prototype.bytesPerElement=20,nn(hh,"StructArrayLayout4ui3f20");class dh extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.int16[1*r+0]=a,r}}dh.prototype.bytesPerElement=2,nn(dh,"StructArrayLayout1i2");class Pd extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint8[1*r+0]=a,r}}Pd.prototype.bytesPerElement=1,nn(Pd,"StructArrayLayout1ub1");class Qp extends ah{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qp.prototype.size=40;class em extends ch{get(r){return new Qp(this,r)}}nn(em,"CollisionBoxArray");class tm extends ah{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}tm.prototype.size=60;class fh extends Bf{get(r){return new tm(this,r)}}nn(fh,"PlacedSymbolArray");class I_ extends ah{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}I_.prototype.size=80;class hg extends So{get(r){return new I_(this,r)}}nn(hg,"SymbolInstanceArray");class nm extends uu{getoffsetX(r){return this.float32[1*r+0]}}nn(nm,"GlyphOffsetArray");class dg extends Ac{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}nn(dg,"SymbolLineVertexArray");class Id extends ah{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Id.prototype.size=12;class Wl extends Cd{get(r){return new Id(this,r)}}nn(Wl,"FeatureIndexArray");class M_ extends is{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}nn(M_,"FillExtrusionCentroidArray");class fg extends ah{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}fg.prototype.size=6;class rm extends cu{get(r){return new fg(this,r)}}nn(rm,"FillExtrusionWallArray");const k_=vr([{name:"a_pos",components:2,type:"Int16"}],4),R_=vr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Hf=vr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rr{constructor(r=[]){this.segments=r}_prepareSegment(r,a,h,f){let _=this.segments[this.segments.length-1];return r>Rr.MAX_VERTEX_ARRAY_LENGTH&&_r(`Max vertices per segment is ${Rr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!_||_.vertexLength+r>Rr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:a,primitiveOffset:h,vertexLength:0,primitiveLength:0},f!==void 0&&(_.sortKey=f),this.segments.push(_)),_}prepareSegment(r,a,h,f){return this._prepareSegment(r,a.length,h.length,f)}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,h,f){return new Rr([{vertexOffset:r,primitiveOffset:a,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}function Gf(l,r){return 256*(l=Oe(Math.floor(l),0,255))+Oe(Math.floor(r),0,255)}Rr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nn(Rr,"SegmentVector");const Wy=vr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),im=vr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Bs=vr([{name:"a_dash",components:4,type:"Uint16"}]);class Wf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,a,h,f){this.ids.push(er(r)),this.positions.push(a,h,f)}eachPosition(r,a){const h=er(r);let f=0,_=this.ids.length-1;for(;f<_;){const y=f+_>>1;this.ids[y]>=h?_=y:f=y+1}for(;this.ids[f]===h;)a(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(r,a){const h=new Float64Array(r.ids),f=new Uint32Array(r.positions);return pu(h,f,0,h.length-1),a&&(a.add(h.buffer),a.add(f.buffer)),{ids:h,positions:f}}static deserialize(r){const a=new Wf;let h;a.ids=r.ids,a.positions=r.positions;for(const f of a.ids)f!==h&&a.uniqueIds.push(f),h=f;return a.indexed=!0,a}}function er(l){const r=+l;return Number.isSafeInteger(r)?r:Xh(String(l))}function pu(l,r,a,h){for(;a<h;){const f=l[a+h>>1];let _=a-1,y=h+1;for(;;){do _++;while(l[_]<f);do y--;while(l[y]>f);if(_>=y)break;ph(l,_,y),ph(r,3*_,3*y),ph(r,3*_+1,3*y+1),ph(r,3*_+2,3*y+2)}y-a<h-y?(pu(l,r,a,y),a=y+1):(pu(l,r,y+1,h),h=y)}}function ph(l,r,a){const h=l[r];l[r]=l[a],l[a]=h}nn(Wf,"FeaturePositionMap");class Al{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,a),this.initialized=!0),!!this.location}set(r,a,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class qf extends Al{constructor(r){super(r),this.current=0}set(r,a,h){this.fetchUniformLocation(r,a)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class ki extends Al{constructor(r){super(r),this.current=0}set(r,a,h){this.fetchUniformLocation(r,a)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Pa extends Al{constructor(r){super(r),this.current=[0,0]}set(r,a,h){this.fetchUniformLocation(r,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class mh extends Al{constructor(r){super(r),this.current=[0,0,0]}set(r,a,h){this.fetchUniformLocation(r,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Md extends Al{constructor(r){super(r),this.current=[0,0,0,0]}set(r,a,h){this.fetchUniformLocation(r,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class pg extends Al{constructor(r){super(r),this.current=Ir.transparent.toPremultipliedRenderColor(null)}set(r,a,h){this.fetchUniformLocation(r,a)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const O_=new Float32Array(16);class gh extends Al{constructor(r){super(r),this.current=O_}set(r,a,h){if(this.fetchUniformLocation(r,a)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let f=1;f<16;f++)if(h[f]!==this.current[f]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const mg=new Float32Array(9),uo=new Float32Array(4);class ra extends Al{constructor(r){super(r),this.current=uo}set(r,a,h){if(this.fetchUniformLocation(r,a)){for(let f=0;f<4;f++)if(h[f]!==this.current[f]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function nl(l){return[Gf(255*l.r,255*l.g),Gf(255*l.b,255*l.a)]}class ia{constructor(r,a,h,f){this.value=r,this.uniformNames=a.map((_=>`u_${_}`)),this.type=h,this.context=f}setUniform(r,a,h,f,_){const y=f.constantOr(this.value);a.set(r,_,y instanceof Ir?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(r,a){return this.type==="color"?new pg(r):new ki(r)}}class mu{constructor(r,a){this.uniformNames=a.map((h=>`u_${h}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,a){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(r,a,h,f,_){let y=null;_!=="u_pattern"&&_!=="u_dash"||(y=this.pattern),_==="u_pattern_b"&&(y=this.patternTransition),_==="u_pixel_ratio"&&(y=this.pixelRatio),y&&a.set(r,_,y)}getBinding(r,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new Md(r):new ki(r)}}class Zs{constructor(r,a,h,f){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map((_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0}))),this.paintVertexArray=new f}populatePaintArray(r,a,h,f,_,y,T,C){const k=this.paintVertexArray.length,L=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new wr(0,{brightness:y,worldview:C}),a,{},_,f,T):this.expression.kind==="constant"&&this.expression.value,j=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new wr(0,{brightness:y,worldview:C}),a,{},_,f,T):this.lutExpression.value)==="none";this.paintVertexArray.resize(r),this._setPaintValue(k,r,L,j?null:this.context.lut)}updatePaintArray(r,a,h,f,_,y,T,C){const k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T,worldview:C},h,f,void 0,_):this.expression.kind==="constant"&&this.expression.value,L=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new wr(0,{brightness:T,worldview:C}),h,f,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(r,a,k,L?null:this.context.lut)}_setPaintValue(r,a,h,f){if(this.type==="color"){const _=nl(h.toPremultipliedRenderColor(f));for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,_[0],_[1])}else{for(let _=r;_<a;_++)this.paintVertexArray.emplace(_,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ql{constructor(r,a,h,f,_,y){this.expression=r,this.uniformNames=a.map((T=>`u_${T}_t`)),this.type=h,this.useIntegerZoom=f,this.context=_,this.maxValue=0,this.paintVertexAttributes=a.map((T=>({name:`a_${T}`,type:"Float32",components:h==="color"?4:2,offset:0}))),this.paintVertexArray=new y}populatePaintArray(r,a,h,f,_,y,T,C){const k=this.expression.evaluate(new wr(this.context.zoom,{brightness:y,worldview:C}),a,{},_,f,T),L=this.expression.evaluate(new wr(this.context.zoom+1,{brightness:y,worldview:C}),a,{},_,f,T),j=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new wr(0,{brightness:y,worldview:C}),a,{},_,f,T):this.lutExpression.value)==="none",N=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(N,r,k,L,j?null:this.context.lut)}updatePaintArray(r,a,h,f,_,y,T,C){const k=this.expression.evaluate({zoom:this.context.zoom,brightness:T,worldview:C},h,f,void 0,_),L=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T,worldview:C},h,f,void 0,_),j=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new wr(0,{brightness:T,worldview:C}),h,f,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(r,a,k,L,j?null:this.context.lut)}_setPaintValue(r,a,h,f,_){if(this.type==="color"){const y=nl(h.toPremultipliedRenderColor(_)),T=nl(h.toPremultipliedRenderColor(_));for(let C=r;C<a;C++)this.paintVertexArray.emplace(C,y[0],y[1],T[0],T[1])}else{for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a,h,f,_){const y=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,T=Oe(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(r,_,T)}getBinding(r,a){return new ki(r)}}class Xs{constructor(r,a,h,f,_){this.expression=r,this.layerId=_,this.paintVertexAttributes=(h==="array"?Bs:Wy).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new f,this.paintTransitionVertexArray=new lh}populatePaintArray(r,a,h,f){const _=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(_,r,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(r,a,h,f,_,y,T){this._setPaintValues(r,a,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(r,a,h,f){if(!f||!h)return;const _=f[h[0]],y=f[h[1]];if(_){if(_){const{tl:T,br:C,pixelRatio:k}=_;for(let L=r;L<a;L++)this.paintVertexArray.emplace(L,T[0],T[1],C[0],C[1],k)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:T,br:C}=y;for(let k=r;k<a;k++)this.paintTransitionVertexArray.emplace(k,T[0],T[1],C[0],C[1])}}}upload(r){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,im.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class _h{constructor(r,a,h=(()=>!0)){this.binders={},this._buffers=[],this.context=a;const f=[];for(const _ in r.paint._values){const y=r.paint.get(_);if(_.endsWith("-use-theme")||!h(_)||!(y instanceof Tc&&Qu(y.property.specification)))continue;const T=qy(_,r.type),C=y.value,k=y.property.specification.type,L=!!y.property.useIntegerZoom,j=_==="line-dasharray"||_.endsWith("pattern"),N=r.paint.get(`${_}-use-theme`),H=_==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(C.kind!=="constant"||H)if(C.kind==="source"||H||j){const W=c(_,k,"source");this.binders[_]=j?new Xs(C,T,k,W,r.id):new Zs(C,T,k,W),f.push(`/a_${_}`)}else{const W=c(_,k,"composite");this.binders[_]=new ql(C,T,k,L,a,W),f.push(`/z_${_}`)}else this.binders[_]=j?new mu(C.value,T):new ia(C.value,T,k,a),f.push(`/u_${_}`);N&&(this.binders[_].lutExpression=N.value)}this.cacheKey=f.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Zs||a instanceof ql?a.maxValue:0}populatePaintArrays(r,a,h,f,_,y,T,C){for(const k in this.binders){const L=this.binders[k];L.context=this.context,(L instanceof Zs||L instanceof ql||L instanceof Xs)&&L.populatePaintArray(r,a,h,f,_,y,T,C)}}setConstantPatternPositions(r,a){for(const h in this.binders){const f=this.binders[h];f instanceof mu&&f.setConstantPatternPositions(r,a)}}getPatternTransitionVertexBuffer(r){const a=this.binders[r];return a instanceof Xs?a.paintTransitionVertexBuffer:null}updatePaintArrays(r,a,h,f,_,y,T,C,k,L){let j=!1;const N=Object.keys(r),H=N.length!==0&&!C,W=H?N:a.uniqueIds;this.context.lut=_.lut;for(const ee in this.binders){const ie=this.binders[ee];if(ie.context=this.context,(ie instanceof Zs||ie instanceof ql||ie instanceof Xs)&&ie.expression&&ie.expression.kind&&ie.expression.kind!=="constant"&&(ie.expression.isStateDependent===!0||ie.expression.isLightConstant===!1)){const se=_.paint.get(ee);ie.expression=se.value;for(const fe of W){const pe=r[fe.toString()];a.eachPosition(fe,((_e,ke,Re)=>{const Ne=f.feature(_e);ie.updatePaintArray(ke,Re,Ne,pe,y,T,k,L)}))}if(!H)for(const fe of h.uniqueIds){const pe=r[fe.toString()];h.eachPosition(fe,((_e,ke,Re)=>{const Ne=f.feature(_e);ie.updatePaintArray(ke,Re,Ne,pe,y,T,k,L)}))}j=!0}}return j}defines(){const r=[];for(const a in this.binders){const h=this.binders[a];(h instanceof ia||h instanceof mu)&&r.push(...h.uniformNames.map((f=>`#define HAS_UNIFORM_${f}`)))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const a=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof ia||f instanceof mu||f instanceof ql)for(const _ of f.uniformNames)a.push({name:_,property:h,binding:f.getBinding(r,_)})}return a}setUniforms(r,a,h,f,_){for(const{name:y,property:T,binding:C}of h)this.binders[T].setUniform(r,C,_,f.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Zs||a instanceof ql||a instanceof Xs)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof Xs&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(r){for(const a in this.binders){const h=this.binders[a];(h instanceof Zs||h instanceof ql||h instanceof Xs)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Zs||a instanceof ql||a instanceof Xs)&&a.destroy()}}}class rl{constructor(r,a,h=(()=>!0)){this.programConfigurations={};for(const f of r)this.programConfigurations[f.id]=new _h(f,a,h);this.needsUpload=!1,this._featureMap=new Wf,this._featureMapWithoutIds=new Wf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,a,h,f,_,y,T,C,k){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(r,a,f,_,y,T,C,k);a.id!==void 0?this._featureMap.add(a.id,h,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,h,f,_,y,T,C){for(const k of h)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,a,k,f,_,y,T||0,C)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const gg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function qy(l,r){return gg[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}const m={"line-pattern":{source:Cc,composite:Cc},"fill-pattern":{source:Cc,composite:Cc},"fill-extrusion-pattern":{source:Cc,composite:Cc},"line-dasharray":{source:lh,composite:lh}},s={color:{source:uh,composite:Ca},number:{source:uu,composite:uh}};function c(l,r,a){const h=m[l];return h&&h[a]||s[r][a]}nn(ia,"ConstantBinder"),nn(mu,"PatternConstantBinder"),nn(Zs,"SourceExpressionBinder"),nn(Xs,"PatternCompositeBinder"),nn(ql,"CompositeExpressionBinder"),nn(_h,"ProgramConfiguration",{omit:["_buffers"]}),nn(rl,"ProgramConfigurationSet");const p=Ft/Math.PI/2,x=5,w=6,A=16383,M=64,O=[M,32,16],z=-p,B=p;function G(l,r,a,h=p){return a=$e(a),[l*Math.sin(a)*h,-r*h,l*Math.cos(a)*h]}function V(l,r,a){return G(Math.cos($e(l)),Math.sin($e(l)),r,a)}const Y=63710088e-1,J=2*Math.PI*Y;class Q{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Q(Ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,h=this.lat*a,f=r.lat*a,_=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((r.lng-this.lng)*a);return Y*Math.acos(Math.min(_,1))}toBounds(r=0){const a=360*r/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new ce({lng:this.lng-h,lat:this.lat-a},{lng:this.lng+h,lat:this.lat+a})}toEcef(r){return V(this.lat,this.lng,p+r*p/Y)}static convert(r){if(r instanceof Q)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Q(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Q(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ce{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Q?new Q(r.lng,r.lat):Q.convert(r),this}setSouthWest(r){return this._sw=r instanceof Q?new Q(r.lng,r.lat):Q.convert(r),this}extend(r){const a=this._sw,h=this._ne;let f,_;if(r instanceof Q)f=r,_=r;else{if(!(r instanceof ce))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(ce.convert(r)):this.extend(Q.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Q.convert(r)):this;if(f=r._sw,_=r._ne,!f||!_)return this}return a||h?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new Q(f.lng,f.lat),this._ne=new Q(_.lng,_.lat)),this}getCenter(){return new Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Q(this.getWest(),this.getNorth())}getSouthEast(){return new Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:h}=Q.convert(r);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(r){if(r)return r instanceof ce?r:new ce(r)}}const ne=0,he=25.5;function me(l){return J*Math.cos(l*Math.PI/180)}function ve(l){return(180+l)/360}function Pe(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Ae(l,r){return l/me(r)}function Ie(l){return 360*l-180}function Ce(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Te(l,r){return l*me(Ce(r))}const Me=85.051129;function Ke(l){return Math.cos($e(Oe(l,-Me,Me)))}function Be(l,r){const a=Oe(r,ne,he),h=Math.pow(2,a);return Ke(l)*J/(512*h)}function at(l){return 1/Math.cos(l*Math.PI/180)}function Xe(l,r=0){const a=Math.exp(Math.PI*(1-(l.y+r/Ft)/(1<<l.z)*2));return 80150034*a/(a*a+1)/Ft/(1<<l.z)}class Qe{constructor(r,a,h=0){this.x=+r,this.y=+a,this.z=+h}static fromLngLat(r,a=0){const h=Q.convert(r);return new Qe(ve(h.lng),Pe(h.lat),Ae(a,h.lat))}toLngLat(){return new Q(Ie(this.x),Ce(this.y))}toAltitude(){return Te(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/J*at(Ce(this.y))}}function At(l,r,a,h,f,_,y,T,C){const k=(r+h)/2,L=(a+f)/2,j=new It(k,L);T(j),(function(N,H,W,ee,ie,se){const fe=W-ie,pe=ee-se;return Math.abs((ee-H)*fe-(W-N)*pe)/Math.hypot(fe,pe)})(j.x,j.y,_.x,_.y,y.x,y.y)>=C?(At(l,r,a,k,L,_,j,T,C),At(l,k,L,h,f,j,y,T,C)):l.push(y)}function Ye(l,r,a){let h=l[0],f=h.x,_=h.y;r(h);const y=[h];for(let T=1;T<l.length;T++){const C=l[T],{x:k,y:L}=C;r(C),At(y,f,_,k,L,h,C,r,a),f=k,_=L,h=C}return y}function je(l,r,a,h){if(h(r,a)){const f=r.add(a)._mult(.5);je(l,r,f,h),je(l,f,a,h)}else l.push(a)}function ut(l,r){let a=l[0];const h=[a];for(let f=1;f<l.length;f++){const _=l[f];je(h,a,_,r),a=_}return h}const tt=Math.pow(2,14)-1,vt=-tt-1;function Dt(l,r){const a=Math.round(l.x*r),h=Math.round(l.y*r);return l.x=Oe(a,vt,tt),l.y=Oe(h,vt,tt),(a<l.x||a>l.x+1||h<l.y||h>l.y+1)&&_r("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Gt(l,r,a){const h=l.loadGeometry(),f=l.extent,_=Ft/f;if(r&&a&&a.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:T,x:C,y:k,projection:L}=a,j=N=>{const H=Ie((r.x+N.x/f)/y),W=Ce((r.y+N.y/f)/y),ee=L.project(H,W);N.x=(ee.x*T-C)*f,N.y=(ee.y*T-k)*f};for(let N=0;N<h.length;N++)if(l.type!==1)h[N]=Ye(h[N],j,1);else{const H=[];for(const W of h[N])W.x<0||W.x>=f||W.y<0||W.y>=f||(j(W),H.push(W));h[N]=H}}for(const y of h)for(const T of y)Dt(T,_);return h}function Pt(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?Gt(l):[]}}class wt{constructor(r,a,h,f,_){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=f,this._values=_,r.readFields(dn,this,a)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos,h=[];let f,_=1,y=0,T=0,C=0;for(;r.pos<a;){if(y<=0){const k=r.readVarint();_=7&k,y=k>>3}if(y--,_===1||_===2)T+=r.readSVarint(),C+=r.readSVarint(),_===1&&(f&&h.push(f),f=[]),f&&f.push(new It(T,C));else{if(_!==7)throw new Error(`unknown command ${_}`);f&&f.push(f[0].clone())}}return f&&h.push(f),h}bbox(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos;let h=1,f=0,_=0,y=0,T=1/0,C=-1/0,k=1/0,L=-1/0;for(;r.pos<a;){if(f<=0){const j=r.readVarint();h=7&j,f=j>>3}if(f--,h===1||h===2)_+=r.readSVarint(),y+=r.readSVarint(),_<T&&(T=_),_>C&&(C=_),y<k&&(k=y),y>L&&(L=y);else if(h!==7)throw new Error(`unknown command ${h}`)}return[T,k,C,L]}toGeoJSON(r,a,h){const f=this.extent*Math.pow(2,h),_=this.extent*r,y=this.extent*a,T=this.loadGeometry();function C(N){return[360*(N.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+y)/f)*Math.PI))-90]}function k(N){return N.map(C)}let L;if(this.type===1){const N=[];for(const W of T)N.push(W[0]);const H=k(N);L=N.length===1?{type:"Point",coordinates:H[0]}:{type:"MultiPoint",coordinates:H}}else if(this.type===2){const N=T.map(k);L=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=(function(W){const ee=W.length;if(ee<=1)return[W];const ie=[];let se,fe;for(let pe=0;pe<ee;pe++){const _e=cn(W[pe]);_e!==0&&(fe===void 0&&(fe=_e<0),fe===_e<0?(se&&ie.push(se),se=[W[pe]]):se&&se.push(W[pe]))}return se&&ie.push(se),ie})(T),H=[];for(const W of N)H.push(W.map(k));L=H.length===1?{type:"Polygon",coordinates:H[0]}:{type:"MultiPolygon",coordinates:H}}}const j={type:"Feature",geometry:L,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function dn(l,r,a){l===1?r.id=a.readVarint():l===2?(function(h,f){const _=h.readVarint()+h.pos;for(;h.pos<_;){const y=f._keys[h.readVarint()],T=f._values[h.readVarint()];f.properties[y]=T}})(a,r):l===3?r.type=a.readVarint():l===4&&(r._geometry=a.pos)}function cn(l){let r=0;for(let a,h,f=0,_=l.length,y=_-1;f<_;y=f++)a=l[f],h=l[y],r+=(h.x-a.x)*(a.y+h.y);return r}wt.types=["Unknown","Point","LineString","Polygon"];class ln{constructor(r,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(un,this,a),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const a=this._pbf.readVarint()+this._pbf.pos;return new wt(this._pbf,a,this.extent,this._keys,this._values)}}function un(l,r,a){l===15?r.version=a.readVarint():l===1?r.name=a.readString():l===5?r.extent=a.readVarint():l===2?r._features.push(a.pos):l===3?r._keys.push(a.readString()):l===4&&r._values.push((function(h){let f=null;const _=h.readVarint()+h.pos;for(;h.pos<_;){const y=h.readVarint()>>3;f=y===1?h.readString():y===2?h.readFloat():y===3?h.readDouble():y===4?h.readVarint64():y===5?h.readVarint():y===6?h.readSVarint():y===7?h.readBoolean():null}if(f==null)throw new Error("unknown feature value");return f})(a))}class jn{constructor(r,a){this.layers=r.readFields(Un,{},a)}}function Un(l,r,a){if(l===3){const h=new ln(a,a.readVarint()+a.pos);h.length&&(r[h.name]=h)}}const Wn="3d_elevation_id",Fr="level";class Bn{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,a){return this._valid&&r(a(this._geometry)),this}require(r,a,h){return this.get(r,!0,a,h)}optional(r,a,h){return this.get(r,!1,a,h)}success(){return this._valid}get(r,a,h,f){const _=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?h(f?f(_):_):a&&(this._valid=!1),this}}class Ar{constructor(r,a){this.featureFunc=r,this.vertexFunc=a}parseFeature(r,a,h){return this.featureFunc(r,a,h)}parseVertex(r,a,h){return this.vertexFunc(r,a,h)}}const Lr=new Ar(((l,r,a)=>l.reset(r).require(Wn,(h=>{a.id=h})).optional("fixed_height_relative",(h=>{a.constantHeight=h}),Xn.decodeRelativeHeight).geometry((h=>{a.bounds=h}),kp).success()),((l,r,a)=>l.reset(r).require(Wn,(h=>{a.id=h})).require("elevation_idx",(h=>{a.idx=h})).require("extent",(h=>{a.extent=h})).require("height_relative",(h=>{a.height=h}),Xn.decodeRelativeHeight).geometry((h=>{a.position=h}),Xn.getPoint).success())),Hr=new Ar(((l,r,a)=>l.reset(r).require(Wn,(h=>{a.id=h})).optional("fixed_height",(h=>{a.constantHeight=h}),Xn.decodeMetricHeight).geometry((h=>{a.bounds=h}),kp).success()),((l,r,a)=>l.reset(r).require(Wn,(h=>{a.id=h})).require("elevation_idx",(h=>{a.idx=h})).require("extent",(h=>{a.extent=h})).require("height",(h=>{a.height=h}),Xn.decodeMetricHeight).geometry((h=>{a.position=h}),Xn.getPoint).success()));class Xn{static getPoint(r){return pl(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?Hr:void 0:Lr}static parse(r){const a=[],h=[],f=r.length,_=new Bn;for(let y=0;y<f;y++){const T=r.feature(y),C=T.properties.version,k=Xn.getVersionSchema(C);if(k===void 0){_r(`Unknown elevation feature version number ${C||"(unknown)"}`);continue}const L=T.properties.type;if(!L)continue;const j=wt.types[T.type];if(j==="Point"&&L==="curve_point"){const N={};k.parseVertex(_,T,N)&&a.push(N)}else if(j==="Polygon"&&L==="curve_meta"){const N={};k.parseFeature(_,T,N)&&h.push(N)}}return{vertices:a,features:h}}}class Sr{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,h){const f=hs(a,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1])/f;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,!0}}class Mr{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,h){const f=Bt(a,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/f;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(r,a,h){if((function(H,W){var ee=H[0],ie=H[1],se=H[2],fe=W[0],pe=W[1],_e=W[2];return Math.abs(ee-fe)<=E*Math.max(1,Math.abs(ee),Math.abs(fe))&&Math.abs(ie-pe)<=E*Math.max(1,Math.abs(ie),Math.abs(pe))&&Math.abs(se-_e)<=E*Math.max(1,Math.abs(se),Math.abs(_e))})(this.pos,r)||a===0)return h[0]=h[1]=h[2]=0,!1;const[f,_,y]=this.dir,T=this.pos[0]-r[0],C=this.pos[1]-r[1],k=this.pos[2]-r[2],L=f*f+_*_+y*y,j=2*(T*f+C*_+k*y),N=j*j-4*L*(T*T+C*C+k*k-a*a);if(N<0){const H=Math.max(-j/2,0),W=T+f*H,ee=C+_*H,ie=k+y*H,se=Math.hypot(W,ee,ie);return h[0]=W*a/se,h[1]=ee*a/se,h[2]=ie*a/se,!1}{const H=(-j-Math.sqrt(N))/(2*L);if(H<0){const W=Math.hypot(T,C,k);return h[0]=T*a/W,h[1]=C*a/W,h[2]=k*a/W,!1}return h[0]=T+f*H,h[1]=C+_*H,h[2]=k+y*H,!0}}}class tr{constructor(r,a,h,f,_){this.TL=r,this.TR=a,this.BR=h,this.BL=f,this.horizon=_}static fromInvProjectionMatrix(r,a,h){const f=[-1,1,1],_=[1,1,1],y=[1,-1,1],T=[-1,-1,1],C=wn(f,f,r),k=wn(_,_,r),L=wn(y,y,r),j=wn(T,T,r);return new tr(C,k,L,j,a/h)}}function fi(l,r,a){let h=1/0,f=-1/0;const _=[];for(const y of l){nr(_,y,r);const T=Bt(_,a);h=Math.min(h,T),f=Math.max(f,T)}return[h,f]}function Di(l,r){let a=!0;for(let h=0;h<l.planes.length;h++){const f=l.planes[h];let _=0;for(let y=0;y<r.length;y++)_+=+(Bt(f,r[y])+f[3]>=0);if(_===0)return 0;_!==r.length&&(a=!1)}return a?2:1}function gs(l,r){for(const a of l.projections){const h=fi(r,l.points[0],a.axis);if(a.projection[1]<h[0]||a.projection[0]>h[1])return 0}return 1}function pi(l,r){let a=0;const h=[0,0,0,0];for(let y=0;y<l.length;y++)h[0]=l[y][0],h[1]=l[y][1],h[2]=l[y][2],h[3]=1,(f=h)[0]*(_=r)[0]+f[1]*_[1]+f[2]*_[2]+f[3]*_[3]>=0&&a++;var f,_;return a}class Yn{constructor(r,a){this.points=r||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Mn.fromPoints(this.points),this.projections=[],this.frustumEdges=[nr([],this.points[2],this.points[3]),nr([],this.points[0],this.points[3]),nr([],this.points[4],this.points[0]),nr([],this.points[5],this.points[1]),nr([],this.points[6],this.points[2]),nr([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const f=[0,-h[2],h[1]],_=[h[2],0,-h[0]];this.projections.push({axis:f,projection:fi(this.points,this.points[0],f)}),this.projections.push({axis:_,projection:fi(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(r,a,h,f){const _=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((k=>{const L=us([],k,r),j=1/L[3]/a*_;return(N=L)[0]=(H=L)[0]*(W=[j,j,f?1/L[3]:j,j])[0],N[1]=H[1]*W[1],N[2]=H[2]*W[2],N[3]=H[3]*W[3],N;var N,H,W})),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((k=>{const L=kn([],En([],nr([],y[k[0]],y[k[1]]),nr([],y[k[2]],y[k[1]]))),j=-Bt(L,y[k[1]]);return L.concat(j)})),C=[];for(let k=0;k<y.length;k++)C.push([y[k][0],y[k][1],y[k][2]]);return new Yn(C,T)}intersectsPrecise(r,a,h){for(let f=0;f<a.length;f++)if(!pi(r,a[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!pi(r,this.planes[f]))return 0;for(const f of h)for(const _ of this.frustumEdges){const y=En([],f,_),T=en(y);if(T===0)continue;et(y,y,1/T);const C=fi(this.points,this.points[0],y),k=fi(r,this.points[0],y);if(C[0]>k[1]||k[0]>C[1])return 0}return 1}containsPoint(r){for(const a of this.planes){const h=a[3];if(Bt([a[0],a[1],a[2]],r)+h<0)return!1}return!0}}class Mn{static fromPoints(r){const a=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const f of r)hn(a,a,f),Xt(h,h,f);return new Mn(a,h)}static fromTileIdAndHeight(r,a,h){const f=1<<r.canonical.z,_=r.canonical.x,y=r.canonical.y;return new Mn([_/f,y/f,a],[(_+1)/f,(y+1)/f,h])}static applyTransform(r,a){const h=r.getCorners();for(let f=0;f<h.length;++f)wn(h[f],h[f],a);return Mn.fromPoints(h)}static applyTransformFast(r,a){const h=[a[12],a[13],a[14]],f=[...h];for(let _=0;_<3;_++)for(let y=0;y<3;y++){const T=a[4*y+_],C=T*r.min[y],k=T*r.max[y];h[_]+=Math.min(C,k),f[_]+=Math.max(C,k)}return new Mn(h,f)}static projectAabbCorners(r,a){const h=r.getCorners();for(let f=0;f<h.length;++f)wn(h[f],h[f],a);return h}constructor(r,a){this.min=r,this.max=a,this.center=et([],St([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],h=qe(this.min),f=qe(this.max);for(let _=0;_<a.length;_++)h[_]=a[_]?this.min[_]:this.center[_],f[_]=a[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new Mn(h,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?Di(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?Di(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,a){return a||this.intersects(r)?gs(r,this.getCorners()):0}intersectsPreciseFlat(r,a){return a||this.intersectsFlat(r)?gs(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let a=0;a<3;++a)if(this.min[a]>r.max[a]||r.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],r.min[a]),this.max[a]=Math.max(this.max[a],r.max[a])}encapsulatePoint(r){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],r[a]),this.max[a]=Math.max(this.max[a],r[a])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}nn(Mn,"Aabb");class Br{constructor(r,a){this.feature=r,this.metersToTile=a,this.index=0}get(){const r=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,h=a[1],f=-a[0],_=(r.extent+1)*this.metersToTile;return[new It(Math.trunc(r.position[0]+h*_),Math.trunc(r.position[1]+f*_)),new It(Math.trunc(r.position[0]-h*_),Math.trunc(r.position[1]-f*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Gr{constructor(r,a,h,f,_,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[os(),os(),os(),os(),os(),os(),os()],this.id=r,this.heightRange={min:h,max:h},this.safeArea=a,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||f.length!==0)){this.vertices=f,this.edges=_,this.edges=this.edges.filter((T=>{return T.a<this.vertices.length&&T.b<this.vertices.length&&!((C=this.vertices[T.a].position)[0]===(k=this.vertices[T.b].position)[0]&&C[1]===k[1]);var C,k})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:pl(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const C=this.vertices[T.a].position,k=this.vertices[T.b].position,L=Ol(os(),k,C),j=lc(L),N=ml(os(),L,1/j);this.edgeProps.push({vec:L,dir:N,len:j});const H=this.vertexProps[T.a].dir,W=this.vertexProps[T.b].dir;ac(H,H,N),ac(W,W,N)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||vi(T.dir,T.dir);this.tessellate(y)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(r);if(a==null)return 0;const[h,f]=a;return An(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,f)}computeSlopeNormal(r,a){const h=this.getClosestEdge(r);if(!h)return Jt(0,0,1);const f=h[0],_=this.edges[f],y=this.edgeProps[f].vec,T=Jt(y[0],y[1],(this.vertices[_.b].height-this.vertices[_.a].height)*a),C=Jt(T[1],-T[0],0);En(C,C,T);const k=en(C);return k>0?et(C,C,1/k):Nt(C,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let a=0,h=Number.POSITIVE_INFINITY,f=0;const[_,y,T,C,k,L,j]=this._tmpVec2;$h(j,r.x,r.y);const N=new Sr(j,null);for(let H=0;H<this.edges.length;H++){const W=this.edges[H],ee=this.edgeProps[H].dir;N.dir=ee;const ie=this.vertices[W.a].position,se=this.vertices[W.b].position,fe=N.intersectsPlane(ie,this.vertexProps[W.a].dir,_),pe=N.intersectsPlane(se,this.vertexProps[W.b].dir,y);if(!fe||!pe)continue;Ol(T,y,_),Ol(C,j,_);const _e=hs(T,T),ke=_e>0?hs(C,T)/_e:0,Re=Oe(ke,0,1),Ne=Math.abs((ke-Re)*this.edgeProps[H].len);Ol(k,j,ie),$h(L,ee[1],-ee[0]);const Fe=Ne+Math.abs(hs(k,L));Fe<h&&(a=H,h=Fe,f=Re)}return[a,f]}tessellate(r){const a=lt(),h=lt(),f=lt(),_=lt();for(let y=this.edges.length-1;y>=0;--y){const T=this.edges[y].a,C=this.edges[y].b,{position:k,height:L,extent:j}=this.vertices[T],{position:N,height:H,extent:W}=this.vertices[C],ee=this.vertexProps[T].dir,ie=this.vertexProps[C].dir;if(Nt(a,k[0]/r,k[1]/r,L),Nt(h,N[0]/r,N[1]/r,H),Nt(f,ee[1],-ee[0],0),et(f,f,j),Nt(_,ie[1],-ie[0],0),et(_,_,W),this.distSqLines(Jt(a[0]+.5*f[0],a[1]+.5*f[1],a[2]+.5*f[2]),Jt(h[0]-.5*_[0],h[1]-.5*_[1],h[2]-.5*_[2]),Jt(a[0]-.5*f[0],a[1]-.5*f[1],a[2]-.5*f[2]),Jt(h[0]+.5*_[0],h[1]+.5*_[1],h[2]+.5*_[2]))<=.0025000000000000005)continue;const se=this.vertices.length,fe=ac(os(),k,N);this.vertices.push({position:ml(fe,fe,.5),height:.5*(L+H),extent:.5*(j+W)});const pe=ac(os(),ee,ie);this.vertexProps.push({dir:vi(pe,pe)}),this.edges.splice(y,1),this.edgeProps.splice(y,1),this.edges.push({a:T,b:se}),this.edges.push({a:se,b:C});const _e=Ol(os(),this.vertices[se].position,k),ke=lc(_e),Re={vec:_e,dir:ml(os(),_e,1/ke),len:ke};this.edgeProps.push(Re),this.edgeProps.push(Re)}}distSqLines(r,a,h,f){const _=an(lt(),a,r),y=an(lt(),f,h),T=an(lt(),r,h),C=Bt(_,_),k=Bt(_,y),L=Bt(_,T),j=Bt(y,y),N=Bt(y,T),H=C*j-k*k;if(H===0)return Zn(Tt(_,h,f,Bt(T,y)/Bt(y,y)),r);const W=(C*N-k*L)/H;return Zn(Tt(_,r,a,(k*N-L*j)/H),Tt(y,h,f,W))}}class ai{static parseFrom(r,a){const h=Xn.parse(r);if(!h)return[];let{vertices:f,features:_}=h;const y=1/Xe(a);_.sort(((L,j)=>L.id-j.id)),f.sort(((L,j)=>L.id-j.id||L.idx-j.idx)),f=f.filter(((L,j,N)=>j===N.findIndex((H=>H.id===L.id&&H.idx===L.idx))));const T=new Array;let C=0;const k=f.length;for(const L of _){if(L.constantHeight){T.push(new Gr(L.id,L.bounds,L.constantHeight));continue}for(;C!==k&&f[C].id<L.id;)C++;if(C===k||f[C].id!==L.id)continue;const j=new Array,N=new Array,H=C;for(;C!==k&&f[C].id===L.id;){const W=f[C];if(j.push({position:W.position,height:W.height,extent:W.extent}),C!==H&&f[C-1].idx===W.idx-1){const ee=C-H;N.push({a:ee-1,b:ee})}C++}T.push(new Gr(L.id,L.bounds,void 0,j,N,y))}return T}static getElevationFeature(r,a){if(!a)return;const h=+r.properties[Wn];return Number.isNaN(h)?void 0:a.find((f=>f.id===h))}}class Zi{constructor(r,a){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(a)||(this.zScale=Math.pow(2,a.z-r.z),this.xOffset=(r.x*this.zScale-a.x)*Ft,this.yOffset=(r.y*this.zScale-a.y)*Ft)}constantElevation(r,a){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,a)}pointElevation(r,a,h){const f=this.constantElevation(a,h);return f??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(r),h))}computeBiasedHeight(r,a){return a<=0?r:r+a*rt(0,a,r>=0?r:Math.abs(.5*r))}}nn(Gr,"ElevationFeature");class Gi{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Ac,this.indexArray=new ss,this.segments=new Rr,this.programConfigurations=new rl(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new uu),this.worldview=r.worldview}updateFootprints(r,a){}populate(r,a,h,f){const _=this.layers[0],y=[];let T=null;_.type==="circle"&&(T=_.layout.get("circle-sort-key"));for(const{feature:k,id:L,index:j,sourceLayerIndex:N}of r){const H=this.layers[0]._featureFilter.needGeometry,W=Pt(k,H);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{worldview:this.worldview}),W,h))continue;const ee=T?T.evaluate(W,{},h):void 0,ie={id:L,properties:k.properties,type:k.type,sourceLayerIndex:N,index:j,geometry:H?W.geometry:Gt(k,h,f),patterns:{},sortKey:ee};y.push(ie)}T&&y.sort(((k,L)=>k.sortKey-L.sortKey));let C=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new zf,C=f.projection);for(const k of y){const{geometry:L,index:j,sourceLayerIndex:N}=k,H=r[j].feature;this.addFeature(k,L,j,a.availableImages,h,C,a.brightness,a.elevationFeatures),a.featureIndex.insert(H,L,j,N,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,a,h,f,_,y,T){this.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,k_.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Hf.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,R_.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,a,h,f,_,y,T,C){let k;this.elevationMode!=="none"&&(k=ai.getElevationFeature(r,C));for(const L of a)for(const j of L){const N=j.x,H=j.y;if(N<0||N>=Ft||H<0||H>=Ft)continue;if(y){const ie=y.projectTilePoint(N,H,_),se=y.upVector(_,N,H);this.addGlobeExtVertex(ie,se),this.addGlobeExtVertex(ie,se),this.addGlobeExtVertex(ie,se),this.addGlobeExtVertex(ie,se)}const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),ee=W.vertexLength;if(this.addCircleVertex(N,H,-1,-1),this.addCircleVertex(N,H,1,-1),this.addCircleVertex(N,H,1,1),this.addCircleVertex(N,H,-1,1),this.elevationMode!=="none"){const ie=k?k.pointElevation(new It(N,H)):0;this.hasElevation=this.hasElevation||ie!==0;for(let se=0;se<4;se++)this.elevatedLayoutVertexArray.emplaceBack(ie)}this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},f,_,T,void 0,this.worldview)}addCircleVertex(r,a,h,f){this.layoutVertexArray.emplaceBack(2*r+(h+1)/2,2*a+(f+1)/2)}addGlobeExtVertex(r,a){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function To(l,r){for(let a=0;a<l.length;a++)if(Ji(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(Ji(l,r[a]))return!0;return!!Ys(l,r)}function Us(l,r,a){return!!Ji(l,r)||!!ji(r,l,a)}function ho(l,r){if(l.length===1)return Wi(r,l[0]);for(let a=0;a<r.length;a++){const h=r[a];for(let f=0;f<h.length;f++)if(Ji(l,h[f]))return!0}for(let a=0;a<l.length;a++)if(Wi(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(Ys(l,r[a]))return!0;return!1}function Eo(l,r,a){if(l.length>1){if(Ys(l,r))return!0;for(let h=0;h<r.length;h++)if(ji(r[h],l,a))return!0}for(let h=0;h<l.length;h++)if(ji(l[h],r,a))return!0;return!1}function Ys(l,r){if(l.length===0||r.length===0)return!1;for(let a=0;a<l.length-1;a++){const h=l[a],f=l[a+1];for(let _=0;_<r.length-1;_++)if(il(h,f,r[_],r[_+1]))return!0}return!1}function il(l,r,a,h){return zi(l,a,h)!==zi(r,a,h)&&zi(l,r,a)!==zi(l,r,h)}function Ia(l,r,a){return(l.x-a.x)*(r.y-a.y)-(l.y-a.y)*(r.x-a.x)}function Li(l,r,a,h){const f=Ia(l,r,h),_=Ia(l,r,a);if(Math.sign(f)===Math.sign(_))return;const y=Ia(a,h,l),T=y+_-f;return Math.sign(y)!==Math.sign(T)?[y/(y-T),_/(_-f)]:void 0}function ji(l,r,a){const h=a*a;if(r.length===1)return l.distSqr(r[0])<h;for(let f=1;f<r.length;f++)if(mi(l,r[f-1],r[f])<h)return!0;return!1}function mi(l,r,a){const h=r.distSqr(a);if(h===0)return l.distSqr(r);const f=((l.x-r.x)*(a.x-r.x)+(l.y-r.y)*(a.y-r.y))/h;return l.distSqr(f<0?r:f>1?a:a.sub(r)._mult(f)._add(r))}function Wi(l,r){let a,h,f,_=!1;for(let y=0;y<l.length;y++){a=l[y];for(let T=0,C=a.length-1;T<a.length;C=T++)h=a[T],f=a[C],h.y>r.y!=f.y>r.y&&r.x<(f.x-h.x)*(r.y-h.y)/(f.y-h.y)+h.x&&(_=!_)}return _}function Ji(l,r){let a=!1;for(let h=0,f=l.length-1;h<l.length;f=h++){const _=l[h],y=l[f];_.y>r.y!=y.y>r.y&&r.x<(y.x-_.x)*(r.y-_.y)/(y.y-_.y)+_.x&&(a=!a)}return a}function Ui(l,r,a,h,f){for(const y of l)if(r<=y.x&&a<=y.y&&h>=y.x&&f>=y.y)return!0;const _=[new It(r,a),new It(r,f),new It(h,f),new It(h,a)];if(l.length>2){for(const y of _)if(Ji(l,y))return!0}for(let y=0;y<l.length-1;y++)if(Ps(l[y],l[y+1],_))return!0;return!1}function Ps(l,r,a){const h=a[0],f=a[2];if(l.x<h.x&&r.x<h.x||l.x>f.x&&r.x>f.x||l.y<h.y&&r.y<h.y||l.y>f.y&&r.y>f.y)return!1;const _=zi(l,r,a[0]);return _!==zi(l,r,a[1])||_!==zi(l,r,a[2])||_!==zi(l,r,a[3])}function Zl(l,r,a,h,f,_){let y=r.y-l.y,T=l.x-r.x;if(_=_||0){const C=y*y+T*T;if(C===0)return!0;const k=Math.sqrt(C);y/=k,T/=k}return!((a.x-l.x)*y+(a.y-l.y)*T-_<0||(h.x-l.x)*y+(h.y-l.y)*T-_<0||(f.x-l.x)*y+(f.y-l.y)*T-_<0)}function Xl(l,r,a,h,f,_,y){return!(Zl(l,r,h,f,_,y)||Zl(r,a,h,f,_,y)||Zl(a,l,h,f,_,y)||Zl(h,f,l,r,a,y)||Zl(f,_,l,r,a,y)||Zl(_,h,l,r,a,y))}function Ma(l,r,a){const h=r.paint.get(l).value;return h.kind==="constant"?h.value:a.programConfigurations.get(r.id).getMaxValue(l)}function Cl(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Yl(l,r,a,h,f){if(!r[0]&&!r[1])return l;const _=It.convert(r)._mult(f);a==="viewport"&&_._rotate(-h);const y=[];for(let T=0;T<l.length;T++)y.push(l[T].sub(_));return y}function ka(l,r,a,h){const f=It.convert(l)._mult(h);return r==="viewport"&&f._rotate(-a),f}let yh,Pc;function Ra(l,r,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[l*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}nn(Gi,"CircleBucket",{omit:["layers"]});class Ic{constructor(r,a,h){this.z=r,this.x=a,this.y=h,this.key=vh(0,r,r,a,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const a=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>a&&r.y===this.y>>a}url(r,a){const h=(function(_,y,T){var C=Ra(256*_,256*(y=Math.pow(2,T)-y-1),T),k=Ra(256*(_+1),256*(y+1),T);return C[0]+","+C[1]+","+k[0]+","+k[1]})(this.x,this.y,this.z),f=(function(_,y,T){let C,k="";for(let L=_;L>0;L--)C=1<<L-1,k+=(y&C?1:0)+(T&C?2:0);return k})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gu{constructor(r,a){this.wrap=r,this.canonical=a,this.key=vh(r,a.z,a.z,a.x,a.y)}}class Ao{constructor(r,a,h,f,_){this.overscaledZ=r,this.wrap=a,this.canonical=new Ic(h,+f,+_),this.key=a===0&&r===h?this.canonical.key:vh(a,r,h,f,_)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Ao(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ao(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return vh(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return vh(this.wrap*+a,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Ao(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new Ao(a,this.wrap,a,h,f),new Ao(a,this.wrap,a,h+1,f),new Ao(a,this.wrap,a,h,f+1),new Ao(a,this.wrap,a,h+1,f+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ao(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ao(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vh(l,r,a,h,f){const _=1<<Math.min(a,22);let y=_*(f%_)+h%_;return l&&a<22&&(y+=_*_*((l<0?-2*l-1:2*l)%(1<<2*(22-a)))),16*(32*y+a)+(r-a)}const v=[l=>{let r=l.canonical.x-1,a=l.wrap;return r<0&&(r=(1<<l.canonical.z)-1,a--),new Ao(l.overscaledZ,a,l.canonical.z,r,l.canonical.y)},l=>{let r=l.canonical.x+1,a=l.wrap;return r===1<<l.canonical.z&&(r=0,a++),new Ao(l.overscaledZ,a,l.canonical.z,r,l.canonical.y)},l=>new Ao(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new Ao(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];nn(Ic,"CanonicalTileID"),nn(Ao,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const S=vr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:R}=S,U=vr([{name:"a_pos_3",components:3,type:"Int16"}]);var K=vr([{name:"a_pos",type:"Int16",components:2}]);function ae(l){return l*p/Y}const Ee=[new Mn([z,z,z],[B,B,B]),new Mn([z,z,z],[0,0,B]),new Mn([0,z,z],[B,0,B]),new Mn([z,0,z],[0,B,B]),new Mn([0,0,z],[B,B,B])];function Je(l,r,a,h=!0){const f=et([],l._camera.position,l.worldSize),_=[r,a,1,1];us(_,_,l.pixelMatrixInverse),Fi(_,_,1/_[3]);const y=kn([],nr([],_,f)),T=l.globeMatrix,C=[T[12],T[13],T[14]],k=nr([],C,f),L=en(k),j=kn([],k),N=l.worldSize/(2*Math.PI),H=Bt(j,y),W=Math.asin(N/L);if(W<Math.acos(H)){if(!h)return null;const ft=[],We=[];et(ft,y,L/H),kn(We,nr(We,ft,k)),kn(y,St(y,k,et(y,We,Math.tan(W)*L)))}const ee=[];new Mr(f,y).closestPointOnSphere(C,N,ee);const ie=kn([],Oi(T,0)),se=kn([],Oi(T,1)),fe=kn([],Oi(T,2)),pe=Bt(ie,ee),_e=Bt(se,ee),ke=Bt(fe,ee),Re=oe(Math.asin(-_e/N));let Ne=oe(Math.atan2(pe,ke));Ne=l.center.lng+(function(ft,We){const mt=(We-ft+180)%360-180;return mt<-180?mt+360:mt})(l.center.lng,Ne);const Fe=ve(Ne),Ue=Oe(Pe(Re),0,1);return new Qe(Fe,Ue)}class ct{constructor(r,a,h){this.a=nr([],r,h),this.b=nr([],a,h),this.center=h;const f=kn([],this.a),_=kn([],this.b);this.angle=Math.acos(Bt(f,_))}}function Vt(l,r){if(l.angle===0)return null;let a;return a=l.a[r]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[r]/l.a[r]/Math.sin(l.angle)-1/Math.tan(l.angle)),a<0||a>1?null:(function(h,f,_,y){const T=Math.sin(_);return h*(Math.sin((1-y)*_)/T)+f*(Math.sin(y*_)/T)})(l.a[r],l.b[r],l.angle,Oe(a,0,1))+l.center[r]}function pn(l){if(l.z<=1)return Ee[l.z+2*l.y+l.x];const r=cr(ir(l));return Mn.fromPoints(r)}function yn(l,r,a){return et(l,l,1-a),zt(l,l,r,a)}function vn(l,r,a){for(const h of l)wn(h,h,r),et(h,h,a)}function Kn(l,r,a,h){const f=r/l.worldSize,_=l.globeMatrix;if(a.z<=1){const Ue=pn(a).getCorners();return vn(Ue,_,f),Mn.fromPoints(Ue)}const y=ir(a,h),T=cr(y,p+ae(l._tileCoverLift));vn(T,_,f);const C=Number.MAX_VALUE,k=[-C,-C,-C],L=[C,C,C];if(y.contains(l.center)){for(const We of T)hn(L,L,We),Xt(k,k,We);k[2]=0;const Ue=l.point,ft=[Ue.x*f,Ue.y*f,0];return hn(L,L,ft),Xt(k,k,ft),new Mn(L,k)}if(l._tileCoverLift>0){for(const Ue of T)hn(L,L,Ue),Xt(k,k,Ue);return new Mn(L,k)}const j=[_[12]*f,_[13]*f,_[14]*f],N=y.getCenter(),H=Oe(l.center.lat,-Me,Me),W=Oe(N.lat,-Me,Me),ee=ve(l.center.lng),ie=Pe(H);let se=ee-ve(N.lng);const fe=ie-Pe(W);se>.5?se-=1:se<-.5&&(se+=1);let pe=0;Math.abs(se)>Math.abs(fe)?pe=se>=0?1:3:(pe=fe>=0?0:2,zt(j,j,[_[4]*f,_[5]*f,_[6]*f],-Math.sin($e(fe>=0?y.getSouth():y.getNorth()))*p));const _e=T[pe],ke=T[(pe+1)%4],Re=new ct(_e,ke,j),Ne=[Vt(Re,0)||_e[0],Vt(Re,1)||_e[1],Vt(Re,2)||_e[2]],Fe=Tr(l.zoom);if(Fe>0){const Ue=(function({x:We,y:mt,z:Ct},yt,xt,Rt,ht){const bt=1/(1<<Ct);let st=We*bt,nt=st+bt,Ot=mt*bt,Mt=Ot+bt,bn=0;const rn=(st+nt)/2-Rt;return rn>.5?bn=-1:rn<-.5&&(bn=1),st=((st+bn)*yt-(Rt*=yt))*xt+Rt,nt=((nt+bn)*yt-Rt)*xt+Rt,Ot=(Ot*yt-(ht*=yt))*xt+ht,Mt=(Mt*yt-ht)*xt+ht,[[st,Mt,0],[nt,Mt,0],[nt,Ot,0],[st,Ot,0]]})(a,r,l._pixelsPerMercatorPixel,ee,ie);for(let We=0;We<T.length;We++)yn(T[We],Ue[We],Fe);const ft=St([],Ue[pe],Ue[(pe+1)%4]);et(ft,ft,.5),yn(Ne,ft,Fe)}for(const Ue of T)hn(L,L,Ue),Xt(k,k,Ue);return L[2]=Math.min(_e[2],ke[2]),hn(L,L,Ne),Xt(k,k,Ne),new Mn(L,k)}function ir({x:l,y:r,z:a},h=!1){const f=1/(1<<a),_=new Q(Ie(l*f),r===(1<<a)-1&&h?-90:Ce((r+1)*f)),y=new Q(Ie((l+1)*f),r===0&&h?90:Ce(r*f));return new ce(_,y)}function cr(l,r=p){const a=$e(l.getNorth()),h=$e(l.getSouth()),f=Math.cos(a),_=Math.cos(h),y=Math.sin(a),T=Math.sin(h),C=l.getWest(),k=l.getEast();return[G(_,T,C,r),G(_,T,k,r),G(f,y,k,r),G(f,y,C,r)]}function as(l,r,a,h){const f=1<<a.z,_=(l/Ft+a.x)/f;return V(Ce((r/Ft+a.y)/f),Ie(_),h)}function Et({min:l,max:r}){return A/Math.max(r[0]-l[0],r[1]-l[1],r[2]-l[2])}const pt=new Float64Array(16);function Lt(l){const r=Et(l),a=Le(pt,[r,r,r]);return le(a,a,fr([],l.min))}function Pn(l){const r=(h=l.min,(a=pt)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[0],a[13]=h[1],a[14]=h[2],a[15]=1,a);var a,h;const f=1/Et(l);return ue(r,r,[f,f,f])}function pr(l){const r=Ft/(2*Math.PI);return l/(2*Math.PI)/r}function Cr(l,r){return Ft/(512*Math.pow(2,l))*Et(pn(r))}function Pr(l,r,a,h,f){const _=pr(a),y=[l,r,-a/(2*Math.PI)],T=q(new Float64Array(16));return le(T,T,y),ue(T,T,[_,_,_]),ye(T,T,$e(-f)),ge(T,T,$e(-h)),T}function Tr(l){return rt(x,w,l)}function fo(l,r){const a=V(r.lat,r.lng),h=(function(W){const ee=V(W._center.lat,W._center.lng);let ie=En([],Jt(0,1,0),ee);const se=Ze([],-W.angle,ee);ie=wn(ie,ie,se),Ze(se,-W._pitch,ie);const fe=kn([],ee);return et(fe,fe,ae(W.cameraToCenterDistance/W.pixelsPerMeter)),wn(fe,fe,se),St([],ee,fe)})(l);return y=(f=an([],h,a))[0],T=f[1],C=f[2],k=(_=a)[0],L=_[1],j=_[2],H=(N=Math.sqrt((y*y+T*T+C*C)*(k*k+L*L+j*j)))&&Bt(f,_)/N,Math.acos(Math.min(Math.max(H,-1),1));var f,_,y,T,C,k,L,j,N,H}function Ci(l,r){return fo(l,r)>Math.PI/2*1.01}const xh=$e(85),dS=Math.cos(xh),f6=Math.sin(xh),p6=Z(),mI=l=>{const r=[];return l.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function gI(l,r,a,h,f,_,y,T,C){if(_&&l.queryGeometry.isAboveHorizon)return!1;_&&(C*=l.pixelToTileUnitsFactor);const k=l.tileID.canonical,L=a.projection.upVectorScale(k,a.center.lat,a.worldSize).metersToTile;for(const j of r)for(const N of j){const H=N.add(T),W=f&&a.elevation?a.elevation.exaggeration()*f.getElevationAt(H.x,H.y,!0):0,ee=a.projection.projectTilePoint(H.x,H.y,k);if(W>0){const pe=a.projection.upVector(k,H.x,H.y);ee.x+=pe[0]*L*W,ee.y+=pe[1]*L*W,ee.z+=pe[2]*L*W}const ie=_?H:m6(ee.x,ee.y,ee.z,h),se=_?l.tilespaceRays.map((pe=>_6(pe,W))):l.queryGeometry.screenGeometry,fe=us([],[ee.x,ee.y,ee.z,1],h);if(!y&&_?C*=fe[3]/a.cameraToCenterDistance:y&&!_&&(C*=a.cameraToCenterDistance/fe[3]),_){const pe=Ce((N.y/Ft+k.y)/(1<<k.z));C/=a.projection.pixelsPerMeter(pe,1)/Ae(1,pe)}if(Us(se,ie,C))return!0}return!1}function m6(l,r,a,h){const f=us([],[l,r,a,1],h);return new It(f[0]/f[3],f[1]/f[3])}const _I=Jt(0,0,0),g6=Jt(0,0,1);function _6(l,r){const a=lt();return _I[2]=r,l.intersectsPlane(_I,g6,a),new It(a[0],a[1])}class yI extends Gi{}let vI,xI,bI,wI;function SI(l,{width:r,height:a},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==r*a*h)throw new RangeError("mismatched image size")}else f=new Uint8Array(r*a*h);return l.width=r,l.height=a,l.data=f,l}function TI(l,r,a){const{width:h,height:f}=r;h===l.width&&f===l.height||(fS(l,r,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,h),height:Math.min(l.height,f)},a,null),l.width=h,l.height=f,l.data=r.data)}function fS(l,r,a,h,f,_,y,T){if(f.width===0||f.height===0)return r;if(f.width>l.width||f.height>l.height||a.x>l.width-f.width||a.y>l.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>r.width||f.height>r.height||h.x>r.width-f.width||h.y>r.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const C=l.data,k=r.data,L=_===4&&T;for(let j=0;j<f.height;j++){const N=((a.y+j)*l.width+a.x)*_,H=((h.y+j)*r.width+h.x)*_;if(L)for(let W=0;W<f.width;W++){const ee=N+W*_+3,ie=H+W*_;k[ie+0]=255,k[ie+1]=255,k[ie+2]=255,k[ie+3]=C[ee]}else if(y)for(let W=0;W<f.width;W++){const ee=N+W*_,ie=H+W*_,se=new Ir(C[ee+0]/255,C[ee+1]/255,C[ee+2]/255,C[ee+3]).toNonPremultipliedRenderColor(y).toArray();k[ie+0]=se[0],k[ie+1]=se[1],k[ie+2]=se[2],k[ie+3]=se[3]}else for(let W=0;W<f.width*_;W++)k[H+W]=C[N+W]}return r}nn(yI,"HeatmapBucket",{omit:["layers"]});class sm{constructor(r,a){SI(this,r,1,a)}resize(r){TI(this,new sm(r),1)}clone(){return new sm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,h,f,_){fS(r,a,h,f,_,1,null)}}class Co{constructor(r,a){SI(this,r,4,a)}resize(r){TI(this,new Co(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Co({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,h,f,_,y,T){fS(r,a,h,f,_,4,y,T)}}class EI{constructor(r,a){this.width=r.width,this.height=r.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Zy(l){const r={},a=l.resolution||256,h=l.clips?l.clips.length:1,f=l.image||new Co({width:a,height:h}),_=(y,T,C)=>{r[l.evaluationKey]=C;const k=l.expression.evaluate(r),L=k?k.toNonPremultipliedRenderColor(null):null;L&&(f.data[y+T+0]=Math.floor(255*L.r),f.data[y+T+1]=Math.floor(255*L.g),f.data[y+T+2]=Math.floor(255*L.b),f.data[y+T+3]=Math.floor(255*L.a))};if(l.clips)for(let y=0,T=0;y<h;++y,T+=4*a)for(let C=0,k=0;C<a;C++,k+=4){const L=C/(a-1),{start:j,end:N}=l.clips[y];_(T,k,j*(1-L)+N*L)}else for(let y=0,T=0;y<a;y++,T+=4)_(0,T,y/(a-1));return f}nn(sm,"AlphaImage"),nn(Co,"RGBAImage");const y6=vr([{name:"a_pos",components:2,type:"Int16"}],4),v6=vr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),x6=vr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),b6=vr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function D_(l,r,a=2){const h=r&&r.length,f=h?r[0]*a:l.length;let _=AI(l,0,f,a,!0);const y=[];if(!_||_.next===_.prev)return y;let T,C,k;if(h&&(_=(function(L,j,N,H){const W=[];for(let ee=0,ie=j.length;ee<ie;ee++){const se=AI(L,j[ee]*H,ee<ie-1?j[ee+1]*H:L.length,H,!1);se===se.next&&(se.steiner=!0),W.push(I6(se))}W.sort(A6);for(let ee=0;ee<W.length;ee++)N=C6(W[ee],N);return N})(l,r,_,a)),l.length>80*a){T=l[0],C=l[1];let L=T,j=C;for(let N=a;N<f;N+=a){const H=l[N],W=l[N+1];H<T&&(T=H),W<C&&(C=W),H>L&&(L=H),W>j&&(j=W)}k=Math.max(L-T,j-C),k=k!==0?32767/k:0}return Xy(_,y,a,T,C,k,0),y}function AI(l,r,a,h,f){let _;if(f===(function(y,T,C,k){let L=0;for(let j=T,N=C-k;j<C;j+=k)L+=(y[N]-y[j])*(y[j+1]+y[N+1]),N=j;return L})(l,r,a,h)>0)for(let y=r;y<a;y+=h)_=MI(y/h|0,l[y],l[y+1],_);else for(let y=a-h;y>=r;y-=h)_=MI(y/h|0,l[y],l[y+1],_);return _&&L_(_,_.next)&&(Jy(_),_=_.next),_}function _g(l,r){if(!l)return l;r||(r=l);let a,h=l;do if(a=!1,h.steiner||!L_(h,h.next)&&Vs(h.prev,h,h.next)!==0)h=h.next;else{if(Jy(h),h=r=h.prev,h===h.next)break;a=!0}while(a||h!==r);return r}function Xy(l,r,a,h,f,_,y){if(!l)return;!y&&_&&(function(C,k,L,j){let N=C;do N.z===0&&(N.z=pS(N.x,N.y,k,L,j)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==C);N.prevZ.nextZ=null,N.prevZ=null,(function(H){let W,ee=1;do{let ie,se=H;H=null;let fe=null;for(W=0;se;){W++;let pe=se,_e=0;for(let Re=0;Re<ee&&(_e++,pe=pe.nextZ,pe);Re++);let ke=ee;for(;_e>0||ke>0&&pe;)_e!==0&&(ke===0||!pe||se.z<=pe.z)?(ie=se,se=se.nextZ,_e--):(ie=pe,pe=pe.nextZ,ke--),fe?fe.nextZ=ie:H=ie,ie.prevZ=fe,fe=ie;se=pe}fe.nextZ=null,ee*=2}while(W>1)})(N)})(l,h,f,_);let T=l;for(;l.prev!==l.next;){const C=l.prev,k=l.next;if(_?S6(l,h,f,_):w6(l))r.push(C.i,l.i,k.i),Jy(l),l=k.next,T=k.next;else if((l=k)===T){y?y===1?Xy(l=T6(_g(l),r),r,a,h,f,_,2):y===2&&E6(l,r,a,h,f,_):Xy(_g(l),r,a,h,f,_,1);break}}}function w6(l){const r=l.prev,a=l,h=l.next;if(Vs(r,a,h)>=0)return!1;const f=r.x,_=a.x,y=h.x,T=r.y,C=a.y,k=h.y,L=Math.min(f,_,y),j=Math.min(T,C,k),N=Math.max(f,_,y),H=Math.max(T,C,k);let W=h.next;for(;W!==r;){if(W.x>=L&&W.x<=N&&W.y>=j&&W.y<=H&&Yy(f,T,_,C,y,k,W.x,W.y)&&Vs(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function S6(l,r,a,h){const f=l.prev,_=l,y=l.next;if(Vs(f,_,y)>=0)return!1;const T=f.x,C=_.x,k=y.x,L=f.y,j=_.y,N=y.y,H=Math.min(T,C,k),W=Math.min(L,j,N),ee=Math.max(T,C,k),ie=Math.max(L,j,N),se=pS(H,W,r,a,h),fe=pS(ee,ie,r,a,h);let pe=l.prevZ,_e=l.nextZ;for(;pe&&pe.z>=se&&_e&&_e.z<=fe;){if(pe.x>=H&&pe.x<=ee&&pe.y>=W&&pe.y<=ie&&pe!==f&&pe!==y&&Yy(T,L,C,j,k,N,pe.x,pe.y)&&Vs(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,_e.x>=H&&_e.x<=ee&&_e.y>=W&&_e.y<=ie&&_e!==f&&_e!==y&&Yy(T,L,C,j,k,N,_e.x,_e.y)&&Vs(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;pe&&pe.z>=se;){if(pe.x>=H&&pe.x<=ee&&pe.y>=W&&pe.y<=ie&&pe!==f&&pe!==y&&Yy(T,L,C,j,k,N,pe.x,pe.y)&&Vs(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;_e&&_e.z<=fe;){if(_e.x>=H&&_e.x<=ee&&_e.y>=W&&_e.y<=ie&&_e!==f&&_e!==y&&Yy(T,L,C,j,k,N,_e.x,_e.y)&&Vs(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function T6(l,r){let a=l;do{const h=a.prev,f=a.next.next;!L_(h,f)&&PI(h,a,a.next,f)&&Ky(h,f)&&Ky(f,h)&&(r.push(h.i,a.i,f.i),Jy(a),Jy(a.next),a=l=f),a=a.next}while(a!==l);return _g(a)}function E6(l,r,a,h,f,_){let y=l;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&M6(y,T)){let C=II(y,T);return y=_g(y,y.next),C=_g(C,C.next),Xy(y,r,a,h,f,_,0),void Xy(C,r,a,h,f,_,0)}T=T.next}y=y.next}while(y!==l)}function A6(l,r){let a=l.x-r.x;return a===0&&(a=l.y-r.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),a}function C6(l,r){const a=(function(f,_){let y=_;const T=f.x,C=f.y;let k,L=-1/0;if(L_(f,y))return y;do{if(L_(f,y.next))return y.next;if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){const ee=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(ee<=T&&ee>L&&(L=ee,k=y.x<y.next.x?y:y.next,ee===T))return k}y=y.next}while(y!==_);if(!k)return null;const j=k,N=k.x,H=k.y;let W=1/0;y=k;do{if(T>=y.x&&y.x>=N&&T!==y.x&&CI(C<H?T:L,C,N,H,C<H?L:T,C,y.x,y.y)){const ee=Math.abs(C-y.y)/(T-y.x);Ky(y,f)&&(ee<W||ee===W&&(y.x>k.x||y.x===k.x&&P6(k,y)))&&(k=y,W=ee)}y=y.next}while(y!==j);return k})(l,r);if(!a)return r;const h=II(a,l);return _g(h,h.next),_g(a,a.next)}function P6(l,r){return Vs(l.prev,l,r.prev)<0&&Vs(r.next,l,l.next)<0}function pS(l,r,a,h,f){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*f|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function I6(l){let r=l,a=l;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==l);return a}function CI(l,r,a,h,f,_,y,T){return(f-y)*(r-T)>=(l-y)*(_-T)&&(l-y)*(h-T)>=(a-y)*(r-T)&&(a-y)*(_-T)>=(f-y)*(h-T)}function Yy(l,r,a,h,f,_,y,T){return!(l===y&&r===T)&&CI(l,r,a,h,f,_,y,T)}function M6(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!(function(a,h){let f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==h.i&&f.next.i!==h.i&&PI(f,f.next,a,h))return!0;f=f.next}while(f!==a);return!1})(l,r)&&(Ky(l,r)&&Ky(r,l)&&(function(a,h){let f=a,_=!1;const y=(a.x+h.x)/2,T=(a.y+h.y)/2;do f.y>T!=f.next.y>T&&f.next.y!==f.y&&y<(f.next.x-f.x)*(T-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next;while(f!==a);return _})(l,r)&&(Vs(l.prev,l,r.prev)||Vs(l,r.prev,r))||L_(l,r)&&Vs(l.prev,l,l.next)>0&&Vs(r.prev,r,r.next)>0)}function Vs(l,r,a){return(r.y-l.y)*(a.x-r.x)-(r.x-l.x)*(a.y-r.y)}function L_(l,r){return l.x===r.x&&l.y===r.y}function PI(l,r,a,h){const f=d0(Vs(l,r,a)),_=d0(Vs(l,r,h)),y=d0(Vs(a,h,l)),T=d0(Vs(a,h,r));return f!==_&&y!==T||!(f!==0||!h0(l,a,r))||!(_!==0||!h0(l,h,r))||!(y!==0||!h0(a,l,h))||!(T!==0||!h0(a,r,h))}function h0(l,r,a){return r.x<=Math.max(l.x,a.x)&&r.x>=Math.min(l.x,a.x)&&r.y<=Math.max(l.y,a.y)&&r.y>=Math.min(l.y,a.y)}function d0(l){return l>0?1:l<0?-1:0}function Ky(l,r){return Vs(l.prev,l,l.next)<0?Vs(l,r,l.next)>=0&&Vs(l,l.prev,r)>=0:Vs(l,r,l.prev)<0||Vs(l,l.next,r)<0}function II(l,r){const a=mS(l.i,l.x,l.y),h=mS(r.i,r.x,r.y),f=l.next,_=r.prev;return l.next=r,r.prev=l,a.next=f,f.prev=a,h.next=a,a.prev=h,_.next=h,h.prev=_,h}function MI(l,r,a,h){const f=mS(l,r,a);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Jy(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function mS(l,r,a){return{i:l,x:r,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Qy(l,r){const a=l.length;if(a<=1)return[l];const h=[];let f,_;for(let y=0;y<a;y++){const T=Ur(l[y]);T!==0&&(l[y].area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(f&&h.push(f),f=[l[y]]):f.push(l[y]))}if(f&&h.push(f),r>1)for(let y=0;y<h.length;y++)h[y].length<=r||(m_(h[y],r,1,h[y].length-1,k6),h[y]=h[y].slice(0,r));return h}function k6(l,r){return r.area-l.area}function kI(l,r,a=1){if(!l)return null;const h=typeof l=="string"?jo.from(l).getPrimary():l.getPrimary(),f=typeof l=="string"?null:l.getSecondary();for(const _ of[h,f]){if(!_)continue;const y=_.id.toString();r.has(y)||r.set(y,[]),_.scaleSelf(a),r.get(y).push(_)}return{primary:h.toString(),secondary:f?f.toString():null}}function gS(l,r,a,h){const f=h.patternDependencies;let _=!1;for(const y of r){const T=y.paint.get(`${l}-pattern`);T.isConstant()||(_=!0),kI(T.constantOr(null),f,a)&&(_=!0)}return _}function _S(l,r,a,h,f,_){const y=_.patternDependencies;for(const T of r){const C=T.paint.get(`${l}-pattern`).value;if(C.kind!=="constant"){let k=C.evaluate({zoom:h},a,{},_.availableImages);k=k&&k.name?k.name:k;const L=kI(k,y,f);if(!L)continue;const{primary:j,secondary:N}=L;j&&(a.patterns[T.id]=[j,N].filter(Boolean))}}return a}class RI{constructor(){this.polygons=new Map}add(r,...a){const h=this.polygons.get(r);h?h.push(...a):this.polygons.set(r,a)}merge(r){for(const[a,h]of r.polygons)this.add(a,...h)}}class Zf{constructor(){this.portals=[]}static isOnBorder(r,a){return r<=0&&a<=0||r>=Ft&&a>=Ft}static evaluate(r){if(r.length===0)return new Zf;let a=[];for(const C of r)a.push(...C.portals);if(a.length===0)return new Zf;for(const C of a){const k=C.va,L=C.vb;(Zf.isOnBorder(k.x,L.x)||Zf.isOnBorder(k.y,L.y))&&(C.type="border")}const h=a.filter((C=>C.type!=="unevaluated")),f=a.filter((C=>C.type==="unevaluated"));if(f.length===0)return new Zf;f.sort(((C,k)=>C.hash===k.hash?C.isTunnel===k.isTunnel?0:C.isTunnel?-1:1:C.hash<k.hash?1:-1)),a=h.concat(f);let _=h.length,y=_,T=_;do if(y++,y===a.length||a[_].hash!==a[y].hash){if(y-_==2){T<_&&(a[T]=a[_],a[_]=null);const C=a[T],k=a[y-1];C.type=C.isTunnel!==k.isTunnel?"tunnel":"polygon",C.connection={a:C.connection.a,b:k.connection.a},T++}_=y}while(_!==a.length);return a.splice(T),a.sort(((C,k)=>C.hash<k.hash?1:-1)),{portals:a}}}nn(Zf,"ElevationPortalGraph"),nn(RI,"ElevationPolygons");class R6{constructor(r,a,h){this.outPositions=r,this.outNormals=a,this.outIndices=h,this.vertexLookup=new Map}addVertex(r,a,h){let f=r[2];h!=null&&(f*=h);const _=`${r[0]},${r[1]},${r[2]},${a[0]},${a[1]},${a[2]}`,y=this.vertexLookup.get(_);if(y!=null)return y;const T=this.outPositions.length;this.vertexLookup.set(_,T);const C=Math.trunc(16384*a[0]),k=Math.trunc(16384*a[1]),L=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(r[0],r[1],f),this.outNormals.emplaceBack(C,k,L),T}addTriangle(r,a,h){this.outIndices.emplaceBack(r,a,h)}addTriangles(r,a,h){if(r.length===0)return;const f=h.length===1,_=lt(),y=lt();for(let T=0;T<r.length;T+=3){const C=a[r[T+0]],k=a[r[T+1]],L=a[r[T+2]],j=f?h[0]:h[r[T+1]],N=f?h[0]:h[r[T+2]];Nt(_,C.x,C.y,f?h[0]:h[r[T+0]]);const H=this.addVertex(_,y);Nt(_,k.x,k.y,j);const W=this.addVertex(_,y);Nt(_,L.x,L.y,N);const ee=this.addVertex(_,y);this.outIndices.emplaceBack(H,W,ee)}}addQuad(r,a,h,f,_,y){const T=this.addVertex(r,_,y),C=this.addVertex(a,_,y),k=this.addVertex(h,_,y),L=this.addVertex(f,_,y);this.addTriangle(T,C,k),this.addTriangle(k,L,T)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Pl{constructor(r,a,h,f){this.unevaluatedPortals=new Zf,this.portalPolygons=new RI,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ug,this.vertexNormals=new Xp,this.indexArray=new ss,this.tileToMeters=Xe(r),this.bridgeProgramConfigurations=new rl(a,{zoom:h,lut:f},(_=>_!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new rl(a,{zoom:h,lut:f},(_=>_!=="fill-bridge-guard-rail-color"))}addVertices(r,a){const h=this.unevalVertices.length;for(let f=0;f<r.length;f++)this.unevalVertices.push(r[f]),this.unevalHeights.push(a[f]);return h}addTriangles(r,a,h){const f=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of r)f.push(_+a)}addRenderableRing(r,a,h,f,_,y){const T=[new It(_.min.x,_.min.y),new It(_.max.x,_.min.y),new It(_.max.x,_.max.y),new It(_.min.x,_.max.y)];for(let C=0;C<h-1;C++){const k=a+C,L=k+1,j=this.unevalVertices[k],N=this.unevalVertices[L];if(!(j.x>=_.min.x&&j.x<=_.max.x&&j.y>=_.min.y&&j.y<=_.max.y||N.x>=_.min.x&&N.x<=_.max.x&&N.y>=_.min.y&&N.y<=_.max.y||Ps(j,N,T))||this.isOnBorder(j.x,N.x)||this.isOnBorder(j.y,N.y))continue;const H=Pl.computeEdgeHash(this.unevalVertices[k],this.unevalVertices[L]);let W,ee=this.vertexHashLookup.get(Pl.computePosHash(j));ee!=null?W=ee.next:(ee=this.vertexHashLookup.get(Pl.computePosHash(N)),W=ee!=null?ee.prev:H),this.unevalEdges.push({polygonIdx:r,a:k,b:L,hash:H,portalHash:W,isTunnel:f,type:"unevaluated",featureInfo:y})}}addPortalCandidates(r,a,h,f,_){if(a.length===0)return;this.portalPolygons.add(r,{geometry:a,zLevel:_});const y=a[0];this.vertexHashLookup.clear();let T=Pl.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let C=0;C<y.length-1;C++){const k=y[C+0],L=y[C+1],j=pl(L.x-k.x,L.y-k.y),N=lc(j);if(N===0)continue;let H="unevaluated";const W=f.pointElevation(k),ee=f.pointElevation(L);Math.abs(W)<.01&&Math.abs(ee)<.01?H="entrance":(this.isOnBorder(k.x,L.x)||this.isOnBorder(k.y,L.y))&&(H="border");const ie=Pl.computeEdgeHash(k,L);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:k,vb:L,vab:j,length:N,hash:ie,isTunnel:h,type:H});const se=Pl.computePosHash(k);this.vertexHashLookup.set(se,{prev:T,next:ie}),T=ie}}construct(r){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},f=new R6(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const _=a(),y=a(),T=a(),C=(N,H)=>{N.sort(((ee,ie)=>ee.type===H&&ie.type!==H?-1:ee.type!==H&&ie.type===H?1:0));const W=N.findIndex((ee=>ee.type!==H));return W>=0?W:N.length};let k=0;this.unevalEdges.length>0&&(k=C(this.unevalEdges,"none"),this.constructBridgeStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},this.tileToMeters)),h(T);const L=a(),j=a();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(k),H=C(N,"tunnel")+k;this.unevalEdges.push(...N),this.constructTunnelStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},{min:k,max:H})}h(L),f.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(j),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(y),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(_),this.maskSegments=Rr.simpleSegment(0,j.primitiveOffset,0,j.primitiveLength),this.depthSegments=Rr.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=Rr.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableTunnelSegments=Rr.simpleSegment(0,L.primitiveOffset,0,L.primitiveLength),this.shadowCasterSegments=Rr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(r,a,h,f,_,y,T,C){this.bridgeProgramConfigurations.updatePaintArrays(r,a,_,h,f,y,T,C),this.tunnelProgramConfigurations.updatePaintArrays(r,a,_,h,f,y,T,C)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,x6.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,b6.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,a,h,f,_){const y=(T,C)=>{for(let k=0;k<C.length-1;k++){const L=C[k].featureIndex,j=C[k+1].vertexStart,N=r.feature(L);T.populatePaintArrays(j,N,L,{},h,a,f,void 0,_)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,a,h,f,_){const y=new Map;for(let T=f;T<_;T++){const C=h[T],k=C.a,L=C.b,j=Pl.computePosHash(r[k]),N=Pl.computePosHash(r[L]);let H=y.get(j);H||(H={},y.set(j,H));let W=y.get(N);W||(W={},y.set(N,W)),a[k]<=0&&a[L]<=0||(H.to=L,W.from=k)}return y}isTerminalVertex(r,a){const h=Pl.computePosHash(this.unevalVertices[r]),f=a.get(h);return!f||!f.from||!f.to}constructBridgeStructures(r,a,h,f,_,y){r.clearVertexLookup();const T=this.computeVertexConnections(a,h,f,_.min,_.max),C=1/y,k=.5*C,L=(xt,Rt)=>Nt(xt,a[Rt].x,a[Rt].y,h[Rt]*C),j=lt(),N=lt(),H=lt(),W=lt(),ee=lt(),ie=(xt,Rt)=>{const ht=T.get(Pl.computePosHash(a[Rt])),bt=ht.from,st=ht.to;if(!bt||!st)return;L(j,bt),L(N,Rt),L(H,st),Ii(W),Hn(j,N)||(nr(ee,N,j),kn(W,ee)),Hn(H,N)||(nr(ee,H,N),St(W,W,kn(ee,ee)));const nt=Sn(W);return nt>0?et(xt,W,1/nt):void 0};let se=Number.POSITIVE_INFINITY;this.sortSubarray(f,_.min,_.max,((xt,Rt)=>xt.featureInfo.featureIndex-Rt.featureInfo.featureIndex));const fe=lt(),pe=lt(),_e=lt(),ke=lt(),Re=lt(),Ne=lt(),Fe=lt(),Ue=lt(),ft=lt(),We=[lt(),lt(),lt(),lt()],mt=[lt(),lt(),lt(),lt()],Ct=[{coord:new It(0,0),height:0},{coord:new It(0,0),height:0}],yt=(xt,Rt)=>xt>Rt;for(let xt=_.min;xt<_.max;xt++){const Rt=f[xt];if(!Rt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ct,a,h,Rt,yt))continue;const[ht,bt]=Ct;if(Nt(fe,ht.coord.x,ht.coord.y,C*ht.height),Nt(pe,bt.coord.x,bt.coord.y,C*bt.height),Hn(fe,pe))continue;nr(_e,pe,fe),kn(_e,_e);const st=ie(Ue,Rt.a)||_e,nt=ie(ft,Rt.b)||_e;Nt(ke,st[1],-st[0],0),kn(ke,ke),Nt(Re,nt[1],-nt[0],0),kn(Re,Re),En(Ue,ke,st),kn(Ne,Ue),En(Ue,Re,nt),kn(Fe,Ue),St(We[0],fe,et(Ue,nr(Ue,ke,Ne),k)),St(We[1],fe,et(Ue,St(Ue,ke,Ne),k)),St(We[2],fe,et(Ue,Ne,k)),We[3]=fe,St(mt[0],pe,et(Ue,nr(Ue,Re,Fe),k)),St(mt[1],pe,et(Ue,St(Ue,Re,Fe),k)),St(mt[2],pe,et(Ue,Fe,k)),mt[3]=pe,se=this.addFeatureSection(Rt.featureInfo.featureIndex,se,this.bridgeFeatureSections,r);const Ot=r.addVertex(We[0],ke,y),Mt=r.addVertex(We[1],ke,y),bn=r.addVertex(mt[0],Re,y),rn=r.addVertex(mt[1],Re,y);r.addTriangle(Ot,Mt,bn),r.addTriangle(Mt,rn,bn);const fn=r.addVertex(We[1],Ne,y),Ut=r.addVertex(We[2],Ne,y),xn=r.addVertex(mt[1],Fe,y),Nn=r.addVertex(mt[2],Fe,y);r.addTriangle(fn,Ut,xn),r.addTriangle(Ut,Nn,xn),fr(ke,ke),fr(Re,Re);const Yt=r.addVertex(We[2],ke,y),mn=r.addVertex(We[3],ke,y),On=r.addVertex(mt[2],Re,y),Vn=r.addVertex(mt[3],Re,y);r.addTriangle(Yt,mn,On),r.addTriangle(mn,Vn,On);const ar=this.isTerminalVertex(Rt.a,T),Jn=this.isTerminalVertex(Rt.b,T);ht.height<.01&&ar&&r.addQuad(We[3],We[2],We[1],We[0],fr(st,st),y),bt.height<.01&&Jn&&r.addQuad(mt[0],mt[1],mt[2],mt[3],nt,y)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,a,h,f,_,y){r.clearVertexLookup();let T=Number.POSITIVE_INFINITY;const C=(se,fe)=>se.featureInfo.featureIndex-fe.featureInfo.featureIndex;this.sortSubarray(f,_.min,_.max,C),this.sortSubarray(f,y.min,y.max,C);const k=se=>kn(se,se),L=[{coord:new It(0,0),height:0},{coord:new It(0,0),height:0}],j=(se,fe)=>se<fe,N=lt(),H=lt(),W=lt(),ee=lt(),ie=lt();for(let se=_.min;se<_.max;se++){if(!this.prepareEdgePoints(L,a,h,f[se],j))continue;const[fe,pe]=L,_e=k(Nt(ie,-(pe.coord.y-fe.coord.y),pe.coord.x-fe.coord.x,0));T=this.addFeatureSection(f[se].featureInfo.featureIndex,T,this.tunnelFeatureSections,r),r.addQuad(Nt(N,fe.coord.x,fe.coord.y,fe.height),Nt(H,pe.coord.x,pe.coord.y,pe.height),Nt(W,pe.coord.x,pe.coord.y,f[se].isTunnel?-.1:0),Nt(ee,fe.coord.x,fe.coord.y,f[se].isTunnel?-.1:0),_e)}for(let se=y.min;se<y.max;se++){const fe=f[se];fe.isTunnel&&([fe.a,fe.b]=[fe.b,fe.a]);const pe=a[fe.a],_e=a[fe.b],ke=k(Nt(ie,-(_e.y-pe.y),_e.x-pe.x,0));T=this.addFeatureSection(fe.featureInfo.featureIndex,T,this.tunnelFeatureSections,r),r.addQuad(Nt(N,_e.x,_e.y,0),Nt(H,pe.x,pe.y,0),Nt(W,pe.x,pe.y,h[fe.a]+4),Nt(ee,_e.x,_e.y,h[fe.b]+4),ke),r.addQuad(Nt(N,pe.x,pe.y,0),Nt(H,_e.x,_e.y,0),Nt(W,_e.x,_e.y,h[fe.b]+4),Nt(ee,pe.x,pe.y,h[fe.a]+4),ke)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,a,h,f){r.coord.x=a,r.coord.y=h,r.height=f}prepareEdgePoints(r,a,h,f,_){let y=a[f.a].x,T=a[f.a].y,C=a[f.b].x,k=a[f.b].y,L=h[f.a],j=h[f.b];const N=_(L,0),H=_(j,0);if(N&&H)return this.setElevatedPoint(r[0],y,T,L),this.setElevatedPoint(r[1],C,k,j),!0;if(!N&&!H)return!1;if(N){if(!H){const W=j/(j-L);C=An(C,y,W),k=An(k,T,W),j=An(j,L,W)}}else{const W=L/(L-j);y=An(y,C,W),T=An(T,k,W),L=An(L,j,W)}return this.setElevatedPoint(r[0],y,T,L),this.setElevatedPoint(r[1],C,k,j),!0}prepareEdges(r,a){if(a.length===0)return;a.sort(((T,C)=>T.hash===C.hash?C.polygonIdx-T.polygonIdx:C.hash>T.hash?1:-1));let h=0,f=0,_=0,y=a[h].polygonIdx;do f++,(f===a.length||a[h].hash!==a[f].hash)&&((f-h==1||a[f-1].polygonIdx!==y)&&(_<h&&(a[_]=a[h],a[h]=null),a[_].type="none",_++),h=f,h!==a.length&&(y=a[h].polygonIdx));while(h!==a.length);if(a.splice(_),a.length!==0&&r.length!==0){a.sort(((k,L)=>k.portalHash<L.portalHash?1:-1));let T=0,C=0;for(;T!==a.length&&C!==r.length;){const k=a[T],L=r[C];k.portalHash>L.hash?T++:L.hash>k.portalHash?C++:(k.type=L.type,T++)}}}isOnBorder(r,a){return r<=0&&a<=0||r>=Ft&&a>=Ft}addFeatureSection(r,a,h,f){return r!==a&&(a=r,h.push({featureIndex:r,vertexStart:f.getVertexCount()}),f.clearVertexLookup()),a}sortSubarray(r,a,h,f){const _=r.slice(a,h);_.sort(f),r.splice(a,_.length,..._)}static computeEdgeHash(r,a){return(r.y===a.y&&r.x>a.x||r.y>a.y)&&([r,a]=[a,r]),BigInt(Pl.computePosHash(r))<<32n|BigInt(Pl.computePosHash(a))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var OI,DI={exports:{}},LI=(OI||(OI=1,(function(l,r){(function(a){function h(xe,be){return xe>be?1:xe<be?-1:0}var f=function(xe,be){xe===void 0&&(xe=h),be===void 0&&(be=!1),this._compare=xe,this._root=null,this._size=0,this._noDuplicates=!!be},_={size:{configurable:!0}};function y(xe,be,it,dt,Zt){var qt=Zt-dt;if(qt>0){var sn=dt+Math.floor(qt/2),Tn={key:be[sn],data:it[sn],parent:xe};return Tn.left=y(Tn,be,it,dt,sn),Tn.right=y(Tn,be,it,sn+1,Zt),Tn}return null}function T(xe,be,it,dt,Zt){if(!(it>=dt)){for(var qt=xe[it+dt>>1],sn=it-1,Tn=dt+1;;){do sn++;while(Zt(xe[sn],qt)<0);do Tn--;while(Zt(xe[Tn],qt)>0);if(sn>=Tn)break;var lr=xe[sn];xe[sn]=xe[Tn],xe[Tn]=lr,lr=be[sn],be[sn]=be[Tn],be[Tn]=lr}T(xe,be,it,Tn,Zt),T(xe,be,Tn+1,dt,Zt)}}f.prototype.rotateLeft=function(xe){var be=xe.right;be&&(xe.right=be.left,be.left&&(be.left.parent=xe),be.parent=xe.parent),xe.parent?xe===xe.parent.left?xe.parent.left=be:xe.parent.right=be:this._root=be,be&&(be.left=xe),xe.parent=be},f.prototype.rotateRight=function(xe){var be=xe.left;be&&(xe.left=be.right,be.right&&(be.right.parent=xe),be.parent=xe.parent),xe.parent?xe===xe.parent.left?xe.parent.left=be:xe.parent.right=be:this._root=be,be&&(be.right=xe),xe.parent=be},f.prototype._splay=function(xe){for(;xe.parent;){var be=xe.parent;be.parent?be.left===xe&&be.parent.left===be?(this.rotateRight(be.parent),this.rotateRight(be)):be.right===xe&&be.parent.right===be?(this.rotateLeft(be.parent),this.rotateLeft(be)):be.left===xe&&be.parent.right===be?(this.rotateRight(be),this.rotateLeft(be)):(this.rotateLeft(be),this.rotateRight(be)):be.left===xe?this.rotateRight(be):this.rotateLeft(be)}},f.prototype.splay=function(xe){for(var be,it,dt,Zt,qt;xe.parent;)(it=(be=xe.parent).parent)&&it.parent?((dt=it.parent).left===it?dt.left=xe:dt.right=xe,xe.parent=dt):(xe.parent=null,this._root=xe),Zt=xe.left,qt=xe.right,xe===be.left?(it&&(it.left===be?(be.right?(it.left=be.right,it.left.parent=it):it.left=null,be.right=it,it.parent=be):(Zt?(it.right=Zt,Zt.parent=it):it.right=null,xe.left=it,it.parent=xe)),qt?(be.left=qt,qt.parent=be):be.left=null,xe.right=be,be.parent=xe):(it&&(it.right===be?(be.left?(it.right=be.left,it.right.parent=it):it.right=null,be.left=it,it.parent=be):(qt?(it.left=qt,qt.parent=it):it.left=null,xe.right=it,it.parent=xe)),Zt?(be.right=Zt,Zt.parent=be):be.right=null,xe.left=be,be.parent=xe)},f.prototype.replace=function(xe,be){xe.parent?xe===xe.parent.left?xe.parent.left=be:xe.parent.right=be:this._root=be,be&&(be.parent=xe.parent)},f.prototype.minNode=function(xe){if(xe===void 0&&(xe=this._root),xe)for(;xe.left;)xe=xe.left;return xe},f.prototype.maxNode=function(xe){if(xe===void 0&&(xe=this._root),xe)for(;xe.right;)xe=xe.right;return xe},f.prototype.insert=function(xe,be){var it=this._root,dt=null,Zt=this._compare;if(this._noDuplicates)for(;it;){if(dt=it,Zt(it.key,xe)===0)return;it=Zt(it.key,xe)<0?it.right:it.left}else for(;it;)dt=it,it=Zt(it.key,xe)<0?it.right:it.left;return it={key:xe,data:be,left:null,right:null,parent:dt},dt?Zt(dt.key,it.key)<0?dt.right=it:dt.left=it:this._root=it,this.splay(it),this._size++,it},f.prototype.find=function(xe){for(var be=this._root,it=this._compare;be;){var dt=it(be.key,xe);if(dt<0)be=be.right;else{if(!(dt>0))return be;be=be.left}}return null},f.prototype.contains=function(xe){for(var be=this._root,it=this._compare;be;){var dt=it(xe,be.key);if(dt===0)return!0;be=dt<0?be.left:be.right}return!1},f.prototype.remove=function(xe){var be=this.find(xe);if(!be)return!1;if(this.splay(be),be.left)if(be.right){var it=this.minNode(be.right);it.parent!==be&&(this.replace(it,it.right),it.right=be.right,it.right.parent=it),this.replace(be,it),it.left=be.left,it.left.parent=it}else this.replace(be,be.left);else this.replace(be,be.right);return this._size--,!0},f.prototype.removeNode=function(xe){if(!xe)return!1;if(this.splay(xe),xe.left)if(xe.right){var be=this.minNode(xe.right);be.parent!==xe&&(this.replace(be,be.right),be.right=xe.right,be.right.parent=be),this.replace(xe,be),be.left=xe.left,be.left.parent=be}else this.replace(xe,xe.left);else this.replace(xe,xe.right);return this._size--,!0},f.prototype.erase=function(xe){var be=this.find(xe);if(be){this.splay(be);var it=be.left,dt=be.right,Zt=null;it&&(it.parent=null,Zt=this.maxNode(it),this.splay(Zt),this._root=Zt),dt&&(it?Zt.right=dt:this._root=dt,dt.parent=Zt),this._size--}},f.prototype.pop=function(){var xe=this._root,be=null;if(xe){for(;xe.left;)xe=xe.left;be={key:xe.key,data:xe.data},this.remove(xe.key)}return be},f.prototype.next=function(xe){var be=xe;if(be)if(be.right)for(be=be.right;be&&be.left;)be=be.left;else for(be=xe.parent;be&&be.right===xe;)xe=be,be=be.parent;return be},f.prototype.prev=function(xe){var be=xe;if(be)if(be.left)for(be=be.left;be&&be.right;)be=be.right;else for(be=xe.parent;be&&be.left===xe;)xe=be,be=be.parent;return be},f.prototype.forEach=function(xe){for(var be=this._root,it=[],dt=!1,Zt=0;!dt;)be?(it.push(be),be=be.left):it.length>0?(xe(be=it.pop(),Zt++),be=be.right):dt=!0;return this},f.prototype.range=function(xe,be,it,dt){for(var Zt=[],qt=this._compare,sn=this._root;Zt.length!==0||sn;)if(sn)Zt.push(sn),sn=sn.left;else{if(qt((sn=Zt.pop()).key,be)>0)break;if(qt(sn.key,xe)>=0&&it.call(dt,sn))return this;sn=sn.right}return this},f.prototype.keys=function(){for(var xe=this._root,be=[],it=[],dt=!1;!dt;)xe?(be.push(xe),xe=xe.left):be.length>0?(xe=be.pop(),it.push(xe.key),xe=xe.right):dt=!0;return it},f.prototype.values=function(){for(var xe=this._root,be=[],it=[],dt=!1;!dt;)xe?(be.push(xe),xe=xe.left):be.length>0?(xe=be.pop(),it.push(xe.data),xe=xe.right):dt=!0;return it},f.prototype.at=function(xe){for(var be=this._root,it=[],dt=!1,Zt=0;!dt;)if(be)it.push(be),be=be.left;else if(it.length>0){if(be=it.pop(),Zt===xe)return be;Zt++,be=be.right}else dt=!0;return null},f.prototype.load=function(xe,be,it){if(xe===void 0&&(xe=[]),be===void 0&&(be=[]),it===void 0&&(it=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var dt=xe.length;return it&&T(xe,be,0,dt-1,this._compare),this._root=y(null,xe,be,0,dt),this._size=dt,this},f.prototype.min=function(){var xe=this.minNode(this._root);return xe?xe.key:null},f.prototype.max=function(){var xe=this.maxNode(this._root);return xe?xe.key:null},f.prototype.isEmpty=function(){return this._root===null},_.size.get=function(){return this._size},f.createTree=function(xe,be,it,dt,Zt){return new f(it,Zt).load(xe,be,dt)},Object.defineProperties(f.prototype,_);var C=0,k=1,L=2,j=3,N=0,H=1,W=2,ee=3;function ie(xe,be,it){be===null?(xe.inOut=!1,xe.otherInOut=!0):(xe.isSubject===be.isSubject?(xe.inOut=!be.inOut,xe.otherInOut=be.otherInOut):(xe.inOut=!be.otherInOut,xe.otherInOut=be.isVertical()?!be.inOut:be.inOut),be&&(xe.prevInResult=!se(be,it)||be.isVertical()?be.prevInResult:be));var dt=se(xe,it);xe.resultTransition=dt?(function(Zt,qt){var sn,Tn=!Zt.inOut,lr=!Zt.otherInOut;switch(qt){case N:sn=Tn&&lr;break;case H:sn=Tn||lr;break;case ee:sn=Tn^lr;break;case W:sn=Zt.isSubject?Tn&&!lr:lr&&!Tn}return sn?1:-1})(xe,it):0}function se(xe,be){switch(xe.type){case C:switch(be){case N:return!xe.otherInOut;case H:return xe.otherInOut;case W:return xe.isSubject&&xe.otherInOut||!xe.isSubject&&!xe.otherInOut;case ee:return!0}break;case L:return be===N||be===H;case j:return be===W;case k:return!1}return!1}var fe=function(xe,be,it,dt,Zt){this.left=be,this.point=xe,this.otherEvent=it,this.isSubject=dt,this.type=Zt||C,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},pe={inResult:{configurable:!0}};function _e(xe,be){return xe[0]===be[0]&&xe[1]===be[1]}fe.prototype.isBelow=function(xe){var be=this.point,it=this.otherEvent.point;return this.left?(be[0]-xe[0])*(it[1]-xe[1])-(it[0]-xe[0])*(be[1]-xe[1])>0:(it[0]-xe[0])*(be[1]-xe[1])-(be[0]-xe[0])*(it[1]-xe[1])>0},fe.prototype.isAbove=function(xe){return!this.isBelow(xe)},fe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},pe.inResult.get=function(){return this.resultTransition!==0},fe.prototype.clone=function(){var xe=new fe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return xe.contourId=this.contourId,xe.resultTransition=this.resultTransition,xe.prevInResult=this.prevInResult,xe.isExteriorRing=this.isExteriorRing,xe.inOut=this.inOut,xe.otherInOut=this.otherInOut,xe},Object.defineProperties(fe.prototype,pe);var ke=11102230246251565e-32,Re=134217729,Ne=(3+8*ke)*ke;function Fe(xe,be,it,dt,Zt){var qt,sn,Tn,lr,ur=be[0],sr=dt[0],Vr=0,Ti=0;sr>ur==sr>-ur?(qt=ur,ur=be[++Vr]):(qt=sr,sr=dt[++Ti]);var rr=0;if(Vr<xe&&Ti<it)for(sr>ur==sr>-ur?(Tn=qt-((sn=ur+qt)-ur),ur=be[++Vr]):(Tn=qt-((sn=sr+qt)-sr),sr=dt[++Ti]),qt=sn,Tn!==0&&(Zt[rr++]=Tn);Vr<xe&&Ti<it;)sr>ur==sr>-ur?(Tn=qt-((sn=qt+ur)-(lr=sn-qt))+(ur-lr),ur=be[++Vr]):(Tn=qt-((sn=qt+sr)-(lr=sn-qt))+(sr-lr),sr=dt[++Ti]),qt=sn,Tn!==0&&(Zt[rr++]=Tn);for(;Vr<xe;)Tn=qt-((sn=qt+ur)-(lr=sn-qt))+(ur-lr),ur=be[++Vr],qt=sn,Tn!==0&&(Zt[rr++]=Tn);for(;Ti<it;)Tn=qt-((sn=qt+sr)-(lr=sn-qt))+(sr-lr),sr=dt[++Ti],qt=sn,Tn!==0&&(Zt[rr++]=Tn);return qt===0&&rr!==0||(Zt[rr++]=qt),rr}function Ue(xe){return new Float64Array(xe)}var ft=33306690738754716e-32,We=22204460492503146e-32,mt=11093356479670487e-47,Ct=Ue(4),yt=Ue(8),xt=Ue(12),Rt=Ue(16),ht=Ue(4);function bt(xe,be,it){var dt=(function(Zt,qt,sn,Tn,lr,ur){var sr=(qt-ur)*(sn-lr),Vr=(Zt-lr)*(Tn-ur),Ti=sr-Vr;if(sr===0||Vr===0||sr>0!=Vr>0)return Ti;var rr=Math.abs(sr+Vr);return Math.abs(Ti)>=ft*rr?Ti:-(function(li,qr,jr,gi,_i,ri,ci){var Zr,hr,Yr,Ri,Ln,kr,yi,Ni,xi,_s,Jr,ls,sl,Po,po,ol,Od,ys,Is=li-_i,Io=jr-_i,sa=qr-ri,$o=gi-ri;Ct[0]=(po=(Ni=Is-(yi=(kr=Re*Is)-(kr-Is)))*(_s=$o-(xi=(kr=Re*$o)-(kr-$o)))-((Po=Is*$o)-yi*xi-Ni*xi-yi*_s))-((Jr=po-(Od=(Ni=sa-(yi=(kr=Re*sa)-(kr-sa)))*(_s=Io-(xi=(kr=Re*Io)-(kr-Io)))-((ol=sa*Io)-yi*xi-Ni*xi-yi*_s)))+(Ln=po-Jr))+(Ln-Od),Ct[1]=(sl=Po-((ls=Po+Jr)-(Ln=ls-Po))+(Jr-Ln))-((Jr=sl-ol)+(Ln=sl-Jr))+(Ln-ol),Ct[2]=ls-((ys=ls+Jr)-(Ln=ys-ls))+(Jr-Ln),Ct[3]=ys;var dm=(function(Yge,XR){for(var YR=XR[0],S2=1;S2<4;S2++)YR+=XR[S2];return YR})(0,Ct),Mv=We*ci;if(dm>=Mv||-dm>=Mv||(Zr=li-(Is+(Ln=li-Is))+(Ln-_i),Yr=jr-(Io+(Ln=jr-Io))+(Ln-_i),hr=qr-(sa+(Ln=qr-sa))+(Ln-ri),Ri=gi-($o+(Ln=gi-$o))+(Ln-ri),Zr===0&&hr===0&&Yr===0&&Ri===0)||(Mv=mt*ci+Ne*Math.abs(dm),(dm+=Is*Ri+$o*Zr-(sa*Yr+Io*hr))>=Mv||-dm>=Mv))return dm;ht[0]=(po=(Ni=Zr-(yi=(kr=Re*Zr)-(kr-Zr)))*(_s=$o-(xi=(kr=Re*$o)-(kr-$o)))-((Po=Zr*$o)-yi*xi-Ni*xi-yi*_s))-((Jr=po-(Od=(Ni=hr-(yi=(kr=Re*hr)-(kr-hr)))*(_s=Io-(xi=(kr=Re*Io)-(kr-Io)))-((ol=hr*Io)-yi*xi-Ni*xi-yi*_s)))+(Ln=po-Jr))+(Ln-Od),ht[1]=(sl=Po-((ls=Po+Jr)-(Ln=ls-Po))+(Jr-Ln))-((Jr=sl-ol)+(Ln=sl-Jr))+(Ln-ol),ht[2]=ls-((ys=ls+Jr)-(Ln=ys-ls))+(Jr-Ln),ht[3]=ys;var jH=Fe(4,Ct,4,ht,yt);ht[0]=(po=(Ni=Is-(yi=(kr=Re*Is)-(kr-Is)))*(_s=Ri-(xi=(kr=Re*Ri)-(kr-Ri)))-((Po=Is*Ri)-yi*xi-Ni*xi-yi*_s))-((Jr=po-(Od=(Ni=sa-(yi=(kr=Re*sa)-(kr-sa)))*(_s=Yr-(xi=(kr=Re*Yr)-(kr-Yr)))-((ol=sa*Yr)-yi*xi-Ni*xi-yi*_s)))+(Ln=po-Jr))+(Ln-Od),ht[1]=(sl=Po-((ls=Po+Jr)-(Ln=ls-Po))+(Jr-Ln))-((Jr=sl-ol)+(Ln=sl-Jr))+(Ln-ol),ht[2]=ls-((ys=ls+Jr)-(Ln=ys-ls))+(Jr-Ln),ht[3]=ys;var zH=Fe(jH,yt,4,ht,xt);ht[0]=(po=(Ni=Zr-(yi=(kr=Re*Zr)-(kr-Zr)))*(_s=Ri-(xi=(kr=Re*Ri)-(kr-Ri)))-((Po=Zr*Ri)-yi*xi-Ni*xi-yi*_s))-((Jr=po-(Od=(Ni=hr-(yi=(kr=Re*hr)-(kr-hr)))*(_s=Yr-(xi=(kr=Re*Yr)-(kr-Yr)))-((ol=hr*Yr)-yi*xi-Ni*xi-yi*_s)))+(Ln=po-Jr))+(Ln-Od),ht[1]=(sl=Po-((ls=Po+Jr)-(Ln=ls-Po))+(Jr-Ln))-((Jr=sl-ol)+(Ln=sl-Jr))+(Ln-ol),ht[2]=ls-((ys=ls+Jr)-(Ln=ys-ls))+(Jr-Ln),ht[3]=ys;var NH=Fe(zH,xt,4,ht,Rt);return Rt[NH-1]})(Zt,qt,sn,Tn,lr,ur,rr)})(xe[0],xe[1],be[0],be[1],it[0],it[1]);return dt>0?-1:dt<0?1:0}function st(xe,be){var it=xe.point,dt=be.point;return it[0]>dt[0]?1:it[0]<dt[0]?-1:it[1]!==dt[1]?it[1]>dt[1]?1:-1:(function(Zt,qt,sn,Tn){return Zt.left!==qt.left?Zt.left?1:-1:bt(sn,Zt.otherEvent.point,qt.otherEvent.point)!==0?Zt.isBelow(qt.otherEvent.point)?-1:1:!Zt.isSubject&&qt.isSubject?1:-1})(xe,be,it)}function nt(xe,be,it){var dt=new fe(be,!1,xe,xe.isSubject),Zt=new fe(be,!0,xe.otherEvent,xe.isSubject);return _e(xe.point,xe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",xe),dt.contourId=Zt.contourId=xe.contourId,st(Zt,xe.otherEvent)>0&&(xe.otherEvent.left=!0,Zt.left=!1),xe.otherEvent.otherEvent=Zt,xe.otherEvent=dt,it.push(Zt),it.push(dt),it}function Ot(xe,be){return xe[0]*be[1]-xe[1]*be[0]}function Mt(xe,be){return xe[0]*be[0]+xe[1]*be[1]}function bn(xe,be,it){var dt=(function(lr,ur,sr,Vr,Ti){var rr=[ur[0]-lr[0],ur[1]-lr[1]],li=[Vr[0]-sr[0],Vr[1]-sr[1]];function qr(kr,yi,Ni){return[kr[0]+yi*Ni[0],kr[1]+yi*Ni[1]]}var jr=[sr[0]-lr[0],sr[1]-lr[1]],gi=Ot(rr,li),_i=gi*gi,ri=Mt(rr,rr);if(_i>0){var ci=Ot(jr,li)/gi;if(ci<0||ci>1)return null;var Zr=Ot(jr,rr)/gi;return Zr<0||Zr>1?null:ci===0||ci===1?[qr(lr,ci,rr)]:Zr===0||Zr===1?[qr(sr,Zr,li)]:[qr(lr,ci,rr)]}if((_i=(gi=Ot(jr,rr))*gi)>0)return null;var hr=Mt(rr,jr)/ri,Yr=hr+Mt(rr,li)/ri,Ri=Math.min(hr,Yr),Ln=Math.max(hr,Yr);return Ri<=1&&Ln>=0?Ri===1?[qr(lr,Ri>0?Ri:0,rr)]:Ln===0?[qr(lr,Ln<1?Ln:1,rr)]:[qr(lr,Ri>0?Ri:0,rr),qr(lr,Ln<1?Ln:1,rr)]:null})(xe.point,xe.otherEvent.point,be.point,be.otherEvent.point),Zt=dt?dt.length:0;if(Zt===0||Zt===1&&(_e(xe.point,be.point)||_e(xe.otherEvent.point,be.otherEvent.point))||Zt===2&&xe.isSubject===be.isSubject)return 0;if(Zt===1)return _e(xe.point,dt[0])||_e(xe.otherEvent.point,dt[0])||nt(xe,dt[0],it),_e(be.point,dt[0])||_e(be.otherEvent.point,dt[0])||nt(be,dt[0],it),1;var qt=[],sn=!1,Tn=!1;return _e(xe.point,be.point)?sn=!0:st(xe,be)===1?qt.push(be,xe):qt.push(xe,be),_e(xe.otherEvent.point,be.otherEvent.point)?Tn=!0:st(xe.otherEvent,be.otherEvent)===1?qt.push(be.otherEvent,xe.otherEvent):qt.push(xe.otherEvent,be.otherEvent),sn&&Tn||sn?(be.type=k,xe.type=be.inOut===xe.inOut?L:j,sn&&!Tn&&nt(qt[1].otherEvent,qt[0].point,it),2):Tn?(nt(qt[0],qt[1].point,it),3):qt[0]!==qt[3].otherEvent?(nt(qt[0],qt[1].point,it),nt(qt[1],qt[2].point,it),3):(nt(qt[0],qt[1].point,it),nt(qt[3].otherEvent,qt[2].point,it),3)}function rn(xe,be){if(xe===be)return 0;if(bt(xe.point,xe.otherEvent.point,be.point)!==0||bt(xe.point,xe.otherEvent.point,be.otherEvent.point)!==0)return _e(xe.point,be.point)?xe.isBelow(be.otherEvent.point)?-1:1:xe.point[0]===be.point[0]?xe.point[1]<be.point[1]?-1:1:st(xe,be)===1?be.isAbove(xe.point)?-1:1:xe.isBelow(be.point)?-1:1;if(xe.isSubject!==be.isSubject)return xe.isSubject?-1:1;var it=xe.point,dt=be.point;return it[0]===dt[0]&&it[1]===dt[1]?(it=xe.otherEvent.point)[0]===(dt=be.otherEvent.point)[0]&&it[1]===dt[1]?0:xe.contourId>be.contourId?1:-1:st(xe,be)===1?1:-1}var fn=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ut(xe,be,it,dt){var Zt,qt=xe+1,sn=be[xe].point,Tn=be.length;for(qt<Tn&&(Zt=be[qt].point);qt<Tn&&Zt[0]===sn[0]&&Zt[1]===sn[1];){if(!it[qt])return qt;++qt<Tn&&(Zt=be[qt].point)}for(qt=xe-1;it[qt]&&qt>dt;)qt--;return qt}fn.prototype.isExterior=function(){return this.holeOf==null};var xn=Yt,Nn=Yt;function Yt(xe,be){if(!(this instanceof Yt))return new Yt(xe,be);if(this.data=xe||[],this.length=this.data.length,this.compare=be||mn,this.length>0)for(var it=(this.length>>1)-1;it>=0;it--)this._down(it)}function mn(xe,be){return xe<be?-1:xe>be?1:0}Yt.prototype={push:function(xe){this.data.push(xe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var xe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),xe}},peek:function(){return this.data[0]},_up:function(xe){for(var be=this.data,it=this.compare,dt=be[xe];xe>0;){var Zt=xe-1>>1,qt=be[Zt];if(it(dt,qt)>=0)break;be[xe]=qt,xe=Zt}be[xe]=dt},_down:function(xe){for(var be=this.data,it=this.compare,dt=this.length>>1,Zt=be[xe];xe<dt;){var qt=1+(xe<<1),sn=qt+1,Tn=be[qt];if(sn<this.length&&it(be[sn],Tn)<0&&(qt=sn,Tn=be[sn]),it(Tn,Zt)>=0)break;be[xe]=Tn,xe=qt}be[xe]=Zt}},xn.default=Nn;var On=Math.max,Vn=Math.min,ar=0;function Jn(xe,be,it,dt,Zt,qt){var sn,Tn,lr,ur,sr,Vr;for(sn=0,Tn=xe.length-1;sn<Tn;sn++)if(ur=xe[sn+1],sr=new fe(lr=xe[sn],!1,void 0,be),Vr=new fe(ur,!1,sr,be),sr.otherEvent=Vr,lr[0]!==ur[0]||lr[1]!==ur[1]){sr.contourId=Vr.contourId=it,qt||(sr.isExteriorRing=!1,Vr.isExteriorRing=!1),st(sr,Vr)>0?Vr.left=!0:sr.left=!0;var Ti=lr[0],rr=lr[1];Zt[0]=Vn(Zt[0],Ti),Zt[1]=Vn(Zt[1],rr),Zt[2]=On(Zt[2],Ti),Zt[3]=On(Zt[3],rr),dt.push(sr),dt.push(Vr)}}var on=[];function qn(xe,be,it){typeof xe[0][0][0]=="number"&&(xe=[xe]),typeof be[0][0][0]=="number"&&(be=[be]);var dt=(function(rr,li,qr){var jr=null;return rr.length*li.length==0&&(qr===N?jr=on:qr===W?jr=rr:qr!==H&&qr!==ee||(jr=rr.length===0?li:rr)),jr})(xe,be,it);if(dt)return dt===on?null:dt;var Zt=[1/0,1/0,-1/0,-1/0],qt=[1/0,1/0,-1/0,-1/0],sn=(function(rr,li,qr,jr,gi){var _i,ri,ci,Zr,hr,Yr,Ri=new xn(null,st);for(ci=0,Zr=rr.length;ci<Zr;ci++)for(hr=0,Yr=(_i=rr[ci]).length;hr<Yr;hr++)(ri=hr===0)&&ar++,Jn(_i[hr],!0,ar,Ri,qr,ri);for(ci=0,Zr=li.length;ci<Zr;ci++)for(hr=0,Yr=(_i=li[ci]).length;hr<Yr;hr++)ri=hr===0,gi===W&&(ri=!1),ri&&ar++,Jn(_i[hr],!1,ar,Ri,jr,ri);return Ri})(xe,be,Zt,qt,it);if(dt=(function(rr,li,qr,jr,gi){var _i=null;return(qr[0]>jr[2]||jr[0]>qr[2]||qr[1]>jr[3]||jr[1]>qr[3])&&(gi===N?_i=on:gi===W?_i=rr:gi!==H&&gi!==ee||(_i=rr.concat(li))),_i})(xe,be,Zt,qt,it))return dt===on?null:dt;for(var Tn=(function(rr){var li,qr,jr=(function(ci){var Zr,hr,Yr,Ri,Ln=[];for(hr=0,Yr=ci.length;hr<Yr;hr++)((Zr=ci[hr]).left&&Zr.inResult||!Zr.left&&Zr.otherEvent.inResult)&&Ln.push(Zr);for(var kr=!1;!kr;)for(kr=!0,hr=0,Yr=Ln.length;hr<Yr;hr++)hr+1<Yr&&st(Ln[hr],Ln[hr+1])===1&&(Ri=Ln[hr],Ln[hr]=Ln[hr+1],Ln[hr+1]=Ri,kr=!1);for(hr=0,Yr=Ln.length;hr<Yr;hr++)(Zr=Ln[hr]).otherPos=hr;for(hr=0,Yr=Ln.length;hr<Yr;hr++)(Zr=Ln[hr]).left||(Ri=Zr.otherPos,Zr.otherPos=Zr.otherEvent.otherPos,Zr.otherEvent.otherPos=Ri);return Ln})(rr),gi={},_i=[],ri=function(){if(!gi[li]){var ci=_i.length,Zr=(function(Ln,kr,yi){var Ni=new fn;if(Ln.prevInResult!=null){var xi=Ln.prevInResult,_s=xi.outputContourId;if(xi.resultTransition>0){var Jr=kr[_s];if(Jr.holeOf!=null){var ls=Jr.holeOf;kr[ls].holeIds.push(yi),Ni.holeOf=ls,Ni.depth=kr[_s].depth}else kr[_s].holeIds.push(yi),Ni.holeOf=_s,Ni.depth=kr[_s].depth+1}else Ni.holeOf=null,Ni.depth=kr[_s].depth}else Ni.holeOf=null,Ni.depth=0;return Ni})(jr[li],_i,ci),hr=function(Ln){gi[Ln]=!0,Ln<jr.length&&jr[Ln]&&(jr[Ln].outputContourId=ci)},Yr=li,Ri=li;for(Zr.points.push(jr[li].point);hr(Yr),hr(Yr=jr[Yr].otherPos),Zr.points.push(jr[Yr].point),!((Yr=Ut(Yr,jr,gi,Ri))==Ri||Yr>=jr.length)&&jr[Yr];);_i.push(Zr)}};for(li=0,qr=jr.length;li<qr;li++)ri();return _i})((function(rr,li,qr,jr,gi,_i){for(var ri,ci,Zr,hr=new f(rn),Yr=[],Ri=Math.min(jr[2],gi[2]);rr.length!==0;){var Ln=rr.pop();if(Yr.push(Ln),_i===N&&Ln.point[0]>Ri||_i===W&&Ln.point[0]>jr[2])break;if(Ln.left){ci=ri=hr.insert(Ln),ri=ri!==(Zr=hr.minNode())?hr.prev(ri):null,ci=hr.next(ci);var kr=ri?ri.key:null;if(ie(Ln,kr,_i),ci&&bn(Ln,ci.key,rr)===2&&(ie(Ln,kr,_i),ie(ci.key,Ln,_i)),ri&&bn(ri.key,Ln,rr)===2){var yi=ri;ie(kr,(yi=yi!==Zr?hr.prev(yi):null)?yi.key:null,_i),ie(Ln,kr,_i)}}else ci=ri=hr.find(Ln=Ln.otherEvent),ri&&ci&&(ri=ri!==Zr?hr.prev(ri):null,ci=hr.next(ci),hr.remove(Ln),ci&&ri&&bn(ri.key,ci.key,rr))}return Yr})(sn,0,0,Zt,qt,it)),lr=[],ur=0;ur<Tn.length;ur++){var sr=Tn[ur];if(sr.isExterior()){for(var Vr=[sr.points],Ti=0;Ti<sr.holeIds.length;Ti++)Vr.push(Tn[sr.holeIds[Ti]].points);lr.push(Vr)}}return lr}var Er={UNION:H,DIFFERENCE:W,INTERSECTION:N,XOR:ee};a.diff=function(xe,be){return qn(xe,be,W)},a.intersection=function(xe,be){return qn(xe,be,N)},a.operations=Er,a.union=function(xe,be){return qn(xe,be,H)},a.xor=function(xe,be){return qn(xe,be,ee)},Object.defineProperty(a,"__esModule",{value:!0})})(r)})(0,DI.exports)),DI.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function f0(l,r,a,h){const f=[],_=h===0?(y,T,C,k,L,j)=>{y.push(new It(j,C+(j-T)/(k-T)*(L-C)))}:(y,T,C,k,L,j)=>{y.push(new It(T+(j-C)/(L-C)*(k-T),j))};for(const y of l){const T=[];for(const C of y){if(C.length<=2)continue;const k=[];for(let N=0;N<C.length-1;N++){const H=C[N].x,W=C[N].y,ee=C[N+1].x,ie=C[N+1].y,se=h===0?H:W,fe=h===0?ee:ie;se<r?fe>r&&_(k,H,W,ee,ie,r):se>a?fe<a&&_(k,H,W,ee,ie,a):k.push(C[N]),fe<r&&se>=r&&_(k,H,W,ee,ie,r),fe>a&&se<=a&&_(k,H,W,ee,ie,a)}let L=C[C.length-1];const j=h===0?L.x:L.y;j>=r&&j<=a&&k.push(L),k.length&&(L=k[k.length-1],k[0].x===L.x&&k[0].y===L.y||k.push(k[0]),T.push(k))}T.length&&f.push(T)}return f}function O6(l,r){const a=yS(l),h=yS([r]),f=LI.intersection(a,h);return f==null?[]:jI(f)}function D6(l,r){let h=yS(l,65536);const f=[];for(;r.valid();r.next()){const[_,y]=r.get(),T=_.x*65536,C=_.y*65536,k=y.x*65536,L=y.y*65536,j=k-T,N=L-C,H=Math.hypot(j,N);if(H===0)continue;const W=Math.trunc(N/H*3),ee=-Math.trunc(j/H*3);f.push([[[T,C],[k,L],[k+W,L+ee],[T+W,C+ee],[T,C]]])}return f.length>0&&(h=LI.diff(h,f)),jI(h,1/65536)}function yS(l,r=1){return[l.map((a=>a.map((h=>[h.x*r,h.y*r]))))]}function jI(l,r=1){return l.map((a=>a.map(((h,f)=>{const _=h.map((y=>new It(y[0]*r,y[1]*r).round()));return f>0&&_.reverse(),_}))))}class vS{constructor(r,a){this.layoutVertexArray=new Ac,this.indexArray=new ss,this.lineIndexArray=new is,this.triangleSegments=new Rr,this.lineSegments=new Rr,this.programConfigurations=new rl(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new uu)}update(r,a,h,f,_,y,T,C){this.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T,C)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,y6.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,v6.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,a,h,f,_,y,T){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,a,h,f,_,y,void 0,T)}}class xS{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new vS(r,!1),this.elevationBufferData=new vS(r,!0),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview}updateFootprints(r,a){}populate(r,a,h,f){this.hasPattern=gS("fill",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:C,index:k,sourceLayerIndex:L}of r){const j=this.layers[0]._featureFilter.needGeometry,N=Pt(T,j);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{worldview:this.worldview}),N,h))continue;const H=_?_.evaluate(N,{},h,a.availableImages):void 0,W={id:C,properties:T.properties,type:T.type,sourceLayerIndex:L,index:k,geometry:j?N.geometry:Gt(T,h,f),patterns:{},sortKey:H};y.push(W)}_&&y.sort(((T,C)=>T.sortKey-C.sortKey));for(const T of y){const{geometry:C,index:k,sourceLayerIndex:L}=T;if(this.hasPattern){const j=_S("fill",this.layers,T,this.zoom,this.pixelRatio,a);this.patternFeatures.push(j)}else this.addFeature(T,C,k,h,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(r[k].feature,C,k,L,this.index)}}update(r,a,h,f,_,y,T){this.bufferData.update(r,a,h,f,_,y,T,this.worldview),this.elevationBufferData.update(r,a,h,f,_,y,T,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,a,h,f,_,y,T,this.worldview)}addFeatures(r,a,h,f,_,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,a,h,f,y,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,a,h,f,_,y=[],T,C){const k=Qy(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,k,f,h,C):this.addGeometry(k,this.bufferData),this.bufferData.populatePaintArrays(r,h,_,y,f,T,this.worldview),this.elevationBufferData.populatePaintArrays(r,h,_,y,f,T,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,a,h,f,_){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(a,h,f,_,this.worldview))}addElevatedRoadFeature(r,a,h,f,_){const y=new Array,T=ai.getElevationFeature(r,_);if(!T)return void this.addGeometry(a,this.bufferData);{const k=this.clipPolygonsToTile(a,1);k.length>0&&y.push({polygons:k,elevationFeature:T,elevationTileID:h})}const C={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},h),featureIndex:f};for(const k of y)if(k.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Pl(k.elevationTileID,this.layers,this.zoom,this.lut));const j=k.elevationFeature.isTunnel();let N=0;r.properties.hasOwnProperty(Fr)&&(N=+r.properties[Fr]);for(const H of k.polygons)this.elevatedStructures.addPortalCandidates(k.elevationFeature.id,H,j,k.elevationFeature,N)}k.elevationFeature.constantHeight==null&&(k.polygons=this.prepareElevatedPolygons(k.polygons,k.elevationFeature,k.elevationTileID));const L=new Zi(h,k.elevationTileID);this.addElevatedGeometry(k.polygons,L,k.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,f,C)}}addElevatedGeometry(r,a,h,f,_,y){const T={elevation:h,elevationSampler:a,bias:f,index:_,featureInfo:y},[C,k]=this.addGeometry(r,this.elevationBufferData,T);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:C,max:k}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,k))}addGeometry(r,a,h){let f=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,y=null;h&&(y=h.elevationSampler.constantElevation(h.elevation,h.bias),y!=null&&(f=y,_=y));const T=(C,k,L)=>{if(h!=null)if(k.push(C),y!=null)a.elevatedLayoutVertexArray.emplaceBack(y),L.push(y);else{const j=h.elevationSampler.pointElevation(C,h.elevation,h.bias);a.elevatedLayoutVertexArray.emplaceBack(j),L.push(j),f=Math.min(f,j),_=Math.max(_,j)}};for(const C of r){let k=0;for(const pe of C)k+=pe.length;const L=a.triangleSegments.prepareSegment(k,a.layoutVertexArray,a.indexArray),j=L.vertexLength,N=[],H=[],W=[],ee=[],ie=[],se=a.layoutVertexArray.length;for(const pe of C){if(pe.length===0)continue;pe!==C[0]&&H.push(N.length/2);const _e=a.lineSegments.prepareSegment(pe.length,a.layoutVertexArray,a.lineIndexArray),ke=_e.vertexLength;h&&ie.push(a.layoutVertexArray.length-se),T(pe[0],W,ee),a.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),a.lineIndexArray.emplaceBack(ke+pe.length-1,ke),N.push(pe[0].x),N.push(pe[0].y);for(let Re=1;Re<pe.length;Re++)T(pe[Re],W,ee),a.layoutVertexArray.emplaceBack(pe[Re].x,pe[Re].y),a.lineIndexArray.emplaceBack(ke+Re-1,ke+Re),N.push(pe[Re].x),N.push(pe[Re].y);_e.vertexLength+=pe.length,_e.primitiveLength+=pe.length}const fe=D_(N,H);for(let pe=0;pe<fe.length;pe+=3)a.indexArray.emplaceBack(j+fe[pe],j+fe[pe+1],j+fe[pe+2]);if(fe.length>0&&h&&this.elevationMode==="hd-road-base"){const pe=h.elevation.isTunnel(),_e=h.elevation.safeArea,ke=this.elevatedStructures.addVertices(W,ee);this.elevatedStructures.addTriangles(fe,ke,pe);const Re=ie.length;if(Re>0){for(let Ne=0;Ne<Re-1;Ne++)this.elevatedStructures.addRenderableRing(h.index,ie[Ne]+ke,ie[Ne+1]-ie[Ne],pe,_e,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,ie[Re-1]+ke,W.length-ie[Re-1],pe,_e,h.featureInfo)}}L.vertexLength+=k,L.primitiveLength+=fe.length/3}return[f,_]}prepareElevatedPolygons(r,a,h){const f=1/Xe(h),_=[];for(const y of r){const T=D6(y,new Br(a,f));_.push(...T)}return _}clipPolygonsToTile(r,a){const h=-a,f=-a,_=Ft+a,y=Ft+a;let T=0;const C=[],k=[];for(;T<r.length;T++){const N=r[T],H=kp(N);(H.min.x>=h&&H.max.x<=_&&H.min.y>=f&&H.max.y<=y?C:k).push(N)}if(C.length===r.length)return r;const L=[new It(h,f),new It(_,f),new It(_,y),new It(h,y),new It(h,f)],j=C;for(const N of k)j.push(...O6(N,L));return j}}let zI,NI,FI,BI;nn(xS,"FillBucket",{omit:["layers","patternFeatures"]}),nn(vS,"FillBufferData"),nn(Pl,"ElevatedStructures");class p0{constructor(r,a,h,f){if(this.triangleCount=a.length/3,this.min=new It(0,0),this.max=new It(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[_,y]=[r[0].clone(),r[0].clone()];for(let j=1;j<r.length;++j){const N=r[j];_.x=Math.min(_.x,N.x),_.y=Math.min(_.y,N.y),y.x=Math.max(y.x,N.x),y.y=Math.max(y.y,N.y)}if(f){const j=Math.ceil(Math.max(y.x-_.x,y.y-_.y)/f);h=Math.max(h,j)}if(h===0)return;this.min=_,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const C=Math.max(T.x,T.y)/h;this.cellsX=Math.max(1,Math.ceil(T.x/C)),this.cellsY=Math.max(1,Math.ceil(T.y/C)),this.xScale=1/C,this.yScale=1/C;const k=[];for(let j=0;j<this.triangleCount;j++){const N=r[a[3*j+0]].sub(this.min),H=r[a[3*j+1]].sub(this.min),W=r[a[3*j+2]].sub(this.min),ee=kd(Math.floor(Math.min(N.x,H.x,W.x)),this.xScale,this.cellsX),ie=kd(Math.floor(Math.max(N.x,H.x,W.x)),this.xScale,this.cellsX),se=kd(Math.floor(Math.min(N.y,H.y,W.y)),this.yScale,this.cellsY),fe=kd(Math.floor(Math.max(N.y,H.y,W.y)),this.yScale,this.cellsY),pe=new It(0,0),_e=new It(0,0),ke=new It(0,0),Re=new It(0,0);for(let Ne=se;Ne<=fe;++Ne){pe.y=_e.y=Ne*C,ke.y=Re.y=(Ne+1)*C;for(let Fe=ee;Fe<=ie;++Fe)pe.x=ke.x=Fe*C,_e.x=Re.x=(Fe+1)*C,(Xl(N,H,W,pe,_e,Re)||Xl(N,H,W,pe,Re,ke))&&k.push({cellIdx:Ne*this.cellsX+Fe,triIdx:j})}}if(k.length===0)return;k.sort(((j,N)=>j.cellIdx-N.cellIdx||j.triIdx-N.triIdx));let L=0;for(;L<k.length;){const j=k[L].cellIdx,N={start:this.payload.length,len:0};for(;L<k.length&&k[L].cellIdx===j;)++N.len,this.payload.push(k[L++].triIdx);this.cells[j]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,a){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const h=kd(r.x-this.min.x,this.xScale,this.cellsX),f=kd(r.y-this.min.y,this.yScale,this.cellsY),_=this.cells[f*this.cellsX+h];if(_){this._lazyInitLookup();for(let y=0;y<_.len;y++){const T=this.payload[_.start+y],C=Math.floor(T/8),k=1<<T%8;if(!(this.lookup[C]&k)&&(this.lookup[C]|=k,a.push(T),a.length===this.triangleCount))return}}}query(r,a,h){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>a.x||r.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const f=kd(r.x-this.min.x,this.xScale,this.cellsX),_=kd(a.x-this.min.x,this.xScale,this.cellsX),y=kd(r.y-this.min.y,this.yScale,this.cellsY),T=kd(a.y-this.min.y,this.yScale,this.cellsY);for(let C=y;C<=T;C++)for(let k=f;k<=_;k++){const L=this.cells[C*this.cellsX+k];if(L)for(let j=0;j<L.len;j++){const N=this.payload[L.start+j],H=Math.floor(N/8),W=1<<N%8;if(!(this.lookup[H]&W)&&(this.lookup[H]|=W,h.push(N),h.length===this.triangleCount))return}}}}function kd(l,r,a){return Math.max(0,Math.min(a-1,Math.floor(l*r)))}nn(p0,"TriangleGridIndex");class UI{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.footprints=[],this.worldview=r.worldview}updateFootprints(r,a){for(const h of this.footprints)a.push({footprint:h,id:r})}populate(r,a,h,f){const _=[];for(const{feature:y,id:T,index:C,sourceLayerIndex:k}of r){const L=this.layers[0]._featureFilter.needGeometry,j=Pt(y,L);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{worldview:this.worldview}),j,h))continue;const N={id:T,properties:y.properties,type:y.type,sourceLayerIndex:k,index:C,geometry:L?j.geometry:Gt(y,h,f),patterns:{}};_.push(N)}for(const y of _){const{geometry:T,index:C,sourceLayerIndex:k}=y;this.addFeature(y,T,C,h,{},a.availableImages,a.brightness),a.featureIndex.insert(r[C].feature,T,C,k,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,a,h,f,_,y,T){}destroy(){}addFeature(r,a,h,f,_,y=[],T){for(const C of Qy(a,2)){const k=[],L=[],j=[],N=new It(1/0,1/0),H=new It(-1/0,-1/0);for(const ie of C)if(ie.length!==0){ie!==C[0]&&j.push(L.length/2);for(let se=0;se<ie.length;se++)L.push(ie[se].x),L.push(ie[se].y),k.push(ie[se]),N.x=Math.min(N.x,ie[se].x),N.y=Math.min(N.y,ie[se].y),H.x=Math.max(H.x,ie[se].x),H.y=Math.max(H.y,ie[se].y)}const W=D_(L,j),ee=new p0(k,W,8,256);this.footprints.push({vertices:k,indices:W,grid:ee,min:N,max:H})}}}nn(UI,"ClipBucket",{omit:["layers"]});const L6=vr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),j6=vr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),z6=vr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),N6=vr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),F6=vr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),B6=vr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:U6}=L6,ev=Number.MAX_SAFE_INTEGER,VI=ev-1;function $I(l,r,a,h){return l.order<r||l.order===ev||!(l.clipMask&a)||(function(f,_){return _.length!==0&&_.find((y=>y===f))===void 0})(h,l.clipScope)}function m0(l,r){return l.x-r.x||l.y-r.y}function HI(l,r){return m0(l.min,r.min)===0&&m0(l.max,r.max)===0}function bS(l,r){return!(l.min.x>r.max.x||l.max.x<r.min.x||l.min.y>r.max.y||l.max.y<r.min.y)}function g0(l,r){if(l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(l[a].sourceId!==r[a].sourceId||!HI(l[a],r[a])||l[a].order!==r[a].order||l[a].clipMask!==r[a].clipMask||!Dl(l[a].clipScope,r[a].clipScope))return!1;return!0}function GI(l,r,a){const h=1/Ft,f=1/(1<<a.canonical.z),_=(r.x*h+a.canonical.x)*f+a.wrap,y=(r.y*h+a.canonical.y)*f;return{min:new It((l.x*h+a.canonical.x)*f+a.wrap,(l.y*h+a.canonical.y)*f),max:new It(_,y)}}function V6(l,r,a){const h=1<<a.canonical.z,f=((r.x-a.wrap)*h-a.canonical.x)*Ft,_=(r.y*h-a.canonical.y)*Ft;return{min:new It(((l.x-a.wrap)*h-a.canonical.x)*Ft,(l.y*h-a.canonical.y)*Ft),max:new It(f,_)}}function wS(l,r,a,h,f,_,y){const T=l.indices,C=l.vertices,k=[];for(let L=h;L<h+f;L+=3){const j=r[a[L+0]+_],N=r[a[L+1]+_],H=r[a[L+2]+_],W=Math.min(j.x,N.x,H.x),ee=Math.max(j.x,N.x,H.x),ie=Math.min(j.y,N.y,H.y),se=Math.max(j.y,N.y,H.y);k.length=0,l.grid.query(new It(W,ie),new It(ee,se),k);for(let fe=0;fe<k.length;fe++){const pe=k[fe];if(Xl(C[T[3*pe+0]],C[T[3*pe+1]],C[T[3*pe+2]],j,N,H,y))return!0}}return!1}function WI(l,r,a,h){if(!l||!a)return!1;let f=l.vertices;if(!r.canonical.equals(h.canonical)||r.wrap!==h.wrap){if(a.vertices.length<l.vertices.length)return WI(a,h,l,r);const _=r.canonical,y=h.canonical,T=Math.pow(2,y.z-_.z);f=l.vertices.map((C=>new It((C.x+_.x*Ft)*T-y.x*Ft,(C.y+_.y*Ft)*T-y.y*Ft)))}return wS(a,f,l.indices,0,l.indices.length,0,0)}function qI(l,r,a,h){const f=Math.pow(2,h.z-a.z);return new It((l+a.x*Ft)*f-h.x*Ft,(r+a.y*Ft)*f-h.y*Ft)}function SS(l,r){const a=[];r.grid.queryPoint(l,a);const h=r.indices,f=r.vertices;for(let _=0;_<a.length;_++){const y=a[_];if(Ji([f[h[3*y+0]],f[h[3*y+1]],f[h[3*y+2]]],l))return!0}return!1}const TS=[new It(0,0),new It(Ft,0),new It(Ft,Ft),new It(0,Ft)];function ZI(l,r){const a=[];let h=[];if(!r||l.length<2)return[l];if(l.length===2)return Ps(l[0],l[1],TS)?[l]:[];for(let f=0;f<l.length+2;f++){const _=l[f%l.length],y=l[(f+1)%l.length],T=Ps(f===0?l[l.length-1]:l[(f-1)%l.length],_,TS),C=Ps(_,y,TS),k=T||C;k&&h.push(_),k&&C||h.length>0&&(h.length>1&&a.push(h),h=[])}return h.length>1&&a.push(h),a}const ES=wt.types,$6=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],H6=["fill-extrusion-flood-light-ground-radius"],G6=Math.pow(2,13),W6=Math.pow(2,15)-1,XI=new It(0,1),om=2147483648;function tv(l,r,a,h,f,_,y,T){l.emplaceBack((r<<1)+y,(a<<1)+_,(Math.floor(h*G6)<<1)+f,Math.round(T))}function nv(l,r,a){l.emplaceBack(r.x*Ft,r.y*Ft,a?1:0)}function _0(l,r,a,h,f,_){l.emplaceBack(r.x,r.y,(a.x<<1)+h,(a.y<<1)+f,_)}function rv(l,r,a){l.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}class YI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class KI{constructor(){this.centroidXY=new It(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new It(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new It(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new It(this.max.x-this.min.x,this.max.y-this.min.y)}}class JI{constructor(){this.acc=new It(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,a){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=a.x,r.min.y=r.max.y=a.y)}appendEdge(r,a,h){this.accCount++,this.acc._add(a);let f=!!this.borders;a.x<r.min.x?(r.min.x=a.x,f=!0):a.x>r.max.x&&(r.max.x=a.x,f=!0),a.y<r.min.y?(r.min.y=a.y,f=!0):a.y>r.max.y&&(r.max.y=a.y,f=!0),((a.x===0||a.x===Ft)&&a.x===h.x)!=((a.y===0||a.y===Ft)&&a.y===h.y)&&this.processBorderOverlap(a,h),f&&this.checkBorderIntersection(a,h)}checkBorderIntersection(r,a){a.x<0!=r.x<0&&this.addBorderIntersection(0,An(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>Ft!=r.x>Ft&&this.addBorderIntersection(1,An(a.y,r.y,(Ft-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,An(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>Ft!=r.y>Ft&&this.addBorderIntersection(3,An(a.x,r.x,(Ft-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];a<h[0]&&(h[0]=a),a>h[1]&&(h[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,a.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,a.x),this.addBorderIntersection(h,r.x)}}centroid(){return this.accCount===0?new It(0,0):new It(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((r,a)=>r+ +(a[0]!==Number.MAX_VALUE)),0):0}}function QI(l,r){const a=l.add(r)._unit(),h=Oe(l.x*a.x+l.y*a.y,-1,1);var f,_,y;return f=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(f)))/4*W6*((_=l).x*(y=r).y-_.y*y.x<0?-1:1)}const q6=[l=>l.x<0,l=>l.x>Ft,l=>l.y<0,l=>l.y>Ft];function Z6(l,r,a,h){const f=[4];if(h===0)return f;a._mult(h);const _=l.sub(a),y=r.sub(a),T=[l,r,_,y];for(let C=0;C<4;C++)for(const k of T)if(q6[C](k)){f.push(C);break}return f}class AS{constructor(r){this.vertexArray=new Aa,this.indexArray=new ss,this.programConfigurations=new rl(r.layers,{zoom:r.zoom,lut:r.lut},(a=>H6.includes(a))),this._segments=new Rr,this.hiddenByLandmarkVertexArray=new Pd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Rr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,a,h,f=!1){const _=r.length;if(_>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let C;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const k=r[0],L=r[1];C=QI(k.sub(r[_-1])._perp()._unit(),L.sub(k)._perp()._unit())}for(let k=0;k<_;k++){const L=k===_-1?0:k+1,j=r[k],N=r[L],H=r[L===_-1?0:L+1],W=N.sub(j)._perp()._unit(),ee=QI(W,H.sub(N)._perp()._unit()),ie=C,se=ee;if(CS(j,N,a)||f&&nM(j,a)&&nM(N,a)){C=ee;continue}const fe=T.vertexLength;_0(this.vertexArray,j,N,1,1,ie),_0(this.vertexArray,j,N,1,0,ie),_0(this.vertexArray,j,N,0,1,se),_0(this.vertexArray,j,N,0,0,se),T.vertexLength+=4;const pe=Z6(j,N,W,h);for(const _e of pe)this._segmentToGroundQuads[y].push({id:fe,region:_e}),this._segmentToRegionTriCounts[y][_e]+=2,T.primitiveLength+=2;C=ee}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),a=r.length;for(let h=0;h<a;h++)this._segmentToGroundQuads[h].sort(((f,_)=>f.region-_.region));for(let h=0;h<a;h++){const f=this._segmentToGroundQuads[h],_=r[h],y=this._segmentToRegionTriCounts[h];y.reduce(((C,k)=>C+k),0);let T=0;for(let C=0;C<=4;C++){const k=y[C];if(k!==0){let L=this.regionSegments[C];L||(L=this.regionSegments[C]=new Rr);const j={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+T,vertexLength:_.vertexLength,primitiveLength:k};L.get().push(j)}T+=k}for(let C=0;C<f.length;C++){const k=f[C].id;this.indexArray.emplaceBack(k,k+1,k+3),this.indexArray.emplaceBack(k,k+3,k+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,a,h,f,_,y,T){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,a,h,f,_,y,void 0,T)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,j6.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,a,h,f,_,y,T,C){this.hasData()&&this.programConfigurations.updatePaintArrays(r,a,h,f,_,y,T,C)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&om))}updateHiddenByLandmarkRange(r,a,h){if(!this.hasData())return;const f=a+r;if(a!==0){for(let _=r;_<f;++_)this.hiddenByLandmarkVertexArray.emplace(_,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,F6.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const a=this.regionSegments[r];a&&a.destroy()}}}}class y0{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map((a=>a.fqid)),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ss,this.footprintVertices=new Ac,this.footprintSegments=[],this.layoutVertexArray=new Gl,this.centroidVertexArray=new M_,this.wallVertexArray=new rm,this.indexArray=new ss,this.programConfigurations=new rl(r.layers,{zoom:r.zoom,lut:r.lut},(a=>$6.includes(a))),this.segments=new Rr,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.groundEffect=new AS(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview}updateFootprints(r,a){}populate(r,a,h,f){this.features=[],this.hasPattern=gS("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Xe(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:y,index:T,sourceLayerIndex:C}of r){const k=this.layers[0]._featureFilter.needGeometry,L=Pt(_,k);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{worldview:this.worldview}),L,h))continue;const j={id:y,sourceLayerIndex:C,index:T,geometry:k?L.geometry:Gt(_,h,f),properties:_.properties,type:_.type,patterns:{}},N=this.layoutVertexArray.length,H=ES[j.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:_S("fill-extrusion",this.layers,j,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const W of j.geometry)for(const ee of ZI(W,H))this.addFeature(_.id,j,[ee],T,h,{},a.availableImages,f,a.brightness);else this.addFeature(_.id,j,j.geometry,T,h,{},a.availableImages,f,a.brightness);a.featureIndex.insert(_,j.geometry,T,C,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,a,h,f,_,y){for(const{featureId:T,feature:C}of this.features){const k=ES[C.type]==="Polygon",{geometry:L}=C;if(this.wallMode)for(const j of L)for(const N of ZI(j,k))this.addFeature(T,C,[N],C.index,a,h,f,_,y);else this.addFeature(T,C,L,C.index,a,h,f,_,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,a,h,f,_,y,T){this.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T,this.worldview),this.groundEffect.update(r,a,_,h,f,y,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,U6),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,N6.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,B6.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,z6.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,h,f,_,y,T,C,k){const L=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,j=[new It(0,0),new It(Ft,Ft)],N=C.projection,H=N.name==="globe",W=this.wallMode||ES[a.type]==="Polygon",ee=new JI;ee.centroidDataIndex=this.centroidData.length;const ie=new KI;ie.buildingId=r,a.properties&&a.properties.hasOwnProperty("building_id")&&(ie.buildingId=a.properties.building_id);const se=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},_)<=0,fe=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},_);let pe;if(ie.height=fe,ie.vertexArrayOffset=this.layoutVertexArray.length,ie.groundVertexArrayOffset=this.groundEffect.vertexArray.length,H&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new zf),this.wallMode){if(H)return void _r("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;pe=(function(We){const mt=We[0].x===We[We.length-1].x&&We[0].y===We[We.length-1].y;(function(Ut){let xn=0;const Nn=Ut.length;for(let Yt=0;Yt<Nn;Yt++)xn+=(Ut[(Yt+1)%Nn].x-Ut[Yt].x)*(Ut[(Yt+1)%Nn].y+Ut[Yt].y);return xn>=0})(We)||(We=We.reverse());const yt={geometry:[],joinNormals:[],indices:[]},xt=[],Rt=[],ht=[];let bt=We.length;for(;bt>=2&&We[bt-1].equals(We[bt-2]);)bt--;if(bt<(mt?3:2))return yt;let st,nt,Ot,Mt,bn,rn=0;for(;rn<bt-1&&We[rn].equals(We[rn+1]);)rn++;mt&&(st=We[bt-2],bn=We[rn].sub(st)._unit()._perp());for(let Ut=rn;Ut<bt;Ut++){if(Ot=Ut===bt-1?mt?We[rn+1]:void 0:We[Ut+1],Ot&&We[Ut].equals(Ot))continue;bn&&(Mt=bn),st&&(nt=st),st=We[Ut],bn=Ot?Ot.sub(st)._unit()._perp():Mt,Mt=Mt||bn;let xn=Mt.add(bn);xn.x===0&&xn.y===0||xn._unit();const Nn=xn.x*bn.x+xn.y*bn.y,Yt=Nn!==0?1/Nn:1/0,mn=Mt.x*bn.y-Mt.y*bn.x>0;let On="miter";const Vn=2;On==="miter"&&Yt>Vn&&(On="bevel"),On==="bevel"&&(Yt>100&&(On="flipbevel"),Yt<Vn&&(On="miter"));const ar=(Jn,on,qn,Er)=>{const xe=new It(Jn.x,Jn.y),be=new It(Jn.x,Jn.y);xe.x+=on.x*Er,xe.y+=on.y*Er,be.x-=on.x*Math.max(qn,1),be.y-=on.y*Math.max(qn,1),ht.push(on),xt.push(xe),Rt.push(be)};if(On==="miter")xn._mult(Yt),ar(st,xn,0,0);else if(On==="flipbevel")xn=bn.mult(-1),ar(st,xn,0,0),ar(st,xn.mult(-1),0,0);else{const Jn=-Math.sqrt(Yt*Yt-1),on=mn?Jn:0,qn=mn?0:Jn;nt&&ar(st,Mt,on,qn),Ot&&ar(st,bn,on,qn)}}yt.geometry=[...xt,...Rt.reverse(),xt[0]],yt.joinNormals=[...ht,...ht.reverse(),ht[ht.length-1]];const fn=yt.geometry.length-1;for(let Ut=0;Ut<fn/2;Ut++)if(Ut+1<fn/2){let xn=Ut,Nn=Ut+1,Yt=fn-1-Ut,mn=fn-2-Ut;xn=xn===0?fn-1:xn-1,Nn=Nn===0?fn-1:Nn-1,Yt=Yt===0?fn-1:Yt-1,mn=mn===0?fn-1:mn-1,yt.indices.push(Yt),yt.indices.push(Nn),yt.indices.push(xn),yt.indices.push(Yt),yt.indices.push(mn),yt.indices.push(Nn)}return yt})(h[0]),h=[pe.geometry]}const _e=(We,mt)=>We<(mt.length-1)/2||We===mt.length-1,ke=this.wallMode?[h]:Qy(h,500);for(let We=ke.length-1;We>=0;We--){const mt=ke[We];(mt.length===0||(Re=mt[0]).every((Ct=>Ct.x<=0))||Re.every((Ct=>Ct.x>=Ft))||Re.every((Ct=>Ct.y<=0))||Re.every((Ct=>Ct.y>=Ft)))&&ke.splice(We,1)}var Re;let Ne;if(H)Ne=oM(ke,j,_);else{Ne=[];for(const We of ke)Ne.push({polygon:We,bounds:j})}const Fe=W?this.edgeRadius:0,Ue=Fe>0&&this.zoom<17,ft=(We,mt)=>{if(We.length===0)return!1;const Ct=We[We.length-1];return mt.x===Ct.x&&mt.y===Ct.y};for(const{polygon:We,bounds:mt}of Ne){let Ct=0,yt=0;for(const bt of We)W&&!bt[0].equals(bt[bt.length-1])&&bt.push(bt[0]),yt+=W?bt.length-1:bt.length;const xt=this.segments.prepareSegment((W?5:4)*yt,this.layoutVertexArray,this.indexArray);ie.footprintSegIdx<0&&(ie.footprintSegIdx=this.footprintSegments.length),ie.polygonSegIdx<0&&(ie.polygonSegIdx=this.polygonSegments.length);const Rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ht=new YI;if(ht.vertexOffset=this.footprintVertices.length,ht.indexOffset=3*this.footprintIndices.length,ht.ringIndices=[],W){const bt=[],st=[];Ct=xt.vertexLength;for(let Ot=0;Ot<We.length;Ot++){const Mt=We[Ot];Mt.length&&Ot!==0&&st.push(bt.length/2);const bn=[];let rn,fn;rn=Mt[1].sub(Mt[0])._perp()._unit(),ht.ringIndices.push(Mt.length-1);for(let Ut=1;Ut<Mt.length;Ut++){const xn=Mt[Ut],Nn=Mt[Ut===Mt.length-1?1:Ut+1],Yt=xn.clone();if(Fe){fn=Nn.sub(xn)._perp()._unit();const mn=rn.add(fn)._unit(),On=Fe*Math.min(4,1/(rn.x*mn.x+rn.y*mn.y));Yt.x+=On*mn.x,Yt.y+=On*mn.y,Yt.x=Math.round(Yt.x),Yt.y=Math.round(Yt.y),rn=fn}if(!se||Fe!==0&&!Ue||ft(bn,Yt)||bn.push(Yt),tv(this.layoutVertexArray,Yt.x,Yt.y,0,0,1,1,0),this.wallMode){const mn=_e(Ut,Mt);nv(this.wallVertexArray,pe.joinNormals[Ut],!mn)}xt.vertexLength++,this.footprintVertices.emplaceBack(xn.x,xn.y),bt.push(xn.x,xn.y),H&&rv(this.layoutVertexExtArray,N.projectTilePoint(Yt.x,Yt.y,_),N.upVector(_,Yt.x,Yt.y))}se&&(Fe===0||Ue)&&(bn.length!==0&&ft(bn,bn[0])&&bn.pop(),this.groundEffect.addData(bn,mt,L))}const nt=this.wallMode?pe.indices:D_(bt,st);for(let Ot=0;Ot<nt.length;Ot+=3)this.footprintIndices.emplaceBack(ht.vertexOffset+nt[Ot+0],ht.vertexOffset+nt[Ot+1],ht.vertexOffset+nt[Ot+2]),this.indexArray.emplaceBack(Ct+nt[Ot],Ct+nt[Ot+2],Ct+nt[Ot+1]),xt.primitiveLength++;ht.indexCount+=nt.length,ht.vertexCount+=this.footprintVertices.length-ht.vertexOffset}for(let bt=0;bt<We.length;bt++){const st=We[bt];ee.startRing(ie,st[0]);let nt=st.length>4&&rM(st[st.length-2],st[0],st[1]),Ot=Fe?X6(st[st.length-2],st[0],st[1],Fe):0;const Mt=[];let bn,rn,fn;rn=st[1].sub(st[0])._perp()._unit();let Ut=!0;for(let xn=1,Nn=0;xn<st.length;xn++){let Yt=st[xn-1],mn=st[xn];const On=st[xn===st.length-1?1:xn+1];if(ee.appendEdge(ie,mn,Yt),CS(mn,Yt,mt)){Fe&&(rn=On.sub(mn)._perp()._unit(),Ut=!Ut);continue}const Vn=mn.sub(Yt)._perp(),ar=Vn.x/(Math.abs(Vn.x)+Math.abs(Vn.y)),Jn=Vn.y>0?1:0,on=Yt.dist(mn);if(Nn+on>32768&&(Nn=0),Fe){fn=On.sub(mn)._perp()._unit();let be=tM(Yt,mn,On,eM(rn,fn),Fe);isNaN(be)&&(be=0);const it=mn.sub(Yt)._unit();Yt=Yt.add(it.mult(Ot))._round(),mn=mn.add(it.mult(-be))._round(),Ot=be,rn=fn,se&&this.zoom>=17&&(ft(Mt,Yt)||Mt.push(Yt),ft(Mt,mn)||Mt.push(mn))}const qn=xt.vertexLength,Er=st.length>4&&rM(Yt,mn,On);let xe=iM(Nn,nt,Ut);if(tv(this.layoutVertexArray,Yt.x,Yt.y,ar,Jn,0,0,xe),tv(this.layoutVertexArray,Yt.x,Yt.y,ar,Jn,0,1,xe),this.wallMode){const be=_e(xn-1,st),it=pe.joinNormals[xn-1];nv(this.wallVertexArray,it,be),nv(this.wallVertexArray,it,be)}if(Nn+=on,xe=iM(Nn,Er,!Ut),nt=Er,tv(this.layoutVertexArray,mn.x,mn.y,ar,Jn,0,0,xe),tv(this.layoutVertexArray,mn.x,mn.y,ar,Jn,0,1,xe),this.wallMode){const be=_e(xn,st),it=pe.joinNormals[xn];nv(this.wallVertexArray,it,be),nv(this.wallVertexArray,it,be)}if(xt.vertexLength+=4,this.indexArray.emplaceBack(qn+0,qn+1,qn+2),this.indexArray.emplaceBack(qn+1,qn+3,qn+2),xt.primitiveLength+=2,Fe){const be=Ct+(xn===1?st.length-2:xn-2),it=xn===1?Ct:be+1;if(this.indexArray.emplaceBack(qn+1,be,qn+3),this.indexArray.emplaceBack(be,it,qn+3),xt.primitiveLength+=2,bn===void 0&&(bn=qn),!CS(On,st[xn],mt)){const dt=xn===st.length-1?bn:xt.vertexLength;this.indexArray.emplaceBack(qn+2,qn+3,dt),this.indexArray.emplaceBack(qn+3,dt+1,dt),this.indexArray.emplaceBack(qn+3,it,dt+1),xt.primitiveLength+=3}Ut=!Ut}if(H){const be=this.layoutVertexExtArray,it=N.projectTilePoint(Yt.x,Yt.y,_),dt=N.projectTilePoint(mn.x,mn.y,_),Zt=N.upVector(_,Yt.x,Yt.y),qt=N.upVector(_,mn.x,mn.y);rv(be,it,Zt),rv(be,it,Zt),rv(be,dt,qt),rv(be,dt,qt)}}W&&(Ct+=st.length-1),se&&Fe&&this.zoom>=17&&(Mt.length!==0&&ft(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,mt,L,Fe>0))}this.footprintSegments.push(ht),Rt.triangleCount=this.indexArray.length-Rt.triangleArrayOffset,this.polygonSegments.push(Rt),++ie.footprintSegLen,++ie.polygonSegLen}if(ie.vertexCount=this.layoutVertexArray.length-ie.vertexArrayOffset,ie.groundVertexCount=this.groundEffect.vertexArray.length-ie.groundVertexArrayOffset,ie.vertexCount!==0){if(ie.centroidXY=ee.borders?XI:this.encodeCentroid(ee,ie),this.centroidData.push(ie),ee.borders){this.featuresOnBorder.push(ee);const We=this.featuresOnBorder.length-1;for(let mt=0;mt<ee.borders.length;mt++)ee.borders[mt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[mt].push(We)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,y,T,_,k,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,f,y,T,_,k,this.worldview),this.maxHeight=Math.max(this.maxHeight,fe)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort(((a,h)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[h].borders[r][0]))}splitToSubtiles(){const r=[];for(let T=0;T<this.centroidData.length;T++){const C=this.centroidData[T],k=+(C.min.y+C.max.y>Ft),L=2*k+(+(C.min.x+C.max.x>Ft)^k);for(let j=0;j<C.polygonSegLen;j++){const N=C.polygonSegIdx+j;r.push({centroidIdx:T,subtile:L,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const a=new ss;r.sort(((T,C)=>T.triangleSegmentIdx===C.triangleSegmentIdx?T.subtile-C.subtile:T.triangleSegmentIdx-C.triangleSegmentIdx));let h=0,f=0,_=0;for(const T of r){if(T.triangleSegmentIdx!==h)break;_++}const y=r.length;for(;f!==r.length;){h=r[f].triangleSegmentIdx;let T=0,C=f,k=f;for(let L=C;L<_&&r[L].subtile===T;L++)k++;for(;C!==_;){const L=r[C];T=L.subtile;const j=this.centroidData[L.centroidIdx].min.clone(),N=this.centroidData[L.centroidIdx].max.clone(),H={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let W=C;W<k;W++){const ee=r[W],ie=this.polygonSegments[ee.polygonSegmentIdx],se=this.centroidData[ee.centroidIdx].min,fe=this.centroidData[ee.centroidIdx].max,pe=this.indexArray.uint16;for(let _e=ie.triangleArrayOffset;_e<ie.triangleArrayOffset+ie.triangleCount;_e++)a.emplaceBack(pe[3*_e],pe[3*_e+1],pe[3*_e+2]);H.primitiveLength+=ie.triangleCount,j.x=Math.min(j.x,se.x),j.y=Math.min(j.y,se.y),N.x=Math.max(N.x,fe.x),N.y=Math.max(N.y,fe.y)}H.primitiveLength>0&&this.triangleSubSegments.push({segment:H,min:j,max:N}),C=k;for(let W=C;W<_&&r[W].subtile===r[C].subtile;W++)k++}f=_;for(let L=f;L<y&&r[L].triangleSegmentIdx===r[f].triangleSegmentIdx;L++)_++}a._trim(),this.indexArray=a}getVisibleSegments(r,a,h){const f=new Rr;if(this.wallMode){for(const ee of this.triangleSubSegments)f.segments.push(ee.segment);return f}let _=0,y=0;const T=1<<r.canonical.z;if(a){const ee=a.getMinMaxForTile(r);ee&&(_=ee.min,y=ee.max)}y+=this.maxHeight;const C=r.toUnwrapped();let k;const L=[C.canonical.x/T+C.wrap,C.canonical.y/T],j=[(C.canonical.x+1)/T+C.wrap,(C.canonical.y+1)/T],N=(ee,ie,se)=>[ee[0]*(1-se[0])+ie[0]*se[0],ee[1]*(1-se[1])+ie[1]*se[1]],H=[],W=[];for(const ee of this.triangleSubSegments){H[0]=ee.min.x/Ft,H[1]=ee.min.y/Ft,W[0]=ee.max.x/Ft,W[1]=ee.max.y/Ft;const ie=N(L,j,H),se=N(L,j,W);if(new Mn([ie[0],ie[1],_],[se[0],se[1],y]).intersectsPrecise(h)===0){k&&(f.segments.push(k),k=void 0);continue}const fe=ee.segment;k&&k.vertexOffset!==fe.vertexOffset&&(f.segments.push(k),k=void 0),k?(k.vertexLength+=fe.vertexLength,k.primitiveLength+=fe.primitiveLength):k={vertexOffset:fe.vertexOffset,primitiveLength:fe.primitiveLength,vertexLength:fe.vertexLength,primitiveOffset:fe.primitiveOffset,sortKey:void 0,vaos:{}}}return k&&f.segments.push(k),f}encodeCentroid(r,a){const h=r.centroid(),f=a.span(),_=Math.min(7,Math.round(f.x*this.tileToMeter/10)),y=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new It(Oe(h.x,1,Ft-1)<<3|_,Oe(h.y,1,Ft-1)<<3|y)}encodeBorderCentroid(r){if(!r.borders)return new It(0,0);const a=r.borders,h=Number.MAX_VALUE;if(a[0][0]!==h||a[1][0]!==h){const f=a[0][0]!==h?0:1;return new It(6|(a[0][0]!==h?0:65528),(a[f][0]+a[f][1])/2<<3|6)}{const f=a[2][0]!==h?2:3;return new It((a[f][0]+a[f][1])/2<<3|6,6|(a[2][0]!==h?0:65528))}}showCentroid(r){const a=this.centroidData[r.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const a=r.vertexArrayOffset,h=r.vertexCount+r.vertexArrayOffset,f=r.flags&om?XI:r.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==f.y||_!==f.x){for(let y=a;y<h;++y)this.centroidVertexArray.emplace(y,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(r.toUnwrapped());if(g0(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const _=[];for(const y of this.activeReplacements){if(y.order<h)continue;const T=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));if(y.footprint.buildingId){const C=y.footprint.buildingId;for(const k of this.centroidData)k.buildingId===C&&(k.flags|=om)}else for(const C of this.centroidData)if(!(C.flags&om||y.min.x>C.max.x||C.min.x>y.max.x||y.min.y>C.max.y||C.min.y>y.max.y))for(let k=0;k<C.footprintSegLen;k++){const L=this.footprintSegments[C.footprintSegIdx+k];if(_.length=0,Y6(this.footprintVertices,L.vertexOffset,L.vertexCount,y.footprintTileId.canonical,r.canonical,_),wS(y.footprint,_,this.footprintIndices.uint16,L.indexOffset,L.indexCount,-L.vertexOffset,-T)){C.flags|=om;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,a,h){let f=!1;for(let _=0;_<h.footprintSegLen;_++){const y=this.footprintSegments[h.footprintSegIdx+_];let T=0;for(const C of y.ringIndices){for(let k=T,L=C+T-1;k<C+T;L=k++){const j=this.footprintVertices.int16[2*(k+y.vertexOffset)+0],N=this.footprintVertices.int16[2*(k+y.vertexOffset)+1],H=this.footprintVertices.int16[2*(L+y.vertexOffset)+1];N>a!=H>a&&r<(this.footprintVertices.int16[2*(L+y.vertexOffset)+0]-j)*(a-N)/(H-N)+j&&(f=!f)}T=C}}return f}getHeightAtTileCoord(r,a){let h=Number.NEGATIVE_INFINITY,f=!0;const _=4*(r+Ft)*Ft+(a+Ft);if(this.partLookup.hasOwnProperty(_)){const y=this.partLookup[_];return y?{height:y.height,hidden:!!(y.flags&om)}:void 0}for(const y of this.centroidData)r>y.max.x||y.min.x>r||a>y.max.y||y.min.y>a||y.height<=h||this.footprintContainsPoint(r,a,y)&&(h=y.height,this.partLookup[_]=y,f=!!(y.flags&om));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:f};this.partLookup[_]=void 0}}function eM(l,r){const a=l.add(r)._unit();return l.x*a.x+l.y*a.y}function X6(l,r,a,h){const f=r.sub(l)._perp()._unit(),_=a.sub(r)._perp()._unit();return tM(l,r,a,eM(f,_),h)}function tM(l,r,a,h,f){const _=Math.sqrt(1-h*h);return Math.min(l.dist(r)/3,r.dist(a)/3,f*_/h)}function CS(l,r,a){return l.x<a[0].x&&r.x<a[0].x||l.x>a[1].x&&r.x>a[1].x||l.y<a[0].y&&r.y<a[0].y||l.y>a[1].y&&r.y>a[1].y}function nM(l,r){return l.x<r[0].x||l.x>r[1].x||l.y<r[0].y||l.y>r[1].y}function rM(l,r,a){if(l.x<0||l.x>=Ft||r.x<0||r.x>=Ft||a.x<0||a.x>=Ft)return!1;const h=a.sub(r),f=h.perp(),_=l.sub(r);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&f.x*_.x+f.y*_.y<0}function iM(l,r,a){const h=r?2|l:-3&l;return a?1|h:-2&h}function sM(){const l=Math.PI/32,r=Math.tan(l),a=Y;return a*Math.sqrt(1+2*r*r)-a}function oM(l,r,a){const h=1<<a.z,f=Ie(a.x/h),_=Ie((a.x+1)/h),y=Ce(a.y/h),T=Ce((a.y+1)/h);return(function(C,k,L,j,N=0,H){const W=[];if(!C.length||!L||!j)return W;const ee=(Re,Ne)=>{for(const Fe of Re)W.push({polygon:Fe,bounds:Ne})},ie=Math.ceil(Math.log2(L)),se=Math.ceil(Math.log2(j)),fe=ie-se,pe=[];for(let Re=0;Re<Math.abs(fe);Re++)pe.push(fe>0?0:1);for(let Re=0;Re<Math.min(ie,se);Re++)pe.push(0),pe.push(1);let _e=C;if(_e=f0(_e,k[0].y-N,k[1].y+N,1),_e=f0(_e,k[0].x-N,k[1].x+N,0),!_e.length)return W;const ke=[];for(pe.length?ke.push({polygons:_e,bounds:k,depth:0}):ee(_e,k);ke.length;){const Re=ke.pop(),Ne=Re.depth,Fe=pe[Ne],Ue=Re.bounds[0],ft=Re.bounds[1],We=Fe===0?Ue.x:Ue.y,mt=Fe===0?ft.x:ft.y,Ct=H?H(Fe,We,mt):.5*(We+mt),yt=f0(Re.polygons,We-N,Ct+N,Fe),xt=f0(Re.polygons,Ct-N,mt+N,Fe);if(yt.length){const Rt=[Ue,new It(Fe===0?Ct:ft.x,Fe===1?Ct:ft.y)];pe.length>Ne+1?ke.push({polygons:yt,bounds:Rt,depth:Ne+1}):ee(yt,Rt)}if(xt.length){const Rt=[new It(Fe===0?Ct:Ue.x,Fe===1?Ct:Ue.y),ft];pe.length>Ne+1?ke.push({polygons:xt,bounds:Rt,depth:Ne+1}):ee(xt,Rt)}}return W})(l,r,Math.ceil((_-f)/11.25),Math.ceil((y-T)/11.25),1,((C,k,L)=>{if(C===0)return .5*(k+L);{const j=Ce((a.y+k/Ft)/h);return(Pe(.5*(Ce((a.y+L/Ft)/h)+j))*h-a.y)*Ft}}))}function Y6(l,r,a,h,f,_){const y=Math.pow(2,h.z-f.z);for(let T=0;T<a;T++){let C=l.int16[2*(T+r)+0],k=l.int16[2*(T+r)+1];C=(C+f.x*Ft)*y-h.x*Ft,k=(k+f.y*Ft)*y-h.y*Ft,_.push(new It(C,k))}}let aM,lM;nn(y0,"FillExtrusionBucket",{omit:["layers","features"]}),nn(KI,"PartData"),nn(YI,"FootprintSegment"),nn(JI,"BorderCentroidData"),nn(AS,"GroundEffect");class yg extends It{constructor(r,a,h){super(r,a),this.z=h}}class cM extends yg{constructor(r,a,h,f){super(r,a,h),this.w=f}}function uM(l,r,a,h){const f=a==="x"?"y":"x",_=(h-l[a])/(r[a]-l[a]);l[f]=Math.round(l[f]+(r[f]-l[f])*_),l[a]=h,l.hasOwnProperty("z")&&(l.z=An(l.z,r.z,_)),l.hasOwnProperty("w")&&(l.w=An(l.w,r.w,_))}function hM(l,r,a,h){const f=a,_=h;for(const y of["x","y"]){let T=l,C=r;T[y]>=C[y]&&(T=r,C=l),T[y]<f&&C[y]>f&&uM(T,C,y,f),T[y]<_&&C[y]>_&&uM(C,T,y,_)}}function v0(l,r,a,h,f,_){const y=[];for(let T=0;T<l.length;T++){const C=l[T];let k;const L=y.length;let j=0;for(let N=0;N<C.length-1;N++){let H=C[N],W=C[N+1],ee=0;const ie=j;let se,fe;_&&(ee=Math.hypot(W.x-H.x,W.y-H.y),j+=ee,se=H,fe=W),H.x<r&&W.x<r||(H.x<r?H=new It(r,H.y+(r-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x<r&&(W=new It(r,H.y+(r-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y<a&&W.y<a||(H.y<a?H=new It(H.x+(a-H.y)/(W.y-H.y)*(W.x-H.x),a)._round():W.y<a&&(W=new It(H.x+(a-H.y)/(W.y-H.y)*(W.x-H.x),a)._round()),H.x>=h&&W.x>=h||(H.x>=h?H=new It(h,H.y+(h-H.x)/(W.x-H.x)*(W.y-H.y))._round():W.x>=h&&(W=new It(h,H.y+(h-H.x)/(W.x-H.x)*(W.y-H.y))._round()),H.y>=f&&W.y>=f||(H.y>=f?H=new It(H.x+(f-H.y)/(W.y-H.y)*(W.x-H.x),f)._round():W.y>=f&&(W=new It(H.x+(f-H.y)/(W.y-H.y)*(W.x-H.x),f)._round()),k&&H.equals(k[k.length-1])||(k=[H],y.push(k),_&&_.push({progress:{min:ie+dM(se,fe,H)*ee,max:1},parentIndex:T,prevPoint:se,nextPoint:fe})),k.push(W),_&&(_[_.length-1].progress.max=ie+dM(se,fe,W)*ee,_[_.length-1].nextPoint=fe)))))}if(_&&j>0)for(let N=L;N<y.length;N++)_[N].progress.min/=j,_[N].progress.max/=j}return y}function K6(l,r,a,h,f){if(l.length<2)return void h.push(l);const _=[];for(;r.valid();){const[k,L]=r.get();for(let j=0;j<l.length-1;j++){const N=l[j],H=l[j+1],W=Li(N,H,k,L);if(W){const[ee]=W,ie=new It(An(N.x,H.x,ee),An(N.y,H.y,ee));_.push({t:j+ee,distance:0,point:ie})}}r.next()}if(_.length===0)return void h.push(l);_.sort(((k,L)=>k.t-L.t));let y=0,T=0,C=[];for(h.push(C);y!==l.length;){if(T===_.length){for(;y!==l.length;)C.length!==0&&C[C.length-1].equals(l[y])||C.push(l[y]),y++;break}_[T].t<=y?(C.length!==0&&C[C.length-1].equals(_[T].point)||C.push(_[T].point),Math.trunc(_[T].t),T++):(C.length!==0&&C[C.length-1].equals(l[y])||C.push(l[y]),y++)}}function dM(l,r,a){return l.x!==r.x?(a.x-l.x)/(r.x-l.x):l.y!==r.y?(a.y-l.y)/(r.y-l.y):0}function iv(l,r){return l.x*r.x+l.y*r.y}function fM(l,r){if(l.length===1){let a=0;const h=r[a++];let f;for(;!f||h.equals(f);)if(f=r[a++],!f)return 1/0;for(;a<r.length;a++){const _=r[a],y=l[0],T=f.sub(h),C=_.sub(h),k=y.sub(h),L=iv(T,T),j=iv(T,C),N=iv(C,C),H=iv(k,T),W=iv(k,C),ee=L*N-j*j,ie=(N*H-j*W)/ee,se=(L*W-j*H)/ee,fe=h.z*(1-ie-se)+f.z*ie+_.z*se;if(isFinite(fe))return fe}return 1/0}{let a=1/0;for(const h of r)a=Math.min(a,h.z);return a}}function pM(l,r,a,h,f,_,y,T){const C=y*f.getElevationAt(l,r,!0,!0),k=_[0]!==0,L=k?_[1]===0?y*(_[0]/7-450):y*(function(j,N,H){const W=Math.floor(N[0]/8),ee=Math.floor(N[1]/8),ie=10*(N[0]-8*W),se=10*(N[1]-8*ee),fe=j.getElevationAt(W,ee,!0,!0),pe=j.getMeterToDEM(H),_e=Math.floor(.5*(ie*pe-1)),ke=Math.floor(.5*(se*pe-1)),Re=j.tileCoordToPixel(W,ee),Ne=2*_e+1,Fe=2*ke+1,Ue=(function(xt,Rt,ht,bt,st){return[xt.getElevationAtPixel(Rt,ht,!0),xt.getElevationAtPixel(Rt+st,ht,!0),xt.getElevationAtPixel(Rt,ht+st,!0),xt.getElevationAtPixel(Rt+bt,ht+st,!0)]})(j,Re.x-_e,Re.y-ke,Ne,Fe),ft=Math.abs(Ue[0]-Ue[1]),We=Math.abs(Ue[2]-Ue[3]),mt=Math.abs(Ue[0]-Ue[2])+Math.abs(Ue[1]-Ue[3]),Ct=Math.min(.25,.5*pe*(ft+We)/Ne),yt=Math.min(.25,.5*pe*mt/Fe);return fe+Math.max(Ct*ie,yt*se)})(f,_,T):C;return{base:C+(a===0?-1:a),top:k?Math.max(L+h,C+a+2):C+h}}class J6{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Q6{constructor(){this.tasks={},this.taskQueue=[],Rn(["process"],this),this.invoker=new J6(this.process),this.nextId=0}add(r,a){const h=this.nextId++,f=(function({type:_,isSymbolTile:y,zoom:T}){return T=T||0,_==="message"?0:_!=="maybePrepare"||y?_!=="parseTile"||y?_==="parseTile"&&y?300-T:_==="maybePrepare"&&y?400-T:500:200-T:100-T})(a);if(f===0){try{r()}finally{}return null}return this.tasks[h]={fn:r,metadata:a,priority:f,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((h=>!!this.tasks[h])),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let f=0;f<this.taskQueue.length;f++){const _=this.tasks[this.taskQueue[f]];_.priority<a&&(a=_.priority,r=f)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class mM{constructor(r,a,h){this.target=r,this.parent=a,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Rn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Q6}send(r,a,h,f,_=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=y,this.callbacks[T]=h);const C=new Set;return this.target.postMessage({id:T,type:r,hasCallback:!!h,targetMapId:f,mustQueue:_,sourceMapId:this.mapId,data:Uo(a,C)},C),{cancel:()=>{h&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(r){const a=r.data;if(!a)return;const h=a.id;if(h&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const f=this.cancelCallbacks[h];delete this.cancelCallbacks[h],f&&f.cancel()}else if(a.mustQueue||$r(self)){const f=this.callbacks[h],_=this.scheduler.add((()=>this.processTask(h,a)),f&&f.metadata||{type:"message"});_&&(this.cancelCallbacks[h]=_)}else this.processTask(h,a)}processTask(r,a){if(delete this.cancelCallbacks[r],a.type==="<response>"){const h=this.callbacks[r];delete this.callbacks[r],h&&(a.error?h(Tl(a.error)):h(null,Tl(a.data)))}else{const h=new Set,f=a.hasCallback?(y,T)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:y?Uo(y):null,data:Uo(T,h)},h)}:()=>{},_=Tl(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,_,f);else if(this.parent.getWorkerSource){const y=a.type.split("."),{source:T,scope:C}=_;this.parent.getWorkerSource(a.sourceMapId,y[0],T,C)[y[1]](_,f)}else f(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var sv={workerUrl:"",workerClass:null,workerParams:void 0};const PS="mapboxgl_preloaded_worker_pool";class vg{constructor(){this.active={}}acquire(r,a=vg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(sv.workerClass!=null?new sv.workerClass:new self.Worker(sv.workerUrl,sv.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[PS]}numActive(){return Object.keys(this.active).length}}vg.workerCount=2;class j_{constructor(r,a,h="Worker",f=vg.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=_t();const _=this.workerPool.acquire(this.id,f);for(let y=0;y<_.length;y++){const T=new j_.Actor(_[y],a,this.id);T.name=`${h} ${y}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(r,a,h){ot(this.actors,((f,_)=>{f.send(r,a,_)}),h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((r=>{r.remove()})),this.actors=[],this.workerPool.release(this.id)}}let ov,IS;function x0(){return ov||(ov=new vg),ov}j_.Actor=mM;class e${constructor(r){this.module=r}createIntArray(r){const a=new Int32Array(r),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,h/a.BYTES_PER_ELEMENT),h}createFloatArray(r){const a=new Float32Array(r),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,h/a.BYTES_PER_ELEMENT),h}createStringBuffer(r){const a=this.module.malloc(r.length+1);for(let h=0;h<r.length;++h)this.module.heapU8[a+h]=r.charCodeAt(h);return this.module.heapU8[a+r.length]=0,a}readStringBuffer(r){let a="";for(;this.module.heapU8[r]!==0;)a+=String.fromCharCode(this.module.heapU8[r]),++r;return a}setStyle(r){const a=r.entranceColorRgb,h=r.facadeGlazingColorRgb,f=r.roofColorRgb,_=r.wallColorRgb,y=r.normalScale;this.module.setStyle(a[0],a[1],a[2],h[0],h[1],h[2],f[0],f[1],f[2],_[0],_[1],_[2],y[0],y[1],y[2],r.tileToMeters)}setAOOptions(r,a){this.module.setAOOptions(r?1:0,a)}setMetricOptions(r,a){this.module.setMetricOptions(r?1:0,a)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,a){this.module.setFacadeOptions(r,a?1:0)}setFauxFacadeOptions(r,a,h){this.module.setFauxFacadeOptions(r?1:0,a?1:0,h)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,a){for(const T of r){const C=this.createStringBuffer(T.roofType),k=[0],L=[];for(const H of T.coordinates)if(Array.isArray(H)){for(const W of H)L.push(W.x),L.push(W.y);k.push(L.length)}const j=this.createIntArray(k),N=this.createFloatArray(L);this.module.addFeature(T.id,T.sourceId,T.minHeight,T.height,C,T.roofType.length,N,j,k.length-1),this.module.free(C),this.module.free(j),this.module.free(N)}for(const T of a){let C;C=T.entrances?JSON.parse(T.entrances):[];const k=this.createFloatArray(C),L=[];for(const N of T.coordinates)L.push(N.x),L.push(N.y);const j=this.createFloatArray(L);this.module.addFacade(T.sourceId,T.crossPerc,T.distanceToRoad,k,C.length,j,L.length),this.module.free(k),this.module.free(j)}if(!this.module.generateMesh()){const T=this.module.getLastError();return this.readStringBuffer(T)}const h=this.module.getMeshCount(),f=new Array(h);for(let T=0;T<h;T++){const C=this.module.getPositionsPtr(T),k=this.module.getPositionsLength(T),L=new Float32Array(this.module.heapF32.buffer,C,k),j=this.module.getNormalsPtr(T),N=this.module.getNormalsLength(T),H=new Float32Array(this.module.heapF32.buffer,j,N),W=this.module.getColorsPtr(T),ee=this.module.getColorsLength(T),ie=new Uint8Array(this.module.heapU8.buffer,W,ee),se=this.module.getAOPtr(T),fe=this.module.getAOLength(T),pe=new Float32Array(this.module.heapF32.buffer,se,fe),_e=this.module.getUVPtr(T),ke=this.module.getUVLength(T),Re=new Float32Array(this.module.heapF32.buffer,_e,ke),Ne=this.module.getFauxFacadePtr(T),Fe=this.module.getFauxFacadeLength(T),Ue=new Uint8Array(this.module.heapU8.buffer,Ne,Fe),ft=this.module.getIndicesPtr(T),We=this.module.getIndicesLength(T),mt=new Int32Array(this.module.heap32.buffer,ft,We),Ct=this.module.getBuildingPart(T),yt=this.readStringBuffer(Ct);f[T]={positions:L,normals:H,colors:ie,ao:pe,uv:Re,isFauxFacade:Ue,indices:mt,buildingPart:yt}}const _=this.module.getRingCount(),y=[];for(let T=0;T<_;T++){const C=this.module.getRingPtr(T),k=this.module.getRingLength(T),L=new Float32Array(this.module.heapF32.buffer,C,k);y.push(L)}return{meshes:f,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:y}}}let av,MS,bh,z_,kS,N_=null,F_=null,gM=null,b0=null;function _M(){return $r(self)&&self.worker.dracoUrl?self.worker.dracoUrl:MS||ro.DRACO_URL}function yM(){if($r(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(z_)return z_;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return z_=WebAssembly.validate(l)?ro.MESHOPT_SIMD_URL:ro.MESHOPT_URL,z_}function t$(){return b0}const w0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},n$={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},lv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function vM(l,r,a){const h=a.json.bufferViews.length,f=a.buffers.length;r.bufferView=h,a.json.bufferViews[h]={buffer:f,byteLength:l.byteLength},a.buffers[f]=l}const RS="KHR_draco_mesh_compression";function r$(l,r){const a=l.extensions&&l.extensions[RS];if(!a)return;const h=new bh.Decoder,f=SM(r,a.bufferView),_=new bh.Mesh;if(!h.DecodeArrayToMesh(f,f.byteLength,_))throw new Error("Failed to decode Draco mesh");const y=r.json.accessors[l.indices],T=w0[y.componentType],C=y.count*T.BYTES_PER_ELEMENT,k=bh._malloc(C);T===Uint16Array?h.GetTrianglesUInt16Array(_,C,k):h.GetTrianglesUInt32Array(_,C,k),vM(bh.memory.buffer.slice(k,k+C),y,r),bh._free(k);for(const L of Object.keys(a.attributes)){const j=h.GetAttributeByUniqueId(_,a.attributes[L]),N=r.json.accessors[l.attributes[L]],H=n$[N.componentType],W=N.count*lv[N.type]*w0[N.componentType].BYTES_PER_ELEMENT,ee=bh._malloc(W);h.GetAttributeDataArrayForAllPoints(_,j,bh[H],W,ee),vM(bh.memory.buffer.slice(ee,ee+W),N,r),bh._free(ee)}h.destroy(),_.destroy(),delete l.extensions[RS]}const S0="EXT_meshopt_compression";function i$(l,r){if(!l.extensions||!l.extensions[S0])return;const a=l.extensions[S0],h=new Uint8Array(r.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),f=new Uint8Array(a.count*a.byteStride);kS.decodeGltfBuffer(f,a.count,a.byteStride,h,a.mode,a.filter),l.buffer=r.buffers.length,l.byteOffset=0,r.buffers[l.buffer]=f.buffer,delete l.extensions[S0]}const xM=1179937895,bM=new TextDecoder("utf8");function wM(l,r){return new URL(l,r).href}function s$(l,r,a,h){return fetch(wM(l.uri,h)).then((f=>f.arrayBuffer())).then((f=>{r.buffers[a]=f}))}function SM(l,r){const a=l.json.bufferViews[r];return new Uint8Array(l.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function o$(l,r,a,h){if(l.uri){const f=wM(l.uri,h);return fetch(f).then((_=>_.blob())).then((_=>createImageBitmap(_))).then((_=>{r.images[a]=_}))}if(l.bufferView!==void 0){const f=SM(r,l.bufferView),_=new Blob([f],{type:l.mimeType});return createImageBitmap(_).then((y=>{r.images[a]=y}))}}function TM(l,r=0,a){const h={json:null,images:[],buffers:[]};if(new Uint32Array(l,r,1)[0]===xM){const L=new Uint32Array(l,r);let j=2;const N=(L[j++]>>2)-3,H=L[j++]>>2;if(j++,h.json=JSON.parse(bM.decode(L.subarray(j,j+H))),j+=H,j<N){const W=L[j++];j++;const ee=r+(j<<2);h.buffers[0]=l.slice(ee,ee+W)}}else h.json=JSON.parse(bM.decode(new Uint8Array(l,r)));const{buffers:f,images:_,meshes:y,extensionsUsed:T,bufferViews:C}=h.json;let k=Promise.resolve();if(f){const L=[];for(let j=0;j<f.length;j++){const N=f[j];N.uri?L.push(s$(N,h,j,a)):h.buffers[j]||(h.buffers[j]=null)}k=Promise.all(L)}return k.then((()=>{const L=[],j=T&&T.includes(RS),N=T&&T.includes(S0);if(j&&L.push((function(){if(!bh)return av??(av=(function(H){let W,ee=null;function ie(){W=new Uint8Array(ee.buffer)}function se(){throw new Error("Unexpected Draco error.")}const fe={a:{a:se,d:function(pe,_e,ke){return W.copyWithin(pe,_e,_e+ke)},c:function(pe){const _e=W.length,ke=Math.max(pe>>>0,Math.ceil(1.2*_e)),Re=Math.ceil((ke-_e)/65536);try{return ee.grow(Re),ie(),!0}catch{return!1}},b:se}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(H,fe):H.then((pe=>pe.arrayBuffer())).then((pe=>WebAssembly.instantiate(pe,fe)))).then((pe=>{const{Rb:_e,Qb:ke,P:Re,T:Ne,X:Fe,Ja:Ue,La:ft,Qa:We,Va:mt,Wa:Ct,eb:yt,jb:xt,f:Rt,e:ht,yb:bt,zb:st,Ab:nt,Bb:Ot,Db:Mt,Gb:bn}=pe.instance.exports;ee=ht;const rn=(()=>{let fn=0,Ut=0,xn=0,Nn=0;return Yt=>{xn&&(_e(Nn),_e(fn),Ut+=xn,xn=fn=0),fn||(Ut+=128,fn=ke(Ut));const mn=Yt.length+7&-8;let On=fn;mn>=Ut&&(xn=mn,On=Nn=ke(mn));for(let Vn=0;Vn<Yt.length;Vn++)W[On+Vn]=Yt[Vn];return On}})();return ie(),Rt(),{memory:ht,_free:_e,_malloc:ke,Mesh:class{constructor(){this.ptr=Re()}destroy(){Ne(this.ptr)}},Decoder:class{constructor(){this.ptr=Ue()}destroy(){xt(this.ptr)}DecodeArrayToMesh(fn,Ut,xn){const Nn=rn(fn),Yt=ft(this.ptr,Nn,Ut,xn.ptr);return!!Fe(Yt)}GetAttributeByUniqueId(fn,Ut){return{ptr:We(this.ptr,fn.ptr,Ut)}}GetTrianglesUInt16Array(fn,Ut,xn){mt(this.ptr,fn.ptr,Ut,xn)}GetTrianglesUInt32Array(fn,Ut,xn){Ct(this.ptr,fn.ptr,Ut,xn)}GetAttributeDataArrayForAllPoints(fn,Ut,xn,Nn,Yt){yt(this.ptr,fn.ptr,Ut.ptr,xn,Nn,Yt)}},DT_INT8:bt(),DT_UINT8:st(),DT_INT16:nt(),DT_UINT16:Ot(),DT_UINT32:Mt(),DT_FLOAT32:bn()}}))})(fetch(_M())),av.then((H=>{bh=H,av=void 0})))})()),N&&L.push((function(){if(kS)return;const H=(function(W){let ee;const ie=WebAssembly.instantiateStreaming(W,{}).then((pe=>{ee=pe.instance,ee.exports.__wasm_call_ctors()})),se={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},fe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ie,supported:!0,decodeGltfBuffer(pe,_e,ke,Re,Ne,Fe){(function(Ue,ft,We,mt,Ct,yt,xt){const Rt=Ue.exports.sbrk,ht=mt+3&-4,bt=Rt(ht*Ct),st=Rt(yt.length),nt=new Uint8Array(Ue.exports.memory.buffer);nt.set(yt,st);const Ot=ft(bt,mt,Ct,st,yt.length);if(Ot===0&&xt&&xt(bt,ht,Ct),We.set(nt.subarray(bt,bt+mt*Ct)),Rt(bt-Rt(0)),Ot!==0)throw new Error(`Malformed buffer data: ${Ot}`)})(ee,ee.exports[fe[Ne]],pe,_e,ke,Re,ee.exports[se[Fe]])}}})(fetch(yM()));return H.ready.then((()=>{kS=H}))})()),_)for(let H=0;H<_.length;H++)L.push(o$(_[H],h,H,a));return(L.length?Promise.all(L):Promise.resolve()).then((()=>{if(j&&y)for(const{primitives:H}of y)for(const W of H)r$(W,h);if(N&&y&&C)for(const H of C)i$(H,h);return h}))}))}function OS(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function DS(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class LS{constructor(r,a,h,f){this.context=r,this.format=h,this.useMipmap=f&&f.useMipmap,this.texture=r.gl.createTexture(),this.update(a,{premultiply:f&&f.premultiply})}update(r,a){const h=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,f=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:_}=this,{gl:y}=_,{x:T,y:C}=a&&a.position?a.position:{x:0,y:0},k=T+h,L=C+f;!this.size||this.size[0]===k&&this.size[1]===L||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||a.premultiply!==!1));const j=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&k>0&&L>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(k,L)))+1:1;y.texStorage2D(y.TEXTURE_2D,N,this.format,k,L),this.size=[k,L]}this.size&&(j?y.texSubImage2D(y.TEXTURE_2D,0,T,C,OS(this.format),DS(this.format),r):"data"in r&&r.data&&y.texSubImage2D(y.TEXTURE_2D,0,T,C,h,f,OS(this.format),DS(this.format),r.data)),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(r,a,h=!1){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),r!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!h?r===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(r,a,h,f,_){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),a!==this.magFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,a),this.magFilter=a),r!==this.minFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap?r===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),h!==this.wrapS&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,h),this.wrapS=h),f!==this.wrapT&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,f),this.wrapT=f),_!==this.compareMode&&(_?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.COMPARE_REF_TO_TEXTURE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_FUNC,_)):T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.NONE),this.compareMode=_)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class cv{constructor(r,a){this.context=r,this.texture=a}bind(r,a){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r),this.minFilter=r),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}}const a$=vr([{name:"a_pos_3f",components:3,type:"Float32"}]),l$=vr([{name:"a_color_3f",components:3,type:"Float32"}]),c$=vr([{name:"a_color_4f",components:4,type:"Float32"}]),u$=vr([{name:"a_uv_2f",components:2,type:"Float32"}]),h$=vr([{name:"a_normal_3f",components:3,type:"Float32"}]),d$=vr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),f$=vr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function EM(l,r){const a=T0(l.projection,l.zoom,l.width,l.height),h=(function(_,y,T,C,k){const L=new Q(T.lng-180*am,T.lat),j=new Q(T.lng+180*am,T.lat),N=_.project(L.lng,L.lat),H=_.project(j.lng,j.lat),W=-Math.atan2(H.y-N.y,H.x-N.x),ee=Qe.fromLngLat(T);ee.y=Oe(ee.y,-1+am,1-am);const ie=ee.toLngLat(),se=_.project(ie.lng,ie.lat),fe=Qe.fromLngLat(ie);fe.x+=am;const pe=fe.toLngLat(),_e=_.project(pe.lng,pe.lat),ke=CM(_e.x-se.x,_e.y-se.y,W),Re=Qe.fromLngLat(ie);Re.y+=am;const Ne=Re.toLngLat(),Fe=_.project(Ne.lng,Ne.lat),Ue=CM(Fe.x-se.x,Fe.y-se.y,W),ft=Math.abs(ke.x)/Math.abs(Ue.y),We=q([]);we(We,We,-W*(1-(k?0:C)));const mt=q([]);return ue(mt,mt,[1,1-(1-ft)*C,1]),mt[4]=-Ue.x/Ue.y*C,we(mt,mt,W),re(mt,We,mt),mt})(l.projection,0,l.center,a,r),f=AM(l);return ue(h,h,[f,f,1]),h}function AM(l){const r=l.projection,a=T0(l.projection,l.zoom,l.width,l.height),h=jS(r,l.center),f=jS(r,Q.convert(r.center));return Math.pow(2,h*a+(1-a)*f)}function T0(l,r,a,h,f=1/0){const _=l.range;if(!_)return 0;const y=Math.min(f,Math.max(a,h)),T=Math.log2(y/1024);return rt(_[0]+T,_[1]+T,r)}const am=1/4e4;function jS(l,r){const a=Oe(r.lat,-Me,Me),h=new Q(r.lng-180*am,a),f=new Q(r.lng+180*am,a),_=l.project(h.lng,a),y=l.project(f.lng,a),T=Qe.fromLngLat(h),C=Qe.fromLngLat(f),k=y.x-_.x,L=y.y-_.y,j=C.x-T.x,N=C.y-T.y,H=Math.sqrt((j*j+N*N)/(k*k+L*L));return Math.log2(H)}function CM(l,r,a){const h=Math.cos(a),f=Math.sin(a);return{x:l*h-r*f,y:l*f+r*h}}function PM(l,r,a){q(l),we(l,l,$e(r[2])),ye(l,l,$e(r[0])),ge(l,l,$e(r[1])),ue(l,l,a),re(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function E0(l,r,a,h,f,_,y,T){const C=[a[0]-r[0],a[1]-r[1],0],k=[h[0]-r[0],h[1]-r[1],0];if(en(C)<1e-12||en(k)<1e-12)return ja(l);const L=En([],C,k);kn(L,L),an(k,h,r),C[2]=(_-f)*T,k[2]=(y-f)*T;const j=C;return En(j,C,k),kn(j,j),no(l,L,j)}function zS(l,r,a=!1){const h=Tr(r.zoom),f=(function(_,y,T){const C=y.worldSize,k=[_[12],_[13],_[14]],L=Ce(k[1]/C),j=Ie(k[0]/C),N=q([]),H=Ae(1,L)*C,W=Ae(1,0)*C*Be(L,y.zoom),ee=1/pr(C);let ie=W*ee;if(T){const _e=T0(y.projection,y.zoom,y.width,y.height,1024);ie=ee*y.projection.pixelSpaceConversion(y.center.lat,C,_e)}const se=V(L,j);St(se,se,et([],kn([],se),H*ie*k[2]));const fe=(function(_e){const ke=[_e[0],_e[1],_e[2]];let Re=[0,1,0];const Ne=En([],Re,ke);return En(Re,ke,Ne),$n(Re)===0&&(Re=[0,1,0],En(Ne,ke,Re)),kn(Ne,Ne),kn(Re,Re),kn(ke,ke),[Ne[0],Ne[1],Ne[2],0,Re[0],Re[1],Re[2],0,ke[0],ke[1],ke[2],0,_e[0],_e[1],_e[2],1]})(se);ue(N,N,[ie,ie,ie*H]),le(N,N,[-k[0],-k[1],-k[2]]);const pe=re([],y.globeMatrix,fe);return re(pe,pe,N),re(pe,pe,_),pe})(l,r,a);if(h>0){const _=(function(y,T){const C=T.worldSize,k=Ae(1,0)*C*Be(T.center.lat,T.zoom)/pr(C),L=Ae(1,T.center.lat)*C,j=q([]);ge(j,j,$e(T.center.lng)),ye(j,j,$e(T.center.lat)),le(j,j,[0,0,p]),ue(j,j,[k,k,k*L]);const N=T.point;return le(j,j,[-N.x,-N.y,0]),re(j,j,y),re(j,T.globeMatrix,j)})(l,r);return(function(y,T,C){const k=(W,ee,ie)=>{const se=en(W),fe=en(ee),pe=yn(W,ee,ie);return et(pe,pe,1/en(pe)*An(se,fe,ie))},L=k([y[0],y[1],y[2]],[T[0],T[1],T[2]],C),j=k([y[4],y[5],y[6]],[T[4],T[5],T[6]],C),N=k([y[8],y[9],y[10]],[T[8],T[9],T[10]],C),H=yn([y[12],y[13],y[14]],[T[12],T[13],T[14]],C);return[L[0],L[1],L[2],0,j[0],j[1],j[2],0,N[0],N[1],N[2],0,H[0],H[1],H[2],1]})(f,_,h)}return f}function IM(l,r,a,h){const f=Mn.projectAabbCorners(h,a);let _=Number.MAX_VALUE,y=-1;for(let k=0;k<f.length;++k){const L=f[k];L[0]=(.5*L[0]+.5)*r.width,L[1]=(.5-.5*L[1])*r.height,L[2]<_&&(y=k,_=L[2])}const T=k=>new It(f[k][0],f[k][1]);let C;switch(y){case 0:case 6:C=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:C=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:C=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:C=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(To(l,C))return _}const xg=64,B_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function MM(l,r,a,h,f,_,y,T,C,k=!1){const L=a.zoom,j=a.project(h),N=Be(h.lat,L),H=1/N;q(l),le(l,l,[j.x+y[0]*H,j.y+y[1]*H,y[2]]);let W=1,ee=1;const ie=a.worldSize;if(k){if(a.projection.name==="mercator"){let _e=0;a.elevation&&(_e=a.elevation.getAtPointOrZero(new Qe(j.x/ie,j.y/ie),0));const ke=us([],[j.x,j.y,_e,1],a.projMatrix)[3]/a.cameraToCenterDistance;W=ke,ee=ke*Be(a.center.lat,L)}else if(a.projection.name==="globe"){const _e=zS(l,a),ke=[0,0,0,1];us(ke,ke,re([],a.projMatrix,_e));const Re=ke[3]/a.cameraToCenterDistance,Ne=Tr(L),Fe=a.projection.pixelsPerMeter(h.lat,ie)*Be(h.lat,L),Ue=a.projection.pixelsPerMeter(a.center.lat,ie)*Be(a.center.lat,L);W=Re/An(Fe,Ke(a.center.lat),Ne),ee=Re*N/Fe,W*=Ue,ee*=Ue}}else W=H;ue(l,l,[W,W,ee]);const se=[...l],fe=r.orientation,pe=[];if(PM(pe,[fe[0]+f[0],fe[1]+f[1],fe[2]+f[2]],_),re(l,se,pe),T&&a.elevation){let _e=0;const ke=[];if(C&&a.elevation){_e=(function(Ne,Fe,Ue,ft,We){const mt=Fe.elevation;if(!mt)return 0;const Ct=Mn.projectAabbCorners(Ue,ft),yt=Ae(1,We.lat)*Fe.worldSize,xt=(function(Ut,xn){const Nn=[0,0,1],Yt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mn of Yt){const On=Ut[mn.corners[0]],Vn=Ut[mn.corners[1]],ar=Ut[mn.corners[2]],Jn=[Vn[0]-On[0],Vn[1]-On[1],xn*(Vn[2]-On[2])],on=En(Jn,Jn,[ar[0]-On[0],ar[1]-On[1],xn*(ar[2]-On[2])]);kn(on,on),mn.dotProductWithUp=Bt(on,Nn)}return Yt.sort(((mn,On)=>mn.dotProductWithUp-On.dotProductWithUp)),Yt[0].corners})(Ct,yt),Rt=Ct[xt[0]],ht=Ct[xt[1]],bt=Ct[xt[2]],st=Ct[xt[3]],nt=mt.getAtPointOrZero(new Qe(Rt[0]/Fe.worldSize,Rt[1]/Fe.worldSize),0),Ot=mt.getAtPointOrZero(new Qe(ht[0]/Fe.worldSize,ht[1]/Fe.worldSize),0),Mt=mt.getAtPointOrZero(new Qe(bt[0]/Fe.worldSize,bt[1]/Fe.worldSize),0),bn=mt.getAtPointOrZero(new Qe(st[0]/Fe.worldSize,st[1]/Fe.worldSize),0),rn=(nt+bn)/2,fn=(Ot+Mt)/2;return rn>fn?Ot<Mt?E0(Ne,ht,st,Rt,Ot,bn,nt,yt):E0(Ne,bt,Rt,st,Mt,nt,bn,yt):nt<bn?E0(Ne,Rt,ht,bt,nt,Ot,Mt,yt):E0(Ne,st,bt,ht,bn,Mt,Ot,yt),Math.max(rn,fn)})(ke,a,r.aabb,l,h);const Re=re([],Ge([],ke),pe);re(l,se,Re)}else _e=a.elevation.getAtPointOrZero(new Qe(j.x/ie,j.y/ie),0);_e!==0&&(l[14]+=_e)}}function uv(l,r,a=!1){l.uploaded||(l.gfxTexture=new LS(r,l.image,a?r.gl.R8:r.gl.RGBA8,{useMipmap:l.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function p$(l,r,a){l.indexBuffer=r.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=r.createVertexBuffer(l.vertexArray,a$.members,!1,!0),l.normalArray&&(l.normalBuffer=r.createVertexBuffer(l.normalArray,h$.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=r.createVertexBuffer(l.texcoordArray,u$.members,!1,!0)),l.colorArray&&(l.colorBuffer=r.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?l$:c$).members,!1,!0)),l.featureArray&&(l.pbrBuffer=r.createVertexBuffer(l.featureArray,f$.members,!0)),l.segments=Rr.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const h=l.material;h.pbrMetallicRoughness.baseColorTexture&&uv(h.pbrMetallicRoughness.baseColorTexture,r),h.pbrMetallicRoughness.metallicRoughnessTexture&&uv(h.pbrMetallicRoughness.metallicRoughnessTexture,r),h.normalTexture&&uv(h.normalTexture,r),h.occlusionTexture&&uv(h.occlusionTexture,r,a),h.emissionTexture&&uv(h.emissionTexture,r)}function NS(l,r,a){if(l.meshes)for(const h of l.meshes)p$(h,r,a);if(l.children)for(const h of l.children)NS(h,r,a)}function A0(l){if(l.meshes)for(const r of l.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(l.children)for(const r of l.children)A0(r)}function FS(l){if(l.meshes)for(const a of l.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((r=a.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(l.children)for(const a of l.children)FS(a)}function bg(l,r){const a=l.json.bufferViews[r.bufferView],h=w0[r.componentType];return new h(l.buffers[a.buffer],(r.byteOffset||0)+(a.byteOffset||0),r.count*(a.byteStride&&a.byteStride!==lv[r.type]*h.BYTES_PER_ELEMENT?a.byteStride/h.BYTES_PER_ELEMENT:lv[r.type]))}function BS(l,r,a,h){const f=w0[r.componentType],_=(function(L){switch(L){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(f),y=l.json.bufferViews[r.bufferView],T=y.byteStride?y.byteStride/f.BYTES_PER_ELEMENT:lv[r.type],C=a.float32,k=C.length/a.capacity;for(let L=0,j=0;L<r.count*T;L+=T,j+=k)for(let N=0;N<k;N++)C[j+N]=h[L+N]*_;a._trim()}function m$(l,r,a){const h=l.indices,f=l.attributes,_={};_.indexArray=new ss;const y=r.json.accessors[h],T=y.count/3;_.indexArray.reserve(T);const C=bg(r,y);for(let N=0;N<T;N++)_.indexArray.emplaceBack(C[3*N],C[3*N+1],C[3*N+2]);_.indexArray._trim(),_.vertexArray=new qs;const k=r.json.accessors[f.POSITION];_.vertexArray.reserve(k.count);const L=bg(r,k);for(let N=0;N<k.count;N++)_.vertexArray.emplaceBack(L[3*N],L[3*N+1],L[3*N+2]);if(_.vertexArray._trim(),_.aabb=new Mn(k.min,k.max),_.centroid=(function(N,H){const W=[0,0,0],ee=N.length;if(ee>0){for(let ie=0;ie<ee;ie++){const se=3*N[ie];W[0]+=H[se],W[1]+=H[se+1],W[2]+=H[se+2]}W[0]/=ee,W[1]/=ee,W[2]/=ee}return W})(C,L),f.COLOR_0!==void 0){const N=r.json.accessors[f.COLOR_0],H=lv[N.type],W=bg(r,N);_.colorArray=H===3?new qs:new Ca,_.colorArray.resize(N.count),BS(r,N,_.colorArray,W)}if(f.NORMAL!==void 0){_.normalArray=new qs;const N=r.json.accessors[f.NORMAL];_.normalArray.resize(N.count);const H=bg(r,N);BS(r,N,_.normalArray,H)}if(f.TEXCOORD_0!==void 0&&a.length>0){_.texcoordArray=new uh;const N=r.json.accessors[f.TEXCOORD_0];_.texcoordArray.resize(N.count);const H=bg(r,N);BS(r,N,_.texcoordArray,H)}if(f._FEATURE_ID_RGBA4444!==void 0){const N=r.json.accessors[f._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=bg(r,N))}f._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(bg(r,r.json.accessors[f._FEATURE_RGBA4444]).buffer));const j=l.material;return _.material=(function(N,H){const{emissiveFactor:W=[0,0,0],alphaMode:ee="OPAQUE",alphaCutoff:ie=.5,normalTexture:se,occlusionTexture:fe,emissiveTexture:pe,doubleSided:_e}=N,{baseColorFactor:ke=[1,1,1,1],metallicFactor:Re=1,roughnessFactor:Ne=1,baseColorTexture:Fe,metallicRoughnessTexture:Ue}=N.pbrMetallicRoughness||{},ft=fe?H[fe.index]:void 0;if(fe&&fe.extensions&&fe.extensions.KHR_texture_transform&&ft){const We=fe.extensions.KHR_texture_transform;ft.offsetScale=[We.offset[0],We.offset[1],We.scale[0],We.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ir(...ke),metallicFactor:Re,roughnessFactor:Ne,baseColorTexture:Fe?H[Fe.index]:void 0,metallicRoughnessTexture:Ue?H[Ue.index]:void 0},doubleSided:_e,emissiveFactor:new Ir(...W),alphaMode:ee,alphaCutoff:ie,normalTexture:se?H[se.index]:void 0,occlusionTexture:ft,emissionTexture:pe?H[pe.index]:void 0,defined:N.defined===void 0}})(j!==void 0?r.json.materials[j]:{defined:!1},a),_}function kM(l,r,a){const{matrix:h,rotation:f,translation:_,scale:y,mesh:T,extras:C,children:k}=l,L={};if(L.matrix=h||(function(j,N,H,W){var ee=N[0],ie=N[1],se=N[2],fe=N[3],pe=ee+ee,_e=ie+ie,ke=se+se,Re=ee*pe,Ne=ee*_e,Fe=ee*ke,Ue=ie*_e,ft=ie*ke,We=se*ke,mt=fe*pe,Ct=fe*_e,yt=fe*ke,xt=W[0],Rt=W[1],ht=W[2];return j[0]=(1-(Ue+We))*xt,j[1]=(Ne+yt)*xt,j[2]=(Fe-Ct)*xt,j[3]=0,j[4]=(Ne-yt)*Rt,j[5]=(1-(Re+We))*Rt,j[6]=(ft+mt)*Rt,j[7]=0,j[8]=(Fe+Ct)*ht,j[9]=(ft-mt)*ht,j[10]=(1-(Re+Ue))*ht,j[11]=0,j[12]=H[0],j[13]=H[1],j[14]=H[2],j[15]=1,j})([],f||[0,0,0,1],_||[0,0,0],y||[1,1,1]),T!==void 0){L.meshes=a[T];const j=L.anchor=[0,0];for(const N of L.meshes){const{min:H,max:W}=N.aabb;j[0]+=H[0]+W[0],j[1]+=H[1]+W[1]}j[0]=Math.floor(j[0]/L.meshes.length/2),j[1]=Math.floor(j[1]/L.meshes.length/2)}if(C&&(C.id&&(L.id=C.id),C.lights&&(L.lights=(function(j){if(!j.length)return[];const N=(function(se){const fe=atob(se),pe=new Uint8Array(fe.length);for(let _e=0;_e<fe.length;_e++)pe[_e]=fe.codePointAt(_e);return pe})(j),H=[],W=N.length/24,ee=new Uint16Array(N.buffer),ie=new Float32Array(N.buffer);for(let se=0;se<W;se++){const fe=ee[2*se*6]/30,pe=ee[2*se*6+1]/30,_e=ee[2*se*6+10]/100,ke=ie[6*se+1],Re=ie[6*se+2],Ne=ie[6*se+3],Fe=ie[6*se+4],Ue=Ne-ke,ft=Fe-Re,We=Math.hypot(Ue,ft);H.push({pos:[ke+.5*Ue,Re+.5*ft,pe],normal:[ft/We,-Ue/We,0],width:We,height:fe,depth:_e,points:[ke,Re,Ne,Fe]})}return H})(C.lights))),k){const j=[];for(const N of k)j.push(kM(r.json.nodes[N],r,a));L.children=j}return L}function g$(l){if(l.vertices.length===0||l.indices.length===0)return null;const r=new p0(l.vertices,l.indices,8,256),[a,h]=[r.min.clone(),r.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:r,min:a,max:h}}function _$(l){if(!l.extras||!l.extras.ground)return null;const r=l.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const a=r[0];if(!a||!Array.isArray(a)||a.length===0)return null;const h=[];for(const y of a){if(!Array.isArray(y)||y.length!==2)continue;const T=y[0],C=y[1];typeof T=="number"&&typeof C=="number"&&h.push(new It(T,C))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let f=0;for(let y=0;y<h.length;y++){const T=h[y],C=h[(y+1)%h.length],k=h[(y+2)%h.length];f+=(T.x-C.x)*(k.y-C.y)-(k.x-C.x)*(T.y-C.y)}f>0&&h.reverse();const _=D_(h.flatMap((y=>[y.x,y.y])),[]);return _.length===0?null:{vertices:h,indices:_}}function y$(l,r){const a=[],h=[];let f=0;const _=[];for(const y of l){f=a.length;const T=y.vertexArray.float32,C=y.indexArray.uint16;for(let k=0;k<y.vertexArray.length;k++)_[0]=T[3*k+0],_[1]=T[3*k+1],_[2]=T[3*k+2],wn(_,_,r),a.push(new It(_[0],_[1]));for(let k=0;k<3*y.indexArray.length;k++)h.push(C[k]+f)}if(h.length%3!=0)return null;for(let y=0;y<h.length;y+=3){const T=a[h[y+0]],C=a[h[y+1]],k=a[h[y+2]];(T.x-C.x)*(k.y-C.y)-(k.x-C.x)*(T.y-C.y)>0&&([h[y+1],h[y+2]]=[h[y+2],h[y+1]])}return{vertices:a,indices:h}}function RM(l){const r=(function(C,k){const L=[],j=WebGL2RenderingContext;if(C.json.textures)for(const N of C.json.textures){const H={magFilter:j.LINEAR,minFilter:j.NEAREST,wrapS:j.REPEAT,wrapT:j.REPEAT};N.sampler!==void 0&&Object.assign(H,C.json.samplers[N.sampler]),L.push({image:k[N.source],sampler:H,uploaded:!1})}return L})(l,l.images),a=(function(C,k){const L=[];for(const j of C.json.meshes){const N=[];for(const H of j.primitives)N.push(m$(H,C,k));L.push(N)}return L})(l,r),{scenes:h,scene:f,nodes:_}=l.json,y=h?h[f||0].nodes:[..._.keys()],T=[];for(const C of y)T.push(kM(_[C],l,a));return(function(C,k,L){const j={},N=new Set;for(let H=0;H<C.length;H++){const W=L[k[H]];if(!W.extras)continue;const ee=W.extras["mapbox:footprint:version"],ie=W.extras["mapbox:footprint:id"];(ee||ie)&&N.add(H),ee==="1.0.0"&&ie&&(j[ie]=H)}for(let H=0;H<C.length;H++){if(N.has(H))continue;const W=C[H],ee=L[k[H]];if(!ee.extras)continue;let ie=null;W.id in j&&(ie=y$(C[j[W.id]].meshes,W.matrix)),ie||(ie=_$(ee)),ie&&(W.footprint=g$(ie))}if(N.size>0){const H=Array.from(N.values()).sort(((W,ee)=>W-ee));for(let W=H.length-1;W>=0;W--)C.splice(H[W],1)}})(T,y,l.json.nodes),T}function v$(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const r=l.vertexArray.float32,a=l.aabb.min[0]-1,h=l.aabb.min[1]-1,f=xg/(l.aabb.max[0]-a+2),_=xg/(l.aabb.max[1]-h+2);for(let y=0;y<r.length;y+=3){const T=r[y+2],C=(r[y+0]-a)*f|0,k=(r[y+1]-h)*_|0;T>l.heightmap[k*xg+C]&&(l.heightmap[k*xg+C]=T)}}function OM(l,r,a,h,f){a.reserve(a.length+4*l.length),h.reserve(h.length+10*l.length),f.reserve(f.length+10*l.length);let _=h.length;for(const y of l){const T=Math.min(10,Math.max(4,1.3*y.height))*r,C=[-y.normal[1],y.normal[0],0],k=Math.min(.29,.1*y.width/y.depth),L=y.width-2*y.depth*r*(k+.01),j=zt([],y.pos,C,L/2),N=zt([],y.pos,C,-L/2),H=[j[0],j[1],j[2]+y.height],W=[N[0],N[1],N[2]+y.height],ee=zt([],y.normal,C,k);et(ee,ee,T);const ie=zt([],y.normal,C,-k);et(ie,ie,T),St(ee,j,ee),St(ie,N,ie),j[2]+=.1,N[2]+=.1,h.emplaceBack(ee[0],ee[1],ee[2]),h.emplaceBack(ie[0],ie[1],ie[2]),h.emplaceBack(j[0],j[1],j[2]),h.emplaceBack(N[0],N[1],N[2]),h.emplaceBack(H[0],H[1],H[2]),h.emplaceBack(W[0],W[1],W[2]),h.emplaceBack(j[0],j[1],j[2]),h.emplaceBack(N[0],N[1],N[2]),h.emplaceBack(ee[0],ee[1],ee[2]),h.emplaceBack(ie[0],ie[1],ie[2]);const se=L/T/2;f.emplaceBack(-se-k,-1,se,.8),f.emplaceBack(se+k,-1,se,.8),f.emplaceBack(-se,0,se,1.3),f.emplaceBack(se,0,se,1.3),f.emplaceBack(se+k,-.8,se,.7),f.emplaceBack(se+k,-.8,se,.7),f.emplaceBack(0,0,se,1.3),f.emplaceBack(0,0,se,1.3),f.emplaceBack(se+k,-1.2,se,.8),f.emplaceBack(se+k,-1.2,se,.8),a.emplaceBack(6+_,4+_,8+_),a.emplaceBack(7+_,9+_,5+_),a.emplaceBack(0+_,1+_,2+_),a.emplaceBack(1+_,3+_,2+_),_+=10}}function x$(l,r){const a={};a.indexArray=new ss,a.vertexArray=new qs,a.colorArray=new Ca,OM(l,r,a.indexArray,a.vertexArray,a.colorArray);const h={defined:!0};h.emissiveFactor=Ir.black;const f={};return f.baseColorFactor=Ir.white,h.pbrMetallicRoughness=f,a.material=h,a.aabb=new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const DM=vr([{name:"a_pos_3f",components:3,type:"Float32"}]),b$=vr([{name:"a_normal_3",components:3,type:"Int16"}]),w$=vr([{name:"a_centroid_3",components:3,type:"Int16"}]),LM=vr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),S$=vr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),T$=vr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),E$=vr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),A$=vr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),jM=wt.types,US=32767;function C$(l,r){const a=Ft+r;for(const h of l)for(const f of h)if(f.x<-r||f.x>a||f.y<-r||f.y>a)return!1;return!0}class zM{constructor(){this.layoutVertexArray=new qs,this.layoutAttenuationArray=new Ca,this.layoutColorArray=new is,this.indexArray=new ss,this.indexArrayForConflation=new ss,this.segmentsBucket=new Rr}}class VS{constructor(){this.layoutVertexArray=new qs,this.layoutNormalArray=new cu,this.layoutCentroidArray=new cu,this.layoutColorArray=new is,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new ss,this.indexArrayForConflation=new ss,this.segmentsBucket=new Rr,this.entranceBloom=new zM}}class NM{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new VS,this.buildingWithFacade=new VS,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.buildingWithFacade.layoutFacadePaintArray=new is,this.buildingWithFacade.layoutFacadeDataArray=new lh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new is,this.programConfigurations=new rl(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=r.projection,this.groundEffect=new AS(r)}updateFootprints(r,a){for(const h of this.footprints)a.push({footprint:h,id:r})}prepare(){return(function(){if(b0!=null||gM!=null)return null;if(F_!=null)return F_;const r=fetch(ro.BUILDING_GEN_URL);return F_=(function(a){let h,f,_,y;function T(){h=new Uint8Array(y.buffer),f=new Int32Array(y.buffer),_=new Float32Array(y.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},L={a:{a:C,f:function(j){const N=h.length,H=Math.max(j>>>0,Math.ceil(1.2*N)),W=Math.ceil((H-N)/65536);try{return y.grow(W),T(),!0}catch{return!1}},g:C,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,L):a.then((j=>j.arrayBuffer())).then((j=>WebAssembly.instantiate(j,L)))).then((j=>{const N=j.instance.exports;return(0,N.g)(),y=N.f,T(),new e$({setStyle:N.h,setAOOptions:N.i,setMetricOptions:N.j,setStructuralOptions:N.k,setFacadeOptions:N.l,setFauxFacadeOptions:N.m,setFacadeClassifierOptions:N.n,addFeature:N.o,addFacade:N.p,generateMesh:N.q,getLastError:N.r,getOuterRingLength:N.s,getMeshCount:N.t,getPositionsPtr:N.u,getPositionsLength:N.v,getNormalsPtr:N.w,getNormalsLength:N.x,getColorsPtr:N.y,getColorsLength:N.z,getAOPtr:N.A,getAOLength:N.B,getUVPtr:N.C,getUVLength:N.D,getFauxFacadePtr:N.E,getFauxFacadeLength:N.F,getIndicesPtr:N.G,getIndicesLength:N.H,getBuildingPart:N.I,getRingCount:N.J,getRingPtr:N.K,getRingLength:N.L,free:N.M,malloc:N.N,heapU8:h,heap32:f,heapF32:_})}))})(r).then((a=>(F_=null,b0=a,b0))).catch((a=>{_r("Could not load building-gen"),F_=null,gM=a})),F_})()}populate(r,a,h,f){const _=t$();if(!_)return;const y=Xe(h);this.tileToMeter=y,this.brightness=a.brightness,_.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,y],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:y,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const T=new Map;for(const{feature:C}of r){if(jM[C.type]!=="LineString")continue;const k=this.layers[0]._featureFilter.needGeometry,L=Pt(C,k);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),L,h))continue;const j=k?L.geometry:Gt(C,h,f),N=[];for(const ie of j)for(const se of ie)N.push({x:se.x,y:se.y});const H={coordinates:N,crossPerc:C.properties.cross_perc,distanceToRoad:C.properties.distance_to_road,entrances:C.properties.entrances,sourceId:0},W=C.properties.source_id;let ee=T.get(W);ee||(ee=[],T.set(W,ee)),ee.push(H)}this.maxHeight=0;for(const{feature:C,index:k}of r){if(jM[C.type]==="LineString")continue;const L=this.layers[0]._featureFilter.needGeometry,j=Pt(C,L);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom),j,h))continue;const N=L?j.geometry:Gt(C,h,f),H=Qy(N,500);if(!C$(N,163))continue;const W=this.layers[0],ee=W.layout.get("building-base").evaluate(C,{},h),ie=W.layout.get("building-height").evaluate(C,{},h),se=W.layout.get("building-roof-shape").evaluate(C,{},h),fe=W.paint.get("building-ambient-occlusion-intensity"),pe=W.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(se==="flat")continue;const _e=W.layout.get("building-facade").evaluate(C,{},h);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(_e,!1,1);const ke=C.properties.source_id;let Re;Re=T.has(ke)?T.get(ke):[];let Ne=0,Fe=0,Ue=0,ft=0,We=0,mt=0;if(_e){let on=Math.round(W.layout.get("building-facade-floors").evaluate(C,{},h));if(ee===0){on=Math.max(1,on-(Re.length>0?1:0));let Er=4;if(ie>100){const xe=[10,13,15];Er=xe[C.id?C.id%xe.length:0],_.setFacadeOptions(Er,!0)}We=1.6803*Er/y}else We=ee/y;mt=ie/y,We=Math.min(We,mt),Ue=W.layout.get("building-facade-unit-width").evaluate(C,{},h)/y,ft=(mt-We)/on,_.setFauxFacadeOptions(!0,!0,Ue);const qn=W.layout.get("building-facade-window").evaluate(C,{},h);Ne=qn[0],Fe=qn[1]}const Ct=[],yt=new It(1/0,1/0),xt=new It(-1/0,-1/0),Rt=new It(0,0);let ht=0;for(const on of H)if(on.length>0){const qn=[];for(const Er of on){const xe=[];for(let be=Er.length-1;be>=0;be--){const it=Er[be];xe.push({x:it.x,y:it.y}),yt.x=Math.min(yt.x,it.x),yt.y=Math.min(yt.y,it.y),xt.x=Math.max(xt.x,it.x),xt.y=Math.max(xt.y,it.y),Rt.x+=it.x,Rt.y+=it.y,ht++}qn.push(xe)}Ct.push({id:C.id?C.id:0,height:ie,minHeight:ee,sourceId:0,roofType:se,coordinates:qn})}Rt.x/=ht||1,Rt.y/=ht||1;const bt=_.generateMesh(Ct,Re);if(typeof bt=="string"){_r(`Unable to generate building ${C.id}: ${bt}`);continue}if(bt.meshes.length===0||bt.modifiedPolygonRings.length===0)continue;let st=0;for(const on of bt.meshes)st+=on.positions.length/3;const nt=_e?this.buildingWithFacade:this.buildingWithoutFacade,Ot=nt.segmentsBucket.prepareSegment(st,nt.layoutVertexArray,nt.indexArray),Mt=[];let bn=null,rn=0,fn=-1;const Ut=nt.indexArray.length;let xn=0;for(const on of bt.meshes){const qn=nt.layoutVertexArray.length;if(on.buildingPart==="entrance"){const dt=new Array;for(let Tn=0;Tn<on.indices.length;Tn+=12){const lr=on.positions[Tn+0],ur=on.positions[Tn+1],sr=on.positions[Tn+3],Vr=on.positions[Tn+4],Ti=on.positions[Tn+2],rr=on.positions[Tn+8]-Ti,li=1,qr=sr-lr,jr=Vr-ur,gi=Math.hypot(qr,jr);dt.push({pos:[lr+.5*qr,ur+.5*jr,Ti],normal:[jr/gi,-qr/gi,0],width:gi,height:rr,depth:li,points:[lr,ur,sr,Vr]})}const Zt=nt.entranceBloom.segmentsBucket.prepareSegment(10*dt.length,nt.entranceBloom.layoutVertexArray,nt.entranceBloom.indexArray),qt=nt.entranceBloom.layoutVertexArray.length;rn=nt.entranceBloom.indexArray.length,OM(dt,.5/this.tileToMeter,nt.entranceBloom.indexArray,nt.entranceBloom.layoutVertexArray,nt.entranceBloom.layoutAttenuationArray);const sn=nt.entranceBloom.layoutVertexArray.length-qt;fn=nt.entranceBloom.indexArray.length-rn;for(let Tn=0;Tn<sn;Tn++)nt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Zt.vertexLength+=sn,Zt.primitiveLength+=fn,bn={part:on.buildingPart,vertexOffset:qt,vertexLength:sn}}for(let dt=0;dt<on.positions.length;dt+=3)xn=Math.max(xn,on.positions[dt+2]),nt.layoutVertexArray.emplaceBack(on.positions[dt],on.positions[dt+1],on.positions[dt+2]);const Er=Math.floor(Rt.x),xe=Math.floor(Rt.y),be=Math.floor(xn);for(let dt=0;dt<on.positions.length;dt+=3)nt.layoutCentroidArray.emplaceBack(Er,xe,be);for(let dt=0;dt<on.normals.length;dt+=3)nt.layoutNormalArray.emplaceBack(on.normals[dt+0]*US,on.normals[dt+1]*US,on.normals[dt+2]*US);for(let dt=0;dt<on.ao.length;dt++)nt.layoutAOArray.push(on.ao[dt]);for(let dt=0;dt<on.colors.length;dt+=3){const Zt=1+(on.ao[dt/3]-1)*fe;nt.layoutColorArray.emplaceBack(on.colors[dt]*Zt<<8|on.colors[dt+1]*Zt,on.colors[dt+2]*Zt<<8)}if(_e){for(let dt=0;dt<on.positions.length;dt+=3)nt.layoutFacadePaintArray.emplaceBack(65535,255);for(let dt=0;dt<on.isFauxFacade.length;dt++)if(on.isFauxFacade[dt]){const Zt=1|Math.min(65535,Math.floor(on.uv[2*dt]*bt.outerRingLength)),qt=Math.floor(255*Ne)<<8|Math.floor(255*Fe),sn=Math.floor(65535*Math.min(1,Ue/Ft)),Tn=Math.floor(65535*Math.min(1,ft/Ft));nt.layoutFacadeDataArray.emplaceBack(Zt,qt,sn,Tn);const lr=Math.floor(65535*Math.min(1,We/Ft)),ur=Math.floor(65535*Math.min(1,mt/Ft));nt.layoutFacadeVerticalRangeArray.emplaceBack(lr,ur)}else nt.layoutFacadeDataArray.emplaceBack(0,0,0,0),nt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const it=Ot.vertexLength;for(let dt=0;dt<on.indices.length;dt+=3)nt.indexArray.emplaceBack(it+on.indices[dt],it+on.indices[dt+1],it+on.indices[dt+2]);Ot.vertexLength+=on.positions.length/3,Ot.primitiveLength+=on.indices.length/3,(on.buildingPart==="roof"||on.buildingPart==="wall"||on.buildingPart==="facade_glazing"||on.buildingPart==="entrance")&&Mt.push({part:on.buildingPart,vertexOffset:qn,vertexLength:on.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,xn),this.buildingFeatures.push({feature:j,hasFauxFacade:_e,segment:Ot,parts:Mt,buildingBloom:bn});const Nn=nt.indexArray.length-Ut,Yt=[],mn=[],On=new It(1/0,1/0),Vn=new It(-1/0,-1/0),ar=this.groundEffect.vertexArray.length;for(const on of bt.modifiedPolygonRings){const qn=[],Er=new It(1/0,1/0),xe=new It(-1/0,-1/0);for(let be=0;be<on.length;be+=2){const it=on.length-be-2;Er.x=Math.min(Er.x,on[it]),Er.y=Math.min(Er.y,on[it+1]),xe.x=Math.max(xe.x,on[it]),xe.y=Math.max(xe.y,on[it+1]);const dt=new It(on[it],on[it+1]);qn.push(dt),Yt.push(dt.x,dt.y),mn.push(dt.clone())}On.x=Math.min(On.x,Er.x),On.y=Math.min(On.y,Er.y),Vn.x=Math.max(Vn.x,xe.x),Vn.y=Math.max(Vn.y,xe.y),this.groundEffect.addData(qn,[Er,xe],pe)}const Jn=this.groundEffect.vertexArray.length-ar;(yt.x<0||xt.x>Ft||yt.y<0||xt.y>Ft)&&this.featuresOnBorder.push({featureId:C.id,footprintIndex:this.footprints.length});{const on=D_(Yt,null,2),qn=new p0(mn,on,8,256);let Er=C.id;C.properties&&C.properties.hasOwnProperty("building_id")&&(Er=C.properties.building_id),this.footprints.push({vertices:mn,indices:on,grid:qn,min:On,max:Vn,buildingId:Er,hiddenFlags:0,indicesOffset:Ut,indicesLength:Nn,bloomIndicesOffset:rn,bloomIndicesLength:fn,groundEffectVertexOffset:ar,groundEffectVertexLength:Jn,hasFauxFacade:_e,segment:Ot,height:xn})}this.programConfigurations.populatePaintArrays(nt.layoutVertexArray.length,C,k,{},a.availableImages,h,a.brightness),this.groundEffect.addPaintPropertiesData(C,k,{},a.availableImages,h,a.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(r,a,h,f,_,y,T){this.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T),this.groundEffect.update(r,a,_,h,f,y,T),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const a=h=>{h.layoutVertexBuffer=r.createVertexBuffer(h.layoutVertexArray,DM.members),h.layoutNormalBuffer=r.createVertexBuffer(h.layoutNormalArray,b$.members),h.layoutCentroidBuffer=r.createVertexBuffer(h.layoutCentroidArray,w$.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=r.createVertexBuffer(h.layoutFacadeDataArray,T$.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(h.layoutFacadeVerticalRangeArray,E$.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(h.entranceBloom.layoutVertexArray,DM.members),h.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,A$.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,a,h=!0){let f=!1;const _=h?a:0,y=0|(h?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const T of r){const C=this.footprints[T],k=C.hiddenFlags&y|_;C.hiddenFlags!==k&&(C.hiddenFlags=k,f=!0,this.groundEffect.updateHiddenByLandmarkRange(C.groundEffectVertexOffset,C.groundEffectVertexLength,C.hiddenFlags!==0))}return f&&(this.indexArrayForConflationUploaded=!1),f}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const a=f=>{f.indexArray.length!==0&&(f.indexArrayForConflation.resize(f.indexArray.length),f.indexArrayForConflation.uint16.set(f.indexArray.uint16),f.entranceBloom.indexArrayForConflation.resize(f.entranceBloom.indexArray.length),f.entranceBloom.indexArrayForConflation.uint16.set(f.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const f of this.footprints){const _=f.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,y=f.indicesOffset+f.indicesLength;if(f.hiddenFlags!==0){for(let C=f.indicesOffset;C<y;C++)_.indexArrayForConflation.uint16[3*C+0]=0,_.indexArrayForConflation.uint16[3*C+1]=0,_.indexArrayForConflation.uint16[3*C+2]=0;const T=f.bloomIndicesOffset+f.bloomIndicesLength;for(let C=f.bloomIndicesOffset;C<T;C++)_.entranceBloom.indexArrayForConflation.uint16[3*C+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*C+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*C+2]=0}}const h=f=>{f.indexArray.length!==0&&(f.indexBuffer?f.indexBuffer.updateData(f.indexArrayForConflation):f.indexBuffer=r.createIndexBuffer(f.indexArrayForConflation,!0),f.entranceBloom.indexBuffer?f.entranceBloom.indexBuffer.updateData(f.entranceBloom.indexArrayForConflation):f.entranceBloom.indexBuffer=r.createIndexBuffer(f.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const a=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=r.createVertexBuffer(h.layoutColorArray,LM.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=r.createVertexBuffer(h.layoutFacadePaintArray,S$.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=r.createVertexBuffer(h.entranceBloom.layoutColorArray,LM.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,a){const h=r.paint.get("building-ambient-occlusion-intensity");for(const f of this.buildingFeatures){const _=a[f.feature.id],y=f.feature;y.properties["building-part"]="roof";const T=r.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),C=r.paint.get("building-emissive-strength").evaluate(y,_,this.canonical);y.properties["building-part"]="wall";const k=r.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),L=r.paint.get("building-emissive-strength").evaluate(y,_,this.canonical);y.properties["building-part"]="window";const j=r.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),N=r.paint.get("building-emissive-strength").evaluate(y,_,this.canonical);y.properties["building-part"]="door";const H=r.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),W=r.paint.get("building-emissive-strength").evaluate(y,_,this.canonical),ee=f.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const se of f.parts){let fe,pe=T;se.part==="roof"?(pe=T,fe=C):se.part==="wall"?(pe=k,fe=L):se.part==="facade_glazing"?(pe=j,fe=N):se.part==="entrance"&&(pe=H,fe=W),fe=Oe(fe,0,1);for(let _e=0;_e<se.vertexLength;_e++){const ke=se.vertexOffset+_e,Re=1+(ee.layoutAOArray[ke]-1)*h;ee.layoutColorArray.emplace(ke,pe.r*Re*255<<8|pe.g*Re*255,pe.b*Re*255<<8|255*fe),f.hasFauxFacade&&ee.layoutFacadePaintArray.emplace(ke,255*j.r<<8|255*j.g,255*j.b<<8|255*N)}}const ie=f.buildingBloom;if(ie)for(let se=0;se<ie.vertexLength;se++)ee.entranceBloom.layoutColorArray.emplace(ie.vertexOffset+se,255*H.r<<8|255*H.g,255*H.b<<8|51*W)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(r.toUnwrapped());if(g0(this.activeReplacements,f))return;this.activeReplacements=f;for(const y of this.footprints)y.hiddenFlags&=-2;const _=[];for(const y of this.activeReplacements){if(y.order<=VI)continue;const T=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));for(const C of this.footprints)C.min.x>y.max.x||C.max.x<y.min.x||C.min.y>y.max.y||C.max.y<y.min.y||(_.length=0,P$(C.vertices,0,C.vertices.length,y.footprintTileId.canonical,r.canonical,_),wS(y.footprint,_,C.indices,0,C.indices.length,0,-T)&&(C.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(r,a){let h=Number.NEGATIVE_INFINITY,f=!0;const _=4*(r+Ft)*Ft+(a+Ft);if(this.footprintLookup.hasOwnProperty(_)){const T=this.footprintLookup[_];return T?{height:T.height,hidden:T.hiddenFlags!==0}:void 0}const y=new It(r,a);for(const T of this.footprints)r>T.max.x||T.min.x>r||a>T.max.y||T.min.y>a||T.height<=h||SS(y,T)&&(h=T.height,this.footprintLookup[_]=T,f=T.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:f};this.footprintLookup[_]=void 0}}function P$(l,r,a,h,f,_){const y=Math.pow(2,h.z-f.z);for(let T=0;T<a;T++){let C=l[T+r].x,k=l[T+r].y;C=(C+f.x*Ft)*y-h.x*Ft,k=(k+f.y*Ft)*y-h.y*Ft,_.push(new It(C,k))}}let FM,BM;nn(NM,"BuildingBucket",{omit:["layers"]}),nn(VS,"BuildingGeometry"),nn(zM,"BuildingBloomGeometry");const I$=vr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),M$=vr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:k$}=I$,R$=vr([{name:"a_packed",components:3,type:"Float32"}]),{members:O$}=R$,D$=vr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:L$}=D$;class UM{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new sm({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const h=this.getKey(r,a);return this.positions[h]}trim(){const r=this.width,a=this.height=gn(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,h){const f=[];let _=r.length%2==1?-r[r.length-1]*h:0,y=r[0]*h,T=!0;f.push({left:_,right:y,isDash:T,zeroLength:r[0]===0});let C=r[0];for(let k=1;k<r.length;k++){T=!T;const L=r[k];_=C*h,C+=L,y=C*h,f.push({left:_,right:y,isDash:T,zeroLength:L===0})}return f}addRoundDash(r,a,h){const f=a/2;for(let _=-h;_<=h;_++){const y=this.width*(this.nextRow+h+_);let T=0,C=r[T];for(let k=0;k<this.width;k++){k/C.right>1&&(C=r[++T]);const L=Math.abs(k-C.left),j=Math.abs(k-C.right),N=Math.min(L,j);let H;const W=_/h*(f+1);if(C.isDash){const ee=f-Math.abs(W);H=Math.sqrt(N*N+ee*ee)}else H=f-Math.sqrt(N*N+W*W);this.image.data[y+k]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(r,a){for(let C=r.length-1;C>=0;--C){const k=r[C],L=r[C+1];k.zeroLength?r.splice(C,1):L&&L.isDash===k.isDash&&(L.left=k.left,r.splice(C,1))}const h=r[0],f=r[r.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const _=this.width*this.nextRow;let y=0,T=r[y];for(let C=0;C<this.width;C++){C/T.right>1&&(T=r[++y]);const k=Math.abs(C-T.left),L=Math.abs(C-T.right),j=Math.min(k,L);this.image.data[_+C]=Math.max(0,Math.min(255,(T.isDash?j:-j)+a+128))}}addDash(r,a){const h=this.getKey(r,a);if(this.positions[h])return this.positions[h];const f=a==="round",_=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return _r("LineAtlas out of space"),null;r.length===0&&r.push(1);let T=0;for(let L=0;L<r.length;L++)r[L]<0&&(_r("Negative value is found in line dasharray, replacing values with 0"),r[L]=0),T+=r[L];if(T!==0){const L=this.width/T,j=this.getDashRanges(r,this.width,L);f?this.addRoundDash(j,L,_):this.addRegularDash(j,a==="square"?.5*L:0)}const C=this.nextRow+_;this.nextRow+=y;const k={tl:[C,_],br:[T,0]};return this.positions[h]=k,k}}nn(UM,"LineAtlas");const j$=wt.types,z$=Math.cos(Math.PI/180*37.5),N$=Math.cos(Math.PI/180*5);class $S{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((a=>{this.gradients[a.id]={}})),this.layoutVertexArray=new Ed,this.layoutVertexArray2=new qs,this.patternVertexArray=new qs,this.indexArray=new ss,this.programConfigurations=new rl(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Rr,this.maxLineLength=0,this.zOffsetVertexArray=new qs,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.tessellationStep=r.tessellationStep?r.tessellationStep:Ft/64,this.worldview=r.worldview}updateFootprints(r,a){}populate(r,a,h,f){this.hasPattern=gS("line",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Xe(h);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const N=this.layers[0].layout.get("line-z-offset"),H=N.isConstant()&&!N.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&H?"none":"offset",this.elevationType==="offset"&&y==="none"&&_r(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&T!==void 0;const C=[];for(const{feature:N,id:H,index:W,sourceLayerIndex:ee}of r){const ie=this.layers[0]._featureFilter.needGeometry,se=Pt(N,ie);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{worldview:this.worldview}),se,h))continue;const fe=_?_.evaluate(se,{},h):void 0,pe={id:H,properties:N.properties,type:N.type,sourceLayerIndex:ee,index:W,geometry:ie?se.geometry:Gt(N,h,f),patterns:{},sortKey:fe};C.push(pe)}_&&C.sort(((N,H)=>N.sortKey-H.sortKey));const{lineAtlas:k,featureIndex:L}=a,j=this.addConstantDashes(k);for(const N of C){const{geometry:H,index:W,sourceLayerIndex:ee}=N;if(j&&this.addFeatureDashes(N,k),this.hasPattern){const ie=_S("line",this.layers,N,this.zoom,this.pixelRatio,a);this.patternFeatures.push(ie)}else this.addFeature(N,H,W,h,k.positions,a.availableImages,a.brightness,a.elevationFeatures);L.insert(r[W].feature,H,W,ee,this.index)}}addConstantDashes(r){let a=!1;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(f.kind!=="constant"||_.kind!=="constant")a=!0;else{const y=_.value,T=f.value;if(!T)continue;r.addDash(T,y)}}return a}addFeatureDashes(r,a){const h=this.zoom;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(_.kind==="constant"&&y.kind==="constant")continue;let T,C;if(_.kind==="constant"){if(T=_.value,!T)continue}else T=_.evaluate({zoom:h},r);C=y.kind==="constant"?y.value:y.evaluate({zoom:h},r),a.addDash(T,C),r.patterns[f.id]=[a.getKey(T,C)]}}update(r,a,h,f,_,y,T,C){this.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T,C)}addFeatures(r,a,h,f,_,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,a,h,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,O$)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,L$)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,M$.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,k$),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,a){let h,f;if(a&&a>0?(h=`mapbox_clip_start_${a}`,f=`mapbox_clip_end_${a}`):(h="mapbox_clip_start",f="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(h)&&r.properties.hasOwnProperty(f))return{start:+r.properties[h],end:+r.properties[f]}}addFeature(r,a,h,f,_,y,T,C){const k=this.layers[0].layout,L=k.get("line-join").evaluate(r,{}),j=k.get("line-cap").evaluate(r,{}),N=k.get("line-miter-limit"),H=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const W=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=k.get("line-z-offset").value;const ee=this.layers[0].paint.get("line-width").value;if(ee.kind!=="constant"&&ee.isLineProgressConstant===!1&&(this.variableWidthValue=ee),this.elevationType==="road"){const ie=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,a,f,C,L,j,N,H)){const[se,fe]=this.clipRuntimeLinesToTile(a,1);for(let pe=0;pe<se.length;pe++){const _e=se[pe],ke=fe[pe],Re={progress:{min:ke.progress.min,max:ke.progress.max},nextDir:this.computeSegNextDir(ke,_e),prevDir:this.computeSegPrevDir(ke,_e)};this.addLine(_e,r,f,L,j,N,H,Re,W&&ke.parentIndex>0?ke.parentIndex:null)}this.fillNonElevatedRoadSegment(ie)}}else for(let ie=0;ie<a.length;ie++)this.addLine(a[ie],r,f,L,j,N,H,void 0,W&&ie>0?ie:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,y,f,T,void 0,this.worldview)}computeSegNextDir(r,a){return r.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(r,a){return a[1].sub(r.prevPoint).unit()}clipLinesToTile(r,a){return v0(r,-a,-a,Ft+a,Ft+a)}clipRuntimeLinesToTile(r,a){const h=[];return[v0(r,-a,-a,Ft+a,Ft+a,h),h]}addElevatedRoadFeature(r,a,h,f,_,y,T,C){const k=[],L=ai.getElevationFeature(r,f);if(L){const j=this.clipLinesToTile(a,1),N=this.prepareElevatedLines(j,L,h);for(const H of N)k.push({geometry:H,elevation:L,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(k.length===0)return!1;for(const j of k){const N=this.layoutVertexArray.length;this.addLine(j.geometry,r,h,_,y,T,C);const H=new Zi(h,j.elevationTileID);if(j.elevation)for(let W=N;W<this.layoutVertexArray.length;W++){const ee=new It(this.layoutVertexArray.int16[6*W]>>1,this.layoutVertexArray.int16[6*W+1]>>1),ie=H.pointElevation(ee,j.elevation,.05);this.updateHeightRange(ie),this.zOffsetVertexArray.emplaceBack(ie,0,0)}else this.fillNonElevatedRoadSegment(N)}return!0}prepareElevatedLines(r,a,h){if(a.constantHeight!=null)return r;const f=[],_=1/Xe(h);for(const y of r)K6(y,new Br(a,_),0,f);return f}fillNonElevatedRoadSegment(r){for(let a=r;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,a,h,f,_,y,T,C,k){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=k?this.lineFeatureClips(a,k):this.lineClips;const L=f==="none";this.patternJoinNone=this.hasPattern&&L,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const j=C&&C.progress.min>0,N=C&&C.progress.max<1;if(this.lineClips){let Ue={min:this.lineClips.start,max:this.lineClips.end},ft=1;if(C){const Ct=this.lineClips.end-this.lineClips.start;Ue=(function(yt,xt,Rt){return{min:Ns(yt.min,xt,Rt),max:Ns(yt.max,xt,Rt)}})(C.progress,{min:0,max:1},Ue),Ct>0&&(ft=(Ue.max-Ue.min)/Ct)}const We=+a.properties.mapbox_clip_feature_len,mt=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(We)||Number.isNaN(mt)){for(let yt=0;yt<r.length-1;yt++)this.totalDistance+=r[yt].dist(r[yt+1]);const Ct=this.totalDistance/(Ue.max-Ue.min);this.totalFeatureLength=Number.isFinite(Ct)?Ct:0,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=We,this.distance=mt*ft,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const H=j$[a.type]==="Polygon";let W=r.length;for(;W>=2&&r[W-1].equals(r[W-2]);)W--;let ee=0;for(;ee<W-1&&r[ee].equals(r[ee+1]);)ee++;if(W<(H?3:2))return;f==="bevel"&&(y=1.05);const ie=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let se,fe,pe,_e,ke,Re,Ne,Fe;C&&C.prevDir&&(Re=C.prevDir.perp()),C&&C.nextDir&&(Ne=C.nextDir.perp()),this.e1=this.e2=-1,H&&(se=r[W-2],ke=r[ee].sub(se)._unit()._perp());for(let Ue=ee;Ue<W;Ue++){if(pe=Ue===W-1?H?r[ee+1]:void 0:r[Ue+1],pe&&r[Ue].equals(pe))continue;ke&&(_e=ke),se&&(fe=se),se=r[Ue],Fe=this.evaluateLineProgressFeatures(fe?fe.dist(se):0),ke=pe?pe.sub(se)._unit()._perp():_e,_e=_e||ke;const ft=fe&&pe;let We=ft?f:H||L?"butt":_;const mt=_e.x*ke.x+_e.y*ke.y;if(L){const nt=function(Ot){if(Ot.patternJoinNone){const Mt=Ot.segmentPoints.length/2,bn=Ot.lineSoFar-Ot.segmentStart;for(let rn=0;rn<Mt;++rn){const fn=Ot.segmentPoints[2*rn+1],Ut=Math.round(Ot.segmentPoints[2*rn])+.5+.25*fn;Ot.patternVertexArray.emplaceBack(Ut,bn,Ot.segmentStart),Ot.patternVertexArray.emplaceBack(Ut,bn,Ot.segmentStart)}Ot.segmentPoints.length=0}Ot.e1=Ot.e2=-1};if(ft&&mt<N$){this.updateDistance(fe,se),this.addCurrentVertex(se,_e,1,1,ie,Fe),nt(this),this.addCurrentVertex(se,ke,-1,-1,ie,Fe);continue}if(fe){if(!pe){this.updateDistance(fe,se),this.addCurrentVertex(se,_e,1,1,ie,Fe),nt(this);continue}We="miter"}}let Ct=_e.add(ke);Ct.x===0&&Ct.y===0||Ct._unit();const yt=Ct.x*ke.x+Ct.y*ke.y,xt=yt!==0?1/yt:1/0,Rt=2*Math.sqrt(2-2*yt),ht=yt<z$&&fe&&pe,bt=_e.x*ke.y-_e.y*ke.x>0,st=this.overscaling<=16?15*Ft/(512*this.overscaling):0;if(ft&&We==="round"){if(xt<T)We="miter";else if(xt<=2){const nt=HS(se,-10,Ft+10);We=this.elevationType==="offset"&&(nt||this.hasCrossSlope)?"miter":"fakeround"}}if(We==="miter"&&xt>y&&(We="bevel"),We==="bevel"&&(xt>2&&(We="flipbevel"),xt<y&&(We="miter")),fe&&!(We==="miter"&&ht)&&this.updateDistance(fe,se),We==="miter")if(ht){const nt=se.dist(fe);if(nt>2*st){const Mt=se.sub(se.sub(fe)._mult(st/nt)._round());this.updateDistance(fe,Mt),this.addCurrentVertex(Mt,_e,0,0,ie,Fe),fe=Mt}this.updateDistance(fe,se),Ct._mult(xt),this.addCurrentVertex(se,Ct,0,0,ie,Fe);const Ot=se.dist(pe);if(Ot>2*st){const Mt=se.add(pe.sub(se)._mult(st/Ot)._round());this.updateDistance(se,Mt),this.addCurrentVertex(Mt,ke,0,0,ie,Fe),se=Mt}}else Ct._mult(xt),this.addCurrentVertex(se,Ct,0,0,ie,Fe);else if(We==="flipbevel"){if(xt>100)Ct=ke.mult(-1);else{const nt=xt*_e.add(ke).mag()/_e.sub(ke).mag();Ct._perp()._mult(nt*(bt?-1:1))}this.addCurrentVertex(se,Ct,0,0,ie,Fe),this.addCurrentVertex(se,Ct.mult(-1),0,0,ie,Fe)}else if(We==="bevel"||We==="fakeround"){Fe!=null&&fe&&this.addCurrentVertex(se,Ne||_e,-1,-1,ie,Fe);const nt=se.dist(fe)<=2*st&&We!=="bevel",Ot=Ct.mult(bt?1:-1);Ot._mult(xt);const Mt=ke.mult(bt?-1:1),bn=_e.mult(bt?-1:1),rn=this.evaluateLineProgressFeatures(this.distance);if(Fe==null&&(this.addHalfVertex(se,Ot.x,Ot.y,!1,!bt,0,ie,rn),nt||this.addHalfVertex(se,Ot.x+2*bn.x,Ot.y+2*bn.y,!1,bt,0,ie,rn)),We==="fakeround"){const fn=Math.round(180*Rt/Math.PI/20);this.addHalfVertex(se,bn.x,bn.y,!1,bt,0,ie,rn);for(let Ut=0;Ut<fn;Ut++){let xn=Ut/fn;if(xn!==.5){const Yt=xn-.5;xn+=xn*Yt*(xn-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*Yt*Yt+(.848013+mt*(.215638*mt-1.06021)))}const Nn=Mt.sub(bn)._mult(xn)._add(bn)._unit();this.addHalfVertex(se,Nn.x,Nn.y,!1,bt,0,ie,rn)}this.addHalfVertex(se,Mt.x,Mt.y,!1,bt,0,ie,rn)}nt||Fe!=null||this.addHalfVertex(se,Ot.x+2*Mt.x,Ot.y+2*Mt.y,!1,bt,0,ie,rn),Fe!=null&&pe&&this.addCurrentVertex(se,Re||ke,1,1,ie,Fe)}else if(We==="butt")this.addCurrentVertex(se,Ct,0,0,ie,Fe);else if(We==="square"){if(!fe){const nt=j?0:-1;this.addCurrentVertex(se,Ct,nt,nt,ie,Fe)}if(this.addCurrentVertex(se,Ct,0,0,ie,Fe),fe){const nt=N?0:1;this.addCurrentVertex(se,Ct,nt,nt,ie,Fe)}}else if(We==="round"){if(fe){const nt=!ft&&Ne?Ne:_e;this.addCurrentVertex(se,nt,0,0,ie,Fe),!ft&&N||this.addCurrentVertex(se,nt,1,1,ie,Fe,!0)}if(pe){const nt=!ft&&Re?Re:ke;!ft&&j||this.addCurrentVertex(se,nt,-1,-1,ie,Fe,!0),this.addCurrentVertex(se,nt,0,0,ie,Fe)}}}}addVerticesTo(r,a,h,f,_,y,T,C,k,L){const j=(a.w-r.w)/this.tessellationStep|0;let N=0;const H=this.scaledDistance;if(j>1){this.lineSoFar=r.w;const ee=(a.x-r.x)/j,ie=(a.y-r.y)/j,se=(a.z-r.z)/j,fe=(a.w-r.w)/j;for(let pe=1;pe<j;++pe){r.x+=ee,r.y+=ie,r.z+=se,this.lineSoFar+=fe,N+=fe;const _e=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(r,h,f,L,!1,T,k,_e),this.addHalfVertex(r,_,y,L,!0,-C,k,_e)}}this.lineSoFar=a.w,this.scaledDistance=H;const W=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,h,f,L,!1,T,k,W),this.addHalfVertex(a,_,y,L,!0,-C,k,W)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):_r(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(r,a,h,f,_,y,T=!1){const C=a.x+a.y*h,k=a.y-a.x*h,L=a.y*f-a.x,j=-a.y-a.x*f;if(y!=null){const N=this.elevationType==="offset",H=-10,W=Ft+10,ee=y.zOffset,ie=new cM(r.x,r.y,ee,this.lineSoFar),se=!!N&&HS(r,H,W),fe=this.lineSoFar,pe=this.distance;if(this.currentVertex)if(se){const _e=this.currentVertexIsOutside,ke=this.currentVertex,Re=new cM(r.x,r.y,ee,this.lineSoFar);if(hM(ke,Re,H,W),!HS(Re,H,W)){if(_e){this.e1=this.e2=-1,this.distance-=ke.dist(ie),this.lineSoFar=ke.w;const Ne=this.evaluateLineProgressFeatures(ke.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ke,C,k,T,!1,h,_,Ne),this.addHalfVertex(ke,L,j,T,!0,-f,_,Ne),this.prevDistance=this.distance}this.distance=this.prevDistance+ke.dist(Re),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ke,Re,C,k,L,j,h,f,_,T),this.distance=pe,this.scaledDistance=this.distance/this.totalDistance}}else{const _e=this.currentVertex;if(this.currentVertexIsOutside){hM(_e,ie,H,W),this.e1=this.e2=-1,this.distance-=_e.dist(ie),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=_e.w;const ke=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,C,k,T,!1,h,_,ke),this.addHalfVertex(_e,L,j,T,!0,-f,_,ke),this.prevDistance=this.distance,this.distance=pe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(_e,ie,C,k,L,j,h,f,_,T)}else se||(this.addHalfVertex(r,C,k,T,!1,h,_,y),this.addHalfVertex(r,L,j,T,!0,-f,_,y));this.currentVertex=ie,this.currentVertexIsOutside=se,this.lineSoFar=fe}else this.addHalfVertex(r,C,k,T,!1,h,_,y),this.addHalfVertex(r,L,j,T,!0,-f,_,y)}addHalfVertex({x:r,y:a},h,f,_,y,T,C,k){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((r<<1)+(_?1:0),(a<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const j=An(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,j)}const L=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),C.primitiveLength++),y?this.e2=L:this.e1=L,k!=null&&this.zOffsetVertexArray.emplaceBack(k.zOffset,k.variableWidth,k.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,a){this.prevDistance=this.distance,this.distance+=r.dist(a),this.updateScaledDistance()}}function HS(l,r,a){return l.x<r||l.x>a||l.y<r||l.y>a}let VM,$M;function HM(l,r,a){return r*(Ft/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}nn($S,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const GM=(l,r,a)=>(1-a)*l+a*r;function WM(l,r){return 1/HM(l,1,r.tileZoom)}function qM(l,r,a,h){return l.translatePosMatrix(h||r.tileID.projMatrix,r,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ZM=l=>{const r=[];XM(l)&&r.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const a=l.paint.get("line-trim-offset");a[0]===0&&a[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const h=l.layout.get("line-join").constantOr("miter")==="none",f=!!l.paint.get("line-pattern").constantOr(1);return h&&f&&r.push("LINE_JOIN_NONE"),r};function XM(l){const r=l.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let GS;const YM=()=>GS||(GS={layout:VM||(VM=new di({"line-cap":new $t(He.layout_line["line-cap"]),"line-join":new $t(He.layout_line["line-join"]),"line-miter-limit":new kt(He.layout_line["line-miter-limit"]),"line-round-limit":new kt(He.layout_line["line-round-limit"]),"line-sort-key":new $t(He.layout_line["line-sort-key"]),"line-z-offset":new $t(He.layout_line["line-z-offset"]),"line-elevation-reference":new kt(He.layout_line["line-elevation-reference"]),"line-cross-slope":new kt(He.layout_line["line-cross-slope"]),visibility:new kt(He.layout_line.visibility),"line-width-unit":new kt(He.layout_line["line-width-unit"])})),paint:$M||($M=new di({"line-opacity":new $t(He.paint_line["line-opacity"]),"line-color":new $t(He.paint_line["line-color"]),"line-translate":new kt(He.paint_line["line-translate"]),"line-translate-anchor":new kt(He.paint_line["line-translate-anchor"]),"line-width":new $t(He.paint_line["line-width"]),"line-gap-width":new $t(He.paint_line["line-gap-width"]),"line-offset":new $t(He.paint_line["line-offset"]),"line-blur":new $t(He.paint_line["line-blur"]),"line-dasharray":new $t(He.paint_line["line-dasharray"]),"line-pattern":new $t(He.paint_line["line-pattern"]),"line-pattern-cross-fade":new kt(He.paint_line["line-pattern-cross-fade"]),"line-gradient":new co(He.paint_line["line-gradient"]),"line-trim-offset":new kt(He.paint_line["line-trim-offset"]),"line-trim-fade-range":new kt(He.paint_line["line-trim-fade-range"]),"line-trim-color":new kt(He.paint_line["line-trim-color"]),"line-emissive-strength":new kt(He.paint_line["line-emissive-strength"]),"line-border-width":new $t(He.paint_line["line-border-width"]),"line-border-color":new $t(He.paint_line["line-border-color"]),"line-occlusion-opacity":new kt(He.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},GS);class F$ extends $t{possiblyEvaluate(r,a){return a=new wr(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(r,a)}evaluate(r,a,h,f){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(r,a,h,f)}}let hv;function KM(l,r){return r>0?r+2*l:l}const B$=vr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),U$=vr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),V$=vr([{name:"a_projected_pos",components:4,type:"Float32"}],4);vr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $$=vr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),H$=vr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),G$=vr([{name:"a_texb",components:2,type:"Uint16"}]),W$=vr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),q$=vr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);vr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const JM=vr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Z$=vr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);vr([{name:"triangle",components:3,type:"Uint16"}]),vr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),vr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),vr([{type:"Float32",name:"offsetX"}]),vr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ks=24;function X$(l,r,a){return l.sections.forEach((h=>{h.text=(function(f,_,y){const T=_.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?f=f.toLocaleUpperCase():T==="lowercase"&&(f=f.toLocaleLowerCase()),Ai.applyArabicShaping&&(f=Ai.applyArabicShaping(f)),f})(h.text,r,a)})),l}const dv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Y$(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function K$(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}const WS=4294967296,QM=1/WS,ek=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let C0=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,r,a=this.length){for(;this.pos<a;){const h=this.readVarint(),f=h>>3,_=this.pos;this.type=7&h,l(f,r,this),this.pos===_&&this.skip(h)}return r}readMessage(l,r){return this.readFields(l,r,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*WS;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*WS;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const r=this.buf;let a,h;return h=r[this.pos++],a=127&h,h<128?a:(h=r[this.pos++],a|=(127&h)<<7,h<128?a:(h=r[this.pos++],a|=(127&h)<<14,h<128?a:(h=r[this.pos++],a|=(127&h)<<21,h<128?a:(h=r[this.pos],a|=(15&h)<<28,(function(f,_,y){const T=y.buf;let C,k;if(k=T[y.pos++],C=(112&k)>>4,k<128||(k=T[y.pos++],C|=(127&k)<<3,k<128)||(k=T[y.pos++],C|=(127&k)<<10,k<128)||(k=T[y.pos++],C|=(127&k)<<17,k<128)||(k=T[y.pos++],C|=(127&k)<<24,k<128)||(k=T[y.pos++],C|=(1&k)<<31,k<128))return U_(f,C,_);throw new Error("Expected varint not more than 10 bytes")})(a,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,r=this.pos;return this.pos=l,l-r>=12&&ek?ek.decode(this.buf.subarray(r,l)):(function(a,h,f){let _="",y=h;for(;y<f;){const T=a[y];let C,k,L,j=null,N=T>239?4:T>223?3:T>191?2:1;if(y+N>f)break;N===1?T<128&&(j=T):N===2?(C=a[y+1],(192&C)==128&&(j=(31&T)<<6|63&C,j<=127&&(j=null))):N===3?(C=a[y+1],k=a[y+2],(192&C)==128&&(192&k)==128&&(j=(15&T)<<12|(63&C)<<6|63&k,(j<=2047||j>=55296&&j<=57343)&&(j=null))):N===4&&(C=a[y+1],k=a[y+2],L=a[y+3],(192&C)==128&&(192&k)==128&&(192&L)==128&&(j=(15&T)<<18|(63&C)<<12|(63&k)<<6|63&L,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,N=1):j>65535&&(j-=65536,_+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),_+=String.fromCharCode(j),y+=N}return _})(this.buf,r,l)}readBytes(){const l=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,l);return this.pos=l,r}readPackedVarint(l=[],r){const a=this.readPackedEnd();for(;this.pos<a;)l.push(this.readVarint(r));return l}readPackedSVarint(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const r=7&l;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(l,r){this.writeVarint(l<<3|r)}realloc(l){let r=this.length||16;for(;r<this.pos+l;)r*=2;if(r!==this.length){const a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*QM),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*QM),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?(function(r,a){let h,f;if(r>=0?(h=r%4294967296|0,f=r/4294967296|0):(h=~(-r%4294967296),f=~(-r/4294967296),4294967295^h?h=h+1|0:(h=0,f=f+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(_,y,T){T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,T.buf[T.pos]=127&(_>>>=7)})(h,0,a),(function(_,y){const T=(7&_)<<4;y.buf[y.pos++]|=T|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))})(f,a)})(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const r=this.pos;this.pos=(function(h,f,_){for(let y,T,C=0;C<f.length;C++){if(y=f.charCodeAt(C),y>55295&&y<57344){if(!T){y>56319||C+1===f.length?(h[_++]=239,h[_++]=191,h[_++]=189):T=y;continue}if(y<56320){h[_++]=239,h[_++]=191,h[_++]=189,T=y;continue}y=T-55296<<10|y-56320|65536,T=null}else T&&(h[_++]=239,h[_++]=191,h[_++]=189,T=null);y<128?h[_++]=y:(y<2048?h[_++]=y>>6|192:(y<65536?h[_++]=y>>12|224:(h[_++]=y>>18|240,h[_++]=y>>12&63|128),h[_++]=y>>6&63|128),h[_++]=63&y|128)}return _})(this.buf,l,this.pos);const a=this.pos-r;a>=128&&tk(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const r=l.length;this.writeVarint(r),this.realloc(r);for(let a=0;a<r;a++)this.buf[this.pos++]=l[a]}writeRawMessage(l,r){this.pos++;const a=this.pos;l(r,this);const h=this.pos-a;h>=128&&tk(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h}writeMessage(l,r,a){this.writeTag(l,2),this.writeRawMessage(r,a)}writePackedVarint(l,r){r.length&&this.writeMessage(l,J$,r)}writePackedSVarint(l,r){r.length&&this.writeMessage(l,Q$,r)}writePackedBoolean(l,r){r.length&&this.writeMessage(l,n8,r)}writePackedFloat(l,r){r.length&&this.writeMessage(l,e8,r)}writePackedDouble(l,r){r.length&&this.writeMessage(l,t8,r)}writePackedFixed32(l,r){r.length&&this.writeMessage(l,r8,r)}writePackedSFixed32(l,r){r.length&&this.writeMessage(l,i8,r)}writePackedFixed64(l,r){r.length&&this.writeMessage(l,s8,r)}writePackedSFixed64(l,r){r.length&&this.writeMessage(l,o8,r)}writeBytesField(l,r){this.writeTag(l,2),this.writeBytes(r)}writeFixed32Field(l,r){this.writeTag(l,5),this.writeFixed32(r)}writeSFixed32Field(l,r){this.writeTag(l,5),this.writeSFixed32(r)}writeFixed64Field(l,r){this.writeTag(l,1),this.writeFixed64(r)}writeSFixed64Field(l,r){this.writeTag(l,1),this.writeSFixed64(r)}writeVarintField(l,r){this.writeTag(l,0),this.writeVarint(r)}writeSVarintField(l,r){this.writeTag(l,0),this.writeSVarint(r)}writeStringField(l,r){this.writeTag(l,2),this.writeString(r)}writeFloatField(l,r){this.writeTag(l,5),this.writeFloat(r)}writeDoubleField(l,r){this.writeTag(l,1),this.writeDouble(r)}writeBooleanField(l,r){this.writeVarintField(l,+r)}};function U_(l,r,a){return a?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}function tk(l,r,a){const h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(h);for(let f=a.pos-1;f>=l;f--)a.buf[f+h]=a.buf[f]}function J$(l,r){for(let a=0;a<l.length;a++)r.writeVarint(l[a])}function Q$(l,r){for(let a=0;a<l.length;a++)r.writeSVarint(l[a])}function e8(l,r){for(let a=0;a<l.length;a++)r.writeFloat(l[a])}function t8(l,r){for(let a=0;a<l.length;a++)r.writeDouble(l[a])}function n8(l,r){for(let a=0;a<l.length;a++)r.writeBoolean(l[a])}function r8(l,r){for(let a=0;a<l.length;a++)r.writeFixed32(l[a])}function i8(l,r){for(let a=0;a<l.length;a++)r.writeSFixed32(l[a])}function s8(l,r){for(let a=0;a<l.length;a++)r.writeFixed64(l[a])}function o8(l,r){for(let a=0;a<l.length;a++)r.writeSFixed64(l[a])}const qS=3;function a8(l,r,a){r.glyphs=[],l===1&&a.readMessage(l8,r)}function l8(l,r,a){if(l===3){const{id:h,bitmap:f,width:_,height:y,left:T,top:C,advance:k}=a.readMessage(c8,{});r.glyphs.push({id:h,bitmap:new sm({width:_+2*qS,height:y+2*qS},f),metrics:{width:_,height:y,left:T,top:C,advance:k}})}else l===4?r.ascender=a.readSVarint():l===5&&(r.descender=a.readSVarint())}function c8(l,r,a){l===1?r.id=a.readVarint():l===2?r.bitmap=a.readBytes():l===3?r.width=a.readVarint():l===4?r.height=a.readVarint():l===5?r.left=a.readSVarint():l===6?r.top=a.readSVarint():l===7&&(r.advance=a.readVarint())}const nk=qS,Il={horizontal:1,vertical:2,horizontalOnly:3};class fv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,a){const h=new fv;return h.scale=r||1,h.fontStack=a,h}static forImage(r){const a=new fv;return a.image=r,a}}class V_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a,h){const f=new V_;for(let _=0;_<r.sections.length;_++){const y=r.sections[_];y.image?f.addImageSection(y,h):f.addTextSection(y,a)}return f}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=(function(a,h){let f="";for(let _=0;_<a.length;_++){const y=a.charCodeAt(_+1)||null,T=a.charCodeAt(_-1)||null;f+=!h&&(y&&su(y)&&!dv[a[_+1]]||T&&su(T)&&!dv[a[_-1]])||!dv[a[_]]?a[_]:dv[a[_]]}return f})(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&P0[this.text.charCodeAt(h)];h++)r++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&P0[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const h=new V_;return h.text=this.text.substring(r,a),h.sectionIndex=this.sectionIndex.slice(r,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,a)=>Math.max(r,this.sections[a].scale)),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(fv.forText(r.scale,r.fontStack||a));const h=this.sections.length-1;for(let f=0;f<r.text.length;++f)this.sectionIndex.push(h)}addImageSection(r,a){const h=r.image?r.image.getPrimary():null;if(!h)return void _r("Can't add FormattedSection with an empty image.");h.scaleSelf(a);const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCodePoint(f),this.sections.push(fv.forImage(h)),this.sectionIndex.push(this.sections.length-1)):_r("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ZS(l,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee=1){const ie=V_.fromFeature(l,f,ee);j===Il.vertical&&ie.verticalizePunctuation(N);let se=[];const fe=(function(Ne,Fe,Ue,ft,We,mt){if(!Ne)return[];const Ct=[],yt=(function(bt,st,nt,Ot,Mt,bn){let rn=0;for(let fn=0;fn<bt.length();fn++){const Ut=bt.getSection(fn);rn+=rk(bt.getCodePoint(fn),Ut,Ot,Mt,st,bn)}return rn/Math.max(1,Math.ceil(rn/nt))})(Ne,Fe,Ue,ft,We,mt),xt=Ne.text.indexOf("")>=0;let Rt=0;for(let bt=0;bt<Ne.length();bt++){const st=Ne.getSection(bt),nt=Ne.getCodePoint(bt);if(P0[nt]||(Rt+=rk(nt,st,ft,We,Fe,mt)),bt<Ne.length()-1){const Ot=!((ht=nt)<11904||!(Cn["Bopomofo Extended"](ht)||Cn.Bopomofo(ht)||Cn["CJK Compatibility Forms"](ht)||Cn["CJK Compatibility Ideographs"](ht)||Cn["CJK Compatibility"](ht)||Cn["CJK Radicals Supplement"](ht)||Cn["CJK Strokes"](ht)||Cn["CJK Symbols and Punctuation"](ht)||Cn["CJK Unified Ideographs Extension A"](ht)||Cn["CJK Unified Ideographs"](ht)||Cn["Enclosed CJK Letters and Months"](ht)||Cn["Halfwidth and Fullwidth Forms"](ht)||Cn.Hiragana(ht)||Cn["Ideographic Description Characters"](ht)||Cn["Kangxi Radicals"](ht)||Cn["Katakana Phonetic Extensions"](ht)||Cn.Katakana(ht)||Cn["Vertical Forms"](ht)||Cn["Yi Radicals"](ht)||Cn["Yi Syllables"](ht)));(u8[nt]||Ot||st.image)&&Ct.push(sk(bt+1,Rt,yt,Ct,h8(nt,Ne.getCodePoint(bt+1),Ot&&xt),!1))}}var ht;return ok(sk(Ne.length(),Rt,yt,Ct,0,!0))})(ie,k,_,r,h,H),{processBidirectionalText:pe,processStyledBidirectionalText:_e}=Ai;if(pe&&ie.sections.length===1){const Ne=pe(ie.toString(),fe);for(const Fe of Ne){const Ue=new V_;Ue.text=Fe,Ue.sections=ie.sections;for(let ft=0;ft<Fe.length;ft++)Ue.sectionIndex.push(0);se.push(Ue)}}else if(_e){const Ne=_e(ie.text,ie.sectionIndex,fe);for(const Fe of Ne){const Ue=new V_;Ue.text=Fe[0],Ue.sectionIndex=Fe[1],Ue.sections=ie.sections,se.push(Ue)}}else se=(function(Ne,Fe){const Ue=[],ft=Ne.text;let We=0;for(const mt of Fe)Ue.push(Ne.substring(We,mt)),We=mt;return We<ft.length&&Ue.push(Ne.substring(We,ft.length)),Ue})(ie,fe);const ke=[],Re={positionedLines:ke,text:ie.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:j,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ne,Fe,Ue,ft,We,mt,Ct,yt,xt,Rt,ht,bt){let st=0,nt=0,Ot=0;const Mt=yt==="right"?1:yt==="left"?0:.5;let bn=!1;for(const Yt of We){const mn=Yt.getSections();for(const On of mn){if(On.image)continue;const Vn=Fe[On.fontStack];if(Vn&&(bn=Vn.ascender!==void 0&&Vn.descender!==void 0,!bn))break}if(!bn)break}let rn=0;for(const Yt of We){Yt.trim();const mn=Yt.getMaxScale(),On=(mn-1)*Ks,Vn={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[rn]=Vn;const ar=Vn.positionedGlyphs;let Jn=0;if(!Yt.length()){nt+=mt,++rn;continue}let on=0,qn=0;for(let xe=0;xe<Yt.length();xe++){const be=Yt.getSection(xe),it=Yt.getSectionIndex(xe),dt=Yt.getCodePoint(xe);let Zt=be.scale,qt=null,sn=null,Tn=null,lr=Ks,ur=0,sr=xt;sr===Il.vertical&&((fn=dt)===12312||fn===12313||fn===12316||fn===12540||fn===12448)&&(sr=Il.horizontal);const Vr=!(sr===Il.horizontal||!ht&&!Sa(dt)||ht&&(P0[dt]||kf(dt)));if(be.image){const Ti=ft.get(be.image.toString());if(!Ti)continue;Tn=be.image,Ne.iconsInText=Ne.iconsInText||!0,sn=Ti.paddedRect;const rr=Ti.displaySize;Zt=Zt*Ks/bt,qt={width:rr[0],height:rr[1],left:0,top:-nk,advance:Vr?rr[1]:rr[0],localGlyph:!1},ur=bn?-qt.height*Zt:mn*Ks-17-rr[1]*Zt,lr=qt.advance;const li=(Vr?rr[0]:rr[1])*Zt-Ks*mn;li>0&&li>Jn&&(Jn=li)}else{const Ti=Ue[be.fontStack];if(!Ti)continue;Ti[dt]&&(sn=Ti[dt]);const rr=Fe[be.fontStack];if(!rr)continue;const li=rr.glyphs[dt];if(!li)continue;if(qt=li.metrics,lr=dt!==8203?Ks:0,bn){const qr=rr.ascender!==void 0?Math.abs(rr.ascender):0,jr=rr.descender!==void 0?Math.abs(rr.descender):0,gi=(qr+jr)*Zt;on<gi&&(on=gi,qn=(qr-jr)/2*Zt),ur=-qr*Zt}else ur=(mn-Zt)*Ks-17}Vr?(Ne.verticalizable=!0,ar.push({glyph:dt,image:Tn,x:st,y:nt+ur,vertical:Vr,scale:Zt,localGlyph:qt.localGlyph,fontStack:be.fontStack,sectionIndex:it,metrics:qt,rect:sn}),st+=lr*Zt+Rt):(ar.push({glyph:dt,image:Tn,x:st,y:nt+ur,vertical:Vr,scale:Zt,localGlyph:qt.localGlyph,fontStack:be.fontStack,sectionIndex:it,metrics:qt,rect:sn}),st+=qt.advance*Zt+Rt)}ar.length!==0&&(Ot=Math.max(st-Rt,Ot),bn?ak(ar,Mt,Jn,qn,mt*mn/2):ak(ar,Mt,Jn,0,mt/2)),st=0;const Er=mt*mn+Jn;Vn.lineOffset=Math.max(Jn,On),nt+=Er,++rn}var fn;const Ut=nt,{horizontalAlign:xn,verticalAlign:Nn}=XS(Ct);(function(Yt,mn,On,Vn,ar,Jn){const on=(mn-On)*ar,qn=-Jn*Vn;for(const Er of Yt)for(const xe of Er.positionedGlyphs)xe.x+=on,xe.y+=qn})(Ne.positionedLines,Mt,xn,Nn,Ot,Ut),Ne.top+=-Nn*Ut,Ne.bottom=Ne.top+Ut,Ne.left+=-xn*Ot,Ne.right=Ne.left+Ot,Ne.hasBaseline=bn})(Re,r,a,h,se,y,T,C,j,k,N,W),!(function(Ne){for(const Fe of Ne)if(Fe.positionedGlyphs.length!==0)return!1;return!0})(ke))return Re}const P0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},u8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rk(l,r,a,h,f,_){if(r.image){const y=h.get(r.image.toString());return y?y.displaySize[0]*r.scale*Ks/_+f:0}{const y=a[r.fontStack],T=y&&y.glyphs[l];return T?T.metrics.advance*r.scale+f:0}}function ik(l,r,a,h){const f=Math.pow(l-r,2);return h?l<r?f/2:2*f:f+Math.abs(a)*a}function h8(l,r,a){let h=0;return l===10&&(h-=1e4),a&&(h+=150),l!==40&&l!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function sk(l,r,a,h,f,_){let y=null,T=ik(r,a,f,_);for(const C of h){const k=ik(r-C.x,a,f,_)+C.badness;k<=T&&(y=C,T=k)}return{index:l,x:r,priorBreak:y,badness:T}}function ok(l){return l?ok(l.priorBreak).concat(l.index):[]}function XS(l){let r=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function ak(l,r,a,h,f){if(!(r||a||h||f))return;const _=l.length-1,y=l[_],T=(y.x+y.metrics.advance*y.scale)*r;for(let C=0;C<=_;C++)l[C].x-=T,l[C].y+=a+h+f}function lk(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function d8(l,r,a,h){const{horizontalAlign:f,verticalAlign:_}=XS(h),y=a[0]-l.displaySize[0]*f,T=a[1]-l.displaySize[1]*_;return{imagePrimary:l,imageSecondary:r,top:T,bottom:T+l.displaySize[1],left:y,right:y+l.displaySize[0]}}function ck(l,r,a,h,f,_){const y=l.imagePrimary;let T;if(y.content){const ie=y.content,se=y.pixelRatio||1;T=[ie[0]/se,ie[1]/se,y.displaySize[0]-ie[2]/se,y.displaySize[1]-ie[3]/se]}const C=r.left*_,k=r.right*_;let L,j,N,H;a==="width"||a==="both"?(H=f[0]+C-h[3],j=f[0]+k+h[1]):(H=f[0]+(C+k-y.displaySize[0])/2,j=H+y.displaySize[0]);const W=r.top*_,ee=r.bottom*_;return a==="height"||a==="both"?(L=f[1]+W-h[0],N=f[1]+ee+h[2]):(L=f[1]+(W+ee-y.displaySize[1])/2,N=L+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:L,right:j,bottom:N,left:H,collisionPadding:T}}function uk(l){return!l.imagePrimary.stretchX}function hk(l){return!l.imagePrimary.stretchY}function dk(l){return{width:l.right-l.left,height:l.bottom-l.top}}const Rd=128;function fk(l,r,a){const{expression:h}=r;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new wr(l+1,{worldview:a}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=h;let y=0;for(;y<f.length&&f[y]<=l;)y++;y=Math.max(0,y-1);let T=y;for(;T<f.length&&f[T]<l+1;)T++;T=Math.min(f.length-1,T);const C=f[y],k=f[T];return h.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:k,interpolationType:_}:{kind:"camera",minZoom:C,maxZoom:k,minSize:h.evaluate(new wr(C,{worldview:a})),maxSize:h.evaluate(new wr(k,{worldview:a})),interpolationType:_}}}function YS(l,{uSize:r,uSizeT:a},{lowerSize:h,upperSize:f}){return l.kind==="source"?h/Rd:l.kind==="composite"?An(h/Rd,f/Rd,a):r}function pv(l,r,a=1){let h=0,f=0;if(l.kind==="constant")f=l.layoutSize*a;else if(l.kind!=="source"){const{interpolationType:_,minZoom:y,maxZoom:T}=l,C=_?Oe(wo.interpolationFactor(_,r,y,T),0,1):0;l.kind==="camera"?f=An(l.minSize,l.maxSize,C)*a:h=C*a}return{uSizeT:h,uSize:f}}class Xf extends It{constructor(r,a,h,f,_){super(r,a),this.angle=f,this.z=h,_!==void 0&&(this.segment=_)}clone(){return new Xf(this.x,this.y,this.z,this.angle,this.segment)}}function pk(l,r,a,h,f){if(r.segment===void 0)return!0;let _=r,y=r.segment+1,T=0;for(;T>-a/2;){if(y--,y<0)return!1;T-=l[y].dist(_),_=l[y]}T+=l[y].dist(l[y+1]),y++;const C=[];let k=0;for(;T<a/2;){const L=l[y],j=l[y+1];if(!j)return!1;let N=l[y-1].angleTo(L)-L.angleTo(j);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:N}),k+=N;T-C[0].distance>h;)k-=C.shift().angleDelta;if(k>f)return!1;y++,T+=L.dist(j)}return!0}function mk(l){let r=0;for(let a=0;a<l.length-1;a++)r+=l[a].dist(l[a+1]);return r}function gk(l,r,a){return l?.6*r*a:0}function _k(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function f8(l,r,a,h,f,_){const y=gk(a,f,_),T=_k(a,h)*_;let C=0;const k=mk(l)/2;for(let L=0;L<l.length-1;L++){const j=l[L],N=l[L+1],H=j.dist(N);if(C+H>k){const W=(k-C)/H,ee=An(j.x,N.x,W),ie=An(j.y,N.y,W),se=new Xf(ee,ie,0,N.angleTo(j),L);return!y||pk(l,se,T,y,r)?se:void 0}C+=H}}function p8(l,r,a,h,f,_,y,T,C){const k=gk(h,_,y),L=_k(h,f),j=L*y,N=l[0].x===0||l[0].x===C||l[0].y===0||l[0].y===C;return r-j<r/4&&(r=j+r/4),yk(l,N?r/2*T%r:(L/2+2*_)*y*T%r,r,k,a,j,N,!1,C)}function yk(l,r,a,h,f,_,y,T,C){const k=_/2,L=mk(l);let j=0,N=r-a,H=[];for(let W=0;W<l.length-1;W++){const ee=l[W],ie=l[W+1],se=ee.dist(ie),fe=ie.angleTo(ee);for(;N+a<j+se;){N+=a;const pe=(N-j)/se,_e=An(ee.x,ie.x,pe),ke=An(ee.y,ie.y,pe);if(_e>=0&&_e<C&&ke>=0&&ke<C&&N-k>=0&&N+k<=L){const Re=new Xf(_e,ke,0,fe,W);h&&!pk(l,Re,_,h,f)||H.push(Re)}}j+=se}return T||H.length||y||(H=yk(l,j/2,a,h,f,_,y,!0,C)),H}function vk(l){let r=0,a=0;for(const y of l)r+=y.w*y.h,a=Math.max(a,y.w);l.sort(((y,T)=>T.h-y.h));const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let f=0,_=0;for(const y of l)for(let T=h.length-1;T>=0;T--){const C=h[T];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,_=Math.max(_,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===C.w&&y.h===C.h){const k=h.pop();k&&T<h.length&&(h[T]=k)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(h.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:f,h:_,fill:r/(f*_)||0}}nn(Xf,"Anchor");const wg=1;class mv{static getImagePositionScale(r,a,h){if(a&&r&&r.options&&r.options.transform){const f=r.options.transform;return{x:f.a,y:f.d}}return{x:h,y:h}}constructor(r,a,h,f){this.paddedRect=r;const{pixelRatio:_,version:y,stretchX:T,stretchY:C,content:k,sdf:L,usvg:j}=a;this.pixelRatio=_,this.stretchX=T,this.stretchY=C,this.content=k,this.version=y,this.padding=h,this.sdf=L,this.usvg=j,this.scale=mv.getImagePositionScale(f,j,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function KS(l,r,a){const h=vl.parse(l),f=(function(_,y,T=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*T[0])+2*y,h:(_.data?_.data.height:_.height*T[1])+2*y}})(r,a,[h.options.transform.a,h.options.transform.d]);return{bin:f,imagePosition:new mv(f,r,a,h),imageVariant:h}}class xk{constructor(r,a,h){const f=new Map,_=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(r,f,wg,y),this.addImages(a,_,2,y);const{w:T,h:C}=vk(y),k=new Co({width:T||1,height:C||1});for(const[L,j]of r.entries()){const N=f.get(L).paddedRect;Co.copy(j.data,k,{x:0,y:0},{x:N.x+wg,y:N.y+wg},j.data,null,j.sdf)}for(const[L,j]of a.entries()){const N=_.get(L),H=N.paddedRect;let W=N.padding;const ee=H.x+W,ie=H.y+W,se=j.data.width,fe=j.data.height;W=W>1?W-1:W,Co.copy(j.data,k,{x:0,y:0},{x:ee,y:ie},j.data,h),Co.copy(j.data,k,{x:0,y:fe-W},{x:ee,y:ie-W},{width:se,height:W},h),Co.copy(j.data,k,{x:0,y:0},{x:ee,y:ie+fe},{width:se,height:W},h),Co.copy(j.data,k,{x:se-W,y:0},{x:ee-W,y:ie},{width:W,height:fe},h),Co.copy(j.data,k,{x:0,y:0},{x:ee+se,y:ie},{width:W,height:fe},h),Co.copy(j.data,k,{x:se-W,y:fe-W},{x:ee-W,y:ie-W},{width:W,height:W},h),Co.copy(j.data,k,{x:0,y:fe-W},{x:ee+se,y:ie-W},{width:W,height:W},h),Co.copy(j.data,k,{x:0,y:0},{x:ee+se,y:ie+fe},{width:W,height:W},h),Co.copy(j.data,k,{x:se-W,y:0},{x:ee-W,y:ie+fe},{width:W,height:W},h)}this.lut=h,this.image=k,this.iconPositions=f,this.patternPositions=_}addImages(r,a,h,f){for(const[_,y]of r.entries()){const{bin:T,imagePosition:C,imageVariant:k}=KS(_,y,h);a.set(_,C),f.push(T),y.hasRenderCallback&&this.haveRenderCallbacks.push(k.id)}}patchUpdatedImages(r,a,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((f=>r.hasImage(f,h))),r.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const f of r.getUpdatedImages(h)){for(const _ of this.iconPositions.keys()){const y=vl.parse(_);if(vo.isEqual(y.id,f)){const T=r.getImage(f,h);this.patchUpdatedImage(this.iconPositions.get(_),T,a,null)}}for(const _ of this.patternPositions.keys()){const y=vl.parse(_);if(vo.isEqual(y.id,f)){const T=r.getImage(f,h);this.patchUpdatedImage(this.patternPositions.get(_),T,a,this.lut)}}}}patchUpdatedImage(r,a,h,f=null){if(!r||!a||r.version===a.version)return;r.version=a.version;const[_,y]=r.tl,T=r.sdf;if(this.lut||T){const C={width:a.data.width,height:a.data.height},k=new Co(C);Co.copy(a.data,k,{x:0,y:0},{x:0,y:0},C,f,T),h.update(k,{position:{x:_,y}})}else h.update(a.data,{position:{x:_,y}})}}nn(mv,"ImagePosition"),nn(xk,"ImageAtlas");const gv=1e20;function bk(l,r,a,h,f,_,y,T,C){for(let k=r;k<r+h;k++)wk(l,a*_+k,_,f,y,T,C);for(let k=a;k<a+f;k++)wk(l,k*_+r,1,h,y,T,C)}function wk(l,r,a,h,f,_,y){_[0]=0,y[0]=-gv,y[1]=gv,f[0]=l[r];for(let T=1,C=0,k=0;T<h;T++){f[T]=l[r+T*a];const L=T*T;do{const j=_[C];k=(f[T]-f[j]+L-j*j)/(T-j)/2}while(k<=y[C]&&--C>-1);C++,_[C]=T,y[C]=k,y[C+1]=gv}for(let T=0,C=0;T<h;T++){for(;y[C+1]<T;)C++;const k=_[C],L=T-k;l[r+T*a]=f[k]+L*L}}const wh=2,JS={none:0,ideographs:1,all:2};class $_{constructor(r,a,h){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const h=[],f=this.url||ro.GLYPHS_URL;for(const _ in r)for(const y of r[_])h.push({stack:_,id:y});ot(h,(({stack:_,id:y},T)=>{let C=this.entries[_];C||(C=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=C.glyphs[y];if(k!==void 0)return void T(null,{stack:_,id:y,glyph:k});if(k=this._tinySDF(C,_,y),k)return C.glyphs[y]=k,void T(null,{stack:_,id:y,glyph:k});const L=Math.floor(y/256);if(256*L>65535)return _r("glyphs > 65535 not supported"),void T(null,{stack:_,id:y,glyph:k});if(C.ranges[L])return void T(null,{stack:_,id:y,glyph:k});let j=C.requests[L];j||(j=C.requests[L]=[],$_.loadGlyphRange(_,L,f,this.requestManager,((N,H)=>{if(H){C.ascender=H.ascender,C.descender=H.descender;for(const W in H.glyphs)this._doesCharSupportLocalGlyph(+W)||(C.glyphs[+W]=H.glyphs[+W]);C.ranges[L]=!0}for(const W of j)W(N,H);delete C.requests[L]}))),j.push(((N,H)=>{N?T(N):H&&T(null,{stack:_,id:y,glyph:H.glyphs[y]||null})}))}),((_,y)=>{if(_)a(_);else if(y){const T={};for(const{stack:C,id:k,glyph:L}of y)T[C]===void 0&&(T[C]={}),T[C].glyphs===void 0&&(T[C].glyphs={}),T[C].glyphs[k]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},T[C].ascender=this.entries[C].ascender,T[C].descender=this.entries[C].descender;a(null,T)}}))}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==JS.none&&(this.localGlyphMode===JS.all?!!this.localFontFamily:!!this.localFontFamily&&(Cn["CJK Unified Ideographs"](r)||Cn["Hangul Syllables"](r)||Cn.Hiragana(r)||Cn.Katakana(r)||Cn["CJK Symbols and Punctuation"](r)||Cn["CJK Unified Ideographs Extension A"](r)||Cn["CJK Unified Ideographs Extension B"](r)||Cn.Osage(r)))}_tinySDF(r,a,h){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=r.tinySDF;if(!_){let ee="400";/bold/i.test(a)?ee="900":/medium/i.test(a)?ee="500":/light/i.test(a)&&(ee="200"),_=r.tinySDF=new $_.TinySDF({fontFamily:f,fontWeight:ee,fontSize:24*wh,buffer:3*wh,radius:8*wh}),_.fontWeight=ee}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const y=String.fromCodePoint(h),{data:T,width:C,height:k,glyphWidth:L,glyphHeight:j,glyphLeft:N,glyphTop:H,glyphAdvance:W}=_.draw(y);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new sm({width:C,height:k},T),metrics:{width:L/wh,height:j/wh,left:N/wh,top:H/wh-27,advance:W/wh,localGlyph:!0}}}}$_.loadGlyphRange=function(l,r,a,h,f){const _=256*r,y=_+255,T=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",l).replace("{range}",`${_}-${y}`),yl.Glyphs);Zh(T,((C,k)=>{if(C)f(C);else if(k){const L={},j=(function(N){return new C0(N).readFields(a8,{})})(k);for(const N of j.glyphs)L[N.id]=N;f(null,{glyphs:L,ascender:j.ascender,descender:j.descender})}}))},$_.TinySDF=class{constructor({fontSize:l=24,buffer:r=3,radius:a=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:y="normal",lang:T=null}={}){this.buffer=r,this.cutoff=h,this.radius=a,this.lang=T;const C=this.size=l+4*r,k=this._createCanvas(C),L=this.ctx=k.getContext("2d",{willReadFrequently:!0});L.font=`${y} ${_} ${l}px ${f}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(l){const r=document.createElement("canvas");return r.width=r.height=l,r}draw(l){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(l),y=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),C=Math.min(this.size-this.buffer,y+Math.ceil(h)),k=T+2*this.buffer,L=C+2*this.buffer,j=Math.max(k*L,0),N=new Uint8ClampedArray(j),H={data:N,width:k,height:L,glyphWidth:T,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(T===0||C===0)return H;const{ctx:W,buffer:ee,gridInner:ie,gridOuter:se}=this;this.lang&&(W.lang=this.lang),W.clearRect(ee,ee,T,C),W.fillText(l,ee,ee+y);const fe=W.getImageData(ee,ee,T,C);se.fill(gv,0,j),ie.fill(0,0,j);for(let pe=0;pe<C;pe++)for(let _e=0;_e<T;_e++){const ke=fe.data[4*(pe*T+_e)+3]/255;if(ke===0)continue;const Re=(pe+ee)*k+_e+ee;if(ke===1)se[Re]=0,ie[Re]=gv;else{const Ne=.5-ke;se[Re]=Ne>0?Ne*Ne:0,ie[Re]=Ne<0?Ne*Ne:0}}bk(se,0,0,k,L,k,this.f,this.v,this.z),bk(ie,ee,ee,T,C,k,this.f,this.v,this.z);for(let pe=0;pe<j;pe++){const _e=Math.sqrt(se[pe])-Math.sqrt(ie[pe]);N[pe]=Math.round(255-255*(_e/this.radius+this.cutoff))}return H}};const lm=wg;function Sk(l,r){return l+r[1]-r[0]}function Tk(l,r,a,h,f=1){const _=[],y=l.imagePrimary,T=y.pixelRatio,C=y.paddedRect.w-2*lm,k=y.paddedRect.h-2*lm,L=(l.right-l.left)*f,j=(l.bottom-l.top)*f,N=y.stretchX||[[0,C]],H=y.stretchY||[[0,k]],W=N.reduce(Sk,0),ee=H.reduce(Sk,0),ie=C-W,se=k-ee;let fe=0,pe=W,_e=0,ke=ee,Re=0,Ne=ie,Fe=0,Ue=se;if(y.content&&h){const We=y.content;fe=I0(N,0,We[0]),_e=I0(H,0,We[1]),pe=I0(N,We[0],We[2]),ke=I0(H,We[1],We[3]),Re=We[0]-fe,Fe=We[1]-_e,Ne=We[2]-We[0]-pe,Ue=We[3]-We[1]-ke}const ft=(We,mt,Ct,yt)=>{const xt=M0(We.stretch-fe,pe,L,l.left*f),Rt=k0(We.fixed-Re,Ne,We.stretch,W),ht=M0(mt.stretch-_e,ke,j,l.top*f),bt=k0(mt.fixed-Fe,Ue,mt.stretch,ee),st=M0(Ct.stretch-fe,pe,L,l.left*f),nt=k0(Ct.fixed-Re,Ne,Ct.stretch,W),Ot=M0(yt.stretch-_e,ke,j,l.top*f),Mt=k0(yt.fixed-Fe,Ue,yt.stretch,ee),bn=new It(xt,ht),rn=new It(st,ht),fn=new It(st,Ot),Ut=new It(xt,Ot),xn=new It(Rt/T,bt/T),Nn=new It(nt/T,Mt/T),Yt=r*Math.PI/180;if(Yt){const on=Math.sin(Yt),qn=Math.cos(Yt),Er=[qn,-on,on,qn];bn._matMult(Er),rn._matMult(Er),Ut._matMult(Er),fn._matMult(Er)}const mn=We.stretch+We.fixed,On=Ct.stretch+Ct.fixed,Vn=mt.stretch+mt.fixed,ar=yt.stretch+yt.fixed,Jn=l.imageSecondary;return{tl:bn,tr:rn,bl:Ut,br:fn,texPrimary:{x:y.paddedRect.x+lm+mn,y:y.paddedRect.y+lm+Vn,w:On-mn,h:ar-Vn},texSecondary:Jn?{x:Jn.paddedRect.x+lm+mn,y:Jn.paddedRect.y+lm+Vn,w:On-mn,h:ar-Vn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xn,pixelOffsetBR:Nn,minFontScaleX:Ne/T/L,minFontScaleY:Ue/T/j,isSDF:a}};if(h&&(y.stretchX||y.stretchY)){const We=Ek(N,ie,W),mt=Ek(H,se,ee);for(let Ct=0;Ct<We.length-1;Ct++){const yt=We[Ct],xt=We[Ct+1];for(let Rt=0;Rt<mt.length-1;Rt++)_.push(ft(yt,mt[Rt],xt,mt[Rt+1]))}}else _.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:k+1}));return _}function I0(l,r,a){let h=0;for(const f of l)h+=Math.max(r,Math.min(a,f[1]))-Math.max(r,Math.min(a,f[0]));return h}function Ek(l,r,a){const h=[{fixed:-lm,stretch:0}];for(const[f,_]of l){const y=h[h.length-1];h.push({fixed:f-y.stretch,stretch:y.stretch}),h.push({fixed:f-y.stretch,stretch:y.stretch+(_-f)})}return h.push({fixed:r+lm,stretch:a}),h}function M0(l,r,a,h){return l/r*a+h}function k0(l,r,a,h){return l-r*a/h}function m8(l,r,a,h){const f=r+l.positionedLines[h].lineOffset;return h===0?a+f/2:a+(f+(r+l.positionedLines[h-1].lineOffset))/2}function g8(l,r=1,a=!1){let h=1/0,f=1/0,_=-1/0,y=-1/0;const T=l[0];for(let H=0;H<T.length;H++){const W=T[H];(!H||W.x<h)&&(h=W.x),(!H||W.y<f)&&(f=W.y),(!H||W.x>_)&&(_=W.x),(!H||W.y>y)&&(y=W.y)}const C=Math.min(_-h,y-f);let k=C/2;const L=new xf([],_8);if(C===0)return new It(h,f);for(let H=h;H<_;H+=C)for(let W=f;W<y;W+=C)L.push(new H_(H+k,W+k,k,l));let j=(function(H){let W=0,ee=0,ie=0;const se=H[0];for(let fe=0,pe=se.length,_e=pe-1;fe<pe;_e=fe++){const ke=se[fe],Re=se[_e],Ne=ke.x*Re.y-Re.x*ke.y;ee+=(ke.x+Re.x)*Ne,ie+=(ke.y+Re.y)*Ne,W+=3*Ne}return new H_(ee/W,ie/W,0,H)})(l),N=L.length;for(;L.length;){const H=L.pop();(H.d>j.d||!j.d)&&(j=H,a&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,N)),H.max-j.d<=r||(k=H.h/2,L.push(new H_(H.p.x-k,H.p.y-k,k,l)),L.push(new H_(H.p.x+k,H.p.y-k,k,l)),L.push(new H_(H.p.x-k,H.p.y+k,k,l)),L.push(new H_(H.p.x+k,H.p.y+k,k,l)),N+=4)}return a&&(console.log(`num probes: ${N}`),console.log(`best distance: ${j.d}`)),j.p}function _8(l,r){return r.max-l.max}class H_{constructor(r,a,h,f){this.p=new It(r,a),this.h=h,this.d=(function(_,y){let T=!1,C=1/0;for(let k=0;k<y.length;k++){const L=y[k];for(let j=0,N=L.length,H=N-1;j<N;H=j++){const W=L[j],ee=L[H];W.y>_.y!=ee.y>_.y&&_.x<(ee.x-W.x)*(_.y-W.y)/(ee.y-W.y)+W.x&&(T=!T),C=Math.min(C,mi(_,W,ee))}}return(T?1:-1)*Math.sqrt(C)})(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const y8=Object.keys,QS=Number.POSITIVE_INFINITY,v8=Math.sqrt(2);function Ak(l,[r,a]){let h=0,f=0;if(a===QS){r<0&&(r=0);const _=r/v8;switch(l){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-r;break;case"top":f=r-7}switch(l){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),a=Math.abs(a),l){case"top-right":case"top-left":case"top":f=a-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-a}switch(l){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,f]}function R0(l,r,a,h,f,_,y,T,C){if(!r||!r.usvg)return;const k=dk(h),L=dk(f),j=_!=="both"&&_!=="width"||!uk(h)?1:L.width/k.width,N=_!=="both"&&_!=="height"||!hk(h)?1:L.height/k.height;a.scaleSelf(j,N);const H=a.toString();y.set(H,a),T.set(H,r);const{imagePosition:W}=KS(H,r,wg);C.set(H,W)}function Ck(l,r,a,h,f,_,y,T,C){if(!l)return;const k=(function(L,j,N,H,W,ee){if(L.kind==="camera")return L.maxSize;if(L.kind==="composite"){const ie=j.possiblyEvaluate(new wr(L.maxZoom,{worldview:ee}),N).evaluate(W,{},N),se=j.possiblyEvaluate(new wr(L.minZoom,{worldview:ee}),N).evaluate(W,{},N);return Math.max(ie,se)}return j.possiblyEvaluate(new wr(H,{worldview:ee})).evaluate(W,{},N)})(r,a,h,f,_,C);return l.scaleSelf(k*T*y)}function Pk(l,r,a,h,f,_,y,T,C){return{iconPrimary:Ck(l.getPrimary(),r,a,h,f,_,y,T,C),iconSecondary:Ck(l.getSecondary(),r,a,h,f,_,y,T,C)}}function x8(l,r,a){if(!r)return;const h=a.get(l.toString()),f=a.get(r.toString());h&&f&&(h.paddedRect.w===f.paddedRect.w&&h.paddedRect.h===f.paddedRect.h||_r(`Mismatch in icon variant sizes: ${l.toString()} and ${r.toString()}`),h.usvg!==f.usvg&&_r(`Mismatch in icon variant image types: ${l.id} and ${r.id}`))}function Ik(l,r,a,h){if(!l)return;const f=r.get(a.toString());if(l.imagePrimary=f,h){const _=r.get(h.toString());l.imageSecondary=_}}function b8(l,r){for(const a in l.horizontal)Mk(l.horizontal[a],r);Mk(l.vertical,r)}function Mk(l,r){if(l){for(const a of l.positionedLines)for(const h of a.positionedGlyphs)if(h.image!==null){const f=h.image.toString();h.rect=r.get(f).paddedRect}}}function e2(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function w8(l,r,a,h,f,_,y,T,C){const k=t2(_.horizontal)||_.vertical,L=a.get("icon-text-fit-padding").evaluate(h,{},f);let j,N=r;return r&&C!=="none"&&(l.allowVerticalPlacement&&_.vertical&&(j=ck(r,_.vertical,C,L,T,y)),k&&(N=ck(r,k,C,L,T,y))),{defaultShapedIcon:N,verticallyShapedIcon:j}}function S8(l,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se,fe,pe){let _e=y.textMaxSize.evaluate(r,{},N);_e===void 0?_e=T*y.textScaleFactor:_e*=y.textScaleFactor;const ke=l.layers[0].layout,Re=t2(a.horizontal)||a.vertical,Ne=H.name==="globe",Fe=Ks,Ue=l.tilePixelRatio*_e/Fe,ft=(Rt=l.overscaling,l.zoom>18&&Rt>2&&(Rt>>=1),Math.max(Ft/(512*Rt),1)*ke.get("symbol-spacing")),We=ke.get("text-padding")*l.tilePixelRatio,mt=ke.get("icon-padding")*l.tilePixelRatio,Ct=$e(ke.get("text-max-angle")),yt=ke.get("icon-rotation-alignment")==="map"&&pe!=="point",xt=ft/2;var Rt;l.hasAnyIconTextFit===!1&&ie!=="none"&&(l.hasAnyIconTextFit=!0);const ht=r.properties?+r.properties[Wn]:null,bt=ht&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(ht):65535,st=(nt,Ot,Mt)=>{if(Ot.x<0||Ot.x>=Ft||Ot.y<0||Ot.y>=Ft)return;let bn=null;if(Ne){const{x:rn,y:fn,z:Ut}=H.projectTilePoint(Ot.x,Ot.y,Mt);bn={anchor:new Xf(rn,fn,Ut,0,void 0),up:H.upVector(Mt,Ot.x,Ot.y)}}(function(rn,fn,Ut,xn,Nn,Yt,mn,On,Vn,ar,Jn,on,qn,Er,xe,be,it,dt,Zt,qt,sn,Tn,lr,ur,sr,Vr,Ti,rr,li){const qr=rn.addToLineVertexArray(fn,xn);let jr,gi,_i,ri,ci,Zr,hr,Yr=0,Ri=0,Ln=0,kr=0,yi=-1,Ni=-1;const xi={};let _s=Xh("");const Jr=Ut?Ut.anchor:fn,ls=rr!=="none";let sl=0,Po=0;if(Vn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ys=Vn.layout.get("text-offset").evaluate(sn,{},sr);sl=ys[0]*Ks,Po=ys[1]*Ks}else sl=Vn.layout.get("text-radial-offset").evaluate(sn,{},sr)*Ks,Po=QS;if(rn.allowVerticalPlacement&&Nn.vertical){const ys=Nn.vertical;if(xe)Zr=n2(ys),On&&(hr=n2(On));else{const Is=Vn.layout.get("text-rotate").evaluate(sn,{},sr)+90;_i=O0(ar,Jr,fn,Jn,on,qn,ys,Er,Is,be),On&&(ri=O0(ar,Jr,fn,Jn,on,qn,On,dt,Is))}}if(Yt){const ys=rn.iconSizeData,Is=Vn.layout.get("icon-rotate").evaluate(sn,{},sr),Io=Tk(Yt,Is,lr,ls,Tn.iconScaleFactor),sa=On?Tk(On,Is,lr,ls,Tn.iconScaleFactor):void 0;gi=O0(ar,Jr,fn,Jn,on,qn,Yt,dt,Is,null),Yr=4*Io.length;let $o=null;ys.kind==="source"?($o=[Rd*Vn.layout.get("icon-size").evaluate(sn,{},sr)*Tn.iconScaleFactor],$o[0]>cm&&_r(`${rn.layerIds[0]}: Value for "icon-size" is >= ${_v}. Reduce your "icon-size".`)):ys.kind==="composite"&&($o=[Rd*Tn.compositeIconSizes[0].evaluate(sn,{},sr)*Tn.iconScaleFactor,Rd*Tn.compositeIconSizes[1].evaluate(sn,{},sr)*Tn.iconScaleFactor],($o[0]>cm||$o[1]>cm)&&_r(`${rn.layerIds[0]}: Value for "icon-size" is >= ${_v}. Reduce your "icon-size".`)),rn.addSymbols(rn.icon,Io,$o,qt,Zt,sn,void 0,Ut,fn,qr.lineStartIndex,qr.lineLength,-1,ur,sr,Vr,Ti),yi=rn.icon.placedSymbolArray.length-1,sa&&(Ri=4*sa.length,rn.addSymbols(rn.icon,sa,$o,qt,Zt,sn,Il.vertical,Ut,fn,qr.lineStartIndex,qr.lineLength,-1,ur,sr,Vr,Ti),Ni=rn.icon.placedSymbolArray.length-1)}for(const ys in Nn.horizontal){const Is=ys,Io=Nn.horizontal[Is];jr||(_s=Xh(Io.text),xe?ci=n2(Io):jr=O0(ar,Jr,fn,Jn,on,qn,Io,Er,Vn.layout.get("text-rotate").evaluate(sn,{},sr),be));const sa=Io.positionedLines.length===1;if(Ln+=kk(rn,Ut,fn,Io,mn,Vn,xe,sn,be,qr,Nn.vertical?Il.horizontal:Il.horizontalOnly,sa?y8(Nn.horizontal):[Is],xi,yi,Tn,ur,sr,Vr),sa)break}Nn.vertical&&(kr+=kk(rn,Ut,fn,Nn.vertical,mn,Vn,xe,sn,be,qr,Il.vertical,["vertical"],xi,Ni,Tn,ur,sr,Vr));let po=-1;const ol=(ys,Is)=>ys?Math.max(ys,Is):Is;po=ol(ci,po),po=ol(Zr,po),po=ol(hr,po);const Od=po>-1?1:0;rn.glyphOffsetArray.length>=65535&&_r("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sn.sortKey!==void 0&&rn.addToSortKeyRanges(rn.symbolInstances.length,sn.sortKey),rn.symbolInstances.emplaceBack(fn.x,fn.y,Jr.x,Jr.y,Jr.z,xi.right>=0?xi.right:-1,xi.center>=0?xi.center:-1,xi.left>=0?xi.left:-1,xi.vertical>=0?xi.vertical:-1,yi,Ni,_s,jr!==void 0?jr:rn.collisionBoxArray.length,jr!==void 0?jr+1:rn.collisionBoxArray.length,_i!==void 0?_i:rn.collisionBoxArray.length,_i!==void 0?_i+1:rn.collisionBoxArray.length,gi!==void 0?gi:rn.collisionBoxArray.length,gi!==void 0?gi+1:rn.collisionBoxArray.length,ri||rn.collisionBoxArray.length,ri?ri+1:rn.collisionBoxArray.length,Jn,Ln,kr,Yr,Ri,Od,0,sl,Po,po,0,ls?1:0,li)})(l,Ot,bn,nt,a,h,_,f,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,We,fe,k,0,mt,yt,se,r,y,L,j,N,W,ee,ie,bt)};if(pe==="line")for(const nt of v0(r.geometry,0,0,Ft,Ft)){const Ot=p8(nt,ft,Ct,a.vertical||Re,h,Fe,Ue,l.overscaling,Ft);for(const Mt of Ot)Re&&T8(l,Re.text,xt,Mt)||st(nt,Mt,N)}else if(pe==="line-center"){for(const nt of r.geometry)if(nt.length>1){const Ot=f8(nt,Ct,a.vertical||Re,h,Fe,Ue);Ot&&st(nt,Ot,N)}}else if(r.type==="Polygon")for(const nt of Qy(r.geometry,0)){const Ot=g8(nt,16);st(nt[0],new Xf(Ot.x,Ot.y,0,0,void 0),N)}else if(r.type==="LineString")for(const nt of r.geometry)st(nt,new Xf(nt[0].x,nt[0].y,0,0,void 0),N);else if(r.type==="Point")for(const nt of r.geometry)for(const Ot of nt)st([Ot],new Xf(Ot.x,Ot.y,0,0,void 0),N)}const _v=255,cm=_v*Rd;function kk(l,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie,se){const fe=(function(ke,Re,Ne,Fe,Ue,ft,We,mt){const Ct=[];if(Re.positionedLines.length===0)return Ct;const yt=Fe.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,xt=(function(nt){const Ot=nt[0],Mt=nt[1],bn=Ot*Mt;return bn>0?[Ot,-Mt]:bn<0?[-Ot,Mt]:Ot===0?[Mt,Ot]:[Mt,-Ot]})(Ne);let Rt=Math.abs(Re.top-Re.bottom);for(const nt of Re.positionedLines)Rt-=nt.lineOffset;const ht=Re.positionedLines.length,bt=Rt/ht;let st=Re.top-Ne[1];for(let nt=0;nt<ht;++nt){const Ot=Re.positionedLines[nt];st=m8(Re,bt,st,nt);for(const Mt of Ot.positionedGlyphs){if(!Mt.rect)continue;const bn=Mt.rect||{};let rn=nk+1,fn=!0,Ut=1,xn=0;if(Mt.image){const sn=We.get(Mt.image.toString());if(!sn)continue;if(sn.sdf){_r("SDF images are not supported in formatted text and will be ignored.");continue}fn=!1,Ut=sn.pixelRatio,rn=wg/Ut}const Nn=(Ue||mt)&&Mt.vertical,Yt=Mt.metrics.advance*Mt.scale/2,mn=Mt.metrics,On=Mt.rect;if(On===null)continue;mt&&Re.verticalizable&&(xn=Mt.image?Yt-Mt.metrics.width*Mt.scale/2:0);const Vn=Ue?[Mt.x+Yt,Mt.y]:[0,0];let ar=[0,0],Jn=[0,0],on=!1;Ue||(Nn?(Jn=[Mt.x+Yt+xt[0],Mt.y+xt[1]-xn],on=!0):ar=[Mt.x+Yt+Ne[0],Mt.y+Ne[1]-xn]);const qn=On.w*Mt.scale/(Ut*(Mt.localGlyph?wh:1)),Er=On.h*Mt.scale/(Ut*(Mt.localGlyph?wh:1));let xe,be,it,dt;if(Nn){const sn=Mt.y-st,Tn=new It(-Yt,Yt-sn),lr=-Math.PI/2,ur=new It(...Jn);xe=new It(-Yt+ar[0],ar[1]),xe._rotateAround(lr,Tn)._add(ur),xe.x+=-sn+Yt,xe.y-=(mn.left-rn)*Mt.scale;const sr=Mt.image?mn.advance*Mt.scale:Ks*Mt.scale,Vr=String.fromCodePoint(Mt.glyph);Y$(Vr)?xe.x+=(1-rn)*Mt.scale:K$(Vr)?xe.x+=sr-mn.height*Mt.scale+(-rn-1)*Mt.scale:xe.x+=Mt.image||mn.width+2*rn===On.w&&mn.height+2*rn===On.h?(sr-Er)/2:(sr-(mn.height+2*rn)*Mt.scale)/2,be=new It(xe.x,xe.y-qn),it=new It(xe.x+Er,xe.y),dt=new It(xe.x+Er,xe.y-qn)}else{const sn=(mn.left-rn)*Mt.scale-Yt+ar[0],Tn=(-mn.top-rn)*Mt.scale+ar[1],lr=sn+qn,ur=Tn+Er;xe=new It(sn,Tn),be=new It(lr,Tn),it=new It(sn,ur),dt=new It(lr,ur)}if(yt){let sn;sn=Ue?new It(0,0):on?new It(xt[0],xt[1]):new It(Ne[0],Ne[1]),xe._rotateAround(yt,sn),be._rotateAround(yt,sn),it._rotateAround(yt,sn),dt._rotateAround(yt,sn)}const Zt=new It(0,0),qt=new It(0,0);Ct.push({tl:xe,tr:be,bl:it,br:dt,texPrimary:bn,texSecondary:void 0,writingMode:Re.writingMode,glyphOffset:Vn,sectionIndex:Mt.sectionIndex,isSDF:fn,pixelOffsetTL:Zt,pixelOffsetBR:qt,minFontScaleX:0,minFontScaleY:0})}}return Ct})(0,h,C,_,y,T,f,l.allowVerticalPlacement),pe=l.textSizeData;let _e=null;pe.kind==="source"?(_e=[Rd*_.layout.get("text-size").evaluate(T,{},ie)*W.textScaleFactor],_e[0]>cm&&_r(`${l.layerIds[0]}: Value for "text-size" is >= ${_v}. Reduce your "text-size".`)):pe.kind==="composite"&&(_e=[Rd*W.compositeTextSizes[0].evaluate(T,{},ie)*W.textScaleFactor,Rd*W.compositeTextSizes[1].evaluate(T,{},ie)*W.textScaleFactor],(_e[0]>cm||_e[1]>cm)&&_r(`${l.layerIds[0]}: Value for "text-size" is >= ${_v}. Reduce your "text-size".`)),l.addSymbols(l.text,fe,_e,C,y,T,L,r,a,k.lineStartIndex,k.lineLength,H,ee,ie,se,!1);for(const ke of j)N[ke]=l.text.placedSymbolArray.length-1;return 4*fe.length}function t2(l){for(const r in l)return l[r];return null}function O0(l,r,a,h,f,_,y,T,C,k){let L=y.top,j=y.bottom,N=y.left,H=y.right;if(lk(y)&&y.collisionPadding){const W=y.collisionPadding;N-=W[0],L-=W[1],H+=W[2],j+=W[3]}if(C){const W=new It(N,L),ee=new It(H,L),ie=new It(N,j),se=new It(H,j),fe=$e(C);let pe=new It(0,0);k&&(pe=new It(k[0],k[1])),W._rotateAround(fe,pe),ee._rotateAround(fe,pe),ie._rotateAround(fe,pe),se._rotateAround(fe,pe),N=Math.min(W.x,ee.x,ie.x,se.x),H=Math.max(W.x,ee.x,ie.x,se.x),L=Math.min(W.y,ee.y,ie.y,se.y),j=Math.max(W.y,ee.y,ie.y,se.y)}return l.emplaceBack(r.x,r.y,r.z,a.x,a.y,N,L,H,j,T,h,f,_),l.length-1}function n2(l){lk(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const r=l.bottom-l.top;return r>0?Math.max(10,r):null}function T8(l,r,a,h){const f=l.compareText;if(r in f){const _=f[r];for(let y=_.length-1;y>=0;y--)if(h.dist(_[y])<a)return!0}else f[r]=[];return f[r].push(h),!1}function Rk(l,r){const a=l.fovAboveCenter,h=l.elevation?l.elevation.getMinElevationBelowMSL()*r:0,f=(l._camera.position[2]*l.worldSize-h)/Math.cos(l._pitch),_=Math.sin(a)*f/Math.sin(Math.max(Math.PI/2-l._pitch-a,.01));let y=Math.sin(l._pitch)*_+f;const T=f*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let C=Math.max(l.zoom-17,0);l.isOrthographic&&(C/=10),y*=1+C}return Math.min(1.01*y,T)}function yv(l,r){if(!r.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:r};const a=Math.pow(2,-l.z),h=l.x*a,f=(l.x+1)*a,_=l.y*a,y=(l.y+1)*a,T=Ie(h),C=Ie(f),k=Ce(_),L=Ce(y),j=r.project(T,k),N=r.project(C,k),H=r.project(C,L),W=r.project(T,L);let ee=Math.min(j.x,N.x,H.x,W.x),ie=Math.min(j.y,N.y,H.y,W.y),se=Math.max(j.x,N.x,H.x,W.x),fe=Math.max(j.y,N.y,H.y,W.y);const pe=a/16;function _e(Re,Ne,Fe,Ue,ft,We){const mt=(Fe+ft)/2,Ct=(Ue+We)/2,yt=r.project(Ie(mt),Ce(Ct)),xt=Math.max(0,ee-yt.x,ie-yt.y,yt.x-se,yt.y-fe);ee=Math.min(ee,yt.x),se=Math.max(se,yt.x),ie=Math.min(ie,yt.y),fe=Math.max(fe,yt.y),xt>pe&&(_e(Re,yt,Fe,Ue,mt,Ct),_e(yt,Ne,mt,Ct,ft,We))}_e(j,N,h,_,f,_),_e(N,H,f,_,f,y),_e(H,W,f,y,h,y),_e(W,j,h,y,h,_),ee-=pe,ie-=pe,se+=pe,fe+=pe;const ke=1/Math.max(se-ee,fe-ie);return{scale:ke,x:ee*ke,y:ie*ke,x2:se*ke,y2:fe*ke,projection:r}}function Ok(l,{x:r,y:a},h=0){return new It(((r-h)*l.scale-l.x)*Ft,(a*l.scale-l.y)*Ft)}const E8=q(new Float32Array(16));class um{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new Q(0,0)}projectTilePoint(r,a,h){return{x:r,y:a,z:0}}locationPoint(r,a,h,f=!0){return r._coordinatePoint(r.locationCoordinate(a,h),f)}pixelsPerMeter(r,a){return Ae(1,r)*a}pixelSpaceConversion(r,a,h){return 1}farthestPixelDistance(r){return Rk(r,r.pixelsPerMeter)}pointCoordinate(r,a,h,f){const _=r.horizonLineFromTop(!1),y=new It(a,Math.max(_,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,f))}pointCoordinate3D(r,a,h){const f=new It(a,h);if(r.elevation)return r.elevation.pointCoordinate(f);{const _=this.pointCoordinate(r,f.x,f.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(r,a){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,a.x,a.y);const h=r.horizonLineFromTop();return a.y<h}createInversionMatrix(r,a){return E8}createTileMatrix(r,a,h){let f,_,y;const T=h.canonical,C=q(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=yv(T,this);f=1,_=k.x+h.wrap*k.scale,y=k.y,ue(C,C,[f/k.scale,f/k.scale,r.pixelsPerMeter/a])}else f=a/r.zoomScale(T.z),_=(T.x+Math.pow(2,T.z)*h.wrap)*f,y=T.y*f;return le(C,C,[_,y,0]),ue(C,C,[f/Ft,f/Ft,1]),C}upVector(r,a,h){return[0,0,1]}upVectorScale(r,a,h){return{metersToTile:1}}}class A8 extends um{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,h]=this.parallels=r.parallels||[29.5,45.5],f=Math.sin($e(a));this.n=(f+Math.sin($e(h)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:h,c:f,r0:_}=this,y=$e(r-this.center[0]),T=$e(a),C=Math.sqrt(f-2*h*Math.sin(T))/h;return{x:C*Math.sin(y*h),y:C*Math.cos(y*h)-_,z:0}}unproject(r,a){const{n:h,c:f,r0:_}=this,y=_+a;let T=Math.atan2(r,Math.abs(y))*Math.sign(y);y*h<0&&(T-=Math.PI*Math.sign(r)*Math.sign(y));const C=$e(this.center[0])*h;T=Ve(T,-Math.PI-C,Math.PI-C);const k=Oe(oe(T/h)+this.center[0],-180,180),L=Math.asin(Oe((f-(r*r+y*y)*h*h)/(2*h),-1,1)),j=Oe(oe(L),-Me,Me);return new Q(k,j)}}const vv=1.340264,xv=-.081106,bv=893e-6,wv=.003796,D0=Math.sqrt(3)/2;class C8 extends um{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(D0*Math.sin(a)),f=h*h,_=f*f*f;return{x:.5*(r*Math.cos(h)/(D0*(vv+3*xv*f+_*(7*bv+9*wv*f)))/Math.PI+.5),y:1-.5*(h*(vv+xv*f+_*(bv+wv*f))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,f=h*h,_=f*f*f;for(let L,j,N,H=0;H<12&&(j=h*(vv+xv*f+_*(bv+wv*f))-a,N=vv+3*xv*f+_*(7*bv+9*wv*f),L=j/N,h=Oe(h-L,-Math.PI/3,Math.PI/3),f=h*h,_=f*f*f,!(Math.abs(L)<1e-12));++H);const y=D0*r*(vv+3*xv*f+_*(7*bv+9*wv*f))/Math.cos(h),T=Math.asin(Math.sin(h)/D0),C=Oe(180*y/Math.PI,-180,180),k=Oe(180*T/Math.PI,-Me,Me);return new Q(C,k)}}class P8 extends um{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const h=360*(r-.5),f=Oe(360*(.5-a),-Me,Me);return new Q(h,f)}}const G_=Math.PI/2;function L0(l){return Math.tan((G_+l)/2)}class I8 extends um{constructor(r){super(r),this.center=r.center||[0,30];const[a,h]=this.parallels=r.parallels||[30,30];let f=$e(a),_=$e(h);this.southernCenter=f+_<0,this.southernCenter&&(f=-f,_=-_);const y=Math.cos(f),T=L0(f);this.n=f===_?Math.sin(f):Math.log(y/Math.cos(_))/Math.log(L0(_)/T),this.f=y*Math.pow(L0(f),this.n)/this.n}project(r,a){a=$e(a),this.southernCenter&&(a=-a),r=$e(r-this.center[0]);const h=1e-6,{n:f,f:_}=this;_>0?a<-G_+h&&(a=-G_+h):a>G_-h&&(a=G_-h);const y=_/Math.pow(L0(a),f);let T=y*Math.sin(f*r),C=_-y*Math.cos(f*r);return T=.5*(T/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:T,y:this.southernCenter?C:1-C,z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:h,f}=this,_=f-a,y=Math.sign(_),T=Math.sign(h)*Math.sqrt(r*r+_*_);let C=Math.atan2(r,Math.abs(_))*y;_*h<0&&(C-=Math.PI*Math.sign(r)*y);const k=Oe(oe(C/h)+this.center[0],-180,180),L=Oe(oe(2*Math.atan(Math.pow(f/T,1/h))-G_),-Me,Me);return new Q(k,this.southernCenter?-L:L)}}class Dk extends um{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:ve(r),y:Pe(a),z:0}}unproject(r,a){const h=Ie(r),f=Ce(a);return new Q(h,f)}}const Lk=$e(Me);class M8 extends um{project(r,a){const h=(a=$e(a))*a,f=h*h;return{x:.5*((r=$e(r))*(.8707-.131979*h+f*(f*(.003971*h-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+h*(.015085+f*(.028874*h-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,f=25,_=0,y=h*h;do{y=h*h;const k=y*y;_=(h*(1.007226+y*(.015085+k*(.028874*y-.044475-.005916*k)))-a)/(1.007226+y*(.045255+k*(.259866*y-.311325-.005916*11*k))),h=Oe(h-_,-Lk,Lk)}while(Math.abs(_)>1e-6&&--f>0);y=h*h;const T=Oe(oe(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),C=oe(h);return new Q(T,C)}}const jk=$e(Me);class k8 extends um{project(r,a){a=$e(a),r=$e(r);const h=Math.cos(a),f=2/Math.PI,_=Math.acos(h*Math.cos(r/2)),y=Math.sin(_)/_,T=.5*(r*f+2*h*Math.sin(r/2)/y)||0,C=.5*(a+Math.sin(a)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(r,a){let h=r=(2*r-.5)*Math.PI,f=a=(2*(1-a)-1)*Math.PI,_=25;const y=1e-6;let T=0,C=0;do{const k=Math.cos(f),L=Math.sin(f),j=2*L*k,N=L*L,H=k*k,W=Math.cos(h/2),ee=Math.sin(h/2),ie=2*W*ee,se=ee*ee,fe=1-H*W*W,pe=fe?1/fe:0,_e=fe?Math.acos(k*W)*Math.sqrt(1/fe):0,ke=.5*(2*_e*k*ee+2*h/Math.PI)-r,Re=.5*(_e*L+f)-a,Ne=.5*pe*(H*se+_e*k*W*N)+1/Math.PI,Fe=pe*(ie*j/4-_e*L*ee),Ue=.125*pe*(j*ee-_e*L*H*ie),ft=.5*pe*(N*W+_e*se*k)+.5,We=Fe*Ue-ft*Ne;T=(Re*Fe-ke*ft)/We,C=(ke*Ue-Re*Ne)/We,h=Oe(h-T,-Math.PI,Math.PI),f=Oe(f-C,-jk,jk)}while((Math.abs(T)>y||Math.abs(C)>y)&&--_>0);return new Q(oe(h),oe(f))}}class zk extends um{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos($e(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:h,cosPhi:f}=this;return{x:$e(r)*f*h+.5,y:-Math.sin($e(a))/f*h+.5,z:0}}unproject(r,a){const{scale:h,cosPhi:f}=this,_=-(a-.5)/h,y=Oe(oe((r-.5)/h)/f,-180,180),T=Math.asin(Oe(_*f,-1,1)),C=Oe(oe(T),-Me,Me);return new Q(y,C)}}class R8 extends Dk{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,a,h){const f=as(r,a,h);return wn(f,f,Lt(pn(h))),{x:f[0],y:f[1],z:f[2]}}locationPoint(r,a,h){const f=V(a.lat,a.lng),_=kn([],f),y=h?r._centerAltitude+h:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;zt(f,f,_,Ae(1,0)*Ft*y);const T=q(new Float64Array(16));return re(T,r.pixelMatrix,r.globeMatrix),wn(f,f,T),new It(f[0],f[1])}pixelsPerMeter(r,a){return Ae(1,0)*a}pixelSpaceConversion(r,a,h){const f=Ae(1,r)*a,_=An(Ae(1,45)*a,f,h);return this.pixelsPerMeter(r,a)/_}createTileMatrix(r,a,h){const f=Pn(pn(h.canonical));return re(new Float64Array(16),r.globeMatrix,f)}createInversionMatrix(r,a){const{center:h}=r,f=Lt(pn(a));return ge(f,f,$e(h.lng)),ye(f,f,$e(h.lat)),ue(f,f,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(r,a,h,f){return Je(r,a,h,!0)||new Qe(0,0)}pointCoordinate3D(r,a,h){const f=this.pointCoordinate(r,a,h,0);return[f.x,f.y,f.z]}isPointAboveHorizon(r,a){return!Je(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=(function(f,_){const y=f.cameraToCenterDistance,T=f._centerAltitude*_,C=f._camera,k=f._camera.forward(),L=St([],et([],k,-y),[0,0,T]),j=f.worldSize/(2*Math.PI),N=[0,0,-j],H=f.width/f.height,W=Math.tan(f.fovAboveCenter),ee=et([],C.up(),W),ie=et([],C.right(),W*H),se=kn([],St([],St([],k,ee),ie)),fe=[];let pe;if(new Mr(L,se).closestPointOnSphere(N,j,fe)){const _e=St([],fe,N),ke=nr([],_e,L);pe=Math.cos(f.fovAboveCenter)*en(ke)}else{const _e=nr([],L,N),ke=nr([],N,L);kn(ke,ke);const Re=en(_e)-j;pe=Math.sqrt(Re*(Re+2*j));const Ne=Math.acos(pe/(j+Re))-Math.acos(Bt(k,ke));pe*=Math.cos(Ne)}return 1.01*pe})(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=Tr(r.zoom);if(h>0){const f=Rk(r,Ae(1,r.center.lat)*r.worldSize),_=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return An(a,f+_*(1-Math.cos(y)),Math.pow(h,10))}return a}upVector(r,a,h){return as(a,h,r,1)}upVectorScale(r){return{metersToTile:ae(Et(pn(r)))}}}function Nk(l){const r=l.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(l.name){case"mercator":return new Dk(l);case"equirectangular":return new P8(l);case"naturalEarth":return new M8(l);case"equalEarth":return new C8(l);case"winkelTripel":return new k8(l);case"albers":return a?new zk(l):new A8(l);case"lambertConformalConic":return a?new zk(l):new I8(l);case"globe":return new R8(l)}throw new Error(`Invalid projection name: ${l.name}`)}const O8=wt.types,D8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function j0(l,r,a,h,f,_,y,T,C,k,L,j,N){const H=T?Math.min(cm,Math.round(T[0])):0,W=T?Math.min(cm,Math.round(T[1])):0;l.emplaceBack(r,a,Math.round(32*h),Math.round(32*f),_,y,(H<<1)+(C?1:0),W,16*k,16*L,256*j,256*N)}function z0(l,r,a){l.emplaceBack(r,a)}function N0(l,r,a,h,f,_,y){l.emplaceBack(r,a,h,f,_,y)}const F0=(l,r,a,h)=>{for(let f=0;f<r;f++)l.emplaceBack(a[0],a[1],a[2],h[0],h[1],h[2])};function B0(l,r,a,h,f){l.emplaceBack(r,a,h,f),l.emplaceBack(r,a,h,f),l.emplaceBack(r,a,h,f),l.emplaceBack(r,a,h,f)}function L8(l){for(const r of l.sections)if(pd(r.text))return!0;return!1}class r2{constructor(r){this.layoutVertexArray=new Nf,this.indexArray=new ss,this.programConfigurations=r,this.segments=new Rr,this.dynamicLayoutVertexArray=new Ca,this.opacityVertexArray=new du,this.placedSymbolArray=new fh,this.iconTransitioningVertexArray=new is,this.globeExtVertexArray=new hu,this.zOffsetVertexArray=new uu,this.orientationVertexArray=new Fs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,a,h,f,_){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,B$.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,V$.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,D8,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,G$.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,U$.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,$$.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,H$.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}nn(r2,"SymbolBuffers");class i2{constructor(r,a,h){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new h,this.segments=new Rr,this.collisionVertexArray=new Kp,this.collisionVertexArrayExt=new Ca}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,W$.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,q$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}nn(i2,"CollisionBuffers");class U0{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((y=>y.fqid)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=q([]),this.placementViewportMatrix=q([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.textSizeData=fk(this.zoom,a["text-size"],this.worldview),this.iconSizeData=fk(this.zoom,a["icon-size"],this.worldview);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.lut=r.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map((y=>Il[y])),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new r2(new rl(this.layers,{zoom:this.zoom,lut:this.lut},(r=>r.startsWith("text")||r.startsWith("symbol")))),this.icon=new r2(new rl(this.layers,{zoom:this.zoom,lut:this.lut},(r=>r.startsWith("icon")||r.startsWith("symbol")))),this.glyphOffsetArray=new nm,this.lineVertexArray=new dg,this.symbolInstances=new hg}calculateGlyphDependencies(r,a,h,f,_){for(const y of r){const T=y.codePointAt(0);if(T===void 0)break;if(a[T]=!0,f&&_&&T<=65535){const C=dv[y];C&&(a[C.charCodeAt(0)]=!0)}}}updateFootprints(r,a){}updateReplacement(r,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!g0(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(r,a,h,f){const _=this.layers[0],y=_.layout,T=this.projection.name==="globe",C=y.get("text-font"),k=y.get("text-field"),L=y.get("icon-image"),[j,N]=y.get("icon-size-scale-range"),H=Oe(a.scaleFactor||1,j,N),W=(k.value.kind!=="constant"||k.value.value instanceof xo&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),ee=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,ie=y.get("symbol-sort-key");if(this.features=[],!W&&!ee)return;const se=a.iconDependencies,fe=a.glyphDependencies,pe=a.availableImages,_e=new wr(this.zoom,{worldview:this.worldview});for(const{feature:ke,id:Re,index:Ne,sourceLayerIndex:Fe}of r){const Ue=_._featureFilter.needGeometry,ft=Pt(ke,Ue);if(!_._featureFilter.filter(_e,ft,h))continue;if(Ue||(ft.geometry=Gt(ke,h,f)),T&&ke.type!==1&&h.z<=5){const xt=ft.geometry,Rt=.98078528056,ht=(bt,st)=>Bt(as(bt.x,bt.y,h,1),as(st.x,st.y,h,1))<Rt;for(let bt=0;bt<xt.length;bt++)xt[bt]=ut(xt[bt],ht)}let We,mt;if(W){const xt=_.getValueAndResolveTokens("text-field",ft,h,pe),Rt=xo.factory(xt);L8(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||gd()==="unavailable"||this.hasRTLText&&Ai.isParsed())&&(We=X$(Rt,_,ft))}if(ee){const xt=_.getValueAndResolveTokens("icon-image",ft,h,pe);mt=typeof xt=="string"?jo.build(xt):xt}if(!We&&!mt)continue;const Ct=this.sortFeaturesByKey?ie.evaluate(ft,{},h):void 0,yt={id:Re,text:We,icon:mt,index:Ne,sourceLayerIndex:Fe,geometry:ft.geometry,properties:ke.properties,type:O8[ke.type],sortKey:Ct};if(this.features.push(yt),mt){const xt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Rt,iconSecondary:ht}=Pk(mt,this.iconSizeData,xt["icon-size"],h,this.zoom,yt,this.pixelRatio,H,this.worldview),bt=Rt.id.toString();if(se.has(bt)?se.get(bt).push(Rt):se.set(bt,[Rt]),ht){this.hasAnySecondaryIcon=!0;const st=ht.id.toString();se.has(st)?se.get(st).push(ht):se.set(st,[ht])}}if(We){const xt=C.evaluate(ft,{},h).join(","),Rt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Il.vertical)>=0;for(const ht of We.sections)if(ht.image){const bt=ht.image.getPrimary().scaleSelf(this.pixelRatio),st=bt.id.toString(),nt=se.get(st)||[];nt.push(bt),se.set(st,nt)}else{const bt=fd(We.toString()),st=ht.fontStack||xt,nt=fe[st]=fe[st]||{};this.calculateGlyphDependencies(ht.text,nt,Rt,this.allowVerticalPlacement,bt)}}}if(y.get("symbol-placement")==="line"&&(this.features=(function(ke){const Re={},Ne={},Fe=[];let Ue=0;function ft(yt){Fe.push(ke[yt]),Ue++}function We(yt,xt,Rt){const ht=Ne[yt];return delete Ne[yt],Ne[xt]=ht,Fe[ht].geometry[0].pop(),Fe[ht].geometry[0]=Fe[ht].geometry[0].concat(Rt[0]),ht}function mt(yt,xt,Rt){const ht=Re[xt];return delete Re[xt],Re[yt]=ht,Fe[ht].geometry[0].shift(),Fe[ht].geometry[0]=Rt[0].concat(Fe[ht].geometry[0]),ht}function Ct(yt,xt,Rt){const ht=Rt?xt[0][xt[0].length-1]:xt[0][0];return`${yt}:${ht.x}:${ht.y}`}for(let yt=0;yt<ke.length;yt++){const xt=ke[yt],Rt=xt.geometry,ht=xt.text?xt.text.toString():null;if(!ht){ft(yt);continue}const bt=Ct(ht,Rt),st=Ct(ht,Rt,!0);if(bt in Ne&&st in Re&&Ne[bt]!==Re[st]){const nt=mt(bt,st,Rt),Ot=We(bt,st,Fe[nt].geometry);delete Re[bt],delete Ne[st],Ne[Ct(ht,Fe[Ot].geometry,!0)]=Ot,Fe[nt].geometry=null}else bt in Ne?We(bt,st,Rt):st in Re?mt(bt,st,Rt):(ft(yt),Re[bt]=Ue-1,Ne[st]=Ue-1)}return Fe.filter((yt=>yt.geometry))})(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ke of a.elevationFeatures)this.elevationFeatureIdToIndex.set(ke.id,this.elevationFeatures.length),this.elevationFeatures.push(ke)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((ke,Re)=>ke.sortKey-Re.sortKey))}update(r,a,h,f,_,y,T){this.text.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,a,_,h,f,y,T,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const h=Xe(r),f=1/h;let _=!1,y=!1;for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T),k=Jt(1,0,0),L=Jt(0,1,0),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:N,numIconVertices:H,numVerticalIconVertices:W}=C,ee=j>0||N>0,ie=H>0,se=this.elevationFeatures[C.elevationFeatureIndex];if(se){const fe=new It(C.tileAnchorX,C.tileAnchorY),pe=.075+se.pointElevation(fe);C.zOffset!==pe&&(a=!0,C.zOffset=pe);const _e=se.computeSlopeNormal(fe,f),ke=no(ha(),Jt(0,0,1),_e);tn(k,k,ke),tn(L,L,ke),k[2]*=h,L[2]*=h,k[0]===1&&k[1]===0&&k[2]===0&&L[0]===0&&L[1]===1&&L[2]===0||(_=_||ee,y=y||ie)}if(ee&&(F0(this.text.orientationVertexArray,j,k,L),F0(this.text.orientationVertexArray,N,k,L)),ie){const{placedIconSymbolIndex:fe,verticalPlacedIconSymbolIndex:pe}=C;fe>=0&&F0(this.icon.orientationVertexArray,H,k,L),pe>=0&&F0(this.icon.orientationVertexArray,W,k,L)}}_||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(_,y,T)=>{h+=y,h>_.length&&_.resize(h);for(let C=-y;C<0;C++)_.emplace(C+h,T)},a=(_,y,T)=>{f+=y,f>_.length&&_.resize(f);for(let C=-y;C<0;C++)_.emplace(C+f,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,f=0;for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:C,numIconVertices:k}=y,L=y.zOffset,j=k>0;if((T>0||C>0)&&(r(this.text.zOffsetVertexArray,T,L),r(this.text.zOffsetVertexArray,C,L)),j){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:H}=y;N>=0&&a(this.icon.zOffsetVertexArray,k,L),H>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,L)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Nk(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:f,y:_}of a)this.lineVertexArray.emplaceBack(f,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee,ie){const se=r.indexArray,fe=r.layoutVertexArray,pe=r.globeExtVertexArray,_e=r.segments.prepareSegment(4*a.length,fe,se,this.canOverlap?y.sortKey:void 0),ke=this.glyphOffsetArray.length,Re=_e.vertexLength,Ne=this.allowVerticalPlacement&&T===Il.vertical?Math.PI/2:0,Fe=y.text&&y.text.sections;for(let ft=0;ft<a.length;ft++){const{tl:We,tr:mt,bl:Ct,br:yt,texPrimary:xt,texSecondary:Rt,pixelOffsetTL:ht,pixelOffsetBR:bt,minFontScaleX:st,minFontScaleY:nt,glyphOffset:Ot,isSDF:Mt,sectionIndex:bn}=a[ft],rn=_e.vertexLength,fn=Ot[1];if(j0(fe,k.x,k.y,We.x,fn+We.y,xt.x,xt.y,h,Mt,ht.x,ht.y,st,nt),j0(fe,k.x,k.y,mt.x,fn+mt.y,xt.x+xt.w,xt.y,h,Mt,bt.x,ht.y,st,nt),j0(fe,k.x,k.y,Ct.x,fn+Ct.y,xt.x,xt.y+xt.h,h,Mt,ht.x,bt.y,st,nt),j0(fe,k.x,k.y,yt.x,fn+yt.y,xt.x+xt.w,xt.y+xt.h,h,Mt,bt.x,bt.y,st,nt),C){const{x:Ut,y:xn,z:Nn}=C.anchor,[Yt,mn,On]=C.up;N0(pe,Ut,xn,Nn,Yt,mn,On),N0(pe,Ut,xn,Nn,Yt,mn,On),N0(pe,Ut,xn,Nn,Yt,mn,On),N0(pe,Ut,xn,Nn,Yt,mn,On),B0(r.dynamicLayoutVertexArray,Ut,xn,Nn,Ne)}else B0(r.dynamicLayoutVertexArray,k.x,k.y,k.z,Ne);if(ie){const Ut=Rt||xt;z0(r.iconTransitioningVertexArray,Ut.x,Ut.y),z0(r.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y),z0(r.iconTransitioningVertexArray,Ut.x,Ut.y+Ut.h),z0(r.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y+Ut.h)}se.emplaceBack(rn,rn+1,rn+2),se.emplaceBack(rn+1,rn+2,rn+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ot[0]),ft!==a.length-1&&bn===a[ft+1].sectionIndex||r.programConfigurations.populatePaintArrays(fe.length,y,y.index,{},H,W,ee,Fe&&Fe[bn],this.worldview)}const Ue=C?C.anchor:k;r.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,k.x,k.y,ke,this.glyphOffsetArray.length-ke,Re,L,j,k.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],T,0,0,0,N,0)}_commitLayoutVertex(r,a,h,f,_,y,T){r.emplaceBack(a,h,f,_,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(r,a,h,f,_,y,T){const C=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),k=C.vertexLength,L=T.tileAnchorX,j=T.tileAnchorY;for(let H=0;H<4;H++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,a,r.padding,T.zOffset),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,L,j,new It(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,L,j,new It(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,L,j,new It(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,L,j,new It(r.x1,r.y2)),C.vertexLength+=4;const N=h.indexArray;N.emplaceBack(k,k+1),N.emplaceBack(k+1,k+2),N.emplaceBack(k+2,k+3),N.emplaceBack(k+3,k),C.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,h,f,_,y){for(let T=f;T<_;T++){const C=h.get(T),k=this.getSymbolInstanceTextSize(r,y,a,T);this._addCollisionDebugVertices(C,k,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,a,h,f,_,y){for(let T=f;T<_;T++){const C=h.get(T),k=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(C,k,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,a,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new i2(Ff,JM.members,is),this.iconCollisionBox=new i2(Ff,JM.members,is);const f=pv(this.iconSizeData,r),_=pv(this.textSizeData,r,h);for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(_,r,a,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(_,r,a,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(f,r,a,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(f,r,a,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(r,a,h,f){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:f),y=YS(this.textSizeData,r,_)/Ks;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,a,h){const f=this.icon.placedSymbolArray.get(h),_=YS(this.iconSizeData,r,f);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(r,a,h,f){r.emplaceBack(a,-h,-h,f),r.emplaceBack(a,h,-h,f),r.emplaceBack(a,h,h,f),r.emplaceBack(a,-h,h,f)}_updateTextDebugCollisionBoxes(r,a,h,f,_,y,T){for(let C=f;C<_;C++){const k=h.get(C),L=this.getSymbolInstanceTextSize(r,y,a,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,L,k.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(r,a,h,f,_,y,T){for(let C=f;C<_;C++){const k=h.get(C),L=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,L,k.padding,y.zOffset)}}updateCollisionDebugBuffers(r,a,h,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=pv(this.iconSizeData,r,f),y=pv(this.textSizeData,r,h);for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(y,r,a,C.textBoxStartIndex,C.textBoxEndIndex,C,h),this._updateTextDebugCollisionBoxes(y,r,a,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,h),this._updateIconDebugCollisionBoxes(_,r,a,C.iconBoxStartIndex,C.iconBoxEndIndex,C,f),this._updateIconDebugCollisionBoxes(_,r,a,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,h,f,_,y,T,C,k){const L={};if(a<h){const{x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e,featureIndex:ke}=r.get(a);L.textBox={x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e},L.textFeatureIndex=ke}if(f<_){const{x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e,featureIndex:ke}=r.get(f);L.verticalTextBox={x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e},L.verticalTextFeatureIndex=ke}if(y<T){const{x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e,featureIndex:ke}=r.get(y);L.iconBox={x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e},L.iconFeatureIndex=ke}if(C<k){const{x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e,featureIndex:ke}=r.get(C);L.verticalIconBox={x1:j,y1:N,x2:H,y2:W,padding:ee,projectedAnchorX:ie,projectedAnchorY:se,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:_e},L.verticalIconFeatureIndex=ke}return L}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,a){const h=r.placedSymbolArray.get(a),f=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<f;_+=4)r.indexArray.emplaceBack(_,_+1,_+2),r.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(r),h=Math.cos(r),f=[],_=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const C=this.symbolInstances.get(T);f.push(0|Math.round(a*C.tileAnchorX+h*C.tileAnchorY)),_.push(C.featureIndex)}return y.sort(((T,C)=>f[T]-f[C]||_[C]-_[T])),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((r,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(r).zOffset))}addToSortKeyRanges(r,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:k}=h;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&y!==_&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Fk,Bk,s2;nn(U0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),U0.addDynamicAttributes=B0;class Uk{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Nl,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nn(Uk,"FormatSectionOverride",{omit:["defaultValue"]});const o2=()=>s2||(s2={layout:Fk||(Fk=new di({"symbol-placement":new kt(He.layout_symbol["symbol-placement"]),"symbol-spacing":new kt(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kt(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kt(He.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new kt(He.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new kt(He.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new kt(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kt(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new kt(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kt(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(He.layout_symbol["icon-size"]),"icon-size-scale-range":new kt(He.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new $t(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(He.layout_symbol["icon-image"]),"icon-image-use-theme":new kt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new $t(He.layout_symbol["icon-rotate"]),"icon-padding":new kt(He.layout_symbol["icon-padding"]),"icon-keep-upright":new kt(He.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(He.layout_symbol["icon-offset"]),"icon-anchor":new $t(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kt(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kt(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kt(He.layout_symbol["text-rotation-alignment"]),"text-field":new $t(He.layout_symbol["text-field"]),"text-font":new $t(He.layout_symbol["text-font"]),"text-size":new $t(He.layout_symbol["text-size"]),"text-size-scale-range":new kt(He.layout_symbol["text-size-scale-range"]),"text-max-width":new $t(He.layout_symbol["text-max-width"]),"text-line-height":new $t(He.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(He.layout_symbol["text-letter-spacing"]),"text-justify":new $t(He.layout_symbol["text-justify"]),"text-radial-offset":new $t(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kt(He.layout_symbol["text-variable-anchor"]),"text-anchor":new $t(He.layout_symbol["text-anchor"]),"text-max-angle":new kt(He.layout_symbol["text-max-angle"]),"text-writing-mode":new kt(He.layout_symbol["text-writing-mode"]),"text-rotate":new $t(He.layout_symbol["text-rotate"]),"text-padding":new kt(He.layout_symbol["text-padding"]),"text-keep-upright":new kt(He.layout_symbol["text-keep-upright"]),"text-transform":new $t(He.layout_symbol["text-transform"]),"text-offset":new $t(He.layout_symbol["text-offset"]),"text-allow-overlap":new kt(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kt(He.layout_symbol["text-ignore-placement"]),"text-optional":new kt(He.layout_symbol["text-optional"]),visibility:new kt(He.layout_symbol.visibility)})),paint:Bk||(Bk=new di({"icon-opacity":new $t(He.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new $t(He.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new $t(He.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $t(He.paint_symbol["text-emissive-strength"]),"icon-color":new $t(He.paint_symbol["icon-color"]),"icon-halo-color":new $t(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(He.paint_symbol["icon-halo-blur"]),"icon-translate":new kt(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new kt(He.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(He.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $t(He.paint_symbol["text-opacity"]),"text-occlusion-opacity":new $t(He.paint_symbol["text-occlusion-opacity"]),"text-color":new $t(He.paint_symbol["text-color"],{runtimeType:Jo,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new $t(He.paint_symbol["text-halo-color"]),"text-halo-width":new $t(He.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(He.paint_symbol["text-halo-blur"]),"text-translate":new kt(He.paint_symbol["text-translate"]),"text-translate-anchor":new kt(He.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new kt(He.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new kt(He.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new kt(He.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new kt(He.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new $t(He.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},s2);class V0 extends Ws{constructor(r,a,h,f){super(r,o2(),a,h,f,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=q([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,a){super.recalculate(r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const _ of h)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,a,h,f){return this._saturation===r&&this._contrast===a&&this._brightnessMin===h&&this._brightnessMax===f||(this._colorAdjustmentMatrix=(function(_,y,T,C){_=da(_),y=Yi(y);const k=Z(),L=_/3,j=1-2*L,N=[j,L,L,0,L,j,L,0,L,L,j,0,0,0,0,1],H=.5-.5*y,W=C-T;return re(k,[W,0,0,0,0,W,0,0,0,0,W,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,H,H,H,1]),re(k,k,N),k})(r,a,h,f),this._saturation=r,this._contrast=a,this._brightnessMin=h,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,a,h,f){const _=this.layout.get(r).evaluate(a,{},h,f),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||ru(y.value)||!_?_:(function(T,C){return C.replace(/{([^{}]+)}/g,((k,L)=>L in T?String(T[L]):""))})(a.properties,_)}createBucket(r){return new U0(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of o2().paint.overridableProperties){if(!V0.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),h=new Uk(a),f=new rh(h,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new ih("source",f):new Hl("composite",f,a.value.zoomStops,a.value.interpolationType),this.paint._values[r]=new Tc(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&V0.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const h=r.get("text-field"),f=o2().paint.properties[a];let _=!1;const y=T=>{for(const C of T)if(f.overrides&&f.overrides.hasOverride(C))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof xo)y(h.value.value.sections);else if(h.value.kind==="source"){const T=k=>{_||(k instanceof Gn&&fs(k.value)===Wc?y(k.value.sections):k instanceof Zc?y(k.sections):k.eachChild(T))},C=h.value;C._styleExpression&&T(C._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,a,h){return{config:new _h(this,{zoom:a,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Vk,$k,Hk,Gk;var a2=vr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function $0(l,r,a,h,f,_,y,T){const C=[l,r,1,a,h,1,f,_,1],k=[y,T,1],L=F([],C),[j,N,H]=mr(k,k,L);return $(C,C,[j,0,0,0,N,0,0,0,H])}function Wk(l,r,a,h,f,_,y,T){const C=(function(k,L,j,N,H,W,ee,ie){const se=$0(0,0,1,0,1,1,0,1),fe=$0(k,L,j,N,H,W,ee,ie);return $(fe,fe,F([],se))})(l,r,a,h,f,_,y,T);return[C[2]/C[8]/Ft,C[5]/C[8]/Ft]}function H0(l){return[l[0],Math.min(Math.max(l[1],-Me),Me)]}class qk extends Gc{constructor(r,a,h,f){super(),this.id=r,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=a,this._dirty=!1}load(r,a){if(this._loaded=a||!1,this.fire(new Va("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=zl(this.map._requestManager.transformRequest(this.url,yl.Image),((h,f)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new $a(h)):f&&(this.image=f instanceof HTMLImageElement?_l.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())}))}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new cv(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Va("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof cv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=r[0][1],h=r[0][1];for(const _ of r)_[1]>h&&(h=_[1]),_[1]<a&&(a=_[1]);const f=(h+a)/2;if(f>Me?this.onNorthPole=!0:f<-Me&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=r.map(Qe.fromLngLat);this.tileID=(function(y){let T=1/0,C=1/0,k=-1/0,L=-1/0;for(const ee of y)T=Math.min(T,ee.x),C=Math.min(C,ee.y),k=Math.max(k,ee.x),L=Math.max(L,ee.y);const j=Math.max(k-T,L-C),N=Math.max(0,Math.floor(-Math.log2(j))),H=Math.pow(2,N);let W=Math.floor((T+k)/2*H);return W>1&&(W-=1),new Ic(N,W,Math.floor((C+L)/2*H))})(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Va("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof cv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const se in this.tiles){const fe=this.tiles[se];fe.state!=="loaded"&&(fe.state="loaded",fe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=yv(new Ic(0,0,0),this.map.transform.projection),h=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(se){const fe=se[1].x-se[0].x,pe=se[1].y-se[0].y,_e=se[2].x-se[1].x,ke=se[2].y-se[1].y,Re=se[3].x-se[2].x,Ne=se[3].y-se[2].y,Fe=se[0].x-se[3].x,Ue=se[0].y-se[3].y,ft=fe*ke-_e*pe,We=_e*Ne-Re*ke,mt=Re*Ue-Fe*Ne,Ct=Fe*pe-fe*Ue;return ft>0&&We>0&&mt>0&&Ct>0||ft<0&&We<0&&mt<0&&Ct<0})(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=yv(this.tileID,this.map.transform.projection),[_,y,T,C]=this.coordinates.map((se=>{const fe=f.projection.project(se[0],se[1]);return Ok(f,fe)._round()}));this.perspectiveTransform=Wk(_.x,_.y,y.x,y.y,T.x,T.y,C.x,C.y);const k=this._boundsArray=new Gl;k.emplaceBack(_.x,_.y,0,0),k.emplaceBack(y.x,y.y,Ft,0),k.emplaceBack(C.x,C.y,0,Ft),k.emplaceBack(T.x,T.y,Ft,Ft),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(k,a2.members),this.boundsSegments=Rr.simpleSegment(0,0,4,2);const L=[],j=[H0((N=this.coordinates)[0]),H0(N[1]),H0(N[2]),H0(N[3])];var N;const[H,W,ee,ie]=(function(se){let fe=se[0][0],pe=fe,_e=se[0][1],ke=_e;for(let Re=1;Re<se.length;Re++)se[Re][0]<fe?fe=se[Re][0]:se[Re][0]>pe&&(pe=se[Re][0]),se[Re][1]<_e?_e=se[Re][1]:se[Re][1]>ke&&(ke=se[Re][1]);return[fe,_e,pe-fe,ke-_e]})(j);{const se=new Gl,[fe,pe,_e,ke]=(function(ht){let bt=ht[0].x,st=bt,nt=ht[0].y,Ot=nt;for(let Mt=1;Mt<ht.length;Mt++)ht[Mt].x<bt?bt=ht[Mt].x:ht[Mt].x>st&&(st=ht[Mt].x),ht[Mt].y<nt?nt=ht[Mt].y:ht[Mt].y>Ot&&(Ot=ht[Mt].y);return[bt,nt,st-bt,Ot-nt]})(h),Re=ht=>[(ht.x-fe)/_e,(ht.y-pe)/ke],[Ne,Fe,Ue,ft]=h.map(Re),We=(function(ht,bt,st,nt,Ot,Mt,bn,rn){const fn=$0(0,0,1,0,1,1,0,1);return $(fn,fn,F([],$0(ht,bt,st,nt,Ot,Mt,bn,rn)))})(Ne[0],Ne[1],Fe[0],Fe[1],Ue[0],Ue[1],ft[0],ft[1]);this.elevatedGlobePerspectiveTransform=Wk(Ne[0],Ne[1],Fe[0],Fe[1],Ue[0],Ue[1],ft[0],ft[1]);const mt=(ht,bt)=>{L.push(ht.lng);const st=Math.round((ht.lng-H)/ee*Ft),nt=Math.round((ht.lat-W)/ie*Ft),Ot=Re(bt),Mt=mr([],[Ot[0],Ot[1],1],We),bn=Math.round(Mt[0]/Mt[2]*Ft),rn=Math.round(Mt[1]/Mt[2]*Ft);se.emplaceBack(st,nt,bn,rn)},Ct=h[3].x-h[0].x,yt=h[3].y-h[0].y,xt=h[2].x-h[1].x,Rt=h[2].y-h[1].y;for(let ht=0;ht<65;ht++){const bt=ht/64,st=[h[0].x+bt*Ct,h[0].y+bt*yt],nt=[h[1].x+bt*xt,h[1].y+bt*Rt],Ot=nt[0]-st[0],Mt=nt[1]-st[1];for(let bn=0;bn<65;bn++){const rn=bn/64,fn={x:st[0]+Ot*rn,y:st[1]+Mt*rn};mt(a.projection.unproject(fn.x,fn.y),fn)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(se,a2.members)}{this.maxLongitudeTriangleSize=0;let se=[],fe=new ss;const pe=(_e,ke,Re)=>{fe.emplaceBack(_e,ke,Re);const Ne=L[_e],Fe=L[ke],Ue=L[Re],ft=Math.min(Math.min(Ne,Fe),Ue),We=Math.max(Math.max(Ne,Fe),Ue)-ft;We>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=We),se.push(ft+We/2)};for(let _e=0;_e<64;_e++)for(let ke=0;ke<64;ke++){const Re=65*_e+ke,Ne=Re+1,Fe=Re+65,Ue=Fe+1;pe(Re,Fe,Ne),pe(Ne,Fe,Ue)}[se,fe]=(function(_e,ke){const Re=Array.from({length:_e.length},((Ue,ft)=>ft));Re.sort(((Ue,ft)=>_e[Ue]-_e[ft]));const Ne=[],Fe=new ss;for(let Ue=0;Ue<Re.length;Ue++){const ft=Re[Ue];Ne.push(_e[ft]);const We=3*ft,mt=We+1;Fe.emplaceBack(ke.uint16[We],ke.uint16[mt],ke.uint16[mt+1])}return[Ne,Fe]})(se,fe),this.elevatedGlobeTrianglesCenterLongitudes=se,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(fe)}this.elevatedGlobeSegments=Rr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ee/Ft,0,ie/Ft,0,0,W,H,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const a=this.map.painter.context,h=a.gl;!this._dirty||this.texture instanceof cv||(this.texture?this.texture.update(this.image):(this.texture=new LS(a,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(a)}loadTile(r,a){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},a(null)):(r.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let f=(_=r+180)+360*Math.round((h[0]-_)/360);var _;const y=new Rr,T=(j,N)=>{y.segments.push({vertexOffset:0,primitiveOffset:j,vertexLength:a.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-f)<=C){const j=ds(h,0,h.length,f+C);return j===h.length||T(j,ti(h,j+1,h.length,f+360-C)-j),y}f<h[0]&&(f+=360);const k=ti(h,0,h.length,f-C);if(k===h.length)return T(0,h.length),y;T(0,k-0);const L=ds(h,k+1,h.length,f+C);return L!==h.length&&T(L,h.length-L),y}}const j8=(Math.pow(256,2)-1)/16907520;class Zk extends Ws{constructor(r,a,h,f){super(r,{layout:Hk||(Hk=new di({visibility:new kt(He.layout_raster.visibility)})),paint:Gk||(Gk=new di({"raster-opacity":new kt(He.paint_raster["raster-opacity"]),"raster-color":new co(He.paint_raster["raster-color"]),"raster-color-mix":new kt(He.paint_raster["raster-color-mix"]),"raster-color-range":new kt(He.paint_raster["raster-color-range"]),"raster-hue-rotate":new kt(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kt(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kt(He.paint_raster["raster-brightness-max"]),"raster-saturation":new kt(He.paint_raster["raster-saturation"]),"raster-contrast":new kt(He.paint_raster["raster-contrast"]),"raster-resampling":new kt(He.paint_raster["raster-resampling"]),"raster-fade-duration":new kt(He.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new kt(He.paint_raster["raster-emissive-strength"]),"raster-array-band":new kt(He.paint_raster["raster-array-band"]),"raster-elevation":new kt(He.paint_raster["raster-elevation"]),"raster-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},a,h,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof qk&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[h,f]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(f)||h===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=Zy({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,f])}}let Xk,Yk,Kk,Jk,Qk;class eR extends Ws{constructor(r,a,h,f){super(r,{layout:Xk||(Xk=new di({visibility:new kt(He["layout_raster-particle"].visibility)})),paint:Yk||(Yk=new di({"raster-particle-array-band":new kt(He["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new kt(He["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new co(He["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new kt(He["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new kt(He["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new kt(He["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new kt(He["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new kt(He["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},a,h,f),this._updateColorRamp(),this.lastInvalidatedAt=_l.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Zy({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=_l.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class z8 extends Ws{constructor(r,a){super(r,{},a,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function l2(l,r,a){const h=[0,0,1],f=ja([]);return Na(f,f,a?-$e(l)+Math.PI:$e(l)),za(f,f,-$e(r)),tn(h,h,f),kn(h,h)}const tR={None:0,Model:1,Symbol:2,FillExtrusion:4};class G0{constructor(r,a,h,f){this.message=(r?`${r}: `:"")+h,f&&(this.identifier=f),a!=null&&a.__line__&&(this.line=a.__line__)}}function c2(l,r){const a=l.indexOf("://")===-1;try{return new URL(l,a&&r?"http://example.com":void 0),!0}catch{return!1}}class nR{constructor(r,a){this.feature=r,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class rR{constructor(){this.instancedDataArray=new $f,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class u2{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs}updateFootprints(r,a){}populate(r,a,h,f){this.tileToMeter=Xe(h);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:C,sourceLayerIndex:k}of r){const L=T??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),j=Pt(y,_);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{worldview:this.worldview}),j,h))continue;const N={id:L,sourceLayerIndex:k,index:C,geometry:_?j.geometry:Gt(y,h,f),properties:y.properties,type:y.type,patterns:{}},H=this.addFeature(N,N.geometry,j);H&&a.featureIndex.insert(y,N.geometry,C,k,this.index,this.instancesPerModel[H].instancedDataArray.length,Ft/32)}this.lookup=null}update(r,a,h,f){for(const _ in this.instancesPerModel){const y=this.instancesPerModel[_];for(const T in r)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],r[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const f of h.features){const _=this.layers[0],y=f.feature,T=this.canonical,C=_.paint.get("model-rotation").evaluate(y,{},T),k=_.paint.get("model-scale").evaluate(y,{},T),L=_.paint.get("model-translation").evaluate(y,{},T);Hn(f.rotation,C)&&Hn(f.scale,k)&&Hn(f.translation,L)||(this.evaluate(f,f.featureStates,h,!0),r=!0)}}return r}updateReplacement(r,a,h,f){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(g0(this.activeReplacements,_))return!1;this.activeReplacements=_;let y=!1;for(const T in this.instancesPerModel){const C=this.instancesPerModel[T],k=C.instancedDataArray;for(const L of C.features){const j=L.instancedDataOffset,N=L.instancedDataCount;for(let H=0;H<N;H++){const W=16*(H+j);let ee=k.float32[W+0];const ie=ee>Ft;ee=ie?ee-Ft:ee;const se=Math.floor(ee),fe=k.float32[W+1];let pe=!1;for(const _e of this.activeReplacements)if(!$I(_e,h,tR.Model,f)&&!(_e.min.x>se||se>_e.max.x||_e.min.y>fe||fe>_e.max.y)&&(pe=SS(qI(se,fe,r.canonical,_e.footprintTileId.canonical),_e.footprint),pe))break;k.float32[W]=pe?ee+Ft:ee,y=y||pe!==ie}}}return y}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=r.createVertexBuffer(h.instancedDataArray,d$.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)r.removeModel(a,"",!0)}addFeature(r,a,h){const f=this.layers[0],_=f.layout.get("model-id").evaluate(h,{},this.canonical);if(!_)return _r(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),_;(c2(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new rR);const y=this.instancesPerModel[_],T=y.instancedDataArray,C=new nR(h,T.length);for(const k of a)for(const L of k){if(L.x<0||L.x>=Ft||L.y<0||L.y>=Ft)continue;if(this.lookupDim!==0){const N=(this.lookupDim-1)/Ft,H=this.lookupDim*(L.y*N|0)+L.x*N|0;if(this.lookup){if(this.lookup[H]!==0)continue;this.lookup[H]=1}}this.instanceCount++;const j=T.length;T.resize(j+1),y.instancesEvaluatedElevation.push(0),T.float32[16*j]=L.x,T.float32[16*j+1]=L.y}return C.instancedDataCount=y.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(r.id&&(y.idToFeaturesIndex[r.id]=y.features.length),y.features.push(C),this.evaluate(C,{},y,!1)),_}getModelUris(){return this.modelUris}evaluate(r,a,h,f){const _=this.layers[0],y=r.feature,T=this.canonical,C=r.rotation=_.paint.get("model-rotation").evaluate(y,a,T),k=r.scale=_.paint.get("model-scale").evaluate(y,a,T),L=r.translation=_.paint.get("model-translation").evaluate(y,a,T),j=_.paint.get("model-color").evaluate(y,a,T);j.a=_.paint.get("model-color-mix-intensity").evaluate(y,a,T);const N=[];this.maxVerticalOffset<L[2]&&(this.maxVerticalOffset=L[2]),this.maxScale=Math.max(Math.max(this.maxScale,k[0]),Math.max(k[1],k[2])),PM(N,C,k);const H=Math.round(100*j.a)+j.b/1.05;for(let W=0;W<r.instancedDataCount;++W){const ee=r.instancedDataOffset+W,ie=16*ee,se=h.instancedDataArray.float32;let fe=0;f&&(fe=se[ie+6]-h.instancesEvaluatedElevation[ee]);const pe=0|se[ie+1];se[ie]=(0|se[ie])+j.r/1.05,se[ie+1]=pe+j.g/1.05,se[ie+2]=H,se[ie+3]=1/(T.z>10?this.tileToMeter:Xe(T,pe)),se[ie+4]=L[0],se[ie+5]=L[1],se[ie+6]=L[2]+fe,se[ie+7]=N[0],se[ie+8]=N[1],se[ie+9]=N[2],se[ie+10]=N[4],se[ie+11]=N[5],se[ie+12]=N[6],se[ie+13]=N[8],se[ie+14]=N[9],se[ie+15]=N[10],h.instancesEvaluatedElevation[ee]=L[2]}}}let iR,sR;nn(u2,"ModelBucket",{omit:["layers"]}),nn(rR,"PerModelAttributes"),nn(nR,"ModelFeature");class W_{constructor(r,a,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=h}static create(r,a,h){const f=h||r.findDEMTileFor(a);if(!f||!f.dem)return;const _=f.dem,y=f.tileID,T=1<<a.canonical.z-y.canonical.z;return new W_(f,_.dim/Ft/T,[(a.canonical.x/T-y.canonical.x)*_.dim,(a.canonical.y/T-y.canonical.y)*_.dim])}tileCoordToPixel(r,a){const h=a*this._scale+this._offset[1];return new It(Math.floor(r*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(r,a,h,f){const _=r*this._scale+this._offset[0],y=a*this._scale+this._offset[1],T=Math.floor(_),C=Math.floor(y),k=this._dem;return f=!!f,h?An(An(k.get(T,C,f),k.get(T,C+1,f),y-C),An(k.get(T+1,C,f),k.get(T+1,C+1,f),y-C),_-T):k.get(T,C,f)}getElevationAtPixel(r,a,h){return this._dem.get(r,a,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Ae(1,r)*this._dem.stride}}const h2=new Float32Array(262144),Sg=new Uint8Array(262144);function oR(l){let r=0;if(l.meshes)for(const a of l.meshes)r=Math.max(r,a.aabb.max[2]);if(l.children)for(const a of l.children)r=Math.max(r,oR(a));return r}function aR(l,r,a){if(l.meshes)for(const h of l.meshes){if(h.aabb.min[0]===1/0)continue;const f=Mn.applyTransform(h.aabb,l.matrix);a.insert(r,f.min[0],f.min[1],f.max[0],f.max[1])}if(l.children)for(const h of l.children)aR(h,r,a)}const lR=["","wall","door","roof","window","lamp","logo"];class cR{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:oR(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const a=new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==r&&(h.transformedAabb=Mn.applyTransformFast(h.aabb,this.node.matrix),a.encapsulate(h.transformedAabb)),r++;this.aabb=a}return this.aabb}}class W0{constructor(r,a,h,f,_,y,T,C){this.id=h,this.layers=r,this.layerIds=this.layers.map((k=>k.fqid)),this.stateDependentLayerIds=this.layers.filter((k=>k.isStateDependent())).map((k=>k.id)),this.modelTraits|=B_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=B_.HasMapboxMeshFeatures),_&&(this.modelTraits|=B_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=C,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const k of a)this.nodesInfo.push(new cR(k)),aR(k,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(r,a){for(const h of this.getNodesInfo()){const f=h.node;f.footprint&&a.push({footprint:f.footprint,id:r})}}update(r){const a=Object.keys(r).length!==0;if(a&&!this.stateDependentLayers.length)return;const h=a?this.stateDependentLayers:this.layers;if(!Dl(r,this.states))for(const f of h)this.evaluate(f,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const h of a){const f=h.node;this.uploaded?this.updatePbrBuffer(f):NS(f,r,!0)}for(const h of a)A0(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let a=!1;if(!r.meshes)return a;for(const h of r.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),a=!0);return a}needsReEvaluation(r,a,h){const f=r.transform.projectionOptions,_=r.style.getBrightness(),y=this.brightness!==_;if(!this.uploaded||this.dirty||f.name!==this.projection.name||Sv(h.paint.get("model-color").value,y)||Sv(h.paint.get("model-color-mix-intensity").value,y)||Sv(h.paint.get("model-roughness").value,y)||Sv(h.paint.get("model-emissive-strength").value,y)||Sv(h.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=f,this.brightness=_;const T=this.getNodesInfo();for(const C of T)C.state=null;return!0}return!1}evaluateTransform(r,a){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const h=this.getNodesInfo(),f=this.id.canonical;for(const _ of h){const y=_.feature;_.evaluatedTranslation=a.paint.get("model-translation").evaluate(y,{},f),_.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},f)}}evaluate(r,a){const h=this.getNodesInfo();for(const f of h){if(!f.node.meshes)continue;const _=f.feature,y=a&&a[_.id];if(Dl(y,f.state))continue;f.state=structuredClone(y);const T=f.node.meshes&&f.node.meshes[0].featureData,C=f.evaluatedColor[2],k=f.evaluatedRMEA[2],L=this.id.canonical;if(f.hasTranslucentParts=!1,T){for(let j=0;j<lR.length;j++){const N=lR[j];N.length&&(_.properties.part=N);const H=r.paint.get("model-color").evaluate(_,y,L).toPremultipliedRenderColor(null),W=r.paint.get("model-color-mix-intensity").evaluate(_,y,L);f.evaluatedColor[j]=[H.r,H.g,H.b,W],f.evaluatedRMEA[j][0]=r.paint.get("model-roughness").evaluate(_,y,L),f.evaluatedRMEA[j][2]=r.paint.get("model-emissive-strength").evaluate(_,y,L),f.evaluatedRMEA[j][3]=H.a,f.emissionHeightBasedParams[j]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,y,L),!f.hasTranslucentParts&&H.a<1&&(f.hasTranslucentParts=!0)}delete _.properties.part,F8(f,C!==f.evaluatedColor[2]||k!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(_,y,L);f.evaluatedTranslation=r.paint.get("model-translation").evaluate(_,y,L),f.evaluatedScale=r.paint.get("model-scale").evaluate(_,y,L),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,a,h,f){const _=r.findDEMTileFor(h);if(_&&(_.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const y=W_.create(r,h,_);if(!y)return;this.modelTraits&B_.HasMapboxMeshFeatures&&this.updateDEM(r,y,h,f);for(const T of this.getNodesInfo()){const C=T.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const k=C.footprint.vertices;let L=y.getElevationAt(k[0].x,k[0].y,!0,!0);for(let j=1;j<k.length;j++)L=Math.min(L,y.getElevationAt(k[j].x,k[j].y,!0,!0));C.elevation=L}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=a}}updateDEM(r,a,h,f){let _=a._dem._modifiedForSources[f];if(_===void 0&&(a._dem._modifiedForSources[f]=[],_=a._dem._modifiedForSources[f]),_.includes(h.canonical))return;const y=a._dem.dim;_.push(h.canonical);let T=!1;for(const C of this.getNodesInfo()){const k=C.node;if(!k.footprint||!k.footprint.grid)continue;const L=k.footprint.grid,j=a.tileCoordToPixel(L.min.x,L.min.y),N=a.tileCoordToPixel(L.max.x,L.max.y),H=Math.min(Math.min(y-N.y,j.x),Math.min(j.y,y-N.x));if(H<0)continue;const W=Oe(H,2,5);let ee=Math.max(0,j.x-W),ie=Math.max(0,j.y-W),se=Math.min(N.x+W,y-1),fe=Math.min(N.y+W,y-1);for(let Re=ie;Re<=fe;++Re)for(let Ne=ee;Ne<=se;++Ne)Sg[Re*y+Ne]=255;let pe=0,_e=0;for(let Re=0;Re<L.cellsY;++Re)for(let Ne=0;Ne<L.cellsX;++Ne){if(!L.cells[Re*L.cellsX+Ne])continue;const Fe=a.tileCoordToPixel(L.min.x+Ne/L.xScale,L.min.y+Re/L.yScale),Ue=a.tileCoordToPixel(L.min.x+(Ne+1)/L.xScale,L.min.y+(Re+1)/L.yScale);for(let ft=Fe.y;ft<=Math.min(Ue.y+1,y-1);++ft)for(let We=Fe.x;We<=Math.min(Ue.x+1,y-1);++We)Sg[ft*y+We]===255&&(Sg[ft*y+We]=0,pe+=a.getElevationAtPixel(We,ft),_e++)}const ke=pe/_e;ee=Math.max(1,j.x-W),ie=Math.max(1,j.y-W),se=Math.min(N.x+W,y-2),fe=Math.min(N.y+W,y-2),T=!0;for(let Re=ie;Re<=fe;++Re)for(let Ne=ee;Ne<=se;++Ne)Sg[Re*y+Ne]===0&&(h2[Re*y+Ne]=a._dem.set(Ne,Re,ke));for(let Re=1;Re<W;++Re){ee=Math.max(1,j.x-Re),ie=Math.max(1,j.y-Re),se=Math.min(N.x+Re,y-2),fe=Math.min(N.y+Re,y-2);for(let Ne=ie;Ne<=fe;++Ne)for(let Fe=ee;Fe<=se;++Fe){const Ue=Ne*y+Fe;if(Sg[Ue]===255){let ft=0,We=0,mt=-1,Ct=-1;for(let yt=-1;yt<=1;++yt)for(let xt=-1;xt<=1;++xt){const Rt=(Ne+yt)*y+Fe+xt;if(Sg[Rt]>=Re)continue;const ht=h2[Rt],bt=Math.abs(ht);bt>We&&(ft=ht,We=bt,mt=xt,Ct=yt)}if(We>.1){const yt=1-(Re+.5*Math.abs(mt*Ct))/W;let xt=a._dem.get(Fe,Ne)+ft*yt;const Rt=a._dem.get(Fe+mt,Ne+Ct),ht=a._dem.get(Fe-mt,Ne-Ct,!0);(xt-Rt)*(xt-ht)>0&&(xt=(Rt+ht)/2),h2[Ue]=a._dem.set(Fe,Ne,xt),Sg[Ue]=Re}}}}}T&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=_l.now())}setFilter(r){this.filter=r?xd(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((r=>this.filter.filter(new wr(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical))):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const a of r)A0(a.node),FS(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(r.toUnwrapped());for(const f of this.getNodesInfo()){const _=f.node.footprint;f.hiddenByReplacement=!!_&&!h.find((y=>y.footprint===_))}}getHeightAtTileCoord(r,a){const h=[],f=[0,0,0],_=q([]);for(const y of this.getNodesInfo()){const T=y.node.meshes[0],C=T.transformedAabb;if(r<C.min[0]||a<C.min[1]||r>C.max[0]||a>C.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};X(_,y.node.matrix),f[0]=r,f[1]=a,wn(f,f,_);const k=(f[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*xg|0,L=Math.min(63,(f[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*xg|0)*xg+Math.min(63,k),j=T.heightmap[L];if(!(j<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:j,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new It(r,a),new It(r,a),h),h.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Sv(l,r){return l instanceof ih&&!l.isLightConstant&&r}function N8(l,r,a,h,f,_,y,T){let C=(61440&r|(61440&r)>>4)>>8,k=(3840&r|(3840&r)>>4)>>4,L=240&r|(240&r)>>4;a[3]>0&&(C=An(C,255*a[0],a[3]),k=An(k,255*a[1],a[3]),L=An(L,255*a[2],a[3]));const j=C<<8|k,N=L<<8|Math.floor(255*h[3]),H=(function(Re){const Ne=Oe(Re,0,2);return Math.min(Math.round(.5*Ne*255),255)})(h[2])<<8|15*h[0]<<4|15*h[1],W=Oe(f[0],0,1),ee=Oe(f[1],0,1),ie=Oe(f[2],0,1),se=Oe(f[3],0,1);let fe,pe,_e,ke;if(W!==ee&&y!==_&&ee!==W){const Re=y-_;pe=1/(Re*(ee-W)),_e=-(_+Re*W)/(Re*(ee-W));const Ne=Oe(f[4],-1,1);ke=Math.pow(10,Ne),fe=255*ie<<8|255*se}else fe=65535,pe=0,_e=1,ke=1;if(l.emplaceBack(j,N,H,fe,pe,_e,ke),T){const Re=T.length;T.clear();for(let Ne=0;Ne<Re;Ne++)T.emplaceBack(j,N,H,fe,pe,_e,ke)}}function F8(l,r,a){const h=l.node;let f=0;const _=a&B_.HasMeshoptCompression;for(const y of h.meshes){if(h.lights&&h.lightMeshIndex===f||!y.featureData)continue;y.featureArray=new hh,y.featureArray.reserve(y.featureData.length);let T=r;for(const C of y.featureData){const k=_?65535&C:C>>16&65535,L=_?C>>16&65535:65535&C,j=(15&L)<8?15&L:0,N=l.evaluatedRMEA[j],H=l.evaluatedColor[j],W=l.emissionHeightBasedParams[j];let ee;if(T&&j===2&&h.lights&&(ee=new hh,ee.resize(10*h.lights.length)),N8(y.featureArray,k,H,N,W,y.aabb.min[2],y.aabb.max[2],ee),ee&&T){T=!1;const ie=h.meshes[h.lightMeshIndex];ie.featureArray=ee,ie.featureArray._trim()}}y.featureArray._trim(),f++}}function uR(l,r,a,h){const f=1<<l.z;r.lat=Ce((h/Ft+l.y)/f),r.lng=Ie((a/Ft+l.x)/f)}function B8(l,r,a,h){const f=l.getNodesInfo()[r];if(!f||f.hiddenByReplacement||!f.node.meshes)return;let _=Number.MAX_VALUE;const y=f.node,T=a.tile,C=h.calculatePosMatrix(T.tileID.toUnwrapped(),h.worldSize),k=f.evaluatedScale;let L=0;h.elevation&&y.elevation&&(L=y.elevation*h.elevation.exaggeration()),le(C,C,[(y.anchor?y.anchor[0]:0)*(k[0]-1),(y.anchor?y.anchor[1]:0)*(k[1]-1),L]),ue(C,C,k);const j=a.queryGeometry,N=j.isPointQuery()?j.screenBounds:j.screenGeometry,H=function(ee){const ie=re([],C,ee.matrix);re(ie,h.expandedFarZProjMatrix,ie);for(let se=0;se<ee.meshes.length;++se){const fe=ee.meshes[se];if(se===ee.lightMeshIndex)continue;const pe=IM(N,h,ie,fe.aabb);pe!=null&&(_=Math.min(pe,_))}if(ee.children)for(const se of ee.children)H(se)};if(H(y),_===Number.MAX_VALUE)return;const W=new Q(0,0);return uR(T.tileID.canonical,W,f.node.anchor[0],f.node.anchor[1]),{intersectionZ:_,position:W,feature:f.feature}}nn(W0,"Tiled3dModelBucket",{omit:["layers"]}),nn(cR,"Tiled3dModelFeature");const U8={circle:class extends Ws{constructor(l,r,a,h){super(l,{layout:yh||(yh=new di({"circle-sort-key":new $t(He.layout_circle["circle-sort-key"]),"circle-elevation-reference":new kt(He.layout_circle["circle-elevation-reference"]),visibility:new kt(He.layout_circle.visibility)})),paint:Pc||(Pc=new di({"circle-radius":new $t(He.paint_circle["circle-radius"]),"circle-color":new $t(He.paint_circle["circle-color"]),"circle-blur":new $t(He.paint_circle["circle-blur"]),"circle-opacity":new $t(He.paint_circle["circle-opacity"]),"circle-translate":new kt(He.paint_circle["circle-translate"]),"circle-translate-anchor":new kt(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kt(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kt(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(He.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new kt(He.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h)}createBucket(l){return new Gi(l)}queryRadius(l){const r=l;return Ma("circle-radius",this,r)+Ma("circle-stroke-width",this,r)+Cl(this.paint.get("circle-translate"))}queryIntersectsFeature(l,r,a,h,f,_,y,T){const C=ka(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return gI(l,h,_,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,k)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,r,a){const h=mI(this);return{config:new _h(this,{zoom:r,lut:a}),defines:h,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ws{createBucket(l){return new yI(l)}constructor(l,r,a,h){super(l,{layout:vI||(vI=new di({visibility:new kt(He.layout_heatmap.visibility)})),paint:xI||(xI=new di({"heatmap-radius":new $t(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kt(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new co(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kt(He.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Ma("heatmap-radius",this,l)}queryIntersectsFeature(l,r,a,h,f,_,y,T){const C=this.paint.get("heatmap-radius").evaluate(r,a);return gI(l,h,_,y,T,!0,!0,new It(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,r,a){return l==="heatmap"?{config:new _h(this,{zoom:r,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Ws{constructor(l,r,a,h){super(l,{layout:bI||(bI=new di({visibility:new kt(He.layout_hillshade.visibility)})),paint:wI||(wI=new di({"hillshade-illumination-direction":new kt(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kt(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kt(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kt(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kt(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kt(He.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new kt(He.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,r,a){return{overrideFog:!1}}},fill:class extends Ws{constructor(l,r,a,h){super(l,{layout:zI||(zI=new di({"fill-sort-key":new $t(He.layout_fill["fill-sort-key"]),visibility:new kt(He.layout_fill.visibility),"fill-elevation-reference":new kt(He.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new $t(He.layout_fill["fill-construct-bridge-guard-rail"])})),paint:NI||(NI=new di({"fill-antialias":new kt(He.paint_fill["fill-antialias"]),"fill-opacity":new $t(He.paint_fill["fill-opacity"]),"fill-color":new $t(He.paint_fill["fill-color"]),"fill-outline-color":new $t(He.paint_fill["fill-outline-color"]),"fill-translate":new kt(He.paint_fill["fill-translate"]),"fill-translate-anchor":new kt(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new $t(He.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new kt(He.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new kt(He.paint_fill["fill-emissive-strength"]),"fill-z-offset":new $t(He.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new $t(He.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new $t(He.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h)}getProgramIds(){const l=this.paint.get("fill-pattern"),r=l&&l.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(l,r,a){return{config:new _h(this,{zoom:r,lut:a}),overrideFog:!1}}recalculate(l,r){super.recalculate(l,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new xS(l)}queryRadius(){return Cl(this.paint.get("fill-translate"))}queryIntersectsFeature(l,r,a,h,f,_){return!l.queryGeometry.isAboveHorizon&&ho(Yl(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?r&&!l:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ws{constructor(l,r,a,h){super(l,{layout:aM||(aM=new di({visibility:new kt(He["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new kt(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:lM||(lM=new di({"fill-extrusion-opacity":new kt(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kt(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kt(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $t(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new kt(He["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new $t(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new kt(He["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new kt(He["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new kt(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new kt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new kt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new kt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new kt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new kt(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new kt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new kt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $t(He["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $t(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new kt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new kt(He["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new kt(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new kt(He["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new $t(He["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new $t(He["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new kt(He["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new y0(l)}queryRadius(){return Cl(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,r,a,h,f,_,y,T,C){const k=ka(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(r,a),j=this.paint.get("fill-extrusion-base").evaluate(r,a),N=[0,0],H=T&&_.elevation,W=_.elevation?_.elevation.exaggeration():1,ee=l.tile.getBucket(this);if(H&&ee instanceof y0){const _e=ee.centroidVertexArray,ke=C+1;ke<_e.length&&(N[0]=_e.geta_centroid_pos0(ke),N[1]=_e.geta_centroid_pos1(ke))}if(N[0]===0&&N[1]===1)return!1;_.projection.name==="globe"&&(h=oM([h],[new It(0,0),new It(Ft,Ft)],l.tileID.canonical).map((_e=>_e.polygon)).flat());const ie=H?T:null,[se,fe]=(function(_e,ke,Re,Ne,Fe,Ue,ft,We,mt,Ct,yt){return _e.projection.name==="globe"?(function(xt,Rt,ht,bt,st,nt,Ot,Mt,bn,rn,fn){const Ut=[],xn=[],Nn=xt.projection.upVectorScale(fn,xt.center.lat,xt.worldSize).metersToTile,Yt=[0,0,0,1],mn=[0,0,0,1],On=(ar,Jn,on,qn)=>{ar[0]=Jn,ar[1]=on,ar[2]=qn,ar[3]=1},Vn=sM();ht>0&&(ht+=Vn),bt+=Vn;for(const ar of Rt){const Jn=[],on=[];for(const qn of ar){const Er=qn.x+st.x,xe=qn.y+st.y,be=xt.projection.projectTilePoint(Er,xe,fn),it=xt.projection.upVector(fn,qn.x,qn.y);let dt=ht,Zt=bt;if(Ot){const qt=pM(Er,xe,ht,bt,Ot,Mt,bn,rn);dt+=qt.base,Zt+=qt.top}ht!==0?On(Yt,be.x+it[0]*Nn*dt,be.y+it[1]*Nn*dt,be.z+it[2]*Nn*dt):On(Yt,be.x,be.y,be.z),On(mn,be.x+it[0]*Nn*Zt,be.y+it[1]*Nn*Zt,be.z+it[2]*Nn*Zt),wn(Yt,Yt,nt),wn(mn,mn,nt),Jn.push(new yg(Yt[0],Yt[1],Yt[2])),on.push(new yg(mn[0],mn[1],mn[2]))}Ut.push(Jn),xn.push(on)}return[Ut,xn]})(_e,ke,Re,Ne,Fe,Ue,ft,We,mt,Ct,yt):ft?(function(xt,Rt,ht,bt,st,nt,Ot,Mt,bn){const rn=[],fn=[],Ut=[0,0,0,1];for(const xn of xt){const Nn=[],Yt=[];for(const mn of xn){const On=mn.x+bt.x,Vn=mn.y+bt.y,ar=pM(On,Vn,Rt,ht,nt,Ot,Mt,bn);Ut[0]=On,Ut[1]=Vn,Ut[2]=ar.base,Ut[3]=1,us(Ut,Ut,st),Ut[3]=Math.max(Ut[3],1e-5);const Jn=new yg(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Ut[0]=On,Ut[1]=Vn,Ut[2]=ar.top,Ut[3]=1,us(Ut,Ut,st),Ut[3]=Math.max(Ut[3],1e-5);const on=new yg(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Nn.push(Jn),Yt.push(on)}rn.push(Nn),fn.push(Yt)}return[rn,fn]})(ke,Re,Ne,Fe,Ue,ft,We,mt,Ct):(function(xt,Rt,ht,bt,st){const nt=[],Ot=[],Mt=st[8]*Rt,bn=st[9]*Rt,rn=st[10]*Rt,fn=st[11]*Rt,Ut=st[8]*ht,xn=st[9]*ht,Nn=st[10]*ht,Yt=st[11]*ht;for(const mn of xt){const On=[],Vn=[];for(const ar of mn){const Jn=ar.x+bt.x,on=ar.y+bt.y,qn=st[0]*Jn+st[4]*on+st[12],Er=st[1]*Jn+st[5]*on+st[13],xe=st[2]*Jn+st[6]*on+st[14],be=st[3]*Jn+st[7]*on+st[15],it=qn+Mt,dt=Er+bn,Zt=xe+rn,qt=Math.max(be+fn,1e-5),sn=qn+Ut,Tn=Er+xn,lr=xe+Nn,ur=Math.max(be+Yt,1e-5);On.push(new yg(it/qt,dt/qt,Zt/qt)),Vn.push(new yg(sn/ur,Tn/ur,lr/ur))}nt.push(On),Ot.push(Vn)}return[nt,Ot]})(ke,Re,Ne,Fe,Ue)})(_,h,j,L,k,y,ie,N,W,_.center.lat,l.tileID.canonical),pe=l.queryGeometry;return(function(_e,ke,Re){let Ne=1/0;ho(Re,ke)&&(Ne=fM(Re,ke[0]));for(let Fe=0;Fe<ke.length;Fe++){const Ue=ke[Fe],ft=_e[Fe];for(let We=0;We<Ue.length-1;We++){const mt=Ue[We],Ct=[mt,Ue[We+1],ft[We+1],ft[We],mt];To(Re,Ct)&&(Ne=Math.min(Ne,fM(Re,Ct)))}}return Ne!==1/0&&Ne})(se,fe,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},building:class extends Ws{constructor(l,r,a,h){super(l,{layout:FM||(FM=new di({visibility:new kt(He.layout_building.visibility),"building-facade":new $t(He.layout_building["building-facade"]),"building-facade-floors":new $t(He.layout_building["building-facade-floors"]),"building-facade-unit-width":new $t(He.layout_building["building-facade-unit-width"]),"building-facade-window":new $t(He.layout_building["building-facade-window"]),"building-roof-shape":new $t(He.layout_building["building-roof-shape"]),"building-height":new $t(He.layout_building["building-height"]),"building-base":new $t(He.layout_building["building-base"]),"building-flood-light-wall-radius":new $t(He.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new $t(He.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new $t(He.layout_building["building-flip-roof-orientation"])})),paint:BM||(BM=new di({"building-opacity":new kt(He.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new kt(He.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new kt(He.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new kt(He.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new kt(He.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new kt(He.paint_building["building-vertical-scale"]),"building-cast-shadows":new kt(He.paint_building["building-cast-shadows"]),"building-color":new $t(He.paint_building["building-color"]),"building-emissive-strength":new $t(He.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new kt(He.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new kt(He.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new kt(He.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new kt(He.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new kt(He.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new NM(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}},line:class extends Ws{constructor(l,r,a,h){const f=YM();super(l,f,r,a,h),f.layout&&(this.layout=new Ec(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ya,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,r){super.recalculate(l,r),this.paint._values["line-floorwidth"]=(()=>{if(hv)return hv;const a=YM();return hv=new F$(a.paint.properties["line-width"].specification),hv.useIntegerZoom=!0,hv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new $S(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,r,a){const h=ZM(this);return{config:new _h(this,{zoom:r,lut:a}),defines:h,overrideFog:!1}}queryRadius(l){const r=l,a=KM(Ma("line-width",this,r),Ma("line-gap-width",this,r)),h=Ma("line-offset",this,r);return a/2+Math.abs(h)+Cl(this.paint.get("line-translate"))}queryIntersectsFeature(l,r,a,h,f,_){if(l.queryGeometry.isAboveHorizon)return!1;const y=Yl(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),T=l.pixelToTileUnitsFactor/2*KM(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),C=this.paint.get("line-offset").evaluate(r,a);return C&&(h=(function(k,L){const j=[],N=new It(0,0);for(let H=0;H<k.length;H++){const W=k[H],ee=[];for(let ie=0;ie<W.length;ie++){const se=W[ie],fe=W[ie+1],pe=ie===0?N:se.sub(W[ie-1])._unit()._perp(),_e=ie===W.length-1?N:fe.sub(se)._unit()._perp(),ke=pe._add(_e)._unit();ke._mult(1/(ke.x*_e.x+ke.y*_e.y)),ee.push(ke._mult(L)._add(se))}j.push(ee)}return j})(h,C*l.pixelToTileUnitsFactor)),(function(k,L,j){for(let N=0;N<L.length;N++){const H=L[N];if(k.length>=3){for(let W=0;W<H.length;W++)if(Ji(k,H[W]))return!0}if(Eo(k,H,j))return!0}return!1})(y,h,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:V0,background:class extends Ws{constructor(l,r,a,h){super(l,{layout:Vk||(Vk=new di({visibility:new kt(He.layout_background.visibility)})),paint:$k||($k=new di({"background-pitch-alignment":new kt(He.paint_background["background-pitch-alignment"]),"background-color":new kt(He.paint_background["background-color"]),"background-pattern":new kt(He.paint_background["background-pattern"]),"background-opacity":new kt(He.paint_background["background-opacity"]),"background-emissive-strength":new kt(He.paint_background["background-emissive-strength"]),"background-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,r,a){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Zk,"raster-particle":eR,sky:class extends Ws{constructor(l,r,a,h){super(l,{layout:Kk||(Kk=new di({visibility:new kt(He.layout_sky.visibility)})),paint:Jk||(Jk=new di({"sky-type":new kt(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new kt(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new kt(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new kt(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new kt(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new co(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new kt(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new kt(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new kt(He.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(l,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),f=!h,_=l.style.light,y=_.properties.get("position");return f&&_.properties.get("anchor")==="viewport"&&_r("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?l2(y.azimuthal,90-y.polar,r):l2(h[0],90-h[1],r)}const a=this.paint.get("sky-gradient-center");return l2(a[0],90-a[1],r)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Ws{constructor(l,r,a,h){super(l,{paint:Qk||(Qk=new di({}))},r,null)}},model:class extends Ws{constructor(l,r,a,h){super(l,{layout:iR||(iR=new di({visibility:new kt(He.layout_model.visibility),"model-id":new $t(He.layout_model["model-id"])})),paint:sR||(sR=new di({"model-opacity":new $t(He.paint_model["model-opacity"]),"model-rotation":new $t(He.paint_model["model-rotation"]),"model-scale":new $t(He.paint_model["model-scale"]),"model-translation":new $t(He.paint_model["model-translation"]),"model-color":new $t(He.paint_model["model-color"]),"model-color-mix-intensity":new $t(He.paint_model["model-color-mix-intensity"]),"model-type":new kt(He.paint_model["model-type"]),"model-cast-shadows":new kt(He.paint_model["model-cast-shadows"]),"model-receive-shadows":new kt(He.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new kt(He.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $t(He.paint_model["model-emissive-strength"]),"model-roughness":new $t(He.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $t(He.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new kt(He.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new kt(He.paint_model["model-front-cutoff"]),"model-elevation-reference":new kt(He.paint_model["model-elevation-reference"]),"model-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},r,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new u2(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof W0?Ft-1:0}queryIntersectsFeature(l,r,a,h,f,_){if(!this.modelManager)return!1;const y=this.modelManager,T=l.tile.getBucket(this);if(!(T&&T instanceof u2))return!1;for(const C in T.instancesPerModel){const k=T.instancesPerModel[C],L=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(k.idToFeaturesIndex.hasOwnProperty(L)){const j=k.features[k.idToFeaturesIndex[L]],N=y.getModel(C,this.scope);if(!N)return!1;let H=Z();const W=new Q(0,0),ee=T.canonical;let ie=Number.MAX_VALUE;for(let se=0;se<j.instancedDataCount;++se){const fe=16*(j.instancedDataOffset+se),pe=k.instancedDataArray.float32,_e=[pe[fe+4],pe[fe+5],pe[fe+6]];uR(ee,W,pe[fe],0|pe[fe+1]),MM(H,N,_,W,j.rotation,j.scale,_e,!1,!1,!1),_.projection.name==="globe"&&(H=zS(H,_));const ke=re([],_.projMatrix,H),Re=l.queryGeometry,Ne=IM(Re.isPointQuery()?Re.screenBounds:Re.screenGeometry,_,ke,N.aabb);Ne!=null&&(ie=Math.min(Ne,ie))}return ie!==Number.MAX_VALUE&&ie}}return!1}_handleOverridablePaintPropertyUpdate(l,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const r=this._transitionablePaint._values[l];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof Hl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ws{constructor(l,r,a,h){super(l,{layout:FI||(FI=new di({"clip-layer-types":new kt(He.layout_clip["clip-layer-types"]),"clip-layer-scope":new kt(He.layout_clip["clip-layer-scope"])})),paint:BI||(BI=new di({}))},r,a,h)}recalculate(l,r){super.recalculate(l,r)}createBucket(l){return new UI(l)}is3D(l){return!0}}},d2=new Ir(0,0,0),f2={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},p2={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},q0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},V8={PAINT_ORDER_FILL_AND_STROKE:1},Tv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},hR={MASK_TYPE_LUMINANCE:1};function $8(l,r,a){l===1&&r.icons.push((function(h,f){return(function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:y}=_;if(y.content_area){const{content_area:T}=y;T.left==null&&(T.left=0),T.top==null&&(T.top=T.left),T.width==null&&(T.width=_.usvg_tree.width),T.height==null&&(T.height=T.width)}if(y.text_placeholder){const{text_placeholder:T}=y;T.top==null&&(T.top=T.left),T.height==null&&(T.height=T.width)}return y.stretch_x&&y.stretch_x.length&&dR(y,"x"),y.stretch_y&&y.stretch_y.length&&dR(y,"y"),_})(h.readFields(H8,{name:void 0},f))})(a,a.readVarint()+a.pos))}function dR(l,r){const a=[],h=l[`stretch_${r}`];let f=null;for(let _=0;_<h.length;_++)f===null?f=a.length===0?h[0]:a[a.length-1][1]+h[_]:(a.push([f,f+h[_]]),f=null);l[`stretch_${r}_areas`]=a}function H8(l,r,a){l===1?r.name=a.readString():l===2?r.metadata=(function(h,f){return h.readFields(G8,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)})(a,a.readVarint()+a.pos):l===3&&(r.usvg_tree=(function(h,f){return h.readFields(Z8,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)})(a,a.readVarint()+a.pos),r.data="usvg_tree")}function G8(l,r,a){l===1?r.stretch_x=a.readPackedVarint():l===2?r.stretch_y=a.readPackedVarint():l===3?r.content_area=fR(a,a.readVarint()+a.pos):l===4?r.variables.push((function(h,f){return h.readFields(q8,{name:void 0},f)})(a,a.readVarint()+a.pos)):l===5&&(r.text_placeholder=fR(a,a.readVarint()+a.pos))}function fR(l,r){return l.readFields(W8,{},r)}function W8(l,r,a){l===1?r.left=a.readVarint():l===2?r.width=a.readVarint():l===3?r.top=a.readVarint():l===4&&(r.height=a.readVarint())}function q8(l,r,a){l===1?r.name=a.readString():l===2&&(r.rgb_color=Y0(a.readVarint()),r.value="rgb_color")}function Z8(l,r,a){l===1?r.width=r.height=a.readVarint():l===2?r.height=a.readVarint():l===3?r.children.push(Z0(a,a.readVarint()+a.pos)):l===4?r.linear_gradients.push((function(h,f){return h.readFields(tH,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)})(a,a.readVarint()+a.pos)):l===5?r.radial_gradients.push((function(h,f){return h.readFields(rH,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)})(a,a.readVarint()+a.pos)):l===7?r.clip_paths.push((function(h,f){return h.readFields(iH,{children:[]},f)})(a,a.readVarint()+a.pos)):l===8&&r.masks.push((function(h,f){const _=h.readFields(sH,{left:0,width:20,mask_type:hR.MASK_TYPE_LUMINANCE,children:[]},f);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_})(a,a.readVarint()+a.pos))}function Z0(l,r){return l.readFields(X8,{},r)}function X8(l,r,a){l===1?(r.group=(function(h,f){return h.readFields(Y8,{opacity:255,children:[]},f)})(a,a.readVarint()+a.pos),r.node="group"):l===2&&(r.path=(function(h,f){return h.readFields(J8,{paint_order:1,commands:[],step:1,diffs:[],rule:f2.PATH_RULE_NON_ZERO},f)})(a,a.readVarint()+a.pos),r.node="path")}function Y8(l,r,a){l===1?r.transform=X0(a,a.readVarint()+a.pos):l===2?r.opacity=a.readVarint():l===5?r.clip_path_idx=a.readVarint():l===6?r.mask_idx=a.readVarint():l===7&&r.children.push(Z0(a,a.readVarint()+a.pos))}function X0(l,r){return l.readFields(K8,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function K8(l,r,a){l===1?r.sx=a.readFloat():l===2?r.ky=a.readFloat():l===3?r.kx=a.readFloat():l===4?r.sy=a.readFloat():l===5?r.tx=a.readFloat():l===6&&(r.ty=a.readFloat())}function J8(l,r,a){l===1?r.fill=(function(h,f){return h.readFields(Q8,{rgb_color:d2,paint:"rgb_color",opacity:255},f)})(a,a.readVarint()+a.pos):l===2?r.stroke=(function(h,f){return h.readFields(eH,{rgb_color:d2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)})(a,a.readVarint()+a.pos):l===3?r.paint_order=a.readVarint():l===5?a.readPackedVarint(r.commands):l===6?r.step=a.readFloat():l===7?a.readPackedSVarint(r.diffs):l===8&&(r.rule=a.readVarint())}function Q8(l,r,a){l===1?(r.rgb_color=Y0(a.readVarint()),r.paint="rgb_color"):l===2?(r.linear_gradient_idx=a.readVarint(),r.paint="linear_gradient_idx"):l===3?(r.radial_gradient_idx=a.readVarint(),r.paint="radial_gradient_idx"):l===5&&(r.opacity=a.readVarint())}function Y0(l){return new Ir((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function eH(l,r,a){l===1?(r.rgb_color=Y0(a.readVarint()),r.paint="rgb_color"):l===2?(r.linear_gradient_idx=a.readVarint(),r.paint="linear_gradient_idx"):l===3?(r.radial_gradient_idx=a.readVarint(),r.paint="radial_gradient_idx"):l===5?a.readPackedFloat(r.dasharray):l===6?r.dashoffset=a.readFloat():l===7?r.miterlimit=a.readFloat():l===8?r.opacity=a.readVarint():l===9?r.width=a.readFloat():l===10?r.linecap=a.readVarint():l===11&&(r.linejoin=a.readVarint())}function tH(l,r,a){l===1?r.transform=X0(a,a.readVarint()+a.pos):l===2?r.spread_method=a.readVarint():l===3?r.stops.push(pR(a,a.readVarint()+a.pos)):l===4?r.x1=a.readFloat():l===5?r.y1=a.readFloat():l===6?r.x2=a.readFloat():l===7&&(r.y2=a.readFloat())}function pR(l,r){return l.readFields(nH,{offset:0,opacity:255,rgb_color:d2},r)}function nH(l,r,a){l===1?r.offset=a.readFloat():l===2?r.opacity=a.readVarint():l===3&&(r.rgb_color=Y0(a.readVarint()))}function rH(l,r,a){l===1?r.transform=X0(a,a.readVarint()+a.pos):l===2?r.spread_method=a.readVarint():l===3?r.stops.push(pR(a,a.readVarint()+a.pos)):l===4?r.cx=a.readFloat():l===5?r.cy=a.readFloat():l===6?r.r=a.readFloat():l===7?r.fx=a.readFloat():l===8?r.fy=a.readFloat():l===9&&(r.fr=a.readFloat())}function iH(l,r,a){l===1?r.transform=X0(a,a.readVarint()+a.pos):l===2?r.clip_path_idx=a.readVarint():l===3&&r.children.push(Z0(a,a.readVarint()+a.pos))}function sH(l,r,a){l===1?r.left=r.top=a.readFloat():l===2?r.width=r.height=a.readFloat():l===3?r.top=a.readFloat():l===4?r.height=a.readFloat():l===5?r.mask_type=a.readVarint():l===6?r.mask_idx=a.readVarint():l===7&&r.children.push(Z0(a,a.readVarint()+a.pos))}class oH{static calculate(r={},a=[]){const h=new Map,f=new Map;if(Object.keys(r).length===0)return h;a.forEach((_=>{f.set(_.name,_.rgb_color||new Ir(0,0,0))}));for(const[_,y]of Object.entries(r))f.has(_)?h.set(f.get(_).toString(),y):console.warn(`Ignoring unknown image variable "${_}"`);return h}}function q_(l,r=255,a){const h=r/255,f=l.toString(),_=a.has(f)?a.get(f).clone():l.clone();return _.a*=h,_.toString()}function Ev(l,r){if(!Xd()){const a=document.createElement("canvas");return a.width=l,a.height=r,a}return new OffscreenCanvas(l,r)}function aH(l,r){const a=oH.calculate(r.params,l.metadata?l.metadata.variables:[]),h=l.usvg_tree,f=h.width,_=h.height,y=r.transform?r.transform:new DOMMatrix,T=Math.max(1,Math.round(f*y.a)),C=Math.max(1,Math.round(_*y.d)),k=new DOMMatrix([T/f,0,0,C/_,0,0]),L=Ev(T,C).getContext("2d");return m2(L,k,h,h,a),L.getImageData(0,0,T,C)}function m2(l,r,a,h,f){for(const _ of h.children)mR(l,r,a,_,f)}function mR(l,r,a,h,f){h.group?(l.save(),(function(_,y,T,C,k){const L=C.mask_idx!=null?T.masks[C.mask_idx]:null,j=C.clip_path_idx!=null?T.clip_paths[C.clip_path_idx]:null;if(C.transform&&(y=Z_(C.transform).preMultiplySelf(y)),!(function(W,ee,ie){return W.opacity!==255||ee||ie})(C,j!=null,L!=null))return void m2(_,y,T,C,k);const N=Ev(_.canvas.width,_.canvas.height),H=N.getContext("2d");m2(H,y,T,C,k),j&&wR(H,y,T,j),L&&SR(H,y,T,L,k),_.globalAlpha=C.opacity/255,_.drawImage(N,0,0)})(l,r,a,h.group,f),l.restore()):h.path&&(l.save(),(function(_,y,T,C,k){_.setTransform(y),C.paint_order===V8.PAINT_ORDER_FILL_AND_STROKE?(gR(_,T,C,k),yR(_,T,C,k)):(yR(_,T,C,k),gR(_,T,C,k))})(l,r,a,h.path,f),l.restore())}function gR(l,r,a,h){const f=a.fill;if(!f)return;const _=f.opacity/255;switch(l.save(),l.beginPath(),TR(a,l),f.paint){case"rgb_color":l.fillStyle=q_(f.rgb_color,f.opacity,h);break;case"linear_gradient_idx":{const y=r.linear_gradients[f.linear_gradient_idx];y.transform&&l.setTransform(Z_(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=vR(l,y,_,h);break}case"radial_gradient_idx":{const y=r.radial_gradients[f.radial_gradient_idx];y.transform&&l.setTransform(Z_(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=xR(l,y,_,h)}}l.fill(_R(a)),l.restore()}function _R(l){return l.rule===f2.PATH_RULE_NON_ZERO?"nonzero":l.rule===f2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function yR(l,r,a,h){const f=a.stroke;if(!f)return;const _=ER(a);l.lineWidth=f.width,l.miterLimit=f.miterlimit,l.setLineDash(f.dasharray),l.lineDashOffset=f.dashoffset;const y=f.opacity/255;switch(f.paint){case"rgb_color":l.strokeStyle=q_(f.rgb_color,f.opacity,h);break;case"linear_gradient_idx":l.strokeStyle=vR(l,r.linear_gradients[f.linear_gradient_idx],y,h,!0);break;case"radial_gradient_idx":l.strokeStyle=xR(l,r.radial_gradients[f.radial_gradient_idx],y,h,!0)}switch(f.linejoin){case q0.LINE_JOIN_MITER_CLIP:case q0.LINE_JOIN_MITER:l.lineJoin="miter";break;case q0.LINE_JOIN_ROUND:l.lineJoin="round";break;case q0.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(f.linecap){case p2.LINE_CAP_BUTT:l.lineCap="butt";break;case p2.LINE_CAP_ROUND:l.lineCap="round";break;case p2.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(_)}function vR(l,r,a,h,f=!1){if(r.stops.length===1){const N=r.stops[0];return q_(N.rgb_color,N.opacity*a,h)}const{x1:_,y1:y,x2:T,y2:C}=r;let k=new DOMPoint(_,y),L=new DOMPoint(T,C);if(f){const N=Z_(r.transform);k=N.transformPoint(k),L=N.transformPoint(L)}const j=l.createLinearGradient(k.x,k.y,L.x,L.y);for(const N of r.stops)j.addColorStop(N.offset,q_(N.rgb_color,N.opacity*a,h));return j}function xR(l,r,a,h,f=!1){if(r.stops.length===1){const se=r.stops[0];return q_(se.rgb_color,se.opacity*a,h)}const _=Z_(r.transform),{fx:y,fy:T,fr:C,cx:k,cy:L,r:j}=r;let N=new DOMPoint(y,T),H=new DOMPoint(k,L),W=C,ee=j;if(f){N=_.transformPoint(N),H=_.transformPoint(H);const se=(_.a+_.d)/2;W=C*se,ee=r.r*se}const ie=l.createRadialGradient(N.x,N.y,W,H.x,H.y,ee);for(const se of r.stops)ie.addColorStop(se.offset,q_(se.rgb_color,se.opacity*a,h));return ie}function bR(l,r,a,h){const f=h.transform?Z_(h.transform).preMultiplySelf(r):r,_=Ev(l.canvas.width,l.canvas.height),y=_.getContext("2d");for(const C of h.children)if(C.group)bR(y,f,a,C.group);else if(C.path){const k=C.path,L=new Path2D;L.addPath(ER(k),f),y.fill(L,_R(k))}const T=h.clip_path_idx!=null?a.clip_paths[h.clip_path_idx]:null;T&&wR(y,f,a,T),l.globalCompositeOperation="source-over",l.drawImage(_,0,0)}function wR(l,r,a,h){const f=Ev(l.canvas.width,l.canvas.height);bR(f.getContext("2d"),r,a,h),l.globalCompositeOperation="destination-in",l.drawImage(f,0,0)}function SR(l,r,a,h,f){if(h.children.length===0)return;const _=h.mask_idx!=null?a.masks[h.mask_idx]:null;_&&SR(l,r,a,_,f);const y=l.canvas.width,T=l.canvas.height,C=Ev(y,T),k=C.getContext("2d"),L=h.width,j=h.height,N=h.left,H=h.top,W=new Path2D,ee=new Path2D;ee.rect(N,H,L,j),W.addPath(ee,r),k.clip(W);for(const fe of h.children)mR(k,r,a,fe,f);const ie=k.getImageData(0,0,y,T),se=ie.data;if(h.mask_type===hR.MASK_TYPE_LUMINANCE)for(let fe=0;fe<se.length;fe+=4)se[fe+3]=se[fe+3]/255*(.2126*se[fe]+.7152*se[fe+1]+.0722*se[fe+2]);k.putImageData(ie,0,0),l.globalCompositeOperation="destination-in",l.drawImage(C,0,0)}function Z_(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function TR(l,r){const a=l.step;let h=l.diffs[0]*a,f=l.diffs[1]*a;r.moveTo(h,f);for(let _=0,y=2;_<l.commands.length;_++)switch(l.commands[_]){case Tv.PATH_COMMAND_MOVE:h+=l.diffs[y++]*a,f+=l.diffs[y++]*a,r.moveTo(h,f);break;case Tv.PATH_COMMAND_LINE:h+=l.diffs[y++]*a,f+=l.diffs[y++]*a,r.lineTo(h,f);break;case Tv.PATH_COMMAND_QUAD:{const T=h+l.diffs[y++]*a,C=f+l.diffs[y++]*a;h=T+l.diffs[y++]*a,f=C+l.diffs[y++]*a,r.quadraticCurveTo(T,C,h,f);break}case Tv.PATH_COMMAND_CUBIC:{const T=h+l.diffs[y++]*a,C=f+l.diffs[y++]*a,k=T+l.diffs[y++]*a,L=C+l.diffs[y++]*a;h=k+l.diffs[y++]*a,f=L+l.diffs[y++]*a,r.bezierCurveTo(T,C,k,L,h,f);break}case Tv.PATH_COMMAND_CLOSE:r.closePath()}return r}function ER(l){return TR(l,new Path2D)}class K0{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const a=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,a),a}put(r,a){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,a)}delete(r){this.cache.delete(r)}}nn(K0,"LRUCache");class g2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new Co(r,r.data)}getFromCache(r,a,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new K0(150)),this.cacheMap.get(h).get(oh(r.toString(),a))}setInCache(r,a,h,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new K0(150));const _=this.cacheDependenciesMap.get(f),y=oh(r.id.toString(),h);_.get(y)||_.set(y,new Set);const T=this.cacheMap.get(f),C=r.toString();_.get(y).add(C),T.put(oh(r.toString(),h),a)}removeImagesFromCacheByIds(r,a,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const f=this.cacheMap.get(h),_=this.cacheDependenciesMap.get(h);for(const y of r){const T=oh(y.toString(),a);if(_.has(T)){for(const C of _.get(T))f.delete(C);_.delete(T)}}}rasterize(r,a,h,f,_=aH){const y=this.getFromCache(r,h,f);if(y)return y.clone();const T=_(a.icon,r.options),C=g2._getImage(T);return this.setInCache(r,C,h,f),C.clone()}}class AR{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const h=this.toIdx(r,a);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function CR(l,r,a,h){let f=0,_=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(h[y])<1e-15){if(a[y]<l[y]||a[y]>r[y])return null}else{const T=1/h[y];let C=(l[y]-a[y])*T,k=(r[y]-a[y])*T;if(C>k){const L=C;C=k,k=L}if(C>f&&(f=C),k<_&&(_=k),f>_)return null}return f}function PR(l,r,a,h,f,_,y,T,C,k,L){const j=h-l,N=f-r,H=_-a,W=y-l,ee=T-r,ie=C-a,se=L[1]*ie-L[2]*ee,fe=L[2]*W-L[0]*ie,pe=L[0]*ee-L[1]*W,_e=j*se+N*fe+H*pe;if(Math.abs(_e)<1e-15)return null;const ke=1/_e,Re=k[0]-l,Ne=k[1]-r,Fe=k[2]-a,Ue=(Re*se+Ne*fe+Fe*pe)*ke;if(Ue<0||Ue>1)return null;const ft=Ne*H-Fe*N,We=Fe*j-Re*H,mt=Re*N-Ne*j,Ct=(L[0]*ft+L[1]*We+L[2]*mt)*ke;return Ct<0||Ue+Ct>1?null:(W*ft+ee*We+ie*mt)*ke}function IR(l,r,a){return(l-r)/(a-r)}function MR(l,r,a,h,f,_,y,T,C){const k=1<<a,L=_-h,j=y-f,N=(l+1)/k*L+h,H=(r+0)/k*j+f,W=(r+1)/k*j+f;T[0]=(l+0)/k*L+h,T[1]=H,C[0]=N,C[1]=W}class kR{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=(function(_){const y=Math.ceil(Math.log2(_.dim/8)),T=[];let C=Math.ceil(Math.pow(2,y));const k=1/C,L=(H,W,ee,ie,se)=>{const fe=ie?1:0,pe=(H+1)*ee-fe,_e=W*ee,ke=(W+1)*ee-fe;se[0]=H*ee,se[1]=_e,se[2]=pe,se[3]=ke};let j=new AR(C);const N=[];for(let H=0;H<C*C;H++){L(H%C,Math.floor(H/C),k,!1,N);const W=hm(N[0],N[1],_),ee=hm(N[2],N[1],_),ie=hm(N[2],N[3],_),se=hm(N[0],N[3],_);j.minimums.push(Math.min(W,ee,ie,se)),j.maximums.push(Math.max(W,ee,ie,se)),j.leaves.push(1)}for(T.push(j),C/=2;C>=1;C/=2){const H=T[T.length-1];j=new AR(C);for(let W=0;W<C*C;W++){L(W%C,Math.floor(W/C),2,!0,N);const ee=H.getElevation(N[0],N[1]),ie=H.getElevation(N[2],N[1]),se=H.getElevation(N[2],N[3]),fe=H.getElevation(N[0],N[3]),pe=H.isLeaf(N[0],N[1]),_e=H.isLeaf(N[2],N[1]),ke=H.isLeaf(N[2],N[3]),Re=H.isLeaf(N[0],N[3]),Ne=Math.min(ee.min,ie.min,se.min,fe.min),Fe=Math.max(ee.max,ie.max,se.max,fe.max),Ue=pe&&_e&&ke&&Re;j.maximums.push(Fe),j.minimums.push(Ne),j.leaves.push(Fe-Ne<=5&&Ue?1:0)}T.push(j)}return T})(this.dem),h=a.length-1,f=a[h];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(a,0,0,h,0)}raycastRoot(r,a,h,f,_,y,T=1){return CR([r,a,-100],[h,f,this.maximums[0]*T],_,y)}raycast(r,a,h,f,_,y,T=1){if(!this.nodeCount)return null;const C=this.raycastRoot(r,a,h,f,_,y,T);if(C==null)return null;const k=[],L=[],j=[],N=[],H=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:W,t:ee,nodex:ie,nodey:se,depth:fe}=H.pop();if(this.leaves[W]){MR(ie,se,fe,r,a,h,f,j,N);const _e=1<<fe,ke=(ie+0)/_e,Re=(ie+1)/_e,Ne=(se+0)/_e,Fe=(se+1)/_e,Ue=hm(ke,Ne,this.dem)*T,ft=hm(Re,Ne,this.dem)*T,We=hm(Re,Fe,this.dem)*T,mt=hm(ke,Fe,this.dem)*T,Ct=PR(j[0],j[1],Ue,N[0],j[1],ft,N[0],N[1],We,_,y),yt=PR(N[0],N[1],We,j[0],N[1],mt,j[0],j[1],Ue,_,y),xt=Math.min(Ct!==null?Ct:Number.MAX_VALUE,yt!==null?yt:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{const Rt=zt([],_,y,ee);if(RR(Ue,ft,mt,We,IR(Rt[0],j[0],N[0]),IR(Rt[1],j[1],N[1]))>=Rt[2])return ee}continue}let pe=0;for(let _e=0;_e<this._siblingOffset.length;_e++){MR((ie<<1)+this._siblingOffset[_e][0],(se<<1)+this._siblingOffset[_e][1],fe+1,r,a,h,f,j,N),j[2]=-100,N[2]=this.maximums[this.childOffsets[W]+_e]*T;const ke=CR(j,N,_,y);if(ke!=null){const Re=ke;k[_e]=Re;let Ne=!1;for(let Fe=0;Fe<pe&&!Ne;Fe++)Re>=k[L[Fe]]&&(L.splice(Fe,0,_e),Ne=!0);Ne||(L[pe]=_e),pe++}}for(let _e=0;_e<pe;_e++){const ke=L[_e];H.push({idx:this.childOffsets[W]+ke,t:k[ke],nodex:(ie<<1)+this._siblingOffset[ke][0],nodey:(se<<1)+this._siblingOffset[ke][1],depth:fe+1})}}return null}_addNode(r,a,h){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,h,f,_){if(r[f].isLeaf(a,h)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const y=f-1,T=r[y];let C=0,k=0;for(let L=0;L<this._siblingOffset.length;L++){const j=2*a+this._siblingOffset[L][0],N=2*h+this._siblingOffset[L][1],H=T.getElevation(j,N),W=T.isLeaf(j,N),ee=this._addNode(H.min,H.max,W);W&&(C|=1<<L),k||(k=ee)}for(let L=0;L<this._siblingOffset.length;L++)C&1<<L||this._construct(r,2*a+this._siblingOffset[L][0],2*h+this._siblingOffset[L][1],y,k+L)}}function RR(l,r,a,h,f,_){return An(An(l,a,_),An(r,h,_),f)}function hm(l,r,a){const h=a.dim,f=Oe(l*h-.5,0,h-1),_=Oe(r*h-.5,0,h-1),y=Math.floor(f),T=Math.floor(_),C=Math.min(y+1,h-1),k=Math.min(T+1,h-1);return RR(a.get(y,T),a.get(C,T),a.get(y,k),a.get(C,k),f-y,_-T)}const lH={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function cH(l,r,a){return(256*l*256+256*r+a)/10-1e4}function uH(l,r,a){return 256*l+r+a/256-32768}class J0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,h,f=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void _r(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let C=0;C<_;C++)y[this._idx(-1,C)]=y[this._idx(0,C)],y[this._idx(_,C)]=y[this._idx(_-1,C)],y[this._idx(C,-1)]=y[this._idx(C,0)],y[this._idx(C,_)]=y[this._idx(C,_-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(_,-1)]=y[this._idx(_-1,0)],y[this._idx(-1,_)]=y[this._idx(0,_-1)],y[this._idx(_,_)]=y[this._idx(_-1,_-1)]}const T=h==="terrarium"?uH:cH;for(let C=0;C<y.length;++C){const k=4*C;this.floatView[C]=T(this.pixels[k],this.pixels[k+1],this.pixels[k+2])}this._timestamp=_l.now()}_buildQuadTree(){this._tree=new kR(this)}get(r,a,h=!1){h&&(r=Oe(r,-1,this.dim),a=Oe(a,-1,this.dim));const f=this._idx(r,a);return this.floatView[f]}set(r,a,h){const f=this._idx(r,a),_=this.floatView[f];return this.floatView[f]=h,h-_}static getUnpackVector(r){return lH[r]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}static pack(r,a){const h=[0,0,0,0],f=J0.getUnpackVector(a);let _=Math.floor((r+f[3])/f[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new EI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,_=a*this.dim+this.dim,y=h*this.dim,T=h*this.dim+this.dim;switch(a){case-1:f=_-1;break;case 1:_=f+1}switch(h){case-1:y=T-1;break;case 1:T=y+1}const C=-a*this.dim,k=-h*this.dim;for(let L=y;L<T;L++)for(let j=f;j<_;j++){const N=4*this._idx(j,L),H=4*this._idx(j+C,L+k);this.pixels[N+0]=r.pixels[H+0],this.pixels[N+1]=r.pixels[H+1],this.pixels[N+2]=r.pixels[H+2],this.pixels[N+3]=r.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function hH(l,r,a){l===1?r.headerLength=a.readFixed32():l===2?r.x=a.readVarint():l===3?r.y=a.readVarint():l===4?r.z=a.readVarint():l===5&&r.layers.push((function(h,f){return h.readFields(gH,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)})(a,a.readVarint()+a.pos))}function dH(l,r,a){l===1?(r.delta_filter=(function(h,f){return h.readFields(fH,{blockSize:0},f)})(a,a.readVarint()+a.pos),r.filter="delta_filter"):l===2?(a.readVarint(),r.filter="zigzag_filter"):l===3?(a.readVarint(),r.filter="bitshuffle_filter"):l===4&&(a.readVarint(),r.filter="byteshuffle_filter")}function fH(l,r,a){l===1&&(r.blockSize=a.readVarint())}function pH(l,r,a){l===1?(a.readVarint(),r.codec="gzip_data"):l===2?(a.readVarint(),r.codec="jpeg_image"):l===3?(a.readVarint(),r.codec="webp_image"):l===4&&(a.readVarint(),r.codec="png_image")}function mH(l,r,a){let h=0,f=0;l===1?r.firstByte=a.readFixed64():l===2?r.lastByte=a.readFixed64():l===3?r.filters.push((function(_,y){return _.readFields(dH,{},y)})(a,a.readVarint()+a.pos)):l===4?r.codec=(function(_,y){return _.readFields(pH,{},y)})(a,a.readVarint()+a.pos):l===5?f=a.readFloat():l===6?h=a.readFloat():l===7?r.bands.push(a.readString()):l===8?r.offset=a.readDouble():l===9&&(r.scale=a.readDouble()),r.offset===0&&(r.offset=f),r.scale===0&&(r.scale=h)}function gH(l,r,a){l===1?r.version=a.readVarint():l===2?r.name=a.readString():l===3?r.units=a.readString():l===4?r.tileSize=a.readVarint():l===5?r.buffer=a.readVarint():l===6?r.pixelFormat=a.readVarint():l===7&&r.dataIndex.push((function(h,f){return h.readFields(mH,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)})(a,a.readVarint()+a.pos))}function _H(l,r,a){if(l===2)(function(h,f,_){h.readFields(yH,_,f)})(a,a.readVarint()+a.pos,r);else if(l===3)throw new Error("Not implemented")}function yH(l,r,a){if(l===1){let h=0;const f=a.readVarint()+a.pos;for(;a.pos<f;)r[h++]=a.readVarint()}}function vH(l,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let a=r[3];for(let h=2;h>=1;h--){const f=h===1?1:0,_=h===2?1:0;for(let y=0;y<r[0];y++){const T=r[1]*y;for(let C=f;C<r[1];C++){const k=r[2]*(C+T);for(let L=_;L<r[2];L++){const j=r[3]*(L+k);for(let N=0;N<r[3];N++){const H=j+N;l[H]+=l[H-a]}}}}a*=r[h]}return l}function xH(l){for(let r=0,a=l.length;r<a;r++)l[r]=l[r]>>>1^-(1&l[r]);return l}function bH(l,r){switch(r){case"uint32":return l;case"uint16":for(let a=0;a<l.length;a+=2){const h=l[a],f=l[a+1];l[a]=(240&h)>>4|(61440&h)>>8|(240&f)<<4|61440&f,l[a+1]=15&h|(3840&h)>>4|(15&f)<<8|(3840&f)<<4}return l;case"uint8":for(let a=0;a<l.length;a+=4){const h=l[a],f=l[a+1],_=l[a+2],y=l[a+3];l[a+0]=(192&h)>>6|(192&f)>>4|(192&_)>>2|192&y,l[a+1]=(48&h)>>4|(48&f)>>2|48&_|(48&y)<<2,l[a+2]=(12&h)>>2|12&f|(12&_)<<2|(12&y)<<4,l[a+3]=3&h|(3&f)<<2|(3&_)<<4|(3&y)<<6}return l;default:throw new Error(`Invalid pixel format, "${r}"`)}}nn(J0,"DEMData"),nn(kR,"DemMinMaxQuadTree",{omit:["dem"]});var Mc=Uint8Array,Av=Uint16Array,wH=Int32Array,OR=new Mc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),DR=new Mc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),SH=new Mc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),LR=function(l,r){for(var a=new Av(31),h=0;h<31;++h)a[h]=r+=1<<l[h-1];var f=new wH(a[30]);for(h=1;h<30;++h)for(var _=a[h];_<a[h+1];++_)f[_]=_-a[h]<<5|h;return{b:a,r:f}},jR=LR(OR,2),zR=jR.b,TH=jR.r;zR[28]=258,TH[258]=28;for(var EH=LR(DR,0).b,NR=new Av(32768),ws=0;ws<32768;++ws){var X_=(43690&ws)>>1|(21845&ws)<<1;NR[ws]=((65280&(X_=(61680&(X_=(52428&X_)>>2|(13107&X_)<<2))>>4|(3855&X_)<<4))>>8|(255&X_)<<8)>>1}var Cv=function(l,r,a){for(var h=l.length,f=0,_=new Av(r);f<h;++f)l[f]&&++_[l[f]-1];var y,T=new Av(r);for(f=1;f<r;++f)T[f]=T[f-1]+_[f-1]<<1;y=new Av(1<<r);var C=15-r;for(f=0;f<h;++f)if(l[f])for(var k=f<<4|l[f],L=r-l[f],j=T[l[f]-1]++<<L,N=j|(1<<L)-1;j<=N;++j)y[NR[j]>>C]=k;return y},Pv=new Mc(288);for(ws=0;ws<144;++ws)Pv[ws]=8;for(ws=144;ws<256;++ws)Pv[ws]=9;for(ws=256;ws<280;++ws)Pv[ws]=7;for(ws=280;ws<288;++ws)Pv[ws]=8;var FR=new Mc(32);for(ws=0;ws<32;++ws)FR[ws]=5;var AH=Cv(Pv,9),CH=Cv(FR,5),_2=function(l){for(var r=l[0],a=1;a<l.length;++a)l[a]>r&&(r=l[a]);return r},Sh=function(l,r,a){var h=r/8|0;return(l[h]|l[h+1]<<8)>>(7&r)&a},y2=function(l,r){var a=r/8|0;return(l[a]|l[a+1]<<8|l[a+2]<<16)>>(7&r)},PH=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Th=function(l,r,a){var h=new Error(r||PH[l]);if(h.code=l,Error.captureStackTrace&&Error.captureStackTrace(h,Th),!a)throw h;return h},IH=new Mc(0),MH=typeof TextDecoder<"u"&&new TextDecoder;try{MH.decode(IH,{stream:!0})}catch{}const kH={gzip_data:"gzip"};class _u extends Error{constructor(r){super(r),this.name="MRTError"}}const RH={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},BR={uint32:1,uint16:2,uint8:4},OH={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let v2;class Q0{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const a=this.layers[r];if(!a)throw new _u(`Layer '${r}' not found`);return a}getHeaderLength(r){const a=new Uint8Array(r),h=new DataView(r);if(a[0]!==13)throw new _u("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(r){const a=new Uint8Array(r),h=this.getHeaderLength(r);if(a.length<h)throw new _u(`Expected header with length >= ${h} but got buffer of length ${a.length}`);const f=new v2(a.subarray(0,h)).readFields(hH,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new _u(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const _ of f.layers)this.layers[_.name]=new UR(_,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const a=[],h=this.getLayer(r.layerName);for(let f of r.blockIndices){const _=h.dataIndex[f],y=_.firstByte-r.firstByte,T=_.lastByte-r.firstByte;if(h._blocksInProgress.has(f))continue;const C={layerName:h.name,firstByte:y,lastByte:T,pixelFormat:h.pixelFormat,blockIndex:f,blockShape:[_.bands.length].concat(h.bandShape),buffer:h.buffer,codec:_.codec.codec,filters:_.filters.map((k=>k.filter))};h._blocksInProgress.add(f),a.push(C)}return new VR(a,(()=>{a.forEach((f=>h._blocksInProgress.delete(f.blockIndex)))}),((f,_)=>{if(a.forEach((y=>h._blocksInProgress.delete(y.blockIndex))),f)throw f;_.forEach((y=>{this.getLayer(y.layerName).processDecodedData(y)}))}))}}class UR{constructor({version:r,name:a,units:h,tileSize:f,pixelFormat:_,buffer:y,dataIndex:T},C){if(this.version=r,this.version!==1)throw new _u(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=a,this.units=h,this.tileSize=f,this.buffer=y,this.pixelFormat=RH[_],this.dataIndex=T,this.bandShape=[f+2*y,f+2*y,BR[this.pixelFormat]],this._decodedBlocks=new K0(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return BR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:r})=>r)).flat()}processDecodedData(r){const a=r.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,r.data)}getBlockForBand(r){let a=0;switch(typeof r){case"string":for(const[h,f]of this.dataIndex.entries()){for(const[_,y]of f.bands.entries())if(y===r)return{bandIndex:a+_,blockIndex:h,blockBandIndex:_};a+=f.bands.length}break;case"number":for(const[h,f]of this.dataIndex.entries()){if(r>=a&&r<a+f.bands.length)return{bandIndex:r,blockIndex:h,blockBandIndex:r-a};a+=f.bands.length}break;default:throw new _u(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let a=1/0,h=-1/0;const f=[],_=new Set;for(const y of r){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new _u(`Invalid band: ${JSON.stringify(y)}`);const C=this.dataIndex[T];f.includes(T)||f.push(T),_.add(T),a=Math.min(a,C.firstByte),h=Math.max(h,C.lastByte)}if(_.size>this.cacheSize)throw new _u(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:h,blockIndices:f}}hasBand(r){const{blockIndex:a}=this.getBlockForBand(r);return a>=0}hasDataForBand(r){const{blockIndex:a}=this.getBlockForBand(r);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(r){const{blockIndex:a,blockBandIndex:h}=this.getBlockForBand(r);if(a<0)throw new _u(`Band not found: ${JSON.stringify(r)}`);const f=this._decodedBlocks.get(a.toString());if(!f)throw new _u(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[a],y=this.bandShape.reduce(((k,L)=>k*L),1),T=h*y,C=f.subarray(T,T+y);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}Q0.setPbf=function(l){v2=l};class VR{constructor(r,a,h){this.tasks=r,this._onCancel=a,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,a){this._finalized||(this._onComplete(r,a),this._finalized=!0)}}Q0.performDecoding=function(l,r){const a=new Uint8Array(l);return Promise.all(r.tasks.map((h=>{const{layerName:f,firstByte:_,lastByte:y,pixelFormat:T,blockShape:C,blockIndex:k,filters:L,codec:j}=h,N=a.subarray(_,y+1),H=new Uint32Array(C[0]*C[1]*C[2]);let W;if(j!=="gzip_data")throw new _u(`Unhandled codec: ${j}`);return W=(function(ee,ie){if(!globalThis.DecompressionStream&&ie==="gzip_data")return Promise.resolve(((_e=(function(Ne){Ne[0]==31&&Ne[1]==139&&Ne[2]==8||Th(6,"invalid gzip data");var Fe=Ne[3],Ue=10;4&Fe&&(Ue+=2+(Ne[10]|Ne[11]<<8));for(var ft=(Fe>>3&1)+(Fe>>4&1);ft>0;ft-=!Ne[Ue++]);return Ue+(2&Fe)})(pe=ee))+8>pe.length&&Th(6,"invalid gzip data"),(function(Ne,Fe,Ue,ft){var We=Ne.length;if(!We||Fe.f&&!Fe.l)return Ue||new Mc(0);var mt=!Ue,Ct=mt||Fe.i!=2,yt=Fe.i;mt&&(Ue=new Mc(3*We));var xt,Rt,ht=function(gi){var _i=Ue.length;if(gi>_i){var ri=new Mc(Math.max(2*_i,gi));ri.set(Ue),Ue=ri}},bt=Fe.f||0,st=Fe.p||0,nt=Fe.b||0,Ot=Fe.l,Mt=Fe.d,bn=Fe.m,rn=Fe.n,fn=8*We;do{if(!Ot){bt=Sh(Ne,st,1);var Ut=Sh(Ne,st+1,3);if(st+=3,!Ut){var xn=Ne[(xe=4+((st+7)/8|0))-4]|Ne[xe-3]<<8,Nn=xe+xn;if(Nn>We){yt&&Th(0);break}Ct&&ht(nt+xn),Ue.set(Ne.subarray(xe,Nn),nt),Fe.b=nt+=xn,Fe.p=st=8*Nn,Fe.f=bt;continue}if(Ut==1)Ot=AH,Mt=CH,bn=9,rn=5;else if(Ut==2){var Yt=Sh(Ne,st,31)+257,mn=Sh(Ne,st+10,15)+4,On=Yt+Sh(Ne,st+5,31)+1;st+=14;for(var Vn=new Mc(On),ar=new Mc(19),Jn=0;Jn<mn;++Jn)ar[SH[Jn]]=Sh(Ne,st+3*Jn,7);st+=3*mn;var on=_2(ar),qn=(1<<on)-1,Er=Cv(ar,on);for(Jn=0;Jn<On;){var xe,be=Er[Sh(Ne,st,qn)];if(st+=15&be,(xe=be>>4)<16)Vn[Jn++]=xe;else{var it=0,dt=0;for(xe==16?(dt=3+Sh(Ne,st,3),st+=2,it=Vn[Jn-1]):xe==17?(dt=3+Sh(Ne,st,7),st+=3):xe==18&&(dt=11+Sh(Ne,st,127),st+=7);dt--;)Vn[Jn++]=it}}var Zt=Vn.subarray(0,Yt),qt=Vn.subarray(Yt);bn=_2(Zt),rn=_2(qt),Ot=Cv(Zt,bn),Mt=Cv(qt,rn)}else Th(1);if(st>fn){yt&&Th(0);break}}Ct&&ht(nt+131072);for(var sn=(1<<bn)-1,Tn=(1<<rn)-1,lr=st;;lr=st){var ur=(it=Ot[y2(Ne,st)&sn])>>4;if((st+=15&it)>fn){yt&&Th(0);break}if(it||Th(2),ur<256)Ue[nt++]=ur;else{if(ur==256){lr=st,Ot=null;break}var sr=ur-254;ur>264&&(sr=Sh(Ne,st,(1<<(rr=OR[Jn=ur-257]))-1)+zR[Jn],st+=rr);var Vr=Mt[y2(Ne,st)&Tn],Ti=Vr>>4;if(Vr||Th(3),st+=15&Vr,qt=EH[Ti],Ti>3){var rr=DR[Ti];qt+=y2(Ne,st)&(1<<rr)-1,st+=rr}if(st>fn){yt&&Th(0);break}Ct&&ht(nt+131072);var li=nt+sr;if(nt<qt){var qr=0-qt,jr=Math.min(qt,li);for(qr+nt<0&&Th(3);nt<jr;++nt)Ue[nt]=(void 0)[qr+nt]}for(;nt<li;++nt)Ue[nt]=Ue[nt-qt]}}Fe.l=Ot,Fe.p=lr,Fe.b=nt,Fe.f=bt,Ot&&(bt=1,Fe.m=bn,Fe.d=Mt,Fe.n=rn)}while(!bt);return nt!=Ue.length&&mt?(xt=Ue,((Rt=nt)==null||Rt>xt.length)&&(Rt=xt.length),new Mc(xt.subarray(0,Rt))):Ue.subarray(0,nt)})(pe.subarray(_e,-8),{i:2},new Mc(((se=pe)[(fe=se.length)-4]|se[fe-3]<<8|se[fe-2]<<16|se[fe-1]<<24)>>>0))));var se,fe,pe,_e;const ke=kH[ie];if(!ke)throw new Error(`Unhandled codec: ${ie}`);const Re=new globalThis.DecompressionStream(ke);return new Response(new Blob([ee]).stream().pipeThrough(Re)).arrayBuffer().then((Ne=>new Uint8Array(Ne)))})(N,j).then((ee=>((function(ie,se){ie.readFields(_H,se)})(new v2(ee),H),new OH[T](H.buffer)))),W.then((ee=>{for(let ie=L.length-1;ie>=0;ie--)switch(L[ie]){case"delta_filter":vH(ee,C);break;case"zigzag_filter":xH(ee);break;case"bitshuffle_filter":bH(ee,T);break;default:throw new _u(`Unhandled filter "${L[ie]}"`)}return{layerName:f,blockIndex:k,data:ee}})).catch((ee=>{throw ee}))})))},nn(VR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),nn(Q0,"MapboxRasterTile"),nn(UR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class $R{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const h=r[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const DH=["id","tile","layer","source","sourceLayer","state"];class Y_{constructor(r,a,h,f,_){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=h,this._y=f,this.properties=r.properties,this.id=_}clone(){const r=new Y_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of DH)this[a]!==void 0&&(r[a]=this[a]);return r}}class HR{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Bo(Ft,16,0),this.featureIndexArray=new Wl,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,a,h,f,_,y=0,T=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,_,y);const k=this.grid;for(let L=0;L<a.length;L++){const j=a[L],N=[1/0,1/0,-1/0,-1/0];for(let H=0;H<j.length;H++){const W=j[H];N[0]=Math.min(N[0],W.x),N[1]=Math.min(N[1],W.y),N[2]=Math.max(N[2],W.x),N[3]=Math.max(N[3],W.y)}T!==0&&(N[0]-=T,N[1]-=T,N[2]+=T,N[3]+=T),N[0]<Ft&&N[1]<Ft&&N[2]>=0&&N[3]>=0&&k.insert(C,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new jn(new C0(this.rawTileData)).layers,this.sourceLayerCoder=new $R(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a){const{tilespaceGeometry:h,transform:f,tileTransform:_,pixelPosMatrix:y,availableImages:T,worldview:C}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const k=h.bufferedTilespaceBounds,L=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,((W,ee,ie,se)=>Ui(h.bufferedTilespaceGeometry,W,ee,ie,se)));L.sort(LH);let j=null;f.elevation&&L.length>0&&(j=W_.create(f.elevation,this.tileID));const N={};let H;for(let W=0;W<L.length;W++){const ee=L[W];if(ee===H)continue;H=ee;const ie=this.featureIndexArray.get(ee);let se=null;this.is3DTile?this.loadMatchingModelFeature(N,ie,r,h,f,C):this.loadMatchingFeature(N,ie,r,T,C,((fe,pe,_e,ke=0)=>(se||(se=Gt(fe,this.tileID.canonical,_)),pe.queryIntersectsFeature(h,fe,_e,se,this.z,f,y,j,ke))))}return N}loadMatchingFeature(r,a,h,f,_,y){const{featureIndex:T,bucketIndex:C,sourceLayerIndex:k,layoutVertexArrayOffset:L}=a,j=this.bucketLayerIDs[C],N=h.layers,H=Object.keys(N);if(H.length&&!xr(H,j))return;const W=h.sourceCache,ee=this.sourceLayerCoder.decode(k),ie=this.vtLayers[ee].feature(T),se=this.getId(ie,ee);for(let fe=0;fe<j.length;fe++){const pe=j[fe];if(!N[pe])continue;const{styleLayer:_e,targets:ke}=N[pe];let Re={};se!==void 0&&(Re=W.getFeatureState(_e.sourceLayer,se));const Ne=!y||y(ie,_e,Re,L);if(!Ne)continue;const Fe=new Y_(ie,this.z,this.x,this.y,se);Fe.tile=this.tileID.canonical,Fe.state=Re;let Ue=this.serializedLayersCache.get(pe);Ue||(Ue=_e.serialize(),Ue.id=pe,this.serializedLayersCache.set(pe,Ue)),Fe.source=Ue.source,Fe.sourceLayer=Ue["source-layer"],Fe.layer=Object.assign({},Ue),Fe.layer.paint=GR(Ue.paint,_e.paint,ie,Re,f),Fe.layer.layout=GR(Ue.layout,_e.layout,ie,Re,f);let ft=!1;for(const We of ke){this.updateFeatureProperties(Fe,We);const{filter:mt}=We;if(mt){if(ie.properties=Fe.properties,mt.needGeometry){const Ct=Pt(ie,!0);if(!mt.filter(new wr(this.tileID.overscaledZ,{worldview:_}),Ct,this.tileID.canonical))continue}else if(!mt.filter(new wr(this.tileID.overscaledZ,{worldview:_}),ie))continue}ft=!0,We.targetId&&this.addFeatureVariant(Fe,We)}ft&&this.appendToResult(r,pe,T,Fe,Ne)}}loadMatchingModelFeature(r,a,h,f,_,y){const{featureIndex:T,bucketIndex:C}=a,k=this.bucketLayerIDs[C],L=h.layers,j=Object.keys(L);if(!j.length||xr(j,k))for(let N=0;N<k.length;N++){const H=k[N],{styleLayer:W,targets:ee}=L[H];if(W.type!=="model")continue;const ie=f.tile,se=ie.getBucket(W);if(!(se&&se instanceof W0))continue;const fe=B8(se,T,f,_);if(!fe)continue;const{z:pe,x:_e,y:ke}=ie.tileID.canonical,{feature:Re,intersectionZ:Ne,position:Fe}=fe;let Ue={};Re.id!==void 0&&(Ue=h.sourceCache.getFeatureState(W.sourceLayer,Re.id));const ft=new Y_({},pe,_e,ke,Re.id);ft.tile=this.tileID.canonical,ft.state=Ue,ft.properties=Re.properties,ft.geometry={type:"Point",coordinates:[Fe.lng,Fe.lat]};let We=this.serializedLayersCache.get(H);We||(We=W.serialize(),We.id=H,this.serializedLayersCache.set(H,We)),ft.source=We.source,ft.sourceLayer=We["source-layer"],ft.layer=Object.assign({},We);let mt=!1;for(const Ct of ee){this.updateFeatureProperties(ft,Ct);const{filter:yt}=Ct;if(yt){if(Re.properties=ft.properties,yt.needGeometry){if(!yt.filter(new wr(this.tileID.overscaledZ,{worldview:y}),Re,this.tileID.canonical))continue}else if(!yt.filter(new wr(this.tileID.overscaledZ,{worldview:y}),Re))continue}mt=!0,Ct.targetId&&this.addFeatureVariant(ft,Ct)}mt&&this.appendToResult(r,H,T,ft,Ne)}}updateFeatureProperties(r,a,h){if(a.properties){const f={};for(const _ in a.properties){const y=a.properties[_].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,h);y!=null&&(f[_]=y)}r.properties=f}}addFeatureVariant(r,a,h){const f={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(f.properties=r.properties),r.variants=r.variants||{},r.variants[a.targetId]=r.variants[a.targetId]||[],r.variants[a.targetId].push(f)}appendToResult(r,a,h,f,_){let y=r[a];y===void 0&&(y=r[a]=[]),y.push({featureIndex:h,feature:f,intersectionZ:_})}lookupSymbolFeatures(r,a,h,f,_,y){const T={};this.loadVTLayers();for(const C of r)this.loadMatchingFeature(T,{bucketIndex:a,sourceLayerIndex:h,featureIndex:C,layoutVertexArrayOffset:0},f,_,y);return T}loadFeature(r){const{featureIndex:a,sourceLayerIndex:h}=r;this.loadVTLayers();const f=this.sourceLayerCoder.decode(h),_=this.vtFeatures[f];if(_[a])return _[a];const y=this.vtLayers[f].feature(a);return _[a]=y,y}hasLayer(r){for(const a of this.bucketLayerIDs)for(const h of a)if(r===h)return!0;return!1}getId(r,a){let h=r.id;if(this.promoteId){const f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){const _=el(f);if(_.result!=="success"){const y=_.value.map((T=>`${T.key}: ${T.message}`)).join(", ");return void _r(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=_.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ga),h=this.promoteIdExpression.evaluate({zoom:0},r)}else h=r.properties[f];typeof h=="boolean"&&(h=Number(h))}return h}}function GR(l,r,a,h,f){return Fn(l,((_,y)=>{const T=r instanceof Ec?r.get(y):null;return T&&T.evaluate?T.evaluate(a,h,void 0,f):T}))}function LH(l,r){return r-l}nn(HR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const WR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class x2{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(r,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const _=WR[15&h];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[T]=new Uint32Array(r,4,1);return new x2(T,y,_,r)}constructor(r,a=64,h=Float64Array,f){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const _=WR.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,T=r*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+C,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+C),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+C,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=a,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return b2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:T}=this,C=[0,_.length-1,0],k=[];for(;C.length;){const L=C.pop()||0,j=C.pop()||0,N=C.pop()||0;if(j-N<=T){for(let ie=N;ie<=j;ie++){const se=y[2*ie],fe=y[2*ie+1];se>=r&&se<=h&&fe>=a&&fe<=f&&k.push(_[ie])}continue}const H=N+j>>1,W=y[2*H],ee=y[2*H+1];W>=r&&W<=h&&ee>=a&&ee<=f&&k.push(_[H]),(L===0?r<=W:a<=ee)&&(C.push(N),C.push(H-1),C.push(1-L)),(L===0?h>=W:f>=ee)&&(C.push(H+1),C.push(j),C.push(1-L))}return k}within(r,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:y}=this,T=[0,f.length-1,0],C=[],k=h*h;for(;T.length;){const L=T.pop()||0,j=T.pop()||0,N=T.pop()||0;if(j-N<=y){for(let ie=N;ie<=j;ie++)ZR(_[2*ie],_[2*ie+1],r,a)<=k&&C.push(f[ie]);continue}const H=N+j>>1,W=_[2*H],ee=_[2*H+1];ZR(W,ee,r,a)<=k&&C.push(f[H]),(L===0?r-h<=W:a-h<=ee)&&(T.push(N),T.push(H-1),T.push(1-L)),(L===0?r+h>=W:a+h>=ee)&&(T.push(H+1),T.push(j),T.push(1-L))}return C}}function b2(l,r,a,h,f,_){if(f-h<=a)return;const y=h+f>>1;qR(l,r,y,h,f,_),b2(l,r,a,h,y-1,1-_),b2(l,r,a,y+1,f,1-_)}function qR(l,r,a,h,f,_){for(;f>h;){if(f-h>600){const k=f-h+1,L=a-h+1,j=Math.log(k),N=.5*Math.exp(2*j/3),H=.5*Math.sqrt(j*N*(k-N)/k)*(L-k/2<0?-1:1);qR(l,r,a,Math.max(h,Math.floor(a-L*N/k+H)),Math.min(f,Math.floor(a+(k-L)*N/k+H)),_)}const y=r[2*a+_];let T=h,C=f;for(Iv(l,r,h,a),r[2*f+_]>y&&Iv(l,r,h,f);T<C;){for(Iv(l,r,T,C),T++,C--;r[2*T+_]<y;)T++;for(;r[2*C+_]>y;)C--}r[2*h+_]===y?Iv(l,r,h,C):(C++,Iv(l,r,C,f)),C<=a&&(h=C+1),a<=C&&(f=C-1)}}function Iv(l,r,a,h){w2(l,a,h),w2(r,2*a,2*h),w2(r,2*a+1,2*h+1)}function w2(l,r,a){const h=l[r];l[r]=l[a],l[a]=h}function ZR(l,r,a,h){const f=l-a,_=r-h;return f*f+_*_}i.$=$m,i.A=vl,i.B=oh,i.C=2,i.D=j_,i.E=Gc,i.F=mv,i.G=vk,i.H=Cp,i.I=vo,i.J=vd,i.K=Dn,i.L=ff,i.M=hd,i.N=Qu,i.O=nu,i.P=It,i.Q=ru,i.R=yl,i.S=au,i.T=LS,i.U=el,i.V=G0,i.W=Mf,i.X=Hu,i.Y=Kc,i.Z=ad,i._=Cs,i.a=function(l){return ro.API_CDN_URL_REGEX.test(l)},i.a$=Ce,i.a0=Fl,i.a1=Lo,i.a2=Df,i.a3=class extends G0{},i.a4=Hp,i.a5=$p,i.a6=He,i.a7=function(l){const r=l.value;return r?Fl(r)?c2(r,!0)?[]:[new G0(l.key,r,`invalid url "${r}"`)]:[new G0(l.key,r,`string expected, "${Dn(r)}" found`)]:[]},i.a8=yd,i.a9=di,i.aA=Oe,i.aB=re,i.aC=us,i.aD=p,i.aE=Ji,i.aF=ve,i.aG=Ye,i.aH=function(l,r){const a={};for(let h=0;h<r.length;h++){const f=r[h];f in l&&(a[f]=l[f])}return a},i.aI=ce,i.aJ=Pe,i.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,r,a,h){const f=this.entries[l]=this.entries[l]||{callbacks:[]};if(f.result){const[_,y]=f.result;return this.scheduler?this.scheduler.add((()=>{h(_,y)}),r):h(_,y),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=a(((_,y)=>{f.result=[_,y];for(const T of f.callbacks)this.scheduler?this.scheduler.add((()=>{T(_,y)}),r):T(_,y);setTimeout((()=>delete this.entries[l]),3e3)}))),()=>{f.result||(f.callbacks=f.callbacks.filter((_=>_!==h)),f.callbacks.length||(f.cancel(),delete this.entries[l]))}}},i.aL=function(l,r,a){const h=JSON.stringify(l.request);return l.data&&(this.deduped.entries[h]={result:[null,l.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},(f=>{const _=Zh(l.request,((y,T,C,k)=>{y?f(y):T&&f(null,{vectorTile:a?void 0:new jn(new C0(T)),rawData:T,cacheControl:C,expires:k})}));return()=>{_.cancel(),f()}}),r)},i.aM=function(l){dc++,dc>ni&&(l.getActor().send("enforceCacheSizeLimit",pa),dc=0)},i.aN=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},i.aO=Ao,i.aP=Zk,i.aQ=eR,i.aR=Q,i.aS=qk,i.aT=function(l,r){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let h=0;h<l.length;h++){const f=document.createElement("source");Vm(l[h])||(a.crossOrigin="Anonymous"),f.src=l[h],a.appendChild(f)}return{cancel:()=>{}}},i.aU=cv,i.aV=function(l){return fetch(l).then((r=>r.arrayBuffer())).then((r=>TM(r,0,l)))},i.aW=RM,i.aX=class{constructor(l,r,a,h){this.id=l,this.position=r!=null?new Q(r[0],r[1]):new Q(0,0),this.orientation=a??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new Mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,r){if(re(l.matrix,r,l.matrix),l.meshes)for(const a of l.meshes){const h=Mn.applyTransformFast(a.aabb,l.matrix);this.aabb.encapsulate(h)}if(l.children)for(const a of l.children)this._applyTransformations(a,l.matrix)}computeBoundsAndApplyParent(){const l=q([]);for(const r of this.nodes)this._applyTransformations(r,l)}computeModelMatrix(l,r,a,h,f,_,y=!1){MM(this.matrix,this,l.transform,this.position,r,a,h,f,_,y)}upload(l){if(!this.uploaded){for(const r of this.nodes)NS(r,l);for(const r of this.nodes)A0(r);this.uploaded=!0}}destroy(){for(const l of this.nodes)FS(l)}},i.aY=Rn,i.aZ=yv,i.a_=Ie,i.aa=kt,i.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,r){return ts(l.expression.evaluate(r))}interpolate(l,r,a){return{x:An(l.x,r.x,a),y:An(l.y,r.y,a),z:An(l.z,r.z,a),azimuthal:An(l.azimuthal,r.azimuthal,a),polar:An(l.polar,r.polar,a)}}},i.ac=wr,i.ad=Hl,i.ae=Qe,i.af=wn,i.ag=en,i.ah=rt,i.ai=Ec,i.aj=Tr,i.ak=An,i.al=Ft,i.am=sf,i.an=$e,i.ao=Ir,i.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,r){return(function([a,h]){const f=ts([1,a,h]);return{x:f.x,y:f.y,z:f.z}})(l.expression.evaluate(r))}interpolate(l,r,a){return{x:An(l.x,r.x,a),y:An(l.y,r.y,a),z:An(l.z,r.z,a)}}},i.aq=function(l,r,a=0,h=!0){const f=new It(a,a),_=l.sub(f),y=r.add(f),T=[_,new It(y.x,_.y),y,new It(_.x,y.y)];return h&&T.push(_.clone()),T},i.ar=function(l,r){const a=[];for(let h=0;h<l.length;h++){const f=Ve(h-1,-1,l.length-1),_=Ve(h+1,-1,l.length-1),y=l[h],T=l[_],C=l[f].sub(y).unit(),k=T.sub(y).unit(),L=k.angleWithSep(C.x,C.y),j=C.add(k).unit().mult(-1*r/Math.sin(L/2));a.push(y.add(j))}return a},i.as=Ok,i.at=Ui,i.au=function(l,r,a=0){return Jt(((r.x-a)*l.scale-l.x)*Ft,(r.y*l.scale-l.y)*Ft,Te(r.z,r.y))},i.av=nr,i.aw=kn,i.ax=Mr,i.ay=HM,i.az=function(l){let r=1/0,a=1/0,h=-1/0,f=-1/0;for(const _ of l)r=Math.min(r,_.x),a=Math.min(a,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return{min:new It(r,a),max:new It(h,f)}},i.b=function(l){return ro.API_FONTS_REGEX.test(l)},i.b$=SS,i.b0=Gl,i.b1=ss,i.b2=_t,i.b3=em,i.b4=U0,i.b5=function(){Ai.isLoading()||Ai.isLoaded()||gd()!=="deferred"||Ta()},i.b6=xd,i.b7=Pt,i.b8=Y_,i.b9=Or,i.bA=q,i.bB=we,i.bC=Z,i.bD=function(l,r){const{x:a,y:h}=l.point,f=Pr(a,h,l.worldSize/l._pixelsPerMercatorPixel,0,0);return re(f,f,Pn(pn(r)))},i.bE=I,i.bF=Ii,i.bG=function(l,r){var a=r[0]-l[0],h=r[1]-l[1],f=r[2]-l[2];return Math.sqrt(a*a+h*h+f*f)},i.bH=zt,i.bI=En,i.bJ=Bt,i.bK=pv,i.bL=Il,i.bM=YS,i.bN=function(l,r,a,h,f){const _=5*r+2;l.float32[_+0]=a,l.float32[_+1]=h,l.float32[_+2]=f},i.bO=B0,i.bP=pl,i.bQ=ml,i.bR=ac,i.bS=_o,i.bT=Ve,i.bU=function(l,r,a,h){var f=new P(4);return f[0]=l,f[1]=r,f[2]=a,f[3]=h,f},i.bV=v0,i.bW=To,i.bX=Ks,i.bY=$I,i.bZ=tR,i.b_=qI,i.ba=$S,i.bb=xS,i.bc=Gt,i.bd=Ac,i.be=Vf,i.bf=K,i.bg=Rr,i.bh=D_,i.bi=a2,i.bj=function(l,r){const a=Tr(r.zoom);if(a===0)return pn(l);const h=ir(l),f=cr(h),_=ve(h.getWest())*r.worldSize,y=ve(h.getEast())*r.worldSize,T=Pe(h.getNorth())*r.worldSize,C=Pe(h.getSouth())*r.worldSize,k=[_,T,0],L=[y,T,0],j=[_,C,0],N=[y,C,0],H=X([],r.globeMatrix);return wn(k,k,H),wn(L,L,H),wn(j,j,H),wn(N,N,H),f[0]=yn(f[0],j,a),f[1]=yn(f[1],N,a),f[2]=yn(f[2],L,a),f[3]=yn(f[3],k,a),Mn.fromPoints(f)},i.bk=Lt,i.bl=X,i.bm=as,i.bn=yn,i.bo=cu,i.bp=U,i.bq=Le,i.br=le,i.bs=Q0,i.bt=C0,i.bu=Zh,i.bv=function(l,r){const a=[];for(const h in l)h in r||a.push(h);return a},i.bw=ot,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=Dl,i.bz=function(l){var r=new P(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r},i.c=d_,i.c$=function(l){return l*l*l*l*l},i.c0=XS,i.c1=Ak,i.c2=e2,i.c3=x2,i.c4=et,i.c5=Sn,i.c6=ja,i.c7=function(l,r,a){a*=.5;var h=r[0],f=r[1],_=r[2],y=r[3],T=Math.sin(a),C=Math.cos(a);return l[0]=h*C+f*T,l[1]=f*C-h*T,l[2]=_*C+y*T,l[3]=y*C-_*T,l},i.c8=za,i.c9=Oi,i.cA=Yn,i.cB=AM,i.cC=Ic,i.cD=Kn,i.cE=function(l,r,a,h,f,_,y,T,C){if(C.name==="globe")return Kn(l,r,new Ic(a,h,f),!1);const k=yv({z:a,x:h,y:f},C);return new Mn([(_+k.x/k.scale)*r,r*(k.y/k.scale),y],[(_+k.x2/k.scale)*r,r*(k.y2/k.scale),T])},i.cF=function(l,r,a){return l[0]=Math.min(r[0],a[0]),l[1]=Math.min(r[1],a[1]),l[2]=Math.min(r[2],a[2]),l[3]=Math.min(r[3],a[3]),l},i.cG=function(l,r,a){return l[0]=Math.max(r[0],a[0]),l[1]=Math.max(r[1],a[1]),l[2]=Math.max(r[2],a[2]),l[3]=Math.max(r[3],a[3]),l},i.cH=function(l){const r=Math.round((l+45+360)%360/90)%4;return de[r]},i.cI=Me,i.cJ=Fi,i.cK=w,i.cL=function(l){const r=q(new Float64Array(16));re(r,l.pixelMatrix,l.globeMatrix);const a=[0,z,0],h=[0,B,0];return wn(a,a,r),wn(h,h,r),[a[0]>0&&a[0]<=l.width&&a[1]>0&&a[1]<=l.height&&!Ci(l,new Q(l.center.lat,90)),h[0]>0&&h[0]<=l.width&&h[1]>0&&h[1]<=l.height&&!Ci(l,new Q(l.center.lat,-90))]},i.cM=function(l,r){const{scale:a}=l.tileTransform,h=a*Ft/(l.tileSize*Math.pow(2,r.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return(function(f,_,y){var T=_[1],C=_[2],k=_[3],L=y[0],j=y[1];return f[0]=_[0]*L,f[1]=T*L,f[2]=C*j,f[3]=k*j,f})(new Float32Array(4),r.inverseAdjustmentMatrix,[h,h])},i.cN=T0,i.cO=gt,i.cP=EM,i.cQ=function(l){const r=EM(l,!0);return I([],[r[0],r[1],r[4],r[5]])},i.cR=ue,i.cS=tr,i.cT=ye,i.cU=function(l){const{x:r,y:a}=l.point,{lng:h,lat:f}=l._center;return Pr(r,a,l.worldSize,h,f)},i.cV=Kt,i.cW=oe,i.cX=vh,i.cY=Ps,i.cZ=x,i.c_=function(l,r,a){let h=0;for(let f=0;f<2;++f)l[f]>0&&(h+=(l[f]-0)*(l[f]-0)),r[f]<0&&(h+=(0-r[f])*(0-r[f]));return h},i.ca=function(l,r){return l[0]=-r[0],l[1]=-r[1],l[2]=-r[2],l[3]=r[3],l},i.cb=Ge,i.cc=function(l,r,a,h,f){var _=1/Math.tan(r/2);if(l[0]=_/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,f!=null&&f!==1/0){var y=1/(h-f);l[10]=(f+h)*y,l[14]=2*f*h*y}else l[10]=-1,l[14]=-2*h;return l},i.cd=function(l,r,a,h,f,_,y){var T=1/(r-a),C=1/(h-f),k=1/(_-y);return l[0]=-2*T,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*C,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*k,l[11]=0,l[12]=(r+a)*T,l[13]=(f+h)*C,l[14]=(y+_)*k,l[15]=1,l},i.ce=Ae,i.cf=function(l,r,a){l[4*r+0]=a[0],l[4*r+1]=a[1],l[4*r+2]=a[2],l[4*r+3]=a[3]},i.cg=qf,i.ch=mh,i.ci=ki,i.cj=Pa,i.ck=gh,i.cl=Nk,i.cm=function(){var l=new P(4);return P!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},i.cn=function(l,r,a){var h=r[0],f=r[1],_=r[2],y=r[3],T=Math.sin(a),C=Math.cos(a);return l[0]=h*C+_*T,l[1]=f*C+y*T,l[2]=h*-T+_*C,l[3]=f*-T+y*C,l},i.co=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]},i.cp=Hn,i.cq=function(l){var r=l[0],a=l[1],h=l[2],f=l[3];return Math.sqrt(r*r+a*a+h*h+f*f)},i.cr=Fa,i.cs=tn,i.ct=gu,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=Tt,i.cz=lt,i.d=function(l){return ro.API_TILEJSON_REGEX.test(l)},i.d$=ZM,i.d0=me,i.d1=45,i.d2=Md,i.d3=function(l,r,a){const h=Math.sqrt(l*l+r*r+a*a),f=h>0?Math.acos(a/h)*Ru:0;let _=l!==0||r!==0?Math.atan2(-r,-l)*Ru+90:0;return _<0&&(_+=360),[h,_,f]},i.d4=Jt,i.d5=ts,i.d6=Xe,i.d7=St,i.d8=Mn,i.d9=an,i.dA=function(l,r,a){const h=Tr(a.zoom),f=l.style.map._antialias,_=l.terrain&&l.terrain.exaggeration()>0;return h===0&&!f&&!_},i.dB=function(l){const r=l.pixelsPerMeter,a=r/Ae(1,l.center.lat),h=q(new Float64Array(16));return le(h,h,[l.point.x,l.point.y,0]),ue(h,h,[a,a,r]),Float32Array.from(h)},i.dC=ir,i.dD=function(l){const r=Me-5;l=Oe(l,-r,r)/r*90;const a=Math.pow(Math.abs(Math.sin($e(l))),3);return Math.round(a*(O.length-1))},i.dE=function(l,r,a,h){const f=r.getNorth(),_=r.getSouth(),y=r.getWest(),T=r.getEast(),C=1<<l.z,k=T-y,L=f-_,j=k/M,N=-L/O[a],H=[0,j,0,N,0,0,f,y,0];if(l.z>0){const W=180/h;$(H,H,[W/k+1,0,0,0,W/L+1,0,-.5*W/j,.5*W/N,1])}return H[2]=C,H[5]=l.x,H[8]=l.y,H},i.dF=pn,i.dG=function(l,r,a){const h=q(new Float64Array(16)),f=(r/(1<<l)-.5)*Math.PI*2;return ge(h,a.globeMatrix,f),Float32Array.from(h)},i.dH=class{isDataAvailableAtPoint(l){const r=this._source();if(this.isUsingMockSource()||!r||l.y<0||l.y>1)return!1;const a=r.getSource().maxzoom,h=1<<a,f=Math.floor(l.x),_=Math.floor((l.x-f)*h),y=Math.floor(l.y*h),T=this.findDEMTileFor(new Ao(a,f,a,_,y));return!(!T||!T.dem)}getAtPointOrZero(l,r=0){return this.getAtPoint(l,r)||0}getAtPoint(l,r,a=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||l.y<0||l.y>1)return r;const f=h.getSource().maxzoom,_=1<<f,y=Math.floor(l.x),T=l.x-y,C=new Ao(f,y,f,Math.floor(T*_),Math.floor(l.y*_)),k=this.findDEMTileFor(C);if(!k||!k.dem)return r;const L=k.dem,j=1<<k.tileID.canonical.z,N=(T*j-k.tileID.canonical.x)*L.dim,H=(l.y*j-k.tileID.canonical.y)*L.dim,W=Math.floor(N),ee=Math.floor(H);return(a?this.exaggeration():1)*An(An(L.get(W,ee),L.get(W,ee+1),H-ee),An(L.get(W+1,ee),L.get(W+1,ee+1),H-ee),N-W)}getAtTileOffset(l,r,a){const h=1<<l.canonical.z;return this.getAtPointOrZero(new Qe(l.wrap+(l.canonical.x+r/Ft)/h,(l.canonical.y+a/Ft)/h))}getAtTileOffsetFunc(l,r,a,h){return f=>{const _=this.getAtTileOffset(l,f.x,f.y),y=h.upVector(l.canonical,f.x,f.y);return et(y,y,_*h.upVectorScale(l.canonical,r,a).metersToTile),y}}getForTilePoints(l,r,a,h){if(this.isUsingMockSource())return!1;const f=W_.create(this,l,h);return!!f&&(r.forEach((_=>{_[2]=this.exaggeration()*f.getElevationAt(_[0],_[1],a)})),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(l);if(!r||!r.dem)return null;const a=r.dem.tree,h=r.tileID,f=1<<l.canonical.z-h.canonical.z;let _=l.canonical.x/f-h.canonical.x,y=l.canonical.y/f-h.canonical.y,T=0;for(let C=0;C<l.canonical.z-h.canonical.z&&!a.leaves[T];C++){_*=2,y*=2;const k=2*Math.floor(y)+Math.floor(_);T=a.childOffsets[T]+k,_%=1,y%=1}return{min:this.exaggeration()*a.minimums[T],max:this.exaggeration()*a.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let r=!1,a=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const f of l){const _=this.getMinMaxForTile(f.tileID);_&&(a=Math.min(a,_.min),h=Math.max(h,_.max),r=!0)}return r?{min:a,max:h}:null}},i.dI=EI,i.dJ=ae,i.dK=function(l,r){return[Math.pow(l[0],2.2)*r,Math.pow(l[1],2.2)*r,Math.pow(l[2],2.2)*r]},i.dL=D,i.dM=function(l,r){var a=Math.sin(r),h=Math.cos(r);return l[0]=h,l[1]=a,l[2]=0,l[3]=-a,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},i.dN=mr,i.dO=Cr,i.dP=Yi,i.dQ=da,i.dR=256,i.dS=function(l,r){const a=[0,0,0];return wn(a,a,Lt(pn(r.canonical))),wn(a,a,l),a},i.dT=l=>({u_matrix:new gh(l),u_texsize:new Pa(l),u_pixels_to_tile_units:new ra(l),u_device_pixel_ratio:new ki(l),u_width_scale:new ki(l),u_floor_width_scale:new ki(l),u_image:new qf(l),u_units_to_pixels:new Pa(l),u_tile_units_to_pixels:new ki(l),u_alpha_discard_threshold:new ki(l),u_trim_offset:new Pa(l),u_trim_fade_range:new Pa(l),u_trim_color:new Md(l),u_emissive_strength:new ki(l),u_zbias_factor:new ki(l),u_tile_to_meter:new ki(l),u_ground_shadow_factor:new mh(l),u_pattern_transition:new ki(l)}),i.dU=l=>({u_matrix:new gh(l),u_pixels_to_tile_units:new ra(l),u_device_pixel_ratio:new ki(l),u_width_scale:new ki(l),u_floor_width_scale:new ki(l),u_units_to_pixels:new Pa(l),u_dash_image:new qf(l),u_gradient_image:new qf(l),u_image_height:new ki(l),u_texsize:new Pa(l),u_tile_units_to_pixels:new ki(l),u_alpha_discard_threshold:new ki(l),u_trim_offset:new Pa(l),u_trim_fade_range:new Pa(l),u_trim_color:new Md(l),u_emissive_strength:new ki(l),u_zbias_factor:new ki(l),u_tile_to_meter:new ki(l),u_ground_shadow_factor:new mh(l)}),i.dV=l=>({u_camera_to_center_distance:new ki(l),u_extrude_scale:new ra(l),u_device_pixel_ratio:new ki(l),u_matrix:new gh(l),u_inv_rot_matrix:new gh(l),u_merc_center:new Pa(l),u_tile_id:new mh(l),u_zoom_transition:new ki(l),u_up_dir:new mh(l),u_emissive_strength:new ki(l)}),i.dW=Yp,i.dX=Z$,i.dY=class{constructor(l,r,a,h){this.context=l,this.format=h,this.size=a,this.texture=l.gl.createTexture();const[f,_,y]=this.size,{gl:T}=l;T.bindTexture(T.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&T.texImage3D(T.TEXTURE_3D,0,this.format,f,_,y,0,OS(this.format),DS(this.format),r.data)}bind(l,r){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_3D,this.texture),l!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,l),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,l),this.minFilter=l),r!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},i.dZ=mI,i.d_=(l,r,a,h,f,_)=>{const y=l.transform,T=y.projection.name==="globe";let C;if(_.paint.get("circle-pitch-alignment")==="map")if(T){const L=Cr(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;C=Float32Array.from([L,0,0,L])}else C=y.calculatePixelsToTileUnitsMatrix(a);else C=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(y.projection),u_matrix:l.translatePosMatrix(r.projMatrix,a,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:_l.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:p6,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(T){k.u_inv_rot_matrix=h,k.u_merc_center=f,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=Tr(y.zoom);const L=f[0]*Ft,j=f[1]*Ft;k.u_up_dir=y.projection.upVector(new Ic(0,0,0),L,j)}return k},i.da=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},i.db=c2,i.dc=function(l,r){return l.readFields($8,{icons:[]},r)},i.dd=x0,i.de=$_,i.df=JS,i.dg=Kd,i.dh=qp,i.di=Uc,i.dj=Xh,i.dk=or,i.dl=function(l){const r=l.indexOf(Td);return r>=0?l.slice(0,r):l},i.dm=function(l){return l.indexOf(Td)>=0},i.dn=function(l){const r=l.lastIndexOf(Td);return r>=0?l.slice(r+1):""},i.dp=function(l){const r=[],a=l.id;return a===void 0&&r.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},i.dq=function(l,r,a,h){return l.type==="custom"?new z8(l,r):new U8[l.type](l,r,a,h)},i.dr=gr,i.ds=function(l){const r=l.indexOf(Td);return r>=0?l.slice(r+1):""},i.dt=class extends Y_{constructor(l,r){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},i.du=md,i.dv=br,i.dw=function(l){return l({pluginStatus:Qr,pluginURL:El}),md.on("pluginStateChange",l),l},i.dx=pg,i.dy=class extends Al{constructor(l){super(l),this.current=mg}set(l,r,a){if(this.fetchUniformLocation(l,r)){for(let h=0;h<9;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},i.dz=Se,i.e=ro,i.e$=function(){const l=ov;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(PS),ov=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.e0=jo,i.e1=(l,r,a,h,f,_,y,T,C,k)=>{const L=l.transform,j=L.pitch<15?GM(.07,.7,Oe((14-L.zoom)/5,0,1)):.07,N=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:qM(l,r,a,h),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:L.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:f,u_width_scale:_,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:WM(r,L),u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:j,u_tile_to_meter:Xe(r.tileID.canonical,0),u_ground_shadow_factor:C,u_pattern_transition:k}},i.e2=(l,r,a,h,f,_,y,T,C,k)=>{const L=l.transform,j=L.calculatePixelsToTileUnitsMatrix(r),N=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",H=L.pitch<15?GM(.07,.7,Oe((14-L.zoom)/5,0,1)):.07;return{u_matrix:qM(l,r,a,h),u_pixels_to_tile_units:j,u_device_pixel_ratio:_,u_width_scale:y,u_floor_width_scale:T,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:XM(a)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:WM(r,l.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:H,u_tile_to_meter:Xe(r.tileID.canonical,0),u_ground_shadow_factor:k}},i.e3=gn,i.e4=Zy,i.e5=Te,i.e6=v,i.e7=y0,i.e8=sM,i.e9=om,i.eA=is,i.eB=uh,i.eC=function(l,r,a,h,f,_,y,T,C,k,L,j,N,H,W,ee){var ie=new P(16);return ie[0]=l,ie[1]=r,ie[2]=a,ie[3]=h,ie[4]=f,ie[5]=_,ie[6]=y,ie[7]=T,ie[8]=C,ie[9]=k,ie[10]=L,ie[11]=j,ie[12]=N,ie[13]=H,ie[14]=W,ie[15]=ee,ie},i.eD=Y,i.eE=Ad,i.eF=Uf,i.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new It(1/0,1/0),max:new It(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,r=!1){const a=GI(new It(0,0),new It(Ft,Ft),l),h=[];if(r&&!bS(a,this._globalClipBounds))return h;for(const f of this._activeRegions){if(f.hiddenByOverlap||!bS(a,f))continue;const _=V6(f.min,f.max,l);h.push({min:_.min,max:_.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return h}setSources(l){this._setSources(l.map((r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const a=[];for(const h of r.cache.getVisibleCoordinates()){const f=r.cache.getTile(h).buckets[r.layer];f&&f.updateFootprints(h.toUnwrapped(),a)}return a},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope}))))}_addSource(l){const r=l.getFootprints();if(r.length===0)return;const a=l.getOrder(),h=l.getClipMask(),f=l.getClipScope();for(const _ of r){if(!_.footprint)continue;const y=GI(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:a,clipMask:h,clipScope:f})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort(((r,a)=>r.priority-a.priority||m0(r.min,a.min)||m0(r.max,a.max)||r.order-a.order||r.clipMask-a.clipMask||(function(h,f){const _=(y,T)=>y+T;return h.length-f.length||h.reduce(_,"").localeCompare(f.reduce(_,""))})(r.clipScope,a.clipScope)));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let r=0;for(;!l&&r!==this._activeRegions.length;){const a=this._activeRegions[r],h=this._prevRegions[r];l=a.priority!==h.priority||!HI(a,h)||a.order!==h.order||a.clipMask!==h.clipMask||!Dl(a.clipScope,h.clipScope),++r}}if(l){++this._updateTime;for(const a of this._activeRegions)a.order!==ev&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const r=a=>{const h=this._activeRegions;if(a>=h.length)return a;const f=h[a].priority;for(;a<h.length&&h[a].priority===f;)++a;return a};if(this._sourceIds.length>1){let a=0,h=r(a);for(;a!==h;){let f=a;const _=a;for(;f!==h;){const y=this._activeRegions[f];y.hiddenByOverlap=!1;for(let T=0;T<_;T++){const C=this._activeRegions[T];if(!C.hiddenByOverlap&&y.order===ev&&bS(y,C)&&(y.hiddenByOverlap=WI(y.footprint,y.tileId,C.footprint,C.tileId),y.hiddenByOverlap))break}++f}a=h,h=r(a)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=l.length-1;r>=0;r--)this._addSource(l[r]);this._computeReplacement()}},i.eH=ev,i.eI=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,r){const a=new Ac,h=new ss,f=[],_=l+1+2,y=r[0]+1,T=r[0]+1+(1+r.length),C=(k,L,j)=>{let N=k===_-1?k-2:k===0?k:k-1;return N+=j?24575:0,[N,L]};for(let k=0;k<_;++k)a.emplaceBack(...C(k,0,!0));for(let k=0;k<y;++k)for(let L=0;L<_;++L)a.emplaceBack(...C(L,k,(L===0||L===_-1)&&!0));for(let k=0;k<r.length;++k){const L=r[k];for(let j=0;j<_;++j)a.emplaceBack(...C(j,L,!0))}for(let k=0;k<r.length;++k){const L=h.length,j=r[k]+1+2,N=new ss;for(let ee=0;ee<j-1;ee++){const ie=ee===j-2,se=ie?_*(T-r.length+k-ee):_;for(let fe=0;fe<_-1;fe++){const pe=ee*_+fe;ee===0||ie||fe===0||fe===_-2?(N.emplaceBack(pe+1,pe,pe+se),N.emplaceBack(pe+se,pe+se+1,pe+1)):(h.emplaceBack(pe+1,pe,pe+se),h.emplaceBack(pe+se,pe+se+1,pe+1))}}const H=Rr.simpleSegment(0,L,a.length,h.length-L);for(let ee=0;ee<N.uint16.length;ee+=3)h.emplaceBack(N.uint16[ee],N.uint16[ee+1],N.uint16[ee+2]);const W=Rr.simpleSegment(0,L,a.length,h.length-L);f.push({withoutSkirts:H,withSkirts:W})}return{vertices:a,indices:h,segments:f}}_createGrid(l){const r=this._fillGridMeshWithLods(M,O);this._gridSegments=r.segments,this._gridBuffer=l.createVertexBuffer(r.vertices,K.members),this._gridIndexBuffer=l.createIndexBuffer(r.indices,!0)}_createPoles(l){const r=new ss;for(let y=0;y<=M;y++)r.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=l.createIndexBuffer(r,!0);const a=new fu,h=new fu,f=new fu,_=new fu;this._poleSegments=[];for(let y=0,T=0;y<x;y++){const C=360/(1<<y);a.emplaceBack(0,-p,0,.5,0),h.emplaceBack(0,-p,0,.5,1),f.emplaceBack(0,-p,0,.5,.5),_.emplaceBack(0,-p,0,.5,.5);for(let k=0;k<=M;k++){let L=k/M,j=0;const N=An(0,C,L),[H,W,ee]=G(dS,f6,N,p);a.emplaceBack(H,W,ee,L,j),h.emplaceBack(H,W,ee,L,1-j);const ie=$e(N);L=.5+.5*Math.sin(ie),j=.5+.5*Math.cos(ie),f.emplaceBack(H,W,ee,L,j),_.emplaceBack(H,W,ee,L,1-j)}this._poleSegments.push(Rr.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(a,R,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(h,R,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(f,R,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(_,R,!1)}getGridBuffers(l,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},i.eJ=VI,i.eK=ze,i.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eM=De,i.eN=at,i.eO=function(l,r,a){return l[0]=r[0]/a[0],l[1]=r[1]/a[1],l[2]=r[2]/a[2],l},i.eP=Mi,i.eQ=V,i.eR=$n,i.eS=Nt,i.eT=function([l,r,a]){const h=Math.hypot(l,r,a),f=Math.atan2(l,a),_=.5*Math.PI-Math.acos(-r/h);return new Q(oe(f),oe(_))},i.eU=js,i.eV=jS,i.eW=function(l){const r=l.navigator?l.navigator.userAgent:null;return!!(function(a){if(wi==null){const h=a.navigator?a.navigator.userAgent:null;wi=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return wi})(l)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eX=function(l,r){pa=l,ni=r},i.eY=Ci,i.eZ=fo,i.e_=function(l){const r=[0,0,0],a=q(new Float64Array(16));return re(a,l.pixelMatrix,l.globeMatrix),wn(r,r,a),new It(r[0],r[1])},i.ea=450,i.eb=7,i.ec=Be,i.ed=function(l,r){if(l===r){var a=r[1],h=r[2],f=r[3],_=r[6],y=r[7],T=r[11];l[1]=r[4],l[2]=r[8],l[3]=r[12],l[4]=a,l[6]=r[9],l[7]=r[13],l[8]=h,l[9]=_,l[11]=r[14],l[12]=f,l[13]=y,l[14]=T}else l[0]=r[0],l[1]=r[4],l[2]=r[8],l[3]=r[12],l[4]=r[1],l[5]=r[5],l[6]=r[9],l[7]=r[13],l[8]=r[2],l[9]=r[6],l[10]=r[10],l[11]=r[14],l[12]=r[3],l[13]=r[7],l[14]=r[11],l[15]=r[15];return l},i.ee=j8,i.ef=vr,i.eg=dh,i.eh=256,i.ei=Pn,i.ej=qs,i.ek=ge,i.el=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[4],l[4]=r[5],l[5]=r[6],l[6]=r[8],l[7]=r[9],l[8]=r[10],l},i.em=fu,i.en=Jp,i.eo=Pf,i.ep=function(l,r,a,h,f){return Oe((l-r)/(a-r)*(f-h)+h,h,f)},i.eq=Na,i.er=function(l,r){var a=r[0],h=r[1],f=r[2],_=r[3],y=r[4],T=r[5],C=r[6],k=r[7],L=r[8],j=L*y-T*k,N=-L*_+T*C,H=k*_-y*C,W=a*j+h*N+f*H;return W?(l[0]=j*(W=1/W),l[1]=(-L*h+f*k)*W,l[2]=(T*h-f*y)*W,l[3]=N*W,l[4]=(L*a-f*C)*W,l[5]=(-T*a+f*_)*W,l[6]=H*W,l[7]=(-k*a+h*C)*W,l[8]=(y*a-h*_)*W,l):null},i.es=2,i.et=fr,i.eu=zS,i.ev=[1,1,1],i.ew=W_,i.ex=si,i.ey=function(l,r,a,h){var f=r[0],_=r[1],y=r[2],T=r[3];return l[0]=f+h*(a[0]-f),l[1]=_+h*(a[1]-_),l[2]=y+h*(a[2]-y),l[3]=T+h*(a[3]-T),l},i.ez=B_,i.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,((r,a)=>String.fromCharCode(+("0x"+a)))))},i.f0=function(){x0().acquire(PS)},i.f1=gd,i.f2=function(l,r,a=!1){if(Qr===Vo.deferred||Qr===Vo.loading||Qr===Vo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");El=_l.resolveURL(l),Qr=Vo.deferred,Rf=r,Of(),a||Ta()},i.f3=function(l){z_=_l.resolveURL(l),N_||(N_=new j_(x0(),new Gc)),N_.broadcast("setMeshoptUrl",z_)},i.f4=yM,i.f5=function(l){MS=_l.resolveURL(l),N_||(N_=new j_(x0(),new Gc)),N_.broadcast("setDracoUrl",MS)},i.f6=_M,i.f7=sv,i.f8=function(l){const r=Tp();if(!r)return;const a=r.delete(fa);l&&a.then((()=>l())).catch(l)},i.f9=vg,i.fA=function(l){qh(),io!=null&&io.then((r=>{r.keys().then((a=>{for(let h=0;h<a.length-l;h++)r.delete(a[h]).catch((f=>_r(f.message)))})).catch((a=>_r(a.message)))})).catch((r=>_r(r.message)))},i.fa=nn,i.fb=sm,i.fc=wh,i.fd=$R,i.fe=HR,i.ff=UM,i.fg=Wn,i.fh="hd_road_elevation",i.fi=ai,i.fj=Fn,i.fk=Zf,i.fl=KS,i.fm=wg,i.fn=function(l,r,a,h,f,_,y,T=1,C,k,L){l.createArrays(),l.tilePixelRatio=Ft/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const j=l.layers[0].layout,N=l.layers[0]._unevaluatedLayout._values,H={};H.scaleFactor=T,H.textSizeScaleRange=j.get("text-size-scale-range"),H.iconSizeScaleRange=j.get("icon-size-scale-range");const[W,ee]=H.textSizeScaleRange,[ie,se]=H.iconSizeScaleRange;H.textScaleFactor=Oe(H.scaleFactor,W,ee),H.iconScaleFactor=Oe(H.scaleFactor,ie,se);const fe=N["text-size"],pe=N["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ft}=l.textSizeData;H.compositeTextSizes=[fe.possiblyEvaluate(new wr(Ue,{worldview:L}),_),fe.possiblyEvaluate(new wr(ft,{worldview:L}),_)]}if(l.iconSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ft}=l.iconSizeData;H.compositeIconSizes=[pe.possiblyEvaluate(new wr(Ue,{worldview:L}),_),pe.possiblyEvaluate(new wr(ft,{worldview:L}),_)]}H.layoutTextSize=fe.possiblyEvaluate(new wr(y+1,{worldview:L}),_),H.layoutIconSize=pe.possiblyEvaluate(new wr(y+1,{worldview:L}),_),H.textMaxSize=fe.possiblyEvaluate(new wr(18,{worldview:L}),_);const _e=j.get("symbol-placement"),ke=j.get("text-rotation-alignment")==="map"&&_e!=="point",Re=j.get("text-size");let Ne=!1;const Fe=[];for(const Ue of l.features){const ft=j.get("text-font").evaluate(Ue,{},_).join(","),We=Re.evaluate(Ue,{},_)*H.textScaleFactor,mt=H.layoutTextSize.evaluate(Ue,{},_)*H.textScaleFactor,Ct=H.layoutIconSize.evaluate(Ue,{},_)*H.iconScaleFactor,yt={horizontal:{},vertical:void 0},xt=Ue.text;let Rt,ht=[0,0];if(xt){const mn=xt.toString(),On=j.get("text-letter-spacing").evaluate(Ue,{},_)*Ks,Vn=j.get("text-line-height").evaluate(Ue,{},_)*Ks,ar=Qm(mn)?On:0,Jn=j.get("text-anchor").evaluate(Ue,{},_),on=j.get("text-variable-anchor");if(!on){const it=j.get("text-radial-offset").evaluate(Ue,{},_);if(it)ht=Ak(Jn,[it*Ks,QS]);else{const dt=j.get("text-offset").evaluate(Ue,{},_);ht=[dt[0]*Ks,dt[1]*Ks]}}let qn=ke?"center":j.get("text-justify").evaluate(Ue,{},_);const Er=_e==="point",xe=Er?j.get("text-max-width").evaluate(Ue,{},_)*Ks:1/0,be=it=>{l.allowVerticalPlacement&&fd(mn)&&(yt.vertical=ZS(xt,r,a,f,ft,xe,Vn,Jn,it,ar,ht,Il.vertical,!0,mt,We,C))};if(!ke&&on){const it=qn==="auto"?on.map((Zt=>e2(Zt))):[qn];let dt=!1;for(let Zt=0;Zt<it.length;Zt++){const qt=it[Zt];if(!yt.horizontal[qt])if(dt)yt.horizontal[qt]=yt.horizontal[0];else{const sn=ZS(xt,r,a,f,ft,xe,Vn,"center",qt,ar,ht,Il.horizontal,!1,mt,We,C);sn&&(yt.horizontal[qt]=sn,dt=sn.positionedLines.length===1)}}be("left")}else{if(qn==="auto"&&(qn=e2(Jn)),Er||j.get("text-writing-mode").indexOf("horizontal")>=0||!fd(mn)){const it=ZS(xt,r,a,f,ft,xe,Vn,Jn,qn,ar,ht,Il.horizontal,!1,mt,We,C);it&&(yt.horizontal[qn]=it)}be(Er?"left":qn)}}let bt,st,nt,Ot,Mt,bn,rn=!1;const fn=j.get("icon-text-fit").evaluate(Ue,{},_);if(Ue.icon&&Ue.icon.hasPrimary()){const mn=Pk(Ue.icon,l.iconSizeData,N["icon-size"],_,l.zoom,Ue,C,H.iconScaleFactor,L);bt=mn.iconPrimary,nt=mn.iconSecondary;const On=bt.toString();if(st=h.get(On),st&&(Mt=j.get("icon-offset").evaluate(Ue,{},_),bn=j.get("icon-anchor").evaluate(Ue,{},_),Rt=d8(f.get(On),nt?f.get(nt.toString()):void 0,Mt,bn),rn=st.sdf,l.sdfIcons===void 0?l.sdfIcons=st.sdf:l.sdfIcons!==st.sdf&&_r("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==l.pixelRatio||j.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),nt){const Vn=nt.toString();Ot=h.get(Vn)}}Ne=Ne||!(!Ue.icon||!Ue.icon.hasSecondary());const Ut=t2(yt.horizontal)||yt.vertical;l.iconsInText||(l.iconsInText=!!Ut&&Ut.iconsInText);const xn=mt*H.textScaleFactor/Ks,{defaultShapedIcon:Nn,verticallyShapedIcon:Yt}=w8(l,Rt,j,Ue,_,yt,xn,Mt,fn);fn!=="none"&&Rt&&(uk(Rt)||hk(Rt))&&(R0(0,st,bt,Rt,Nn,fn,k,h,f),R0(0,Ot,nt,Rt,Nn,fn,k,h,f),Yt&&(R0(0,st,bt,Rt,Yt,fn,k,h,f),R0(0,Ot,nt,Rt,Yt,fn,k,h,f))),Rt=Nn,Fe.push({feature:Ue,shapedTextOrientations:yt,shapedText:Ut,shapedIcon:Rt,iconPrimary:bt,iconSecondary:nt,iconOffset:Mt,iconAnchor:bn,verticallyShapedIcon:Yt,layoutTextSize:mt,layoutIconSize:Ct,textOffset:ht,isSDFIcon:rn,iconTextFit:fn})}return{featureData:Fe,sizes:H,hasAnySecondaryIcon:Ne,textAlongLine:ke,symbolPlacement:_e}},i.fo=xk,i.fp=function(l,r,a,h,f,_,y,T,C,k){const{featureData:L,hasAnySecondaryIcon:j,sizes:N,textAlongLine:H,symbolPlacement:W}=r;for(const ee of L){const{shapedIcon:ie,verticallyShapedIcon:se,feature:fe,shapedTextOrientations:pe,shapedText:_e,layoutTextSize:ke,textOffset:Re,isSDFIcon:Ne,iconPrimary:Fe,iconSecondary:Ue,iconTextFit:ft,iconOffset:We}=ee;Ik(ie,k.iconPositions,Fe,Ue),Ik(se,k.iconPositions,Fe,Ue),b8(pe,k.iconPositions),x8(Fe,Ue,k.iconPositions),(_e||ie)&&S8(l,fe,pe,ie,se,C,N,ke,0,Re,Ne,h,f,y,T,j,ft,We,H,W)}a&&l.generateCollisionDebugBuffers(_,l.collisionBoxArray,N.textScaleFactor)},i.fq=jn,i.fr=J0,i.fs=wt,i.ft=function(l){let r=0;if(new Uint32Array(l,0,1)[0]!==xM){const a=new Uint32Array(l,0,7),[,,h,f,_,y]=a;r=a.byteLength+f+_+y+_,(h!==l.byteLength||r>=l.byteLength)&&_r("Invalid b3dm header information.")}return TM(l,r)},i.fu=function(l,r){const a=RM(l);for(const h of a){for(const f of h.meshes)v$(f);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(x$(h.lights,r)))}return a},i.fv=W0,i.fw=$r,i.fx=mM,i.fy=Ai,i.fz=Vo,i.g=function(l,r){return br(Object.assign(l,{method:"GET"}),r)},i.h=function(l){return l.indexOf("mapbox:")===0},i.i=function(l){return ro.API_STYLE_REGEX.test(l)&&!d_(l)},i.j=Wh,i.k=Ou,i.l=function(l){return decodeURIComponent(atob(l).split("").map((r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2))).join(""))},i.m=function(l,r){return br(Object.assign(l,{type:"json"}),r)},i.n=zl,i.o=_l,i.p=function(l,r){return br(Object.assign(l,{method:"POST"}),r)},i.q=Co,i.r=Xd,i.s=function(l){try{const r=self[l];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return IS||(IS=new vg),IS},i.u=function(){return(function l(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)})()},i.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},i.w=_r,i.x=g2,i.y=$a,i.z=Va})),d(["./shared"],(function(i){function E($e){const oe=$e?$e.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function P($e){if(typeof $e=="number"||typeof $e=="boolean"||typeof $e=="string"||$e==null)return JSON.stringify($e);if(Array.isArray($e)){let de="[";for(const Se of $e)de+=`${P(Se)},`;return`${de}]`}let oe="{";for(const de of Object.keys($e).sort())oe+=`${de}:${P($e[de])},`;return`${oe}}`}function I($e){let oe="";for(const de of i.bx)oe+=`/${P($e[de])}`;return oe}class D{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,de){this._layerConfigs={},this._layers={},this.update(oe,[],de)}update(oe,de,Se){this._options=Se;for(const De of oe)this._layerConfigs[De.id]=De,(this._layers[De.id]=i.dq(De,this.scope,null,this._options)).compileFilter(Se),this.keyCache[De.id]&&delete this.keyCache[De.id];for(const De of de)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};const ze=(function(De,Oe){const rt={};for(let ot=0;ot<De.length;ot++){const jt=De[ot];let _t=Oe&&Oe[jt.id];_t||(jt.type==="symbol"?_t=jt.id:(_t=I(jt),jt.type==="line"&&jt.paint&&(function Rn(Fn){return typeof Fn=="string"&&Fn==="line-progress"||(Array.isArray(Fn)?Fn.some(Rn):!(!Fn||typeof Fn!="object")&&Object.values(Fn).some(Rn))})(jt.paint["line-width"])&&(_t+=`/${P(jt.paint["line-width"])}`))),Oe&&(Oe[jt.id]=_t);let gn=rt[_t];gn||(gn=rt[_t]=[]),gn.push(jt)}const Ve=[];for(const ot in rt)Ve.push(rt[ot]);return Ve})(Object.values(this._layerConfigs),this.keyCache);for(const De of ze){const Oe=De.map((gn=>this._layers[gn.id])),rt=Oe[0];if(rt.visibility==="none")continue;const Ve=rt.source||"";let ot=this.familiesBySource[Ve];ot||(ot=this.familiesBySource[Ve]={});const jt=rt.sourceLayer||"_geojsonTileLayer";let _t=ot[jt];_t||(_t=ot[jt]=[]),_t.push(Oe)}}}const F=1*i.fc;class ${constructor(oe){const de={},Se=[];for(const rt in oe){const Ve=oe[rt],ot=de[rt]={};for(const jt in Ve.glyphs){const _t=Ve.glyphs[+jt];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const gn=_t.metrics.localGlyph?F:1,Rn={x:0,y:0,w:_t.bitmap.width+2*gn,h:_t.bitmap.height+2*gn};Se.push(Rn),ot[jt]=Rn}}const{w:ze,h:De}=i.G(Se),Oe=new i.fb({width:ze||1,height:De||1});for(const rt in oe){const Ve=oe[rt];for(const ot in Ve.glyphs){const jt=Ve.glyphs[+ot];if(!jt||jt.bitmap.width===0||jt.bitmap.height===0)continue;const _t=de[rt][ot],gn=jt.metrics.localGlyph?F:1;i.fb.copy(jt.bitmap,Oe,{x:0,y:0},{x:_t.x+gn,y:_t.y+gn},jt.bitmap)}}this.image=Oe,this.positions=de}}i.fa($,"GlyphAtlas");class Z{constructor(oe){this.tileID=new i.aO(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=i.aZ(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor,this.worldview=oe.worldview}parse(oe,de,Se,ze,De,Oe){this.status="parsing",this.data=oe,this.collisionBoxArray=new i.b3;const rt=new i.fd(Object.keys(oe.layers).sort()),Ve=new i.fe(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const ot={},jt=new i.ff(256,256),_t={featureIndex:Ve,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:jt,availableImages:Se,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},gn=[],Rn=de.familiesBySource[this.source];for(const gr in Rn){const or=oe.layers[gr];if(!or)continue;let xr=!1,Xr=!1,_r=!1;for(const $r of Rn[gr])$r[0].type==="symbol"?xr=!0:Xr=!0,$r[0].is3D()&&$r[0].type!=="model"&&(_r=!0);if(this.extraShadowCaster&&!_r||this.isSymbolTile===!0&&!xr||this.isSymbolTile===!1&&!Xr)continue;or.version===1&&i.w(`Vector tile source "${this.source}" layer "${gr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zi=rt.encode(gr),Ur=[];let ts=!1;for(let $r=0,Or=0;$r<or.length;$r++){const wi=or.feature($r),Oi=Ve.getId(wi,gr);if(this.localizableLayerIds&&this.localizableLayerIds.has(gr)){const ti=wi.properties?wi.properties.worldview:null;if(this.worldview&&typeof ti=="string")if(ti==="all")wi.properties.$localized=!0;else{if(!ti.split(",").includes(this.worldview))continue;wi.properties.$localized=!0,wi.properties.worldview=this.worldview}}!ts&&wi.properties&&wi.properties.hasOwnProperty(i.fg)&&(ts=!0),Ur.push({feature:wi,id:Oi,index:Or,sourceLayerIndex:zi}),Or++}ts&&!_t.elevationFeatures&&oe.layers.hasOwnProperty(i.fh)&&(_t.elevationFeatures=i.fi.parseFrom(oe.layers[i.fh],this.canonical));for(const $r of Rn[gr]){const Or=$r[0];if(this.extraShadowCaster&&(!Or.is3D()||Or.type==="model")||this.isSymbolTile!==void 0&&Or.type==="symbol"!==this.isSymbolTile||Or.minzoom&&this.zoom<Math.floor(Or.minzoom)||Or.maxzoom&&this.zoom>=Or.maxzoom||Or.visibility==="none")continue;q($r,this.zoom,_t.brightness,Se,this.worldview);const wi=ot[Or.id]=Or.createBucket({index:Ve.bucketLayerIDs.length,layers:$r,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ze,worldview:this.worldview});Ve.bucketLayerIDs.push($r.map((ti=>i.B(ti.id,ti.scope))));let Oi=wi.prepare?wi.prepare():null;Oi!=null?(Oi=Oi.then((()=>wi.populate(Ur,_t,this.tileID.canonical,this.tileTransform))),gn.push(Oi)):wi.populate(Ur,_t,this.tileID.canonical,this.tileTransform)}}const Fn=()=>{let gr,or,xr,Xr,_r,zi;jt.trim();const Ur={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ts=()=>{if(gr)return this.status="done",Oe(gr);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:Object.values(ot).filter((Or=>!Or.isEmpty())),featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_t.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(or&&xr&&Xr){const Or=new $(or),wi=new Map;for(const[ds,Yi]of xr.entries()){const{imagePosition:da}=i.fl(ds,Yi,i.fm);wi.set(ds,da)}const Oi={};for(const ds in ot){const Yi=ot[ds];Yi instanceof i.b4&&(q(Yi.layers,this.zoom,_t.brightness,Se,this.worldview),Oi[ds]=i.fn(Yi,or,Or.positions,xr,wi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,_r,this.worldview))}const ti={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(De,xr,_r,(()=>{ti.iconsPending=!1,$r(Oi,Or,ti)})),this.rasterizeIfNeeded(De,Xr,zi,(()=>{ti.patternsPending=!1,$r(Oi,Or,ti)}))}},$r=(Or,wi,Oi,ti)=>{if(Oi.iconsPending||Oi.patternsPending)return;const ds=new i.fo(xr,Xr,this.lut);for(const Yi in ot){const da=ot[Yi];if(Yi in Or)i.fp(da,Or[Yi],this.showCollisionBoxes,Se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,xr,ds);else if(da.hasPattern&&(da instanceof i.ba||da instanceof i.bb||da instanceof i.e7)){q(da.layers,this.zoom,_t.brightness,Se,this.worldview);const Ns=Object.fromEntries(ds.patternPositions);da.addFeatures(_t,this.tileID.canonical,Ns,Se,this.tileTransform,this.brightness)}}this.status="done",Oe(null,{buckets:Object.values(ot).filter((Yi=>!Yi.isEmpty())),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wi.image,lineAtlas:jt,imageAtlas:ds,brightness:_t.brightness})};if(!this.extraShadowCaster){const Or=i.fj(_t.glyphDependencies,(ti=>Object.keys(ti).map(Number)));Object.keys(Or).length?De.send("getGlyphs",{uid:this.uid,stacks:Or},((ti,ds)=>{gr||(gr=ti,or=ds,ts())}),void 0,!1,Ur):or={};const wi=Array.from(_t.iconDependencies.keys()).map((ti=>i.I.parse(ti)));wi.length?De.send("getImages",{images:wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((ti,ds)=>{gr||(gr=ti,xr=new Map,_r=this.updateImageMapAndGetImageTaskQueue(xr,ds,_t.iconDependencies),ts())}),void 0,!1,Ur):(xr=new Map,_r=new Map);const Oi=Array.from(_t.patternDependencies.keys()).map((ti=>i.I.parse(ti)));Oi.length?De.send("getImages",{images:Oi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((ti,ds)=>{gr||(gr=ti,Xr=new Map,zi=this.updateImageMapAndGetImageTaskQueue(Xr,ds,_t.patternDependencies),ts())}),void 0,!1,Ur):(Xr=new Map,zi=new Map)}if(_t.elevationFeatures&&_t.elevationFeatures.length>0){const Or=[];for(const Oi of Object.values(ot))if(Oi instanceof i.bb){const ti=Oi.getUnevaluatedPortalGraph();ti&&Or.push(ti)}const wi=i.fk.evaluate(Or);for(const Oi of Object.values(ot))if(Oi instanceof i.bb){const ti=oe.layers[rt.decode(Oi.sourceLayerIndex)];Oi.setEvaluatedPortalGraph(wi,ti,this.tileID.canonical,_t.availableImages,_t.brightness)}}ts()};gn.length>0?Promise.allSettled(gn).then(Fn).catch(Oe):Fn()}rasterizeIfNeeded(oe,de,Se,ze){Array.from(de.values()).some((De=>De.usvg))?this.rasterize(oe,de,Se,ze):ze()}updateImageMapAndGetImageTaskQueue(oe,de,Se){const ze=new Map;for(const De of de.keys()){const Oe=Se.get(De)||[];for(const rt of Oe){const Ve=rt.toString(),ot=de.get(rt.id.toString());ot.usvg?ze.has(Ve)||(ze.set(Ve,rt),oe.set(Ve,Object.assign({},ot))):oe.set(Ve,ot)}}return ze}rasterize(oe,de,Se,ze){this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,tasks:Se},((De,Oe)=>{if(!De)for(const[rt,Ve]of Oe.entries()){const ot=Object.assign(de.get(rt),{data:Ve});de.set(rt,ot)}ze()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function q($e,oe,de,Se,ze){const De=new i.ac(oe,{brightness:de,worldview:ze});for(const Oe of $e)Oe.recalculate(De,Se)}class X extends i.E{constructor(oe,de,Se,ze,De,Oe,rt){super(),this.actor=oe,this.layerIndex=de,this.availableImages=Se,this.availableModels=ze,this.loadVectorData=Oe||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(oe.scheduler),this.isSpriteLoaded=De,this.scheduler=oe.scheduler,this.brightness=rt}loadTile(oe,de){const Se=oe.uid,ze=oe&&oe.request,De=ze&&ze.collectResourceTiming,Oe=this.loading[Se]=new Z(oe);Oe.abort=this.loadVectorData(oe,((rt,Ve)=>{const ot=!this.loading[Se];if(delete this.loading[Se],Oe.cancelRasterize(),ot||rt||!Ve)return Oe.status="done",ot||(this.loaded[Se]=Oe),de(rt);const jt=Ve.rawData,_t={};Ve.expires&&(_t.expires=Ve.expires),Ve.cacheControl&&(_t.cacheControl=Ve.cacheControl),Oe.vectorTile=Ve.vectorTile||new i.fq(new i.bt(jt));const gn=()=>{Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Rn,Fn)=>{if(Rn||!Fn)return de(Rn);const gr={};if(De){const or=E(ze);or.length>0&&(gr.resourceTiming=JSON.parse(JSON.stringify(or)))}de(null,Object.assign({rawTileData:jt.slice(0)},Fn,_t,gr))}))};this.isSpriteLoaded?gn():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(gn,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):gn()})),this.loaded=this.loaded||{},this.loaded[Se]=Oe}))}reloadTile(oe,de){const Se=this.loaded,ze=oe.uid;if(Se&&Se[ze]){const De=Se[ze];De.scaleFactor=oe.scaleFactor,De.showCollisionBoxes=oe.showCollisionBoxes,De.projection=oe.projection,De.brightness=oe.brightness,De.tileTransform=i.aZ(oe.tileID.canonical,oe.projection),De.extraShadowCaster=oe.extraShadowCaster,De.lut=oe.lut,De.worldview=oe.worldview;const Oe=(rt,Ve)=>{const ot=De.reloadCallback;ot&&(delete De.reloadCallback,De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ot)),de(rt,Ve)};De.status==="parsing"?De.reloadCallback=Oe:De.status==="done"&&(De.vectorTile?De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Oe):Oe())}else de(null,void 0)}abortTile(oe,de){const Se=oe.uid,ze=this.loading[Se];ze&&(ze.abort&&ze.abort(),delete this.loading[Se]),de()}removeTile(oe,de){const Se=this.loaded,ze=oe.uid;Se&&Se[ze]&&delete Se[ze],de()}}class re{loadTile(oe,de){const{uid:Se,encoding:ze,rawImageData:De,padding:Oe}=oe,rt=ImageBitmap&&De instanceof ImageBitmap?this.getImageData(De,Oe):De;de(null,new i.fr(Se,rt,ze,Oe<1))}reloadTile(oe,de){de(null,null)}abortTile(oe,de){de()}removeTile(oe,de){de()}getImageData(oe,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const Se=this.offscreenCanvasContext.getImageData(-de,-de,oe.width+2*de,oe.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}i.bs.setPbf(i.bt);class le{constructor(oe){this._mrt=new i.bs(oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=oe.uid,this.tileID=oe.tileID,this.source=oe.source}parse(oe,de){const Se=this._mrt;this.status="parsing",this._entireBuffer=oe;try{Se.parseHeader(oe),this._isHeaderLoaded=!0;const ze=[];for(const De in Se.layers){const Oe=Se.getLayer(De),rt=Oe.getDataRange(Oe.getBandList()),Ve=Se.createDecodingTask(rt),ot=oe.slice(rt.firstByte,rt.lastByte+1),jt=i.bs.performDecoding(ot,Ve).then((_t=>Ve.complete(null,_t))).catch((_t=>Ve.complete(_t,null)));ze.push(jt)}Promise.allSettled(ze).then((()=>de(null,Se))).catch((De=>de(De)))}catch(ze){de(ze)}}}class ue{constructor(oe){this.actor=oe,this.loading={},this.loaded={}}loadTile(oe,de){const Se=oe.uid,ze=oe.request,De=this.loading[Se]=new le(oe),{cancel:Oe}=i.bu(ze,((rt,Ve,ot,jt)=>{const _t=!this.loading[Se];if(delete this.loading[Se],_t||rt||!Ve)return De.status="done",_t||(this.loaded[Se]=De),de(rt);De.parse(Ve,((gn,Rn)=>{if(gn||!Rn)return de(gn);de(null,Rn,ot,jt)})),this.loaded[Se]=De}));De.abort=Oe}reloadTile(oe,de){de(null,void 0)}abortTile(oe,de){const Se=oe.uid,ze=this.loading[Se];ze&&(ze.abort&&ze.abort(),delete this.loading[Se]),de()}removeTile(oe,de){const Se=oe.uid;this.loaded[Se]&&delete this.loaded[Se],de()}decodeRasterArray(oe,de){i.bs.performDecoding(oe.buffer,oe.task).then((Se=>de(null,Se))).catch((Se=>de(Se)))}}const ye=i.fs.prototype.toGeoJSON;class ge{constructor(oe){this._feature=oe,this.extent=i.al,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const de of this._feature.geometry)oe.push([new i.P(de[0],de[1])]);return oe}{const oe=[];for(const de of this._feature.geometry){const Se=[];for(const ze of de)Se.push(new i.P(ze[0],ze[1]));oe.push(Se)}return oe}}toGeoJSON(oe,de,Se){return ye.call(this,oe,de,Se)}}class we{constructor(oe,de){this.name=oe,this.extent=i.al,this.length=de.length,this._jsonFeatures=de}feature(oe){return new ge(this._jsonFeatures[oe])}}class Le{constructor(oe){this.layers={},this.extent=i.al;for(const de of Object.keys(oe))this.layers[de]=new we(de,oe[de])}}const Ze=64/4096,Ge=128;class gt{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],de){for(const Se of oe){const ze=Se.id;if(ze==null)continue;let De=this.features.get(ze);De&&this.updateCache(De,de),Se.geometry?(De=qe(Se),this.updateCache(De,de),this.features.set(ze,De)):this.features.delete(ze),this.updateCache(De,de)}}updateCache(oe,de){for(const{canonical:Se,uid:ze}of Object.values(de)){const{z:De,x:Oe,y:rt}=Se;lt(oe,Math.pow(2,De),Oe,rt)&&delete de[ze]}}getTile(oe,de,Se){const ze=Math.pow(2,oe),De=[];for(const Oe of this.features.values())lt(Oe,ze,de,Se)&&De.push(St(Oe,ze,de,Se));return{features:De}}getFeatures(){return[...this.features.values()]}}function lt({minX:$e,minY:oe,maxX:de,maxY:Se},ze,De,Oe){return $e<(De+1+Ze)/ze&&oe<(Oe+1+Ze)/ze&&de>(De-Ze)/ze&&Se>(Oe-Ze)/ze}function qe($e){const{id:oe,geometry:de,properties:Se}=$e;if(!de)return;if(de.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ze,coordinates:De}=de,Oe={id:oe,type:1,geometry:[],tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=Oe.geometry;if(ze==="Point")en(De,rt,Oe);else if(ze==="MultiPoint")for(const Ve of De)en(Ve,rt,Oe);else if(ze==="LineString")Oe.type=2,Jt(De,rt,Oe);else if(ze==="MultiLineString")Oe.type=2,Nt(De,rt,Oe);else if(ze==="Polygon")Oe.type=3,Nt(De,rt,Oe,!0);else{if(ze!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Oe.type=3;for(const Ve of De)Nt(Ve,rt,Oe,!0)}return Oe}function en([$e,oe],de,Se){const ze=i.aF($e);let De=i.aJ(oe);De=De<0?0:De>1?1:De,de.push(ze,De),Se.minX=Math.min(Se.minX,ze),Se.minY=Math.min(Se.minY,De),Se.maxX=Math.max(Se.maxX,ze),Se.maxY=Math.max(Se.maxY,De)}function Jt($e,oe,de,Se=!1,ze=!1){const De=[];for(const Oe of $e)en(Oe,De,de);oe.push(De),Se&&(function(Oe,rt){let Ve=0;for(let ot=0,jt=Oe.length,_t=jt-2;ot<jt;_t=ot,ot+=2)Ve+=(Oe[ot]-Oe[_t])*(Oe[ot+1]+Oe[_t+1]);if(Ve>0===rt)for(let ot=0,jt=Oe.length;ot<jt/2;ot+=2){const _t=Oe[ot],gn=Oe[ot+1];Oe[ot]=Oe[jt-2-ot],Oe[ot+1]=Oe[jt-1-ot],Oe[jt-2-ot]=_t,Oe[jt-1-ot]=gn}})(De,ze)}function Nt($e,oe,de,Se=!1){for(let ze=0;ze<$e.length;ze++)Jt($e[ze],oe,de,Se,ze===0)}function St($e,oe,de,Se){const{id:ze,type:De,geometry:Oe,tags:rt}=$e,Ve=[];if(De===1)(function(ot,jt,_t,gn,Rn){for(let Fn=0;Fn<ot.length;Fn+=2){const gr=Math.round(i.al*(ot[Fn+0]*jt-_t)),or=Math.round(i.al*(ot[Fn+1]*jt-gn));Rn.push([gr,or])}})(Oe,oe,de,Se,Ve);else for(const ot of Oe)an(ot,oe,de,Se,Ve);return{id:ze,type:De,geometry:Ve,tags:rt}}function an($e,oe,de,Se,ze){const De=-Ge,Oe=i.al+Ge;let rt;for(let Ve=0;Ve<$e.length-2;Ve+=2){let ot=Math.round(i.al*($e[Ve+0]*oe-de)),jt=Math.round(i.al*($e[Ve+1]*oe-Se)),_t=Math.round(i.al*($e[Ve+2]*oe-de)),gn=Math.round(i.al*($e[Ve+3]*oe-Se));const Rn=_t-ot,Fn=gn-jt;ot<De&&_t<De||(ot<De?(jt+=Math.round(Fn*((De-ot)/Rn)),ot=De):_t<De&&(gn=jt+Math.round(Fn*((De-ot)/Rn)),_t=De),jt<De&&gn<De||(jt<De?(ot+=Math.round(Rn*((De-jt)/Fn)),jt=De):gn<De&&(_t=ot+Math.round(Rn*((De-jt)/Fn)),gn=De),ot>=Oe&&_t>=Oe||(ot>=Oe?(jt+=Math.round(Fn*((Oe-ot)/Rn)),ot=Oe):_t>=Oe&&(gn=jt+Math.round(Fn*((Oe-ot)/Rn)),_t=Oe),jt>=Oe&&gn>=Oe||(jt>=Oe?(ot+=Math.round(Rn*((Oe-jt)/Fn)),jt=Oe):gn>=Oe&&(_t=ot+Math.round(Rn*((Oe-jt)/Fn)),gn=Oe),rt&&ot===rt[rt.length-1][0]&&jt===rt[rt.length-1][1]||(rt=[[ot,jt]],ze.push(rt)),rt.push([_t,gn])))))}}function Kt({name:$e,features:oe},de){de.writeStringField(1,$e),de.writeVarintField(5,i.al);const Se=new Map,ze=new Map,De={keys:Se,values:ze,feature:null};for(const Oe of oe)De.feature=Oe,de.writeMessage(2,hn,De);for(const Oe of Se.keys())de.writeStringField(3,Oe);for(const Oe of ze.keys())de.writeMessage(4,$n,Oe)}function hn($e,oe){const de=$e.feature;de.id!==void 0&&Number.isSafeInteger(+de.id)&&oe.writeVarintField(1,+de.id),de.tags&&oe.writeMessage(2,Xt,$e),oe.writeVarintField(3,de.type),oe.writeMessage(4,Zn,de)}function Xt({keys:$e,values:oe,feature:de},Se){for(const ze of Object.keys(de.tags)){let De=de.tags[ze];if(De===null)continue;let Oe=$e.get(ze);Oe===void 0&&(Oe=$e.size,$e.set(ze,Oe)),Se.writeVarint(Oe);const rt=typeof De;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(De=JSON.stringify(De));let Ve=oe.get(De);Ve===void 0&&(Ve=oe.size,oe.set(De,Ve)),Se.writeVarint(Ve)}}function et($e,oe){return(oe<<3)+(7&$e)}function zt($e){return $e<<1^$e>>31}function Zn($e,oe){const{geometry:de,type:Se}=$e;let ze=0,De=0;if(Se===1){oe.writeVarint(et(1,de.length));for(const Oe of de){const rt=Oe[0]-ze,Ve=Oe[1]-De;oe.writeVarint(zt(rt)),oe.writeVarint(zt(Ve)),ze+=rt,De+=Ve}}else for(const Oe of de){oe.writeVarint(et(1,1));const rt=Oe.length-(Se===3?1:0);for(let Ve=0;Ve<rt;Ve++){Ve===1&&oe.writeVarint(et(2,rt-1));const ot=Oe[Ve][0]-ze,jt=Oe[Ve][1]-De;oe.writeVarint(zt(ot)),oe.writeVarint(zt(jt)),ze+=ot,De+=jt}Se===3&&oe.writeVarint(et(7,1))}}function $n($e,oe){const de=typeof $e;de==="string"?oe.writeStringField(1,$e):de==="boolean"?oe.writeBooleanField(7,$e):de==="number"&&($e%1!=0?oe.writeDoubleField(3,$e):$e<0?oe.writeSVarintField(6,$e):oe.writeVarintField(5,$e))}const fr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$e=>$e},kn=Math.fround||(Bt=new Float32Array(1),$e=>(Bt[0]=+$e,Bt[0]));var Bt;const En=3,Tt=5,wn=6;class mr{constructor(oe){this.options=Object.assign(Object.create(fr),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:de,minZoom:Se,maxZoom:ze}=this.options;de&&console.time("total time");const De=`prepare ${oe.length} points`;de&&console.time(De),this.points=oe;const Oe=[];for(let Ve=0;Ve<oe.length;Ve++){const ot=oe[Ve];if(!ot.geometry)continue;const[jt,_t]=ot.geometry.coordinates,gn=kn(Hn(jt)),Rn=kn(nr(_t));Oe.push(gn,Rn,1/0,Ve,-1,1),this.options.reduce&&Oe.push(0)}let rt=this.trees[ze+1]=this._createTree(Oe);de&&console.timeEnd(De);for(let Ve=ze;Ve>=Se;Ve--){const ot=+Date.now();rt=this.trees[Ve]=this._createTree(this._cluster(rt,Ve)),de&&console.log("z%d: %d clusters in %dms",Ve,rt.numItems,+Date.now()-ot)}return de&&console.timeEnd("total time"),this}getClusters(oe,de){let Se=((oe[0]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,oe[1]));let De=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)Se=-180,De=180;else if(Se>De){const _t=this.getClusters([Se,ze,180,Oe],de),gn=this.getClusters([-180,ze,De,Oe],de);return _t.concat(gn)}const rt=this.trees[this._limitZoom(de)],Ve=rt.range(Hn(Se),nr(Oe),Hn(De),nr(ze)),ot=rt.data,jt=[];for(const _t of Ve){const gn=this.stride*_t;jt.push(ot[gn+Tt]>1?tn(ot,gn,this.clusterProps):this.points[ot[gn+En]])}return jt}getChildren(oe){const de=this._getOriginId(oe),Se=this._getOriginZoom(oe),ze="No cluster with the specified id.",De=this.trees[Se];if(!De)throw new Error(ze);const Oe=De.data;if(de*this.stride>=Oe.length)throw new Error(ze);const rt=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),Ve=De.within(Oe[de*this.stride],Oe[de*this.stride+1],rt),ot=[];for(const jt of Ve){const _t=jt*this.stride;Oe[_t+4]===oe&&ot.push(Oe[_t+Tt]>1?tn(Oe,_t,this.clusterProps):this.points[Oe[_t+En]])}if(ot.length===0)throw new Error(ze);return ot}getLeaves(oe,de,Se){const ze=[];return this._appendLeaves(ze,oe,de=de||10,Se=Se||0,0),ze}getTile(oe,de,Se){const ze=this.trees[this._limitZoom(oe)],De=Math.pow(2,oe),{extent:Oe,radius:rt}=this.options,Ve=rt/Oe,ot=(Se-Ve)/De,jt=(Se+1+Ve)/De,_t={features:[]};return this._addTileFeatures(ze.range((de-Ve)/De,ot,(de+1+Ve)/De,jt),ze.data,de,Se,De,_t),de===0&&this._addTileFeatures(ze.range(1-Ve/De,ot,1,jt),ze.data,De,Se,De,_t),de===De-1&&this._addTileFeatures(ze.range(0,ot,Ve/De,jt),ze.data,-1,Se,De,_t),_t.features.length?_t:null}getClusterExpansionZoom(oe){let de=this._getOriginZoom(oe)-1;for(;de<=this.options.maxZoom;){const Se=this.getChildren(oe);if(de++,Se.length!==1)break;oe=Se[0].properties.cluster_id}return de}_appendLeaves(oe,de,Se,ze,De){const Oe=this.getChildren(de);for(const rt of Oe){const Ve=rt.properties;if(Ve&&Ve.cluster?De+Ve.point_count<=ze?De+=Ve.point_count:De=this._appendLeaves(oe,Ve.cluster_id,Se,ze,De):De<ze?De++:oe.push(rt),oe.length===Se)break}return De}_createTree(oe){const de=new i.c3(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<oe.length;Se+=this.stride)de.add(oe[Se],oe[Se+1]);return de.finish(),de.data=oe,de}_addTileFeatures(oe,de,Se,ze,De,Oe){for(const rt of oe){const Ve=rt*this.stride,ot=de[Ve+Tt]>1;let jt,_t,gn;if(ot)jt=Ii(de,Ve,this.clusterProps),_t=de[Ve],gn=de[Ve+1];else{const gr=this.points[de[Ve+En]];jt=gr.properties;const[or,xr]=gr.geometry.coordinates;_t=Hn(or),gn=nr(xr)}const Rn={type:1,geometry:[[Math.round(this.options.extent*(_t*De-Se)),Math.round(this.options.extent*(gn*De-ze))]],tags:jt};let Fn;Fn=ot||this.options.generateId?de[Ve+En]:this.points[de[Ve+En]].id,Fn!==void 0&&(Rn.id=Fn),Oe.features.push(Rn)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,de){const{radius:Se,extent:ze,reduce:De,minPoints:Oe}=this.options,rt=Se/(ze*Math.pow(2,de)),Ve=oe.data,ot=[],jt=this.stride;for(let _t=0;_t<Ve.length;_t+=jt){if(Ve[_t+2]<=de)continue;Ve[_t+2]=de;const gn=Ve[_t],Rn=Ve[_t+1],Fn=oe.within(Ve[_t],Ve[_t+1],rt),gr=Ve[_t+Tt];let or=gr;for(const xr of Fn){const Xr=xr*jt;Ve[Xr+2]>de&&(or+=Ve[Xr+Tt])}if(or>gr&&or>=Oe){let xr,Xr=gn*gr,_r=Rn*gr,zi=-1;const Ur=(_t/jt<<5)+(de+1)+this.points.length;for(const ts of Fn){const $r=ts*jt;if(Ve[$r+2]<=de)continue;Ve[$r+2]=de;const Or=Ve[$r+Tt];Xr+=Ve[$r]*Or,_r+=Ve[$r+1]*Or,Ve[$r+4]=Ur,De&&(xr||(xr=this._map(Ve,_t,!0),zi=this.clusterProps.length,this.clusterProps.push(xr)),De(xr,this._map(Ve,$r)))}Ve[_t+4]=Ur,ot.push(Xr/or,_r/or,1/0,Ur,-1,or),De&&ot.push(zi)}else{for(let xr=0;xr<jt;xr++)ot.push(Ve[_t+xr]);if(or>1)for(const xr of Fn){const Xr=xr*jt;if(!(Ve[Xr+2]<=de)){Ve[Xr+2]=de;for(let _r=0;_r<jt;_r++)ot.push(Ve[Xr+_r])}}}}return ot}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,de,Se){if(oe[de+Tt]>1){const Oe=this.clusterProps[oe[de+wn]];return Se?Object.assign({},Oe):Oe}const ze=this.points[oe[de+En]].properties,De=this.options.map(ze);return Se&&De===ze?Object.assign({},De):De}}function tn($e,oe,de){return{type:"Feature",id:$e[oe+En],properties:Ii($e,oe,de),geometry:{type:"Point",coordinates:[(Se=$e[oe],360*(Se-.5)),Mi($e[oe+1])]}};var Se}function Ii($e,oe,de){const Se=$e[oe+Tt],ze=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,De=$e[oe+wn],Oe=De===-1?{}:Object.assign({},de[De]);return Object.assign(Oe,{cluster:!0,cluster_id:$e[oe+En],point_count:Se,point_count_abbreviated:ze})}function Hn($e){return $e/360+.5}function nr($e){const oe=Math.sin($e*Math.PI/180),de=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return de<0?0:de>1?1:de}function Mi($e){const oe=(180-360*$e)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Sn($e,oe,de,Se){let ze=Se;const De=oe+(de-oe>>1);let Oe,rt=de-oe;const Ve=$e[oe],ot=$e[oe+1],jt=$e[de],_t=$e[de+1];for(let gn=oe+3;gn<de;gn+=3){const Rn=si($e[gn],$e[gn+1],Ve,ot,jt,_t);if(Rn>ze)Oe=gn,ze=Rn;else if(Rn===ze){const Fn=Math.abs(gn-De);Fn<rt&&(Oe=gn,rt=Fn)}}ze>Se&&(Oe-oe>3&&Sn($e,oe,Oe,Se),$e[Oe+2]=ze,de-Oe>3&&Sn($e,Oe,de,Se))}function si($e,oe,de,Se,ze,De){let Oe=ze-de,rt=De-Se;if(Oe!==0||rt!==0){const Ve=(($e-de)*Oe+(oe-Se)*rt)/(Oe*Oe+rt*rt);Ve>1?(de=ze,Se=De):Ve>0&&(de+=Oe*Ve,Se+=rt*Ve)}return Oe=$e-de,rt=oe-Se,Oe*Oe+rt*rt}function Fi($e,oe,de,Se){const ze={id:$e??null,type:oe,geometry:de,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")js(ze,de);else if(oe==="Polygon")js(ze,de[0]);else if(oe==="MultiLineString")for(const De of de)js(ze,De);else if(oe==="MultiPolygon")for(const De of de)js(ze,De[0]);return ze}function js($e,oe){for(let de=0;de<oe.length;de+=3)$e.minX=Math.min($e.minX,oe[de]),$e.minY=Math.min($e.minY,oe[de+1]),$e.maxX=Math.max($e.maxX,oe[de]),$e.maxY=Math.max($e.maxY,oe[de+1])}function us($e,oe,de,Se){if(!oe.geometry)return;const ze=oe.geometry.coordinates;if(ze&&ze.length===0)return;const De=oe.geometry.type,Oe=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let rt=[],Ve=oe.id;if(de.promoteId?Ve=oe.properties[de.promoteId]:de.generateId&&(Ve=Se||0),De==="Point")ha(ze,rt);else if(De==="MultiPoint")for(const ot of ze)ha(ot,rt);else if(De==="LineString")ja(ze,rt,Oe,!1);else if(De==="MultiLineString"){if(de.lineMetrics){for(const ot of ze)rt=[],ja(ot,rt,Oe,!1),$e.push(Fi(Ve,"LineString",rt,oe.properties));return}za(ze,rt,Oe,!1)}else if(De==="Polygon")za(ze,rt,Oe,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(const ot of oe.geometry.geometries)us($e,{id:Ve,geometry:ot,properties:oe.properties},de,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ot of ze){const jt=[];za(ot,jt,Oe,!0),rt.push(jt)}}$e.push(Fi(Ve,De,rt,oe.properties))}function ha($e,oe){oe.push(Na($e[0]),Es($e[1]),0)}function ja($e,oe,de,Se){let ze,De,Oe=0;for(let Ve=0;Ve<$e.length;Ve++){const ot=Na($e[Ve][0]),jt=Es($e[Ve][1]);oe.push(ot,jt,0),Ve>0&&(Oe+=Se?(ze*jt-ot*De)/2:Math.sqrt(Math.pow(ot-ze,2)+Math.pow(jt-De,2))),ze=ot,De=jt}const rt=oe.length-3;oe[2]=1,Sn(oe,0,rt,de),oe[rt+2]=1,oe.size=Math.abs(Oe),oe.start=0,oe.end=oe.size}function za($e,oe,de,Se){for(let ze=0;ze<$e.length;ze++){const De=[];ja($e[ze],De,de,Se),oe.push(De)}}function Na($e){return $e/360+.5}function Es($e){const oe=Math.sin($e*Math.PI/180),de=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return de<0?0:de>1?1:de}function zs($e,oe,de,Se,ze,De,Oe,rt){if(Se/=oe,De>=(de/=oe)&&Oe<Se)return $e;if(Oe<de||De>=Se)return null;const Ve=[];for(const ot of $e){const jt=ot.geometry;let _t=ot.type;const gn=ze===0?ot.minX:ot.minY,Rn=ze===0?ot.maxX:ot.maxY;if(gn>=de&&Rn<Se){Ve.push(ot);continue}if(Rn<de||gn>=Se)continue;let Fn=[];if(_t==="Point"||_t==="MultiPoint")fl(jt,Fn,de,Se,ze);else if(_t==="LineString")Fa(jt,Fn,de,Se,ze,!1,rt.lineMetrics);else if(_t==="MultiLineString")os(jt,Fn,de,Se,ze,!1);else if(_t==="Polygon")os(jt,Fn,de,Se,ze,!0);else if(_t==="MultiPolygon")for(const gr of jt){const or=[];os(gr,or,de,Se,ze,!0),or.length&&Fn.push(or)}if(Fn.length){if(rt.lineMetrics&&_t==="LineString"){for(const gr of Fn)Ve.push(Fi(ot.id,_t,gr,ot.tags));continue}_t!=="LineString"&&_t!=="MultiLineString"||(Fn.length===1?(_t="LineString",Fn=Fn[0]):_t="MultiLineString"),_t!=="Point"&&_t!=="MultiPoint"||(_t=Fn.length===3?"Point":"MultiPoint"),Ve.push(Fi(ot.id,_t,Fn,ot.tags))}}return Ve.length?Ve:null}function fl($e,oe,de,Se,ze){for(let De=0;De<$e.length;De+=3){const Oe=$e[De+ze];Oe>=de&&Oe<=Se&&pl(oe,$e[De],$e[De+1],$e[De+2])}}function Fa($e,oe,de,Se,ze,De,Oe){let rt=no($e);const Ve=ze===0?$h:ac;let ot,jt,_t=$e.start;for(let or=0;or<$e.length-3;or+=3){const xr=$e[or],Xr=$e[or+1],_r=$e[or+2],zi=$e[or+3],Ur=$e[or+4],ts=ze===0?xr:Xr,$r=ze===0?zi:Ur;let Or=!1;Oe&&(ot=Math.sqrt(Math.pow(xr-zi,2)+Math.pow(Xr-Ur,2))),ts<de?$r>de&&(jt=Ve(rt,xr,Xr,zi,Ur,de),Oe&&(rt.start=_t+ot*jt)):ts>Se?$r<Se&&(jt=Ve(rt,xr,Xr,zi,Ur,Se),Oe&&(rt.start=_t+ot*jt)):pl(rt,xr,Xr,_r),$r<de&&ts>=de&&(jt=Ve(rt,xr,Xr,zi,Ur,de),Or=!0),$r>Se&&ts<=Se&&(jt=Ve(rt,xr,Xr,zi,Ur,Se),Or=!0),!De&&Or&&(Oe&&(rt.end=_t+ot*jt),oe.push(rt),rt=no($e)),Oe&&(_t+=ot)}let gn=$e.length-3;const Rn=$e[gn],Fn=$e[gn+1],gr=ze===0?Rn:Fn;gr>=de&&gr<=Se&&pl(rt,Rn,Fn,$e[gn+2]),gn=rt.length-3,De&&gn>=3&&(rt[gn]!==rt[0]||rt[gn+1]!==rt[1])&&pl(rt,rt[0],rt[1],rt[2]),rt.length&&oe.push(rt)}function no($e){const oe=[];return oe.size=$e.size,oe.start=$e.start,oe.end=$e.end,oe}function os($e,oe,de,Se,ze,De){for(const Oe of $e)Fa(Oe,oe,de,Se,ze,De,!1)}function pl($e,oe,de,Se){$e.push(oe,de,Se)}function $h($e,oe,de,Se,ze,De){const Oe=(De-oe)/(Se-oe);return pl($e,De,de+(ze-de)*Oe,1),Oe}function ac($e,oe,de,Se,ze,De){const Oe=(De-de)/(ze-de);return pl($e,oe+(Se-oe)*Oe,De,1),Oe}function Ol($e,oe){const de=[];for(let Se=0;Se<$e.length;Se++){const ze=$e[Se],De=ze.type;let Oe;if(De==="Point"||De==="MultiPoint"||De==="LineString")Oe=ml(ze.geometry,oe);else if(De==="MultiLineString"||De==="Polygon"){Oe=[];for(const rt of ze.geometry)Oe.push(ml(rt,oe))}else if(De==="MultiPolygon"){Oe=[];for(const rt of ze.geometry){const Ve=[];for(const ot of rt)Ve.push(ml(ot,oe));Oe.push(Ve)}}de.push(Fi(ze.id,De,Oe,ze.tags))}return de}function ml($e,oe){const de=[];de.size=$e.size,$e.start!==void 0&&(de.start=$e.start,de.end=$e.end);for(let Se=0;Se<$e.length;Se+=3)de.push($e[Se]+oe,$e[Se+1],$e[Se+2]);return de}function lc($e,oe){if($e.transformed)return $e;const de=1<<$e.z,Se=$e.x,ze=$e.y;for(const De of $e.features){const Oe=De.geometry,rt=De.type;if(De.geometry=[],rt===1)for(let Ve=0;Ve<Oe.length;Ve+=2)De.geometry.push(vi(Oe[Ve],Oe[Ve+1],oe,de,Se,ze));else for(let Ve=0;Ve<Oe.length;Ve++){const ot=[];for(let jt=0;jt<Oe[Ve].length;jt+=2)ot.push(vi(Oe[Ve][jt],Oe[Ve][jt+1],oe,de,Se,ze));De.geometry.push(ot)}}return $e.transformed=!0,$e}function vi($e,oe,de,Se,ze,De){return[Math.round(de*($e*Se-ze)),Math.round(de*(oe*Se-De))]}function hs($e,oe,de,Se,ze){const De=oe===ze.maxZoom?0:ze.tolerance/((1<<oe)*ze.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:$e.length,source:null,x:de,y:Se,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of $e)ku(Oe,rt,De,ze);return Oe}function ku($e,oe,de,Se){const ze=oe.geometry,De=oe.type,Oe=[];if($e.minX=Math.min($e.minX,oe.minX),$e.minY=Math.min($e.minY,oe.minY),$e.maxX=Math.max($e.maxX,oe.maxX),$e.maxY=Math.max($e.maxY,oe.maxY),De==="Point"||De==="MultiPoint")for(let rt=0;rt<ze.length;rt+=3)Oe.push(ze[rt],ze[rt+1]),$e.numPoints++,$e.numSimplified++;else if(De==="LineString")Ba(Oe,ze,$e,de,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(let rt=0;rt<ze.length;rt++)Ba(Oe,ze[rt],$e,de,De==="Polygon",rt===0);else if(De==="MultiPolygon")for(let rt=0;rt<ze.length;rt++){const Ve=ze[rt];for(let ot=0;ot<Ve.length;ot++)Ba(Oe,Ve[ot],$e,de,!0,ot===0)}if(Oe.length){let rt=oe.tags||null;if(De==="LineString"&&Se.lineMetrics){rt={};for(const ot in oe.tags)rt[ot]=oe.tags[ot];rt.mapbox_clip_start=ze.start/ze.size,rt.mapbox_clip_end=ze.end/ze.size}const Ve={geometry:Oe,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:rt};oe.id!==null&&(Ve.id=oe.id),$e.features.push(Ve)}}function Ba($e,oe,de,Se,ze,De){const Oe=Se*Se;if(Se>0&&oe.size<(ze?Oe:Se))return void(de.numPoints+=oe.length/3);const rt=[];for(let Ve=0;Ve<oe.length;Ve+=3)(Se===0||oe[Ve+2]>Oe)&&(de.numSimplified++,rt.push(oe[Ve],oe[Ve+1])),de.numPoints++;ze&&(function(Ve,ot){let jt=0;for(let _t=0,gn=Ve.length,Rn=gn-2;_t<gn;Rn=_t,_t+=2)jt+=(Ve[_t]-Ve[Rn])*(Ve[_t+1]+Ve[Rn+1]);if(jt>0===ot)for(let _t=0,gn=Ve.length;_t<gn/2;_t+=2){const Rn=Ve[_t],Fn=Ve[_t+1];Ve[_t]=Ve[gn-2-_t],Ve[_t+1]=Ve[gn-1-_t],Ve[gn-2-_t]=Rn,Ve[gn-1-_t]=Fn}})(rt,De),$e.push(rt)}const _o={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Hh{constructor(oe,de){const Se=(de=this.options=(function(De,Oe){for(const rt in Oe)De[rt]=Oe[rt];return De})(Object.create(_o),de)).debug;if(Se&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let ze=(function(De,Oe){const rt=[];if(De.type==="FeatureCollection")for(let Ve=0;Ve<De.features.length;Ve++)us(rt,De.features[Ve],Oe,Ve);else us(rt,De.type==="Feature"?De:{geometry:De},Oe);return rt})(oe,de);this.tiles={},this.tileCoords=[],Se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=(function(De,Oe){const rt=Oe.buffer/Oe.extent;let Ve=De;const ot=zs(De,1,-1-rt,rt,0,-1,2,Oe),jt=zs(De,1,1-rt,2+rt,0,-1,2,Oe);return(ot||jt)&&(Ve=zs(De,1,-rt,1+rt,0,-1,2,Oe)||[],ot&&(Ve=Ol(ot,1).concat(Ve)),jt&&(Ve=Ve.concat(Ol(jt,-1)))),Ve})(ze,de),ze.length&&this.splitTile(ze,0,0,0),Se&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,de,Se,ze,De,Oe,rt){const Ve=[oe,de,Se,ze],ot=this.options,jt=ot.debug;for(;Ve.length;){ze=Ve.pop(),Se=Ve.pop(),de=Ve.pop(),oe=Ve.pop();const _t=1<<de,gn=Gh(de,Se,ze);let Rn=this.tiles[gn];if(!Rn&&(jt>1&&console.time("creation"),Rn=this.tiles[gn]=hs(oe,de,Se,ze,ot),this.tileCoords.push({z:de,x:Se,y:ze}),jt)){jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,Se,ze,Rn.numFeatures,Rn.numPoints,Rn.numSimplified),console.timeEnd("creation"));const Or=`z${de}`;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(Rn.source=oe,De==null){if(de===ot.indexMaxZoom||Rn.numPoints<=ot.indexMaxPoints)continue}else{if(de===ot.maxZoom||de===De)continue;if(De!=null){const Or=De-de;if(Se!==Oe>>Or||ze!==rt>>Or)continue}}if(Rn.source=null,oe.length===0)continue;jt>1&&console.time("clipping");const Fn=.5*ot.buffer/ot.extent,gr=.5-Fn,or=.5+Fn,xr=1+Fn;let Xr=null,_r=null,zi=null,Ur=null,ts=zs(oe,_t,Se-Fn,Se+or,0,Rn.minX,Rn.maxX,ot),$r=zs(oe,_t,Se+gr,Se+xr,0,Rn.minX,Rn.maxX,ot);oe=null,ts&&(Xr=zs(ts,_t,ze-Fn,ze+or,1,Rn.minY,Rn.maxY,ot),_r=zs(ts,_t,ze+gr,ze+xr,1,Rn.minY,Rn.maxY,ot),ts=null),$r&&(zi=zs($r,_t,ze-Fn,ze+or,1,Rn.minY,Rn.maxY,ot),Ur=zs($r,_t,ze+gr,ze+xr,1,Rn.minY,Rn.maxY,ot),$r=null),jt>1&&console.timeEnd("clipping"),Ve.push(Xr||[],de+1,2*Se,2*ze),Ve.push(_r||[],de+1,2*Se,2*ze+1),Ve.push(zi||[],de+1,2*Se+1,2*ze),Ve.push(Ur||[],de+1,2*Se+1,2*ze+1)}}getTile(oe,de,Se){oe=+oe,de=+de,Se=+Se;const ze=this.options,{extent:De,debug:Oe}=ze;if(oe<0||oe>24)return null;const rt=1<<oe,Ve=Gh(oe,de=de+rt&rt-1,Se);if(this.tiles[Ve])return lc(this.tiles[Ve],De);Oe>1&&console.log("drilling down to z%d-%d-%d",oe,de,Se);let ot,jt=oe,_t=de,gn=Se;for(;!ot&&jt>0;)jt--,_t>>=1,gn>>=1,ot=this.tiles[Gh(jt,_t,gn)];return ot&&ot.source?(Oe>1&&(console.log("found parent tile z%d-%d-%d",jt,_t,gn),console.time("drilling down")),this.splitTile(ot.source,jt,_t,gn,oe,de,Se),Oe>1&&console.timeEnd("drilling down"),this.tiles[Ve]?lc(this.tiles[Ve],De):null):null}}function Gh($e,oe,de){return 32*((1<<$e)*de+oe)+$e}function Wd($e,oe){const de=$e.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const Se=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Se)return void oe(null,null);const ze=ot=>ot.tags&&"3d_elevation_id"in ot.tags&&"source"in ot.tags&&ot.tags.source==="elevation",De=Se.features.filter((ot=>ze(ot)));let Oe={_geojsonTileLayer:Se.features};De.length>0&&(Oe={_geojsonTileLayer:Se.features.filter((ot=>!ze(ot))),hd_road_elevation:De});const rt=new Le(Oe),Ve=(function(ot){const jt=new i.bt;for(const _t of Object.keys(ot))jt.writeMessage(3,Kt,{name:_t,features:ot[_t]});return jt.finish()})(Oe).buffer;oe(null,{vectorTile:rt,rawData:Ve})}class It extends X{constructor(oe,de,Se,ze,De,Oe,rt){super(oe,de,Se,ze,De,Wd,rt),Oe&&(this.loadGeoJSON=Oe),this._dynamicIndex=new gt}loadData(oe,de){const Se=oe&&oe.request,ze=Se&&Se.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(oe,((De,Oe)=>{if(De||!Oe)return de(De);if(typeof Oe!="object")return de(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const Ve=i.U(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map((ot=>`${ot.key}: ${ot.message}`)).join(", "));Oe.features=Oe.features.filter((ot=>Ve.value.evaluate({zoom:0},ot)))}oe.dynamic?(Oe.type==="Feature"&&(Oe={type:"FeatureCollection",features:[Oe]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Oe.features,this.loaded),oe.cluster&&(Oe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new mr((function({superclusterOptions:Ve,clusterProperties:ot}){if(!ot||!Ve)return Ve;const jt={},_t={},gn={accumulated:null,zoom:0},Rn={properties:null},Fn=Object.keys(ot);for(const gr of Fn){const[or,xr]=ot[gr],Xr=i.U(xr),_r=i.U(typeof or=="string"?[or,["accumulated"],["get",gr]]:or);jt[gr]=Xr.value,_t[gr]=_r.value}return Ve.map=gr=>{Rn.properties=gr;const or={};for(const xr of Fn)or[xr]=jt[xr].evaluate(gn,Rn);return or},Ve.reduce=(gr,or)=>{Rn.properties=or;for(const xr of Fn)gn.accumulated=gr[xr],gr[xr]=_t[xr].evaluate(gn,Rn)},Ve})(oe)).load(Oe.features):oe.dynamic?this._dynamicIndex:(function(Ve,ot){return new Hh(Ve,ot)})(Oe,oe.geojsonVtOptions)}catch(Ve){return de(Ve)}const rt={};if(ze){const Ve=E(Se);Ve&&(rt.resourceTiming={},rt.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ve)))}de(null,rt)}}))}reloadTile(oe,de){const Se=this.loaded;return Se&&Se[oe.uid]?oe.partial?de(null,void 0):super.reloadTile(oe,de):this.loadTile(oe,de)}loadGeoJSON(oe,de){if(oe.request)i.m(oe.request,de);else{if(typeof oe.data!="string")return de(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return de(null,JSON.parse(oe.data))}catch{return de(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(oe,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Se){de(Se)}}getClusterChildren(oe,de){try{de(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Se){de(Se)}}getClusterLeaves(oe,de){try{de(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Se){de(Se)}}}class Dl{constructor(oe,de,Se){this.tileID=new i.aO(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=de,this.worldview=Se}parse(oe,de,Se,ze){this.status="parsing";const De=new i.aO(Se.tileID.overscaledZ,Se.tileID.wrap,Se.tileID.canonical.z,Se.tileID.canonical.x,Se.tileID.canonical.y),Oe=[],rt=de.familiesBySource[Se.source],Ve=new i.fe(De,Se.promoteId);Ve.bucketLayerIDs=[],Ve.is3DTile=!0,i.ft(oe).then((ot=>{if(!ot)return ze(new Error("Could not parse tile"));const jt=ot.json.extensionsUsed&&ot.json.extensionsUsed.includes("MAPBOX_mesh_features")||ot.json.asset.extras&&ot.json.asset.extras.MAPBOX_mesh_features,_t=ot.json.extensionsUsed&&ot.json.extensionsUsed.includes("EXT_meshopt_compression"),gn=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Rn in rt)for(const Fn of rt[Rn]){const gr=Fn[0];Ve.bucketLayerIDs.push(Fn.map((Xr=>i.B(Xr.id,Xr.scope)))),gr.recalculate(gn,[]);const or=i.fu(ot,1/i.d6(Se.tileID.canonical)),xr=new i.fv(Fn,or,De,jt,_t,this.brightness,Ve,this.worldview);jt||(xr.needsUpload=!0),Oe.push(xr),xr.evaluate(gr)}this.status="done",ze(null,{buckets:Oe,featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((ot=>ze(new Error(ot.message))))}}class qd{constructor(oe,de,Se,ze,De,Oe,rt,Ve){this.actor=oe,this.layerIndex=de,this.availableImages=Se,this.availableModels=ze,this.brightness=rt,this.loading={},this.loaded={},this.worldview=Ve}loadTile(oe,de){const Se=oe.uid,ze=this.loading[Se]=new Dl(oe,this.brightness,this.worldview);i.bu(oe.request,((De,Oe)=>{const rt=!this.loading[Se];return delete this.loading[Se],rt||De?(ze.status="done",rt||(this.loaded[Se]=ze),de(De)):Oe&&Oe.byteLength!==0?void ze.parse(Oe,this.layerIndex,oe,((Ve,ot)=>{ze.status="done",this.loaded=this.loaded||{},this.loaded[Se]=ze,Ve||!ot?de(Ve):de(null,ot)})):(ze.status="done",this.loaded[Se]=ze,de())}))}reloadTile(oe,de){const Se=this.loaded,ze=oe.uid;if(Se&&Se[ze]){const De=Se[ze];De.projection=oe.projection,De.brightness=oe.brightness;const Oe=(rt,Ve)=>{De.reloadCallback&&(delete De.reloadCallback,this.loadTile(oe,de)),de(rt,Ve)};De.status==="parsing"?De.reloadCallback=Oe:De.status==="done"&&this.loadTile(oe,de)}}abortTile(oe,de){const Se=oe.uid;this.loading[Se]&&delete this.loading[Se],de()}removeTile(oe,de){const Se=this.loaded,ze=oe.uid;Se&&Se[ze]&&delete Se[ze],de()}}class Ru{constructor(oe){this.self=oe,this.actor=new i.fx(oe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:X,geojson:It,"raster-dem":re,"raster-array":ue,"batched-model":qd},this.workerSources={},this.self.registerWorkerSource=(de,Se)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=Se},this.self.registerRTLTextPlugin=de=>{if(i.fy.isParsed())throw new Error("RTL text plugin already registered.");i.fy.setState({pluginStatus:i.fz.parsed,pluginURL:i.fy.getPluginURL()}),i.fy.applyArabicShaping=de.applyArabicShaping,i.fy.processBidirectionalText=de.processBidirectionalText,i.fy.processStyledBidirectionalText=de.processStyledBidirectionalText;for(const Se of this.rtlPluginParsingListeners)Se(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(oe,de,Se){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.availableModels[oe],delete this.workerSources[oe],Se()}checkIfReady(oe,de,Se){Se()}setReferrer(oe,de){this.referrer=de}spriteLoaded(oe,de){this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={});const{scope:Se,isLoaded:ze}=de;if(this.isSpriteLoaded[oe][Se]=ze,this.workerSources[oe]&&this.workerSources[oe][Se])for(const De in this.workerSources[oe][Se]){const Oe=this.workerSources[oe][Se][De];for(const rt in Oe){const Ve=Oe[rt];Ve instanceof X&&(Ve.isSpriteLoaded=ze,Ve.fire(new i.z("isSpriteLoaded")))}}}setImages(oe,de,Se){this.availableImages[oe]||(this.availableImages[oe]={});const{scope:ze,images:De}=de;if(this.availableImages[oe][ze]=De,this.workerSources[oe]&&this.workerSources[oe][ze]){for(const Oe in this.workerSources[oe][ze]){const rt=this.workerSources[oe][ze][Oe];for(const Ve in rt)rt[Ve].availableImages=De}Se()}else Se()}setModels(oe,{scope:de,models:Se},ze){if(this.availableModels[oe]||(this.availableModels[oe]={}),this.availableModels[oe][de]=Se,this.workerSources[oe]&&this.workerSources[oe][de]){for(const De in this.workerSources[oe][de]){const Oe=this.workerSources[oe][de][De];for(const rt in Oe)Oe[rt].availableModels=Se}ze()}else ze()}setProjection(oe,de){this.projections[oe]=i.cl(de)}setBrightness(oe,de,Se){this.brightness=de,Se()}setWorldview(oe,de,Se){this.worldview=de,Se()}setLayers(oe,de,Se){this.getLayerIndex(oe,de.scope).replace(de.layers,de.options),Se()}updateLayers(oe,de,Se){this.getLayerIndex(oe,de.scope).update(de.layers,de.removedIds,de.options),Se()}loadTile(oe,de,Se){de.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,de.type,de.source,de.scope).loadTile(de,Se)}decodeRasterArray(oe,de,Se){this.getWorkerSource(oe,de.type,de.source,de.scope).decodeRasterArray(de,Se)}reloadTile(oe,de,Se){de.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,de.type,de.source,de.scope).reloadTile(de,Se)}abortTile(oe,de,Se){this.getWorkerSource(oe,de.type,de.source,de.scope).abortTile(de,Se)}removeTile(oe,de,Se){this.getWorkerSource(oe,de.type,de.source,de.scope).removeTile(de,Se)}removeSource(oe,de,Se){if(!(this.workerSources[oe]&&this.workerSources[oe][de.scope]&&this.workerSources[oe][de.scope][de.type]&&this.workerSources[oe][de.scope][de.type][de.source]))return;const ze=this.workerSources[oe][de.scope][de.type][de.source];delete this.workerSources[oe][de.scope][de.type][de.source],ze.removeSource!==void 0?ze.removeSource(de,Se):Se()}loadWorkerSource(oe,de,Se){try{this.self.importScripts(de.url),Se()}catch(ze){Se(ze.toString())}}syncRTLPluginState(oe,de,Se){if(i.fy.isParsed())Se(null,!0);else if(i.fy.isParsing())this.rtlPluginParsingListeners.push(Se);else try{i.fy.setState(de);const ze=i.fy.getPluginURL();!i.fy.isLoaded()||i.fy.isParsed()||i.fy.isParsing()||ze==null||(i.fy.setState({pluginStatus:i.fz.parsing,pluginURL:i.fy.getPluginURL()}),this.self.importScripts(ze),i.fy.isParsed()?Se(null,!0):this.rtlPluginParsingListeners.push(Se))}catch(ze){Se(ze.toString())}}setDracoUrl(oe,de){this.dracoUrl=de}getAvailableImages(oe,de){this.availableImages[oe]||(this.availableImages[oe]={});let Se=this.availableImages[oe][de];return Se||(Se=[]),Se}getAvailableModels(oe,de){this.availableModels[oe]||(this.availableModels[oe]={});let Se=this.availableModels[oe][de];return Se||(Se={}),Se}getLayerIndex(oe,de){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let Se=this.layerIndexes[oe][de];return Se||(Se=this.layerIndexes[oe][de]=new D,Se.scope=de),Se}getWorkerSource(oe,de,Se,ze){const De=this.workerSources;return De[oe]||(De[oe]={}),De[oe][ze]||(De[oe][ze]={}),De[oe][ze][de]||(De[oe][ze][de]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),De[oe][ze][de][Se]||(De[oe][ze][de][Se]=new this.workerSourceTypes[de]({send:(Oe,rt,Ve,ot,jt,_t)=>this.actor.send(Oe,rt,Ve,oe,jt,_t),scheduler:this.actor.scheduler},this.getLayerIndex(oe,ze),this.getAvailableImages(oe,ze),this.getAvailableModels(oe,ze),this.isSpriteLoaded[oe][ze],void 0,this.brightness,this.worldview)),De[oe][ze][de][Se]}rasterizeImagesWorker(oe,de,Se){const ze=new Map;for(const[De,{image:Oe,imageVariant:rt}]of de.tasks.entries()){const Ve=this.imageRasterizer.rasterize(rt,Oe,de.scope,oe);ze.set(De,Ve)}Se(void 0,ze)}removeRasterizedImages(oe,de,Se){this.imageRasterizer.removeImagesFromCacheByIds(de.imageIds,de.scope,oe),Se()}enforceCacheSizeLimit(oe,de){i.fA(de)}getWorkerPerformanceMetrics(oe,de,Se){Se(void 0,void 0)}}return i.fw(self)&&(self.worker=new Ru(self)),Ru})),d(["./shared"],(function(i){var E="3.15.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(m){performance.mark(m)},measure(m,s,c){performance.measure(m,s,c)}};function D(m){const s=m.name.split("?")[0];return i.a(s)&&s.includes("mapbox-gl.js")?"javascript":i.a(s)&&s.includes("mapbox-gl.css")?"css":i.b(s)?"fontRange":i.c(s)?"sprite":i.i(s)?"style":i.d(s)?"tilejson":"other"}var F,$={},Z=(function(){if(F)return $;function m(p){return!s(p)}function s(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,A,M=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(M);try{A=new Worker(O),w=!0}catch{w=!1}return A&&A.terminate(),URL.revokeObjectURL(O),w})()?(function(){var w=document.createElement("canvas");w.width=w.height=1;var A=w.getContext("2d");if(!A)return!1;var M=A.getImageData(0,0,1,1);return M&&M.width===w.width})()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=(function(w){var A,M=(function(O){var z=document.createElement("canvas"),B=Object.create(m.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=O,z.getContext("webgl2",B)})(w);if(!M)return!1;try{A=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!A||M.isContextLost())&&(M.shaderSource(A,"void main() {}"),M.compileShader(A),M.getShaderParameter(A,M.COMPILE_STATUS)===!0)})(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}F=1,$.supported=m,$.notSupportedReason=s;var c={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},$})();function q(m,s,c){const p=document.createElement(m);return s!=null&&(p.className=s),c&&c.appendChild(p),p}function X(m,s,c){const p=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(s))p.setAttributeNS(null,x,String(s[x]));return c&&c.appendChild(p),p}const re=typeof document<"u"?document.documentElement&&document.documentElement.style:null,le=re&&re.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function ye(){re&&le&&(ue=re[le],re[le]="none")}function ge(){re&&le&&(re[le]=ue)}function we(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",we,!0)}function Le(){window.addEventListener("click",we,!0),window.setTimeout((()=>{window.removeEventListener("click",we,!0)}),0)}function Ze(m,s){const c=m.getBoundingClientRect();return lt(m,c,s)}function Ge(m,s){const c=m.getBoundingClientRect(),p=[];for(let x=0;x<s.length;x++)p.push(lt(m,c,s[x]));return p}function gt(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function lt(m,s,c){const p=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new i.P((c.clientX-s.left)*p,(c.clientY-s.top)*p)}const qe="01",en="NO_ACCESS_TOKEN";class Jt{constructor(s,c,p){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const s=(function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qe,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!i.h(s))return s;const p=St(s);return p.params.push(`sdk=js-${E}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!i.h(s))return s;const p=St(s);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(s,c){if(!i.h(s))return s;const p=St(s);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(s,c,p,x){if(!i.h(s))return s;const w=St(s);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),p&&w.params.push(`language=${p}`),x&&w.params.push(`worldview=${x}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeIconsetURL(s,c){const p=St(s);return i.h(s)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):an(p)}normalizeSpriteURL(s,c,p,x){const w=St(s);return i.h(s)?(w.path=`/styles/v1${w.path}/sprite${c}${p}`,this._makeAPIURL(w,this._customAccessToken||x)):(w.path+=`${c}${p}`,an(w))}normalizeTileURL(s,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!i.h(s))return s;const x=St(s);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${i.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${i.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${i.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${i.e.TILE_URL_VERSION}${x.path}`);const w=this._customAccessToken||(function(A){for(const M of A){const O=M.match(/^access_token=(.*)$/);if(O)return O[1]}return null})(x.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,w)}canonicalizeTileURL(s,c){const p=St(s);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return s;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let w=p.params;return c&&(w=w.filter((A=>!A.match(/^access_token=/)))),w.length&&(x+=`?${w.join("&")}`),x}canonicalizeTileset(s,c){const p=!!c&&i.h(c),x=[];for(const w of s.tiles||[])i.j(w)?x.push(this.canonicalizeTileURL(w,p)):x.push(w);return x}_makeAPIURL(s,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=St(i.e.API_URL);if(s.protocol=x.protocol,s.authority=x.authority,s.protocol==="http"){const w=s.params.indexOf("secure");w>=0&&s.params.splice(w,1)}if(x.path!=="/"&&(s.path=`${x.path}${s.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return an(s);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return s.params=s.params.filter((w=>w.indexOf("access_token")===-1)),s.params.push(`access_token=${c||""}`),an(s)}}const Nt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function St(m){const s=m.match(Nt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function an(m){const s=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${s}`}const Kt="mapbox.eventData";function hn(m){if(!m)return null;const s=m.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(i.l(s[1]))}catch{return null}}class Xt{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=hn(i.e.ACCESS_TOKEN);let p="";return p=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",s?`${Kt}.${s}:${p}`:`${Kt}:${p}`}fetchEventData(){const s=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid");if(s)try{const x=localStorage.getItem(c);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(p);w&&(this.anonId=w)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const s=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.anonId;if(s&&x)try{localStorage.setItem(p,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,p,x){if(!i.e.EVENTS_URL)return;const w=St(i.e.EVENTS_URL);w.params.push(`access_token=${x||i.e.ACCESS_TOKEN||""}`);const A={event:this.type,created:new Date(s).toISOString()},M=c?Object.assign(A,c):A,O={url:an(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=i.p(O,(z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(x)}))}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}const et=new class extends Xt{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,s){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some((c=>i.h(c)||i.j(c)))&&this.queueRequest(Date.now(),s)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=hn(i.e.ACCESS_TOKEN),c=s?s.u:i.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),A=new Date(x),M=(x-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||w.getDate()!==A.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:qe,"enabled.telemetry":!1,userId:this.anonId},(w=>{w||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)}),m):this.processRequests()}},zt=et.postTurnstileEvent.bind(et),Zn=new class extends Xt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,s,c,p){this.skuToken=s,this.errorCb=p,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(en)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:qe,skuToken:this.skuToken,userId:this.anonId},(p=>{p?this.errorCb(p):s&&(this.success[s]=!0)}),m))}remove(){this.errorCb=null}},$n=Zn.postMapLoadEvent.bind(Zn),fr=new class extends Xt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let s=this.mapInstanceIdMap.get(m);return s||(s=i.u(),this.mapInstanceIdMap.set(m,s)),s}getEventId(m){const s=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,s+1),s}postStyleLoadEvent(m,s){const{map:c,style:p,importedStyles:x}=s;if(!i.e.EVENTS_URL||!m&&!i.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),A={mapInstanceId:w,eventId:this.getEventId(w),style:p};x.length&&(A.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:A},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,(()=>{}),m)}},kn=fr.postStyleLoadEvent.bind(fr),Bt=new class extends Xt{constructor(){super("gljs.performance")}postPerformanceEvent(m,s){i.e.EVENTS_URL&&(m||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:c}=this.queue.shift(),p=(function(x){const w=performance.getEntriesByType("resource"),A=performance.getEntriesByType("mark"),M=(function(Y){const J={};if(Y){for(const Q in Y)if(Q!=="other")for(const ce of Y[Q]){const ne=`${Q}ResolveRangeMin`,he=`${Q}ResolveRangeMax`,me=`${Q}RequestCount`,ve=`${Q}RequestCachedCount`;J[ne]=Math.min(J[ne]||1/0,ce.startTime),J[he]=Math.max(J[he]||-1/0,ce.responseEnd);const Pe=Ae=>{J[Ae]===void 0&&(J[Ae]=0),++J[Ae]};ce.transferSize!==void 0&&ce.transferSize===0&&Pe(ve),Pe(me)}}return J})((function(Y,J){const Q={};if(Y)for(const ce of Y){const ne=J(ce);Q[ne]===void 0&&(Q[ne]=[]),Q[ne].push(ce)}return Q})(w,D)),O=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=z?z.effectiveType:void 0,G={counters:[],metadata:[],attributes:[]},V=(Y,J,Q)=>{Q!=null&&Y.push({name:J,value:Q.toString()})};for(const Y in M)V(G.counters,Y,M[Y]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(V(G.counters,"interactionRangeMin",x.interactionRange[0]),V(G.counters,"interactionRangeMax",x.interactionRange[1])),A)for(const Y of Object.keys(P)){const J=P[Y],Q=A.find((ce=>ce.name===J));Q&&V(G.counters,J,Q.startTime)}return V(G.counters,"visibilityHidden",x.visibilityHidden),V(G.attributes,"style",(function(Y){if(Y)for(const J of Y){const Q=J.name.split("?")[0];if(i.i(Q)){const ce=Q.split("/").slice(-2);if(ce.length===2)return`mapbox://styles/${ce[0]}/${ce[1]}`}}})(w)),V(G.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),V(G.attributes,"fogEnabled",x.fogEnabled?"true":"false"),V(G.attributes,"projection",x.projection),V(G.attributes,"zoom",x.zoom),V(G.metadata,"devicePixelRatio",O),V(G.metadata,"connectionEffectiveType",B),V(G.metadata,"navigatorUserAgent",navigator.userAgent),V(G.metadata,"screenWidth",window.screen.width),V(G.metadata,"screenHeight",window.screen.height),V(G.metadata,"windowWidth",window.innerWidth),V(G.metadata,"windowHeight",window.innerHeight),V(G.metadata,"mapWidth",x.width/O),V(G.metadata,"mapHeight",x.height/O),V(G.metadata,"webglRenderer",x.renderer),V(G.metadata,"webglVendor",x.vendor),V(G.metadata,"sdkVersion",E),V(G.metadata,"sdkIdentifier","mapbox-gl-js"),G})(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(s,p,(()=>{}),m)}},En=Bt.postPerformanceEvent.bind(Bt),Tt=new class extends Xt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,s,c,p){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const x=St(i.e.API_URL+i.e.SESSION_PATH);x.params.push(`sku=${s||""}`),x.params.push(`access_token=${p||i.e.ACCESS_TOKEN||""}`);const w={url:an(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(w,(A=>{this.pendingRequest=null,c(A),this.saveEventData(),this.processRequests(p)}))}getSessionAPI(m,s,c,p){this.skuToken=s,this.errorCb=p,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(en)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,(p=>{p?this.errorCb(p):s&&(this.success[s]=!0)}),m)}remove(){this.errorCb=null}},wn=Tt.getSessionAPI.bind(Tt),mr=new Set;function tn(m,s){s?mr.add(m):mr.delete(m)}class Ii{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Hn(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class nr extends i.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new i.q({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const c=this.atlasTexture.get(s);c&&(c.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(s.id,s)}removeImageProvider(s,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(s)}getPendingImageProviders(){const s=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&s.push(p);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,c){if(this.loaded.get(c)!==s&&(this.loaded.set(c,s),s)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images.get(c).get(s.toString())}addImage(s,c,p){this._validate(s,p)&&this.images.get(c).set(s.toString(),p)}_validate(s,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "content" value`))),p=!1),p}_validateStretch(s,c){if(!s)return!0;let p=0;for(const x of s){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(s,c){return s?s.length!==4||!c.usvg&&(s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,c,p){const x=this.images.get(c).get(s.toString());p.version=x.version+1,this.images.get(c).set(s.toString(),p),this.updatedImages.get(c).add(s),this.removeFromImageRasterizerCache(s,c)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,c){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([s],c))}removeImage(s,c){const p=this.images.get(c),x=p.get(s.toString());p.delete(s.toString()),this.patterns.get(c).delete(s.toString()),this.removeFromImageRasterizerCache(s,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map((c=>i.I.from(c)))}getImages(s,c,p){const x=[],w=[],A=this.imageProviders.get(c);for(const B of s){if(!B.iconsetId){x.push(B);continue}const G=A.get(B.iconsetId);G&&(this.getImage(B,c)?w.push(B):G.addPendingRequest(B))}if(x.length===0)return void this._notify(w,c,p);let M=!0;const O=!!this.loaded.get(c),z=this.images.get(c);if(!O)for(const B of x)z.has(B.toString())||(M=!1);O||M?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(s,c){const p=new Map,{tasks:x,scope:w}=s;for(const[A,M]of x.entries()){const O=this.getImage(M.id,w);O&&p.set(A,{image:O,imageVariant:M})}this._rasterizeImages(w,p,c)}_rasterizeImages(s,c,p){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:s},p);else{const x=new Map;for(const[w,{image:A,imageVariant:M}]of c.entries())x.set(w,this.imageRasterizer.rasterize(M,A,s,0));p(void 0,x)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,c,p){const x=this.images.get(c),w=new Map;for(const A of s){if(!x.get(A.toString())){if(A.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:A.name}))}const M=x.get(A.toString());if(!M){i.w(`Image "${A.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:M.usvg?null:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,usvg:M.usvg,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)};M.usvg&&Object.assign(O,{width:M.icon.usvg_tree.width,height:M.icon.usvg_tree.height}),w.set(i.I.toString(A),O)}p(null,w)}getPixelSize(s){const{width:c,height:p}=this.atlasImage.get(s);return{width:c,height:p}}getPattern(s,c,p){const x=s.toString(),w=this.patterns.get(c),A=w.get(x),M=this.getImage(s,c);if(!M)return null;if(A){if(A.position.version===M.version)return A.position;A.position.version=M.version}else{if(M.usvg&&!M.data){const O=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const z=new i.A(s).scaleSelf(i.o.devicePixelRatio),B=new Map([[z.toString(),{image:M,imageVariant:z}]]);return this._rasterizeImages(c,B,((G,V)=>this.storePatternImage(z,c,M,p,V))),null}this.storePattern(s,c,M)}return this._updatePatternAtlas(c,p),w.get(x).position}getPatternInFlightId(s,c){return i.B(s,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,c,p,x,w){const A=s.toString(),M=w?w.get(A):void 0;M&&(p.data=M,this.storePattern(s.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),c)))}storePattern(s,c,p){const x={w:p.data.width+2*i.C,h:p.data.height+2*i.C,x:0,y:0},w=new i.F(x,p,i.C);this.patterns.get(c).set(s.toString(),{bin:x,position:w})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,c){const p=s.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new i.T(s,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const p=this.patterns.get(s),x=Array.from(p.values()).map((({bin:z})=>z)),{w,h:A}=i.G(x),M=this.atlasImage.get(s);M.resize({width:w||1,height:A||1});const O=this.images.get(s);for(const[z,{bin:B,position:G}]of p.entries()){let V=G.padding;const Y=B.x+V,J=B.y+V,Q=O.get(z).data,ce=Q.width,ne=Q.height;V=V>1?V-1:V,i.q.copy(Q,M,{x:0,y:0},{x:Y,y:J},{width:ce,height:ne},c),i.q.copy(Q,M,{x:0,y:ne-V},{x:Y,y:J-V},{width:ce,height:V},c),i.q.copy(Q,M,{x:0,y:0},{x:Y,y:J+ne},{width:ce,height:V},c),i.q.copy(Q,M,{x:ce-V,y:0},{x:Y-V,y:J},{width:V,height:ne},c),i.q.copy(Q,M,{x:0,y:0},{x:Y+ce,y:J},{width:V,height:ne},c),i.q.copy(Q,M,{x:ce-V,y:ne-V},{x:Y-V,y:J-V},{width:V,height:V},c),i.q.copy(Q,M,{x:0,y:ne-V},{x:Y+ce,y:J-V},{width:V,height:V},c),i.q.copy(Q,M,{x:0,y:0},{x:Y+ce,y:J+ne},{width:V,height:V},c),i.q.copy(Q,M,{x:ce-V,y:0},{x:Y-V,y:J+ne},{width:V,height:V},c)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,c){const p=this.images.get(c);for(const x of s){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const w=p.get(x.toString());Hn(w)&&this.updateImage(x,c,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Mi(m){const s=m.value,c=m.valueSpec,p=m.style,x=m.styleSpec,w=m.key,A=m.arrayElementValidator||vi;if(!Array.isArray(s))return[new i.V(w,s,`array expected, ${i.K(s)} found`)];if(c.length&&s.length!==c.length)return[new i.V(w,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new i.V(w,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let M={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(M.function=c.function),i.H(c.value)&&(M=c.value);let O=[];for(let z=0;z<s.length;z++)O=O.concat(A({array:s,arrayIndex:z,value:s[z],valueSpec:M,style:p,styleSpec:x,key:`${w}[${z}]`},!0));return O}function Sn(m){const s=m.key,c=m.value,p=m.valueSpec;if(!i.L(c))return[new i.V(s,c,`number expected, ${i.K(c)} found`)];if(c!=c)return[new i.V(s,c,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[m.arrayIndex]),c<x)return[new i.V(s,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[m.arrayIndex]),c>x)return[new i.V(s,c,`${c} is greater than the maximum value ${x}`)]}return[]}function si(m){const s=m.key,c=m.value;if(!i.H(c))return[new i.V(s,c,`object expected, ${i.K(c)} found`)];const p=m.valueSpec,x=i.J(c.type);let w,A,M,O={};const z=x!=="categorical"&&c.property===void 0,B=!z,G=(function(Q){const ce=Q.stops;return Array.isArray(ce)&&Array.isArray(ce[0])&&i.H(ce[0][0])})(c),V=hs({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(Q){if(x==="identity")return[new i.V(Q.key,Q.value,'identity function may not have a "stops" property')];let ce=[];const ne=Q.value;return ce=ce.concat(Mi({key:Q.key,value:ne,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:Y})),Array.isArray(ne)&&ne.length===0&&ce.push(new i.V(Q.key,ne,"array must have at least one stop")),ce},default:function(Q){return vi({key:Q.key,value:Q.value,valueSpec:p,style:Q.style,styleSpec:Q.styleSpec})}}});return x==="identity"&&z&&V.push(new i.V(m.key,m.value,'missing required property "property"')),x==="identity"||c.stops||V.push(new i.V(m.key,m.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!i.M(p)&&V.push(new i.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(B&&!i.N(p)?V.push(new i.V(m.key,m.value,"property functions not supported")):z&&!i.O(p)&&V.push(new i.V(m.key,m.value,"zoom functions not supported"))),x!=="categorical"&&!G||c.property!==void 0||V.push(new i.V(m.key,m.value,'"property" property is required')),V;function Y(Q){let ce=[];const ne=Q.value,he=Q.key;if(!Array.isArray(ne))return[new i.V(he,ne,`array expected, ${i.K(ne)} found`)];if(ne.length!==2)return[new i.V(he,ne,`array length 2 expected, length ${ne.length} found`)];if(G){if(!i.H(ne[0]))return[new i.V(he,ne,`object expected, ${i.K(ne[0])} found`)];const me=ne[0];if(me.zoom===void 0)return[new i.V(he,ne,"object stop key must have zoom")];if(me.value===void 0)return[new i.V(he,ne,"object stop key must have value")];const ve=i.J(me.zoom);if(typeof ve!="number")return[new i.V(he,me.zoom,"stop zoom values must be numbers")];if(M&&M>ve)return[new i.V(he,me.zoom,"stop zoom values must appear in ascending order")];ve!==M&&(M=ve,A=void 0,O={}),ce=ce.concat(hs({key:`${he}[0]`,value:ne[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:Sn,value:J}}))}else ce=ce.concat(J({key:`${he}[0]`,value:ne[0],style:Q.style,styleSpec:Q.styleSpec},ne));return i.Q(i.S(ne[1]))?ce.concat([new i.V(`${he}[1]`,ne[1],"expressions are not allowed in function stops.")]):ce.concat(vi({key:`${he}[1]`,value:ne[1],valueSpec:p,style:Q.style,styleSpec:Q.styleSpec}))}function J(Q,ce){const ne=i.K(Q.value),he=i.J(Q.value),me=Q.value!==null?Q.value:ce;if(w){if(ne!==w)return[new i.V(Q.key,me,`${ne} stop domain type must match previous stop domain type ${w}`)]}else w=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof he!="number"&&typeof he!="string"&&typeof he!="boolean")return[new i.V(Q.key,me,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&x!=="categorical"){let ve=`number expected, ${ne} found`;return i.N(p)&&x===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(Q.key,me,ve)]}return x!=="categorical"||ne!=="number"||typeof he=="number"&&isFinite(he)&&Math.floor(he)===he?x!=="categorical"&&ne==="number"&&typeof he=="number"&&typeof A=="number"&&A!==void 0&&he<A?[new i.V(Q.key,me,"stop domain values must appear in ascending order")]:(A=he,x==="categorical"&&he in O?[new i.V(Q.key,me,"stop domain values must be unique")]:(O[he]=!0,[])):[new i.V(Q.key,me,`integer expected, found ${String(he)}`)]}}function Fi(m){const s=(m.expressionContext==="property"?i.W:i.U)(i.S(m.value),m.valueSpec);if(s.result==="error")return s.value.map((p=>new i.V(`${m.key}${p.key}`,m.value,p.message)));const c=s.value.expression||s.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!i.Z(c))return[new i.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return js(c,m);if(m.expressionContext==="appearance")return us(c,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!i.X(c,["zoom","feature-state"]))return[new i.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!i.Y(c))return[new i.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function js(m,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return m instanceof i._&&c.has(m.name)?[new i.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild((x=>{p.push(...js(x,s))})),p)}function us(m,s){const c=new Set;if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)c.add(x);if(c.size===0)return[];const p=[];return m instanceof i._&&!c.has(m.name)?[new i.V(s.key,s.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild((x=>{p.push(...us(x,s))})),p)}function ha(m){const s=m.key,c=m.value,p=m.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(i.J(c))===-1&&x.push(new i.V(s,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(i.J(c))===-1&&x.push(new i.V(s,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function ja(m){return i.a2(i.S(m.value))?Fi(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):za(m)}function za(m){const s=m.value,c=m.key;if(!Array.isArray(s))return[new i.V(c,s,`array expected, ${i.K(s)} found`)];if(s.length<1)return[new i.V(c,s,"filter array must have at least 1 element")];const p=m.styleSpec;let x=ha({key:`${c}[0]`,value:s[0],valueSpec:p.filter_operator});switch(i.J(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&i.J(s[1])==="$type"&&x.push(new i.V(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new i.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(i.a0(s[1])||x.push(new i.V(`${c}[1]`,s[1],`string expected, ${i.K(s[1])} found`)));for(let w=2;w<s.length;w++)i.J(s[1])==="$type"?x=x.concat(ha({key:`${c}[${w}]`,value:s[w],valueSpec:p.geometry_type})):i.a0(s[w])||i.L(s[w])||i.$(s[w])||x.push(new i.V(`${c}[${w}]`,s[w],`string, number, or boolean expected, ${i.K(s[w])} found.`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)x=x.concat(za({key:`${c}[${w}]`,value:s[w],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":s.length!==2?x.push(new i.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):i.a0(s[1])||x.push(new i.V(`${c}[1]`,s[1],`string expected, ${i.K(s[1])} found`))}return x}function Na(m,s){const c=m.key,p=m.style,x=m.layer,w=m.styleSpec,A=m.value,M=m.objectKey,O=w[`${s}_${m.layerType}`];if(!O)return[];const z=M.match(/^(.*)-use-theme$/);if(z&&O[z[1]])return i.Q(A)?[].concat(vi({key:m.key,value:A,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:M})):vi({key:c,value:A,valueSpec:{type:"string"},style:p,styleSpec:w});const B=M.match(/^(.*)-transition$/);if(s==="paint"&&B&&O[B[1]]&&O[B[1]].transition)return vi({key:c,value:A,valueSpec:w.transition,style:p,styleSpec:w});const G=m.valueSpec||O[M];if(!G)return[new i.a3(c,A,`unknown property "${M}"`)];let V;if(i.a0(A)&&i.N(G)&&!G.tokens&&(V=/^{([^}]+)}$/.exec(A))){const J=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new i.V(c,A,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const Y=[];if(m.layerType==="symbol")M!=="text-field"||!p||p.glyphs||p.imports||Y.push(new i.V(c,A,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&i.a4(i.S(A))&&i.J(A.type)==="identity"&&Y.push(new i.V(c,A,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&s==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&i.N(G)&&(i.a5(G)||i.O(G))){const J=i.W(i.S(A),G),Q=J.value.expression||J.value._styleExpression.expression;Q&&!i.X(Q,["measure-light"])&&(M==="model-emissive-strength"&&i.Y(Q)&&i.Z(Q)||Y.push(new i.V(c,A,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(vi({key:m.key,value:A,valueSpec:G,style:p,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:M}))}function Es(m){return Na(m,"paint")}function zs(m){return Na(m,"layout")}function fl(m){let s=[];const c=m.value,p=m.key,x=m.style,w=m.styleSpec;if(!i.H(c))return[new i.V(p,c,"object expected")];c.type||c.ref||s.push(new i.V(p,c,'either "type" or "ref" is required'));let A=i.J(c.type);const M=i.J(c.ref);if(c.id){const O=i.J(c.id);for(let z=0;z<m.arrayIndex;z++){const B=x.layers[z];i.J(B.id)===O&&s.push(new i.V(p,c.id,`duplicate layer id "${O}", previously used at line ${B.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach((z=>{z in c&&s.push(new i.V(p,c[z],`"${z}" is prohibited for ref layers`))})),x.layers.forEach((z=>{i.J(z.id)===M&&(O=z)})),O?O.ref?s.push(new i.V(p,c.ref,"ref cannot reference another ref layer")):A=i.J(O.type):typeof M=="string"&&s.push(new i.V(p,c.ref,`ref layer "${M}" not found`))}else if(A!=="background"&&A!=="sky"&&A!=="slot")if(c.source)if(i.a0(c.source)){const O=x.sources&&x.sources[c.source],z=O&&i.J(O.type);O?z==="vector"&&A==="raster"?s.push(new i.V(p,c.source,`layer "${c.id}" requires a raster source`)):z==="raster"&&A!=="raster"?s.push(new i.V(p,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&A!=="hillshade"?s.push(new i.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(A)?A==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&z==="geojson"&&!O.lineMetrics?s.push(new i.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):A==="raster-particle"&&z!=="raster-array"&&s.push(new i.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new i.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new i.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new i.V(p,c.source,`source "${c.source}" not found`))}else s.push(new i.V(`${p}.source`,c.source,'"source" must be a string'));else s.push(new i.V(p,c,'missing required property "source"'));return s=s.concat(hs({key:p,value:c,valueSpec:w.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>vi({key:`${p}.type`,value:c.type,valueSpec:w.layer.type,style:m.style,styleSpec:m.styleSpec,object:c,objectKey:"type"}),filter:O=>ja(Object.assign({layerType:A},O)),layout:O=>hs({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>zs(Object.assign({layerType:A},z))}}),paint:O=>hs({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>Es(Object.assign({layerType:A,layer:c},z))}}),appearances(O){const z=Mi({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:V=>(function(Y){const{key:J,layer:Q,layerType:ce}=Y,ne=i.J(Y.value),he=i.J(ne.name),me=i.J(ne.condition),ve=hs({key:J,value:ne,valueSpec:Y.styleSpec.appearance,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{condition:Pe=>(function(Ae){const Ie=[];return Ie.push(...Fi({key:Ae.key,value:Ae.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ie})(Object.assign({layer:Q,layerType:ce},Pe)),properties:Pe=>(function(Ae){const Ie=[],{styleSpec:Ce,layer:Te,layerType:Me}=Ae,Ke=Ce[`paint_${Me}`],Be=Ce[`layout_${Me}`],at=Ae.object[Ae.objectKey];for(const Xe in at){const Qe=Xe in Ke?"paint":Xe in Be?"layout":void 0;if(!Qe){Ie.push(new i.V(Ae.key,Xe,`unknown property "${Xe}" for layer type "${Me}"`));continue}const At=Object.assign({},Ae,{key:`${Ae.key}.${Xe}`,object:at,objectKey:Xe,layer:Te,layerType:Me,value:at[Xe],valueSpec:Qe==="paint"?Ke[Xe]:Be[Xe]});Ie.push(...Na(At,Qe))}return Ie})(Object.assign({layer:Q,layerType:ce},Pe))}});return he==="hidden"||me||ve.push(new i.V(Y.key,"name",'Appearance with name different than "hidden" must have a condition')),ve})(Object.assign({layerType:A,layer:c},V))}),B=Array.isArray(O.value)?O.value:[],G=new Set;return B.forEach(((V,Y)=>{const J=i.J(V.name);if(J)if(G.has(J)){const Q=i.J(c.id);z.push(new i.V(O.key,J,`Duplicated appearance name "${J}" for layer "${Q}"`))}else G.add(J)})),z}}})),s}function Fa({key:m,value:s}){return i.a0(s)?[]:[new i.V(m,s,`string expected, ${i.K(s)} found`)]}const no={promoteId:function m({key:s,value:c}){if(i.a0(c))return Fa({key:s,value:c});if(Array.isArray(c)){const x=[],w=i.S(c),A=i.U(w);return A.result==="error"&&A.value.forEach((M=>{x.push(new i.V(`${s}${M.key}`,null,`${M.message}`))})),i.X(A.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new i.V(`${s}`,null,"promoteId expression should be only feature dependent")),x}if(!i.H(c))return[new i.V(s,c,`string, expression or object expected, "${i.K(c)}" found`)];const p=[];for(const x in c)p.push(...m({key:`${s}.${x}`,value:c[x]}));return p}};function os(m){const s=m.value,c=m.key,p=m.styleSpec,x=m.style;if(!i.H(s))return[new i.V(c,s,`object expected, ${i.K(s)} found`)];if(!("type"in s))return[new i.V(c,s,'"type" is required')];const w=i.J(s.type);let A=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in s||"tiles"in s||A.push(new i.a3(c,s,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return A=A.concat(hs({key:c,value:s,valueSpec:p[`source_${w.replace("-","_")}`],style:m.style,styleSpec:p,objectElementValidators:no})),A;case"geojson":if(A=hs({key:c,value:s,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:no}),"cluster"in s&&"clusterProperties"in s){if(!i.H(s.clusterProperties))return[new i.V(`${c}.clusterProperties`,s,`object expected, ${i.K(s)} found`)];for(const M in s.clusterProperties){const O=s.clusterProperties[M];if(!Array.isArray(O))return[new i.V(`${c}.clusterProperties.${M}`,O,"array expected")];const[z,B]=O,G=typeof z=="string"?[z,["accumulated"],["get",M]]:z;A.push(...Fi({key:`${c}.${M}.map`,value:B,expressionContext:"cluster-map"})),A.push(...Fi({key:`${c}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}}return A;case"video":return hs({key:c,value:s,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return hs({key:c,value:s,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ha({key:`${c}.type`,value:s.type,valueSpec:{values:pl(p)}})}}function pl(m){return m.source.reduce(((s,c)=>{const p=m[c];return p.type.type==="enum"&&(s=s.concat(Object.keys(p.type.values))),s}),[])}function $h(m){const s=m.value,c=m.styleSpec,p=c.light,x=m.style;if(s===void 0)return[];if(!i.H(s))return[new i.V("light",s,`object expected, ${i.K(s)} found`)];let w=[];for(const A in s){const M=A.match(/^(.*)-transition$/),O=A.match(/^(.*)-use-theme$/);w=w.concat(O&&p[O[1]]?vi({key:A,value:s[A],valueSpec:{type:"string"},style:x,styleSpec:c}):M&&p[M[1]]&&p[M[1]].transition?vi({key:A,value:s[A],valueSpec:c.transition,style:x,styleSpec:c}):p[A]?vi({key:A,value:s[A],valueSpec:p[A],style:x,styleSpec:c}):[new i.V(A,s[A],`unknown property "${A}"`)])}return w}function ac(m){const s=m.value;if(!s)return[];const c=m.key;if(!i.H(s))return[new i.V(c,s,`object expected, ${i.K(s)} found`)];let p=[];const x=m.styleSpec,w=x["light-3d"],A=m.style,M=m.style.lights;for(const B of["type","id"])if(!(B in s))return p=p.concat([new i.V(c,s,`missing property "${B}"`)]),p;if(!i.a0(s.type))return p=p.concat([new i.V(`${c}.type`,s.type,"string expected")]),p;if(M)for(let B=0;B<m.arrayIndex;B++){const G=i.J(s.type),V=M[B];i.J(V.type)===G&&p.push(new i.V(c,s.id,`duplicate light type "${s.type}", previously defined at line ${V.id.__line__}`))}const O=`properties_light_${s.type}`;if(!(O in x))return p=p.concat([new i.V(`${c}.type`,s,`Invalid light type ${s.type}`)]),p;const z=x[O];for(const B in s)if(B==="properties"){const G=s[B];if(!i.H(G))return p=p.concat([new i.V("properties",G,`object expected, ${i.K(G)} found`)]),p;for(const V in G){const Y=V.match(/^(.*)-transition$/),J=V.match(/^(.*)-use-theme$/);p=p.concat(J&&z[J[1]]?vi({key:B,value:G[V],valueSpec:{type:"string"},style:A,styleSpec:x}):Y&&z[Y[1]]&&z[Y[1]].transition?vi({key:B,value:s[B],valueSpec:x.transition,style:A,styleSpec:x}):z[V]?vi({key:V,value:G[V],valueSpec:z[V],style:A,styleSpec:x}):[new i.a3(m.key,G[V],`unknown property "${V}"`)])}}else p=p.concat(w[B]?vi({key:B,value:s[B],valueSpec:w[B],style:A,styleSpec:x}):[new i.a3(B,s[B],`unknown property "${B}"`)]);return p}function Ol(m){const s=m.value,c=m.key,p=m.style,x=m.styleSpec,w=x.terrain;if(s==null)return[];if(!i.H(s))return[new i.V("terrain",s,`object expected, ${i.K(s)} found`)];let A=[];for(const M in s){const O=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);A=A.concat(z&&w[z[1]]?vi({key:M,value:s[M],valueSpec:{type:"string"},style:p,styleSpec:x}):O&&w[O[1]]&&w[O[1]].transition?vi({key:M,value:s[M],valueSpec:x.transition,style:p,styleSpec:x}):w[M]?vi({key:M,value:s[M],valueSpec:w[M],style:p,styleSpec:x}):[new i.a3(M,s[M],`unknown property "${M}"`)])}if(s.source)if(i.a0(s.source)){const M=p.sources&&p.sources[s.source],O=M&&i.J(M.type);M?O!=="raster-dem"&&A.push(new i.V(`${c}.source`,s.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):A.push(new i.V(`${c}.source`,s.source,`source "${s.source}" not found`))}else A.push(new i.V(`${c}.source`,s.source,"source must be a string"));else A.push(new i.V(c,s,'terrain is missing required property "source"'));return A}function ml(m){const s=m.value,c=m.style,p=m.styleSpec,x=p.fog;if(s===void 0)return[];if(!i.H(s))return[new i.V("fog",s,`object expected, ${i.K(s)} found`)];let w=[];for(const A in s){const M=A.match(/^(.*)-transition$/),O=A.match(/^(.*)-use-theme$/);w=w.concat(O&&x[O[1]]?vi({key:A,value:s[A],valueSpec:{type:"string"},style:c,styleSpec:p}):M&&x[M[1]]&&x[M[1]].transition?vi({key:A,value:s[A],valueSpec:p.transition,style:c,styleSpec:p}):x[A]?vi({key:A,value:s[A],valueSpec:x[A],style:c,styleSpec:p}):[new i.a3(A,s[A],`unknown property "${A}"`)])}return w}const lc={"*":()=>[],array:Mi,boolean:function(m){const s=m.value,c=m.key;return i.$(s)?[]:[new i.V(c,s,`boolean expected, ${i.K(s)} found`)]},number:Sn,color:function({key:m,value:s}){return i.a0(s)?i.a1.parseCSSColor(s)===null?[new i.V(m,s,`color expected, "${s}" found`)]:[]:[new i.V(m,s,`color expected, ${i.K(s)} found`)]},enum:ha,filter:ja,function:si,layer:fl,object:hs,source:os,model:i.a7,light:$h,"light-3d":ac,terrain:Ol,fog:ml,string:Fa,formatted:function(m){return Fa(m).length===0?[]:Fi(m)},resolvedImage:function(m){return Fa(m).length===0?[]:Fi(m)},projection:function(m){const s=m.value,c=m.styleSpec,p=c.projection,x=m.style;if(i.H(s)){let w=[];for(const A in s)w=w.concat(vi({key:A,value:s[A],valueSpec:p[A],style:x,styleSpec:c}));return w}return i.a0(s)?[]:[new i.V("projection",s,`object or string expected, ${i.K(s)} found`)]},import:function(m){const s=m.key,{value:c,styleSpec:p}=m;if(!i.H(c))return[new i.V(s,c,"import must be an object")];const{data:x,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let A=hs(Object.assign({},m,{value:w,valueSpec:p.import}));return i.J(w.id)===""&&A.push(new i.V(`${m.key}.id`,w,"import id can't be an empty string")),x&&(A=A.concat(Ba(x,p,{key:`${m.key}.data`}))),A},iconset:function(m){const s=m.value,c=m.key,p=m.styleSpec,x=m.style;if(!i.H(s))return[new i.V(c,s,"object expected")];if(!s.type)return[new i.V(c,s,'"type" is required')];const w=i.J(s.type);let A=[];if(A=A.concat(hs({key:c,value:s,valueSpec:p[`iconset_${w}`],style:x,styleSpec:p})),(function(M,O){return!(M!=="source"||!O.source)})(w,s)){const M=x.sources&&x.sources[s.source],O=M&&i.J(M.type);M?O!=="raster-array"&&A.push(new i.V(c,s.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):A.push(new i.V(c,s.source,`source "${s.source}" not found`))}return A}};function vi(m,s=!1){const c=m.value,p=m.valueSpec,x=m.styleSpec;if(p.expression){if(i.a4(i.J(c)))return si(m);if(i.Q(i.S(c)))return Fi(m)}if(p.type&&lc[p.type]){const w=lc[p.type](m);return s===!0&&w.length>0&&Array.isArray(m.value)?Fi(m):w}return hs(Object.assign({},m,{valueSpec:p.type?x[p.type]:p}))}function hs(m){const s=m.key,c=m.value,p=m.valueSpec||{},x=m.objectElementValidators||{},w=m.style,A=m.styleSpec;if(!i.H(c))return[new i.V(s,c,`object expected, ${i.K(c)} found`)];let M=[];for(const O in c){const z=O.split(".")[0];let B;x[z]?B=x[z]:p[z]?B=vi:x["*"]?B=x["*"]:p["*"]&&(B=vi),B?M=M.concat(B({key:(s&&`${s}.`)+O,value:c[O],valueSpec:p[z]||p["*"],style:w,styleSpec:A,object:c,objectKey:O},c)):M.push(new i.a3(s,c[O],`unknown property "${O}"`))}for(const O in p)x[O]||p[O].required&&p[O].default===void 0&&c[O]===void 0&&M.push(new i.V(s,c,`missing required property "${O}"`));return M}function ku({key:m,value:s}){const c=Fa({key:m,value:s});if(c.length)return c;const p=s;return p.indexOf("{fontstack}")===-1&&c.push(new i.V(m,s,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new i.V(m,s,'"glyphs" url must include a "{range}" token')),c}function Ba(m,s=i.a6,c={}){return hs({key:c.key||"",value:m,valueSpec:Object.assign(s.$root,{"*":{type:"*"}}),styleSpec:s,style:m,objectElementValidators:{glyphs:ku}})}function _o(m,s=i.a6){return De(Ba(m,s))}const Hh=m=>De(os(m)),Gh=m=>De($h(m)),Wd=m=>De(ac(m)),It=m=>De(Ol(m)),Dl=m=>De(ml(m)),qd=m=>De((function(s){const c=s.value,p=s.style,x=s.styleSpec,w=x.snow;if(c===void 0)return[];if(!i.H(c))return[new i.V("snow",c,`object expected, ${i.K(c)} found`)];let A=[];for(const M in c){const O=M.match(/^(.*)-transition$/);A=A.concat(O&&w[O[1]]&&w[O[1]].transition?vi({key:M,value:c[M],valueSpec:x.transition,style:p,styleSpec:x}):w[M]?vi({key:M,value:c[M],valueSpec:w[M],style:p,styleSpec:x}):[new i.a3(M,c[M],`unknown property "${M}"`)])}return A})(m)),Ru=m=>De((function(s){const c=s.value,p=s.style,x=s.styleSpec,w=x.rain;if(c===void 0)return[];if(!i.H(c))return[new i.V("rain",c,`object expected, ${i.K(c)} found`)];let A=[];for(const M in c){const O=M.match(/^(.*)-transition$/);A=A.concat(O&&w[O[1]]&&w[O[1]].transition?vi({key:M,value:c[M],valueSpec:x.transition,style:p,styleSpec:x}):w[M]?vi({key:M,value:c[M],valueSpec:w[M],style:p,styleSpec:x}):[new i.a3(M,c[M],`unknown property "${M}"`)])}return A})(m)),$e=m=>De(fl(m)),oe=m=>De(ja(m)),de=m=>De(Es(m)),Se=m=>De(zs(m)),ze=m=>De(i.a7(m));function De(m){return m.slice().sort(((s,c)=>s.line&&c.line?s.line-c.line:0))}function Oe(m,s){let c=!1;if(s&&s.length)for(const p of s)p instanceof i.a3?i.w(p.message):(m.fire(new i.y(new Error(p.message))),c=!0);return c}let rt;class Ve extends i.E{constructor(s,c="flat"){super(),this._transitionable=new i.a8(rt||(rt=new i.a9({anchor:new i.aa(i.a6.light.anchor),position:new i.ab(i.a6.light.position),color:new i.aa(i.a6.light.color),intensity:new i.aa(i.a6.light.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,p={}){this._validate(Gh,s,p)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,p){return(!p||p.validate!==!1)&&Oe(this,s.call(_o,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let ot=class extends i.E{constructor(m,s,c,p,x){super(),this.scope=c,this._transitionable=new i.a8(new i.a9({source:new i.aa(i.a6.terrain.source),exaggeration:new i.aa(i.a6.terrain.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(m,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=x}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new i.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const s=m.value.expression;if(!s)return null;let c=-1,p=-1,x=1;for(const w of s.zoomStops)x=s.evaluate(new i.ac(w,{worldview:this.worldview})),x>.01?(c=w,p=-1):p=w;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof i.ad}};const jt=45,_t=65,gn=.05;function Rn(m,s,c,p){const x=i.ah(jt,_t,c),[w,A]=Fn(m,p);let M=1-Math.min(1,Math.exp((s-w)/(A-w)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*x*m.alpha}function Fn(m,s){const c=.5/Math.tan(.5*s);return[m.range[0]+c,m.range[1]+c]}function gr(m,s,c,p,x){const w=i.af([],[s,c,p],x.mercatorFogMatrix);return Rn(m,i.ag(w),x.pitch,x._fov)}function or(m,s,c,p,x,w,A){const M=[[c,p,0],[x,p,0],[x,w,0],[c,w,0]];let O=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const B of M){const G=i.af([],B,s),V=i.ag(G);O=Math.min(O,V),z=Math.max(z,V)}return[Rn(m,O,A.pitch,A._fov),Rn(m,z,A.pitch,A._fov)]}class xr extends i.E{constructor(s,c,p,x){super();const w=new i.a9({range:new i.aa(i.a6.fog.range),color:new i.aa(i.a6.fog.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(i.a6.fog["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(i.a6.fog["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(i.a6.fog["horizon-blend"]),"star-intensity":new i.aa(i.a6.fog["star-intensity"]),"vertical-range":new i.aa(i.a6.fog["vertical-range"])});this._transitionable=new i.a8(w,p,new Map(x)),this.set(s,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ai(w),this.scope=p}get state(){const s=this._transform,c=s.projection.name==="globe",p=i.aj(s.zoom),x=this.properties.get("range"),w=[.5,3];return{range:c?[i.ak(w[0],x[0],p),i.ak(w[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,p={}){if(this._validate(Dl,s,p))return;const x=Object.assign({},s);for(const w of Object.keys(i.a6.fog))x[w]===void 0&&(x[w]=i.a6.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(jt,_t,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?(function(p,x,w){const A=i.ae.fromLngLat(x),M=w.elevation?w.elevation.getAtPointOrZero(A):0;return gr(p,A.x,A.y,M,w)})(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return or(this.state,c,0,0,i.al,i.al,this._transform)}getOpacityForBounds(s,c,p,x,w){return this._transform.projection.supportsFog?or(this.state,s,c,p,x,w,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Fn(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=s.points[p];let w;if(x[2]>=0)w=x;else{const A=s.points[p-4];w=i.am(A,x,A[2]/(A[2]-x[2]))}if(gr(this.state,w[0],w[1],0,this._transform)>=gn)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,p){return(!p||p.validate!==!1)&&Oe(this,s.call(_o,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let Xr,_r,zi,Ur,ts=class extends i.E{constructor(m,s,c,p){super();const x=Xr||(Xr=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(x,c,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(x),this.scope=c}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),p=i.an(c[0]),x=-Math.max(i.an(c[1]),.01),w=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],A=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=A,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*m),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(m,s,c={}){if(this._validate(qd,m,c))return;const p=Object.assign({},m);for(const x of Object.keys(i.a6.snow))p[x]===void 0&&(p[x]=i.a6.snow[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,c){return(!c||c.validate!==!1)&&Oe(this,m.call(_o,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},$r=class extends i.E{constructor(m,s,c,p){super();const x=_r||(_r=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(x,c,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(x),this.scope=c}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),p=i.an(c[0]),x=-Math.max(i.an(c[1]),.01),w=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],A=this.properties.get("vignette-color");return A.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*m),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(m,s,c={}){if(this._validate(Ru,m,c))return;const p=Object.assign({},m);for(const x of Object.keys(i.a6.rain))p[x]===void 0&&(p[x]=i.a6.rain[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,c){return(!c||c.validate!==!1)&&Oe(this,m.call(_o,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class Or extends i.E{constructor(s,c,p,x){super(),this.scope=p,this._options=s,this.properties=new i.ai(c),this._transitionable=new i.a8(c,p,new Map(x)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class wi{constructor(s,c,p){this.screenBounds=s,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(s,c){let p,x;if(s instanceof i.P||typeof s[0]=="number"){const w=i.P.convert(s);p=[w],x=c.isPointAboveHorizon(w)}else{const w=i.P.convert(s[0]),A=i.P.convert(s[1]),M=w.add(A)._div(2);p=[w,A],x=i.aq(w,A).every((O=>c.isPointAboveHorizon(O)))&&c.isPointAboveHorizon(M)}return new wi(p,x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),i.ar(x,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.aq(c,p,s),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>p.y))+((w.x>c.x)+(w.x>p.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(s,c,p,x=0){const w=s.queryPadding/c._pixelsPerMercatorPixel+1,A=p?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let M=s.tileID.wrap+(A.unwrapped?x:0);const O=A.polygon.map((ce=>i.as(s.tileTransform,ce,M)));if(!i.at(O,0,0,i.al,i.al))return;M=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map((ce=>i.au(s.tileTransform,ce,M))),B=z.map((ce=>new i.P(ce[0],ce[1]))),G=c.getFreeCameraOptions().position||new i.ae(0,0,0),V=i.au(s.tileTransform,G,M),Y=z.map((ce=>{const ne=i.av(ce,ce,V);return i.aw(ne,ne),new i.ax(V,ne)})),J=i.ay(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:Y,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(Q=i.az(O),Q.min.x=i.aA(Q.min.x,0,i.al),Q.min.y=i.aA(Q.min.y,0,i.al),Q.max.x=i.aA(Q.max.x,0,i.al),Q.max.y=i.aA(Q.max.y,0,i.al),Q),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:J};var Q}_bufferedScreenMercator(s,c){const p=ds(s);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map((w=>c.pointCoordinate3D(w))),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(s,c){const p=ds(s);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map((w=>c.pointCoordinate3D(w))),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(s,c){const p=(function(w,A){const M=i.aB([],A.pixelMatrix,A.globeMatrix),O=[0,-i.aD,0,1],z=[0,i.aD,0,1],B=[0,0,0,1];i.aC(O,O,M),i.aC(z,z,M),i.aC(B,B,M);const G=new i.P(O[0]/O[3],O[1]/O[3]),V=new i.P(z[0]/z[3],z[1]/z[3]),Y=i.aE(w,G)&&O[3]<B[3],J=i.aE(w,V)&&z[3]<B[3];if(!Y&&!J)return null;const Q=(function(Ie,Ce,Te){for(let Me=1;Me<Ie.length;Me++){const Ke=ti(Ce.pointCoordinate3D(Ie[Me-1]).x),Be=ti(Ce.pointCoordinate3D(Ie[Me]).x);if(Te<0){if(Ke<Be)return{idx:Me,t:-Ke/(Be-1-Ke)}}else if(Be<Ke)return{idx:Me,t:(1-Ke)/(Be+1-Ke)}}return null})(w,A,Y?-1:1);if(!Q)return null;const{idx:ce,t:ne}=Q;let he=ce>1?Oi(w.slice(0,ce),A):[],me=ce<w.length?Oi(w.slice(ce),A):[];he=he.map((Ie=>new i.P(ti(Ie.x),Ie.y))),me=me.map((Ie=>new i.P(ti(Ie.x),Ie.y)));const ve=[...he];ve.length===0&&ve.push(me[me.length-1]);const Pe=i.ak(ve[ve.length-1].y,(me.length===0?he[0]:me[0]).y,ne);let Ae;return Ae=Y?[new i.P(0,Pe),new i.P(0,0),new i.P(1,0),new i.P(1,Pe)]:[new i.P(1,Pe),new i.P(1,1),new i.P(0,1),new i.P(0,Pe)],ve.push(...Ae),me.length===0?ve.push(he[0]):ve.push(...me),{polygon:ve.map((Ie=>new i.ae(Ie.x,Ie.y))),unwrapped:!1}})(s,c);if(p)return p;const x=(function(w,A){let M=!1,O=-1/0,z=0;for(let G=0;G<w.length-1;G++)w[G].x>O&&(O=w[G].x,z=G);for(let G=0;G<w.length-1;G++){const V=(z+G)%(w.length-1),Y=w[V],J=w[V+1];Math.abs(Y.x-J.x)>.5&&(Y.x<J.x?(Y.x+=1,V===0&&(w[w.length-1].x+=1)):(J.x+=1,V+1===w.length-1&&(w[0].x+=1)),M=!0)}const B=i.aF(A.center.lng);return M&&B<Math.abs(B-1)&&w.forEach((G=>{G.x-=1})),{polygon:w,unwrapped:M}})(Oi(s,c).map((w=>new i.P(ti(w.x),w.y))),c);return{polygon:x.polygon.map((w=>new i.ae(w.x,w.y))),unwrapped:x.unwrapped}}}function Oi(m,s){return i.aG(m,(c=>{const p=s.pointCoordinate3D(c);c.x=p.x,c.y=p.y}),1/256)}function ti(m){return m<0?1+m%1:m%1}function ds(m){return 100*m|0}function Yi(m,s,c,p,x){const w=function(M,O){if(M)return x(M);if(O){if(m.url&&O.tiles&&m.tiles&&delete m.tiles,O.variants){if(!Array.isArray(O.variants))return x(new Error("variants must be an array"));for(const B of O.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return x(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){O=Object.assign(O,B);break}}}const z=i.aH(Object.assign({},O,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=s.canonicalizeTileset(z,m.url),x(null,z)}},A=(function(M,O,z){if(!M)return null;if(!O&&!z)return M;z=z||M.worldview_default;const B=Object.values(M.language||{});if(B.length===0)return null;const G=Object.values(M.worldview||{});if(G.length===0)return null;const V=B.every((J=>J===O)),Y=G.every((J=>J===z));return V&&Y?M:O in(M.language_options||{})||z in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null})(m.data,c,p);return A?i.o.frame((()=>w(null,A))):m.url?i.m(s.transformRequest(s.normalizeSourceURL(m.url,null,c,p),i.R.Source),w):i.o.frame((()=>{const{data:M,...O}=m;w(null,O)}))}function da(m,s){const c=Math.pow(2,s.z),p=Math.floor(i.aF(m.getWest())*c),x=Math.floor(i.aJ(m.getNorth())*c),w=Math.ceil(i.aF(m.getEast())*c),A=Math.ceil(i.aJ(m.getSouth())*c);return s.x>=p&&s.x<w&&s.y>=x&&s.y<A}class Ns{constructor(s,c,p){this.bounds=s?i.aI.convert(this.validateBounds(s)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const c of s)this.extraBounds.push(i.aI.convert(this.validateBounds(c)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!da(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(da(c,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const c=new Ns(s.bounds,s.minzoom,s.maxzoom);return c.addExtraBounds(s.extra_bounds),c}}class ro extends i.E{constructor(s,c,p,x){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.aK}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Yi(this._options,this.map._requestManager,c,p,((x,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.y(x));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const A of w.vector_layers)this.vectorLayerIds.push(A.id),w.worldview&&w.worldview[A.source]&&this.localizableLayerIds.add(A.id)}this.tileBounds=Ns.fromTileJSON(w),zt(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}s&&s(x)}))}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(s)))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(s,c){const p=s.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),w=this.map._requestManager.transformRequest(x,i.R.Tile),A=this.map.style?this.map.style.getLut(this.scope):null,M=A?{image:A.image.clone()}:null,O={request:w,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&i.h(p)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",O,z.bind(this));else if(s.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",O,z.bind(this),void 0,!0);else{const B=i.aL.call({deduped:this._deduped},O,((G,V)=>{G||!V?z.call(this,G):(O.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},s.actor&&s.actor.send("loadTile",O,z.bind(this),void 0,!0))}),!0);s.request={cancel:B}}function z(B,G){return delete s.request,s.aborted?c(null):B&&B.status!==404?c(B):(G&&G.resourceTiming&&(s.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&s.setExpiryData(G),s.loadVectorData(G,this.map.painter),i.aM(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wh extends i.E{constructor(s,c,p,x){super(),this.id=s,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,i.aH(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=Yi(this._options,this.map._requestManager,null,c,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new i.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map((w=>w.id))),this.tileBounds=Ns.fromTileJSON(x),zt(x.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),s&&s(p)}))}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(s)))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const p=i.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);s.request=i.n(this.map._requestManager.transformRequest(x,i.R.Tile),((w,A,M,O)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):w?(s.state="errored",c(w)):A?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:M,expires:O}),s.setTexture(A,this.map.painter),s.state="loaded",i.aM(this.dispatcher),void c(null)):c(null))))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof i.T?(s.destroy(!0),s.texture&&s.texture instanceof i.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function d_([m,s],c,p,{scaled:x=!0}={}){const{tileSize:w,buffer:A}=p,{x:M,y:O,z}=c;if(!isFinite(M)||!isFinite(O)||!isFinite(z))throw new Error("Invalid MRT header");const B=2**z,G=B*i.aF(m),V=B*i.aJ(s);return(function([Y,J],Q,{scaled:ce=!0}={}){if(!Q)throw new Error("bandView is undefined");const{data:ne,tileSize:he,buffer:me,offset:ve,scale:Pe,dimension:Ae}=Q;if(Y<-me||Y>he+me||J<-me||J>he+me)throw new Error(`Point (${Y}, ${J}) out of bounds for tileSize=${he}, buffer=${me}`);const Ie=(J+me)*(he+2*me)+(Y+me);if(new Uint32Array(ne.buffer)[Ie]===4294967295)return null;let Ce=[];Ce=ce?[]:new Q.data.constructor(Ae);for(let Te=0;Te<Ae;Te++)Ce[Te]=Math.round(1e12*(ne[Ae*Ie+Te]*Pe+ve))/1e12;return Ce})([Math.min(Math.max(-A,Math.floor((G-M)*w)),w-1+A),Math.min(Math.max(-A,Math.floor((V-O)*w)),w-1+A)],p,{scaled:x})}class gl extends Wh{constructor(s,c,p,x){super(s,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const p=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,i.R.Tile),w={request:x,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=x,s.actor||(s.actor=this.dispatcher.getActor());const A=(M,O,z,B)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(M)return M.name==="AbortError"?void 0:(s.state="errored",c(M));if(this.map._refreshExpiredTiles&&O&&s.setExpiryData({cacheControl:z,expires:B}),this.partial&&s.state!=="expired")s.state="empty";else if(!this.partial){if(!O)return c(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=O}c(null)};s.request=this.partial?s.fetchHeader(void 0,A.bind(this)):s.actor.send("loadTile",w,A.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){const p=s.texturePerLayer;if(s.flushAllQueues(),p.size){s.destroy(!0);for(const x of p.values())this.map.painter.saveTileTexture(x)}else s.destroy()}prepareTile(s,c,p,x){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBandForRender(c,p,x,((w,A)=>{if(w)return s.state="errored",this.fire(new i.y(w)),void this.triggerRepaint(s);A&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(p,A,this.map.painter),s.state="loaded",this.triggerRepaint(s))})))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find((({id:w})=>w===s)),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(s,c,p){if(!s)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;c instanceof i.aP?w=c.paint.get("raster-array-band"):c instanceof i.aQ&&(w=c.paint.get("raster-particle-array-band"));const A=w||this.getInitialBand(x);if(A==null)return;if(!s.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(s,x,c.id,A);if(s.updateNeeded(c.id,A)&&!p)return;const M=s.textureDescriptorPerLayer.get(c.id);return Object.assign({},M,{texture:s.texturePerLayer.get(c.id)})}getImages(s,c){const p=new Map;for(const x of s)for(const w of c){const[A,M]=w.split("/"),O=x.getLayer(A);if(!O||!O.hasBand(M)||!O.hasDataForBand(M))continue;const{bytes:z,tileSize:B,buffer:G}=O.getBandView(M),V=B+2*G,Y={data:new i.q({width:V,height:V},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(w,Y)}return p}queryRasterArrayValueByBandId(s,c,p){const x=c._mrt;return new Promise((w=>{const A={},M=new Set;for(const[O,z]of Object.entries(x.layers)){if(p.layerName&&O!==p.layerName)continue;const B={};A[O]=B;for(const{bands:G}of z.dataIndex)for(const V of G)p.bands&&!p.bands.includes(V)||(M.add(i.B(O,V)),c.fetchBand(O,null,V,(Y=>{i.o.frame((()=>{B[V]=Y?null:d_([s.lng,s.lat],x,z.getBandView(V)),M.delete(i.B(O,V)),M.size===0&&w(A)}))}),!1))}M.size===0&&w(A)}))}_loadTileForQuery(s,c){if(this._loadTileLoaded[s.uid])return void c(null,s._mrt);if(this._loadTilePending[s.uid])return void this._loadTilePending[s.uid].push(c);this._loadTilePending[s.uid]=[c];const p=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,i.R.Tile);s.actor.send("loadTile",{request:x,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((w,A,M,O)=>w?(this._loadTilePending[s.uid].forEach((z=>z(w,null))),void delete this._loadTilePending[s.uid]):A?(this.map._refreshExpiredTiles&&A&&s.setExpiryData({cacheControl:M,expires:O}),s._mrt=A,s._isHeaderLoaded=!0,s.state="loaded",this._loadTilePending[s.uid].forEach((z=>z(null,A))),this._loadTileLoaded[s.uid]=!0,void delete this._loadTilePending[s.uid]):(this._loadTilePending[s.uid].forEach((z=>z(null,null))),void delete this._loadTilePending[s.uid])),void 0,!0)}queryRasterArrayValueByAllBands(s,c,p){return new Promise(((x,w)=>{this._loadTileForQuery(c,((A,M)=>{A?w(A):x(M?this.queryRasterArrayValueByBandId(s,c,p):null)}))}))}queryRasterArrayValue(s,c){const p=i.aR.convert(s),x=this.findLoadedParent(p);return x&&x._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,c):this.queryRasterArrayValueByAllBands(p,x,c):Promise.resolve(null)}findLoadedParent(s){const c=i.ae.fromLngLat(s,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,w=Math.floor(c.x),A=Math.floor((c.x-w)*x),M=Math.floor(c.y*x),O=this.map.style.getSourceCache(this.id),z=new i.aO(p,w,p,A,M);return O.findLoadedParent(z,this.minzoom)}}const cc={vector:ro,raster:Wh,"raster-dem":class extends Wh{constructor(m,s,c,p){super(m,s,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,w){x&&(m.state="errored",s(x)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=i.n(this.map._requestManager.transformRequest(c,i.R.Tile),(function(x,w,A,M){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(x)m.state="errored",s(x);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:A,expires:M});const O=ImageBitmap&&w instanceof ImageBitmap&&i.r(),z=1-(w.width-i.aN(w.width))/2;z<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const B=O?w:i.o.getImageData(w,z),G={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:z};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",G,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const s=m.canonical,c=Math.pow(2,s.z),p=(s.x-1+c)%c,x=s.x===0?m.wrap-1:m.wrap,w=(s.x+1+c)%c,A=s.x+1===c?m.wrap+1:m.wrap,M={};return M[new i.aO(m.overscaledZ,x,s.z,p,s.y).key]={backfilled:!1},M[new i.aO(m.overscaledZ,A,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(M[new i.aO(m.overscaledZ,x,s.z,p,s.y-1).key]={backfilled:!1},M[new i.aO(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},M[new i.aO(m.overscaledZ,A,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<c&&(M[new i.aO(m.overscaledZ,x,s.z,p,s.y+1).key]={backfilled:!1},M[new i.aO(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},M[new i.aO(m.overscaledZ,A,s.z,w,s.y+1).key]={backfilled:!1}),M}},"raster-array":gl,geojson:class extends i.E{constructor(m,s,c,p){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=s.data,this._options=Object.assign({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const x=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*x,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*x,extent:i.al,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:i.al,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*x,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of m.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:c},p),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const s=Object.assign({append:m},this.workerOptions);s.scope=this.scope;const c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(i.o.resolveURL(c),i.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,((p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new i.y(p));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new i.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const m=i.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,s){const c=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,w=this._partialReload,A={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview()};m.request=this.actor.send(c,A,((M,O)=>w&&!O?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):M?s(M):(m.loadVectorData(O,this.map.painter,c==="reloadTile"),s(null)))),void 0,c==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aS{constructor(m,s,c,p){super(m,s,c,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,i.R.Source).url);i.aT(this.urls,((s,c)=>{this._loaded=!0,s?this.fire(new i.y(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(m,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aS,model:class extends i.E{constructor(m,s,c,p){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const m=[];for(const s in this._options.models){const c=this._options.models[s],p=i.aV(this.map._requestManager.transformRequest(c.uri,i.R.Model).url).then((x=>{if(!x)return;const w=i.aW(x),A=new i.aX(s,c.position,c.orientation,w);A.computeBoundsAndApplyParent(),this.models.push(A)})).catch((x=>{this.fire(new i.y(new Error(`Could not load model ${s} from ${c.uri}: ${x.message}`)))}));m.push(p)}Promise.allSettled(m).then((()=>{this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((s=>{this._loaded=!0,this.fire(new i.y(new Error(`Could not load models: ${s.message}`)))}))}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(m,s,c,p){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=i.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(m)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Yi(this._options,this.map._requestManager,s,c,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Ns(x.bounds,this.minzoom,this.maxzoom)),zt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(p)}))}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=s;else{if(m.buckets){const w=Object.values(m.buckets);for(const A of w)A.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",p,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(w,A){return m.aborted?s(null):w&&w.status!==404?s(w):(this.map._refreshExpiredTiles&&A&&m.setExpiryData(A),m.loadModelData(A,this.map.painter),m.state="loaded",void s(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aS{constructor(m,s,c,p){super(m,s,c,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((w=>typeof w!="number"))))||this.fire(new i.y(new i.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof i.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.E{constructor(m,s,c,p){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ns(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:s,y:c,z:p}=m.canonical;return this._implementation.hasTile({x:s,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){const{x:c,y:p,z:x}=m.tileID.canonical,w=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:w.signal})).then((function(A){return delete m.request,m.aborted?(m.state="unloaded",s(null)):A===void 0?(m.state="errored",s(null)):A===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):(function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement})(A)?(this.loadTileData(m,A),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((A=>{A.name!=="AbortError"&&(m.state="errored",s(A))})),m.request.cancel=()=>w.abort()}loadTileData(m,s){m.setTexture(s,this.map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof i.T?(m.destroy(!0),m.texture&&m.texture instanceof i.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z})))}_clearTiles(){const m=i.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},uc=function(m,s,c,p){const x=new cc[s.type](m,s,c,p);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return i.aY(["load","abort","unload","serialize","prepare"],x),x};function Fc(m,s,c=""){return`${c}:${s.id||""}:${s.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:w}=p;return`featureset:${x}${w?`:import:${w}`:""}`}})(m.target)}`}function Bc(m,s,c,p=""){if(m.uniqueFeatureID){const x=Fc(m,s,p);if(c.has(x))return!0;c.add(x)}return!1}function Zd(m,s,c,p,x=!1){const w=s.sourceCache.transform,A=s.sourceCache.tilesIn(m,s.has3DLayers,x);A.sort(Yd);const M=[];for(const O of A){const z=O.tile.queryRenderedFeatures(s,O,c,p,w,x);Object.keys(z).length&&M.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:z})}return M.length===0?{}:(function(O){const z={},B={};for(const G of O){const V=G.queryResults,Y=G.wrappedTileID,J=B[Y]=B[Y]||{};for(const Q in V){const ce=V[Q],ne=J[Q]=J[Q]||{},he=z[Q]=z[Q]||[];for(const me of ce)ne[me.featureIndex]||(ne[me.featureIndex]=!0,he.push(me))}}return z})(M)}function Xd(m,s,c,p,x,w){const A={},M=p.queryRenderedSymbols(m),O=[];for(const z of Object.keys(M).map(Number))O.push(x[z]);O.sort(Yd);for(const z of O){const B=z.featureIndex.lookupSymbolFeatures(M[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,s,c,w);for(const G in B){const V=A[G]=A[G]||[],Y=B[G];Y.sort(((J,Q)=>{const ce=z.featureSortOrder;if(ce){const ne=ce.indexOf(J.featureIndex);return ce.indexOf(Q.featureIndex)-ne}return Q.featureIndex-J.featureIndex}));for(const J of Y)V.push(J)}}return A}function _l(m,s){const c=m.getRenderableIds().map((w=>m.getTileByID(w))),p=[],x={};for(let w=0;w<c.length;w++){const A=c[w],M=A.tileID.canonical.key;x[M]||(x[M]=!0,A.querySourceFeatures(p,s))}return p}function Yd(m,s){const c=m.tileID,p=s.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Uc(m,s){const c={};if(!s)return c;for(const p of m){const x=p.layerIds.map((w=>s.getLayer(w))).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map((w=>x.filter((A=>A.id===w))[0])));for(const w of x)c[w.fqid]=p}}return c}const fa=32,pa=33,ni=new Uint16Array(8184);for(let m=0;m<2046;m++){let s=m+2,c=0,p=0,x=0,w=0,A=0,M=0;for(1&s?x=w=A=fa:c=p=M=fa;(s>>=1)>1;){const z=c+x>>1,B=p+w>>1;1&s?(x=c,w=p,c=A,p=M):(c=x,p=w,x=A,w=M),A=z,M=B}const O=4*m;ni[O+0]=c,ni[O+1]=p,ni[O+2]=x,ni[O+3]=w}const Ua=new Uint16Array(2178),io=new Uint8Array(1089),hc=new Uint16Array(1089);function Tp(m){return m===0?-.03125:m===32?.03125:0}const qh={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class dc{constructor(s,c,p,x,w,A){this.tileID=s,this.uid=i.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=A}registerFadeDuration(s){const c=s+this.timeAdded;c<i.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,p){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=Uc(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const w=this.buckets[x];if(w instanceof i.b4){if(this.hasSymbolBuckets=!0,!p)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const w=this.buckets[x];if(w instanceof i.b4&&w.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const x in this.buckets){const w=this.buckets[x],A=c.style.getOwnLayer(x);if(!A)continue;const M=A.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,M)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,p){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,Uc(s.buckets,c.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const x in this.buckets){const w=this.buckets[x];w.uploadPending()&&w.upload(s)}const c=s.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new i.T(s,p.image,c.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(s,c,p,x,w,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=(function(O,z){const B=i.bq([],[.5*O.width,.5*-O.height,1]);return i.br(B,B,[1,-1,0]),i.aB(B,B,O.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(B)})(w,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:c,pixelPosMatrix:M,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(s,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),w=c?c.sourceLayer:"",A=x._geojsonTileLayer||x[w];if(!A)return;const M=i.b6(c&&c.filter),{z:O,x:z,y:B}=this.tileID.canonical,G={z:O,x:z,y:B};for(let V=0;V<A.length;V++){const Y=A.feature(V);if(M.needGeometry){const ce=i.b7(Y,!0);if(!M.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ce,this.tileID.canonical))continue}else if(!M.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Y))continue;const J=p.getId(Y,w),Q=new i.b8(Y,O,z,B,J);Q.tile=G,s.push(Q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const p=i.b9(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const w=this.expirationTime-c;w?this.expirationTime=p+Math.max(w,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s,c){if(!this.latestFeatureIndex||!s.style)return;const p=this.latestFeatureIndex.loadVTLayers(),x=s.style.listImages(),w=s.style.getBrightness();for(const A in this.buckets){if(!s.style.hasLayer(A))continue;const M=this.buckets[A],O=M.layers[0],z=O.sourceLayer||"_geojsonTileLayer",B=p[z],G=s.style.getLayerSourceCache(O);let V={};G&&(V=G._state.getState(z,void 0));const Y=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},J=Object.keys(V).length>0&&!c;(J&&M.stateDependentLayers.length!==0||c)&&M.update(V,B,x,Y,J?M.stateDependentLayers:M.layers,c,w),(M instanceof i.ba||M instanceof i.bb)&&s._terrain&&s._terrain.enabled&&G&&M.uploadPending()&&s._terrain._clearRenderCacheForTile(G.id,this.tileID);const Q=s&&s.style&&s.style.getOwnLayer(A);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=i.o.now()+s}setTexture(s,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof i.T?this.texture.update(s):(this.texture=new i.T(p,s,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(s,c){const p={};for(const x of c)p[x]=!0;this.dependencies[s]=p}hasDependency(s,c){for(const p of s){const x=this.dependencies[p];if(x){for(const w of c)if(x[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=i.bc(qh,this.tileID.canonical,this.tileTransform)[0],x=new i.bd,w=new i.be;for(let A=0;A<p.length;A++){const{x:M,y:O}=p[A];x.emplaceBack(M,O),w.emplaceBack(A)}w.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(w),this._tileDebugBuffer=s.createVertexBuffer(x,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,x.length,w.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=i.bc(qh,this.tileID.canonical,this.tileTransform)[0];let x,w;if(this.isRaster){const A=(function(M,O){const z=i.aZ(M,O),B=Math.pow(2,M.z);for(let ce=0;ce<pa;ce++)for(let ne=0;ne<pa;ne++){const he=i.a_((M.x+(ne+Tp(ne))/fa)/B),me=i.a$((M.y+(ce+Tp(ce))/fa)/B),ve=O.project(he,me),Pe=ce*pa+ne;Ua[2*Pe+0]=Math.round((ve.x*z.scale-z.x)*i.al),Ua[2*Pe+1]=Math.round((ve.y*z.scale-z.y)*i.al)}io.fill(0),hc.fill(0);for(let ce=2045;ce>=0;ce--){const ne=4*ce,he=ni[ne+0],me=ni[ne+1],ve=ni[ne+2],Pe=ni[ne+3],Ae=he+ve>>1,Ie=me+Pe>>1,Ce=Ae+Ie-me,Te=Ie+he-Ae,Me=me*pa+he,Ke=Pe*pa+ve,Be=Ie*pa+Ae,at=Math.hypot((Ua[2*Me+0]+Ua[2*Ke+0])/2-Ua[2*Be+0],(Ua[2*Me+1]+Ua[2*Ke+1])/2-Ua[2*Be+1])>=16;io[Be]=io[Be]||(at?1:0),ce<1022&&(io[Be]=io[Be]||io[(me+Te>>1)*pa+(he+Ce>>1)]||io[(Pe+Te>>1)*pa+(ve+Ce>>1)])}const G=new i.b0,V=new i.b1;let Y=0;function J(ce,ne){const he=ne*pa+ce;return hc[he]===0&&(G.emplaceBack(Ua[2*he+0],Ua[2*he+1],ce*i.al/fa,ne*i.al/fa),hc[he]=++Y),hc[he]-1}function Q(ce,ne,he,me,ve,Pe){const Ae=ce+he>>1,Ie=ne+me>>1;if(Math.abs(ce-ve)+Math.abs(ne-Pe)>1&&io[Ie*pa+Ae])Q(ve,Pe,ce,ne,Ae,Ie),Q(he,me,ve,Pe,Ae,Ie);else{const Ce=J(ce,ne),Te=J(he,me),Me=J(ve,Pe);V.emplaceBack(Ce,Te,Me)}}return Q(0,0,fa,fa,fa,0),Q(fa,fa,0,0,0,fa),{vertices:G,indices:V}})(this.tileID.canonical,c);x=A.vertices,w=A.indices}else{x=new i.b0,w=new i.b1;for(const{x:M,y:O}of p)x.emplaceBack(M,O,0,0);const A=i.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let M=0;M<A.length;M+=3)w.emplaceBack(A[M],A[M+1],A[M+2])}this._tileBoundsBuffer=s.createVertexBuffer(x,i.bi.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(w),this._tileBoundsSegments=i.bg.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugBuffers(s,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,w=i.bj(x,c),A=i.bk(w),M=i.aj(c.zoom);let O;M>0&&(O=i.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,x,c,A,O,M),this._makeGlobeTileDebugTextBuffer(s,x,c,A,O,M)}_globePoint(s,c,p,x,w,A,M){let O=i.bm(s,c,p);if(A){const z=1<<p.z,B=i.aF(x.center.lng),G=i.aJ(x.center.lat),V=(p.x+.5)/z-B;let Y=0;V>.5?Y=-1:V<-.5&&(Y=1);let J=(s/i.al+p.x)/z+Y,Q=(c/i.al+p.y)/z;J=(J-B)*x._pixelsPerMercatorPixel+B,Q=(Q-G)*x._pixelsPerMercatorPixel+G;const ce=[J*x.worldSize,Q*x.worldSize,0];i.af(ce,ce,A),O=i.bn(O,ce,M)}return i.af(O,O,w)}_makeGlobeTileDebugBorderBuffer(s,c,p,x,w,A){const M=new i.bd,O=new i.be,z=new i.bo,B=(V,Y,J,Q,ce)=>{const ne=(J-V)/(ce-1),he=(Q-Y)/(ce-1),me=M.length;for(let ve=0;ve<ce;ve++){const Pe=V+ve*ne,Ae=Y+ve*he;M.emplaceBack(Pe,Ae);const Ie=this._globePoint(Pe,Ae,c,p,x,w,A);z.emplaceBack(Ie[0],Ie[1],Ie[2]),O.emplaceBack(me+ve)}},G=i.al;B(0,0,G,0,16),B(G,0,G,G,16),B(G,G,0,G,16),B(0,G,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(O),this._tileDebugBuffer=s.createVertexBuffer(M,i.bf.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(z,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,M.length,O.length)}_makeGlobeTileDebugTextBuffer(s,c,p,x,w,A){const M=i.al/4,O=new i.bd,z=new i.b1,B=new i.bo,G=25;z.reserve(32),O.reserve(G),B.reserve(G);const V=(Y,J)=>G*Y+J;for(let Y=0;Y<G;Y++){const J=Y*M;for(let Q=0;Q<G;Q++){const ce=Q*M;O.emplaceBack(ce,J);const ne=this._globePoint(ce,J,c,p,x,w,A);B.emplaceBack(ne[0],ne[1],ne[2])}}for(let Y=0;Y<4;Y++)for(let J=0;J<4;J++){const Q=V(Y,J),ce=V(Y,J+1),ne=V(Y+1,J),he=V(Y+1,J+1);z.emplaceBack(Q,ce,ne),z.emplaceBack(ne,ce,he)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(z),this._tileDebugTextBuffer=s.createVertexBuffer(O,i.bf.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(B,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,G,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class Ou extends dc{constructor(s,c,p,x,w){super(s,c,p,x,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,c,p){const x=p.context,w=x.gl;let A=this.texturePerLayer.get(s)||p.getTileTexture(c.width);A&&A instanceof i.T?A.update(c,{premultiply:!1}):A=new i.T(x,c,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,A)}flushQueues(s){const c=this._workQueuePerLayer.get(s)||[],p=this._fetchQueuePerLayer.get(s)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(s)||[];for(;c.length;)c.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(s)||[];for(;c.length;)c.pop()()}}fetchHeader(s=16384,c){const p=this._mrt=new i.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=i.bu(x,((w,A,M,O)=>{if(w)c(w);else try{const z=p.getHeaderLength(A);if(z>s)return void(this.request=this.fetchHeader(z,c));p.parseHeader(A),this._isHeaderLoaded=!0;let B=0;for(const G of Object.values(p.layers))B=Math.max(B,G.dataIndex[G.dataIndex.length-1].lastByte);A.byteLength>=B&&(this.entireBuffer=A),c(null,this.entireBuffer||A,M,O)}catch(z){c(z)}})),this.request}fetchBandForRender(s,c,p,x){this.fetchBand(s,c,p,(w=>{if(w)return void x(w);this.updateTextureDescriptor(s,c,p);const A=this.textureDescriptorPerLayer.get(c);x(null,A?A.img:null)}))}fetchBand(s,c,p,x,w=!0){const A=this._mrt;if(!this._isHeaderLoaded||!A)return void x(new Error("Tile header is not ready"));const M=this.actor;if(!M)return void x(new Error("Can't fetch tile band without an actor"));let O;const z=i.B(String(p),i.B(this.tileID.key,s));let B=this._taskQueue.get(z);B?B.add(x):(B=new Set,B.add(x),this._taskQueue.set(z,B));const G=(Q,ce)=>{O.complete(Q,ce),Q?x(Q):(B.values().forEach((ne=>ne(null,ce))),this._taskQueue.delete(z))},V=(Q,ce)=>{if(Q)return x(Q);const ne=M.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ce,task:O},G,void 0,!0);if(c!==null){const he=this._workQueuePerLayer.get(c)||[];he.push((()=>{ne&&ne.cancel(),O.cancel()})),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,he)}};let Y;try{Y=A.getLayer(s)}catch(Q){if(this.state==="reloading")return;throw Q}if(!Y)return void x(new Error(`Unknown sourceLayer "${s}"`));if(Y.hasDataForBand(p))return B.values().forEach((Q=>Q(null,null))),void this._taskQueue.delete(z);const J=Y.getDataRange([p]);if(O=A.createDecodingTask(J),!O||O.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)V(null,this.entireBuffer.slice(J.firstByte,J.lastByte+1));else{const Q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${J.firstByte}-${J.lastByte}`}}),ce=i.bu(Q,V);if(c!==null){const ne=this._fetchQueuePerLayer.get(c)||[];ne.push((()=>{ce.cancel(),O.cancel()})),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,ne)}}}updateNeeded(s,c){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(s,c,p){if(!this._mrt)return;const x=this._mrt.getLayer(s);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:w,tileSize:A,buffer:M,offset:O,scale:z}=x.getBandView(p),B=A+2*M,G=new i.q({width:B,height:B},w),V=this.texturePerLayer.get(c);V&&V instanceof i.T&&V.update(G,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:s,band:p,img:G,buffer:M,offset:O,tileSize:A,format:x.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const c of this.texturePerLayer.values())c&&c instanceof i.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Vc{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,p){const x=s.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const w={value:c,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout((()=>{this.remove(s,w)}),p)),this.data[x].push(w),this.order.push(x),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const p=s.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),w=this.data[p][x];return this.data[p].splice(x,1),w.timeout&&clearTimeout(w.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(w.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const p in this.data)for(const x of this.data[p])s(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class ma{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,p){const x=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][x]=this.stateChanges[s][x]||{},Object.assign(this.stateChanges[s][x],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const w in this.state[s])w!==x&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][x]===null){this.deletedStates[s][x]={};for(const w in this.state[s][x])p[w]||(this.deletedStates[s][x][w]=null)}else for(const w in p)this.deletedStates[s]&&this.deletedStates[s][x]&&this.deletedStates[s][x][w]===null&&delete this.deletedStates[s][x][w]}removeFeatureState(s,c,p){if(this.deletedStates[s]===null)return;const x=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&c!==void 0)this.deletedStates[s][x]!==null&&(this.deletedStates[s][x]=this.deletedStates[s][x]||{},this.deletedStates[s][x][p]=null);else if(c!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][x])for(p in this.deletedStates[s][x]={},this.stateChanges[s][x])this.deletedStates[s][x][p]=null;else this.deletedStates[s][x]=null;else this.deletedStates[s]=null}getState(s,c){const p=this.state[s]||{},x=this.stateChanges[s]||{},w=this.deletedStates[s];if(w===null)return{};if(c!==void 0){const M=String(c),O=Object.assign({},p[M],x[M]);if(w){const z=w[c];if(z===null)return{};for(const B in z)delete O[B]}return O}const A=Object.assign({},p,x);if(w)for(const M in w)delete A[M];return A}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const w={};for(const A in this.stateChanges[x])this.state[x][A]||(this.state[x][A]={}),Object.assign(this.state[x][A],this.stateChanges[x][A]),w[A]=this.state[x][A];p[x]=w}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const w={};if(this.deletedStates[x]===null)for(const A in this.state[x])w[A]={},this.state[x][A]={};else for(const A in this.deletedStates[x]){if(this.deletedStates[x][A]===null)this.state[x][A]={};else if(this.state[x][A])for(const M of Object.keys(this.deletedStates[x][A]))delete this.state[x][A][M];w[A]=this.state[x][A]}p[x]=p[x]||{},Object.assign(p[x],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in s)s[x].refreshFeatureState(c)}}class As extends i.E{constructor(s,c,p){super(),this.id=s,this._onlySymbols=p,c.on("data",(x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),c.on("error",(()=>{this._sourceErrored=!0})),this._source=c,this._tiles={},this._cache=new Vc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ma,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(s),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((s=>s.tileID)).sort(Ll).map((s=>s.key))}getRenderableIds(s,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,s,c)&&p.push(this._tiles[x]);return s?p.sort(((x,w)=>{const A=x.tileID,M=w.tileID,O=new i.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),z=new i.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-M.overscaledZ||z.y-O.y||z.x-O.x})).map((x=>x.tileID.key)):p.map((x=>x.tileID)).sort(Ll).map((x=>x.key))}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,p){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(p||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,s,c)))}_tileLoaded(s,c,p,x){if(x)if(s.state="errored",x.status!==404)this._source.fire(new i.y(x,{tile:s}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=i.o.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new i.z("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const w=c[x];if(s.neighboringTiles&&s.neighboringTiles[w]){const A=this.getTileByID(w);p(s,A),p(A,s)}}function p(x,w){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let A=w.tileID.canonical.x-x.tileID.canonical.x;const M=w.tileID.canonical.y-x.tileID.canonical.y,O=Math.pow(2,x.tileID.canonical.z),z=w.tileID.key;A===0&&M===0||Math.abs(M)>1||(Math.abs(A)>1&&(Math.abs(A+O)===1?A+=O:Math.abs(A-O)===1&&(A-=O)),w.dem&&x.dem&&(x.dem.backfillBorder(w.dem,A,M),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,p,x){for(const w in this._tiles){let A=this._tiles[w];if(x[w]||!A.hasData()||A.tileID.overscaledZ<=c||A.tileID.overscaledZ>p)continue;let M=A.tileID;for(;A&&A.tileID.overscaledZ>c+1;){const z=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[z.key],A&&A.hasData()&&(M=z)}let O=M;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),s[O.key]){x[M.key]=M;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=s.overscaledZ-1;p>=c;p--){const x=s.scaledTo(p),w=this._getLoadedTile(x);if(w)return w}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const p=Math.ceil(s.width/c)+1,x=Math.ceil(s.height/c)+1,w=Math.floor(p*x*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(M)}handleWrapJump(s){const c=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,c){const p={};for(const x in this._tiles){const w=this._tiles[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),p[w.tileID.key]=w}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(s,c,p,x,w){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(s,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const A=this._source.type==="batched-model";let M,O=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const V=z.attenuationRange()[0],Y=Math.floor(V)-Math.log2(z.getDemUpscale());O>Y&&(O=Y)}if(this.used||this.usedForTerrain){if(this._source.tileID)M=s.getVisibleUnwrappedCoordinates(this._source.tileID).map((V=>new i.aO(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)));else if(this.tileCoverLift!==0){const V=s.clone();V.tileCoverLift=this.tileCoverLift,M=V.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:A}),this._source.minzoom<=1&&s.projection.name==="globe"&&(M.push(new i.aO(1,0,1,0,0)),M.push(new i.aO(1,0,1,1,0)),M.push(new i.aO(1,0,1,0,1)),M.push(new i.aO(1,0,1,1,1)))}else if(M=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:A}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);M=M.filter((Y=>V(Y)))}}else M=[];if(M.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!$c(this._source.type)){const V=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),Y=Math.min(V,this._source.maxzoom);if(A){const J=s.extendTileCover(M,Y);for(const Q of J)M.push(Q)}else if(w){const J=s.extendTileCoverToNearPlane(M,this.transform.getFrustum(Y),Y);for(const Q of J)M.push(Q)}else if(this.castsShadows&&x){const J=s.extendTileCover(M,Y,x);for(const Q of J)this._shadowCasterTiles[Q.key]=!0,M.push(Q)}}const B=this._updateRetainedTiles(M);if($c(this._source.type)&&M.length!==0){const V={},Y={},J=Object.keys(B);for(const ce of J){const ne=B[ce],he=this._tiles[ce];if(!he||he.fadeEndTime&&he.fadeEndTime<=i.o.now())continue;const me=this.findLoadedParent(ne,Math.max(ne.overscaledZ-As.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),V[me.tileID.key]=me.tileID),Y[ce]=ne}const Q=M[M.length-1].overscaledZ;for(const ce in this._tiles){const ne=this._tiles[ce];if(B[ce]||!ne.hasData())continue;let he=ne.tileID;for(;he.overscaledZ>Q;){he=he.scaledTo(he.overscaledZ-1);const me=this._tiles[he.key];if(me&&me.hasData()&&Y[he.key]){B[ce]=ne.tileID;break}}}for(const ce in V)B[ce]||(this._coveredTiles[ce]=!0,B[ce]=V[ce])}for(const V in B)this._tiles[V].clearFadeHold();const G=i.bv(this._tiles,B);for(const V of G){const Y=this._tiles[V];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(s.length===0)return c;const p={},x=s.reduce(((z,B)=>Math.min(z,B.overscaledZ)),1/0),w=s[0].overscaledZ,A=Math.max(w-As.maxOverzooming,this._source.minzoom),M=Math.max(w+As.maxUnderzooming,this._source.minzoom),O={};for(const z of s){const B=this._addTile(z);c[z.key]=z,B.hasData()||x<this._source.maxzoom&&(O[z.key]=z)}this._retainLoadedChildren(O,x,M,c);for(const z of s){let B=this._tiles[z.key];if(B.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const V=z.children(this._source.maxzoom)[0],Y=this.getTile(V);if(Y&&Y.hasData()){c[V.key]=V;continue}}else{const V=z.children(this._source.maxzoom);if(c[V[0].key]&&c[V[1].key]&&c[V[2].key]&&c[V[3].key])continue}let G=B.wasRequested();for(let V=z.overscaledZ-1;V>=A;--V){const Y=z.scaledTo(V);if(p[Y.key]||(p[Y.key]=!0,B=this.getTile(Y),!B&&G&&(B=this._addTile(Y)),B&&(c[Y.key]=Y,G=B.wasRequested(),B.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let p,x=this._tiles[s].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const w=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(w),p)break;x=w}for(const w of c)this._loadedParentTiles[w]=p}}_addTile(s){let c=this._tiles[s.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,w=this._source.tileSize*s.overscaleFactor();c=this._source.type==="raster-array"?new Ou(s,w,this.transform.tileZoom,x,this._isRaster):new dc(s,w,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c.uses++,this._tiles[s.key]=c,p||this._source.fire(new i.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=c.getExpiryTimeout();p&&(this._timers[s]=setTimeout((()=>{this._reloadTile(s,"expired"),delete this._timers[s]}),p))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,p){const x=[],w=this.transform;if(!w)return x;const A=w.projection.name==="globe",M=i.aF(w.center.lng);for(const O in this._tiles){const z=this._tiles[O];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let B;if(A){const G=z.tileID.canonical;if(G.z===0){const V=[Math.abs(i.aA(M,...jl(G,-1))-M),Math.abs(i.aA(M,...jl(G,1))-M)];B=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(i.aA(M,...jl(G,-1))-M),Math.abs(i.aA(M,...jl(G,0))-M),Math.abs(i.aA(M,...jl(G,1))-M)];B=[V.indexOf(Math.min(...V))-1]}}else B=[0];for(const G of B){const V=s.containsTile(z,w,c,G);V&&x.push(V)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const p=this.getRenderableIds(s,c).map((w=>this._tiles[w].tileID)),x=this.transform.projection.name==="globe";for(const w of p)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=x?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return p}sortCoordinatesByDistance(s){const c=s.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),w={};for(const A of c){const M=1/(1<<A.canonical.z);w[A.key]=((A.canonical.x+.5)*M+A.wrap-p[0])*x[0]+((A.canonical.y+.5)*M-p[1])*x[1]-p[2]*x[2]}return c.sort(((A,M)=>w[A.key]-w[M.key])),c}hasTransition(){if(this._source.hasTransition())return!0;if($c(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(s,c,p){this._state.updateState(s=s||"_geojsonTileLayer",c,p)}removeFeatureState(s,c,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,p)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,p){const x=this._tiles[s];x&&x.setDependencies(c,p)}reloadTilesForDependencies(s,c){for(const p in this._tiles)this._tiles[p].hasDependency(s,c)&&this._reloadTile(+p,"reloading");this._cache.filter((p=>!p.hasDependency(s,c)))}_preloadTiles(s,c){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(s,c))};return void this._source.on("data",O)}const p=new Map,x=Array.isArray(s)?s:[s],w=this.map.painter.terrain,A=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const O of x){const z=O.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of z)p.set(B.key,B);this.usedForTerrain&&O.updateElevation(!1)}const M=Array.from(p.values());i.bw(M,((O,z)=>{const B=new dc(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(B,(G=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),z(G,B)}))}),c)}}function Ll(m,s){const c=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-c||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function $c(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function jl(m,s){const c=1<<m.z;return[m.x/c+s,(m.x+1)/c+s]}As.maxOverzooming=10,As.maxUnderzooming=3;class yl{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:s,visibilityChanged:c});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:s,visibilityChanged:c})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(s)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(s)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(s)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,A=this.style.getLayerSourceCache(w);let M=1;w.type==="fill-extrusion"?M=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(M=x.visible?w.paint.get("building-vertical-scale"):0);let O=A?A.getTile(c):null;if(!O&&A)for(const z in A._tiles){const B=A._tiles[z];if(c.canonical.isChildOf(B.tileID.canonical)){O=B;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:c,verticalScale:M})}s.hasAnyZOffset=!1;let p=!1;for(let x=0;x<s.symbolInstances.length;x++){const w=s.symbolInstances.get(x),A=w.zOffset,M=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=M!==Number.NEGATIVE_INFINITY?M:A,p||A===w.zOffset||(p=!0),s.hasAnyZOffset||w.zOffset===0||(s.hasAnyZOffset=!0)}p&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,p,x){let w=c,A=p;if(s.canonical.z!==x.canonical.z){const M=x.canonical,O=1/(1<<s.canonical.z-M.z);w=(c+s.canonical.x*i.al)*O-M.x*i.al|0,A=(p+s.canonical.y*i.al)*O-M.y*i.al|0}return{tileX:w,tileY:A}}_getHeightAtTileOffset(s,c,p){let x,w;for(let A=0;A<this.layers.length;++A){const M=this.layers[A].layer;if(M.type!=="fill-extrusion"&&M.type!=="building")continue;const{bucket:O,tileID:z,verticalScale:B}=this.currentBuildingBuckets[A];if(!O)continue;const{tileX:G,tileY:V}=this._mapCoordToOverlappingTile(s,c,p,z),Y=O.getHeightAtTileCoord(G,V);Y&&Y.height!==void 0&&(Y.hidden?x=Y.height:w=Math.max(Y.height*B,w||0))}if(w!==void 0)return w;for(let A=0;A<this.layers.length;++A){const M=this.layers[A];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:O,tileID:z}=this.currentBuildingBuckets[A];if(!O)continue;const{tileX:B,tileY:G}=this._mapCoordToOverlappingTile(s,c,p,z),V=O.getHeightAtTileCoord(B,G);if(V&&!V.hidden)return V.height===void 0&&x!==void 0?Math.min(V.maxHeight,x)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Um(m,s){const c={};for(const p in m)p!=="ref"&&(c[p]=m[p]);return i.bx.forEach((p=>{p in s&&(c[p]=s[p])})),c}function Kd(m){m=m.slice();const s=Object.create(null);for(let c=0;c<m.length;c++)s[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=Um(m[c],s[m[c].ref]));return m}const br={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Zh(m,s,c){c.push({command:br.addSource,args:[m,s[m]]})}function Vm(m,s,c){s.push({command:br.removeSource,args:[m]}),c[m]=!0}function Jd(m,s,c,p){Vm(m,c,p),Zh(m,s,c)}function Qd(m,s,c){let p;for(p in m[c])if(m[c].hasOwnProperty(p)&&p!=="data"&&!i.by(m[c][p],s[c][p]))return!1;for(p in s[c])if(s[c].hasOwnProperty(p)&&p!=="data"&&!i.by(m[c][p],s[c][p]))return!1;return!0}function Hc(m,s,c,p,x,w){let A;for(A in s=s||{},m=m||{})m.hasOwnProperty(A)&&(i.by(m[A],s[A])||c.push({command:w,args:[p,A,s[A],x]}));for(A in s)s.hasOwnProperty(A)&&!m.hasOwnProperty(A)&&(i.by(m[A],s[A])||c.push({command:w,args:[p,A,s[A],x]}))}function zl(m){return m.id}function fc(m,s){return m[s.id]=s,m}function pc(m,s,c){const p=s.createTileMatrix(m,m.worldSize,c.toUnwrapped());return i.aB(new Float32Array(16),m.projMatrix,p)}function ef(m,s,c){if(s.projection.name===c.projection.name)return m.projMatrix;const p=c.clone();return p.setProjection(s.projection),pc(p,s.getProjection(),m)}function Du(m,s,c){return s.name===c.projection.name?m.projMatrix:pc(c,s,m)}class f_{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=i.aA(s,0,1);let c=1,p=this._distances[c];const x=s*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const w=c-1,A=this._distances[w],M=p-A,O=M>0?(x-A)/M:0;return this.points[w].mult(1-O).add(this.points[c].mult(O))}}class tf{constructor(s,c,p){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(c/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,p,x,w){this._forEachCell(c,p,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(s,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(s,c,p,x,w,A){this.boxCells[w].push(A)}_insertCircleCell(s,c,p,x,w,A){this.circleCells[w].push(A)}_query(s,c,p,x,w,A){if(p<0||s>this.width||x<0||c>this.height)return!w&&[];const M=[];if(s<=0&&c<=0&&this.width<=p&&this.height<=x){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)M.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const z=this.circles[3*O],B=this.circles[3*O+1],G=this.circles[3*O+2];M.push({key:this.circleKeys[O],x1:z-G,y1:B-G,x2:z+G,y2:B+G})}return A?M.filter(A):M}return this._forEachCell(s,c,p,x,this._queryCell,M,{hitTest:w,seenUids:{box:{},circle:{}}},A),w?M.length>0:M}_queryCircle(s,c,p,x,w){const A=s-p,M=s+p,O=c-p,z=c+p;if(M<0||A>this.width||z<0||O>this.height)return!x&&[];const B=[];return this._forEachCell(A,O,M,z,this._queryCellCircle,B,{hitTest:x,circle:{x:s,y:c,radius:p},seenUids:{box:{},circle:{}}},w),x?B.length>0:B}query(s,c,p,x,w){return this._query(s,c,p,x,!1,w)}hitTest(s,c,p,x,w){return this._query(s,c,p,x,!0,w)}hitTestCircle(s,c,p,x){return this._queryCircle(s,c,p,!0,x)}_queryCell(s,c,p,x,w,A,M,O){const z=M.seenUids,B=this.boxCells[w];if(B!==null){const V=this.bboxes;for(const Y of B)if(!z.box[Y]){z.box[Y]=!0;const J=4*Y;if(s<=V[J+2]&&c<=V[J+3]&&p>=V[J+0]&&x>=V[J+1]&&(!O||O(this.boxKeys[Y]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Y],x1:V[J],y1:V[J+1],x2:V[J+2],y2:V[J+3]})}}}const G=this.circleCells[w];if(G!==null){const V=this.circles;for(const Y of G)if(!z.circle[Y]){z.circle[Y]=!0;const J=3*Y;if(this._circleAndRectCollide(V[J],V[J+1],V[J+2],s,c,p,x)&&(!O||O(this.circleKeys[Y]))){if(M.hitTest)return A.push(!0),!0;{const Q=V[J],ce=V[J+1],ne=V[J+2];A.push({key:this.circleKeys[Y],x1:Q-ne,y1:ce-ne,x2:Q+ne,y2:ce+ne})}}}}}_queryCellCircle(s,c,p,x,w,A,M,O){const z=M.circle,B=M.seenUids,G=this.boxCells[w];if(G!==null){const Y=this.bboxes;for(const J of G)if(!B.box[J]){B.box[J]=!0;const Q=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,Y[Q+0],Y[Q+1],Y[Q+2],Y[Q+3])&&(!O||O(this.boxKeys[J])))return A.push(!0),!0}}const V=this.circleCells[w];if(V!==null){const Y=this.circles;for(const J of V)if(!B.circle[J]){B.circle[J]=!0;const Q=3*J;if(this._circlesCollide(Y[Q],Y[Q+1],Y[Q+2],z.x,z.y,z.radius)&&(!O||O(this.circleKeys[J])))return A.push(!0),!0}}}_forEachCell(s,c,p,x,w,A,M,O){const z=this._convertToXCellCoord(s),B=this._convertToYCellCoord(c),G=this._convertToXCellCoord(p),V=this._convertToYCellCoord(x);for(let Y=z;Y<=G;Y++)for(let J=B;J<=V;J++)if(w.call(this,s,c,p,x,this.xCellCount*J+Y,A,M,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,p,x,w,A){const M=x-s,O=w-c,z=p+A;return z*z>M*M+O*O}_circleAndRectCollide(s,c,p,x,w,A,M){const O=(A-x)/2,z=Math.abs(s-(x+O));if(z>O+p)return!1;const B=(M-w)/2,G=Math.abs(c-(w+B));if(G>B+p)return!1;if(z<=O||G<=B)return!0;const V=z-O,Y=G-B;return V*V+Y*Y<=p*p}}const mc={unknown:0,flipRequired:1,flipNotRequired:2},Xh=Math.tan(85*Math.PI/180);function Va(m,s,c,p,x,w,A){const M=i.bC();if(c)if(w.name==="globe"){const O=i.bD(x,s);i.aB(M,M,O)}else{const O=i.bE([],A);M[0]=O[0],M[1]=O[1],M[4]=O[2],M[5]=O[3],p||i.bB(M,M,x.angle)}else i.aB(M,x.labelPlaneMatrix,m);return M}function $a(m,s,c,p,x,w,A){const M=Va(m,s,c,p,x,w,A);return w.name==="globe"&&c||(M[2]=M[6]=M[10]=M[14]=0),M}function Yh(m,s,c,p,x,w,A){if(c){if(w.name==="globe"){const M=Va(m,s,c,p,x,w,A);return i.bl(M,M),i.aB(M,m,M),M}{const M=i.bz(m),O=i.bA([]);return O[0]=A[0],O[1]=A[1],O[4]=A[2],O[5]=A[3],i.aB(M,M,O),p||i.bB(M,M,-x.angle),M}}return x.glCoordMatrix}function yo(m,s,c,p){const x=[m,s,c,1];c?i.aC(x,x,p):sf(x,x,p);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Gc(m,s){return Math.min(.5+m/s*.5,1.5)}function vo(m,s){const c=m[0]/m[3],p=m[1]/m[3];return c>=-s[0]&&c<=s[0]&&p>=-s[1]&&p<=s[1]}function Kh(m,s,c,p,x,w,A,M,O,z){const B=c.transform,G=p?m.textSizeData:m.iconSizeData,V=i.bK(G,c.transform.zoom),Y=B.projection.name==="globe",J=[256/c.width*2+1,256/c.height*2+1],Q=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();let ce=null;Y&&(ce=p?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ne=m.lineVertexArray,he=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,me=c.transform.width/c.transform.height;let ve,Pe=!1;for(let Ae=0;Ae<he.length;Ae++){const Ie=he.get(Ae),{numGlyphs:Ce,writingMode:Te}=Ie;if(Te!==i.bL.vertical||Pe||ve===i.bL.horizontal||(Pe=!0),ve=Te,(Ie.hidden||Te===i.bL.vertical)&&!Pe){An(Ce,Q);continue}Pe=!1;const Me=new i.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:Ke,y:Be,z:at}=B.projection.projectTilePoint(Me.x,Me.y,z.canonical);if(O){const[wt,dn,cn]=O(Me);Ke+=wt,Be+=dn,at+=cn}const Xe=[Ke,Be,at,1];if(i.aC(Xe,Xe,s),!vo(Xe,J)){An(Ce,Q);continue}const Qe=Xe[3],At=Gc(c.transform.getCameraToCenterDistance(B.projection),Qe),Ye=i.bM(G,V,Ie),je=A?Ye/At:Ye*At,ut=yo(Ke,Be,at,x);if(ut[3]<=0){An(Ce,Q);continue}let tt={};const vt=i.an(m.layers[0].layout.get("text-max-angle")),Dt=Math.cos(vt),Gt=A?null:O,Pt=Ir(Ie,je,!1,M,s,x,w,m.glyphOffsetArray,ne,Q,ce,ut,Me,tt,me,Gt,B.projection,z,A,Dt);Pe=Pt.useVertical,Gt&&Pt.needsFlipping&&(tt={}),(Pt.notEnoughRoom||Pe||Pt.needsFlipping&&Ir(Ie,je,!0,M,s,x,w,m.glyphOffsetArray,ne,Q,ce,ut,Me,tt,me,Gt,B.projection,z,A,Dt).notEnoughRoom)&&An(Ce,Q)}p?(m.text.dynamicLayoutVertexBuffer.updateData(Q),ce&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ce)):(m.icon.dynamicLayoutVertexBuffer.updateData(Q),ce&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ce))}function nf(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce){const{lineStartIndex:ne,glyphStartIndex:he,segment:me}=M,ve=he+M.numGlyphs,Pe=ne+M.lineLength,Ae=s.getoffsetX(he),Ie=s.getoffsetX(ve-1),Ce=Ep(m*Ae,c,p,x,w,A,me,ne,Pe,O,z,B,G,V,!0,Y,J,Q,ce);if(!Ce)return null;const Te=Ep(m*Ie,c,p,x,w,A,me,ne,Pe,O,z,B,G,V,!0,Y,J,Q,ce);return Te?{first:Ce,last:Te}:null}function Lo(m,s,c,p){return m===i.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:m===i.bL.vertical?p>0?{needsFlipping:!0}:null:s!==mc.unknown&&(function(x,w){return x===0||Math.abs(w/x)>Xh})(c,p)?s===mc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Ir(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne,he,me){const ve=s/24,Pe=m.lineOffsetX*ve,Ae=m.lineOffsetY*ve,{lineStartIndex:Ie,glyphStartIndex:Ce,numGlyphs:Te,segment:Me,writingMode:Ke,flipState:Be}=m,at=Ie+m.lineLength,Xe=Qe=>{if(B){const[ut,tt,vt]=Qe.up,Dt=z.length;i.bN(B,Dt+0,ut,tt,vt),i.bN(B,Dt+1,ut,tt,vt),i.bN(B,Dt+2,ut,tt,vt),i.bN(B,Dt+3,ut,tt,vt)}const[At,Ye,je]=Qe.point;i.bO(z,At,Ye,je,Qe.angle)};if(Te>1){const Qe=nf(ve,M,Pe,Ae,c,G,V,m,O,w,Y,Q,!1,ce,ne,he,me);if(!Qe)return{notEnoughRoom:!0};if(p&&!c){let[At,Ye,je]=Qe.first.point,[ut,tt,vt]=Qe.last.point;[At,Ye]=yo(At,Ye,je,A),[ut,tt]=yo(ut,tt,vt,A);const Dt=Lo(Ke,Be,(ut-At)*J,tt-Ye);if(m.flipState=Dt&&Dt.needsFlipping?mc.flipRequired:mc.flipNotRequired,Dt)return Dt}Xe(Qe.first);for(let At=Ce+1;At<Ce+Te-1;At++){const Ye=Ep(ve*M.getoffsetX(At),Pe,Ae,c,G,V,Me,Ie,at,O,w,Y,Q,!1,!1,ce,ne,he,me);if(!Ye)return z.length-=4*(At-Ce),{notEnoughRoom:!0};Xe(Ye)}Xe(Qe.last)}else{if(p&&!c){const At=yo(V.x,V.y,0,x),Ye=Ie+Me+1,je=new i.P(O.getx(Ye),O.gety(Ye)),ut=yo(je.x,je.y,0,x),tt=ut[3]>0?ut:Jh(V,je,At,1,x,void 0,ce,ne.canonical),vt=Lo(Ke,Be,(tt[0]-At[0])*J,tt[1]-At[1]);if(m.flipState=vt&&vt.needsFlipping?mc.flipRequired:mc.flipNotRequired,vt)return vt}const Qe=Ep(ve*M.getoffsetX(Ce),Pe,Ae,c,G,V,Me,Ie,at,O,w,Y,Q,!1,!1,ce,ne,he,me);if(!Qe)return{notEnoughRoom:!0};Xe(Qe)}return{}}function rf(m,s,c,p,x){const{x:w,y:A,z:M}=p.projectTilePoint(m.x,m.y,s);if(!x)return yo(w,A,M,c);const[O,z,B]=x(m);return yo(w+O,A+z,M+B,c)}function Jh(m,s,c,p,x,w,A,M){const O=rf(m.sub(s)._unit()._add(m),M,x,A,w);return i.av(O,c,O),i.aw(O,O),i.bH(O,c,O,p)}function Ep(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne,he){const me=p?m-s:m+s;let ve=me>0?1:-1,Pe=0;p&&(ve*=-1,Pe=Math.PI),ve<0&&(Pe+=Math.PI);let Ae=M+A+(ve>0?0:1)|0,Ie=x,Ce=x,Te=0,Me=0;const Ke=Math.abs(me),Be=[],at=[];let Xe=w,Qe=Xe,At=i.bF([]);const Ye=()=>Jh(Qe,Xe,Ce,Ke-Te+1,B,V,Q,ce.canonical);for(;Te+Me<=Ke;){if(Ae+=ve,Ae<M||Ae>=O)return null;if(Ce=Ie,Qe=Xe,Be.push(Ce),Y&&at.push(Qe),Xe=new i.P(z.getx(Ae),z.gety(Ae)),Ie=G[Ae],!Ie){const cn=rf(Xe,ce.canonical,B,Q,V);Ie=cn[3]>0?G[Ae]=cn:Ye()}Te+=Me;const wt=i.av([],Ie,Ce),dn=i.bG(Ce,Ie);if(c&&dn>0&&Me>0&&i.bJ(At,wt)/(Me*dn)<he)return null;Me=dn,At=wt}J&&V&&(G[Ae]&&(Ie=Ye(),Me=i.bG(Ce,Ie),At=i.av([],Ie,Ce)),G[Ae]=Ie);const je=(Ke-Te)/Me,ut=Xe.sub(Qe)._mult(je)._add(Qe),tt=i.bH([],Ce,At,je);let vt=[0,0,1],Dt=At[0],Gt=At[1];if(ne&&(vt=Q.upVector(ce.canonical,ut.x,ut.y),vt[0]!==0||vt[1]!==0||vt[2]!==1)){const wt=[vt[2],0,-vt[0]],dn=i.bI([],vt,wt);i.aw(wt,wt),i.aw(dn,dn),Dt=i.bJ(At,wt),Gt=i.bJ(At,dn)}if(c){const wt=i.bI([],vt,At);i.aw(wt,wt),i.bH(tt,tt,wt,c*ve)}const Pt=Pe+Math.atan2(Gt,Dt);return Be.push(tt),Y&&at.push(ut),{point:tt,angle:Pt,path:Be,tilePath:at,up:vt}}function An(m,s){const c=s.length,p=c+4*m;s.resize(p),s.float32.fill(-1/0,4*c,4*p)}function sf(m,s,c){const p=s[0],x=s[1];return m[0]=c[0]*p+c[4]*x+c[12],m[1]=c[1]*p+c[5]*x+c[13],m[3]=c[3]*p+c[7]*x+c[15],m}const so=100;class Ko{constructor(s,c,p=new tf(s.width+200,s.height+200,25),x=new tf(s.width+200,s.height+200,25)){this.transform=s,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+so,this.screenBottomBoundary=s.height+so,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,p,x,w,A,M,O,z,B,G){let V=p.projectedAnchorX,Y=p.projectedAnchorY,J=p.projectedAnchorZ;const Q=p.tileAnchorX,ce=p.tileAnchorY,ne=p.elevation,he=p.tileID,me=s.getProjection();if(ne&&he){const[at,Xe,Qe]=me.upVector(he.canonical,p.tileAnchorX,p.tileAnchorY),At=me.upVectorScale(he.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=at*ne*At,Y+=Xe*ne*At,J+=Qe*ne*At}const ve=s.projection.name==="globe",Pe=s.projection.name==="globe"?i.aj(this.transform.zoom):0;if(he&&ve&&Pe<1&&!A){const at=1<<he.canonical.z,Xe=i.bP(Q,ce);i.bQ(Xe,Xe,1/i.al),i.bR(Xe,Xe,i.bP(he.canonical.x,he.canonical.y)),i.bQ(Xe,Xe,1/at),i.bS(Xe,Xe,i.bP(x[0],x[1])),Xe[0]=i.bT(Xe[0],-.5,.5),i.bQ(Xe,Xe,i.al);const Qe=i.bU(Xe[0],Xe[1],i.al/(2*Math.PI),1);i.aC(Qe,Qe,w),V=i.ak(V,Qe[0],Pe),Y=i.ak(Y,Qe[1],Pe),J=i.ak(J,Qe[2],Pe)}const Ae=this.projectAndGetPerspectiveRatio(B,V,Y,J,p.tileID,me.name==="globe"||!!ne||this.transform.pitch>0,me),Ie=z*Ae.perspectiveRatio,Ce=(p.x1*c+M.x-p.padding)*Ie+Ae.point.x,Te=(p.y1*c+M.y-p.padding)*Ie+Ae.point.y,Me=(p.x2*c+M.x+p.padding)*Ie+Ae.point.x,Ke=(p.y2*c+M.y+p.padding)*Ie+Ae.point.y,Be=Ae.perspectiveRatio<=.55||Ae.occluded;return!this.isInsideGrid(Ce,Te,Me,Ke)||!O&&this.grid.hitTest(Ce,Te,Me,Ke,G)||Be?{box:[],offscreen:!1,occluded:Ae.occluded}:{box:[Ce,Te,Me,Ke],offscreen:this.isOffscreen(Ce,Te,Me,Ke),occluded:!1}}placeCollisionCircles(s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q){const ce=[],ne=this.transform.elevation,he=s.getProjection(),me=ne?ne.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,he):null,ve=new i.P(p.tileAnchorX,p.tileAnchorY);let{x:Pe,y:Ae,z:Ie}=he.projectTilePoint(ve.x,ve.y,Q.canonical);if(me){const[vt,Dt,Gt]=me(ve);Pe+=vt,Ae+=Dt,Ie+=Gt}const Ce=he.name==="globe",Te=this.projectAndGetPerspectiveRatio(M,Pe,Ae,Ie,Q,Ce||!!ne||this.transform.pitch>0,he),{perspectiveRatio:Me}=Te,Ke=(G?A/Me:A*Me)/i.bX,Be=yo(Pe,Ae,Ie,O),at=p.lineOffsetX*Ke,Xe=p.lineOffsetY*Ke,Qe=i.an(s.layers[0].layout.get("text-max-angle")),At=Math.cos(Qe),Ye=Te.signedDistanceFromCamera>0?nf(Ke,w,at,Xe,!1,Be,ve,p,x,O,{},ne&&!G?me:null,G&&!!ne,he,Q,G,At):null;let je=!1,ut=!1,tt=!0;if(Ye&&!Te.occluded){const vt=.5*Y*Me+J,Dt=new i.P(-100,-100),Gt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new f_,{first:wt,last:dn}=Ye,cn=wt.path.length;let ln=[];for(let Un=cn-1;Un>=1;Un--)ln.push(wt.path[Un]);for(let Un=1;Un<dn.path.length;Un++)ln.push(dn.path[Un]);const un=2.5*vt;z&&(ln=ln.map((([Un,Wn,Fr],Bn)=>(me&&!Ce&&(Fr=me(Bn<cn-1?wt.tilePath[cn-1-Bn]:dn.tilePath[Bn-cn+2])[2]),yo(Un,Wn,Fr,z)))),ln.some((Un=>Un[3]<=0))&&(ln=[]));let jn=[];if(ln.length>0){let Un=1/0,Wn=-1/0,Fr=1/0,Bn=-1/0;for(const Ar of ln)Un=Math.min(Un,Ar[0]),Fr=Math.min(Fr,Ar[1]),Wn=Math.max(Wn,Ar[0]),Bn=Math.max(Bn,Ar[1]);Wn>=Dt.x&&Un<=Gt.x&&Bn>=Dt.y&&Fr<=Gt.y&&(jn=[ln.map((Ar=>new i.P(Ar[0],Ar[1])))],(Un<Dt.x||Wn>Gt.x||Fr<Dt.y||Bn>Gt.y)&&(jn=i.bV(jn,Dt.x,Dt.y,Gt.x,Gt.y)))}for(const Un of jn){Pt.reset(Un,.25*vt);let Wn=0;Wn=Pt.length<=.5*vt?1:Math.ceil(Pt.paddedLength/un)+1;for(let Fr=0;Fr<Wn;Fr++){const Bn=Fr/Math.max(Wn-1,1),Ar=Pt.lerp(Bn),Lr=Ar.x+so,Hr=Ar.y+so;ce.push(Lr,Hr,vt,0);const Xn=Lr-vt,Sr=Hr-vt,Mr=Lr+vt,tr=Hr+vt;if(tt=tt&&this.isOffscreen(Xn,Sr,Mr,tr),ut=ut||this.isInsideGrid(Xn,Sr,Mr,tr),!c&&this.grid.hitTestCircle(Lr,Hr,vt,V)&&(je=!0,!B))return{circles:[],offscreen:!1,collisionDetected:je,occluded:!1}}}}return{circles:!B&&je||!ut?[]:ce,offscreen:tt,collisionDetected:je,occluded:Te.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,w=-1/0,A=-1/0;for(const B of s){const G=new i.P(B.x+so,B.y+so);p=Math.min(p,G.x),x=Math.min(x,G.y),w=Math.max(w,G.x),A=Math.max(A,G.y),c.push(G)}const M=this.grid.query(p,x,w,A).concat(this.ignoredGrid.query(p,x,w,A)),O={},z={};for(const B of M){const G=B.key;if(O[G.bucketInstanceId]===void 0&&(O[G.bucketInstanceId]={}),O[G.bucketInstanceId][G.featureIndex])continue;const V=[new i.P(B.x1,B.y1),new i.P(B.x2,B.y1),new i.P(B.x2,B.y2),new i.P(B.x1,B.y2)];i.bW(c,V)&&(O[G.bucketInstanceId][G.featureIndex]=!0,z[G.bucketInstanceId]===void 0&&(z[G.bucketInstanceId]=[]),z[G.bucketInstanceId].push(G.featureIndex))}return z}insertCollisionBox(s,c,p,x,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:w},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,p,x,w){const A=c?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:x,collisionGroupID:w};for(let O=0;O<s.length;O+=4)A.insertCircle(M,s[O],s[O+1],s[O+2])}projectAndGetPerspectiveRatio(s,c,p,x,w,A,M){const O=[c,p,x,1];let z=!1;x||this.transform.pitch>0?(i.aC(O,O,s),this.fogState&&w&&M.name!=="globe"&&(z=(function(V,Y,J,Q,ce,ne){const he=ne.calculateFogTileMatrix(ce),me=[Y,J,Q];return i.af(me,me,he),Rn(V,i.ag(me),ne.pitch,ne._fov)})(this.fogState,c,p,x,w.toUnwrapped(),this.transform)>.9)):sf(O,O,s);const B=O[3];return{point:new i.P((O[0]/B+1)/2*this.transform.width+so,(-O[1]/B+1)/2*this.transform.height+so),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/B*.5,1.5),signedDistanceFromCamera:B,occluded:A&&O[2]>B||z}}isOffscreen(s,c,p,x){return p<so||s>=this.screenRightBoundary||x<so||c>this.screenBottomBoundary}isInsideGrid(s,c,p,x){return p>=0&&s<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=i.bA([]);return i.br(s,s,[-100,-100,0]),s}}class of{constructor(s,c,p,x){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Nl{constructor(s,c,p,x,w,A=!1){this.text=new of(s?s.text:null,c,p,w),this.icon=new of(s?s.icon:null,c,x,w),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _n{constructor(s,c,p,x=!1){this.text=s,this.icon=c,this.skipFade=p,this.clipped=x}}class Nr{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class zr{constructor(s,c,p,x,w){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=w}}class Jo{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[s]}}function Lu(m,s,c,p,x){const{horizontalAlign:w,verticalAlign:A}=i.c0(m),M=-(w-.5)*s,O=-(A-.5)*c,z=i.c1(m,p);return new i.P(M+z[0]*x,O+z[1]*x)}function Dr(m,s,c,p,x){const w=new i.P(m,s);return c&&w._rotate(p?x:-x),w}class Ap{constructor(s,c,p,x,w,A){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Ko(this.transform,w),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Jo(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,p,x,w=1){const A=p.getBucket(c),M=p.latestFeatureIndex;if(!A||!M||c.fqid!==A.layerIds[0])return;const O=A.layers[0].layout,z=A.layers[0].paint,B=p.collisionBoxArray,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/i.al,Y=p.tileID.toUnwrapped();this.transform.setProjection(A.projection);const J=(Q=p.tileID,ce=A.getProjection(),ne=this.transform,ce.name===this.projection?ne.calculateProjMatrix(Q.toUnwrapped()):pc(ne,ce,Q));var Q,ce,ne;const he=O.get("text-pitch-alignment")==="map",me=O.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const ve=c.dynamicFilter(),Pe=c.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(p),Ie=$a(J,p.tileID.canonical,he,me,this.transform,A.getProjection(),Ae);let Ce=null;const Te=A.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(he){const je=Yh(J,p.tileID.canonical,he,me,this.transform,A.getProjection(),Ae);Ce=i.aB([],this.transform.labelPlaneMatrix,je)}let Me=null;ve&&p.latestFeatureIndex&&(Me={unwrappedTileID:Y,dynamicFilter:ve,dynamicFilterNeedsFeature:Pe}),this.retainedQueryData[A.bucketInstanceId]=new zr(A.bucketInstanceId,M,A.sourceLayerIndex,A.index,p.tileID);const[Ke,Be]=A.layers[0].layout.get("text-size-scale-range"),at=i.aA(w,Ke,Be),[Xe,Qe]=O.get("icon-size-scale-range"),At=i.aA(w,Xe,Qe),Ye={bucket:A,layout:O,paint:z,posMatrix:J,invMatrix:Te,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ie,labelToScreenMatrix:Ce,clippingData:Me,scale:G,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:i.bK(A.textSizeData,this.transform.zoom,at),partiallyEvaluatedIconSize:i.bK(A.iconSizeData,this.transform.zoom,At),collisionGroup:this.collisionGroups.get(A.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const je of A.sortKeyRanges){const{sortKey:ut,symbolInstanceStart:tt,symbolInstanceEnd:vt}=je;s.push({sortKey:ut,symbolInstanceStart:tt,symbolInstanceEnd:vt,parameters:Ye})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne,he,me,ve,Pe){const{textOffset0:Ae,textOffset1:Ie,crossTileID:Ce}=Q,Te=[Ae,Ie],Me=Lu(s,A,M,Te,O),Ke=this.collisionIndex.placeCollisionBox(ne,O,c,p,x,w,Dr(Me.x,Me.y,z,B,this.transform.angle),J,G,V,Y.predicate);if(me){const Be=ne.getSymbolInstanceIconSize(Pe,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ne,Be,me,p,x,w,Dr(Me.x,Me.y,z,B,this.transform.angle),J,G,V,Y.predicate).box.length===0)return}if(Ke.box.length>0){let Be;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ce]&&this.prevPlacement.placements[Ce]&&this.prevPlacement.placements[Ce].text&&(Be=this.prevPlacement.variableOffsets[Ce].anchor),this.variableOffsets[Ce]={textOffset:Te,width:A,height:M,anchor:s,textScale:O,prevAnchor:Be},this.markUsedJustification(ne,s,Q,he),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,he,Q),this.placedOrientations[Ce]=he),{shift:Me,placedGlyphBoxes:Ke}}}placeLayerBucketPart(s,c,p,x,w=1){const{bucket:A,layout:M,paint:O,posMatrix:z,textLabelPlaneMatrix:B,labelToScreenMatrix:G,clippingData:V,textPixelRatio:Y,mercatorCenter:J,invMatrix:Q,holdingForFade:ce,collisionBoxArray:ne,partiallyEvaluatedTextSize:he,partiallyEvaluatedIconSize:me,collisionGroup:ve,latestFeatureIndex:Pe}=s.parameters,Ae=M.get("text-optional"),Ie=M.get("icon-optional"),Ce=M.get("text-allow-overlap"),Te=M.get("icon-allow-overlap"),Me=M.get("text-rotation-alignment")==="map",Ke=M.get("icon-rotation-alignment")==="map",Be=M.get("text-pitch-alignment")==="map",at=O.get("symbol-z-offset"),Xe=M.get("symbol-elevation-reference")==="sea",Qe=M.get("symbol-placement"),[At,Ye]=M.get("text-size-scale-range"),[je,ut]=M.get("icon-size-scale-range"),tt=i.aA(w,At,Ye),vt=i.aA(w,je,ut),Dt=M.get("text-variable-anchor"),Gt=Me&&Qe!=="point",Pt=Ke&&Qe!=="point",wt=Dt&&A.hasTextData(),dn=A.hasIconTextFit()&&wt&&A.hasIconData();this.transform.setProjection(A.projection);const cn=wt||Gt,ln=Pt||dn;let un=Ce&&(Te||!A.hasIconData()||Ie),jn=Te&&(Ce||!A.hasTextData()||Ae);const Un=!at.isConstant();!A.collisionArrays&&ne&&A.deserializeCollisionBoxes(ne),p&&x&&A.updateCollisionDebugBuffers(this.transform.zoom,ne,tt,vt);const Wn=(Bn,Ar,Lr)=>{const{crossTileID:Hr,numVerticalGlyphVertices:Xn}=Bn;let Sr=null;if(V&&V.dynamicFilterNeedsFeature||Un){const Li=this.retainedQueryData[A.bucketInstanceId];Sr=Pe.loadFeature({featureIndex:Bn.featureIndex,bucketIndex:Li.bucketIndex,sourceLayerIndex:Li.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Sr,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new i.P(Bn.tileAnchorX,Bn.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Hr]=new _n(!1,!1,!1,!0),void c.add(Hr);const Mr=at.evaluate(Sr,{});if(c.has(Hr))return;if(ce)return void(this.placements[Hr]=new _n(!1,!1,!1));let tr=!1,fi=!1,Di=!0,gs=!1,pi=!1,Yn=null,Mn={box:null,offscreen:null,occluded:null},Br={box:null},Gr=null,ai=null,Zi=null,Gi=0,To=0,Us=0;Lr.textFeatureIndex?Gi=Lr.textFeatureIndex:Bn.useRuntimeCollisionCircles&&(Gi=Bn.featureIndex),Lr.verticalTextFeatureIndex&&(To=Lr.verticalTextFeatureIndex);const ho=Li=>{Li.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const ji=this.transform.elevation;Li.elevation=Xe?Mr:Mr+(ji?ji.getAtTileOffset(Li.tileID,Li.tileAnchorX,Li.tileAnchorY):0),Li.elevation+=Bn.zOffset},Eo=Lr.textBox;if(Eo){ho(Eo);const Li=mi=>{let Wi=i.bL.horizontal;if(A.allowVerticalPlacement&&!mi&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[Hr];Ji&&(this.placedOrientations[Hr]=Ji,Wi=Ji,this.markUsedOrientation(A,Wi,Bn))}return Wi},ji=(mi,Wi)=>{if(A.allowVerticalPlacement&&Xn>0&&Lr.verticalTextBox){for(const Ji of A.writingModes)if(Ji===i.bL.vertical?(Mn=Wi(),Br=Mn):Mn=mi(),Mn&&Mn.box&&Mn.box.length)break}else Mn=mi()};if(Dt){let mi=Dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Hr]){const Ui=this.prevPlacement.variableOffsets[Hr];mi.indexOf(Ui.anchor)>0&&(mi=mi.filter((Ps=>Ps!==Ui.anchor)),mi.unshift(Ui.anchor))}const Wi=(Ui,Ps,Zl)=>{const Xl=A.getSymbolInstanceTextSize(he,Bn,this.transform.zoom,Ar),Ma=(Ui.x2-Ui.x1)*Xl+2*Ui.padding,Cl=(Ui.y2-Ui.y1)*Xl+2*Ui.padding,Yl=Bn.hasIconTextFit&&!Te?Ps:null;Yl&&ho(Yl);let ka={box:[],offscreen:!1,occluded:!1};const yh=Ce?2*mi.length:mi.length;for(let Pc=0;Pc<yh;++Pc){const Ra=this.attemptAnchorPlacement(mi[Pc%mi.length],Ui,J,Q,cn,Ma,Cl,Xl,Me,Be,Y,z,ve,Pc>=mi.length,Bn,Ar,A,Zl,Yl,he,me);if(Ra&&(ka=Ra.placedGlyphBoxes,ka&&ka.box&&ka.box.length)){tr=!0,Yn=Ra.shift;break}}return ka};ji((()=>Wi(Eo,Lr.iconBox,i.bL.horizontal)),(()=>{const Ui=Lr.verticalTextBox;return Ui&&ho(Ui),A.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&Xn>0&&Ui?Wi(Ui,Lr.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}})),Mn&&(tr=Mn.box,Di=Mn.offscreen,gs=Mn.occluded);const Ji=Li(!(!Mn||!Mn.box));if(!tr&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[Hr];Ui&&(this.variableOffsets[Hr]=Ui,this.markUsedJustification(A,Ui.anchor,Bn,Ji))}}else{const mi=(Wi,Ji)=>{const Ui=A.getSymbolInstanceTextSize(he,Bn,this.transform.zoom,Ar),Ps=this.collisionIndex.placeCollisionBox(A,Ui,Wi,J,Q,cn,new i.P(0,0),Ce,Y,z,ve.predicate);return Ps&&Ps.box&&Ps.box.length&&(this.markUsedOrientation(A,Ji,Bn),this.placedOrientations[Hr]=Ji),Ps};ji((()=>mi(Eo,i.bL.horizontal)),(()=>{const Wi=Lr.verticalTextBox;return A.allowVerticalPlacement&&Xn>0&&Wi?(ho(Wi),mi(Wi,i.bL.vertical)):{box:null,offscreen:null,occluded:null}})),Li(!!(Mn&&Mn.box&&Mn.box.length))}}if(Gr=Mn,tr=Gr&&Gr.box&&Gr.box.length>0,Di=Gr&&Gr.offscreen,gs=Gr&&Gr.occluded,Bn.useRuntimeCollisionCircles){const Li=A.text.placedSymbolArray.get(Bn.centerJustifiedTextSymbolIndex>=0?Bn.centerJustifiedTextSymbolIndex:Bn.verticalPlacedTextSymbolIndex),ji=i.bM(A.textSizeData,he,Li),mi=M.get("text-padding");ai=this.collisionIndex.placeCollisionCircles(A,Ce,Li,A.lineVertexArray,A.glyphOffsetArray,ji,z,B,G,p,Be,ve.predicate,Bn.collisionCircleDiameter*ji/i.bX,mi,this.retainedQueryData[A.bucketInstanceId].tileID),tr=Ce||ai.circles.length>0&&!ai.collisionDetected,Di=Di&&ai.offscreen,gs=ai.occluded}if(Lr.iconFeatureIndex&&(Us=Lr.iconFeatureIndex),Lr.iconBox){const Li=ji=>{ho(ji);const mi=Bn.hasIconTextFit&&Yn?Dr(Yn.x,Yn.y,Me,Be,this.transform.angle):new i.P(0,0),Wi=A.getSymbolInstanceIconSize(me,this.transform.zoom,Bn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,Wi,ji,J,Q,ln,mi,Te,Y,z,ve.predicate)};Br&&Br.box&&Br.box.length&&Lr.verticalIconBox?(Zi=Li(Lr.verticalIconBox),fi=Zi.box.length>0):(Zi=Li(Lr.iconBox),fi=Zi.box.length>0),Di=Di&&Zi.offscreen,pi=Zi.occluded}const Ys=Ae||Bn.numHorizontalGlyphVertices===0&&Xn===0,il=Ie||Bn.numIconVertices===0;if(Ys||il?il?Ys||(fi=fi&&tr):tr=fi&&tr:fi=tr=fi&&tr,tr&&Gr&&Gr.box&&this.collisionIndex.insertCollisionBox(Gr.box,M.get("text-ignore-placement"),A.bucketInstanceId,Br&&Br.box&&To?To:Gi,ve.ID),fi&&Zi&&this.collisionIndex.insertCollisionBox(Zi.box,M.get("icon-ignore-placement"),A.bucketInstanceId,Us,ve.ID),ai&&(tr&&this.collisionIndex.insertCollisionCircles(ai.circles,M.get("text-ignore-placement"),A.bucketInstanceId,Gi,ve.ID),p)){const Li=A.bucketInstanceId;let ji=this.collisionCircleArrays[Li];ji===void 0&&(ji=this.collisionCircleArrays[Li]=new Nr);for(let mi=0;mi<ai.circles.length;mi+=4)ji.circles.push(ai.circles[mi+0]),ji.circles.push(ai.circles[mi+1]),ji.circles.push(ai.circles[mi+2]),ji.circles.push(ai.collisionDetected?1:0)}const Ia=A.projection.name!=="globe";un=un&&(Ia||!gs),jn=jn&&(Ia||!pi),this.placements[Hr]=new _n(tr||un,fi||jn,Di||A.justReloaded),c.add(Hr)},Fr=this.retainedQueryData[A.bucketInstanceId].tileID;if(A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,Fr),A.elevationType==="road"&&A.updateRoadElevation(Fr.canonical),A.updateZOffset(),A.sortFeaturesByY){const Bn=A.getSortedSymbolIndexes(this.transform.angle);for(let Ar=Bn.length-1;Ar>=0;--Ar){const Lr=Bn[Ar];Wn(A.symbolInstances.get(Lr),Lr,A.collisionArrays[Lr])}A.hasAnyZOffset&&i.w(`${A.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(A.hasAnyZOffset){const Bn=A.getSortedIndexesByZOffset();for(let Ar=0;Ar<Bn.length;++Ar){const Lr=Bn[Ar];Wn(A.symbolInstances.get(Lr),Lr,A.collisionArrays[Lr])}}else for(let Bn=s.symbolInstanceStart;Bn<s.symbolInstanceEnd;Bn++)Wn(A.symbolInstances.get(Bn),Bn,A.collisionArrays[Bn]);if(p&&A.bucketInstanceId in this.collisionCircleArrays){const Bn=this.collisionCircleArrays[A.bucketInstanceId];i.bl(Bn.invProjMatrix,z),Bn.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(s,c,p,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:O,crossTileID:z}=p,B=i.c2(c),G=x===i.bL.vertical?O:B==="left"?w:B==="center"?A:B==="right"?M:-1;w>=0&&(s.text.placedSymbolArray.get(w).crossTileID=G>=0&&w!==G?0:z),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=G>=0&&A!==G?0:z),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=G>=0&&M!==G?0:z),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=G>=0&&O!==G?0:z)}markUsedOrientation(s,c,p){const x=c===i.bL.horizontal||c===i.bL.horizontalOnly?c:0,w=c===i.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:z}=p,B=s.text.placedSymbolArray;A>=0&&(B.get(A).placedOrientation=x),M>=0&&(B.get(M).placedOrientation=x),O>=0&&(B.get(O).placedOrientation=x),z>=0&&(B.get(z).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(s):1,w=c?c.opacities:{},A=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(const O in this.placements){const z=this.placements[O],B=w[O];B?(this.opacities[O]=new Nl(B,x,z.text,z.icon,null,z.clipped),p=p||z.text!==B.text.placed||z.icon!==B.icon.placed):(this.opacities[O]=new Nl(null,x,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const O in w){const z=w[O];if(!this.opacities[O]){const B=new Nl(z,x,!1,!1);B.isHidden()||(this.opacities[O]=B,p=p||z.text.placed||z.icon.placed)}}for(const O in A)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=A[O]);for(const O in M)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=M[O]);p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,p,x){const w=new Set;for(const A of c){const M=A.getBucket(s);M&&A.latestFeatureIndex&&s.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,w,A,A.collisionBoxArray,p,x,A.tileID,s.scope),M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,A.tileID),M.elevationType==="road"&&M.updateRoadElevation(A.tileID.canonical),M.updateZOffset())}}updateBucketOpacities(s,c,p,x,w,A,M,O){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const z=s.layers[0].layout,B=s.layers[0].paint,G=!!s.layers[0].dynamicFilter(),V=new Nl(null,0,!1,!1,!0),Y=z.get("text-allow-overlap"),J=z.get("icon-allow-overlap"),Q=z.get("text-variable-anchor"),ce=z.get("text-rotation-alignment")==="map",ne=z.get("text-pitch-alignment")==="map",he=B.get("symbol-z-offset"),me=z.get("symbol-elevation-reference")==="sea",ve=!he.isConstant(),Pe=new Nl(null,0,Y&&(J||!s.hasIconData()||z.get("icon-optional")),J&&(Y||!s.hasTextData()||z.get("text-optional")),!0);!s.collisionArrays&&x&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(x);const Ae=(Ce,Te,Me)=>{for(let Ke=0;Ke<Te/4;Ke++)Ce.opacityVertexArray.emplaceBack(Me)};let Ie=0;A&&s.updateReplacement(M,A);for(let Ce=0;Ce<s.symbolInstances.length;Ce++){const Te=s.symbolInstances.get(Ce),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:Ke,crossTileID:Be,numIconVertices:at,tileAnchorX:Xe,tileAnchorY:Qe}=Te;let At=null;const Ye=this.retainedQueryData[s.bucketInstanceId];ve&&Te&&Ye&&(At=p.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:Ye.bucketIndex,sourceLayerIndex:Ye.sourceLayerIndex,layoutVertexArrayOffset:0}));const je=he.evaluate(At,{}),ut=c.has(Be);let tt=this.opacities[Be];ut?tt=V:tt||(tt=Pe,this.opacities[Be]=tt),c.add(Be);const vt=Me>0||Ke>0,Dt=at>0,Gt=this.placedOrientations[Be],Pt=Gt===i.bL.vertical,wt=Gt===i.bL.horizontal||Gt===i.bL.horizontalOnly;!vt&&!Dt||tt.isHidden()||Ie++;let dn=!1;if((vt||Dt)&&A)for(const cn of s.activeReplacements){if(i.bY(cn,w,i.bZ.Symbol,O)||cn.min.x>Xe||Xe>cn.max.x||cn.min.y>Qe||Qe>cn.max.y)continue;const ln=i.b_(Xe,Qe,M.canonical,cn.footprintTileId.canonical);if(dn=i.b$(ln,cn.footprint),dn)break}if(vt){const cn=dn?qc:uf(tt.text);Ae(s.text,Me,Pt?qc:cn),Ae(s.text,Ke,wt?qc:cn);const ln=tt.text.isHidden(),{leftJustifiedTextSymbolIndex:un,centerJustifiedTextSymbolIndex:jn,rightJustifiedTextSymbolIndex:Un,verticalPlacedTextSymbolIndex:Wn}=Te,Fr=s.text.placedSymbolArray,Bn=ln||Pt?1:0;un>=0&&(Fr.get(un).hidden=Bn),jn>=0&&(Fr.get(jn).hidden=Bn),Un>=0&&(Fr.get(Un).hidden=Bn),Wn>=0&&(Fr.get(Wn).hidden=ln||wt?1:0);const Ar=this.variableOffsets[Be];Ar&&this.markUsedJustification(s,Ar.anchor,Te,Gt);const Lr=this.placedOrientations[Be];Lr&&(this.markUsedJustification(s,"left",Te,Lr),this.markUsedOrientation(s,Lr,Te))}if(Dt){const cn=dn?qc:uf(tt.icon),{placedIconSymbolIndex:ln,verticalPlacedIconSymbolIndex:un}=Te,jn=s.icon.placedSymbolArray,Un=tt.icon.isHidden()?1:0;ln>=0&&(Ae(s.icon,at,Pt?qc:cn),jn.get(ln).hidden=Un),un>=0&&(Ae(s.icon,Te.numVerticalIconVertices,wt?qc:cn),jn.get(un).hidden=Un)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const cn=s.collisionArrays[Ce];if(cn){let ln=new i.P(0,0),un=!0;if(cn.textBox||cn.verticalTextBox){if(Q){const Un=this.variableOffsets[Be];Un?(ln=Lu(Un.anchor,Un.width,Un.height,Un.textOffset,Un.textScale),ce&&ln._rotate(ne?this.transform.angle:-this.transform.angle)):un=!1}G&&(un=!tt.clipped),cn.textBox&&Wc(s.textCollisionBox.collisionVertexArray,tt.text.placed,!un||Pt,je,me,ln.x,ln.y),cn.verticalTextBox&&Wc(s.textCollisionBox.collisionVertexArray,tt.text.placed,!un||wt,je,me,ln.x,ln.y)}const jn=un&&!!(!wt&&cn.verticalIconBox);cn.iconBox&&Wc(s.iconCollisionBox.collisionVertexArray,tt.icon.placed,jn,je,me,Te.hasIconTextFit?ln.x:0,Te.hasIconTextFit?ln.y:0),cn.verticalIconBox&&Wc(s.iconCollisionBox.collisionVertexArray,tt.icon.placed,!jn,je,me,Te.hasIconTextFit?ln.x:0,Te.hasIconTextFit?ln.y:0)}}}if(s.fullyClipped=Ie===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Ce.invProjMatrix,s.placementViewportMatrix=Ce.viewportMatrix,s.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function Wc(m,s,c,p,x,w,A){m.emplaceBack(s?1:0,c?1:0,w||0,A||0,p,x?1:0),m.emplaceBack(s?1:0,c?1:0,w||0,A||0,p,x?1:0),m.emplaceBack(s?1:0,c?1:0,w||0,A||0,p,x?1:0),m.emplaceBack(s?1:0,c?1:0,w||0,A||0,p,x?1:0)}const Qh=Math.pow(2,25),oo=Math.pow(2,24),ns=Math.pow(2,17),$y=Math.pow(2,16),af=Math.pow(2,9),lf=Math.pow(2,8),cf=Math.pow(2,1);function uf(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,c=Math.floor(127*m.opacity);return c*Qh+s*oo+c*ns+s*$y+c*af+s*lf+c*cf+s}const qc=0;class hf{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,p,x,w,A){const M=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(M,x,s[this._currentTileIndex],this._sortAcrossTiles,A),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(((O,z)=>O.sortKey-z.sortKey)));this._currentPartIndex<M.length;){const O=M[this._currentPartIndex];if(c.placeLayerBucketPart(O,this._seenCrossTileIDs,p,O.symbolInstanceStart===0,A),this._currentPartIndex++,w())return!0}return!1}}class xo{constructor(s,c,p,x,w,A,M,O,z){this.placement=new Ap(s,w,A,M,O,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,c,p,x,w){const A=i.o.now(),M=()=>{const O=i.o.now()-A;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=c[s[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=z)&&(!O.maxzoom||O.maxzoom>z)){const B=O,G=B.layout.get("symbol-z-elevate"),V=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,Y=B.layout.get("symbol-z-order"),J=Y==="viewport-y"||Y==="auto"&&!(Y!=="viewport-y"&&V),Q=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),ce=J&&Q,ne=this._inProgressLayer=this._inProgressLayer||new hf(B),he=i.B(O.source,O.scope);if(ne.continuePlacement(G||ce?x[he]:p[he],this.placement,this._showCollisionBoxes,O,M,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const vl=512/i.al/2;class jo{constructor(s,c,p){this.tileID=s,this.bucketInstanceId=p,this.index=new i.c3(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=s.canonical.x*i.al,w=s.canonical.y*i.al;for(let A=0;A<c.length;A++){const{key:M,crossTileID:O,tileAnchorX:z,tileAnchorY:B}=c.get(A),G=Math.floor((x+z)*vl),V=Math.floor((w+B)*vl);this.index.add(G,V),this.keys.push(M),this.crossTileIDs.push(O)}this.index.finish()}findMatches(s,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=vl/Math.pow(2,c.canonical.z-this.tileID.canonical.z),A=c.canonical.x*i.al,M=c.canonical.y*i.al;for(let O=0;O<s.length;O++){const z=s.get(O);if(z.crossTileID)continue;const{key:B,tileAnchorX:G,tileAnchorY:V}=z,Y=Math.floor((A+G)*w),J=Math.floor((M+V)*w),Q=this.index.range(Y-x,J-x,Y+x,J+x).sort(((ce,ne)=>ce-ne));for(const ce of Q){const ne=this.crossTileIDs[ce];if(this.keys[ce]===B&&!p.has(ne)){p.add(ne),z.crossTileID=ne;break}}}}}class p_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ed{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],w={};for(const A in x){const M=x[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),w[M.tileID.key]=M}this.indexes[p]=w}this.lng=s}addBucket(s,c,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const x=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const A=this.indexes[w];if(Number(w)>s.overscaledZ)for(const M in A){const O=A[M];O.tileID.isChildOf(s)&&O.findMatches(c.symbolInstances,s,x)}else{const M=A[s.scaledTo(Number(w)).key];M&&M.findMatches(c.symbolInstances,s,x)}}for(let w=0;w<c.symbolInstances.length;w++){const A=c.symbolInstances.get(w);A.crossTileID||(A.crossTileID=p.generate(),x.add(A.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new jo(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[s].delete(p)}removeStaleBuckets(s){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const w in x)s[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[w]),delete x[w],c=!0)}return c}}class fs{constructor(){this.layerIndexes={},this.crossTileIDs=new p_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,p,x){let w=this.layerIndexes[s.fqid];w===void 0&&(w=this.layerIndexes[s.fqid]=new ed);let A=!1;const M={};x.name!=="globe"&&w.handleWrapJump(p);for(const O of c){const z=O.getBucket(s);z&&s.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,z,this.crossTileIDs)&&(A=!0),M[z.bucketInstanceId]=!0)}return w.removeStaleBuckets(M)&&(A=!0),A}pruneUnusedLayers(s){const c={};s.forEach((p=>{c[p]=!0}));for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const zo=771;class Gn{constructor(s,c,p,x){this.blendFunction=s,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}Gn.Replace=[1,0,1,0],Gn.disabled=new Gn(Gn.Replace,i.ao.transparent,[!1,!1,!1,!1]),Gn.unblended=new Gn(Gn.Replace,i.ao.transparent,[!0,!0,!0,!0]),Gn.alphaBlended=new Gn([1,zo,1,zo],i.ao.transparent,[!0,!0,!0,!0]),Gn.alphaBlendedNonPremultiplied=new Gn([770,zo,770,zo],i.ao.transparent,[!0,!0,!0,!0]),Gn.multiply=new Gn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]);class Qt{constructor(s,c,p){this.func=s,this.mask=c,this.range=p}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const df=7680;class In{constructor(s,c,p,x,w,A){this.test=s,this.ref=c,this.mask=p,this.fail=x,this.depthFail=w,this.pass=A}}In.disabled=new In({func:519,mask:0},0,0,df,df,df);const Zc=1029,ju=2305;class Dn{constructor(s,c,p){this.enable=s,this.mode=c,this.frontFace=p}}function Cp(m,s){const c=i.c9(m,3);i.cb(m,s),i.cf(m,3,c)}function Fl(m,s){const c=i.c6([]);return i.c7(c,c,-s),i.c8(c,c,-m),c}function ff(m,s){const c=[m[0],m[1],0],p=[s[0],s[1],0];if(i.ag(c)>=1e-15){const A=i.aw([],c);i.c4(p,A,i.bJ(p,A)),s[0]=p[0],s[1]=p[1]}const x=i.bI([],s,m);if(i.c5(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Fl(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}Dn.disabled=new Dn(!1,Zc,ju),Dn.backCCW=new Dn(!0,Zc,ju),Dn.backCW=new Dn(!0,Zc,2304),Dn.frontCW=new Dn(!0,1028,2304),Dn.frontCCW=new Dn(!0,1028,ju);class $m{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof i.ae?s:new i.ae(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=i.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const p=this.position,x=this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(s)):0,w=i.ae.fromLngLat(s,x),A=[w.x-p.x,w.y-p.y,w.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ff(A,c)}setPitchBearing(s,c){this.orientation=Fl(i.an(s),i.an(-c))}}class Pp{constructor(s,c){this._transform=i.bA([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new i.ae(s[0],s[1],s[2])}get position(){const s=i.c9(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&i.cf(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||i.c6([]),s&&Cp(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=Fl(s,c),Cp(this._transform,this._orientation)}forward(){const s=i.c9(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=i.c9(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=i.c9(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const p=new Float64Array(16);return i.bl(p,this.getWorldToCamera(s,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,p){const x=this.position;i.c4(x,x,-s);const w=new Float64Array(16);return i.bq(w,[p,p,p]),i.br(w,w,x),w[10]*=c,w}getWorldToCamera(s,c){const p=new Float64Array(16),x=new Float64Array(4),w=this.position;return i.ca(x,this._orientation),i.c4(w,w,-s),i.cb(p,x),i.br(p,p,w),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(s,c,p,x){const w=new Float64Array(16);return i.cc(w,s,c,p,x),w}getCameraToClipOrthographic(s,c,p,x,w,A){const M=new Float64Array(16);return i.cd(M,s,c,p,x,w,A),M}getDistanceToElevation(s,c=!1){const p=s===0?0:i.ce(s,c?i.a$(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Pp([...this.position],[...this.orientation])}}const Hi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ip{constructor(s=0,c=0,p=0,x=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=p,this.right=x}interpolate(s,c,p){return c.top!=null&&s.top!=null&&(this.top=i.ak(s.top,c.top,p)),c.bottom!=null&&s.bottom!=null&&(this.bottom=i.ak(s.bottom,c.bottom,p)),c.left!=null&&s.left!=null&&(this.left=i.ak(s.left,c.left,p)),c.right!=null&&s.right!=null&&(this.right=i.ak(s.right,c.right,p)),this}getCenter(s,c){const p=i.aA((this.left+s-this.right)/2,0,s),x=i.aA((this.top+c-this.bottom)/2,0,c);return new i.P(p,x)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Ip(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ga=15;class Cs{constructor(s,c,p,x,w,A,M){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(A),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new i.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ip,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Pp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new Cs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ga}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(s||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const p=this.getProjection(),x=!i.by(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=i.aA(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=i.an(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,w=0;for(let A=0;A<c.length;A++){const M=new i.P(c[A][0]*this.width,p+c[A][1]*(this.height-p)),O=s.pointCoordinate(M);if(!O)continue;const z=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);x+=O[3]*z,w+=z}return w===0?NaN:x/w}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(s),w=this._mercatorZfromZoom(this._maxZoom),A=Math.max(x-p,w);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let p;p=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const x=i.ag(i.av([],this._camera.position,p));return i.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!i.co(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const p=[s.position.x,s.position.y,s.position.z];i.cp(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new $m;return c.position=new i.ae(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!i.cq(s))return!1;i.cr(s,s);const c=i.cs([],[0,0,-1],s),p=i.cs([],[0,-1,0],s);if(p[2]<0)return!1;const x=ff(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;s[2]=i.aA(s[2],x/p,x/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,p){this._unmodified=!1,this._edgeInsets.interpolate(s,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new i.ct(0,s)];if(this.renderWorldCopies){const p=this.pointCoordinate(new i.P(0,0)),x=this.pointCoordinate(new i.P(this.width,0)),w=this.pointCoordinate(new i.P(this.width,this.height)),A=this.pointCoordinate(new i.P(0,this.height)),M=Math.floor(Math.min(p.x,x.x,w.x,A.x)),O=Math.floor(Math.max(p.x,x.x,w.x,A.x)),z=1;for(let B=M-z;B<=O+z;B++)B!==0&&c.push(new i.ct(B,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,p){let x=[];const w=p!=null,A=!w;if(A&&this.zoom<c||w&&p[0]===0&&p[1]===0)return x;const M=new Set,O=(B,G,V,Y,J)=>{const Q=i.cX(G,B,V,Y,J);M.has(Q)||(x.push(new i.aO(B,G,V,Y,J)),M.add(Q))};for(let B=0;B<s.length;B++){const G=s[B];if(A&&G.canonical.z!==c)continue;const V=G.canonical,Y=G.overscaledZ,J=G.wrap,Q=1<<V.z,ce=V.x+1<Q,ne=V.x>0,he=V.y+1<Q,me=V.y>0,ve=G.wrap-(ne?0:1),Pe=G.wrap+(ce?0:1),Ae=ne?V.x-1:Q-1,Ie=ce?V.x+1:0;if(w)p[0]<0?(O(Y,Pe,V.z,Ie,V.y),p[1]<0&&he&&(O(Y,J,V.z,V.x,V.y+1),O(Y,Pe,V.z,Ie,V.y+1)),p[1]>0&&me&&(O(Y,J,V.z,V.x,V.y-1),O(Y,Pe,V.z,Ie,V.y-1))):p[0]>0?(O(Y,ve,V.z,Ae,V.y),p[1]<0&&he&&(O(Y,J,V.z,V.x,V.y+1),O(Y,ve,V.z,Ae,V.y+1)),p[1]>0&&me&&(O(Y,J,V.z,V.x,V.y-1),O(Y,ve,V.z,Ae,V.y-1))):p[1]<0&&he?O(Y,J,V.z,V.x,V.y+1):me&&O(Y,J,V.z,V.x,V.y-1);else{const Ce=G.visibleQuadrants;1&Ce&&(O(Y,ve,V.z,Ae,V.y),me&&(O(Y,J,V.z,V.x,V.y-1),O(Y,ve,V.z,Ae,V.y-1))),2&Ce&&(O(Y,Pe,V.z,Ie,V.y),me&&(O(Y,J,V.z,V.x,V.y-1),O(Y,Pe,V.z,Ie,V.y-1))),4&Ce&&(O(Y,ve,V.z,Ae,V.y),he&&(O(Y,J,V.z,V.x,V.y+1),O(Y,ve,V.z,Ae,V.y+1))),8&Ce&&(O(Y,Pe,V.z,Ie,V.y),he&&(O(Y,J,V.z,V.x,V.y+1),O(Y,Pe,V.z,Ie,V.y+1)))}}const z=[];for(const B of x)x.some((G=>B.isChildOf(G)))||z.push(B);if(x=z.filter((B=>!s.some((G=>!!(B.overscaledZ<c&&G.isChildOf(B))||B.equals(G)||B.isChildOf(G))))),A){const B=1<<c,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[B*G.x,B*G.y],Y=4,J=Y*Y;x=x.filter((Q=>{const ce=Q.canonical.x+.5-V[0],ne=Q.canonical.y+.5-V[1];return ce*ce+ne*ne<J}))}return x}extendTileCoverToNearPlane(s,c,p){const x=[],w=new Set;for(const he of s)w.add(he.key);const A=(he,me,ve,Pe,Ae)=>{const Ie=i.cX(me,he,ve,Pe,Ae);w.has(Ie)||(x.push(new i.aO(he,me,ve,Pe,Ae)),w.add(Ie))},M=s.reduce(((he,me)=>Math.max(he,me.overscaledZ)),p),O=1<<p,z=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],B=new i.P(0,0),G=new i.P(0,0),V=(he,me)=>{const ve=Math.floor(he[0]),Pe=Math.floor(he[1]),Ae=(he[0]-ve)*i.al,Ie=(he[1]-Pe)*i.al,Ce=Math.floor(me[0]),Te=Math.floor(me[1]),Me=(me[0]-Ce)*i.al,Ke=(me[1]-Te)*i.al;for(let Be=-1;Be<=1;Be++){const at=ve+Be;if(!(at<0||at>=O)){B.x=Ae-Be*i.al,G.x=Me-(at-Ce)*i.al;for(let Xe=-1;Xe<=1;Xe++){const Qe=Pe+Xe;B.y=Ie-Xe*i.al,G.y=Ke-(Qe-Te)*i.al,i.cY(B,G,z)&&A(M,0,p,at,Qe)}}}},Y=c.points,J=Y[i.cu],Q=Y[i.cv],ce=this._projectToGround(J,Y[i.cw]),ne=this._projectToGround(Q,Y[i.cx]);return V(J,ce),V(Q,ne),x}_projectToGround(s,c){return i.cy(i.cz(),s,c,s[2]/(s[2]-c[2]))}coveringTiles(s){let c=this.coveringZoomLevel(s);const p=c,x=this.elevation&&this.elevation.exaggeration(),w=x&&!s.isTerrainDEM,A=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const M=this.locationCoordinate(this.center),O=this.center.lat,z=1<<c,B=[z*M.x,z*M.y,0],G=this.projection.name==="globe",V=!G,Y=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,V),J=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=z*i.ce(1,this.center.lat),ce=this._camera.position[2]/i.ce(1,this.center.lat),ne=[z*J.x,z*J.y,ce*(V?1:Q)],he=G||x,me=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ve=this.isLODDisabled(!0)?c:0;let Pe;if(this._elevation&&s.isTerrainDEM)Pe=1e4*this._elevation.exaggeration();else if(this._elevation){const je=this._elevation.getMinMaxForVisibleTiles();Pe=je?je.max:this._centerAltitude}else Pe=this._centerAltitude;const Ae=s.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?i.cB(this):1,Ce=je=>{const tt=new i.ae(je.x+25e-6,je.y,je.z),vt=new i.ae(je.x,je.y+25e-6,je.z),Dt=je.toLngLat(),Gt=tt.toLngLat(),Pt=vt.toLngLat(),wt=this.locationCoordinate(Dt),dn=this.locationCoordinate(Gt),cn=this.locationCoordinate(Pt),ln=Math.hypot(dn.x-wt.x,dn.y-wt.y),un=Math.hypot(cn.x-wt.x,cn.y-wt.y);return Math.sqrt(ln*un)*Ie/25e-6},Te=je=>{const ut=Pe,tt=Ae;return{aabb:i.cE(this,z,0,0,0,je,tt,ut,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:ut,wrap:je,fullyVisible:!1}},Me=[];let Ke=[];const Be=c,at=s.reparseOverscaled?p:c,Xe=(ce-this._centerAltitude)*Q,Qe=je=>{if(!this._elevation||!je.tileID||!A)return;const ut=this._elevation.getMinMaxForTile(je.tileID),tt=je.aabb;ut?(tt.min[2]=ut.min,tt.max[2]=ut.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(je.shouldSplit=Ye(je),je.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},At=(je,ut)=>{if(.707*ut<je)return 1;const tt=ut/je;return tt/(1.4144271570014144+(Math.pow(1.1,tt-1.4144271570014144+1)-1)/(1.1-1)-1)},Ye=je=>{if(je.zoom<ve)return!0;if(je.zoom===Be)return!1;if(je.shouldSplit!=null)return je.shouldSplit;const ut=je.aabb.distanceX(ne),tt=je.aabb.distanceY(ne);let vt=Xe,Dt=1;if(G){vt=je.aabb.distanceZ(ne);const un=Math.pow(2,je.zoom),jn=i.a$((je.y+1)/un),Un=i.a$(je.y/un),Wn=Math.min(Math.max(O,jn),Un),Fr=i.d0(Wn)/i.d0(O);if(Dt=Wn===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Fr/this._mercatorScaleRatio),this.zoom<=i.cZ&&je.zoom===Be-1&&Fr>=.9)return!0}else if(w&&(vt=je.aabb.distanceZ(ne)*Q),this.projection.isReprojectedInTileSpace&&p<=5){const un=Math.pow(2,je.zoom),jn=Ce(new i.ae((je.x+.5)/un,(je.y+.5)/un));Dt=jn>.85?1:jn}if(!A){const un=Math.sqrt(ut*ut+tt*tt+vt*vt);let jn=(1<<Be-je.zoom)*me*Dt;return jn*=At(Math.max(vt,Xe),un),un<jn}let Gt=Number.MAX_VALUE,Pt=0;const wt=je.aabb.getCorners(),dn=[];for(const un of wt){i.av(dn,un,ne),G||(w?dn[2]*=Q:dn[2]=Xe);const jn=i.bJ(dn,this._camera.forward());jn<Gt&&(Gt=jn,Pt=Math.abs(dn[2]))}let cn=(1<<Be-je.zoom)*me*Dt;if(cn*=At(Math.max(Pt,Xe),Gt),Gt<cn)return!0;const ln=je.aabb.closestPoint(B);return ln[0]===B[0]&&ln[1]===B[1]};if(this.renderWorldCopies)for(let je=1;je<=3;je++)Me.push(Te(-je)),Me.push(Te(je));for(Me.push(Te(0));Me.length>0;){const je=Me.pop(),ut=je.x,tt=je.y;let vt=je.fullyVisible;const Dt=()=>this.projection.name==="globe"&&(je.y===0||je.y===(1<<je.zoom)-1);if(!vt){let Gt=he?je.aabb.intersects(Y):je.aabb.intersectsFlat(Y);if(Gt===0&&Dt()){const Pt=new i.cC(je.zoom,ut,tt);Gt=i.cD(this,z,Pt,!0).intersects(Y)}if(Gt===0)continue;vt=Gt===2}if(je.zoom!==Be&&Ye(je))for(let Gt=0;Gt<4;Gt++){const Pt=(ut<<1)+Gt%2,wt=(tt<<1)+(Gt>>1),dn={aabb:A?je.aabb.quadrant(Gt):i.cE(this,z,je.zoom+1,Pt,wt,je.wrap,je.minZ,je.maxZ,this.projection),zoom:je.zoom+1,x:Pt,y:wt,wrap:je.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:je.minZ,maxZ:je.maxZ};w&&!G&&(dn.tileID=new i.aO(je.zoom+1===Be?at:je.zoom+1,je.wrap,je.zoom+1,Pt,wt),Qe(dn)),Me.push(dn)}else{const Gt=je.zoom===Be?at:je.zoom;if(s.minzoom&&s.minzoom>Gt)continue;let Pt=0;if(!vt){let ln=he?je.aabb.intersectsPrecise(Y):je.aabb.intersectsPreciseFlat(Y);if(ln===0&&Dt()){const un=new i.cC(je.zoom,ut,tt);ln=i.cD(this,z,un,!0).intersectsPrecise(Y)}if(ln===0)continue;if(s.calculateQuadrantVisibility)if(Y.containsPoint(je.aabb.center))Pt=15;else for(let un=0;un<4;un++)je.aabb.quadrant(un).intersects(Y)!==0&&(Pt|=1<<un)}const wt=B[0]-(.5+ut+(je.wrap<<je.zoom))*(1<<c-je.zoom),dn=B[1]-.5-tt,cn=je.tileID?je.tileID:new i.aO(Gt,je.wrap,je.zoom,ut,tt);s.calculateQuadrantVisibility&&(cn.visibleQuadrants=Pt),Ke.push({tileID:cn,distanceSq:wt*wt+dn*dn})}}if(this.fogCullDistSq){const je=this.fogCullDistSq,ut=this.horizonLineFromTop();Ke=Ke.filter((tt=>{const vt=[0,0,0,1],Dt=[i.al,i.al,0,1],Gt=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());i.aC(vt,vt,Gt),i.aC(Dt,Dt,Gt);const Pt=i.cF([],vt,Dt),wt=i.cG([],vt,Dt),dn=i.c_(Pt,wt);if(dn===0)return!0;let cn=!1;const ln=this._elevation;if(ln&&dn>je&&ut!==0){const un=this.calculateProjMatrix(tt.tileID.toUnwrapped());let jn;s.isTerrainDEM||(jn=ln.getMinMaxForTile(tt.tileID)),jn||(jn={min:Ae,max:Pe});const Un=i.cH(this.rotation),Wn=[Un[0]*i.al,Un[1]*i.al,jn.max];i.af(Wn,Wn,un),cn=(1-Wn[1])*this.height*.5<ut}return dn<je||cn}))}return Ke.sort(((je,ut)=>je.distanceSq-ut.distanceSq)).map((je=>je.tileID))}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log2(s)}project(s){const c=i.aA(s.lat,-i.cI,i.cI),p=this.projection.project(s.lng,c);return new i.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let p,x;const w=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;p=(c.x-w.x)/M,x=(c.y-w.y)/M}else{const M=this.pointCoordinate(c),O=this.pointCoordinate(w);p=M.x-O.x,x=M.y-O.y}const A=this.locationCoordinate(s);this.setLocation(new i.ae(A.x-p,A.y-x))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,c){return this.projection.locationPoint(this,s,c)}locationPoint3D(s,c){return this.projection.locationPoint(this,s,c,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,c){return this.coordinateLocation(this.pointCoordinate3D(s,c))}locationCoordinate(s,c){const p=c?i.ce(c,s.lat):void 0,x=this.projection.project(s.lng,s.lat);return new i.ae(x.x,x.y,p)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const p=c??this._centerAltitude,x=[s.x,s.y,0,1],w=[s.x,s.y,1,1];i.aC(x,x,this.pixelMatrixInverse),i.aC(w,w,this.pixelMatrixInverse);const A=w[3];i.cJ(x,x,1/x[3]),i.cJ(w,w,1/A);const M=x[2],O=w[2];return{p0:x,p1:w,t:M===O?0:(p-M)/(O-M)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],p=[s.x,s.y,1,1];return i.aC(c,c,this.pixelMatrixInverse),i.aC(p,p,this.pixelMatrixInverse),i.cJ(c,c,1/c[3]),i.cJ(p,p,1/p[3]),c[2]=i.ce(c[2],this._center.lat)*this.worldSize,p[2]=i.ce(p[2],this._center.lat)*this.worldSize,i.cJ(c,c,1/this.worldSize),i.cJ(p,p,1/this.worldSize),new i.ax([c[0],c[1],c[2]],i.aw([],i.av([],p,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:p,t:x}=s,w=i.ce(c[2],this._center.lat),A=i.ce(p[2],this._center.lat);return new i.ae(i.ak(c[0],p[0],x)/this.worldSize,i.ak(c[1],p[1],x)/this.worldSize,i.ak(w,A,x))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s,c){if(!this.elevation)return this.pointCoordinate(s,c);let p=this.projection.pointCoordinate3D(this,s.x,s.y);if(p)return new i.ae(p[0],p[1],p[2]);let x=0,w=this.horizonLineFromTop();if(s.y>w)return this.pointCoordinate(s,c);const A=.02*w,M=s.clone();for(let O=0;O<10&&w-x>A;O++){M.y=i.ak(x,w,.66);const z=this.projection.pointCoordinate3D(this,M.x,M.y);z?(w=M.y,p=z):x=M.y}return p?new i.ae(p[0],p[1],p[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,x=[s.x*this.worldSize,s.y*this.worldSize,p+s.toAltitude(),1];return i.aC(x,x,this.pixelMatrix),x[3]>0?new i.P(x[0]/x[3],x[1]/x[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new i.P(c,s)),A=this.pointLocation3D(new i.P(x,s)),M=this.pointLocation3D(new i.P(x,p)),O=this.pointLocation3D(new i.P(c,p));let z=Math.min(w.lng,A.lng,M.lng,O.lng),B=Math.max(w.lng,A.lng,M.lng,O.lng),G=Math.min(w.lat,A.lat,M.lat,O.lat),V=Math.max(w.lat,A.lat,M.lat,O.lat);const Y=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,Q=(ce,ne,he,me,ve)=>{const Pe=(ce+he)/2,Ae=(ne+me)/2,Ie=new i.P(Pe,Ae),{lng:Ce,lat:Te}=this.pointLocation3D(Ie),Me=Math.max(0,z-Ce,G-Te,Ce-B,Te-V);z=Math.min(z,Ce),B=Math.max(B,Ce),G=Math.min(G,Te),V=Math.max(V,Te),(ve<J||Me>Y)&&(Q(ce,ne,Pe,Ae,ve+1),Q(Pe,Ae,he,me,ve+1))};if(Q(c,s,x,s,1),Q(x,s,x,p,1),Q(x,p,c,p,1),Q(c,p,c,s,1),this.projection.name==="globe"){const[ce,ne]=i.cL(this);ce?(V=90,B=180,z=-180):ne&&(G=-90,B=180,z=-180)}return new i.aI(new i.aR(z,G),new i.aR(B,V))}_getBoundsRectangular(s,c){const{top:p,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,M=new i.P(x,p),O=new i.P(A,p),z=new i.P(A,w),B=new i.P(x,w);let G=this.pointCoordinate(M,s),V=this.pointCoordinate(O,s);const Y=this.pointCoordinate(z,c),J=this.pointCoordinate(B,c),Q=(ce,ne)=>(ne.y-ce.y)/(ne.x-ce.x);return G.y>1&&V.y>=0?G=new i.ae((1-J.y)/Q(J,G)+J.x,1):G.y<0&&V.y<=1&&(G=new i.ae(-J.y/Q(J,G)+J.x,0)),V.y>1&&G.y>=0?V=new i.ae((1-Y.y)/Q(Y,V)+Y.x,1):V.y<0&&G.y<=1&&(V=new i.ae(-Y.y/Q(Y,V)+Y.x,0)),new i.aI().extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce(((p,x)=>{if(x.dem){const w=x.dem.tree;p.min=Math.min(p.min,w.minimums[0]),p.max=Math.max(p.max,w.maximums[0])}return p}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=s.canonical,w=1/this.height,A=this.cameraWorldSize,M=A/this.zoomScale(x.z),O=(x.x+Math.pow(2,x.z)*s.wrap)*M,z=x.y*M,B=this.point;B.x*=A/this.worldSize,B.y*=A/this.worldSize;const G=this.angle,V=Math.sin(-G),Y=-Math.cos(-G);return p[c]={bearing:[V,Y],center:[(B.x-O)*w,(B.y-z)*w],scale:M/i.al*w},p[c]}calculateFogTileMatrix(s){const c=s.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return i.aB(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(s,c=!1,p=!1){const x=s.key;let w;if(w=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const A=this.calculatePosMatrix(s,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.aB(A,M,A),w[x]=new Float32Array(A),w[x]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=i.cM(s,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=i.bq([],[s,s,s]);return i.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=i.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),w=i.ce(1,this._center.lat);p[2]/=w,x[2]/=w,i.aw(x,x);const A=s.raycast(p,x,s.exaggeration());if(A){const M=i.bH([],p,x,A),O=new i.ae(M[0],M[1],i.ce(M[2],i.a$(M[1]))),z=(O.z+i.ag([O.x-p[0],O.y-p[1],O.z-p[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,p=i.ce(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),w=c.getAtPointOrZero(new i.ae(...x)),A=this.pixelsPerMeter/this.worldSize*w,M=this._minimumHeightOverTerrain(),O=x[2]-A;if(O<=M)if(O<0||s){const z=this.locationCoordinate(this._center,this._centerAltitude),B=[x[0],x[1],z.z-x[2]],G=i.ag(B);B[2]-=(M-O)/this._pixelsPerMercatorPixel;const V=i.ag(B);if(V===0)return;i.c4(B,B,G/V*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const V=this.center;return V.lat=i.aA(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(V.lng=i.aA(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let w=0,A=p,M=x;const O=this.width/2,z=this.height/2,B=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(x-z<B&&(M=B+z),x+z>G&&(M=G-z),G-B<this.height&&(w=Math.max(w,this.height/(G-B)),M=(G+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,J=this.worldSize/2-(V+Y)/2;A=(p+J+this.worldSize)%this.worldSize-J,A-O<V&&(A=V+O),A+O>Y&&(A=Y-O),Y-V<this.width&&(w=Math.max(w,this.width/(Y-V)),A=(Y+V)/2)}A===p&&M===x||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(A,M))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const x=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?p:1,A=this._camera.getWorldToCamera(this.worldSize,w);let M;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-s.x/this.width,O[9]=2*s.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Me=Te*this.aspect,Ke=-Me,Be=-Te;Me-=s.x,Ke-=s.x,Te+=s.y,Be+=s.y,M=this._camera.getCameraToClipOrthographic(Ke,Me,Be,Te,this._nearZ,this._farZ),((at,Xe,Qe,At)=>{for(let Ye=0;Ye<16;Ye++)at[Ye]=i.ak(Xe[Ye],Qe[Ye],At)})(M,M,O,i.c$(this.pitch>=ga?1:this.pitch/ga))}else M=O;const z=i.cO([],O,A);let B=i.cO([],M,A);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),Me=i.bA([]);i.br(Me,Me,[Te.x*this.worldSize,Te.y*this.worldSize,0]),i.aB(Me,Me,i.cP(this)),i.br(Me,Me,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),i.aB(B,B,Me),i.aB(z,z,Me),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],B,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=B,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),c){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-s.x/this.width,Te[9]=2*s.y/this.height,this.expandedFarZProjMatrix=i.cO([],Te,A)}else this.expandedFarZProjMatrix=this.projMatrix;const G=i.bl([],M);this.frustumCorners=i.cS.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const V=new Float32Array(16);i.bA(V),i.cR(V,V,[1,-1,1]),i.cT(V,V,this._pitch),i.bB(V,V,this.angle);const Y=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(Y);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-s.x/this.width,Y[9]=2*(s.y+J)/this.height,this.skyboxMatrix=i.aB(V,Y,V);const Q=this.point,ce=Q.x,ne=Q.y,he=this.width%2/2,me=this.height%2/2,ve=Math.cos(this.angle),Pe=Math.sin(this.angle),Ae=ce-Math.round(ce)+ve*he+Pe*me,Ie=ne-Math.round(ne)+ve*me+Pe*he,Ce=new Float64Array(B);if(i.br(Ce,Ce,[Ae>.5?Ae-1:Ae,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=Ce,B=i.bC(),i.cR(B,B,[this.width/2,-this.height/2,1]),i.br(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=i.bC(),i.cR(B,B,[1,-1,1]),i.br(B,B,[-1,-1,0]),i.cR(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},B=i.bl(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(Te,Te,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[s,s,c];i.c4(w,w,x),i.c4(p,p,-1),i.cV(p,p,w);const A=i.bC();i.br(A,A,p),i.cR(A,A,w),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,x)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*w,x.y/this.worldSize-p[1]*w,s/this.worldSize*this._centerAltitude-p[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=s[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((c-p)/x,1)),this._camera.position=i.bH([],this._camera.position,s,w),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),w=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),M=Math.max((s[2]-w)/Math.cos(p),A),O=this._zoomFromMercatorZ(M);i.bH(s,s,c,M),this._pitch=i.aA(p,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(x,-Math.PI,Math.PI),this._setZoom(i.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,p=i.cK,x=0,w=1/0;for(;p-c>1e-6&&p>c;){const A=c+.5*(p-c),M=this.tileSize*Math.pow(2,A),O=this.getCameraToCenterDistance(this.projection,A,M),z=this.scaleZoom(O/(Math.max(0,s)*this.tileSize)),B=Math.abs(A-z);B<w&&(w=B,x=A),A<z?c=A:p=A}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const p=Math.min(s.x,c.x),x=Math.max(s.x,c.x),w=Math.min(s.y,c.y),A=Math.max(s.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new i.P(p,w),new i.P(x,A),new i.P(p,A),new i.P(x,w)],O=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const B of M){const G=this.pointRayIntersection(B);if(G.t<0)return!0;const V=this.rayIntersectionCoordinate(G);if(V.x<O||V.y<0||V.x>z||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(s,c){const p=i.ag(i.av([],this._camera.position,s)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const s=(function([c,p,x],w){const A=[c,p,x,1];i.aC(A,A,w);const M=A[3]=Math.max(A[3],1e-6);return A[0]/=M,A[1]/=M,A[2]/=M,A})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,p=this.worldSize){const x=i.cN(s,c,this.width,this.height,1024),w=s.pixelSpaceConversion(this.center.lat,p,x);let A=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(A=i.ak(1,A,i.c$(this.pitch>=ga?1:this.pitch/ga))),A}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(s,s,this.globeMatrix),s}getFrustum(s){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const Xc=(m,s)=>{if(s>0&&m.terrain&&i.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=m.transform,p=Math.max(Math.abs(c._zoom-(m.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?i.ah(60,45,c.pitch):i.ah(30,15,c.pitch),w=c._farZ-c._nearZ,A=s*c.height,M=((1-(O=x))*c.cameraToCenterDistance+O*(c._farZ+A))*p;var O;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(M-c._nearZ)/w,(M-A-c._nearZ)/w]}}},ps={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class m_{constructor(s,c){this.aabb=s,this.lastCascade=c}}class td{add(s,c){const p=this.receivers[s.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[s.key]=new m_(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,p){const x=i.d8.fromPoints(s.points);let w=0;for(const A in this.receivers){const M=this.receivers[A];if(!M||!x.intersectsAabb(M.aabb))continue;M.aabb.min=x.closestPoint(M.aabb.min),M.aabb.max=x.closestPoint(M.aabb.max);const O=M.aabb.getCorners();for(let z=0;z<p.length;z++){let B=!0;for(const G of O){const V=[G[0]*c,G[1]*c,G[2]];if(i.af(V,V,p[z].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){B=!1;break}}if(M.lastCascade=z,w=Math.max(w,z),B)break}}return w+1}}class Hm{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new td,this._depthMode=new Qt(s.context.gl.LEQUAL,Qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),s.tp.registerParameter(ps,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(ps,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(ps,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce(((J,Q)=>{const ce=p.style._mergedLayers[Q];return J+(ce.hasShadowPass()&&!ce.isHidden(s.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=p.context,A=ps.shadowMapResolution,M=ps.shadowMapResolution;if(this._cascades.length===0||ps.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let J=0;J<ps.cascadeCount;++J){const Q=p._shadowMapDebug,ce=w.gl,ne=w.createFramebuffer(A,M,Q,"texture"),he=new i.T(w,{width:A,height:M,data:null},ce.DEPTH_COMPONENT16);if(ne.depthAttachment.set(he.texture),Q){const me=new i.T(w,{width:A,height:M,data:null},ce.RGBA8);ne.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:ne,texture:he,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=zu(c);let O=0;if(s.elevation){const J=s.elevation,Q=[1e4,-1e4];J.visibleDemTiles.filter((ce=>ce.dem)).forEach((ce=>{const ne=ce.dem.tree;Q[0]=Math.min(Q[0],ne.minimums[0]),Q[1]=Math.max(Q[1],ne.maximums[0])})),Q[0]!==1e4&&(O=(Q[1]-Q[0])*J.exaggeration())}const z=1.5*s.cameraToCenterDistance,B=3*z,G=new Float64Array(16);for(let J=0;J<this._cascades.length;++J){const Q=this._cascades[J];let ce=s.height/50,ne=1;ps.cascadeCount===1?ne=B:J===0?ne=z:(ce=z,ne=B);const[he,me]=g_(s,this.shadowDirection,ce,ne,ps.shadowMapResolution,O);Q.scale=s.scale,Q.matrix=he,Q.boundingSphereRadius=me,i.bl(G,Q.matrix),Q.frustum=i.cA.fromInvProjectionMatrix(G,1,0,!0),Q.far=ne}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ps.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ps.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hi.ShadowMap0,this._uniformValues.u_shadowmap_1=Hi.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=p.transform.elevation;for(const J of this._groundShadowTiles){let Q={min:0,max:0};if(Y){const ce=Y.getMinMaxForTile(J);ce&&(Q=ce)}this.addShadowReceiver(J.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,ps.shadowMapResolution,ps.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){p.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:i.ao.white,depth:1});for(const A of s.order){const M=s._mergedLayers[A];if(!M.hasShadowPass()||M.isHidden(p.transform.zoom))continue;const O=s.getLayerSourceCache(M),z=O?c[O.id]:void 0;(M.type==="model"||z&&z.length)&&p.renderLayer(p,O,M,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,p=s.context,x=p.gl,w=c.directionalLight,A=c.ambientLight;if(!w||!A)return;const M=[],O=Xc(s,s.longestCutoffRange);O.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const z=Ha(c,w,A),B=new Qt(x.LEQUAL,Qt.ReadOnly,s.depthRangeFor3D),G=new In({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const V of this._groundShadowTiles){const Y=V.toUnwrapped(),J=s.isTileAffectedByFog(V),Q=s.getOrCreateProgram("groundShadow",{defines:M,overrideFog:J});this.setupShadows(Y,Q),s.uploadCommonUniforms(p,Q,Y,null,O);const ce={u_matrix:s.transform.calculateProjMatrix(Y),u_ground_shadow_factor:z};Q.draw(s,x.TRIANGLES,B,G,Gn.multiply,Dn.disabled,ce,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Gn.unblended:Gn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,p=c.calculatePosMatrix(s,c.worldSize);return i.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(s){return i.aB(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,p){if(!this.enabled)return;const x=this.painter.transform,w=this.painter.context,A=w.gl,M=this._uniformValues,O=new Float64Array(16),z=x.calculatePosMatrix(s,x.worldSize);for(let B=0;B<this._cascades.length;B++)i.aB(O,this._cascades[B].matrix,z),M[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),w.activeTexture.set(A.TEXTURE0+Hi.ShadowMap0+B),this._cascades[B].texture.bindExtraParam(A.LINEAR,A.LINEAR,A.CLAMP_TO_EDGE,A.CLAMP_TO_EDGE,A.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const B=i.d6(s.canonical),G=2/x.tileSize*i.al/ps.shadowMapResolution,V=G*this._cascades[0].boundingSphereRadius,Y=G*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(p==="vector-tile"?1:3)*(function(Q,ce,ne,he,me){const ve=i.aA((Q-22)/-22,0,1);return .125*(1-ve)+4*ve})(x.zoom);M.u_shadow_normal_offset=[B,V*J,Y*J],M.u_shadow_bias=[1e-4,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(w,M)}setupShadowsFromMatrix(s,c,p=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,A=this._uniformValues,M=new Float64Array(16);for(let O=0;O<ps.cascadeCount;O++)i.aB(M,this._cascades[O].matrix,s),A[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),x.activeTexture.set(w.TEXTURE0+Hi.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=p,p){const O=ps.normalOffset;A.u_shadow_normal_offset=[1,O,O],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,p,x){if(x[2]>=0)return{};const w=(function(O,z,B){const G=B/(1<<O.canonical.z);return new i.d8([O.canonical.x*G+O.wrap*B,O.canonical.y*G+O.wrap*B,0],[(O.canonical.x+1)*G+O.wrap*B,(O.canonical.y+1)*G+O.wrap*B,z])})(s,c,p).getCorners(),A=c/-x[2];x[0]<0?(i.d7(w[0],w[0],[x[0]*A,0,0]),i.d7(w[3],w[3],[x[0]*A,0,0])):x[0]>0&&(i.d7(w[1],w[1],[x[0]*A,0,0]),i.d7(w[2],w[2],[x[0]*A,0,0])),x[1]<0?(i.d7(w[0],w[0],[0,x[1]*A,0]),i.d7(w[1],w[1],[0,x[1]*A,0])):x[1]>0&&(i.d7(w[2],w[2],[0,x[1]*A,0]),i.d7(w[3],w[3],[0,x[1]*A,0]));const M={};return M.vertices=w,M.planes=[nd(w[1],w[0],w[4]),nd(w[2],w[1],w[5]),nd(w[3],w[2],w[6]),nd(w[0],w[3],w[7])],M}addShadowReceiver(s,c,p){this._receivers.add(s,i.d8.fromTileIdAndHeight(s,c,p))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function nd(m,s,c){const p=i.av([],c,s),x=i.av([],m,s),w=i.bI([],p,x),A=i.ag(w);return A===0?[0,0,1,0]:(i.c4(w,w,1/A),[w[0],w[1],w[2],-i.bJ(w,s)])}function zu(m){const s=m.properties.get("direction"),c=i.d3(s.x,s.y,s.z);c[2]=i.aA(c[2],0,75);const p=i.d5([c[0],c[1],c[2]]);return i.d4(p.x,p.y,p.z)}function Ha(m,s,c){const p=s.properties.get("color-use-theme")==="none",x=s.properties.get("color"),w=s.properties.get("intensity"),A=s.properties.get("direction"),M=[A.x,A.y,A.z],O=c.properties.get("color-use-theme")==="none",z=c.properties.get("color"),B=c.properties.get("intensity"),G=Math.max(i.bJ([0,0,1],M),0),V=[0,0,0];i.c4(V,z.toPremultipliedRenderColor(O?null:m.getLut(s.scope)).toArray01Linear().slice(0,3),B);const Y=[0,0,0];return i.c4(Y,x.toPremultipliedRenderColor(p?null:m.getLut(c.scope)).toArray01Linear().slice(0,3),G*w),i.da([V[0]>0?V[0]/(V[0]+Y[0]):0,V[1]>0?V[1]/(V[1]+Y[1]):0,V[2]>0?V[2]/(V[2]+Y[2]):0])}function g_(m,s,c,p,x,w){const A=m.zoom,M=m.scale,O=m.worldSize,z=1/O,B=m.aspect,G=Math.sqrt(1+B*B)*Math.tan(.5*m.fovX),V=G*G,Y=p-c,J=p+c;let Q,ce;V>Y/J?(Q=p,ce=p*G):(Q=.5*J*(1+V),ce=.5*Math.sqrt(Y*Y+2*(p*p+c*c)*V+J*J*V*V));const ne=m.projection.pixelsPerMeter(m.center.lat,O),he=m._camera.getCameraToWorldMercator(),me=[0,0,-Q*z];i.af(me,me,he);let ve=ce*z;const Pe=m._edgeInsets;if(!(Pe.left===0&&Pe.top===0&&Pe.right===0&&Pe.bottom===0||Pe.left===Pe.right&&Pe.top===Pe.bottom)){const vt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ne:1),Dt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,c,p);Dt[8]=2*-m.centerOffset.x/m.width,Dt[9]=2*m.centerOffset.y/m.height;const Gt=new Float64Array(16);i.cO(Gt,Dt,vt);const Pt=new Float64Array(16);i.bl(Pt,Gt);const wt=i.cA.fromInvProjectionMatrix(Pt,O,A,!0);for(const dn of wt.points){const cn=((Ae=dn)[0]/=M,Ae[1]/=M,Ae[2]=i.ce(Ae[2],m._center.lat),Ae);ve=Math.max(ve,i.c5(i.d9([],me,cn)))}}var Ae;ve*=x/(x-1);const Ie=Math.acos(s[2]),Ce=Math.atan2(-s[0],-s[1]),Te=new Pp;Te.position=me,Te.setPitchBearing(Ie,Ce);const Me=Te.getWorldToCamera(O,ne),Ke=ve*O,Be=Math.min(m._mercatorZfromZoom(17)*O*-2,-2*Ke),at=Te.getCameraToClipOrthographic(-Ke,Ke,-Ke,Ke,Be,(Ke+w*ne)/s[2]),Xe=new Float64Array(16);i.aB(Xe,at,Me);const Qe=i.d4(Math.floor(1e6*me[0])/1e6*O,Math.floor(1e6*me[1])/1e6*O,0),At=.5*x,Ye=[0,0,0];i.af(Ye,Qe,Xe),i.c4(Ye,Ye,At);const je=[Math.floor(Ye[0]),Math.floor(Ye[1]),Math.floor(Ye[2])],ut=[0,0,0];i.av(ut,Ye,je),i.c4(ut,ut,-1/At);const tt=new Float64Array(16);return i.bA(tt),i.br(tt,tt,ut),i.aB(Xe,tt,Xe),[Xe,Ke]}class rd extends i.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,c){return i.aV(this.requestManager.transformRequest(c,i.R.Model).url).then((p=>{if(!p)return;const x=i.aW(p),w=new i.aX(s,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w})).catch((p=>{if(p&&p.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${s} from ${c}: ${p.message}`)))}))}load(s,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(s),w=[],A=[];for(const M of x){const O=s[M];this.hasURLBeenRequested(O)&&!p.forceReload||(this.modelByURL[O]={modelId:M,scope:c},w.push(this.loadModel(M,O)),A.push(M)),this.models[c][M]||(this.models[c][M]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+A.length,Promise.allSettled(w).then((M=>{for(let O=0;O<M.length;O++){const{status:z}=M[O];if(z==="rejected")continue;const{value:B}=M[O];this.models[c][A[O]]||(this.models[c][A[O]]={model:null,numReferences:1}),this.models[c][A[O]].model=B}this.numModelsLoading[c]-=A.length,this.fire(new i.z("data",{dataType:"style"}))})).catch((M=>{this.fire(new i.y(new Error(`Could not load models: ${M.message}`)))}))}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(s,c):this.getModelByURL(this.modelUris[c][s]))}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}getModelByURL(s){if(!s)return null;const c=this.modelByURL[s];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(s,c){return this.models[c]&&this.models[c][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(s,p,{exactIdMatch:!0})||this.hasModelBeenAdded(s,p))&&this.modelUris[p][s]===x)this.models[p][s].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:w,modelId:A}=this.modelByURL[x];this.models[w][A].numReferences++}else this.modelUris[p][s]=x,this.load({[s]:this.modelUris[p][s]},p)}addModelURLs(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in s)p[x]=this.requestManager.normalizeModelURL(s[x])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of s)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&i.db(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,c,p=!1,x=!1){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,this.models[c][s].numReferences===0||x)){const w=this.modelUris[c][s];p||delete this.modelUris[c][s],delete this.modelByURL[w];const A=this.models[c][s].model;if(!A)return;delete this.models[c][s],A.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const c of Object.keys(this.models[s])){const p=this.models[s][c].model;delete this.models[s][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(s.context)}}const __=new i.a9({data:new i.aa(i.a6.colorTheme.data)});function Mp(m){if(!m.metadata||!m.metadata.content_area)return;const s=i.o.devicePixelRatio,{left:c,top:p,width:x,height:w}=m.metadata.content_area,A=c*s,M=p*s;return[A,M,A+x*s,M+w*s]}function kp(m){if(m)return m.map((([s,c])=>[s*i.o.devicePixelRatio,c*i.o.devicePixelRatio]))}class Yc{constructor(s,c,p){this.id=s,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return s;const p=this.sourceCache.getSource();if(!(p instanceof gl))return s;const x=c.map((A=>this.sourceCache.getTile(A))),w=p.getImages(x,Array.from(this.pendingRequests));for(const[A,M]of w)s.set(i.I.from({name:A,iconsetId:this.id}),M),this.pendingRequests.delete(A);for(const A of this.pendingRequests)this.missingRequests.add(A);return this.pendingRequests.clear(),s}}const ao=(m,s)=>Oe(m,s&&s.filter((c=>c.identifier!=="source.canvas"))),pf=i.aH(br,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),y_=i.aH(br,["setCenter","setZoom","setBearing","setPitch"]),mf=new Set(["background","sky","slot","custom"]),Gm={version:8,layers:[],sources:{}},gf={duration:300,delay:0};class Qo extends i.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},gf),this._buildingIndex=new yl(this),this.crossTileSymbolIndex=new fs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Ii,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.dd(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new nr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.de(s._requestManager,c.localFontFamily?i.df.all:c.localIdeographFontFamily?i.df.ideographs:i.df.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new rd(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.dg());const p=this;this._rtlTextPluginCallback=Qo.registerForPluginStateChange((x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},((w,A)=>{if(i.dh(w),A&&A.every((M=>M)))for(const M in p._sourceCaches){const O=p._sourceCaches[M],z=O.getSource().type;z!=="vector"&&z!=="geojson"||O.reload()}}))})),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const A in this._layers){const M=this._layers[A];M.source===w.id&&this._validateLayer(M)}}))}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(i.h(s))return s;const c=i.di(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.dj(JSON.stringify(s))}`}_diffStyle(s,c,p){this.globalId=this._getGlobalId(s);const x=(w,A)=>{try{A(null,this.setState(w,p))}catch(M){A(M,!1)}};if(typeof s=="string"){const w=this.map._requestManager.normalizeStyleURL(s),A=this.map._requestManager.transformRequest(w,i.R.Style);i.m(A,((M,O)=>{M?this.fire(new i.y(M)):O&&x(O,c)}))}else typeof s=="object"&&x(s,c)}loadURL(s,c={}){this.fire(new i.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!i.h(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const x=this.importsCache.get(s);if(x)return this._load(x,p);const w=this.map._requestManager.transformRequest(s,i.R.Style);this._request=i.m(w,((A,M)=>{if(this._request=null,A)this.fire(new i.y(A));else if(M)return this.importsCache.set(s,M),this._load(M,p)}))}loadJSON(s,c={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=i.o.frame((()=>{this._request=null,this._load(s,c.validate!==!1)}))}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(Gm,!1)}_loadImports(s,c,p){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of s){const A=this._createFragmentStyle(w),M=new Promise((B=>{A.once("style.import.load",B),A.once("error",B)})).then((()=>this.mergeAll()));if(x.push(M),this.resolvedImports.has(w.url)){A.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(A.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(A.globalId=null)):w.url?A.loadURL(w.url,{validate:c}):A.loadEmpty();const z={style:A,id:w.id,config:w.config};if(p){const B=this.fragments.findIndex((({id:G})=>G===p));this.fragments=this.fragments.slice(0,B).concat(z).concat(this.fragments.slice(B))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(s=this,c=new Set){for(const p of s.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?i.B(s.id,this.scope):s.id;let p;const x=this._initialConfig&&this._initialConfig[c];(s.config||x)&&(p=Object.assign({},s.config,x));const w=new Qo(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,c){if(this._isInternalStyle(s)){const w=Object.assign({},Gm,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(w,c)}if(this.updateConfig(this._config,s.schema),c&&ao(this,_o(s)))return;this._loaded=!0,this.stylesheet=i.dk(s);const p=()=>{for(const O in s.sources)this.addSource(O,s.sources[O],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const O in s.iconsets)this.addIconset(O,s.iconsets[O]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const w=Kd(this.stylesheet.layers);if(this._order=w.map((O=>O.id)),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new Ve(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ve(this.stylesheet.light)),this._layers={};for(const O of w){const z=i.dq(O,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const B=this.getOwnLayerSourceCache(z),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&z.canCastShadows()&&G&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const M=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then((()=>{this._reloadImports(),this.fire(new i.z(M?"style.load":"style.import.load"))})).catch((O=>{this.fire(new i.y(new Error("Failed to load imports",O))),this.fire(new i.z(M?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new i.z(M?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const w=this._evaluateColorThemeData(x);this._loadColorTheme(w).then((()=>{p()})).catch((A=>{i.w(`Couldn't load color theme from the stylesheet: ${A}`),p()}))}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,c,p,x,w,A,M,O,z,B;const G={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((V=>{if(V.stylesheet){if(V.light!=null&&(s=V.light),V.stylesheet.lights)for(const Y of V.stylesheet.lights)Y.type==="ambient"&&V.ambientLight!=null&&(c=V.ambientLight),Y.type==="directional"&&V.directionalLight!=null&&(p=V.directionalLight);x=this._prioritizeTerrain(x,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(w=V.fog),V.stylesheet.snow&&V.snow!=null&&(A=V.snow),V.stylesheet.rain&&V.rain!=null&&(M=V.rain),V.stylesheet.camera!=null&&(B=V.stylesheet.camera),V.stylesheet.projection!=null&&(O=V.stylesheet.projection),V.stylesheet.transition!=null&&(z=V.stylesheet.transition),G[V.scope]=V._styleColorTheme}})),this.light=s,this.ambientLight=c,this.directionalLight=p,this.fog=w,this.snow=A,this.rain=M,this._styleColorThemeForScope=G,x===null?delete this.terrain:this.terrain=x,this.camera=B||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},gf,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=p=>{for(const x of p.fragments)c(x.style);s(p)};c(this)}_prioritizeTerrain(s,c,p){const x=s&&s.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?s:null:c!=null&&(!s||x||c&&c.drapeRenderMode===1)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)})),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle((c=>{c.stylesheet.projection!=null&&(s=c.stylesheet.projection)})),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},p={};this.forEachFragmentStyle((x=>{for(const w in x._sourceCaches){const A=i.B(w,x.scope);s[A]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const A=i.B(w,x.scope);c[A]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const A=i.B(w,x.scope);p[A]=x._symbolSourceCaches[w]}})),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeLayers(){const s={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((A=>{for(const M of A._order){const O=A._layers[M];if(O.type==="slot"){const z=i.dl(M);if(s[z])continue;s[z]=[]}O.slot&&s[O.slot]?s[O.slot].push(O):c.push(O)}})),this._mergedOrder=[];let x=-1;const w=(A=[])=>{for(const M of A)if(M.type==="slot"){const O=i.dl(M.id);s[O]&&w(s[O]),this._mergedSlots.push(O)}else{const O=i.B(M.id,M.scope);this._mergedOrder.push(O),p[O]=M,M.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),M.type==="circle"&&(this._hasCircleLayers=!0),M.type==="symbol"&&(this._hasSymbolLayers=!0),M.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(c),this._has3DLayers){const A={};for(let M=0;M<this._mergedOrder.length;++M){const O=this._mergedOrder[M];A[O]=M===x?1:M<x?p[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((M,O)=>A[M]-A[O]))}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?(function(c,p,x,w){const A=Object.assign({},p);for(const O of Object.keys(i.a6.colorTheme))A[O]===void 0&&(A[O]=i.a6.colorTheme[O].default);const M=new i.a8(__,c,new Map(x));return M.setTransitionOrValue(A,x),M.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))})(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((p,x)=>{const w="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let A=s;A.startsWith(w)||(A=w+A);const M=i.I.from("mapbox-reserved-lut"),O=new Image;O.src=A,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:B,data:G}=i.o.getImageData(O);if(B>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==B*B)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new i.q({width:z,height:B},G),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(M,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:s},p()):x(new Error("Missing LUT image."))}}))}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=(function(c,p,x){let w,A,M;const O=i.o.devicePixelRatio>1?"@2x":"";let z=i.m(p.transformRequest(p.normalizeSpriteURL(c,O,".json"),i.R.SpriteJSON),((V,Y)=>{z=null,M||(M=V,w=Y,G())})),B=i.n(p.transformRequest(p.normalizeSpriteURL(c,O,".png"),i.R.SpriteImage),((V,Y)=>{B=null,M||(M=V,A=Y,G())}));function G(){if(M)x(M);else if(w&&A){const V=i.o.getImageData(A),Y={};for(const J in w){const{width:Q,height:ce,x:ne,y:he,sdf:me,pixelRatio:ve,stretchX:Pe,stretchY:Ae,content:Ie}=w[J],Ce=new i.q({width:Q,height:ce});i.q.copy(V,Ce,{x:ne,y:he},{x:0,y:0},{width:Q,height:ce},null),Y[J]={data:Ce,pixelRatio:ve!==void 0?ve:1,sdf:me!==void 0&&me,stretchX:Pe,stretchY:Ae,content:Ie,usvg:!1,version:0}}x(null,Y)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}})(s,this.map._requestManager,((c,p)=>{if(this._spriteRequest=null,c)this.fire(new i.y(c));else if(p){const x=new Map;for(const w in p)x.set(i.I.from(w),p[w]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))}))}addIconset(s,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const w=new Yc(s,this.scope,p);this.imageManager.addImageProvider(w,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!i.h(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(w,A)=>{if(this._spriteRequest=null,w)c?this._loadSprite(s):this.fire(new i.y(w));else if(A){const M=new Map;for(const O in A)M.set(i.I.from(O),A[O]);this.addImages(M)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(s),i.R.Iconset),((w,A)=>{if(w)return void x(w);const M={},O=i.dc(new i.bt(A));for(const z of O.icons){const B={version:1,pixelRatio:i.o.devicePixelRatio,content:Mp(z),stretchX:z.metadata?kp(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?kp(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};M[z.name]=B}x(null,M)})))}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const p=s.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((s,c)=>{const p=this.fragments[c];return p&&p.style&&(s.data=p.style.serialize()),s}))}_serializeSources(){const s={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();s[p.id]||(s[p.id]=p.serialize())}return s}_serializeLayers(s){const c=[];for(const p of s){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new i.y(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new i.y(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const p=this.map.painter;if(p)for(let x=s.minzoom||0;x<(s.maxzoom||25.5);x++){const w=s.getProgramIds();if(w)for(const A of w){const M=s.getDefaultProgramParams(A,c.zoom,this._styleColorTheme.lut);M&&(p.style=this,this.fog&&(p._fogVisible=!0,M.overrideFog=!0,p.getOrCreateProgram(A,M)),p._fogVisible=!1,M.overrideFog=!1,p.getOrCreateProgram(A,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,p.getOrCreateProgram(A,M)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const O in M){const{updatedIds:z,removedIds:B}=M[O];(z||B)&&(this._updateWorkerLayers(O,z,B),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const w={};for(const M in this._mergedSourceCaches){const O=this._mergedSourceCaches[M];w[M]=O.used,O.used=!1,O.tileCoverLift=0}for(const M of this._mergedOrder){const O=this._mergedLayers[M];if(O.recalculate(s,this._availableImages),!O.isHidden(s.zoom)){const z=this.getLayerSourceCache(O);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(O,s)})):this.precompilePrograms(O,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const A=this.imageManager.getPendingImageProviders();for(const M of A)M.sourceCache.used=!0;for(const M in w){const O=this._mergedSourceCaches[M];w[M]!==O.used&&O.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const c of s){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const s={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;s[p]=s[p]||this._changes.getUpdatedImages(p),s[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s[p])}for(const c in s)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(s,c,p){const x=this.getFragmentStyle(s);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:s,removedIds:p||[],options:x.options})}setState(s,c){if(this._checkLoaded(),ao(this,_o(s)))return!1;(s=i.dk(s)).layers=Kd(s.layers);const p=(function(A,M){if(!A)return[{command:br.setStyle,args:[M]}];let O=[];try{if(!i.by(A.version,M.version))return[{command:br.setStyle,args:[M]}];if(i.by(A.center,M.center)||O.push({command:br.setCenter,args:[M.center]}),i.by(A.zoom,M.zoom)||O.push({command:br.setZoom,args:[M.zoom]}),i.by(A.bearing,M.bearing)||O.push({command:br.setBearing,args:[M.bearing]}),i.by(A.pitch,M.pitch)||O.push({command:br.setPitch,args:[M.pitch]}),i.by(A.sprite,M.sprite)||O.push({command:br.setSprite,args:[M.sprite]}),i.by(A.glyphs,M.glyphs)||O.push({command:br.setGlyphs,args:[M.glyphs]}),i.by(A.imports,M.imports)||(function(Y=[],J=[],Q){J=J||[];const ce=(Y=Y||[]).map(zl),ne=J.map(zl),he=Y.reduce(fc,{}),me=J.reduce(fc,{}),ve=ce.slice();let Pe,Ae,Ie,Ce;for(Pe=0,Ae=0;Pe<ce.length;Pe++)Ie=ce[Pe],me.hasOwnProperty(Ie)?Ae++:(Q.push({command:br.removeImport,args:[Ie]}),ve.splice(ve.indexOf(Ie,Ae),1));for(Pe=0,Ae=0;Pe<ne.length;Pe++)Ie=ne[ne.length-1-Pe],ve[ve.length-1-Pe]!==Ie&&(he.hasOwnProperty(Ie)?(Q.push({command:br.removeImport,args:[Ie]}),ve.splice(ve.lastIndexOf(Ie,ve.length-Ae),1)):Ae++,Ce=ve[ve.length-Pe],Q.push({command:br.addImport,args:[me[Ie],Ce]}),ve.splice(ve.length-Pe,0,Ie));for(const Te of J){const Me=he[Te.id];Me&&(delete Me.data,i.by(Me,Te)||Q.push({command:br.updateImport,args:[Te.id,Te]}))}})(A.imports,M.imports,O),i.by(A.transition,M.transition)||O.push({command:br.setTransition,args:[M.transition]}),i.by(A.light,M.light)||O.push({command:br.setLight,args:[M.light]}),i.by(A.fog,M.fog)||O.push({command:br.setFog,args:[M.fog]}),i.by(A.snow,M.snow)||O.push({command:br.setSnow,args:[M.snow]}),i.by(A.rain,M.rain)||O.push({command:br.setRain,args:[M.rain]}),i.by(A.projection,M.projection)||O.push({command:br.setProjection,args:[M.projection]}),i.by(A.lights,M.lights)||O.push({command:br.setLights,args:[M.lights]}),i.by(A.camera,M.camera)||O.push({command:br.setCamera,args:[M.camera]}),i.by(A.iconsets,M.iconsets)||(function(Y,J,Q){let ce;for(ce in J=J||{},Y=Y||{})Y.hasOwnProperty(ce)&&(J.hasOwnProperty(ce)||Q.push({command:br.removeIconset,args:[ce]}));for(ce in J){if(!J.hasOwnProperty(ce))continue;const ne=J[ce];Y.hasOwnProperty(ce)?i.by(Y[ce],ne)||(Q.push({command:br.removeIconset,args:[ce]}),Q.push({command:br.addIconset,args:[ce,ne]})):Q.push({command:br.addIconset,args:[ce,ne]})}})(A.iconsets,M.iconsets,O),!i.by(A["color-theme"],M["color-theme"]))return[{command:br.setStyle,args:[M]}];const z={},B=[];(function(Y,J,Q,ce){let ne;for(ne in J=J||{},Y=Y||{})Y.hasOwnProperty(ne)&&(J.hasOwnProperty(ne)||Vm(ne,Q,ce));for(ne in J){if(!J.hasOwnProperty(ne))continue;const he=J[ne];Y.hasOwnProperty(ne)?i.by(Y[ne],he)||(Y[ne].type==="geojson"&&he.type==="geojson"&&Qd(Y,J,ne)?Q.push({command:br.setGeoJSONSourceData,args:[ne,he.data]}):Jd(ne,J,Q,ce)):Zh(ne,J,Q)}})(A.sources,M.sources,B,z);const G=[];A.layers&&A.layers.forEach((Y=>{Y.source&&z[Y.source]?O.push({command:br.removeLayer,args:[Y.id]}):G.push(Y)}));let V=A.terrain;V&&z[V.source]&&(O.push({command:br.setTerrain,args:[void 0]}),V=void 0),O=O.concat(B),i.by(V,M.terrain)||O.push({command:br.setTerrain,args:[M.terrain]}),(function(Y,J,Q){J=J||[];const ce=(Y=Y||[]).map(zl),ne=J.map(zl),he=Y.reduce(fc,{}),me=J.reduce(fc,{}),ve=ce.slice(),Pe=Object.create(null);let Ae,Ie,Ce,Te,Me,Ke,Be;for(Ae=0,Ie=0;Ae<ce.length;Ae++)Ce=ce[Ae],me.hasOwnProperty(Ce)?Ie++:(Q.push({command:br.removeLayer,args:[Ce]}),ve.splice(ve.indexOf(Ce,Ie),1));for(Ae=0,Ie=0;Ae<ne.length;Ae++)Ce=ne[ne.length-1-Ae],ve[ve.length-1-Ae]!==Ce&&(he.hasOwnProperty(Ce)?(Q.push({command:br.removeLayer,args:[Ce]}),ve.splice(ve.lastIndexOf(Ce,ve.length-Ie),1)):Ie++,Ke=ve[ve.length-Ae],Q.push({command:br.addLayer,args:[me[Ce],Ke]}),ve.splice(ve.length-Ae,0,Ce),Pe[Ce]=!0);for(Ae=0;Ae<ne.length;Ae++)if(Ce=ne[Ae],Te=he[Ce],Me=me[Ce],!Pe[Ce]&&!i.by(Te,Me))if(i.by(Te.source,Me.source)&&i.by(Te["source-layer"],Me["source-layer"])&&i.by(Te.type,Me.type)){for(Be in Hc(Te.layout,Me.layout,Q,Ce,null,br.setLayoutProperty),Hc(Te.paint,Me.paint,Q,Ce,null,br.setPaintProperty),i.by(Te.slot,Me.slot)||Q.push({command:br.setSlot,args:[Ce,Me.slot]}),i.by(Te.filter,Me.filter)||Q.push({command:br.setFilter,args:[Ce,Me.filter]}),i.by(Te.minzoom,Me.minzoom)&&i.by(Te.maxzoom,Me.maxzoom)||Q.push({command:br.setLayerZoomRange,args:[Ce,Me.minzoom,Me.maxzoom]}),Te)Te.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Hc(Te[Be],Me[Be],Q,Ce,Be.slice(6),br.setPaintProperty):i.by(Te[Be],Me[Be])||Q.push({command:br.setLayerProperty,args:[Ce,Be,Me[Be]]}));for(Be in Me)Me.hasOwnProperty(Be)&&!Te.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Hc(Te[Be],Me[Be],Q,Ce,Be.slice(6),br.setPaintProperty):i.by(Te[Be],Me[Be])||Q.push({command:br.setLayerProperty,args:[Ce,Be,Me[Be]]}))}else Q.push({command:br.removeLayer,args:[Ce]}),Ke=ve[ve.lastIndexOf(Ce)+1],Q.push({command:br.addLayer,args:[Me,Ke]})})(G,M.layers,O)}catch(z){console.warn("Unable to compute style diff:",z),O=[{command:br.setStyle,args:[M]}]}return O})(this.serialize(),s).filter((A=>!(A.command in y_)));if(p.length===0)return!1;const x=p.filter((A=>!(A.command in pf)));if(x.length>0)throw new Error(`Unimplemented: ${x.map((A=>A.command)).join(", ")}.`);const w=[];return p.forEach((A=>{w.push(this[A.command](...A.args))})),c&&Promise.all(w).then(c).catch(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[c,p]of s.entries()){if(this.getImage(c))return this.fire(new i.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(s,c){return this.getImage(s)?this.fire(new i.y(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,c),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(s,c,p=!1){this.imageManager.updateImage(s,this.scope,c),p&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(s){return this.modelManager.addModelURLs(s,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(s,c,p={}){return this._checkLoaded(),this._validate(ze,`models.${s}`,c,null,p)||(this.modelManager.addModel(s,c,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,p={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Hh,`sources.${s}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=uc(s,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id})));const w=A=>{const M=(A?"symbol:":"other:")+x.id,O=i.B(M,this.scope),z=this._sourceCaches[M]=new As(O,x,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find((([w,A])=>A.type==="source"&&A.source===s));if(x)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(s);for(const x of p){const w=i.dl(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&s.push(p.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const p=s[c]._tiles;for(const x in p){const w=p[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const w of s){if(this._validate(Wd,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const A=this.ambientLight;A.set(w),A.updateTransitions(c)}else this.ambientLight=new Or(w,zi||(zi=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const A=this.directionalLight;A.set(w),A.updateTransitions(c)}else this.directionalLight=new Or(w,Ur||(Ur=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new i.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const p=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),x=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=s.properties.get("intensity"),A=s.properties.get("direction"),M=1-i.d3(A.x,A.y,A.z)[2]/90,O=p(x)*w*M,z=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),B=c.properties.get("intensity"),G=p(z)*B;return Number(((O+G)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(i.dm(s)){const c=i.dn(s),p=this.fragments.find((({id:w})=>w===c));if(!p)return;const x=i.dl(s);return p.style.getFragmentStyle(x)}{const c=this.fragments.find((({id:p})=>p===s));return c?c.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const c={},p=(x,w="")=>`${x}::${w}`;this._featuresetSelectors={};for(const x in s){const w=this._featuresetSelectors[x]=[];for(const A of s[x].selectors){if(A.featureNamespace){const O=this.getOwnLayer(A.layer);if(!O){i.w(`Layer is undefined for selector: ${A.layer}`);continue}const z=p(O.source,O.sourceLayer);if(z in c&&c[z]!==A.featureNamespace){i.w(`"featureNamespace ${A.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[z]=A.featureNamespace}let M;if(A.properties)for(const O in A.properties){const z=i.U(A.properties[O]);z.result==="success"&&(M=M||{},M[O]=z.value)}w.push({layerId:A.layer,namespace:A.featureNamespace,properties:M,uniqueFeatureID:A._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(s,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[s])return this.fire(new i.y(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const A of x[s].selectors){const M=p.getOwnLayer(A.layer);M&&w.push(M)}return w}getConfigProperty(s,c){const p=this.getFragmentStyle(s);if(!p)return null;const x=i.B(c,p.scope),w=p.options.get(x),A=w?w.value||w.default:null;return A?A.serialize():null}setConfigProperty(s,c,p){const x=this.getFragmentStyle(s);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[c])return;const A=i.U(p);if(A.result!=="success")return void ao(this,A.value);const M=A.value.expression,O=i.B(c,x.scope),z=x.options.get(O);if(!z)return;let B;const{minValue:G,maxValue:V,stepValue:Y,type:J,values:Q}=w[c],ce=i.U(w[c].default);ce.result==="success"&&(B=ce.value.expression),B?(this.options.set(O,Object.assign({},z,{value:M,default:B,minValue:G,maxValue:V,stepValue:Y,type:J,values:Q})),this.updateConfigDependencies(c)):this.fire(new i.y(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const w in p){const A=i.B(w,c.scope),M=c.options.get(A),O=M?M.value||M.default:null;x[w]=O?O.serialize():null}return x}setConfig(s,c){const p=this.getFragmentStyle(s);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const p=this.getFragmentStyle(s);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const p in c){let x,w;const A=i.U(c[p].default);if(A.result==="success"&&(x=A.value.expression),s&&s[p]!==void 0){const V=i.U(s[p]);V.result==="success"&&(w=V.value.expression)}const{minValue:M,maxValue:O,stepValue:z,type:B,values:G}=c[p];if(x){const V=i.B(p,this.scope);this.options.set(V,{default:x,value:w,minValue:M,maxValue:O,stepValue:z,type:B,values:G})}else this.fire(new i.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const c of this._configDependentLayers){const p=this.getLayer(c);if(p){if(s&&!p.configDependencies.has(s))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}})),this._changes.setDirty()}addLayer(s,c,p={}){this._checkLoaded();const x=s.id;if(this._layers[x])return void this.fire(new i.y(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(s.type==="custom"){if(ao(this,i.dp(s)))return;w=i.dq(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(x,s.source),s=i.dk(s),s=Object.assign(s,{source:x})),this._validate($e,`layers.${x}`,s,{arrayIndex:-1},p))return;w=i.dq(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}})}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let A=this._order.length;if(c){const B=this._order.indexOf(c);if(B===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?A=B:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const M=this.getOwnLayerSourceCache(w),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&w.canCastShadows()&&O&&(M.castsShadows=!0);const z=this._changes.getRemovedLayer(w);if(z&&w.source&&M&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const B=i.B(w.source,w.scope);z.type!==w.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),M.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const p=this._checkLayer(s);if(!p||s===c)return;const x=this._order.indexOf(s);this._order.splice(x,1);let w=this._order.length;if(c){const A=this._order.indexOf(c);if(A===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?w=A:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let w=!1;for(const A in this._layers)if(this._layers[A].source===c.source&&this._layers[A].canCastShadows()){w=!0;break}x.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,p){this._checkLoaded();const x=this._checkLayer(s);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const p=this._checkLayer(s);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(s,c,p={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!i.by(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(oe,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=i.dk(c),this._updateLayer(x)))}getFilter(s){const c=this._checkLayer(s);if(c)return i.dk(c.filter)}setLayoutProperty(s,c,p,x={}){this._checkLoaded();const w=this._checkLayer(s);if(w&&!i.by(w.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&ao(w,Se.call(_o,{key:`layers.${s}.layout.${c}`,layerType:w.type,objectKey:c,value:p,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,p),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(s,c){const p=this._checkLayer(s);if(p)return p.getLayoutProperty(c)}setPaintProperty(s,c,p,x={}){this._checkLoaded();const w=this._checkLayer(s);if(!w||i.by(w.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&ao(w,de.call(_o,{key:`layers.${s}.paint.${c}`,layerType:w.type,objectKey:c,value:p,styleSpec:i.a6})))return;const A=w.setPaintProperty(c,p);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),A&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(s,c){const p=this._checkLayer(s);if(p)return p.getPaintProperty(c)}setFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:z}=s.target,B=this.getFragmentStyle(z),G=B.getFeaturesetLayers(O);for(const{source:V,sourceLayer:Y}of G)B.setFeatureState({id:s.id,source:V,sourceLayer:Y},c)}else if("layerId"in s.target){const{layerId:O}=s.target,z=this.getLayer(O);this.setFeatureState({id:s.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=s.source,x=s.sourceLayer,w=this._checkSource(p);if(!w)return;const A=w.type;if(A==="geojson"&&x)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!x)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(p);for(const O of M)O.setFeatureState(x,s.id,c)}removeFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:z}=s.target,B=this.getFragmentStyle(z),G=B.getFeaturesetLayers(O);for(const{source:V,sourceLayer:Y}of G)B.removeFeatureState({id:s.id,source:V,sourceLayer:Y},c)}else if("layerId"in s.target){const{layerId:O}=s.target,z=this.getLayer(O);this.removeFeatureState({id:s.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=s.source,x=this._checkSource(p);if(!x)return;const w=x.type,A=w==="vector"?s.sourceLayer:void 0;if(w==="vector"&&!A)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(p);for(const O of M)O.removeFeatureState(A,s.id,c)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let w;if("featuresetId"in s.target){const{featuresetId:A,importId:M}=s.target,O=this.getFragmentStyle(M),z=O.getFeaturesetLayers(A);for(const{source:B,sourceLayer:G}of z){const V=O.getFeatureState({id:s.id,source:B,sourceLayer:G});if(V&&!w)w=V;else if(!i.by(w,V))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:A}=s.target,M=this.getLayer(A);w=this.getFeatureState({id:s.id,source:M.source,sourceLayer:M.sourceLayer})}return w}const c=s.source,p=s.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,s.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return i.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(p=>p!==void 0))}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),p=i.B(s.source,s.scope),x=this._changes.getUpdatedSourceCaches();s.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=M=>this._mergedLayers[M].is3D(!!this.terrain),p=this.order,x={},w=[];for(let M=p.length-1;M>=0;M--){const O=p[M];if(c(O)){x[O]=M;for(const z of s){const B=z[O];if(B)for(const G of B)w.push(G)}}}w.sort(((M,O)=>O.intersectionZ-M.intersectionZ));const A=[];for(let M=p.length-1;M>=0;M--){const O=p[M];if(c(O))for(let z=w.length-1;z>=0;z--){const B=w[z].feature;if(B.layer&&x[B.layer.id]<M)break;A.push(B),w.pop()}else for(const z of s){const B=z[O];if(B)for(const G of B)A.push(G.feature)}}return A}queryRasterValue(s,c,p){const x=this.getOwnSource(s);return x?x.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(c,p):(this.fire(new i.y(new Error(`Source with id "${s}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(s,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(oe,"queryRenderedFeatures.filter",c.filter,null,c),x=i.b6(c.filter));const w={},A=B=>{if(mf.has(B.type))return;const G=this.getOwnLayerSourceCache(B),V=w[G.id]=w[G.id]||{sourceCache:G,layers:{},has3DLayers:!1};B.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[B.fqid]=V.layers[B.fqid]||{styleLayer:B,targets:[]},V.layers[B.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const B of c.layers){const G=this._layers[B];if(!G)return this.fire(new i.y(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];A(G)}}else for(const B in this._layers)A(this._layers[B]);const M=this._queryRenderedFeatures(s,w,p),O=this._flattenAndSortRenderedFeatures(M),z=[];for(const B of O)i.ds(B.layer.id)===this.scope&&z.push(B);return z}queryRenderedFeatureset(s,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(oe,"queryRenderedFeatures.filter",c.filter,null,c),x=i.b6(c.filter));const w="mock",A=[];if(c&&c.target)A.push(Object.assign({},c,{targetId:w,filter:x}));else{const B=this.getFeaturesetDescriptors();for(const G of B)A.push({targetId:w,filter:x,target:G});for(const{style:G}of this.fragments){const V=G.getFeaturesetDescriptors();for(const Y of V)A.push({targetId:w,filter:x,target:Y})}}const M=this.queryRenderedTargets(s,A,p),O=[],z=new Set;for(const B of M)for(const G of B.variants[w])Bc(G,B,z)||O.push(new i.dt(B,G));return O}queryRenderedTargets(s,c,p){const x={},w=(M,O,z,B)=>{const G=x[O.id]=x[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(G.layers[M.fqid]=G.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D(!!this.terrain)&&(G.has3DLayers=!0),!B)return z.uniqueFeatureID=!1,void G.layers[M.fqid].targets.push(z);G.layers[M.fqid].targets.push(Object.assign({},z,{namespace:B.namespace,properties:B.properties,uniqueFeatureID:B.uniqueFeatureID}))};for(const M of c)if("featuresetId"in M.target){const{featuresetId:O,importId:z}=M.target,B=this.getFragmentStyle(z);if(!B||!B._featuresetSelectors)continue;const G=B._featuresetSelectors[O];if(!G){this.fire(new i.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of G){const Y=B.getOwnLayer(V.layerId);Y&&!mf.has(Y.type)&&w(Y,B.getOwnLayerSourceCache(Y),M,V)}}else if("layerId"in M.target){const{layerId:O}=M.target,z=this.getLayer(O);if(!z||mf.has(z.type))continue;w(z,this.getLayerSourceCache(z),M)}const A=this._queryRenderedFeatures(s,x,p);return this._flattenAndSortRenderedFeatures(A)}_queryRenderedFeatures(s,c,p){const x=[],w=!!this.map._showQueryGeometry,A=wi.createFromScreenPoints(s,p);for(const M in c){const O=Zd(A,c[M],this._availableImages,p,w);Object.keys(O).length&&x.push(O)}if(this.placement)for(const M in c){if(!c[M].sourceCache._onlySymbols)continue;const O=Xd(A.screenGeometry,c[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&x.push(O)}return x}querySourceFeatures(s,c){const p=c&&c.filter;p&&this._validate(oe,"querySourceFeatures.filter",p,null,c);let x=[];const w=this.getOwnSourceCaches(s);for(const A of w)x=x.concat(_l(A,c));return x}addSourceType(s,c,p){return Qo.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(Qo.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,p={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const M in s)if(!i.by(s[M],x[M])){w=!0;break}if(!w)return;const A=this._getTransitionParameters();this.light.setLight(s,c,p),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=s;const x=s.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const M="terrain-dem-src";this.addSource(M,p.source),p=i.dk(p),p=Object.assign(p,{source:M})}const w=Object.assign({},p),A={};if(this.terrain&&x){w.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(A.style=M.serialize())}if(this._validate(It,"terrain",w,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new i.z("data",{dataType:"style"}))}else{const w=this.terrain,A=w.get();for(const M of Object.keys(i.a6.terrain))!p.hasOwnProperty(M)&&i.a6.terrain[M].default&&(p[M]=i.a6.terrain[M].default);for(const M in s)if(!i.by(s[M],A[M])){w.set(s,this.options),this.stylesheet.terrain=s;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new xr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(s){const c=this.snow=new ts(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(s){const c=this.rain=new $r(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const s of this.map._markers)s._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.by(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.by(c.get(),s)){c.set(s,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.by(c.get(),s)){c.set(s,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void s();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then((()=>{this.fire(new i.z("colorthemeset")),s()})).catch((x=>{i.w(`Couldn't set color theme: ${x}`)}))}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,c){const p=this.getFragmentStyle(s);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(s){return{now:i.o.now(),transition:Object.assign(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?s.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const p=this.terrain=new ot(s,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,p,x,w={}){if(w&&w.validate===!1)return!1;const A=Object.assign({},this.serialize());return ao(this,s.call(_o,Object.assign({key:c,style:A,value:p,styleSpec:i.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const p of c)p.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const c=this._mergedLayers[s];c._clear&&c._clear()}}reloadSource(s){const c=this.getSourceCaches(s);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((s=>{s.modelManager.reloadModels(s.scope)}))}updateSources(s){let c;this.directionalLight&&(c=zu(this.directionalLight));const p=new Set;for(const x in this._mergedLayers){const w=this._mergedLayers[x];w.hasElevation()&&!p.has(w.source)&&p.add(w.source)}for(const x in this._mergedSourceCaches){const w=this._mergedSourceCaches[x],A=p.has(w._source.id);w.update(s,void 0,void 0,c,A)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,p,x,w,A,M=!1){let O=!1,z=!1;const B={},G={};for(const V of this._mergedOrder){const Y=this._mergedLayers[V];if(Y.type!=="symbol")continue;const J=i.B(Y.source,Y.scope);let Q=B[J];if(!Q){const ne=this.getLayerSourceCache(Y);if(!ne)continue;const he=ne.getRenderableIds(!0).map((me=>ne.getTileByID(me)));G[J]=he.slice(),Q=B[J]=he.sort(((me,ve)=>ve.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ve.tileID)?-1:1)))}const ce=this.crossTileSymbolIndex.addLayer(Y,Q,c.center.lng,c.projection);O=O||ce}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),c.zoom))&&(this.pauseablePlacement=new xo(c,this._mergedOrder,M,p,x,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,G,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),z=!0),O&&this.pauseablePlacement.placement.setStale()),z||O){this._buildingIndex.onNewFrame(c.zoom);for(let V=0;V<this._mergedOrder.length;V++){const Y=this._mergedLayers[this._mergedOrder[V]];if(Y.type!=="symbol")continue;const J=this.isLayerClipped(Y);this.placement.updateLayerOpacities(Y,B[i.B(Y.source,Y.scope)],V,J?A:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex((({id:w})=>w===s.id))!==-1)return void this.fire(new i.y(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return p.push(s),this._loadImports([s],!0);const x=p.findIndex((({id:w})=>w===c));return x===-1&&this.fire(new i.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(s).concat(p.slice(x)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(s);return x===-1?this:typeof c=="string"?(this.setImportUrl(s,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(s,c.url),i.by(c.config,p[x].config)||this.setImportConfig(s,c.config,c.data.schema),i.by(c.data,p[x].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(s);if(x===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const A=p[x],M=this.fragments[x];return p=p.filter((({id:O})=>O!==s)),this.fragments=this.fragments.filter((({id:O})=>O!==s)),this.stylesheet.imports=p.slice(0,w).concat(A).concat(p.slice(w)),this.fragments=this.fragments.slice(0,w).concat(M).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(s);if(x===-1)return this;p[x].url=c;const w=this.fragments[x];return w.style=this._createFragmentStyle(p[x]),w.style.on("style.import.load",(()=>this.mergeAll())),w.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const p=this.getImportIndex(s),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(s,x[p].url))}setImportConfig(s,c,p){this._checkLoaded();const x=this.getImportIndex(s),w=this.stylesheet.imports||[];if(x===-1)return this;c?w[x].config=c:delete w[x].config;const A=this.fragments[x];p&&A.style.stylesheet&&(A.style.stylesheet.schema=p);const M=A.style.stylesheet&&A.style.stylesheet.schema;return A.config=c,A.style.updateConfig(c,M),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(s);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex((p=>p.id===s));return c===-1&&this.fire(new i.y(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&s.push(p.getSource())}return s}getSource(s,c){const p=this.getSourceCache(s,c);return p&&p.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const p=i.B(s,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(s){const c=i.B(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const p=s[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=A=>{if(A){const M=c.images.map((O=>i.I.toString(O)));A.setDependencies(c.tileID.key,c.type,M)}},w=i.B(c.source,c.scope);x(this._mergedOtherSourceCaches[w]),x(this._mergedSymbolSourceCaches[w]),c.images.some((A=>A.iconsetId))&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(s,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(s,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(s,c,p){return i.dv(c,p)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return c.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${s}'`))),!1):c.every((p=>p.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const p=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),x=s.type==="building";if(s.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((s=>{s.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qo.getSourceType=function(m){return cc[m]},Qo.setSourceType=function(m,s){cc[m]=s},Qo.registerForPluginStateChange=i.dw;class v_{execute(s){const c=this._makeBuildingsQueryArea(s),p=this._makeFloorsQueryArea(s),x=s.queryRenderedFeatures(c).reduce(((z,B)=>{const G=B.properties.id;return B.properties.type!=="building"||z.some((V=>V.properties.id===G))||z.push(B),z}),[]),w=s.queryRenderedFeatures(p).reduce(((z,B)=>{const G=B.properties.id;return B.properties.type!=="floor"||z.some((V=>V.properties.id===G))||z.push(B),z}),[]),A=[s.getCenter().lng,s.getCenter().lat],M=this._findBuildingAtCenter(A,x),O=x.length>0?x[0]:null;return{floors:w.map((z=>({id:z.properties.id,name:z.properties.name,isDefault:z.properties.is_default,zIndex:z.properties.z_index,connectedFloorIds:z.properties.connected_floor_ids,conflictedFloorIds:z.properties.conflicted_floor_ids,buildingIds:z.properties.building_ids}))),building:M?{id:M.properties.id,name:M.properties.name}:{id:O.properties.id,name:O.properties.name}}}_makeBuildingsQueryArea(s){const c=s.transform.width,p=s.transform.height,x=Math.min(c,p)*(1/8),w=.5*(c-x),A=.5*(p-x);return[new i.P(w,A),new i.P(w+x,A+x)]}_makeFloorsQueryArea(s){const c=s.transform.width,p=s.transform.height;return[new i.P(0,0),new i.P(c,p)]}_findBuildingAtCenter(s,c){for(const p of c)if(p.geometry.type==="Polygon"&&this._pointInPolygon(s,p.geometry.coordinates[0]))return p;return null}_pointInPolygon(s,c){let p=!1;for(let x=0,w=c.length-1;x<c.length;w=x++){const A=c[x][0],M=c[x][1],O=c[w][1];M>s[1]!=O>s[1]&&s[0]<(c[w][0]-A)*(s[1]-M)/(O-M)+A&&(p=!p)}return p}}class x_{constructor(){this._floors=new Map,this._buildings=new Map}append(s){const c=s.building;let p=!1;if(c){const x=c.id;x&&(this._buildings.set(x,c),p||this._buildings.has(x)||(p=!0))}return s.floors.forEach((x=>{const w=x.id;p||this._floors.has(w)||(p=!0),this._floors.set(w,x)})),p}clear(){this._floors.clear(),this._buildings.clear()}getFloors(s=null){const c=Array.from(this._floors.values());return s?c.filter((p=>{const x=p.buildingIds;return!!x&&x.split(";").includes(s)})):c}}class Nu{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new x_}setIndoorData(s){const c=this._featuresStorage.append(s);return this._selectedBuildingId=s.building?s.building.id:null,c}setFloorId(s){const c=this._selectedFloorId!==s;return c&&(this._selectedFloorId=s),c}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const s=this._featuresStorage.getFloors(this._selectedBuildingId),c=this.getActiveFloors().find((p=>{const x=p.buildingIds;if(!x)return!1;const w=x.split(";");return!!this._selectedBuildingId&&w.includes(this._selectedBuildingId)}));return{selectedFloorId:c?c.id:null,floors:s}}getActiveFloors(s=!1){const c=this._featuresStorage.getFloors(),p=c.find((O=>O.id===this._selectedFloorId)),x=c.filter((O=>O.isDefault===!0));let w=[];if(p)return w=this._calculateCurrentActiveFloors(c,p,x,s),w;if(x.length===0){const O=this._featuresStorage.getFloors(this._selectedBuildingId);w=O.length>0?[O[0]]:[]}else w=x;const A=this._getNonConflictingLastActiveFloors(w),M=[...w,...A];return this._lastActiveFloors=M,M}hasBuildingChanged(s){return this._selectedBuildingId!==(s.building?s.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(s,c,p,x){if(!c)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,p);const w=this._getConnectedFloors(c,s);return x?this._buildExplicitSelectionFloors(c,w,p):this._buildImplicitSelectionFloors(w,p)}_getConnectedFloors(s,c){const p=s.connectedFloorIds;if(!p)return[];const x=new Set(p.split(";"));return c.filter((w=>x.has(w.id)))}_buildExplicitSelectionFloors(s,c,p){const x=[s,...c],w=this._getNonConflictingLastActiveFloors(x),A=[...x,...w],M=this._deduplicateFloors(A),O=this._getConflictingFloorIdsFrom(M),z=p.filter((G=>!O.has(G.id))),B=[...M,...z];return this._lastActiveFloors=B,B}_buildImplicitSelectionFloors(s,c){const p=this._getConflictingFloorIdsFrom(this._lastActiveFloors),x=c.filter((A=>!p.has(A.id))),w=this._deduplicateFloors([...this._lastActiveFloors,...x]);return this._lastActiveFloors=w,w}_getNonConflictingDefaultFloors(s,c){const p=this._getConflictingFloorIdsFrom(s),x=c.filter((A=>!p.has(A.id))),w=this._deduplicateFloors([...s,...x]);return this._lastActiveFloors=w,w}_deduplicateFloors(s){const c=new Set;return s.filter((p=>{const x=p.id;return!c.has(x)&&(c.add(x),!0)}))}_getConflictingFloorIdsFrom(s){const c=new Set;return s.forEach((p=>{const x=p.conflictedFloorIds;x&&x.split(";").forEach((w=>c.add(w)))})),c}_getNonConflictingLastActiveFloors(s){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const c=new Set(s.map((x=>x.id))),p=this._getConflictingFloorIdsFrom(s);return this._lastActiveFloors.filter((x=>{const w=x.id;return!c.has(w)&&!p.has(w)}))}_isFloorConflicted(s,c){const p=s.id;return c.some((x=>{const w=x.conflictedFloorIds;return!!w&&w.split(";").includes(p)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class gc extends i.E{constructor(s){super(),i.aY(["_onLoad","_onMove"],this),this._map=s,this._floorSelectionState=new Nu,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(s){this._floorSelectionState.setFloorId(s)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((s=>{s.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new i.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=s.scope,this._indoorDataQuery=new v_))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const s=this._indoorDataQuery.execute(this._map);if(!s||s.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(s)){if(!s.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(s),s.building&&this._updateIndoorSelector()}else this._setIndoorData(s)}_setIndoorData(s){this._floorSelectionState.setIndoorData(s)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const s=this._floorSelectionState.getCurrentBuildingSelection(),c=s.floors.map((p=>({id:p.id,name:p.name,shortName:p.zIndex.toString(),levelOrder:p.zIndex})));this.fire(new i.z("indoorupdate",{selectedFloorId:s.selectedFloorId,floors:c}))}_updateIndoorConfig(s=!1){const c=this._floorSelectionState.getActiveFloors(s).map((p=>p.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",c])}}var _c=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,_f=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Rp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,yc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,yf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,vf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,bo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,xf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ft=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Op=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Fu=[];qa(_c,Fu),qa(Rp,Fu),qa(_f,Fu);const Bu={"_prelude_fog.vertex.glsl":yf,"_prelude_terrain.vertex.glsl":xl,"_prelude_shadow.vertex.glsl":Ft,"_prelude_fog.fragment.glsl":vf,"_prelude_shadow.fragment.glsl":Op,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":bo,"_prelude_raster_particle.glsl":xf},id={};yr("",xl),yr(vf,yf),yr(Op,Ft),yr(bo,""),yr(xf,"");const Ga=yr(_f,Rp),Wa=_c;var sd={background:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:yr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:yr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:yr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:yr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:yr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:yr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:yr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:yr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:yr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:yr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:yr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:yr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:yr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:yr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:yr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:yr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:yr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:yr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,yc),skyboxGradient:yr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,yc),skyboxCapture:yr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:yr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:yr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:yr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:yr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:yr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:yr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:yr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:yr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function qa(m,s){const c=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const w of x)s.includes(w)||s.push(w)}}function yr(m,s){const c=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,x={},w=[],A=[];if(m=m.replace(c,((O,z)=>(A.push(z),""))),(s=s.replace(c,((O,z)=>(w.push(z),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...Fu];qa(m,M),qa(s,M);for(const O of[...w,...A])Bu[O]||console.error(`Undefined include: ${O}`),id[O]||(id[O]=[],qa(Bu[O],id[O])),M=[...M,...id[O]];return{fragmentSource:m=m.replace(p,((O,z,B,G,V)=>(x[V]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${B} ${G} ${V};
#else
uniform ${B} ${G} u_${V};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${B} ${G} ${V} = u_${V};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${B} ${G} ${V};
#endif
`:z==="initialize-attribute"?"":void 0))),vertexSource:s=s.replace(p,((O,z,B,G,V)=>{const Y=G==="float"?"vec2":G,J=V.match(/color/)?"color":Y;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${B} ${G} a_${V};
#endif
`:x[V]?z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${B} ${Y} a_${V};
out ${B} ${G} ${V};
#else
uniform ${B} ${G} u_${V};
#endif
`:z==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${B} ${G} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${J}(a_${V}, u_${V}_t);
#else
    ${B} ${G} ${V} = u_${V};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${B} ${G} a_${V};
    out ${B} ${G} ${V};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${B} ${Y} a_${V};
#else
uniform ${B} ${G} u_${V};
#endif
`:z==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${B} ${G} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${Y} a_${V};
#else
uniform ${B} ${G} u_${V};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${B} ${G} ${V} = a_${V};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${B} ${G} ${V} = a_${V};
#else
    ${B} ${G} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${B} ${G} ${V} = unpack_mix_${J}(a_${V}, u_${V}_t);
#else
    ${B} ${G} ${V} = u_${V};
#endif
`})),usedDefines:M,vertexIncludes:w,fragmentIncludes:A}}class Bl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,p,x,w,A,M,O){this.context=s;let z=this.boundPaintVertexBuffers.length!==x.length;for(let G=0;!z&&G<x.length;G++)this.boundPaintVertexBuffers[G]!==x[G]&&(z=!0);let B=this.boundDynamicVertexBuffers.length!==M.length;for(let G=0;!B&&G<M.length;G++)this.boundDynamicVertexBuffers[G]!==M[G]&&(B=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||z||B||this.boundIndexBuffer!==w||this.boundVertexOffset!==A)this.freshBind(c,p,x,w,A,M,O);else{s.bindVertexArrayOES.set(this.vao);for(const G of M)G&&(G.bind(),O&&G.instanceCount&&G.setVertexAttribDivisor(s.gl,c,O));w&&w.dynamicDraw&&w.bind()}}freshBind(s,c,p,x,w,A,M){const O=this.context,z=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=A,c.enableAttributes(z,s),c.bind(),c.setVertexAttribPointers(z,s,w);for(const B of p)B.enableAttributes(z,s),B.bind(),B.setVertexAttribPointers(z,s,w);for(const B of A)B&&(B.enableAttributes(z,s),B.bind(),B.setVertexAttribPointers(z,s,w),M&&B.instanceCount&&B.setVertexAttribDivisor(z,s,M));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Hy(m,s){const c=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new i.ae(0,p/c).toLngLat().lat,new i.ae(0,(p+1)/c).toLngLat().lat]}function b_(m,s,c,p,x,w,A){const M=m.context,O=M.gl,z=c.hillshadeFBO;if(!z)return;m.prepareDrawTile();const B=m.isTileAffectedByFog(s),G=m.getOrCreateProgram("hillshade",{overrideFog:B});M.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,z.colorAttachment.get());const V=((ce,ne,he,me)=>{const ve=he.paint.get("hillshade-shadow-color"),Pe=he.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=he.paint.get("hillshade-highlight-color"),Ie=he.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ce=he.paint.get("hillshade-accent-color"),Te=he.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Me=he.paint.get("hillshade-emissive-strength");let Ke=i.an(he.paint.get("hillshade-illumination-direction"));if(he.paint.get("hillshade-illumination-anchor")==="viewport")Ke-=ce.transform.angle;else if(ce.style&&ce.style.enable3dLights()&&ce.style.directionalLight){const at=ce.style.directionalLight.properties.get("direction"),Xe=i.d3(at.x,at.y,at.z);Ke=i.an(Xe[1])}const Be=!ce.options.moving;return{u_matrix:me||ce.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),Be),u_image:0,u_latrange:Hy(0,ne.tileID),u_light:[he.paint.get("hillshade-exaggeration"),Ke],u_shadow:ve.toPremultipliedRenderColor(Pe?null:he.lut),u_highlight:Ae.toPremultipliedRenderColor(Ie?null:he.lut),u_emissive_strength:Me,u_accent:Ce.toPremultipliedRenderColor(Te?null:he.lut)}})(m,c,p,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(M,G,s.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:J,tileBoundsSegments:Q}=m.getTileBoundsBuffers(c);G.draw(m,O.TRIANGLES,x,w,A,Dn.disabled,V,p.id,Y,J,Q)}function bf(m,s,c){if(!s.needsDEMTextureUpload)return;const p=m.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(c.stride);const w=c.getPixels();s.demTexture?s.demTexture.update(w,{premultiply:!1}):s.demTexture=new i.T(p,w,x.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Ki(m,s,c){const p=m.context,x=p.gl;if(!s.dem)return;const w=s.dem;if(p.activeTexture.set(x.TEXTURE1),bf(m,s,w),!s.demTexture)return;s.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const A=w.dim;p.activeTexture.set(x.TEXTURE0);let M=s.hillshadeFBO;if(!M){const V=new i.T(p,{width:A,height:A,data:null},x.RGBA8);V.bind(x.LINEAR,x.CLAMP_TO_EDGE),M=s.hillshadeFBO=p.createFramebuffer(A,A,!0,"renderbuffer"),M.colorAttachment.set(V.texture)}p.bindFramebuffer.set(M.framebuffer),p.viewport.set([0,0,A,A]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:z,tileBoundsSegments:B}=m.getMercatorTileBoundsBuffers(),G=[];m.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(m,x.TRIANGLES,Qt.disabled,In.disabled,Gn.unblended,Dn.disabled,((V,Y)=>{const J=Y.stride,Q=i.bC();return i.cd(Q,0,i.al,-i.al,0,0,1),i.br(Q,Q,[0,-i.al,0]),{u_matrix:Q,u_image:1,u_dimension:[J,J],u_zoom:V.overscaledZ}})(s.tileID,w),c.id,O,z,B),s.needsHillshadePrepare=!1}class hi{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wf extends hi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Uu extends hi{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class w_ extends hi{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Wm extends hi{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Sf extends hi{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Dp extends hi{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Vu extends hi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class S_ extends hi{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Lp extends hi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Gy extends hi{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class qm extends hi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class od extends hi{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class $u extends hi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Tf extends hi{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class vc extends hi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Kc extends hi{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class ad extends hi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class jp extends hi{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Hu extends hi{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let T_=class extends hi{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Zm extends hi{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class zp extends hi{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class _a extends hi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ef extends hi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class xc extends hi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Za extends hi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Jc extends hi{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ya extends hi{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Np extends hi{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class E_ extends hi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class A_ extends hi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ea extends hi{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class ld extends ea{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Gu extends ea{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Fp extends ea{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Xm extends Gu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Qc=(m,s,c)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),bl=(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:A,u_frustum_tr:M,u_frustum_br:O,u_frustum_bl:z,u_globe_pos:B,u_globe_radius:G,u_viewport:V,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:Y,u_far_z_cutoff:J});function Bi(m,s){return m!=null&&s!=null&&!(!m.hasData()||!s.hasData())&&m.demTexture!=null&&s.demTexture!=null&&m.tileID.key!==s.tileID.key}const Si=new class{constructor(){this.operations={}}newMorphing(m,s,c,p,x){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[m]={startTime:p,phase:0,duration:x,from:s,to:c,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const c=this.operations[s];for(c.phase=(m-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Ul={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Hs(m,s,c){if(s===0)return 0;const p=s<1&&c===514?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*p}function ta(m,s){const c=1<<m.z;return!s&&(m.x===0||m.x===c-1)||m.y===0||m.y===c-1}const va=m=>({u_matrix:m});function Xa(m,s,c,p,x){if(x>0){const w=i.o.now(),A=(w-m.timeAdded)/x,M=s?(w-s.timeAdded)/x:-1,O=c.getSource(),z=p.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),B=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),G=B&&m.refreshedUponExpiration?1:i.aA(B?A:1-M,0,1);return s?{opacity:1,mix:1-G,isFading:A<1}:{opacity:G,mix:0,isFading:A<1}}return{opacity:1,mix:0,isFading:!1}}class No extends As{constructor(s){const c=uc("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class wo extends As{constructor(s){const c=uc("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,p){if(s.freezeTileCoverage)return;this.transform=s;const x=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((w,A)=>{if(w[A.key]="",!this._tiles[A.key]){const M=new dc(A,this._source.tileSize*A.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);M.state="loaded",this._tiles[A.key]=M}return w}),{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach((s=>s.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Af extends i.aO{constructor(s,c,p){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class cd extends i.dH{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,w]=(function(O){const z=new i.bd,B=new i.b1,G=131;z.reserve(17161),B.reserve(33800);const V=i.al/128,Y=i.al+V/2,J=Y+V;for(let ce=-V;ce<J;ce+=V)for(let ne=-V;ne<J;ne+=V){const he=ne<0||ne>Y||ce<0||ce>Y?24575:0,me=i.aA(Math.round(ne),0,i.al),ve=i.aA(Math.round(ce),0,i.al);z.emplaceBack(me+he,ve)}const Q=(ce,ne)=>{const he=ne*G+ce;B.emplaceBack(he+1,he,he+G),B.emplaceBack(he+G,he+G+1,he+1)};for(let ce=1;ce<129;ce++)for(let ne=1;ne<129;ne++)Q(ne,ce);return[0,129].forEach((ce=>{for(let ne=0;ne<130;ne++)Q(ne,ce),Q(ce,ne)})),[z,B,32768]})(),A=s.context;this.gridBuffer=A.createVertexBuffer(p,i.bf.members),this.gridIndexBuffer=A.createIndexBuffer(x),this.gridSegments=i.bg.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,p.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new wo(c.map),this.orthoMatrix=i.bC(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const M=A.gl;this._overlapStencilMode=new In({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new No(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(s,c,p){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const x=s.terrain.properties,w=s.terrain.drapeRenderMode===0,A=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const M=s.terrain&&s.terrain.scope,O=x.get("source"),z=w?this._mockSourceCache:s.getSourceCache(O,M);if(!z)return void i.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=z,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=A?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(c,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,p=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=s.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(w);let M=w-this._previousZoom;const O=this._previousUpdateTimestamp;let z=w;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(w-z)>.5&&(M=.5*(w-z+M)),M*x<0&&(z+=M)),this._evaluationZoom=z;const B=A.getExaggeration(z),G=B===A.getExaggeration(Math.max(0,z-.1));if(G&&Math.abs(B-this._exaggeration)<.01)return B;let V=Math.min(.1,.00375*(this._updateTimestamp-O));return(G||B<.1||Math.abs(M)<1e-4)&&(V=Math.min(.2,4*V)),i.ak(this._exaggeration,B,V)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.dataType==="source"&&s.coord?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((s=>s.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map((O=>{const z=c.getTileByID(O).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z}));(function(O,z){const B=z.transform.pointCoordinate(z.transform.getCameraPoint()),G=new i.P(B.x,B.y);O.sort(((V,Y)=>{if(Y.overscaledZ-V.overscaledZ)return Y.overscaledZ-V.overscaledZ;const J=new i.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Q=new i.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ce=G.mult(1<<V.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(J)-ce.distSqr(Q)}))})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach((O=>{this.proxyToSource[O.key]={}})),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const O in A){const z=A[O];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,s[O],w),z.usedForTerrain))continue;const B=s[O];z.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[c.id]=x.map((O=>new Af(O,O.key,this.orthoMatrix))),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const z=this.terrainTileForTile[O.key];if(!z)continue;const B=z.tileID.key;B in M||(this._visibleDemTiles.push(z),M[B]=B)}}_assignTerrainTiles(s){this._initializing||s.forEach((c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)}))}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),bf(this.painter,x,w))}}_prepareDemTileUniforms(s,c,p,x){if(!c||c.demTexture==null)return!1;const w=s.tileID.canonical,A=Math.pow(2,c.tileID.canonical.z-w.z),M=x||"";return p[`u_dem_tl${M}`]=[w.x*A%1,w.y*A%1],p[`u_dem_scale${M}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce(((p,x)=>{if(!x.dem)return p;const w=x.dem.tree.minimums[0];return w>0&&s++,p+w}),0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new i.dI({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new i.T(s,x,c.R32F,{premultiply:!1}),w}setupElevationDraw(s,c,p){const x=this.painter.context,w=x.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};A.u_exaggeration=this.exaggeration();let M=null,O=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const Y=p.morphing.srcDemTile,J=p.morphing.dstDemTile;z=p.morphing.phase,Y&&J&&(this._prepareDemTileUniforms(s,Y,A,"_prev")&&(O=Y),this._prepareDemTileUniforms(s,J,A)&&(M=J))}const B=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let G=null;var V;if(this.enabled?O&&M?(G=M.demTexture,x.activeTexture.set(w.TEXTURE4),O.demTexture.bind(B(O),w.CLAMP_TO_EDGE),A.u_dem_lerp=z):(M=this.terrainTileForTile[s.tileID.key],G=this._prepareDemTileUniforms(s,M,A)?M.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),G&&(A.u_dem_size=(V=G).size[0]===1?1:V.size[0]-2,G.bind(B(M),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,A),p&&p.useMeterToDem&&M){const Y=(1<<M.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=Y}if(p&&p.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,A),this.painter.transform.projection.name==="globe"){const Y=this.globeUniformValues(this.painter.transform,s.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,Y)}}globeUniformValues(s,c,p){const x=s.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,i.al,0),u_tile_br_up:x.upVector(c,i.al,i.al),u_tile_bl_up:x.upVector(c,0,i.al),u_tile_up_scale:p?i.dJ(1):x.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,p=this.painter.context;s.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,w,A,M,O){if(x.transform.projection.name==="globe")(function(z,B,G,V,Y){const J=z.context,Q=J.gl;let ce,ne;const he=z.transform,me=i.dA(z,J,he),ve=(at,Xe)=>{if(ne===Xe)return;const Qe=[Ul[Xe],"PROJECTION_GLOBE_VIEW"];me&&Qe.push("CUSTOM_ANTIALIASING");const At=z.isTileAffectedByFog(at);ce=z.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:At}),ne=Xe},Pe=z.colorModeForRenderPass(),Ae=new Qt(Q.LEQUAL,Qt.ReadWrite,z.depthRangeFor3D);Si.update(Y);const Ie=i.dB(he),Ce=[i.aF(he.center.lng),i.aJ(he.center.lat)],Te=z.globeSharedBuffers,Me=[he.width*i.o.devicePixelRatio,he.height*i.o.devicePixelRatio],Ke=Float32Array.from(he.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const at=z.transform,Xe=Hs(at.zoom,B.exaggeration(),B.sourceCache._source.tileSize);ne=-1;const Qe=Q.TRIANGLES;for(const At of V){const Ye=G.getTile(At),je=In.disabled,ut=B.prevTerrainTileForTile[At.key],tt=B.terrainTileForTile[At.key];Bi(ut,tt)&&Si.newMorphing(At.key,ut,tt,Y,250),J.activeTexture.set(Q.TEXTURE0),Ye.texture&&Ye.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const vt=Si.getMorphValuesForProxy(At.key),Dt=vt?1:0;vt&&Object.assign(Be,{morphing:{srcDemTile:vt.from,dstDemTile:vt.to,phase:i.dz(vt.phase)}});const Gt=i.dC(At.canonical),Pt=i.dD(Gt.getCenter().lat),wt=i.dE(At.canonical,Gt,Pt,at.worldSize/at._pixelsPerMercatorPixel),dn=i.bk(i.dF(At.canonical)),cn=bl(at.expandedFarZProjMatrix,Ke,Ie,dn,i.aj(at.zoom),Ce,at.frustumCorners.TL,at.frustumCorners.TR,at.frustumCorners.BR,at.frustumCorners.BL,at.globeCenterInViewSpace,at.globeRadius,Me,Xe,at._farZ,wt);if(ve(At,Dt),ce&&(B.setupElevationDraw(Ye,ce,Be),z.uploadCommonUniforms(J,ce,At.toUnwrapped()),Te)){const[ln,un,jn]=Te.getGridBuffers(Pt,Xe!==0);ce.draw(z,Qe,Ae,je,Pe,Dn.backCCW,cn,"globe_raster",ln,un,jn)}}}if(Te&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const at=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&at.push("CUSTOM_ANTIALIASING"),ce=z.getOrCreateProgram("globeRaster",{defines:at});for(const Xe of V){const{x:Qe,y:At,z:Ye}=Xe.canonical,je=At===0,ut=At===(1<<Ye)-1,[tt,vt,Dt,Gt]=Te.getPoleBuffers(Ye,!1);if(Gt&&(je||ut)){const Pt=G.getTile(Xe);J.activeTexture.set(Q.TEXTURE0),Pt.texture&&Pt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let wt=i.dG(Ye,Qe,he);const dn=i.bk(i.dF(Xe.canonical)),cn=(ln,un)=>ln.draw(z,Q.TRIANGLES,Ae,In.disabled,Pe,Dn.disabled,bl(he.expandedFarZProjMatrix,wt,wt,dn,0,Ce,he.frustumCorners.TL,he.frustumCorners.TR,he.frustumCorners.BR,he.frustumCorners.BL,he.globeCenterInViewSpace,he.globeRadius,Me,0,he._farZ),"globe_pole_raster",un,Dt,Gt);B.setupElevationDraw(Pt,ce,Be),z.uploadCommonUniforms(J,ce,Xe.toUnwrapped()),je&&z.renderDefaultNorthPole&&cn(ce,tt),ut&&z.renderDefaultSouthPole&&(wt=i.cR(i.bC(),wt,[1,-1,1]),cn(ce,vt))}}}})(x,w,A,M,O);else{const z=x.context,B=z.gl;let G,V;const Y=x.shadowRenderer,J=Xc(x,x.longestCutoffRange),Q=Pe=>{if(V===Pe)return;const Ae=[];Ae.push(Ul[Pe]),J.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),Y&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&Ae.push("NORMAL_OFFSET")),G=x.getOrCreateProgram("terrainRaster",{defines:Ae}),V=Pe},ce=x.colorModeForRenderPass(),ne=new Qt(B.LEQUAL,Qt.ReadWrite,x.depthRangeFor3D);Si.update(O);const he=x.transform,me=Hs(he.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ve=[0,0,0];if(Y){const Pe=x.style.directionalLight,Ae=x.style.ambientLight;Pe&&Ae&&(ve=Ha(x.style,Pe,Ae))}{V=-1;const Pe=B.TRIANGLES,[Ae,Ie]=[w.gridIndexBuffer,w.gridSegments];for(const Ce of M){const Te=A.getTile(Ce),Me=In.disabled,Ke=w.prevTerrainTileForTile[Ce.key],Be=w.terrainTileForTile[Ce.key];Bi(Ke,Be)&&Si.newMorphing(Ce.key,Ke,Be,O,250),z.activeTexture.set(B.TEXTURE0),Te.texture&&Te.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const at=Si.getMorphValuesForProxy(Ce.key),Xe=at?1:0;let Qe;at&&(Qe={morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:i.dz(at.phase)}});const At=Qc(Ce.projMatrix,ta(Ce.canonical,he.renderWorldCopies)?me/10:me,ve);if(Q(Xe),!G)continue;w.setupElevationDraw(Te,G,Qe);const Ye=Ce.toUnwrapped();Y&&Y.setupShadows(Ye,G),x.uploadCommonUniforms(z,G,Ye,null,J),G.draw(x,Pe,ne,Me,ce,Dn.backCCW,At,"terrain_raster",w.gridBuffer,Ae,Ie)}}}})(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],A=this._drapedRenderBatches.shift(),M=c.style.order,O=[];let z=0;for(const B of w){const G=x.getTileByID(B.proxyTileKey),V=x.proxyCachedFBO[B.key]?x.proxyCachedFBO[B.key][s]:void 0,Y=V!==void 0?x.renderCache[V]:this.pool[z++],J=V!==void 0;if(G.texture=Y.tex,J&&!Y.dirty){O.push(G.tileID);continue}let Q;p.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(p.clear({color:i.ao.transparent,stencil:0}),Y.dirty=!1);for(let ce=A.start;ce<=A.end;++ce){const ne=c.style._mergedLayers[M[ce]];if(ne.isHidden(c.transform.zoom))continue;const he=c.style.getLayerSourceCache(ne),me=he?this.proxyToSource[B.key][he.id]:[B];if(!me)continue;const ve=me;p.viewport.set([0,0,Y.fb.width,Y.fb.height]),Q!==(he?he.id:null)&&(this._setupStencil(Y,me,ne,he),Q=he?he.id:null),c.renderLayer(c,he,ne,ve)}if(this._drapedRenderBatches.length===0)for(const ce of this._pendingGroundEffectLayers){const ne=c.style._mergedLayers[M[ce]];if(ne.isHidden(c.transform.zoom))continue;const he=c.style.getLayerSourceCache(ne),me=he?this.proxyToSource[B.key][he.id]:[B];if(!me)continue;const ve=me;p.viewport.set([0,0,Y.fb.width,Y.fb.height]),Q!==(he?he.id:null)&&(this._setupStencil(Y,me,ne,he),Q=he?he.id:null),c.renderLayer(c,he,ne,ve)}this.renderedToTile?(Y.dirty=!0,O.push(G.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),A.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let p=-1,x=c;for(let w=0;w<c;++w)this._style.isLayerDraped(s._mergedLayers[s.order[w]])?p=Math.max(p,w):x=Math.min(x,w);return x>p}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter((c=>c.dem)).forEach((c=>{s=Math.min(s,c.dem.tree.minimums[0])})),s===0?s:(s-30)*this._exaggeration}raycast(s,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter((w=>w.dem)).map((w=>{const A=w.tileID,M=1<<A.overscaledZ,{x:O,y:z}=A.canonical,B=O/M,G=(O+1)/M,V=z/M,Y=(z+1)/M;return{minx:B,miny:V,maxx:G,maxy:Y,t:w.dem.tree.raycastRoot(B,V,G,Y,s,c,p),tile:w}}));x.sort(((w,A)=>(w.t!==null?w.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE)));for(const w of x){if(w.t==null)return null;const A=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,s,c,p);if(A!=null)return A}return null}_createFBO(){const s=this.painter.context,c=s.gl,p=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const x=new i.T(s,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=s.createFramebuffer(p[0],p[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new Xm(s,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some((s=>{const c=this._style._mergedLayers[s],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()}))}_clearLineLayersFromRenderCache(){let s=!1;for(const p of this._style.getSources())if(p instanceof ro){s=!0;break}if(!s)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(x);if(w&&!c[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof i.ad){c[w.id]=!0;for(const A of this.proxyCoords){const M=this.proxyToSource[A.key][w.id];if(M)for(const O of M)this._clearRenderCacheForTile(w.id,O)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Wh){s=!0;break}if(!s)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(x);if(!w||c[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const A=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const O=this.proxyToSource[M.key][w.id];if(O)for(const z of O){const B=Xa(w.getTile(z),w.findLoadedParent(z,0),w,this.painter.transform,A);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(w.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,c=s.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,w=0,A=this._style._mergedLayers[s[w]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++w<c;)A=this._style._mergedLayers[s[w]];for(;w<c;++w){const M=this._style._mergedLayers[s[w]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?x===void 0&&(x=w):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(p.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:w-1}),p.length!==0){const M=p[p.length-1];this._pendingGroundEffectLayers.every((O=>O>M.end))||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const A=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<A.length;++M){const O=Object.values(A[M]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let A=p.length-1;A>=0;A--){const M=p[A];if(c.getTileByID(M.key),c.proxyCachedFBO[M.key]!==void 0){const O=s[M.key],z=this.proxyToSource[M.key];let B=0;for(const G in z){const V=z[G],Y=O[G];if(!Y||Y.length!==V.length||V.some(((J,Q)=>J!==Y[Q]||x[G]&&x[G].hasOwnProperty(J.key)))){B=-1;break}++B}for(const G in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][G]].dirty=B<0||B!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort(((A,M)=>M.end-M.start-(A.end-A.start)));for(const A of w)for(const M of p){if(c.proxyCachedFBO[M.key])continue;let O=c.renderCachePool.pop();O===void 0&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),O!==void 0&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][A.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,A=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(p.isTileClipped())M=c.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):In.disabled}_renderTileClippingMasks(s,c){const p=this.painter,x=this.painter.context,w=x.gl;p._tileClippingMaskIDs={},x.setColorMode(Gn.disabled),x.setDepthMode(Qt.disabled);const A=p.getOrCreateProgram("clippingMask");for(const M of s){const O=p._tileClippingMaskIDs[M.key]=--c;A.draw(p,w.TRIANGLES,Qt.disabled,new In({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),Gn.disabled,Dn.disabled,va(M.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const p=[s.x,s.y,1,1];i.aC(p,p,c.pixelMatrixInverse),i.cJ(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,w=i.ce(1,c.center.lat),A=[x[0],x[1],x[2]/w,0],M=i.d9([],p.slice(0,3),A);i.aw(M,M);const O=this.raycast(A,M,this._exaggeration);return O!==null&&O?(i.bH(A,A,M,O),A[3]=A[2],A[2]*=w,A):null}_setupProxiedCoordsForOrtho(s,c,p){if(s.getSource()instanceof i.aS)return this._setupProxiedCoordsForImageSource(s,c,p);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const x=this.proxiedCoords[s.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const z=w[O],B=this._findTileCoveringTileID(z,s);if(B){const G=this._createProxiedId(z,B,p[z.key]&&p[z.key][s.id]);x.push(G),this.proxyToSource[z.key][s.id]=[G]}}let A=!1;const M=new Set;for(let O=0;O<c.length;O++){const z=s.getTile(c[O]);if(!z||!z.hasData())continue;const B=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==z.tileID.canonical.z){const G=this.proxyToSource[B.tileID.key][s.id],V=this._createProxiedId(B.tileID,z,p[B.tileID.key]&&p[B.tileID.key][s.id]);G?G.splice(G.length-1,0,V):this.proxyToSource[B.tileID.key][s.id]=[V];const Y=this.proxyToSource[B.tileID.key][s.id];M.has(Y)||M.add(Y),x.push(V),A=!0}}if(this._sourceTilesOverlap[s.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const O of M)O.sort(((z,B)=>B.overscaledZ-z.overscaledZ))}_setupProxiedCoordsForImageSource(s,c,p){if(!s.getSource().loaded())return;const x=this.proxiedCoords[s.id]=[],w=this.proxyCoords,A=s.getSource(),M=A.tileID;if(!M)return;const O=new i.P(M.x,M.y)._div(1<<M.z),z=A.coordinates.map(i.ae.fromLngLat).reduce(((G,V)=>(G.min.x=Math.min(G.min.x,V.x-O.x),G.min.y=Math.min(G.min.y,V.y-O.y),G.max.x=Math.max(G.max.x,V.x-O.x),G.max.y=Math.max(G.max.y,V.y-O.y),G)),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(G,V)=>{const Y=G.wrap+G.canonical.x/(1<<G.canonical.z),J=G.canonical.y/(1<<G.canonical.z),Q=i.al/(1<<G.canonical.z),ce=V.wrap+V.canonical.x/(1<<V.canonical.z),ne=V.canonical.y/(1<<V.canonical.z);return Y+Q<ce+z.min.x||Y>ce+z.max.x||J+Q<ne+z.min.y||J>ne+z.max.y};for(let G=0;G<w.length;G++){const V=w[G];for(let Y=0;Y<c.length;Y++){const J=s.getTile(c[Y]);if(!J||!J.hasData()||B(V,J.tileID))continue;const Q=this._createProxiedId(V,J,p[V.key]&&p[V.key][s.id]),ce=this.proxyToSource[V.key][s.id];ce?ce.push(Q):this.proxyToSource[V.key][s.id]=[Q],x.push(Q)}}}_createProxiedId(s,c,p){let x=this.orthoMatrix;if(p){const w=p.find((A=>A.key===c.tileID.key));if(w)return w}if(c.tileID.key!==s.key){const w=s.canonical.z-c.tileID.canonical.z;let A,M,O;x=i.bC();const z=c.tileID.wrap-s.wrap<<s.overscaledZ;w>0?(A=i.al>>w,M=A*((c.tileID.canonical.x<<w)-s.canonical.x+z),O=A*((c.tileID.canonical.y<<w)-s.canonical.y)):(A=i.al<<-w,M=i.al*(c.tileID.canonical.x-(s.canonical.x+z<<-w)),O=i.al*(c.tileID.canonical.y-(s.canonical.y<<-w))),i.cd(x,0,A,0,A,0,1),i.br(x,x,[M,O,0])}return new Af(c.tileID,s.key,x)}_findTileCoveringTileID(s,c){let p=c.getTile(s);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],w=x[s.key];if(p=w?c.getTileByID(w):null,p&&p.hasData()||w===null)return p;let A=p?p.tileID:s,M=A.overscaledZ;const O=c.getSource().minzoom,z=[];if(!w){const G=c.getSource().maxzoom;if(s.canonical.z>=G){const V=s.canonical.z-G;c.getSource().reparseOverscaled?(M=Math.max(s.canonical.z+2,c.transform.tileZoom),A=new i.aO(M,s.wrap,G,s.canonical.x>>V,s.canonical.y>>V)):V!==0&&(M=G,A=new i.aO(M,s.wrap,G,s.canonical.x>>V,s.canonical.y>>V))}A.key!==s.key&&(z.push(A.key),p=c.getTile(A))}const B=G=>{z.forEach((V=>{x[V]=G})),z.length=0};for(M-=1;M>=O&&(!p||!p.hasData());M--){p&&B(p.tileID.key);const G=A.calculateScaledKey(M);if(p=c.getTileByID(G),p&&p.hasData())break;const V=x[G];if(V===null)break;V===void 0?z.push(G):p=c.getTileByID(V)}return B(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let p=this._tilesDirty[s];p||(p=this._tilesDirty[s]={}),p[c.key]=!0}}function Wu(m,s,c){const p=(function(M,O,z){const B=i.bJ(O,M),G=i.bJ(z,[.2126,.7152,.0722]),V=(J,Q,ce)=>(1-ce)*J+ce*Q,Y=V(1-.3*Math.min(G,1),1,Math.min(B+1,1));return V(.92,1,Math.asin(i.aA(O[2],-1,1))/Math.PI+.5)*Y})(m,[0,0,1],s),x=[0,0,0];i.c4(x,c.slice(0,3),p);const w=[0,0,0];i.c4(w,s.slice(0,3),m[2]);const A=[0,0,0];return i.d7(A,x,w),i.da(A)}const Bp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],wl=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class qu{static cacheKey(s,c,p,x){let w=`${c}${x?x.cacheKey:""}`;for(const A of p)s.usedDefines.includes(A)&&(w+=`/${A}`);return w}constructor(s,c,p,x,w,A){const M=s.gl;this.program=M.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...A];let O=x?x.defines():[];O=O.concat(A.map((J=>`#define ${J}`)));const z=`#version 300 es
`;let B=z+O.concat("precision mediump float;",Wa,Ga.fragmentSource).join(`
`);for(const J of p.fragmentIncludes)B+=`
${Bu[J]}`;B+=`
${p.fragmentSource}`;let G=z+O.concat("precision highp float;",Wa,Ga.vertexSource).join(`
`);for(const J of p.vertexIncludes)G+=`
${Bu[J]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const V=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(V,B),M.compileShader(V),M.attachShader(this.program,V);const Y=M.createShader(M.VERTEX_SHADER);M.isContextLost()?this.failedToCreate=!0:(M.shaderSource(Y,G),M.compileShader(Y),M.attachShader(this.program,Y),this.attributes={},M.linkProgram(this.program),M.deleteShader(Y),M.deleteShader(V),this.fixedUniforms=w(s),this.binderUniforms=x?x.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new i.cg(J)}))(s)),(A.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new i.cg(J),u_dem_prev:new i.cg(J),u_dem_tl:new i.cj(J),u_dem_scale:new i.ci(J),u_dem_tl_prev:new i.cj(J),u_dem_scale_prev:new i.ci(J),u_dem_size:new i.ci(J),u_dem_lerp:new i.ci(J),u_exaggeration:new i.ci(J),u_depth:new i.cg(J),u_depth_size_inv:new i.cj(J),u_depth_range_unpack:new i.cj(J),u_occluder_half_size:new i.ci(J),u_occlusion_depth_offset:new i.ci(J),u_meter_to_dem:new i.ci(J),u_label_plane_matrix_inv:new i.ck(J)}))(s)),A.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new i.ch(J),u_tile_tr_up:new i.ch(J),u_tile_br_up:new i.ch(J),u_tile_bl_up:new i.ch(J),u_tile_up_scale:new i.ci(J)}))(s)),A.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new i.ck(J),u_fog_range:new i.cj(J),u_fog_color:new i.d2(J),u_fog_horizon_blend:new i.ci(J),u_fog_vertical_limit:new i.cj(J),u_fog_temporal_offset:new i.ci(J),u_frustum_tl:new i.ch(J),u_frustum_tr:new i.ch(J),u_frustum_br:new i.ch(J),u_frustum_bl:new i.ch(J),u_globe_pos:new i.ch(J),u_globe_radius:new i.ci(J),u_globe_transition:new i.ci(J),u_is_globe:new i.cg(J),u_viewport:new i.cj(J)}))(s)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new i.d2(J)}))(s)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new i.ch(J),u_lighting_directional_dir:new i.ch(J),u_lighting_directional_color:new i.ch(J),u_ground_radiance:new i.ch(J)}))(s)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new i.ck(J),u_light_matrix_1:new i.ck(J),u_fade_range:new i.cj(J),u_shadow_normal_offset:new i.ch(J),u_shadow_intensity:new i.ci(J),u_shadow_texel_size:new i.ci(J),u_shadow_map_resolution:new i.ci(J),u_shadow_direction:new i.ch(J),u_shadow_bias:new i.ch(J),u_shadowmap_0:new i.cg(J),u_shadowmap_1:new i.cg(J)}))(s)))}getAttributeLocation(s,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=s.getAttribLocation(this.program,c)),p}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;s.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(s,c,p,x,w,A,M,O,z,B){const G=s.options.wireframe;if(G.terrain===!1&&G.layers2D===!1&&G.layers3D===!1)return;const V=s.context;if(!(!(!G.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!G.layers2D||s._terrain&&s._terrain.renderingToTexture||!Bp.includes(this.name))||!(!G.layers3D||!wl.includes(this.name))))return;const Y=V.gl,J=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,w,V);if(!J)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const ce=s.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});V.program.set(ce.program);const ne=(ve,Pe,Ae)=>{if(Pe[ve]&&Ae[ve])for(const Ie in Pe[ve])Ae[ve][Ie]&&Ae[ve][Ie].set(Ae.program,Ie,Pe[ve][Ie].current)};z&&z.setUniforms(ce.program,V,ce.binderUniforms,M,{zoom:O}),ne("fixedUniforms",this,ce),ne("terrainUniforms",this,ce),ne("globeUniforms",this,ce),ne("fogUniforms",this,ce),ne("lightsUniforms",this,ce),ne("shadowUniforms",this,ce),J.bind(),V.setColorMode(new Gn([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],i.ao.transparent,[!0,!0,!0,!1])),V.setDepthMode(new Qt(c.func===Y.LESS?Y.LEQUAL:c.func,Qt.ReadOnly,c.range)),V.setStencilMode(In.disabled);const he=3*A.primitiveLength*2,me=3*A.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ve=B||1;for(let Pe=0;Pe<ve;++Pe)ce.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),Y.drawElements(Y.LINES,he,Y.UNSIGNED_SHORT,me)}else B&&B>1?Y.drawElementsInstanced(Y.LINES,he,Y.UNSIGNED_SHORT,me,B):Y.drawElements(Y.LINES,he,Y.UNSIGNED_SHORT,me);w.bind(),V.program.set(this.program),V.setDepthMode(c),V.setStencilMode(p),V.setColorMode(x)}checkUniforms(s,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${x} not set but required by ${c} being defined`)}}draw(s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce){const ne=s.context,he=ne.gl;if(this.failedToCreate)return;ne.program.set(this.program),ne.setDepthMode(p),ne.setStencilMode(x),ne.setColorMode(w),ne.setCullFace(A);for(const Pe of Object.keys(this.fixedUniforms))this.fixedUniforms[Pe].set(this.program,Pe,M[Pe]);J&&J.setUniforms(this.program,ne,this.binderUniforms,V,{zoom:Y});const me={[he.POINTS]:1,[he.LINES]:2,[he.TRIANGLES]:3,[he.LINE_STRIP]:1}[c];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const ve=ce&&ce>0?1:void 0;for(const Pe of G.get()){const Ae=Pe.vaos||(Pe.vaos={});if((Ae[O]||(Ae[O]=new Bl)).bind(ne,this,z,J?J.getPaintVertexBuffers():[],B,Pe.vertexOffset,Q||[],ve),this.forceManualRenderingForInstanceIDShaders){const Ie=ce||1;for(let Ce=0;Ce<Ie;++Ce)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),B?he.drawElements(c,Pe.primitiveLength*me,he.UNSIGNED_SHORT,Pe.primitiveOffset*me*2):he.drawArrays(c,Pe.vertexOffset,Pe.vertexLength)}else ce&&ce>1?he.drawElementsInstanced(c,Pe.primitiveLength*me,he.UNSIGNED_SHORT,Pe.primitiveOffset*me*2,ce):B?he.drawElements(c,Pe.primitiveLength*me,he.UNSIGNED_SHORT,Pe.primitiveOffset*me*2):he.drawArrays(c,Pe.vertexOffset,Pe.vertexLength);c===he.TRIANGLES&&B&&this._drawDebugWireframe(s,p,x,w,B,Pe,V,Y,J,ce)}}}function Zu(m,s,c=0){const p=Math.pow(2,s.tileID.overscaledZ),x=s.tileSize*Math.pow(2,m.transform.tileZoom)/p,w=x*(s.tileID.canonical.x+s.tileID.wrap*p),A=x*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(s,1,m.transform.tileZoom),u_pixel_coord_upper:[w>>16,A>>16],u_pixel_coord_lower:[65535&w,65535&A],u_pattern_transition:c}}const Xu={terrain:0,flat:1},Ym=i.bC(),Ya=(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne)=>{const he=s.style.light,me=he.properties.get("position"),ve=[me.x,me.y,me.z],Pe=i.dL();he.properties.get("anchor")==="viewport"&&(i.dM(Pe,-s.transform.angle),i.dN(ve,ve,Pe));const Ae=he.properties.get("color").toPremultipliedRenderColor(null),Ie=s.transform,Ce={u_matrix:m,u_lightpos:ve,u_lightintensity:he.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ym,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Xu[z],u_base_type:Xu[B],u_ao:x,u_edge_radius:w,u_width_scale:A,u_flood_light_color:J,u_vertical_scale:Q,u_flood_light_intensity:ce,u_ground_shadow_factor:ne};return Ie.projection.name==="globe"&&(Ce.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],Ce.u_zoom_transition=G,Ce.u_inv_rot_matrix=Y,Ce.u_merc_center=V,Ce.u_up_dir=Ie.projection.upVector(new i.cC(0,0,0),V[0]*i.al,V[1]*i.al),Ce.u_height_lift=O),Ce},eu=(m,s,c,p,x,w)=>({u_matrix:m,u_edge_radius:s,u_width_scale:c,u_vertical_scale:p,u_height_type:Xu[x],u_base_type:Xu[w]}),Yu=(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne)=>{const he=Ya(m,s,c,p,x,w,A,M,z,B,G,V,Y,J,Q,ce,1,[0,0,0]),me={u_height_factor:-Math.pow(2,M.overscaledZ)/O.tileSize/8};return Object.assign(he,Zu(s,O,ne),me)},ud=(m,s,c)=>({u_matrix:m,u_emissive_strength:s,u_ground_shadow_factor:c}),Vl=(m,s,c,p,x,w=0)=>Object.assign(ud(m,s,x),Zu(c,p,w)),Ka=(m,s,c,p)=>({u_matrix:m,u_world:c,u_emissive_strength:s,u_ground_shadow_factor:p}),Ja=(m,s,c,p,x,w,A=0)=>Object.assign(Vl(m,s,c,p,w,A),{u_world:x}),Ku=(m,s)=>({u_matrix:m,u_ground_shadow_factor:s}),Qa=(m,s,c,p,x)=>({u_matrix:m,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),bc=(m,s,c,p,x,w,A)=>({u_matrix:m,u_normal_matrix:s,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:w,u_facade_emissive_chance:A}),Ju=m=>({u_matrix:m}),Up=m=>({u_matrix:m}),Cf=(m,s,c,p,x,w,A,M)=>{const O=i.al/w.tileSize;return{u_matrix:m,u_inv_rot_matrix:s,u_camera_to_center_distance:c.getCameraToCenterDistance(M),u_extrude_scale:[c.pixelsToGLUnits[0]/O,c.pixelsToGLUnits[1]/O],u_zoom_transition:p,u_tile_id:A,u_merc_center:x}},Pf=(m,s,c=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:c}),Gs=i.bC(),na=(m,s,c,p,x,w,A)=>{const M=m.transform,O=M.projection.name==="globe",z=O?i.dO(M.zoom,s.canonical)*M._pixelsPerMercatorPixel:i.ay(c,1,w),B={u_matrix:s.projMatrix,u_extrude_scale:z,u_intensity:A,u_inv_rot_matrix:Gs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){B.u_inv_rot_matrix=p,B.u_merc_center=x,B.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],B.u_zoom_transition=i.aj(M.zoom);const G=x[0]*i.al,V=x[1]*i.al;B.u_up_dir=M.projection.upVector(new i.cC(0,0,0),G,V)}return B};function qi(m,[s,c,p,x],[w,A]){if(w===A)return[0,0,0,0];const M=255*(m-1)/(m*(A-w));return[s*M,c*M,p*M,x*M]}function xa(m,s,[c,p]){return c===p?0:.5/m+(s-c)*(m-1)/(m*(p-c))}const If=(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne,he,me,ve)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:i.dQ(G.paint.get("raster-saturation")),u_contrast_factor:i.dP(G.paint.get("raster-contrast")),u_spin_weights:tu(G.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:Y,u_zoom_transition:A,u_merc_center:M,u_cutoff_params:O,u_colorization_mix:qi(i.dR,Q,ne),u_colorization_offset:xa(i.dR,ce,ne),u_color_ramp:J,u_texture_offset:[me/(he+2*me),he/(he+2*me)],u_texture_res:[he+2*me,he+2*me],u_emissive_strength:ve});function tu(m){m*=Math.PI/180;const s=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const wc=.05,$l=(m,s,c,p,x,w,A,M,O,z,B,G)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:A,u_merc_center:M,u_cutoff_params:O}),Vp=(m,s,c,p,x,w,A,M,O,z)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:p,u_color_ramp:w,u_velocity_res:x,u_max_speed:A,u_uv_offset:M,u_data_scale:[255*O[0],255*O[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[wc,wc]}),Qu=(m,s,c,p,x,w,A,M,O,z)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:w,u_reset_rate:A,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*O[0],255*O[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[wc,wc]}),$p=i.bC(),nu=(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne,he,me,ve,Pe,Ae,Ie)=>{const Ce=x.transform,Te={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Ce.getCameraToCenterDistance(he),u_rotate_symbol:+c,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:M,u_is_text:+z,u_elevation_from_sea:O?1:0,u_pitch_with_map:+p,u_texsize:B,u_texsize_icon:G,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$p,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$p,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:Ae||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(he)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ie||1,u_ground_shadow_factor:me,u_inv_matrix:i.bl(i.bC(),A),u_normal_scale:ve,u_lutTexture:Hi.LUT};return he.name==="globe"&&(Te.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],Te.u_zoom_transition=J,Te.u_inv_rot_matrix=ce,Te.u_merc_center=Q,Te.u_camera_forward=Ce._camera.forward(),Te.u_ecef_origin=i.dS(Ce.globeMatrix,Y.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Ce.globeMatrix),Te.u_up_vector=ne),Te},hd=(m,s,c,p)=>({u_matrix:m,u_emissive_strength:s,u_opacity:c,u_color:p}),Hp=(m,s,c,p,x,w,A,M,O)=>Object.assign((function(z,B,G,V,Y,J){const{width:Q,height:ce}=V.imageManager.getPixelSize(B),ne=Math.pow(2,J.tileID.overscaledZ),he=J.tileSize*Math.pow(2,V.transform.tileZoom)/ne,me=he*(J.tileID.canonical.x+J.tileID.wrap*ne),ve=he*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[Q,ce],u_pattern_size:G.displaySize,u_pattern_units_to_pixels:Y?[V.transform.width,-1*V.transform.height]:[1/i.ay(J,1,V.transform.tileZoom),1/i.ay(J,1,V.transform.tileZoom)],u_pixel_coord_upper:[me>>16,ve>>16],u_pixel_coord_lower:[65535&me,65535&ve]}})(0,w,A,p,M,O),{u_matrix:m,u_emissive_strength:s,u_opacity:c}),eh=new Float32Array(i.bA([])),th=(m,s,c,p,x,w,A,M,O,z,B,G,V,Y=[0,0,0],J)=>{const Q=x.style.light,ce=Q.properties.get("position"),ne=[-ce.x,-ce.y,ce.z],he=i.dL();Q.properties.get("anchor")==="viewport"&&(i.dM(he,-x.transform.angle),i.dN(ne,ne,he));const me=B.alphaMode==="MASK",ve=Q.properties.get("color").toNonPremultipliedRenderColor(null),Pe=V.paint.get("model-ambient-occlusion-intensity"),Ae=V.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=V.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:p||eh,u_lightpos:ne,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_camera_pos:Y,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+me,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:M.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:z,u_baseColorTexture:Hi.BaseColor,u_metallicRoughnessTexture:Hi.MetallicRoughness,u_normalTexture:Hi.Normal,u_occlusionTexture:Hi.Occlusion,u_emissionTexture:Hi.Emission,u_lutTexture:Hi.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Pe,u_emissive_strength:G,u_occlusionTextureTransform:J||[0,0,0,0]}},nh=(m,s=eh,c=eh)=>({u_matrix:m,u_instance:s,u_node_matrix:c}),C_={fillExtrusion:m=>({u_matrix:new i.ck(m),u_lightpos:new i.ch(m),u_lightintensity:new i.ci(m),u_lightcolor:new i.ch(m),u_vertical_gradient:new i.ci(m),u_opacity:new i.ci(m),u_edge_radius:new i.ci(m),u_width_scale:new i.ci(m),u_ao:new i.cj(m),u_height_type:new i.cg(m),u_base_type:new i.cg(m),u_tile_id:new i.ch(m),u_zoom_transition:new i.ci(m),u_inv_rot_matrix:new i.ck(m),u_merc_center:new i.cj(m),u_up_dir:new i.ch(m),u_height_lift:new i.ci(m),u_flood_light_color:new i.ch(m),u_vertical_scale:new i.ci(m),u_flood_light_intensity:new i.ci(m),u_ground_shadow_factor:new i.ch(m)}),fillExtrusionDepth:m=>({u_matrix:new i.ck(m),u_edge_radius:new i.ci(m),u_width_scale:new i.ci(m),u_vertical_scale:new i.ci(m),u_height_type:new i.cg(m),u_base_type:new i.cg(m)}),fillExtrusionPattern:m=>({u_matrix:new i.ck(m),u_lightpos:new i.ch(m),u_lightintensity:new i.ci(m),u_lightcolor:new i.ch(m),u_vertical_gradient:new i.ci(m),u_height_factor:new i.ci(m),u_edge_radius:new i.ci(m),u_width_scale:new i.ci(m),u_ao:new i.cj(m),u_height_type:new i.cg(m),u_base_type:new i.cg(m),u_tile_id:new i.ch(m),u_zoom_transition:new i.ci(m),u_inv_rot_matrix:new i.ck(m),u_merc_center:new i.cj(m),u_up_dir:new i.ch(m),u_height_lift:new i.ci(m),u_image:new i.cg(m),u_texsize:new i.cj(m),u_pixel_coord_upper:new i.cj(m),u_pixel_coord_lower:new i.cj(m),u_tile_units_to_pixels:new i.ci(m),u_opacity:new i.ci(m),u_pattern_transition:new i.ci(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new i.ck(m),u_opacity:new i.ci(m),u_ao_pass:new i.ci(m),u_meter_to_tile:new i.ci(m),u_ao:new i.cj(m),u_flood_light_intensity:new i.ci(m),u_flood_light_color:new i.ch(m),u_attenuation:new i.ci(m),u_edge_radius:new i.ci(m),u_fb:new i.cg(m),u_fb_size:new i.ci(m),u_dynamic_offset:new i.ci(m)}),fill:m=>({u_matrix:new i.ck(m),u_emissive_strength:new i.ci(m),u_ground_shadow_factor:new i.ch(m)}),fillPattern:m=>({u_matrix:new i.ck(m),u_emissive_strength:new i.ci(m),u_image:new i.cg(m),u_texsize:new i.cj(m),u_pixel_coord_upper:new i.cj(m),u_pixel_coord_lower:new i.cj(m),u_tile_units_to_pixels:new i.ci(m),u_ground_shadow_factor:new i.ch(m),u_pattern_transition:new i.ci(m)}),fillOutline:m=>({u_matrix:new i.ck(m),u_emissive_strength:new i.ci(m),u_world:new i.cj(m),u_ground_shadow_factor:new i.ch(m)}),fillOutlinePattern:m=>({u_matrix:new i.ck(m),u_emissive_strength:new i.ci(m),u_world:new i.cj(m),u_image:new i.cg(m),u_texsize:new i.cj(m),u_pixel_coord_upper:new i.cj(m),u_pixel_coord_lower:new i.cj(m),u_tile_units_to_pixels:new i.ci(m),u_ground_shadow_factor:new i.ch(m),u_pattern_transition:new i.ci(m)}),building:m=>({u_matrix:new i.ck(m),u_normal_matrix:new i.ck(m),u_opacity:new i.ci(m),u_faux_facade_ao_intensity:new i.ci(m),u_camera_pos:new i.ch(m),u_tile_to_meter:new i.ci(m),u_facade_emissive_chance:new i.ci(m)}),buildingBloom:m=>({u_matrix:new i.ck(m)}),buildingDepth:m=>({u_matrix:new i.ck(m)}),elevatedStructuresDepth:m=>({u_matrix:new i.ck(m),u_depth_bias:new i.ci(m)}),elevatedStructures:m=>({u_matrix:new i.ck(m),u_ground_shadow_factor:new i.ch(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new i.ck(m),u_camera_pos:new i.ch(m),u_depth_bias:new i.ci(m),u_height_scale:new i.ci(m),u_reset_depth:new i.ci(m)}),circle:i.dV,collisionBox:m=>({u_matrix:new i.ck(m),u_inv_rot_matrix:new i.ck(m),u_camera_to_center_distance:new i.ci(m),u_extrude_scale:new i.cj(m),u_zoom_transition:new i.ci(m),u_merc_center:new i.cj(m),u_tile_id:new i.ch(m)}),collisionCircle:m=>({u_matrix:new i.ck(m),u_inv_matrix:new i.ck(m),u_camera_to_center_distance:new i.ci(m),u_viewport_size:new i.cj(m)}),debug:m=>({u_color:new i.dx(m),u_matrix:new i.ck(m),u_overlay:new i.cg(m),u_overlay_scale:new i.ci(m)}),clippingMask:m=>({u_matrix:new i.ck(m)}),heatmap:m=>({u_extrude_scale:new i.ci(m),u_intensity:new i.ci(m),u_matrix:new i.ck(m),u_inv_rot_matrix:new i.ck(m),u_merc_center:new i.cj(m),u_tile_id:new i.ch(m),u_zoom_transition:new i.ci(m),u_up_dir:new i.ch(m)}),heatmapTexture:m=>({u_image:new i.cg(m),u_color_ramp:new i.cg(m),u_opacity:new i.ci(m)}),hillshade:m=>({u_matrix:new i.ck(m),u_image:new i.cg(m),u_latrange:new i.cj(m),u_light:new i.cj(m),u_shadow:new i.dx(m),u_highlight:new i.dx(m),u_emissive_strength:new i.ci(m),u_accent:new i.dx(m)}),hillshadePrepare:m=>({u_matrix:new i.ck(m),u_image:new i.cg(m),u_dimension:new i.cj(m),u_zoom:new i.ci(m)}),line:i.dU,linePattern:i.dT,raster:m=>({u_matrix:new i.ck(m),u_normalize_matrix:new i.ck(m),u_globe_matrix:new i.ck(m),u_merc_matrix:new i.ck(m),u_grid_matrix:new i.dy(m),u_tl_parent:new i.cj(m),u_scale_parent:new i.ci(m),u_fade_t:new i.ci(m),u_opacity:new i.ci(m),u_image0:new i.cg(m),u_image1:new i.cg(m),u_brightness_low:new i.ci(m),u_brightness_high:new i.ci(m),u_saturation_factor:new i.ci(m),u_contrast_factor:new i.ci(m),u_spin_weights:new i.ch(m),u_perspective_transform:new i.cj(m),u_raster_elevation:new i.ci(m),u_zoom_transition:new i.ci(m),u_merc_center:new i.cj(m),u_cutoff_params:new i.d2(m),u_colorization_mix:new i.d2(m),u_colorization_offset:new i.ci(m),u_color_ramp:new i.cg(m),u_texture_offset:new i.cj(m),u_texture_res:new i.cj(m),u_emissive_strength:new i.ci(m)}),rasterParticle:m=>({u_matrix:new i.ck(m),u_normalize_matrix:new i.ck(m),u_globe_matrix:new i.ck(m),u_merc_matrix:new i.ck(m),u_grid_matrix:new i.dy(m),u_tl_parent:new i.cj(m),u_scale_parent:new i.ci(m),u_fade_t:new i.ci(m),u_opacity:new i.ci(m),u_image0:new i.cg(m),u_image1:new i.cg(m),u_raster_elevation:new i.ci(m),u_zoom_transition:new i.ci(m),u_merc_center:new i.cj(m),u_cutoff_params:new i.d2(m)}),rasterParticleTexture:m=>({u_texture:new i.cg(m),u_opacity:new i.ci(m)}),rasterParticleDraw:m=>({u_particle_texture:new i.cg(m),u_particle_texture_side_len:new i.ci(m),u_tile_offset:new i.cj(m),u_velocity:new i.cg(m),u_color_ramp:new i.cg(m),u_velocity_res:new i.cj(m),u_max_speed:new i.ci(m),u_uv_offset:new i.cj(m),u_data_scale:new i.cj(m),u_data_offset:new i.ci(m),u_particle_pos_scale:new i.ci(m),u_particle_pos_offset:new i.cj(m)}),rasterParticleUpdate:m=>({u_particle_texture:new i.cg(m),u_particle_texture_side_len:new i.ci(m),u_velocity:new i.cg(m),u_velocity_res:new i.cj(m),u_max_speed:new i.ci(m),u_speed_factor:new i.ci(m),u_reset_rate:new i.ci(m),u_rand_seed:new i.ci(m),u_uv_offset:new i.cj(m),u_data_scale:new i.cj(m),u_data_offset:new i.ci(m),u_particle_pos_scale:new i.ci(m),u_particle_pos_offset:new i.cj(m)}),symbol:m=>({u_is_size_zoom_constant:new i.cg(m),u_is_size_feature_constant:new i.cg(m),u_size_t:new i.ci(m),u_size:new i.ci(m),u_camera_to_center_distance:new i.ci(m),u_rotate_symbol:new i.cg(m),u_aspect_ratio:new i.ci(m),u_fade_change:new i.ci(m),u_matrix:new i.ck(m),u_label_plane_matrix:new i.ck(m),u_coord_matrix:new i.ck(m),u_is_text:new i.cg(m),u_elevation_from_sea:new i.cg(m),u_pitch_with_map:new i.cg(m),u_texsize:new i.cj(m),u_texsize_icon:new i.cj(m),u_texture:new i.cg(m),u_texture_icon:new i.cg(m),u_gamma_scale:new i.ci(m),u_device_pixel_ratio:new i.ci(m),u_tile_id:new i.ch(m),u_zoom_transition:new i.ci(m),u_inv_rot_matrix:new i.ck(m),u_merc_center:new i.cj(m),u_camera_forward:new i.ch(m),u_tile_matrix:new i.ck(m),u_up_vector:new i.ch(m),u_ecef_origin:new i.ch(m),u_is_halo:new i.cg(m),u_icon_transition:new i.ci(m),u_color_adj_mat:new i.ck(m),u_scale_factor:new i.ci(m),u_ground_shadow_factor:new i.ch(m),u_inv_matrix:new i.ck(m),u_normal_scale:new i.ci(m),u_lutTexture:new i.cg(m)}),background:m=>({u_matrix:new i.ck(m),u_emissive_strength:new i.ci(m),u_opacity:new i.ci(m),u_color:new i.dx(m)}),backgroundPattern:m=>({u_matrix:new i.ck(m),u_emissive_strength:new i.ci(m),u_opacity:new i.ci(m),u_image:new i.cg(m),u_pattern_tl:new i.cj(m),u_pattern_br:new i.cj(m),u_texsize:new i.cj(m),u_pattern_size:new i.cj(m),u_pixel_coord_upper:new i.cj(m),u_pixel_coord_lower:new i.cj(m),u_pattern_units_to_pixels:new i.cj(m)}),terrainRaster:m=>({u_matrix:new i.ck(m),u_image0:new i.cg(m),u_skirt_height:new i.ci(m),u_ground_shadow_factor:new i.ch(m)}),skybox:m=>({u_matrix:new i.ck(m),u_sun_direction:new i.ch(m),u_cubemap:new i.cg(m),u_opacity:new i.ci(m),u_temporal_offset:new i.ci(m)}),skyboxGradient:m=>({u_matrix:new i.ck(m),u_color_ramp:new i.cg(m),u_center_direction:new i.ch(m),u_radius:new i.ci(m),u_opacity:new i.ci(m),u_temporal_offset:new i.ci(m)}),skyboxCapture:m=>({u_matrix_3f:new i.dy(m),u_sun_direction:new i.ch(m),u_sun_intensity:new i.ci(m),u_color_tint_r:new i.d2(m),u_color_tint_m:new i.d2(m),u_luminance:new i.ci(m)}),globeRaster:m=>({u_proj_matrix:new i.ck(m),u_globe_matrix:new i.ck(m),u_normalize_matrix:new i.ck(m),u_merc_matrix:new i.ck(m),u_zoom_transition:new i.ci(m),u_merc_center:new i.cj(m),u_image0:new i.cg(m),u_grid_matrix:new i.dy(m),u_skirt_height:new i.ci(m),u_far_z_cutoff:new i.ci(m),u_frustum_tl:new i.ch(m),u_frustum_tr:new i.ch(m),u_frustum_br:new i.ch(m),u_frustum_bl:new i.ch(m),u_globe_pos:new i.ch(m),u_globe_radius:new i.ci(m),u_viewport:new i.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.ch(m),u_frustum_tr:new i.ch(m),u_frustum_br:new i.ch(m),u_frustum_bl:new i.ch(m),u_horizon:new i.ci(m),u_transition:new i.ci(m),u_fadeout_range:new i.ci(m),u_atmosphere_fog_color:new i.d2(m),u_high_color:new i.d2(m),u_space_color:new i.d2(m),u_temporal_offset:new i.ci(m),u_horizon_angle:new i.ci(m)}),model:m=>({u_matrix:new i.ck(m),u_lighting_matrix:new i.ck(m),u_normal_matrix:new i.ck(m),u_node_matrix:new i.ck(m),u_lightpos:new i.ch(m),u_lightintensity:new i.ci(m),u_lightcolor:new i.ch(m),u_camera_pos:new i.ch(m),u_opacity:new i.ci(m),u_baseColorFactor:new i.d2(m),u_emissiveFactor:new i.d2(m),u_metallicFactor:new i.ci(m),u_roughnessFactor:new i.ci(m),u_baseTextureIsAlpha:new i.cg(m),u_alphaMask:new i.cg(m),u_alphaCutoff:new i.ci(m),u_baseColorTexture:new i.cg(m),u_metallicRoughnessTexture:new i.cg(m),u_normalTexture:new i.cg(m),u_occlusionTexture:new i.cg(m),u_emissionTexture:new i.cg(m),u_lutTexture:new i.cg(m),u_color_mix:new i.d2(m),u_aoIntensity:new i.ci(m),u_emissive_strength:new i.ci(m),u_occlusionTextureTransform:new i.d2(m)}),modelDepth:m=>({u_matrix:new i.ck(m),u_instance:new i.ck(m),u_node_matrix:new i.ck(m)}),groundShadow:m=>({u_matrix:new i.ck(m),u_ground_shadow_factor:new i.ch(m)}),stars:m=>({u_matrix:new i.ck(m),u_up:new i.ch(m),u_right:new i.ch(m),u_intensity_multiplier:new i.ci(m)}),snowParticle:m=>({u_modelview:new i.ck(m),u_projection:new i.ck(m),u_time:new i.ci(m),u_cam_pos:new i.ch(m),u_velocityConeAperture:new i.ci(m),u_velocity:new i.ci(m),u_horizontalOscillationRadius:new i.ci(m),u_horizontalOscillationRate:new i.ci(m),u_boxSize:new i.ci(m),u_billboardSize:new i.ci(m),u_simpleShapeParameters:new i.cj(m),u_screenSize:new i.cj(m),u_thinningCenterPos:new i.cj(m),u_thinningShape:new i.ch(m),u_thinningAffectedRatio:new i.ci(m),u_thinningParticleOffset:new i.ci(m),u_particleColor:new i.d2(m),u_direction:new i.ch(m)}),rainParticle:m=>({u_modelview:new i.ck(m),u_projection:new i.ck(m),u_time:new i.ci(m),u_cam_pos:new i.ch(m),u_texScreen:new i.cg(m),u_velocityConeAperture:new i.ci(m),u_velocity:new i.ci(m),u_boxSize:new i.ci(m),u_rainDropletSize:new i.cj(m),u_distortionStrength:new i.ci(m),u_rainDirection:new i.ch(m),u_color:new i.d2(m),u_screenSize:new i.cj(m),u_thinningCenterPos:new i.cj(m),u_thinningShape:new i.ch(m),u_thinningAffectedRatio:new i.ci(m),u_thinningParticleOffset:new i.ci(m),u_shapeDirectionalPower:new i.ci(m),u_shapeNormalPower:new i.ci(m),u_mode:new i.ci(m)}),vignette:m=>({u_vignetteShape:new i.ch(m),u_vignetteColor:new i.d2(m)}),occlusion:m=>({u_matrix:new i.ck(m),u_anchorPos:new i.ch(m),u_screenSizePx:new i.cj(m),u_occluderSizePx:new i.cj(m),u_color:new i.d2(m)})};class ba{constructor(s,c,p,x){this.id=ba.uniqueIdxCounter,ba.uniqueIdxCounter++,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=ba.uniqueIdxCounter,ba.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ba.uniqueIdxCounter=0;const Km={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gp{constructor(s,c,p,x,w,A){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=A,this.context=s;const M=s.gl;this.buffer=M.createBuffer(),s.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let p=0;p<this.attributes.length;p++){const x=c.getAttributeLocation(s,this.attributes[p].name);x!==-1&&s.enableVertexAttribArray(x)}}setVertexAttribPointers(s,c,p){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],A=c.getAttributeLocation(s,w.name);A!==-1&&s.vertexAttribPointer(A,w.components,s[Km[w.type]],!1,this.itemSize,w.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(s,c,p){for(let x=0;x<this.attributes.length;x++){const w=c.getAttributeLocation(s,this.attributes[x].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(w,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rh{constructor(s,c,p,x,w){this.context=s,this.width=c,this.height=p;const A=this.framebuffer=s.gl.createFramebuffer();x&&(this.colorAttachment=new ld(s,A)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Gu(s,A):new Fp(s,A))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class ru{constructor(s,c){this.gl=s,this.clearColor=new wf(this),this.clearDepth=new Uu(this),this.clearStencil=new w_(this),this.colorMask=new Wm(this),this.depthMask=new Sf(this),this.stencilMask=new Dp(this),this.stencilFunc=new Vu(this),this.stencilOp=new S_(this),this.stencilTest=new Lp(this),this.depthRange=new Gy(this),this.depthTest=new qm(this),this.depthFunc=new od(this),this.blend=new $u(this),this.blendFunc=new Tf(this),this.blendColor=new vc(this),this.blendEquation=new Kc(this),this.cullFace=new ad(this),this.cullFaceSide=new jp(this),this.frontFace=new Hu(this),this.program=new T_(this),this.activeTexture=new Zm(this),this.viewport=new zp(this),this.bindFramebuffer=new _a(this),this.bindRenderbuffer=new Ef(this),this.bindTexture=new xc(this),this.bindVertexBuffer=new Za(this),this.bindElementBuffer=new Jc(this),this.bindVertexArrayOES=new ya(this),this.pixelStoreUnpack=new Np(this),this.pixelStoreUnpackPremultiplyAlpha=new E_(this),this.pixelStoreUnpackFlipY=new A_(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,p){return new ba(this,s,c,p)}createVertexBuffer(s,c,p,x,w){return new Gp(this,s,c,p,x,w)}createRenderbuffer(s,c,p){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,s,c,p),this.bindRenderbuffer.set(null),w}createFramebuffer(s,c,p,x){return new rh(this,s,c,p,x)}clear({color:s,depth:c,stencil:p,colorMask:x}){const w=this.gl;let A=0;s&&(A|=w.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(A|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(A|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),w.clear(A)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){i.by(s.blendFunction,Gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let el;function ih(m,s,c,p,x,w,A){const M=m.context,O=M.gl,z=m.transform,B=[i.aF(z.center.lng),i.aJ(z.center.lat)],G=c.layout.get("symbol-placement"),V=c.layout.get("text-variable-anchor"),Y=c.layout.get("icon-rotation-alignment")==="map",J=c.layout.get("text-rotation-alignment")==="map",Q=G!=="point",ce=[];let ne=0,he=0;for(let Te=0;Te<p.length;Te++){const Me=p[Te],Ke=s.getTile(Me),Be=Ke.getBucket(c);if(!Be)continue;const at=Be.getProjection().createInversionMatrix(z,Me.canonical),Xe=[],Qe=ef(Me,Be,z),At=!A&&Y&&Q,Ye=A&&J&&Q,je=V&&Be.hasTextData(),ut=Be.hasIconTextFit()&&je&&Be.hasIconData(),tt=At||Ye||A&&je||ut,vt=Be.projection.name==="globe",Dt=vt?i.aj(z.zoom):0;vt&&(Xe.push("PROJECTION_GLOBE_VIEW"),tt&&Xe.push("PROJECTED_POS_ON_VIEWPORT"));const Gt=m.getOrCreateProgram("collisionBox",{defines:Xe});let Pt=Qe;x[0]===0&&x[1]===0||(Pt=m.translatePosMatrix(Qe,Ke,x,w));const wt=A?Be.textCollisionBox:Be.iconCollisionBox,dn=Be.collisionCircleArray;if(dn.length>0){const ln=i.bC(),un=Pt;i.cO(ln,Be.placementInvProjMatrix,z.glCoordMatrix),i.cO(ln,ln,Be.placementViewportMatrix),ce.push({circleArray:dn,circleOffset:he,transform:un,invTransform:ln,projection:Be.getProjection()}),ne+=dn.length/4,he=ne}if(!wt)continue;m.terrain&&m.terrain.setupElevationDraw(Ke,Gt);const cn=vt?[Me.canonical.x,Me.canonical.y,1<<Me.canonical.z]:[0,0,0];Gt.draw(m,O.LINES,Qt.disabled,In.disabled,m.colorModeForRenderPass(),Dn.disabled,Cf(Pt,at,z,Dt,B,Ke,cn,Be.getProjection()),c.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,null,z.zoom,null,[wt.collisionVertexBuffer,wt.collisionVertexBufferExt])}if(!A||!ce.length)return;const me=m.getOrCreateProgram("collisionCircle"),ve=new i.dW;ve.resize(4*ne),ve._trim();let Pe=0;for(const Te of ce)for(let Me=0;Me<Te.circleArray.length/4;Me++){const Ke=4*Me,Be=Te.circleArray[Ke+0],at=Te.circleArray[Ke+1],Xe=Te.circleArray[Ke+2],Qe=Te.circleArray[Ke+3];ve.emplace(Pe++,Be,at,Xe,Qe,0),ve.emplace(Pe++,Be,at,Xe,Qe,1),ve.emplace(Pe++,Be,at,Xe,Qe,2),ve.emplace(Pe++,Be,at,Xe,Qe,3)}(!el||el.length<2*ne)&&(el=(function(Te){const Me=2*Te,Ke=new i.b1;Ke.resize(Me),Ke._trim();for(let Be=0;Be<Me;Be++){const at=6*Be;Ke.uint16[at+0]=4*Be+0,Ke.uint16[at+1]=4*Be+1,Ke.uint16[at+2]=4*Be+2,Ke.uint16[at+3]=4*Be+2,Ke.uint16[at+4]=4*Be+3,Ke.uint16[at+5]=4*Be+0}return Ke})(ne));const Ae=M.createIndexBuffer(el,!0),Ie=M.createVertexBuffer(ve,i.dX.members,!0);for(const Te of ce){const Me={u_matrix:Te.transform,u_inv_matrix:Te.invTransform,u_camera_to_center_distance:(Ce=z).getCameraToCenterDistance(Te.projection),u_viewport_size:[Ce.width,Ce.height]};me.draw(m,O.TRIANGLES,Qt.disabled,In.disabled,m.colorModeForRenderPass(),Dn.disabled,Me,c.id,Ie,Ae,i.bg.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,z.zoom)}var Ce;Ie.destroy(),Ae.destroy()}const Hl=i.bC();function Mf(m){const s=m._camera.getWorldToCamera(m.worldSize,1),c=i.aB([],s,m.globeMatrix);i.bl(c,c);const p=[0,0,0],x=[0,1,0,0];return i.aC(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],i.aw(p,p),p}function Sc({width:m,height:s,anchor:c,textOffset:p,textScale:x},w){const{horizontalAlign:A,verticalAlign:M}=i.c0(c),O=-(A-.5)*m,z=-(M-.5)*s,B=i.c1(c,p);return new i.P((O/x+B[0])*w,(z/x+B[1])*w)}function Fo(m,s,c,p,x,w,A,M,O,z){const B=m.text.placedSymbolArray,G=m.text.dynamicLayoutVertexArray,V=m.icon.dynamicLayoutVertexArray,Y={},J=m.getProjection(),Q=Du(A,J,x),ce=x.elevation,ne=J.upVectorScale(A.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let he=0;he<B.length;he++){const me=B.get(he),{tileAnchorX:ve,tileAnchorY:Pe,numGlyphs:Ae}=me,Ie=me.hidden||!me.crossTileID||m.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(Ie){let Ce=0,Te=0,Me=0;if(ce){const ut=ce?ce.getAtTileOffset(A,ve,Pe):0,[tt,vt,Dt]=J.upVector(A.canonical,ve,Pe);Ce=ut*tt*ne,Te=ut*vt*ne,Me=ut*Dt*ne}let[Ke,Be,at,Xe]=yo(me.projectedAnchorX+Ce,me.projectedAnchorY+Te,me.projectedAnchorZ+Me,c?Q:w);const Qe=Gc(x.getCameraToCenterDistance(J),Xe);let At=i.bM(m.textSizeData,O,me)*Qe/i.bX;c&&(At*=m.tilePixelRatio/M);const Ye=Sc(Ie,At);c?({x:Ke,y:Be,z:at}=J.projectTilePoint(ve+Ye.x,Pe+Ye.y,A.canonical),[Ke,Be,at]=yo(Ke+Ce,Be+Te,at+Me,w)):(s&&Ye._rotate(-x.angle),Ke+=Ye.x,Be+=Ye.y,at=0);const je=m.allowVerticalPlacement&&me.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let ut=0;ut<Ae;ut++)i.bO(G,Ke,Be,at,je);z&&me.associatedIconIndex>=0&&(Y[me.associatedIconIndex]={x:Ke,y:Be,z:at,angle:je})}else An(Ae,G)}if(z){V.clear();const he=m.icon.placedSymbolArray;for(let me=0;me<he.length;me++){const ve=he.get(me),{numGlyphs:Pe}=ve,Ae=Y[me];if(ve.hidden||!Ae)An(Pe,V);else{const{x:Ie,y:Ce,z:Te,angle:Me}=Ae;for(let Ke=0;Ke<Pe;Ke++)i.bO(V,Ie,Ce,Te,Me)}}m.icon.dynamicLayoutVertexBuffer.updateData(V)}m.text.dynamicLayoutVertexBuffer.updateData(G)}function Sl(m,s,c,p,x,w,A={}){const M=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),z=c.paint.get("icon-translate-anchor"),B=c.paint.get("text-translate-anchor"),G=c.layout.get("icon-rotation-alignment"),V=c.layout.get("text-rotation-alignment"),Y=c.layout.get("icon-pitch-alignment"),J=c.layout.get("text-pitch-alignment"),Q=c.layout.get("icon-keep-upright"),ce=c.layout.get("text-keep-upright"),ne=c.paint.get("icon-color-saturation"),he=c.paint.get("icon-color-contrast"),me=c.paint.get("icon-color-brightness-min"),ve=c.paint.get("icon-color-brightness-max"),Pe=c.layout.get("symbol-elevation-reference")==="sea",Ae=c.layout.get("icon-image-use-theme")==="none",Ie=m.context,Ce=Ie.gl,Te=m.transform,Me=G==="map",Ke=V==="map",Be=Y==="map",at=J==="map",Xe=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const At=m.depthModeForSublayer(0,Qt.ReadOnly),Ye=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D),je=[i.aF(Te.center.lng),i.aJ(Te.center.lat)],ut=c.layout.get("text-variable-anchor"),tt=Te.projection.name==="globe",vt=[],Dt=[0,-1,0];for(const Gt of p){const Pt=s.getTile(Gt),wt=Pt.getBucket(c);if(!wt||wt.projection.name==="mercator"&&tt||wt.fullyClipped)continue;const dn=wt.projection.name==="globe",cn=dn?i.aj(Te.zoom):0,ln=Du(Gt,wt.getProjection(),Te),un=Te.calculatePixelsToTileUnitsMatrix(Pt),jn=ut&&wt.hasTextData(),Un=wt.hasIconTextFit()&&jn&&wt.hasIconData(),Wn=wt.getProjection().createInversionMatrix(Te,Gt.canonical),Fr=(1<<Pt.tileID.canonical.z)*i.al/m.transform.worldSize,Bn=pi=>{let Yn=[0,0,0];if(pi){const Mn=m.style.directionalLight,Br=m.style.ambientLight;Mn&&Br&&(Yn=Ha(m.style,Mn,Br))}return Yn},Ar=pi=>{Te.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||m.terrain)&&(pi.push("DEPTH_D24"),pi.push("DEPTH_OCCLUSION"))},Lr=pi=>{c.lut&&!Ae&&(c.lut.texture||(c.lut.texture=new i.dY(m.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Ie.gl.RGBA8)),Ie.activeTexture.set(Ie.gl.TEXTURE0+Hi.LUT),c.lut.texture&&c.lut.texture.bind(Ie.gl.LINEAR,Ie.gl.CLAMP_TO_EDGE),pi.push("APPLY_LUT_ON_GPU"))},Hr=()=>{const pi=Me&&c.layout.get("symbol-placement")!=="point",Yn=[];Ar(Yn),Lr(Yn);const Mn=pi||Un,Br=wt.elevationType==="road",Gr=m.shadowRenderer,ai=Br&&Be&&!!Gr&&Gr.enabled,Zi=Bn(ai),Gi=Br&&Be&&!m.terrain?Ye:At,To=c.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Be&&Yn.push("PITCH_WITH_MAP_TERRAIN"),dn&&(Yn.push("PROJECTION_GLOBE_VIEW"),Mn&&Yn.push("PROJECTED_POS_ON_VIEWPORT")),To>0&&wt.hasAnySecondaryIcon&&Yn.push("ICON_TRANSITION"),!wt.icon.zOffsetVertexBuffer||Br&&m.terrain||Yn.push("Z_OFFSET"),ne===0&&he===0&&me===0&&ve===1||Yn.push("COLOR_ADJUSTMENT"),wt.sdfIcons&&Yn.push("RENDER_SDF"),ai&&Yn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Br&&Be&&!m.terrain&&wt.icon.orientationVertexBuffer&&Yn.push("ELEVATED_ROADS");const Us=wt.icon.programConfigurations.get(c.id),ho=m.getOrCreateProgram("symbol",{config:Us,defines:Yn}),Eo=Pt.imageAtlasTexture?Pt.imageAtlasTexture.size:[0,0],Ys=wt.iconSizeData,il=i.bK(Ys,Te.zoom),Ia=Be||!Te.isOrthographic,Li=Va(ln,Pt.tileID.canonical,Be,Me,Te,wt.getProjection(),un),ji=Yh(ln,Pt.tileID.canonical,Be,Me,Te,wt.getProjection(),un),mi=m.translatePosMatrix(ji,Pt,M,z,!0),Wi=m.translatePosMatrix(ln,Pt,M,z),Ji=Mn?Hl:Li,Ui=Me&&!Be&&!pi;let Ps=Dt;!tt&&!Te.mercatorFromTransition||Me||(Ps=Mf(Te));const Zl=dn?Ps:Dt,Xl=c.getColorAdjustmentMatrix(ne,he,me,ve),Ma=nu(Ys.kind,il,Ui,Be,m,Wi,Ji,mi,Pe,!1,Eo,[0,0],0,Gt,cn,je,Wn,Zl,wt.getProjection(),Zi,Fr,Xl,To,null),Cl=Pt.imageAtlasTexture?Pt.imageAtlasTexture:null,Yl=c.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear,ka=wt.sdfIcons||m.options.rotating||m.options.zooming||Yl||Ia?Ce.LINEAR:Ce.NEAREST,yh=wt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Pc=m.terrain&&Be&&pi?i.bl(i.bC(),Li):Hl;if(pi&&wt.icon){const Ra=Te.elevation,Ic=Ra?Ra.getAtTileOffsetFunc(Gt,Te.center.lat,Te.worldSize,wt.getProjection()):null,gu=$a(ln,Pt.tileID.canonical,Be,Me,Te,wt.getProjection(),un);Kh(wt,ln,m,!1,gu,ji,Be,Q,Ic,Gt)}return{program:ho,buffers:wt.icon,uniformValues:Ma,atlasTexture:Cl,atlasTextureIcon:null,atlasInterpolation:ka,atlasInterpolationIcon:null,isSDF:wt.sdfIcons,hasHalo:yh,depthMode:Gi,tile:Pt,renderWithShadows:ai,labelPlaneMatrixInv:Pc}},Xn=()=>{const pi=Ke&&c.layout.get("symbol-placement")!=="point",Yn=[],Mn=pi||ut||Un,Br=wt.elevationType==="road",Gr=m.shadowRenderer,ai=Br&&at&&!!Gr&&Gr.enabled,Zi=Bn(ai),Gi=Br&&at&&!m.terrain?Ye:At;m.terrainRenderModeElevated()&&at&&Yn.push("PITCH_WITH_MAP_TERRAIN"),dn&&(Yn.push("PROJECTION_GLOBE_VIEW"),Mn&&Yn.push("PROJECTED_POS_ON_VIEWPORT")),!wt.text.zOffsetVertexBuffer||Br&&m.terrain||Yn.push("Z_OFFSET"),wt.iconsInText&&Yn.push("RENDER_TEXT_AND_SYMBOL"),Yn.push("RENDER_SDF"),ai&&Yn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Br&&at&&!m.terrain&&wt.text.orientationVertexBuffer&&Yn.push("ELEVATED_ROADS"),Ar(Yn);const To=wt.text.programConfigurations.get(c.id),Us=m.getOrCreateProgram("symbol",{config:To,defines:Yn});let ho,Eo=[0,0],Ys=null;const il=wt.textSizeData;wt.iconsInText&&(Eo=Pt.imageAtlasTexture?Pt.imageAtlasTexture.size:[0,0],Ys=Pt.imageAtlasTexture?Pt.imageAtlasTexture:null,ho=at||!Te.isOrthographic||m.options.rotating||m.options.zooming||il.kind==="composite"||il.kind==="camera"?Ce.LINEAR:Ce.NEAREST);const Ia=Pt.glyphAtlasTexture?Pt.glyphAtlasTexture.size:[0,0],Li=c.layout.get("text-size-scale-range"),ji=i.aA(m.scaleFactor,Li[0],Li[1]),mi=i.bK(il,Te.zoom,ji),Wi=Va(ln,Pt.tileID.canonical,at,Ke,Te,wt.getProjection(),un),Ji=Yh(ln,Pt.tileID.canonical,at,Ke,Te,wt.getProjection(),un),Ui=m.translatePosMatrix(Ji,Pt,O,B,!0),Ps=m.translatePosMatrix(ln,Pt,O,B),Zl=Mn?Hl:Wi,Xl=Ke&&!at&&!pi;let Ma=Dt;!tt&&!Te.mercatorFromTransition||Ke||(Ma=Mf(Te));const Cl=nu(il.kind,mi,Xl,at,m,Ps,Zl,Ui,Pe,!0,Ia,Eo,0,Gt,cn,je,Wn,dn?Ma:Dt,wt.getProjection(),Zi,Fr,null,null,ji),Yl=Pt.glyphAtlasTexture?Pt.glyphAtlasTexture:null,ka=Ce.LINEAR,yh=c.paint.get("text-halo-width").constantOr(1)!==0,Pc=m.terrain&&at&&pi?i.bl(i.bC(),Wi):Hl;if(pi&&wt.text){const Ra=Te.elevation,Ic=Ra?Ra.getAtTileOffsetFunc(Gt,Te.center.lat,Te.worldSize,wt.getProjection()):null,gu=$a(ln,Pt.tileID.canonical,at,Ke,Te,wt.getProjection(),un);Kh(wt,ln,m,!0,gu,Ji,at,ce,Ic,Gt)}return{program:Us,buffers:wt.text,uniformValues:Cl,atlasTexture:Yl,atlasTextureIcon:Ys,atlasInterpolation:ka,atlasInterpolationIcon:ho,isSDF:!0,hasHalo:yh,depthMode:Gi,tile:Pt,renderWithShadows:ai,labelPlaneMatrixInv:Pc}},Sr=wt.icon.segments.get().length,Mr=wt.text.segments.get().length,tr=Sr&&!A.onlyText?Hr():null,fi=Mr&&!A.onlyIcons?Xn():null,Di=c.paint.get("icon-opacity").constantOr(1),gs=c.paint.get("text-opacity").constantOr(1);if(Xe&&wt.canOverlap){Qe=!0;const pi=Di&&!A.onlyText?wt.icon.segments.get():[],Yn=gs&&!A.onlyIcons?wt.text.segments.get():[];for(const Mn of pi)vt.push({segments:new i.bg([Mn]),sortKey:Mn.sortKey,state:tr});for(const Mn of Yn)vt.push({segments:new i.bg([Mn]),sortKey:Mn.sortKey,state:fi})}else A.onlyText||vt.push({segments:Di?wt.icon.segments:new i.bg([]),sortKey:0,state:tr}),A.onlyIcons||vt.push({segments:gs?wt.text.segments:new i.bg([]),sortKey:0,state:fi})}Qe&&vt.sort(((Gt,Pt)=>Gt.sortKey-Pt.sortKey));for(const Gt of vt){const Pt=Gt.state;if(Pt)if(m.terrain?m.terrain.setupElevationDraw(Pt.tile,Pt.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Pt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Pt.program),Ie.activeTexture.set(Ce.TEXTURE0),Pt.atlasTexture&&Pt.atlasTexture.bind(Pt.atlasInterpolation,Ce.CLAMP_TO_EDGE,!0),Pt.atlasTextureIcon&&(Ie.activeTexture.set(Ce.TEXTURE1),Pt.atlasTextureIcon&&Pt.atlasTextureIcon.bind(Pt.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE,!0)),Pt.renderWithShadows&&m.shadowRenderer.setupShadows(Pt.tile.tileID.toUnwrapped(),Pt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Pt.program),Pt.hasHalo){const wt=Pt.uniformValues;wt.u_is_halo=1,dd(Pt.buffers,Gt.segments,c,m,Pt.program,Pt.depthMode,x,w,wt,2),wt.u_is_halo=0}else{if(Pt.isSDF){const wt=Pt.uniformValues;Pt.hasHalo&&(wt.u_is_halo=1,dd(Pt.buffers,Gt.segments,c,m,Pt.program,Pt.depthMode,x,w,wt,1)),wt.u_is_halo=0}dd(Pt.buffers,Gt.segments,c,m,Pt.program,Pt.depthMode,x,w,Pt.uniformValues,1)}}}function dd(m,s,c,p,x,w,A,M,O,z){const B=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,w,A,M,Dn.disabled,O,c.id,m.layoutVertexBuffer,m.indexBuffer,s,c.paint,p.transform.zoom,m.programConfigurations.get(c.id),B,z)}function Jm(m,s){const c=1<<m.canonical.z,p=(s.x*c-m.canonical.x-m.wrap*c)*i.al,x=(s.y*c-m.canonical.y)*i.al,w=i.e5(s.z,s.y);return i.d4(p,x,w)}function Bo(m,s,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const w=m.context.gl,A=new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D),M=new Qt(m.context.gl.GREATER,Qt.ReadWrite,m.depthRangeFor3D),O=(function(Y){let J=.01;return Y.isOrthographic&&(J=i.ak(1e-4,J,i.c$(Y.pitch>=ga?1:Y.pitch/ga))),2*J})(m.transform),z=m.transform.getFreeCameraOptions().position,B="elevatedStructuresDepthReconstruct",G=m.getOrCreateProgram(B,{defines:["DEPTH_RECONSTRUCTION"]}),V=m.getOrCreateProgram(B);for(const Y of p){const J=s.getTile(Y),Q=J.getBucket(c);if(!Q)continue;const ce=Q.elevatedStructures;if(!ce)continue;const ne=Q.elevationBufferData.heightRange,he=Jm(Y.toUnwrapped(),z),me=m.translatePosMatrix(Y.projMatrix,J,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let ve,Pe,Ae,Ie;if(x==="initialize"){if(!ne||ne.min>=1||ce.depthSegments.segments[0].primitiveLength===0)continue;ve=Qa(me,he,O,1,0),Pe=A,Ae=ce.depthSegments,Ie=G}else if(x==="reset"){if(!ne||ne.min>=0||ce.maskSegments.segments[0].primitiveLength===0)continue;ve=Qa(me,he,0,0,1),Pe=M,Ae=ce.maskSegments,Ie=G}else if(x==="geometry"){if(ce.depthSegments.segments[0].primitiveLength===0)continue;ve=Qa(me,he,O,1,0),Pe=A,Ae=ce.depthSegments,Ie=V}Ie.draw(m,w.TRIANGLES,Pe,In.disabled,Gn.disabled,Dn.disabled,ve,c.id,ce.vertexBuffer,ce.indexBuffer,Ae,c.paint,m.transform.zoom)}}function wa(m,s,c){const{painter:p,sourceCache:x,layer:w,coords:A,colorMode:M,elevationType:O,terrainEnabled:z,pass:B}=m,G=p.context.gl,V=w.paint.get("fill-pattern"),Y=w.paint.get("fill-pattern-cross-fade"),J=V.constantOr(null);let Q=O;O!=="road"||s&&!z||(Q="none");const ce=Q==="road",ne=m.painter.shadowRenderer,he=ce&&!!ne&&ne.enabled,me=new Qt(p.context.gl.LEQUAL,Qt.ReadOnly,p.depthRangeFor3D);let ve=[0,0,0];if(he){const Ie=p.style.directionalLight,Ce=p.style.ambientLight;Ie&&Ce&&(ve=Ha(p.style,Ie,Ce))}const Pe=V&&V.constantOr(1),Ae=(Ie,Ce)=>{let Te,Me,Ke,Be,at;Ce?(Te=Pe&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ke=G.LINES):(Te=Pe?"fillPattern":"fill",Ke=G.TRIANGLES);for(const Xe of A){const Qe=x.getTile(Xe);if(Pe&&!Qe.patternsLoaded())continue;const At=Qe.getBucket(w);if(!At)continue;const Ye=s?At.elevationBufferData:At.bufferData;if(Ye.isEmpty())continue;p.prepareDrawTile();const je=Ye.programConfigurations.get(w.id),ut=p.isTileAffectedByFog(Xe),tt=[],vt=[];ce&&(tt.push("ELEVATED_ROADS"),vt.push(Ye.elevatedLayoutVertexBuffer)),he&&tt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pe&&(p.context.activeTexture.set(G.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),je.updatePaintBuffers());let Dt=!1;if(J&&Qe.imageAtlas){const cn=Qe.imageAtlas,ln=i.e0.from(J),un=ln.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),jn=ln.getSecondary(),Un=cn.patternPositions.get(un),Wn=jn?cn.patternPositions.get(jn.scaleSelf(i.o.devicePixelRatio).toString()):null;Dt=!!Un&&!!Wn,Un&&je.setConstantPatternPositions(Un,Wn)}Y>0&&(Dt||je.getPatternTransitionVertexBuffer("fill-pattern"))&&tt.push("FILL_PATTERN_TRANSITION");const Gt=p.getOrCreateProgram(Te,{config:je,overrideFog:ut,defines:tt}),Pt=p.translatePosMatrix(Xe.projMatrix,Qe,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));he&&ne.setupShadows(Qe.tileID.toUnwrapped(),Gt,"vector-tile");const wt=w.paint.get("fill-emissive-strength");if(Ce){Be=Ye.lineIndexBuffer,at=Ye.lineSegments;const cn=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];Me=Te==="fillOutlinePattern"&&Pe?Ja(Pt,wt,p,Qe,cn,ve,Y):Ka(Pt,wt,cn,ve)}else Be=Ye.indexBuffer,at=Ye.triangleSegments,Me=Pe?Vl(Pt,wt,p,Qe,ve,Y):ud(Pt,wt,ve);p.uploadCommonUniforms(p.context,Gt,Xe.toUnwrapped());let dn=Ie;(O==="road"&&!z||O==="offset")&&(dn=me),Gt.draw(p,Ke,dn,c||p.stencilModeForClipping(Xe),M,Dn.disabled,Me,w.id,Ye.layoutVertexBuffer,Be,at,w.paint,p.transform.zoom,je,vt)}};p.renderPass===B&&Ae(p.depthModeForSublayer(1,p.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly),!1),Q==="none"&&p.renderPass==="translucent"&&w.paint.get("fill-antialias")&&Ae(p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly),!0)}function nn(m,s,c,p,x,w,A,M){c.resetLayerRenderingStats(m);const O=m.context,z=O.gl,B=m.transform,G=c.paint.get("fill-extrusion-pattern"),V=c.paint.get("fill-extrusion-pattern-cross-fade"),Y=G.constantOr(null),J=G.constantOr(1),Q=c.paint.get("fill-extrusion-opacity"),ce=m.style.enable3dLights(),ne=c.paint.get(ce&&!J?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),he=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne],me=c.layout.get("fill-extrusion-edge-radius"),ve=me>0&&!c.paint.get("fill-extrusion-rounded-roof"),Pe=ve?0:me,Ae=B.projection.name==="globe"?i.e8():0,Ie=B.projection.name==="globe",Ce=Ie?i.aj(B.zoom):0,Te=[i.aF(B.center.lng),i.aJ(B.center.lat)],Me=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ke=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Me?null:c.lut).toArray01().slice(0,3),Be=c.paint.get("fill-extrusion-flood-light-intensity"),at=c.paint.get("fill-extrusion-vertical-scale"),Xe=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=c.paint.get("fill-extrusion-height-alignment"),At=c.paint.get("fill-extrusion-base-alignment"),Ye=Xc(m,c.paint.get("fill-extrusion-cutoff-fade-range")),je=[];let ut;Ie&&je.push("PROJECTION_GLOBE_VIEW"),he[0]>0&&je.push("FAUX_AO"),ve&&je.push("ZERO_ROOF_RADIUS"),M&&je.push("HAS_CENTROID"),Be>0&&je.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&je.push("RENDER_CUTOFF"),Xe&&je.push("RENDER_WALL_MODE");const tt=m.renderPass==="shadow",vt=m.shadowRenderer,Dt=tt&&!!vt,Gt=tt?Dn.disabled:Dn.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Pt=[0,0,0];if(vt){const cn=m.style.directionalLight,ln=m.style.ambientLight;cn&&ln&&(Pt=Ha(m.style,cn,ln)),tt||(je.push("RENDER_SHADOWS","DEPTH_TEXTURE"),vt.useNormalOffset&&je.push("NORMAL_OFFSET")),ut=je.concat(["SHADOWS_SINGLE_CASCADE"])}const wt=Dt?"fillExtrusionDepth":J?"fillExtrusionPattern":"fillExtrusion",dn=c.getLayerRenderingStats();for(const cn of p){const ln=s.getTile(cn),un=ln.getBucket(c);if(!un||un.projection.name!==B.projection.name)continue;let jn=!1;vt&&(jn=vt.getMaxCascadeForTile(cn.toUnwrapped())===0);const Un=m.isTileAffectedByFog(cn),Wn=un.programConfigurations.get(c.id);let Fr=!1;if(Y&&ln.imageAtlas){const Mr=ln.imageAtlas,tr=i.e0.from(Y),fi=tr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Di=tr.getSecondary(),gs=Mr.patternPositions.get(fi),pi=Di?Mr.patternPositions.get(Di.scaleSelf(i.o.devicePixelRatio).toString()):null;Fr=!!gs&&!!pi,gs&&Wn.setConstantPatternPositions(gs,pi)}V>0&&(Fr||Wn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&je.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Bn=m.getOrCreateProgram(wt,{config:Wn,defines:jn?ut:je,overrideFog:Un});if(m.terrain&&m.terrain.setupElevationDraw(ln,Bn,{useMeterToDem:!0}),!un.centroidVertexBuffer){const Mr=Bn.getAttributeLocation(z,"a_centroid_pos");Mr!==-1&&z.vertexAttrib2f(Mr,0,0)}!tt&&vt&&vt.setupShadows(ln.tileID.toUnwrapped(),Bn,"vector-tile"),J&&(m.context.activeTexture.set(z.TEXTURE0),ln.imageAtlasTexture&&ln.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Wn.updatePaintBuffers());const Ar=c.paint.get("fill-extrusion-vertical-gradient"),Lr=1/un.tileToMeter;let Hr;if(tt&&vt){if(Qm(ln.tileID,un.maxHeight,m))continue;const Mr=vt.calculateShadowPassMatrixFromTile(ln.tileID.toUnwrapped());Hr=eu(Mr,Pe,Lr,at,Qe,At)}else{const Mr=m.translatePosMatrix(cn.expandedProjMatrix,ln,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),tr=B.projection.createInversionMatrix(B,cn.canonical);Hr=J?Yu(Mr,m,Ar,Q,he,Pe,Lr,cn,ln,Ae,Qe,At,Ce,Te,tr,Ke,at,V):Ya(Mr,m,Ar,Q,he,Pe,Lr,cn,Ae,Qe,At,Ce,Te,tr,Ke,at,Be,Pt)}m.uploadCommonUniforms(O,Bn,cn.toUnwrapped(),null,Ye);let Xn=un.segments;if(B.projection.name==="mercator"&&!tt&&(Xn=un.getVisibleSegments(ln.tileID,m.terrain,m.transform.getFrustum(0)),!Xn.get().length))continue;if(dn)if(tt)for(const Mr of Xn.get())dn.numRenderedVerticesInShadowPass+=Mr.primitiveLength;else for(const Mr of Xn.get())dn.numRenderedVerticesInTransparentPass+=Mr.primitiveLength;const Sr=[];(m.terrain||M)&&Sr.push(un.centroidVertexBuffer),Ie&&Sr.push(un.layoutVertexExtBuffer),Xe&&Sr.push(un.wallVertexBuffer),Bn.draw(m,O.gl.TRIANGLES,x,w,A,Gt,Hr,c.id,un.layoutVertexBuffer,un.indexBuffer,Xn,c.paint,m.transform.zoom,Wn,Sr)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Wp{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function lo(m,s,c,p,x,w,A,M,O,z,B,G,V,Y,J,Q,ce,ne,he,me){const ve=s.context,Pe=ve.gl,Ae=s.transform,Ie=s.transform.zoom,Ce=[],Te=m.translate,Me=m.translateAnchor,Ke=m.edgeRadius,Be=Xc(s,m.cutoffFadeRange);B==="clear"?(Ce.push("CLEAR_SUBPASS"),me&&(Ce.push("CLEAR_FROM_TEXTURE"),ve.activeTexture.set(Pe.TEXTURE0),me.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE))):B==="sdf"&&Ce.push("SDF_SUBPASS"),ne&&Ce.push("HAS_CENTROID"),Be.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");const at=(Xe,Qe,At,Ye,je)=>{const ut=Qe.programConfigurations.get(p.id),tt=s.isTileAffectedByFog(Xe),vt=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:ut,defines:Ce,overrideFog:tt}),Dt=((Pt,wt,dn,cn,ln,un,jn,Un,Wn,Fr,Bn)=>({u_matrix:wt,u_opacity:dn,u_ao_pass:cn?1:0,u_meter_to_tile:ln,u_ao:un,u_flood_light_intensity:jn,u_flood_light_color:Un,u_attenuation:Wn,u_edge_radius:Fr,u_fb:0,u_fb_size:Bn,u_dynamic_offset:1}))(0,Ye,G,z,je,[V,Y*je],J,Q,ce,Ie>=17?0:Ke*je,me?me.size[0]:0),Gt=[];ne&&Gt.push(Qe.hiddenByLandmarkVertexBuffer),s.uploadCommonUniforms(ve,vt,Xe.toUnwrapped(),null,Be),vt.draw(s,ve.gl.TRIANGLES,w,A,M,O,Dt,p.id,Qe.vertexBuffer,Qe.indexBuffer,At,p.paint,Ie,ut,Gt)};for(const Xe of x){const Qe=c.getTile(Xe),At=Qe.getBucket(p);if(!At||At.projection.name!==Ae.projection.name||!At.groundEffect||At.groundEffect&&!At.groundEffect.hasData())continue;const Ye=At.groundEffect,je=1/At.tileToMeter;{const ut=s.translatePosMatrix(Xe.projMatrix,Qe,Te,Me),tt=Ye.getDefaultSegment();at(Xe,Ye,tt,ut,je)}if(he)for(let ut=0;ut<4;ut++){const tt=i.e6[ut](Xe),vt=c.getTile(tt);if(!vt)continue;const Dt=vt.getBucket(p);if(!Dt||Dt.projection.name!==Ae.projection.name||!Dt.groundEffect||Dt.groundEffect&&!Dt.groundEffect.hasData())continue;const Gt=Dt.groundEffect;let Pt,wt;ut===0?(Pt=[-i.al,0,0],wt=1):ut===1?(Pt=[i.al,0,0],wt=0):ut===2?(Pt=[0,-i.al,0],wt=3):(Pt=[0,i.al,0],wt=2);const dn=Gt.regionSegments[wt];if(!dn)continue;const cn=new Float32Array(16);i.br(cn,Xe.projMatrix,Pt),at(Xe,Gt,dn,s.translatePosMatrix(cn,Qe,Te,Me),je)}}}function Uo(m,s,c,p,x,w,A){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const M=w?w.findDEMTileFor(c):null;if(!(M&&M.dem||A))return;w&&M&&M.dem&&p.selfDEMTileTimestamp!==M.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=M.dem._timestamp);const O=ne=>new i.P(Math.ceil((ne+i.ea)*i.eb),0),z=ne=>{const he=s.getSource().minzoom,me=Pe=>{const Ae=s.getTileByID(Pe);if(Ae&&Ae.hasData())return Ae.getBucket(x)},ve=[0,-1,1];for(const Pe of ve){if(ne.overscaledZ+Pe<he)continue;const Ae=me(ne.calculateScaledKey(ne.overscaledZ+Pe));if(Ae)return Ae}},B=[0,0,0],G=(ne,he)=>(B[0]=Math.min(ne.min.y,he.min.y),B[1]=Math.max(ne.max.y,he.max.y),B[2]=i.al-he.min.x>ne.max.x?he.min.x-i.al:ne.max.x,B),V=(ne,he)=>(B[0]=Math.min(ne.min.x,he.min.x),B[1]=Math.max(ne.max.x,he.max.x),B[2]=i.al-he.min.y>ne.max.y?he.min.y-i.al:ne.max.y,B),Y=[(ne,he)=>G(ne,he),(ne,he)=>G(he,ne),(ne,he)=>V(ne,he),(ne,he)=>V(he,ne)],J=(ne,he,me,ve,Pe,Ae,Ie)=>{if(!w)return 0;const Ce=[[Ae?me:ne,Ae?ne:me,0],[Ae?me:he,Ae?he:me,0]],Te=Ie<0?i.al+Ie:Ie,Me=[Ae?Te:(ne+he)/2,Ae?(ne+he)/2:Te,0];return me===0&&Ie<0||me!==0&&Ie>0?w.getForTilePoints(Pe,[Me],!0,ve):Ce.push(Me),w.getForTilePoints(c,Ce,!0,M),Math.max(Ce[0][2],Ce[1][2],Me[2])/w.exaggeration()};for(let ne=0;ne<4;ne++){const he=p.borderFeatureIndices[ne];if(he.length===0)continue;const me=i.e6[ne](c),ve=z(me);if(!(ve&&ve instanceof i.e7))continue;const Pe=w?w.findDEMTileFor(me):null;if(!(Pe&&Pe.dem||A)||(w&&Pe&&Pe.dem&&p.borderDEMTileTimestamp[ne]!==Pe.dem._timestamp&&(p.borderDoneWithNeighborZ[ne]=-1,p.borderDEMTileTimestamp[ne]=Pe.dem._timestamp),p.borderDoneWithNeighborZ[ne]===ve.canonical.z))continue;ve.centroidVertexArray.length===0&&ve.createCentroidsBuffer();const Ae=(ne<2?1:5)-ne,Ie=ve.borderDoneWithNeighborZ[Ae]!==p.canonical.z,Ce=ve.borderFeatureIndices[Ae];let Te=0;if(p.canonical.z!==ve.canonical.z){for(const Me of he)p.showCentroid(p.featuresOnBorder[Me]);if(Ie)for(const Me of Ce)ve.showCentroid(ve.featuresOnBorder[Me]);p.borderDoneWithNeighborZ[ne]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ae]=p.canonical.z}for(const Me of he){const Ke=p.featuresOnBorder[Me],Be=p.centroidData[Ke.centroidDataIndex],at=Ke.borders[ne];let Xe;for(;Te<Ce.length;){Xe=ve.featuresOnBorder[Ce[Te]];const Qe=Xe.borders[Ae];if(Qe[1]>at[0]+3||Qe[0]>at[0]-3)break;ve.showCentroid(Xe),Te++}if(Xe&&Te<Ce.length){const Qe=Te;let At=0;for(;!(Xe.borders[Ae][0]>at[1]-3)&&(At++,++Te!==Ce.length);)Xe=ve.featuresOnBorder[Ce[Te]];Xe=ve.featuresOnBorder[Ce[Qe]];let Ye=!1;if(At>=1){const tt=Xe.borders[Ae];Math.abs(at[0]-tt[0])<3&&Math.abs(at[1]-tt[1])<3&&(At=1,Ye=!0,Te=Qe+1)}else if(At===0){p.showCentroid(Ke);continue}const je=ve.centroidData[Xe.centroidDataIndex];A&&Ye&&(((Q=Be).flags|(ce=je).flags)&i.e9?(Q.flags|=i.e9,ce.flags|=i.e9):(Q.flags&=~i.e9,ce.flags&=~i.e9));const ut=Ke.intersectsCount()>1||Xe.intersectsCount()>1;if(At>1)Te=Qe,Be.centroidXY=je.centroidXY=new i.P(0,0);else if(Pe&&Pe.dem&&!ut){const tt=Y[ne](Be,je),vt=ne%2?i.al-1:0,Dt=J(tt[0],Math.min(i.al-1,tt[1]),vt,Pe,me,ne<2,tt[2]);Be.centroidXY=je.centroidXY=O(Dt)}else ut?Be.centroidXY=je.centroidXY=new i.P(0,0):(Be.centroidXY=p.encodeBorderCentroid(Ke),je.centroidXY=ve.encodeBorderCentroid(Xe));p.writeCentroidToBuffer(Be),ve.writeCentroidToBuffer(je)}else p.showCentroid(Ke)}p.borderDoneWithNeighborZ[ne]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ae]=p.canonical.z}var Q,ce;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(m)}const Tl=[1,0,0],Cn=[0,1,0],fd=[0,0,1];function Qm(m,s,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const w=m.toUnwrapped(),A=p.tileSize*x._cascades[c.currentShadowCascade].scale;let M=s;if(p.elevation){const Q=p.elevation.getMinMaxForTile(m);Q&&(M+=Q.max)}const O=[...x.shadowDirection];O[2]=-O[2];const z=x.computeSimplifiedTileShadowVolume(w,M,A,O);if(!z)return!1;const B=[Tl,Cn,fd,O,[O[0],0,O[2]],[0,O[1],O[2]]],G=p.projection.name==="globe",V=p.scaleZoom(A),Y=i.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,V,!G),J=x.getCurrentCascadeFrustum();return Y.intersectsPrecise(z.vertices,z.planes,B)===0||J.intersectsPrecise(z.vertices,z.planes,B)===0}function iu(m){const{painter:s,source:c,layer:p,coords:x}=m;let w=m.defines;const A=s.context,M=s.renderPass==="shadow",O=s.renderPass==="light-beam",z=s.shadowRenderer,B=i.ec(s.transform.center.lat,s.transform.zoom),G=Xc(s,p.paint.get("building-cutoff-fade-range"));G.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF"));for(const V of x){const Y=c.getTile(V),J=Y.getBucket(p);if(!J)continue;z&&z.getMaxCascadeForTile(V.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const Q=J.programConfigurations.get(p.id);let ce,ne,he,me=s.translatePosMatrix(V.expandedProjMatrix,Y,[0,0],"map");if(me=i.cR(i.bC(),me,[1,1,m.verticalScale]),M&&z){if(Qm(Y.tileID,J.maxHeight*B,s))continue;let Pe=z.calculateShadowPassMatrixFromTile(Y.tileID.toUnwrapped());Pe=i.cR(i.bC(),Pe,[1,1,m.verticalScale]),he=Up(Pe),ce=ne=s.getOrCreateProgram("buildingDepth",{config:Q,defines:w,overrideFog:!1})}else if(O)ce=ne=s.getOrCreateProgram("buildingBloom",{config:Q,defines:w,overrideFog:!1}),he=Ju(me);else{const Pe=s.transform.calculatePosMatrix(V.toUnwrapped(),s.transform.worldSize);i.cR(Pe,Pe,[1,1,m.verticalScale]);const Ae=i.bC();i.cR(Ae,Pe,[1,-1,1/B]),i.bl(Ae,Ae),i.ed(Ae,Ae);const Ie=s.transform.getFreeCameraOptions().position,Ce=1<<V.canonical.z;he=bc(me,Ae,m.opacity,m.facadeAOIntensity,[((Ie.x-V.wrap)*Ce-V.canonical.x)*i.al,(Ie.y*Ce-V.canonical.y)*i.al,Ie.z*Ce*i.al],J.tileToMeter,m.facadeEmissiveChance),ne=s.getOrCreateProgram("building",{config:Q,defines:w,overrideFog:!1});const Te=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ce=s.getOrCreateProgram("building",{config:Q,defines:Te,overrideFog:!1}),z&&(z.setupShadowsFromMatrix(Pe,ne,!0),z.setupShadowsFromMatrix(Pe,ce,!0))}const ve=(Pe,Ae)=>{if(O){const Ie=Pe.entranceBloom;Ae.draw(s,A.gl.TRIANGLES,m.depthMode,In.disabled,m.blendMode,Dn.disabled,he,p.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segmentsBucket,p.paint,s.transform.zoom,Q,[Ie.layoutAttenuationBuffer,Ie.layoutColorBuffer])}else{const Ie=Pe.segmentsBucket;let Ce=[Pe.layoutNormalBuffer,Pe.layoutCentroidBuffer,Pe.layoutColorBuffer];Pe.layoutFacadePaintBuffer&&(Ce=Ce.concat([Pe.layoutFacadeDataBuffer,Pe.layoutFacadeVerticalRangeBuffer,Pe.layoutFacadePaintBuffer])),Ae.draw(s,A.gl.TRIANGLES,m.depthMode,In.disabled,m.blendMode,M?Dn.disabled:Dn.backCW,he,p.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Ie,p.paint,s.transform.zoom,Q,Ce)}};s.uploadCommonUniforms(A,ne,V.toUnwrapped(),null,G),J.buildingWithoutFacade&&ve(J.buildingWithoutFacade,ne),ce!==ne&&s.uploadCommonUniforms(A,ce,V.toUnwrapped(),null,G),J.buildingWithFacade&&ve(J.buildingWithFacade,ce)}}function Sa(m){return[m[0]*i.ee,m[1]*i.ee,m[2]*i.ee,0]}function su(m,s,c,p,x,w,A,M,O){const z=p.getSource(),B=c.globeSharedBuffers;if(!B)return;let G,V,Y;if(s&&(G=p.getTile(s)),z instanceof i.aS?(V=z.texture,Y=i.dG(0,0,c.transform)):G&&s&&(V=G.texture,Y=i.dG(s.canonical.z,s.canonical.x,c.transform)),!V||!Y)return;m||(Y=i.cR(i.bC(),Y,[1,-1,1]));const J=c.context,Q=J.gl,ce=x.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,ne=c.colorModeForDrapableLayerRenderPass(w),he=A.defines;he.push("GLOBE_POLES");const me=new Qt(Q.LEQUAL,Qt.ReadWrite,c.depthRangeFor3D),ve=Float32Array.from(c.transform.expandedFarZProjMatrix),Pe=Float32Array.from(i.bk(i.dF(new i.cC(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),J.activeTexture.set(Q.TEXTURE0),V.bind(ce,Q.CLAMP_TO_EDGE),J.activeTexture.set(Q.TEXTURE1),V.bind(ce,Q.CLAMP_TO_EDGE),"useMipmap"in V&&J.extTextureFilterAnisotropic&&c.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[Ae,Ie,Ce,Te]=s?B.getPoleBuffers(s.canonical.z,!1):B.getPoleBuffers(0,!0),Me=x.paint.get("raster-elevation");let Ke;m?(Ke=Ae,c.renderDefaultNorthPole=Me!==0):(Ke=Ie,c.renderDefaultSouthPole=Me!==0);const Be=Sa(A.mix),at=((Qe,At,Ye,je,ut,tt,vt,Dt,Gt,Pt,wt,dn,cn)=>If(Qe,At,Ye,new Float32Array(16),new Float32Array(9),[0,0],je,[0,0],[0,0,0,0],1,{opacity:1,mix:0},tt,[0,0],Dt,2,Pt,wt,dn,1,0,cn))(ve,Pe,Y,i.aj(c.transform.zoom),0,x,0,Me,0,Be,A.offset,A.range,w),Xe=c.getOrCreateProgram("raster",{defines:he});c.uploadCommonUniforms(J,Xe,null),Xe.draw(c,Q.TRIANGLES,me,O,ne,M,at,x.id,Ke,Ce,Te)}function kf(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),p=c-s,x=.2*m.height,w=s+x;return[s,c,(w-x-s)/p,(w-s)/p]}function ou(m,s,c,p){if(m)return s instanceof gl&&m instanceof Ou?s.getTextureDescriptor(m,c,!0):{texture:m.texture,mix:Sa(p.mix),offset:p.offset,buffer:0,tileSize:1}}var eg=i.ef([{name:"a_index",type:"Int16",components:1}]);class pd{constructor(s,c,p,x){const w={width:p[0],height:p[1],data:null},A=s.gl;this.targetColorTexture=new i.T(s,w,A.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(s,w,A.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const w=new i.eg;w.reserve(x);for(let A=0;A<x;A++)w.emplaceBack(A);this.particleIndexBuffer=this.context.createVertexBuffer(w,eg.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Vo(m,s,c){if(!m)return null;const p=s.getTextureDescriptor(m,c,!0);if(!p)return null;let{texture:x,mix:w,offset:A,tileSize:M,buffer:O,format:z}=p;if(!x||!z)return null;let B=!1;return z==="uint32"&&(B=!0,w[3]=0,w=qi(i.eh,w,[0,c.paint.get("raster-particle-max-speed")]),A=xa(i.eh,A,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[O/(M+2*O),M/(M+2*O)],tileSize:M,scalarData:B,scale:w,offset:A,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Rf(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),p=c-s,x=.2*m.height,w=s+x;return[s,c,(w-x-s)/p,(w-s)/p]}const Qr=new i.ao(1,0,0,1),El=new i.ao(0,1,0,1),qp=new i.ao(0,0,1,1),Of=new i.ao(1,0,1,1),md=new i.ao(0,1,1,1);function gd(m,s,c,p,x,w){for(let A=0;A<c.length;A++)if(x){const z=new i.ao(p.r*.8,p.g*.8,p.b*.8,1);Ta(m,s,c[A],p,-1,-1,w),Ta(m,s,c[A],p,-1,1,w),Ta(m,s,c[A],p,1,1,w),Ta(m,s,c[A],p,1,-1,w),Ta(m,s,c[A],z,0,0,w)}else Ta(m,s,c[A],p,0,0,w)}function Ta(m,s,c,p,x,w,A){const M=m.context,O=m.transform,z=M.gl,B=O.projection.name==="globe",G=B?["PROJECTION_GLOBE_VIEW"]:[];let V=i.bz(c.projMatrix);if(B&&i.aj(O.zoom)>0){const Be=i.bj(c.canonical,O),at=i.ei(Be);V=i.aB(new Float32Array(16),O.globeMatrix,at),i.aB(V,O.projMatrix,V)}const Y=i.bC();Y[12]+=2*x/(i.o.devicePixelRatio*O.width),Y[13]+=2*w/(i.o.devicePixelRatio*O.height),i.aB(V,Y,V);const J=m.getOrCreateProgram("debug",{defines:G}),Q=s.getTileByID(c.key);m.terrain&&m.terrain.setupElevationDraw(Q,J);const ce=Qt.disabled,ne=In.disabled,he=m.colorModeForRenderPass(),me="$debug";M.activeTexture.set(z.TEXTURE0),m.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),B?Q._makeGlobeTileDebugBuffers(m.context,O):Q._makeDebugTileBoundsBuffers(m.context,O.projection);const ve=Q._tileDebugBuffer||m.debugBuffer,Pe=Q._tileDebugIndexBuffer||m.debugIndexBuffer,Ae=Q._tileDebugSegments||m.debugSegments;if(J.draw(m,z.LINE_STRIP,ce,ne,he,Dn.disabled,Pf(V,p.toPremultipliedRenderColor(null)),me,ve,Pe,Ae,null,null,null,[Q._globeTileDebugBorderBuffer]),A){const Be=Q.latestRawTileData,at=Math.floor((Be&&Be.byteLength||0)/1024);let Xe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Xe+=` => ${c.overscaledZ}`),Xe+=` ${Q.state}`,Xe+=` ${at}kb`,(function(Qe,At){Qe.initDebugOverlayCanvas();const Ye=Qe.debugOverlayCanvas,je=Qe.context.gl,ut=Qe.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,Ye.width,Ye.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(At,5,5),ut.strokeText(At,5,5),Qe.debugOverlayTexture.update(Ye),Qe.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)})(m,Xe)}const Ie=s.getTile(c).tileSize,Ce=512/Math.min(Ie,512)*(c.overscaledZ/O.zoom)*.5,Te=Q._tileDebugTextBuffer||m.debugBuffer,Me=Q._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ke=Q._tileDebugTextSegments||m.debugSegments;J.draw(m,z.TRIANGLES,ce,ne,Gn.alphaBlended,Dn.disabled,Pf(V,i.ao.transparent.toPremultipliedRenderColor(null),Ce),me,Te,Me,Ke,null,null,null,[Q._globeTileDebugTextBuffer])}function Ai(m,s,c,p){rs(m,0,s+c/2,m.transform.width,c,p)}function wr(m,s,c,p){rs(m,s-c/2,0,c,m.transform.height,p)}function rs(m,s,c,p,x,w){const A=m.context,M=A.gl;M.enable(M.SCISSOR_TEST),M.scissor(s*i.o.devicePixelRatio,c*i.o.devicePixelRatio,p*i.o.devicePixelRatio,x*i.o.devicePixelRatio),A.clear({color:w}),M.disable(M.SCISSOR_TEST)}const _d=i.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yd}=_d;function Ea(m,s,c,p){m.emplaceBack(s,c,p)}class tg{constructor(s){this.vertexArray=new i.ej,this.indices=new i.b1,Ea(this.vertexArray,-1,-1,1),Ea(this.vertexArray,1,-1,1),Ea(this.vertexArray,-1,1,1),Ea(this.vertexArray,1,1,1),Ea(this.vertexArray,-1,-1,-1),Ea(this.vertexArray,1,-1,-1),Ea(this.vertexArray,-1,1,-1),Ea(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,yd),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function ms(m,s,c,p,x,w){const A=m.context.gl,M=s.paint.get("sky-atmosphere-color"),O=s.paint.get("sky-atmosphere-halo-color"),z=s.paint.get("sky-atmosphere-sun-intensity"),B=((G,V,Y,J,Q)=>({u_matrix_3f:G,u_sun_direction:V,u_sun_intensity:Y,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(i.el(i.dL(),p),x,z,M.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+w,s.skyboxTexture,0),c.draw(m,A.TRIANGLES,Qt.disabled,In.disabled,Gn.unblended,Dn.frontCW,B,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Tc=i.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ec{constructor(s){const c=new i.em;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new i.b1;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,Tc.members),this.indexBuffer=s.createIndexBuffer(p),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const kt=i.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class $t{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class co{constructor(s){this.colorModeAlphaBlendedWriteRGB=new Gn([1,zo,1,zo],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Gn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new $t,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ec(c);const p=this.params.sizeRange,x=this.params.intensityRange,w=(function(B){const G=i.eo(30),V=[];for(let Y=0;Y<B;++Y){const J=2*Math.PI*G(),Q=Math.acos(1-2*G())-.5*Math.PI;V.push(i.d4(Math.cos(Q)*Math.cos(J),Math.cos(Q)*Math.sin(J),Math.sin(Q)))}return V})(this.params.starsCount),A=i.eo(300),M=new i.en,O=new i.b1;let z=0;for(let B=0;B<w.length;++B){const G=i.c4([],w[B],200),V=Math.max(0,1+.01*p*(1*A()-.5)),Y=Math.max(0,1+.01*x*(1*A()-.5));M.emplaceBack(G[0],G[1],G[2],-1,-1,V,Y),M.emplaceBack(G[0],G[1],G[2],1,-1,V,Y),M.emplaceBack(G[0],G[1],G[2],1,1,V,Y),M.emplaceBack(G[0],G[1],G[2],-1,1,V,Y),O.emplaceBack(z+0,z+1,z+2),O.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=c.createVertexBuffer(M,kt.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=i.bg.simpleSegment(0,0,M.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const p=s.context,x=p.gl,w=s.transform,A=new Qt(x.LEQUAL,Qt.ReadOnly,[0,1]),M=i.aj(w.zoom),O=s.style.getLut(c.scope),z=c.properties.get("color-use-theme")==="none",B=c.properties.get("color").toNonPremultipliedRenderColor(z?null:O),G=c.properties.get("high-color-use-theme")==="none",V=c.properties.get("high-color").toNonPremultipliedRenderColor(G?null:O),Y=c.properties.get("space-color-use-theme")==="none",J=c.properties.get("space-color").toNonPremultipliedRenderColor(Y?null:O),Q=5e-4,ce=i.ep(c.properties.get("horizon-blend"),0,1,Q,.25),ne=i.dA(s,p,w)&&ce===Q?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,he=s.frameCounter/1e3%1,me=i.ag(w.globeCenterInViewSpace),ve=Math.sqrt(Math.pow(me,2)-Math.pow(ne,2)),Pe=Math.acos(ve/me),Ae=Ie=>{const Ce=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ie&&Ce.push("ALPHA_PASS");const Te=s.getOrCreateProgram("globeAtmosphere",{defines:Ce}),Me=((Be,at,Xe,Qe,At,Ye,je,ut,tt,vt,Dt,Gt)=>({u_frustum_tl:Be,u_frustum_tr:at,u_frustum_br:Xe,u_frustum_bl:Qe,u_horizon:At,u_transition:Ye,u_fadeout_range:je,u_atmosphere_fog_color:ut.toArray01(),u_high_color:tt.toArray01(),u_space_color:vt.toArray01(),u_temporal_offset:Dt,u_horizon_angle:Gt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,M,ce,B,V,J,he,Pe);s.uploadCommonUniforms(p,Te);const Ke=this.atmosphereBuffer;Ke&&Te.draw(s,x.TRIANGLES,A,In.disabled,Ie?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Dn.backCW,Me,Ie?"atmosphere_glow_alpha":"atmosphere_glow",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)};Ae(!1),Ae(!0)}drawStars(s,c){const p=i.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=s.context,w=x.gl,A=s.transform,M=s.getOrCreateProgram("stars"),O=i.c6([]);i.c8(O,O,-A._pitch),i.c7(O,O,-A.angle),i.c8(O,O,i.an(A._center.lat)),i.eq(O,O,-i.an(A._center.lng));const z=i.cb(new Float32Array(16),O),B=i.aB([],A.starsProjMatrix,z),G=i.el([],z),V=i.er([],G),Y=[0,1,0];i.dN(Y,Y,V),i.c4(Y,Y,this.params.sizeMultiplier);const J=[1,0,0];i.dN(J,J,V),i.c4(J,J,this.params.sizeMultiplier);const Q=(ce=Y,ne=J,he=p,{u_matrix:Float32Array.from(B),u_up:ce,u_right:ne,u_intensity_multiplier:he});var ce,ne,he;s.uploadCommonUniforms(x,M),this.starsVx&&this.starsIdx&&M.draw(s,w.TRIANGLES,Qt.disabled,In.disabled,this.colorModeAlphaBlendedWriteRGB,Dn.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class di{constructor(){this.visibleTiles=[]}updateBorders(s,c){const p=[],x=[],w=s._getRenderableCoordinates(!1,!0);for(const O of w){const z=s.getTile(O);if(!z.hasData())continue;const B=z.getBucket(c);B&&(B.isEmpty()||(p.push(O.key),x.push({bucket:B,tileID:O.canonical})))}let A=p.length!==this.visibleTiles.length;if(!A){p.sort();for(let O=0;O<p.length;O++)if(p[O]!==this.visibleTiles[O]){A=!0;break}}if(!A)return;const M=new Set;this.visibleTiles=p,x.sort(((O,z)=>O.tileID.z-z.tileID.z||O.tileID.x-z.tileID.x||O.tileID.y-z.tileID.y));for(const O of x){const z=new Array,B=new Array,G=O.bucket;for(const V of G.featuresOnBorder)M.has(V.featureId)?B.push(V.footprintIndex):(M.add(V.featureId),z.push(V.footprintIndex));G.updateFootprintHiddenFlags(z,i.es,!1),G.updateFootprintHiddenFlags(B,i.es,!0)}}}function He(m,s){const c=[...m],p=s.cameraWorldSizeForFog/s.worldSize,x=i.bA([]);return i.cR(x,x,[p,p,1]),i.aB(c,x,c),i.aB(c,s.worldToFogMatrix,c),c}function vd(m,s,c,p,x){const w=c.material,A=p.context,{baseColorTexture:M,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:B,emissionTexture:G}=w;function V(J,Q,ce){if(J&&(m.push(Q),A.activeTexture.set(A.gl.TEXTURE0+ce),J.gfxTexture)){const{minFilter:ne,magFilter:he,wrapS:me,wrapT:ve}=J.sampler;J.gfxTexture.bindExtraParam(ne,he,me,ve)}}V(M,"HAS_TEXTURE_u_baseColorTexture",Hi.BaseColor),V(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Hi.MetallicRoughness),V(z,"HAS_TEXTURE_u_normalTexture",Hi.Normal),V(B,"HAS_TEXTURE_u_occlusionTexture",Hi.Occlusion),V(G,"HAS_TEXTURE_u_emissionTexture",Hi.Emission),x&&(x.texture||(x.texture=new i.dY(p.context,x.image,[x.image.height,x.image.height,x.image.height],A.gl.RGBA8)),A.activeTexture.set(A.gl.TEXTURE0+Hi.LUT),x.texture&&x.texture.bind(A.gl.LINEAR,A.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(m.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||m.push("DIFFUSE_SHADED");const Y=p.shadowRenderer;Y&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&m.push("NORMAL_OFFSET"))}function au(m,s,c,p,x,w){const A=c.paint.get("model-opacity").constantOr(1),M=s.context,O=new Qt(s.context.gl.LEQUAL,Qt.ReadWrite,s.depthRangeFor3D),z=s.transform,B=m.mesh,G=B.material,V=G.pbrMetallicRoughness,Y=s.style.fog;let J;J=s.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:i.aB([],p.zScaleMatrix,m.nodeModelMatrix),i.aB(J,p.negCameraPosMatrix,J);const Q=i.bl([],J);i.ed(Q,Q);const ce=c.paint.get("model-color-use-theme").constantOr("default")==="none",ne=c.paint.get("model-emissive-strength").constantOr(0),he=th(new Float32Array(m.worldViewProjection),new Float32Array(J),new Float32Array(Q),null,s,A,V.baseColorFactor,G.emissiveFactor,V.metallicFactor,V.roughnessFactor,G,ne,c),me={defines:[]},ve=[],Pe=s.shadowRenderer;Pe&&(Pe.useNormalOffset=!1),vd(me.defines,ve,B,s,ce?null:c.lut);let Ae=null;if(Y){const Te=He(m.nodeModelMatrix,s.transform);if(Ae=new Float32Array(Te),z.projection.name!=="globe"){const Me=B.aabb.min,Ke=B.aabb.max,[Be,at]=Y.getOpacityForBounds(Te,Me[0],Me[1],Ke[0],Ke[1]);me.overrideFog=Be>=gn||at>=gn}}const Ie=Xc(s,c.paint.get("model-cutoff-fade-range"));Ie.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Ce=s.getOrCreateProgram("model",me);s.uploadCommonUniforms(M,Ce,null,Ae,Ie),s.renderPass!=="shadow"&&Pe&&Pe.setupShadowsFromMatrix(m.nodeModelMatrix,Ce),Ce.draw(s,M.gl.TRIANGLES,O,x,w,B.material.doubleSided?Dn.disabled:Dn.backCCW,he,c.id,B.vertexBuffer,B.indexBuffer,B.segments,c.paint,s.transform.zoom,void 0,ve)}function Df(m,s,c,p,x,w,A){let M;M=m.projection.name==="globe"?i.eu(c,m):[...c],i.aB(M,M,s.matrix);const O=i.aB([],p,M);if(s.meshes)for(const z of s.meshes){if(z.material.alphaMode!=="BLEND"){A.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:O,nodeModelMatrix:M});continue}const B=i.af([],z.centroid,O);!m.isOrthographic&&B[2]<=0||w.push({mesh:z,depth:B[2],modelIndex:x,worldViewProjection:O,nodeModelMatrix:M})}if(s.children)for(const z of s.children)Df(m,z,c,p,x,w,A)}function xd(m,s,c,p){const x=c.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),A=x.getShadowPassColorMode(),M=x.calculateShadowPassMatrixFromMatrix(s),O=nh(M);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,In.disabled,A,Dn.backCCW,O,p.id,m.vertexBuffer,m.indexBuffer,m.segments,p.paint,c.transform.zoom,void 0,void 0)}function ng(m,s,c){const p=s.updateZoomBasedPaintProperties(),x=(function(w,A,M){let O,z,B,G=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&G>0){const V=w.terrain,Y=V.findDEMTileFor(M);Y&&Y.dem?O=i.ew.create(V,M,Y):G=0}if(G===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),G===A.validForExaggeration&&(G===0||O&&O._demTile&&O._demTile.tileID===A.validForDEMTile.id&&O._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const V in A.instancesPerModel){const Y=A.instancesPerModel[V];for(let J=0;J<Y.instancedDataArray.length;++J){const Q=(O?G*O.getElevationAt(0|Y.instancedDataArray.float32[16*J],0|Y.instancedDataArray.float32[16*J+1],!0,!0):0)+Y.instancesEvaluatedElevation[J];Y.instancedDataArray.float32[16*J+6]=Q,z=z?Math.min(A.terrainElevationMin,Q):Q,B=B?Math.max(A.terrainElevationMax,Q):Q}}return A.terrainElevationMin=z||0,A.terrainElevationMax=B||0,A.validForExaggeration=G,A.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0})(m,s,c);(p||x)&&(s.uploaded=!1,s.upload(m.context))}const tl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function sh(m,s){const c=1<<m.canonical.z,p=s.getFreeCameraOptions().position,x=s.elevation,w=m.canonical.x/c,A=(m.canonical.x+1)/c,M=m.canonical.y/c,O=(m.canonical.y+1)/c;let z=s._centerAltitude;if(x){const Y=x.getMinMaxForTile(m);Y&&Y.max>z&&(z=Y.max)}const B=i.aA(p.x,w,A)-p.x,G=i.aA(p.y,M,O)-p.y,V=i.ce(z,s.center.lat)-p.z;return s._zoomFromMercatorZ(Math.sqrt(B*B+G*G+V*V))}function rg(m,s,c,p,x,w,A){const M=m.context,O=m.renderPass==="shadow",z=m.shadowRenderer,B=O&&z?z.getShadowPassDepthMode():new Qt(M.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D),G=m.isTileAffectedByFog(w);if(c.meshes)for(const V of c.meshes){const Y=["MODEL_POSITION_ON_GPU"],J=[];let Q,ce,ne;p.instancedDataArray.length>20&&Y.push("INSTANCED_ARRAYS");const he=Xc(m,s.paint.get("model-cutoff-fade-range"));if(he.shouldRenderCutoff&&Y.push("RENDER_CUTOFF"),O&&z)Q=m.getOrCreateProgram("modelDepth",{defines:Y}),ce=nh(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(c.matrix)),ne=z.getShadowPassColorMode();else{vd(Y,J,V,m,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),Q=m.getOrCreateProgram("model",{defines:Y,overrideFog:G});const ve=V.material,Pe=ve.pbrMetallicRoughness,Ae=s.paint.get("model-opacity").constantOr(1),Ie=s.paint.get("model-emissive-strength").constantOr(0);ce=th(w.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,m,Ae,Pe.baseColorFactor,ve.emissiveFactor,Pe.metallicFactor,Pe.roughnessFactor,ve,Ie,s,x),z&&(A.shadowUniformsInitialized?Q.setShadowUniformValues(M,z.getShadowUniformValues()):(z.setupShadows(w.toUnwrapped(),Q,"model-tile"),A.shadowUniformsInitialized=!0)),ne=he.shouldRenderCutoff||Ae<1||ve.alphaMode!=="OPAQUE"?Gn.alphaBlended:Gn.unblended}m.uploadCommonUniforms(M,Q,w.toUnwrapped(),null,he);const me=V.material.doubleSided?Dn.disabled:Dn.backCCW;if(p.instancedDataArray.length>20)J.push(p.instancedDataBuffer),Q.draw(m,M.gl.TRIANGLES,B,In.disabled,ne,me,ce,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,m.transform.zoom,void 0,J,p.instancedDataArray.length);else{const ve=O?"u_instance":"u_normal_matrix";for(let Pe=0;Pe<p.instancedDataArray.length;++Pe)ce[ve]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Pe,16),Q.draw(m,M.gl.TRIANGLES,B,In.disabled,ne,me,ce,s.id,V.vertexBuffer,V.indexBuffer,V.segments,s.paint,m.transform.zoom,void 0,J)}}if(c.children)for(const V of c.children)rg(m,s,V,p,x,w,A)}const P_=[1,-1,1];function bd(m,s,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,A=s.aabb;let M=!0,O=m.maxHeight;if(O===0){let B=0;for(const G in m.instancesPerModel){const V=x.getModel(G,p);V?B=Math.max(B,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):M=!1}O=m.maxScale*B*1.41+m.maxVerticalOffset,M&&(m.maxHeight=O)}A.max[2]=O,A.min[2]+=m.terrainElevationMin,A.max[2]+=m.terrainElevationMax,i.af(A.min,A.min,s.tileMatrix),i.af(A.max,A.max,s.tileMatrix);const z=A.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=z===2),z===0}function Lf(m,s){const c=m.uniformValues.u_cutoff_params[0],p=m.uniformValues.u_cutoff_params[1],x=m.uniformValues.u_cutoff_params[2],w=m.uniformValues.u_cutoff_params[3];return p===c||w===x?1:i.aA(((s-c)/(p-c)-x)/(w-x),0,1)}function wd(m,s,c,p){if(s.pitch<20)return 1;const x=s.getWorldToCameraMatrix();i.aB(x,x,m);const w=i.bU(c.min[0],c.min[1],c.min[2],1);let A=i.aC(i.ex(),w,x),M=A,O=A;w[1]=c.max[1],A=i.aC(i.ex(),w,x),M=A[1]<M[1]?A:M,O=A[1]>O[1]?A:O,w[0]=c.max[0],A=i.aC(i.ex(),w,x),M=A[1]<M[1]?A:M,O=A[1]>O[1]?A:O,w[1]=c.min[1],A=i.aC(i.ex(),w,x),M=A[1]<M[1]?A:M,O=A[1]>O[1]?A:O;const z=i.aA(p[0],0,1),B=100*s.pixelsPerMeter*i.aA(p[1],0,1),G=i.aA(p[2],0,1),V=i.ey(i.ex(),M,O,z),Y=Math.tan(.5*s.fovX),J=-V[2]*Y;if(B===0)return V[1]<-Math.abs(J)?G:1;const Q=(-Math.abs(J)-V[1])/B,ce=(he,me,ve)=>(1-ve)*he+ve*me,ne=i.aA(ce(1,G,Q),G,1);return ce(1,ne,i.aA((s.pitch-20)/20,0,1))}class jf{}class ig{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,p){{const G=this._storage.get(c.id);if(G)return G.lastUsedFrameIdx=s,G.buf}const x=p.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),A=new ArrayBuffer(w),M=new Int16Array(A);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const O=new i.eA;for(let G=0;G<w/2;G+=3){const V=M[G],Y=M[G+1],J=M[G+2];O.emplaceBack(V,Y),O.emplaceBack(Y,J),O.emplaceBack(J,V)}const z=p.bindVertexArrayOES.current,B=new jf;return B.buf=new ba(p,O),B.lastUsedFrameIdx=s,this._storage.set(c.id,B),p.bindVertexArrayOES.set(z),B.buf}update(s){for(const[c,p]of this._storage)s-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class Sd{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Td=i.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class oh{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Zp{constructor(s,c){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const sg=i.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class og{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,c){const p=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const A=new i.eB,M=new i.b1;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(A,sg.members),this.vignetteIdx=s.context.createIndexBuffer(M)}const x=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,p);const A={u_vignetteShape:(w={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};p.draw(s,s.context.gl.TRIANGLES,Qt.disabled,In.disabled,Gn.alphaBlended,Dn.disabled,A,"vignette",this.vignetteVx,this.vignetteIdx,x)}var w}}class ag{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,c){const p=s.getFreeCameraOptions().position,x=p.toAltitude(),w=p.toLngLat(),A=i.an(w.lng),M=i.an(w.lat),O=s.pixelsPerMeter/c,z=A*i.eD,B=i.eD*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const G=-this._offsetYPrev+B,V=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*O,this._accumulatedOffsetY+=G*O,this._accumulatedElevation+=V*O,this._offsetXPrev=z,this._offsetYPrev=B,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function lg(m,s){return[-(m[0]-Math.floor(m[0]/s)*s),-(m[1]-Math.floor(m[1]/s)*s),-(m[2]-Math.floor(m[2]/s)*s)]}function Ws(m){const s=i.eo(1323123451230),c=[];for(let p=0;p<m;++p){const x=2*s()-1,w=2*s()-1,A=2*s()-1;c.push(i.d4(x,w,A))}return c}function lu(m,s,c,p,x){const w=i.aA((x-c)/(p-c),0,1);return(1-w)*m+w*s}class ah{constructor(s){this._movement=new ag,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new og,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,c){const p=s.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,w=i.c6([]);i.c8(w,w,i.an(90)-p._pitch),i.c7(w,w,-p.angle);const A=i.cb(new Float32Array(16),w),M=i.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=i.ed([],M),z=i.aB([],O,A),B=Date.now()/1e3;return this._accumulatedTimeFromStart+=(B-this._prevTime)*c,this._prevTime=B,{projectionMatrix:x,modelviewMatrix:z}}}class oi extends ah{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Zp(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const p=Ws(this.particlesCount),x=new i.eE,w=new i.b1;let A=0;const M=i.eo(1323123451230);for(let O=0;O<p.length;++O){const z=p[O],B=[2*M()-1,M(),M(),M()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...B),x.emplaceBack(z[0],z[1],z[2],1,-1,...B),x.emplaceBack(z[0],z[1],z[2],1,1,...B),x.emplaceBack(z[0],z[1],z[2],-1,1,...B),w.emplaceBack(A+0,A+1,A+2),w.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=c.createVertexBuffer(x,Td.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=s.transform.zoom;if(c.revealStart>p)return;const x=lu(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let A=[-w.direction.x,w.direction.y,-100];i.aw(A,A);const M=structuredClone(this._vignetteParams);M.strength*=x,w.overrideStyleParameters||(w.intensity=s.style.rain.state.density,w.timeFactor=s.style.rain.state.intensity,w.color=structuredClone(s.style.rain.state.color),A=structuredClone(s.style.rain.state.direction),w.screenThinning.intensity=s.style.rain.state.centerThinning,w.dropletSizeX=s.style.rain.state.dropletSize[0],w.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],w.distortionStrength=100*s.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(s.style.rain.state.vignetteColor));const O=this.updateOnRender(s,w.timeFactor),z=s.context,B=z.gl,G=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new i.T(z,{width:s.width,height:s.height,data:null},B.RGBA8)),w.distortionStrength>0&&(z.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.copyTexSubImage2D(B.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const V=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(z,V),z.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Y=[w.color.r,w.color.g,w.color.b,w.color.a],J=(Q,ce)=>{const ne=lg(this._movement.getPosition(),Q),he=w.dropletSizeX,me=w.dropletSizeX*w.dropletSizeYScale,ve=s.width/2,Pe=s.height/2,Ae=lu(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Ie=lu(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),Ce=lu(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),Te=(Me={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:Q,rainDropletSize:[he,me],distortionStrength:w.distortionStrength,rainDirection:A,color:Y,screenSize:[G.width,G.height],thinningCenterPos:[ve,Pe],thinningShape:[Ae,Ie,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:Ce,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:ce?0:1},{u_modelview:Float32Array.from(Me.modelview),u_projection:Float32Array.from(Me.projection),u_time:Me.time,u_cam_pos:Me.camPos,u_texScreen:0,u_velocityConeAperture:Me.velocityConeAperture,u_velocity:Me.velocity,u_boxSize:Me.boxSize,u_rainDropletSize:Me.rainDropletSize,u_distortionStrength:Me.distortionStrength,u_rainDirection:Me.rainDirection,u_color:Me.color,u_screenSize:Me.screenSize,u_thinningCenterPos:Me.thinningCenterPos,u_thinningShape:Me.thinningShape,u_thinningAffectedRatio:Me.thinningAffectedRatio,u_thinningParticleOffset:Me.thinningParticleOffset,u_shapeDirectionalPower:Me.shapeDirectionalPower,u_shapeNormalPower:Me.shapeNormalPower,u_mode:Me.mode});var Me;const Ke=Math.round(w.intensity*this.particlesCount),Be=i.bg.simpleSegment(0,0,4*Ke,2*Ke);V.draw(s,B.TRIANGLES,Qt.disabled,In.disabled,Gn.alphaBlended,Dn.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Be)};w.distortionStrength>0&&J(w.boxSize,!0),J(w.boxSize,!1),this._vignette.draw(s,M)}}const vr=i.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class cg extends ah{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Zp(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const p=Ws(this.particlesCount),x=new i.eF,w=new i.b1;let A=0;const M=i.eo(1323123451230);for(let O=0;O<p.length;++O){const z=p[O],B=M(),G=M(),V=M(),Y=[O/p.length,B,G,V],J=[M(),M()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...Y,...J),x.emplaceBack(z[0],z[1],z[2],1,-1,...Y,...J),x.emplaceBack(z[0],z[1],z[2],1,1,...Y,...J),x.emplaceBack(z[0],z[1],z[2],-1,1,...Y,...J),w.emplaceBack(A+0,A+1,A+2),w.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=c.createVertexBuffer(x,vr.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];i.aw(p,p);const x=structuredClone(this._vignetteParams),w=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},A=s.transform.zoom;if(w.revealStart>A)return;const M=lu(0,1,w.revealStart,w.revealStart+w.revealRange,A);x.strength*=M,c.overrideStyleParameters||(c.intensity=s.style.snow.state.density,c.timeFactor=s.style.snow.state.intensity,c.color=structuredClone(s.style.snow.state.color),p=structuredClone(s.style.snow.state.direction),c.screenThinning.intensity=s.style.snow.state.centerThinning,c.billboardSize=2.79*s.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(s.style.snow.state.vignetteColor));const O=this.updateOnRender(s,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=s.context,B=z.gl,G=s.transform,V=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(z,V),((Y,J,Q)=>{const ce=lg(this._movement.getPosition(),Y),ne=G.width/2,he=G.height/2,me=lu(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),ve=lu(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),Pe=lu(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),Ae=(Ie={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ce,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:Y,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[G.width,G.height],thinningCenterPos:[ne,he],thinningShape:[me,ve,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:Pe,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:p},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_horizontalOscillationRadius:Ie.horizontalOscillationRadius,u_horizontalOscillationRate:Ie.horizontalOscillationRate,u_boxSize:Ie.boxSize,u_billboardSize:Ie.billboardSize,u_simpleShapeParameters:Ie.simpleShapeParameters,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_particleColor:Ie.color,u_direction:Ie.direction});var Ie;const Ce=Math.round(Q.intensity*this.particlesCount),Te=i.bg.simpleSegment(0,0,4*Ce,2*Ce);this.particlesVx&&this.particlesIdx&&V.draw(s,B.TRIANGLES,Qt.disabled,In.disabled,Gn.alphaBlended,Dn.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(c.boxSize,0,c),this._vignette.draw(s,x)}}const Ac={symbol:function(m,s,c,p,x){if(m.renderPass!=="translucent")return;const w=In.disabled,A=m.colorModeForRenderPass(),M=c.layout.get("text-variable-anchor"),O=c.layout.get("text-size-scale-range"),z=i.aA(m.scaleFactor,O[0],O[1]);M&&(function(V,Y,J,Q,ce,ne,he,me){const ve=Y.transform,Pe=ce==="map",Ae=ne==="map";for(const Ie of V){const Ce=Q.getTile(Ie),Te=Ce.getBucket(J);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const Me=i.bK(Te.textSizeData,ve.zoom,me),Ke=Du(Ie,Te.getProjection(),ve),Be=ve.calculatePixelsToTileUnitsMatrix(Ce),at=Va(Ke,Ce.tileID.canonical,Ae,Pe,ve,Te.getProjection(),Be),Xe=Te.hasIconTextFit()&&Te.hasIconData();Me&&Fo(Te,Pe,Ae,he,ve,at,Ie,Math.pow(2,ve.zoom-Ce.tileID.overscaledZ),Me,Xe)}})(p,m,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,z);const B=c.paint.get("icon-opacity").constantOr(1)!==0,G=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(B||G)?Sl(m,s,c,p,w,A):(B&&Sl(m,s,c,p,w,A,{onlyIcons:!0}),G&&Sl(m,s,c,p,w,A,{onlyText:!0})),s.map.showCollisionBoxes&&(ih(m,s,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ih(m,s,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,c,p){if(m.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0,O=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||A.constantOr(1)===0))return;const z=m.context,B=z.gl,G=m.transform,V=!(!m.terrain||!m.terrain.enabled),Y=c.layout.get("circle-elevation-reference"),J=m.depthModeForSublayer(0,Qt.ReadOnly),Q=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D),ce=Y==="none"||V?J:Q,ne=In.disabled,he=m.colorModeForDrapableLayerRenderPass(O),me=G.projection.name==="globe",ve=[i.aF(G.center.lng),i.aJ(G.center.lat)],Pe=[];for(let Ie=0;Ie<p.length;Ie++){const Ce=p[Ie],Te=s.getTile(Ce),Me=Te.getBucket(c);if(!Me||Me.projection.name!==G.projection.name)continue;const Ke=Me.programConfigurations.get(c.id),Be=Me.layoutVertexBuffer,at=Me.globeExtVertexBuffer,Xe=Me.indexBuffer,Qe=i.dZ(c),At=[at],Ye=m.isTileAffectedByFog(Ce);me&&Qe.push("PROJECTION_GLOBE_VIEW"),Qe.push("DEPTH_D24"),m.terrain&&G.depthOcclusionForSymbolsAndCircles&&Qe.push("DEPTH_OCCLUSION"),Me.hasElevation&&!m.terrain&&(Qe.push("ELEVATED_ROADS"),At.push(Me.elevatedLayoutVertexBuffer));const je=m.getOrCreateProgram("circle",{config:Ke,defines:Qe,overrideFog:Ye}),ut=G.projection.createInversionMatrix(G,Ce.canonical),tt={programConfiguration:Ke,program:je,layoutVertexBuffer:Be,dynamicBuffers:At,indexBuffer:Xe,uniformValues:i.d_(m,Ce,Te,ut,ve,c),tile:Te};if(M){const vt=Me.segments.get();for(const Dt of vt)Pe.push({segments:new i.bg([Dt]),sortKey:Dt.sortKey,state:tt})}else Pe.push({segments:Me.segments,sortKey:0,state:tt})}M&&Pe.sort(((Ie,Ce)=>Ie.sortKey-Ce.sortKey));const Ae={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const Ie of Pe){const{programConfiguration:Ce,program:Te,layoutVertexBuffer:Me,dynamicBuffers:Ke,indexBuffer:Be,uniformValues:at,tile:Xe}=Ie.state,Qe=Ie.segments;m.terrain&&m.terrain.setupElevationDraw(Xe,Te,Ae),m.uploadCommonUniforms(z,Te,Xe.tileID.toUnwrapped()),Te.draw(m,B.TRIANGLES,ce,ne,he,Dn.disabled,at,c.id,Me,Be,Qe,c.paint,G.zoom,Ce,Ke)}},heatmap:function(m,s,c,p){if(c.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,w=x.gl,A=In.disabled,M=new Gn([w.ONE,w.ONE,w.ONE,w.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(Y,J,Q,ce){const ne=Y.gl,he=J.width*ce,me=J.height*ce;Y.activeTexture.set(ne.TEXTURE1),Y.viewport.set([0,0,he,me]);let ve=Q.heatmapFbo;if(!ve||ve&&(ve.width!==he||ve.height!==me)){ve&&ve.destroy();const Pe=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,Pe),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),ve=Q.heatmapFbo=Y.createFramebuffer(he,me,!0,null),(function(Ae,Ie,Ce,Te,Me,Ke){const Be=Ae.gl;Be.texImage2D(Be.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Me,Ke,0,Be.RGBA,Ae.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),Te.colorAttachment.set(Ce)})(Y,0,Pe,ve,he,me)}else ne.bindTexture(ne.TEXTURE_2D,ve.colorAttachment.get()),Y.bindFramebuffer.set(ve.framebuffer)})(x,m,c,m.transform.projection.name==="globe"?.5:.25),x.clear({color:i.ao.transparent});const O=m.transform,z=O.projection.name==="globe",B=z?["PROJECTION_GLOBE_VIEW"]:[],G=z?Dn.frontCCW:Dn.disabled,V=[i.aF(O.center.lng),i.aJ(O.center.lat)];for(let Y=0;Y<p.length;Y++){const J=p[Y];if(s.hasRenderableParent(J))continue;const Q=s.getTile(J),ce=Q.getBucket(c);if(!ce||ce.projection.name!==O.projection.name)continue;const ne=m.isTileAffectedByFog(J),he=ce.programConfigurations.get(c.id),me=m.getOrCreateProgram("heatmap",{config:he,defines:B,overrideFog:ne}),{zoom:ve}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Q,me),m.uploadCommonUniforms(x,me,J.toUnwrapped());const Pe=O.projection.createInversionMatrix(O,J.canonical);me.draw(m,w.TRIANGLES,Qt.disabled,A,M,G,na(m,J,Q,Pe,V,ve,c.paint.get("heatmap-intensity")),c.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,c.paint,m.transform.zoom,he,z?[ce.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),(function(x,w){const A=x.context,M=A.gl,O=w.heatmapFbo;if(!O)return;A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.colorAttachment.get()),A.activeTexture.set(M.TEXTURE1);let z=w.colorRampTexture;z||(z=w.colorRampTexture=new i.T(A,w.colorRamp,M.RGBA8)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,M.TRIANGLES,Qt.disabled,In.disabled,x.colorModeForRenderPass(),Dn.disabled,((B,G,V,Y)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)})(m,c))},line:function(m,s,c,p){if(m.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const A=c.paint.get("line-emissive-strength"),M=c.paint.get("line-occlusion-opacity"),O=c.layout.get("line-elevation-reference"),z=c.layout.get("line-width-unit")==="meters",B=O==="sea",G=!(!m.terrain||!m.terrain.enabled),V=m.context,Y=V.gl;if(c.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const J=c.layout.get("line-cross-slope"),Q=J!==void 0,ce=J<1,ne=m.colorModeForDrapableLayerRenderPass(A),he=m.terrain&&m.terrain.renderingToTexture,me=he?1:i.o.devicePixelRatio,ve=c.paint.get("line-dasharray"),Pe=ve.constantOr(1),Ae=c.layout.get("line-cap"),Ie=ve.constantOr(null),Ce=Ae.constantOr(null),Te=c.paint.get("line-pattern"),Me=Te.constantOr(1),Ke=c.paint.get("line-pattern-cross-fade"),Be=Te.constantOr(null),at=c.paint.get("line-opacity").constantOr(1);let Xe=!Me&&at!==1||m.depthOcclusion&&M>0&&M<1;const Qe=c.paint.get("line-gradient"),At=Me?"linePattern":"line",Ye=i.d$(c);let je;if(he&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),M!==0&&m.depthOcclusion){const Dt=c.paint._values["line-opacity"];Dt&&Dt.value&&Dt.value.kind==="constant"?je=Dt.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&Ye.push("VARIABLE_LINE_WIDTH");const ut=(Dt,Gt,Pt,wt,dn,cn)=>{for(const ln of Dt){const un=s.getTile(ln);if(Me&&!un.patternsLoaded())continue;const jn=un.getBucket(c);if(!jn||jn.elevationType!=="none"&&!dn||jn.elevationType==="none"&&dn)continue;m.prepareDrawTile();const Un=[...Gt],Wn=m.shadowRenderer,Fr=jn.elevationType==="road"&&!!Wn&&Wn.enabled;let Bn=[0,0,0];if(Fr){const Yn=m.style.directionalLight,Mn=m.style.ambientLight;Yn&&Mn&&(Bn=Ha(m.style,Yn,Mn)),Un.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ar=jn.programConfigurations.get(c.id);let Lr=!1;if(Be&&un.imageAtlas){const Yn=i.e0.from(Be),Mn=Yn.getPrimary().scaleSelf(me).toString(),Br=un.imageAtlas.patternPositions.get(Mn),Gr=Yn.getSecondary(),ai=Gr?un.imageAtlas.patternPositions.get(Gr.scaleSelf(me).toString()):null;Lr=!!Br&&!!ai,Br&&Ar.setConstantPatternPositions(Br,ai)}Ke>0&&(Lr||Ar.getPatternTransitionVertexBuffer("line-pattern"))&&Un.push("LINE_PATTERN_TRANSITION");const Hr=m.isTileAffectedByFog(ln),Xn=m.getOrCreateProgram(At,{config:Ar,defines:Un,overrideFog:Hr});if(!Me&&Ie&&Ce&&un.lineAtlas){const Yn=un.lineAtlas.getDash(Ie,Ce);Yn&&Ar.setConstantPatternPositions(Yn)}Fr&&Wn.setupShadows(un.tileID.toUnwrapped(),Xn,"vector-tile");let[Sr,Mr]=c.paint.get("line-trim-offset");(Ce==="round"||Ce==="square")&&Sr!==Mr&&(Sr===0&&(Sr-=1),Mr===1&&(Mr+=1));const tr=he?ln.projMatrix:null,fi=z?1/jn.tileToMeter/i.ay(un,1,m.transform.zoom):1,Di=z?1/jn.tileToMeter/i.ay(un,1,Math.floor(m.transform.zoom)):1,gs=Me?i.e1(m,un,c,tr,me,fi,Di,[Sr,Mr],Bn,Ke):i.e2(m,un,c,tr,jn.lineClipsArray.length,me,fi,Di,[Sr,Mr],Bn);if(Qe){const Yn=jn.gradients[c.id];let Mn=Yn.texture;if(c.gradientVersion!==Yn.version){let Br=256;if(c.stepInterpolant){const Gr=s.getSource().maxzoom,ai=ln.canonical.z===Gr?Math.ceil(1<<m.transform.maxZoom-ln.canonical.z):1;Br=i.aA(i.e3(jn.maxLineLength/i.al*1024*ai),256,V.maxTextureSize)}Yn.gradient=i.e4({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Br,image:Yn.gradient||void 0,clips:jn.lineClipsArray}),Yn.texture?Yn.texture.update(Yn.gradient):Yn.texture=new i.T(V,Yn.gradient,Y.RGBA8),Yn.version=c.gradientVersion,Mn=Yn.texture}V.activeTexture.set(Y.TEXTURE1),Mn.bind(c.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}Pe&&(V.activeTexture.set(Y.TEXTURE0),un.lineAtlasTexture&&un.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),Ar.updatePaintBuffers()),Me&&(V.activeTexture.set(Y.TEXTURE0),un.imageAtlasTexture&&un.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Ar.updatePaintBuffers()),dn&&!B&&m.terrain.setupElevationDraw(un,Xn),m.uploadCommonUniforms(V,Xn,ln.toUnwrapped());const pi=Yn=>{je!=null&&(je.value=at*M),Xn.draw(m,Y.TRIANGLES,Pt,Yn,ne,Dn.disabled,gs,c.id,jn.layoutVertexBuffer,jn.indexBuffer,jn.segments,c.paint,m.transform.zoom,Ar,[jn.layoutVertexBuffer2,jn.patternVertexBuffer,jn.zOffsetVertexBuffer]),je!=null&&(je.value=at)};if(Xe&&!dn){const Yn=m.stencilModeForClipping(ln).ref;Yn===0&&he&&V.clear({stencil:0});const Mn={func:Y.EQUAL,mask:255};gs.u_alpha_discard_threshold=.8,pi(new In(Mn,Yn,255,Y.KEEP,Y.KEEP,Y.INVERT)),gs.u_alpha_discard_threshold=0,pi(new In(Mn,Yn,255,Y.KEEP,Y.KEEP,Y.KEEP))}else gs.u_alpha_discard_threshold=Xe&&dn&&cn?.8:0,pi(dn?wt:m.stencilModeForClipping(ln))}};let tt=m.depthModeForSublayer(0,Qt.ReadOnly);const vt=new Qt(m.depthOcclusion?Y.GREATER:Y.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);if(c.hasNonElevatedBuckets){const Dt=!he&&m.terrain;M!==0&&Dt?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Dt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):ut(p,Ye,tt,In.disabled,!1,!0)}if(c.hasElevatedBuckets){O==="hd-road-markup"?G||(tt=vt,Ye.push("ELEVATED_ROADS")):(Ye.push("ELEVATED"),tt=vt,Q&&Ye.push(ce?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),B&&Ye.push("ELEVATION_REFERENCE_SEA"));const Dt=Xe?m.stencilModeFor3D():In.disabled;m.forceTerrainMode=!0,ut(p,Ye,tt,Dt,!0,!0),Xe&&ut(p,Ye,tt,Dt,!0,!1),m.forceTerrainMode=!1}Xe&&(m.resetStencilClippingMasks(),he&&V.clear({stencil:0})),M===0||m.depthOcclusion||he||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,s,c,p){const x=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const A=c.paint.get("fill-emissive-strength"),M=m.colorModeForDrapableLayerRenderPass(A),O=c.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!O.constantOr(1)&&x.constantOr(i.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let B="none";c.layout.get("fill-elevation-reference")!=="none"?B="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(B="offset");const G=!(!m.terrain||!m.terrain.enabled),V={painter:m,sourceCache:s,layer:c,coords:p,colorMode:M,elevationType:B,terrainEnabled:G,pass:z};if(m.renderPass!=="shadow")if(B!=="offset"){if(wa(V,!1),B==="road"){const Y=!G&&m.renderPass==="translucent";Y&&Bo(m,s,c,p,"geometry"),wa(V,!0,In.disabled),Y&&(function(J){const{painter:Q,sourceCache:ce,layer:ne,coords:he,colorMode:me}=J,ve=Q.context.gl,Pe=J.painter.shadowRenderer,Ae=!!Pe&&Pe.enabled,Ie=new Qt(Q.context.gl.LEQUAL,Qt.ReadOnly,Q.depthRangeFor3D);let Ce=[0,0,0];if(Ae){const Me=Q.style.directionalLight,Ke=Q.style.ambientLight;Me&&Ke&&(Ce=Ha(Q.style,Me,Ke))}const Te=Me=>{for(const Ke of he){const Be=ce.getTile(Ke),at=Be.getBucket(ne);if(!at)continue;const Xe=at.elevatedStructures;if(!Xe)continue;let Qe,At;if(Me?(Qe=Xe.renderableBridgeSegments,At=Xe.bridgeProgramConfigurations.get(ne.id)):(Qe=Xe.renderableTunnelSegments,At=Xe.tunnelProgramConfigurations.get(ne.id)),!Qe||Qe.segments[0].primitiveLength===0)continue;At.updatePaintBuffers(),Q.prepareDrawTile();const Ye=Q.isTileAffectedByFog(Ke),je=[];Ae&&je.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ut=Q.getOrCreateProgram("elevatedStructures",{config:At,overrideFog:Ye,defines:je}),tt=Q.translatePosMatrix(Ke.projMatrix,Be,ne.paint.get("fill-translate"),ne.paint.get("fill-translate-anchor"));Ae&&Pe.setupShadows(Be.tileID.toUnwrapped(),ut,"vector-tile");const vt=Ku(tt,Ce);Q.uploadCommonUniforms(Q.context,ut,Ke.toUnwrapped()),ut.draw(Q,ve.TRIANGLES,Ie,In.disabled,me,Dn.backCCW,vt,ne.id,Xe.vertexBuffer,Xe.indexBuffer,Qe,ne.paint,Q.transform.zoom,At,[Xe.vertexBufferNormal])}};Te(!0),Te(!1)})(V)}}else wa(V,!1,m.stencilModeFor3D());else m.shadowRenderer&&B==="road"&&!G&&(function(Y){const{painter:J,sourceCache:Q,layer:ce,coords:ne}=Y,he=J.context.gl,me=Y.painter.shadowRenderer;for(const ve of ne){const Pe=Q.getTile(ve),Ae=Pe.getBucket(ce);if(!Ae)continue;const Ie=Ae.elevatedStructures;if(!Ie||!Ie.shadowCasterSegments||Ie.shadowCasterSegments.segments[0].primitiveLength===0)continue;J.prepareDrawTile();const Ce=Ae.bufferData.programConfigurations.get(ce.id),Te=J.isTileAffectedByFog(ve),Me=J.getOrCreateProgram("elevatedStructuresDepth",{config:Ce,overrideFog:Te}),Ke=me.calculateShadowPassMatrixFromTile(Pe.tileID.toUnwrapped());J.uploadCommonUniforms(J.context,Me,ve.toUnwrapped());const Be={u_matrix:Ke,u_depth_bias:0};Me.draw(J,he.TRIANGLES,me.getShadowPassDepthMode(),In.disabled,me.getShadowPassColorMode(),Dn.disabled,Be,ce.id,Ie.vertexBuffer,Ie.indexBuffer,Ie.shadowCasterSegments,ce.paint,J.transform.zoom,Ce)}})(V)},"fill-extrusion":function(m,s,c,p){const x=c.paint.get("fill-extrusion-opacity"),w=m.context,A=w.gl,M=m.terrain,O=M&&M.renderingToTexture;if(x===0)return;const z=m.conflationActive&&m.style.isLayerClipped(c,s.getSource()),B=m.style.order.indexOf(c.fqid);if(z&&(function(G,V,Y,J,Q){for(const ce of J){const ne=V.getTile(ce).getBucket(Y);ne&&(ne.updateReplacement(ce,G.replacementSource,Q),ne.uploadCentroid(G.context))}})(m,s,c,p,B),M||z)for(const G of p){const V=s.getTile(G).getBucket(c);V&&Uo(m.context,s,G,V,c,M,z)}if(m.renderPass==="shadow"&&m.shadowRenderer){const G=m.shadowRenderer;if(M&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const V=G.getShadowPassDepthMode(),Y=G.getShadowPassColorMode();nn(m,s,c,p,V,In.disabled,Y,z)}else if(m.renderPass==="translucent"){const G=!c.paint.get("fill-extrusion-pattern").constantOr(1),V=c.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!O&&V.a!==0){const Y=new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D);x===1&&G?nn(m,s,c,p,Y,In.disabled,Gn.unblended,z):(nn(m,s,c,p,Y,In.disabled,Gn.disabled,z),nn(m,s,c,p,Y,m.stencilModeFor3D(),m.colorModeForRenderPass(),z),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&G&&(!M&&m.transform.projection.name!=="globe"||O)){const Y=c.paint.get("fill-extrusion-opacity"),J=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ce=c.paint.get("fill-extrusion-flood-light-intensity"),ne=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",he=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ne?null:c.lut).toArray01().slice(0,3),me=J>0&&Q>0,ve=ce>0,Pe=(Ce,Te,Me)=>(1-Me)*Ce+Me*Te,Ae=new Wp;Ae.translate=c.paint.get("fill-extrusion-translate"),Ae.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Ie=Ce=>{const Te=m.depthModeForSublayer(1,Qt.ReadOnly,A.LEQUAL,!0),Me=c.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ke=Pe(.1,3,Me),Be=m._showOverdrawInspector;if(!Be){const at=new In({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),Xe=new Gn([A.ONE,A.ONE,A.ONE,A.ONE],i.ao.transparent,[!1,!1,!1,!0],A.MIN);lo(Ae,m,s,c,p,Te,at,Xe,Dn.disabled,Ce,"sdf",Y,J,Q,ce,he,Ke,z,!1)}{const at=Be?In.disabled:new In({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Xe=Be?m.colorModeForRenderPass():new Gn([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],i.ao.transparent,[!0,!0,!0,!0]);lo(Ae,m,s,c,p,Te,at,Xe,Dn.disabled,Ce,"color",Y,J,Q,ce,he,Ke,z,!1)}};if(O){const Ce=(Te,Me,Ke)=>{const Be=m.depthModeForSublayer(1,Qt.ReadOnly,A.LEQUAL,!1),at=c.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Xe=Pe(.1,3,at);{const Qe=new Gn([A.ONE,A.ONE,A.ONE,A.ONE],i.ao.transparent,[!1,!1,!1,!0]);lo(Ae,m,s,c,p,Be,In.disabled,Qe,Dn.disabled,Te,"clear",Y,J,Q,ce,he,Xe,z,Me)}{const Qe=new In({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),At=new Gn([A.ONE,A.ONE,A.ONE,A.ONE],i.ao.transparent,[!1,!1,!1,!0],A.MIN);lo(Ae,m,s,c,p,Be,Qe,At,Dn.disabled,Te,"sdf",Y,J,Q,ce,he,Xe,z,Me)}{const Qe=Te?A.ZERO:A.ONE_MINUS_DST_ALPHA,At=new In({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Ye=new Gn([Qe,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],i.ao.transparent,[!0,!0,!0,!0]);lo(Ae,m,s,c,p,Be,At,Ye,Dn.disabled,Te,"color",Y,J,Q,ce,he,Xe,z,Me)}{const Qe=new Gn([A.ONE,A.ONE,A.ONE,Te?A.ZERO:A.ONE],i.ao.transparent,[!1,!1,!1,!0],Te?A.FUNC_ADD:A.MAX);lo(Ae,m,s,c,p,Be,In.disabled,Qe,Dn.disabled,Te,"clear",Y,J,Q,ce,he,Xe,z,Me,Ke)}};if(me||ve){let Te;if(m.prepareDrawTile(),M){const Me=M.drapeBufferSize[0],Ke=M.drapeBufferSize[1];Te=M.framebufferCopyTexture,Te&&(!Te||Te.size[0]===Me&&Te.size[1]===Ke)||(Te&&Te.destroy(),Te=M.framebufferCopyTexture=new i.T(w,new i.q({width:Me,height:Ke}),A.RGBA8)),Te.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,Me,Ke)}me&&Ce(!0,!1,Te),ve&&Ce(!1,!0,Te)}}else me&&Ie(!0),ve&&Ie(!1),(me||ve)&&m.resetStencilClippingMasks()}}},building:function(m,s,c,p){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const x=c.paint.get("building-ambient-occlusion-ground-intensity"),w=c.paint.get("building-ambient-occlusion-ground-radius"),A=c.paint.get("building-ambient-occlusion-ground-attenuation"),M=c.paint.get("building-opacity");if(M<=0)return;let O=x>0&&w>0,z=!0;const B=c.paint.get("building-vertical-scale");(!m.shadowRenderer||B<1)&&(z=!1);const G=m.conflationActive&&m.style.isLayerClipped(c,s.getSource()),V=m.style.order.indexOf(c.fqid);if((function(Y,J,Q,ce,ne,he){for(const me of he){const ve=J.getTile(me).getBucket(Q);ve&&(ne&&ve.updateReplacement(me,Y.replacementSource,ce),ve.uploadUpdatedIndexBuffer(Y.context))}})(m,s,c,V,G,p),(function(Y,J,Q,ce){for(const ne of ce){const he=J.getTile(ne).getBucket(Q);he&&he.needsEvaluation()&&he.uploadUpdatedColorBuffer(Y.context)}})(m,s,c,p),c.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const Y=m.shadowRenderer,J=[],Q=Y.getShadowPassDepthMode();iu({painter:m,source:s,layer:c,coords:p,defines:J,blendMode:Y.getShadowPassColorMode(),depthMode:Q,opacity:M,verticalScale:B,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(m.renderPass==="translucent"){let Y=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];z&&(Y=Y.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(Y=Y.concat("NORMAL_OFFSET"));const J=c.paint.get("building-facade-emissive-chance"),Q=c.paint.get("building-ambient-occlusion-intensity"),ce=new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D);M<1&&iu({painter:m,source:s,layer:c,coords:p,defines:Y,blendMode:Gn.disabled,depthMode:ce,opacity:M,verticalScale:B,facadeEmissiveChance:J,facadeAOIntensity:Q});const ne=m.colorModeForRenderPass();iu({painter:m,source:s,layer:c,coords:p,defines:Y,blendMode:ne,depthMode:ce,opacity:M,verticalScale:B,facadeEmissiveChance:J,facadeAOIntensity:Q}),O&&(function(he,me,ve,Pe,Ae,Ie,Ce,Te,Me,Ke,Be,at,Xe){const Qe=he.context.gl,At=he.depthModeForSublayer(1,Qt.ReadOnly,Qe.LEQUAL,!0),Ye=.1*(1-(je=Be))+3*je;var je;const ut=he._showOverdrawInspector,tt=at,vt=new Wp;ut||lo(vt,he,me,ve,Pe,At,new In({func:Qe.ALWAYS,mask:255},255,255,Qe.KEEP,Qe.KEEP,Qe.REPLACE),new Gn([Qe.ONE,Qe.ONE,Qe.ONE,Qe.ONE],i.ao.transparent,[!1,!1,!1,!0],Qe.MIN),Dn.disabled,Ae,"sdf",Ie,Ce,Te,0,Ke,Ye,tt,!1);{const Dt=ut?In.disabled:new In({func:Qe.EQUAL,mask:255},255,255,Qe.KEEP,Qe.DECR,Qe.DECR),Gt=ut?he.colorModeForRenderPass():new Gn([Qe.ONE_MINUS_DST_ALPHA,Qe.DST_ALPHA,Qe.ONE,Qe.ONE],i.ao.transparent,[!0,!0,!0,!0]);lo(vt,he,me,ve,Pe,At,Dt,Gt,Dn.disabled,Ae,"color",Ie,Ce,Te,0,Ke,Ye,tt,!1)}})(m,s,c,p,!0,M,x,w,0,[0,0,0],A,G)}else if(m.renderPass==="light-beam"){const Y=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],J=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);iu({painter:m,source:s,layer:c,coords:p,defines:Y,blendMode:Gn.alphaBlended,depthMode:J,opacity:M,verticalScale:B,facadeEmissiveChance:0,facadeAOIntensity:0})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,s,c,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const x=m.context,w=m.terrain&&m.terrain.renderingToTexture,[A,M]=m.renderPass!=="translucent"||w?[{},p]:m.stencilConfigForOverlap(p);for(const O of M){const z=s.getTile(O);if(z.needsHillshadePrepare&&m.renderPass==="offscreen")Ki(m,z,c);else if(m.renderPass==="translucent"){const B=m.depthModeForSublayer(0,Qt.ReadOnly),G=c.paint.get("hillshade-emissive-strength"),V=m.colorModeForDrapableLayerRenderPass(G),Y=w&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):A[O.overscaledZ];b_(m,O,z,c,B,Y,V)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,c,p,x,w){if(m.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const A=m.transform.projection.name==="globe",M=c.paint.get("raster-elevation")!==0,O=M&&A;if(m.renderElevatedRasterBackface&&!O)return;const z=m.context,B=z.gl,G=s.getSource(),V=(function(Ae,Ie,Ce,Te){const Me=Ie.paint.get("raster-color"),Ke=Ae.type==="raster-array",Be=[],at=Ie.paint.get("raster-resampling"),Xe=Ie.paint.get("raster-color-mix");let Qe=Ie.paint.get("raster-color-range");const At=[Xe[0],Xe[1],Xe[2],0],Ye=Xe[3];let je=at==="nearest"?Te.NEAREST:Te.LINEAR;if(Ke&&(Be.push("RASTER_ARRAY"),Me||Be.push("RASTER_COLOR"),at==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),je=Te.NEAREST,!Qe&&Ae.rasterLayers)){const ut=Ae.rasterLayers.find((({id:tt})=>tt===Ie.sourceLayer));ut&&ut.fields&&ut.fields.range&&(Qe=ut.fields.range)}if(Qe=Qe||[0,1],Me){Be.push("RASTER_COLOR"),Ce.activeTexture.set(Te.TEXTURE2),Ie.updateColorRamp(Qe);let ut=Ie.colorRampTexture;ut||(ut=Ie.colorRampTexture=new i.T(Ce,Ie.colorRamp,Te.RGBA8)),ut.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return{mix:At,range:Qe,offset:Ye,defines:Be,resampling:je}})(G,c,z,B);if(G instanceof i.aS&&!p.length&&!A)return;const Y=c.paint.get("raster-emissive-strength"),J=m.colorModeForDrapableLayerRenderPass(Y),Q=m.terrain&&m.terrain.renderingToTexture,ce=!m.options.moving,ne=c.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(G instanceof i.aS&&!p.length&&(G.onNorthPole||G.onSouthPole)){const Ae=M?m.stencilModeFor3D():In.disabled;return void su(!!G.onNorthPole,null,m,s,c,Y,V,Dn.disabled,Ae)}if(!p.length)return;const[he,me]=G instanceof i.aS||Q?[{},p]:m.stencilConfigForOverlap(p),ve=me[me.length-1].overscaledZ;O&&V.defines.push("PROJECTION_GLOBE_VIEW"),M&&V.defines.push("RENDER_CUTOFF");const Pe=(Ae,Ie,Ce)=>{for(const Te of Ae){const Me=Te.toUnwrapped(),Ke=s.getTile(Te);if(Q&&(!Ke||!Ke.hasData()))continue;z.activeTexture.set(B.TEXTURE0);const Be=ou(Ke,G,c,V);if(!Be||!Be.texture)continue;const{texture:at,mix:Xe,offset:Qe,tileSize:At,buffer:Ye}=Be;let je,ut;Q?(je=Qt.disabled,ut=Te.projMatrix):M?(je=new Qt(B.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D),ut=A?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Me,ce)):(je=m.depthModeForSublayer(Te.overscaledZ-ve,c.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,B.LESS),ut=m.transform.calculateProjMatrix(Me,ce));const tt=m.terrain&&Q?m.terrain.stencilModeForRTTOverlap(Te):he[Te.overscaledZ],vt=w?0:c.paint.get("raster-fade-duration");Ke.registerFadeDuration(vt);const Dt=s.findLoadedParent(Te,0),Gt=Xa(Ke,Dt,s,m.transform,vt);let Pt,wt;!Gt.isFading&&Ke.refreshedUponExpiration&&(Ke.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),z.activeTexture.set(B.TEXTURE0),at.bind(ne,B.CLAMP_TO_EDGE),z.activeTexture.set(B.TEXTURE1),Dt?(Dt.texture&&Dt.texture.bind(ne,B.CLAMP_TO_EDGE),Pt=Math.pow(2,Dt.tileID.overscaledZ-Ke.tileID.overscaledZ),wt=[Ke.tileID.canonical.x*Pt%1,Ke.tileID.canonical.y*Pt%1]):at.bind(ne,B.CLAMP_TO_EDGE),"useMipmap"in at&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const dn=m.transform;let cn;const ln=M?kf(dn):[0,0,0,0];let un,jn,Un,Wn,Fr,Bn=0;if(O&&G instanceof i.aS&&G.coordinates.length>3)un=Float32Array.from(i.bk(i.dF(new i.cC(0,0,0)))),jn=Float32Array.from(dn.globeMatrix),Un=Float32Array.from(i.dB(dn)),Wn=[i.aF(dn.center.lng),i.aJ(dn.center.lat)],cn=G.elevatedGlobePerspectiveTransform,Fr=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Xn=i.dC(Te.canonical);Bn=i.dD(Xn.getCenter().lat),un=Float32Array.from(i.bk(i.dF(Te.canonical))),jn=Float32Array.from(dn.globeMatrix),Un=Float32Array.from(i.dB(dn)),Wn=[i.aF(dn.center.lng),i.aJ(dn.center.lat)],cn=[0,0],Fr=Float32Array.from(i.dE(Te.canonical,Xn,Bn,dn.worldSize/dn._pixelsPerMercatorPixel))}else cn=G instanceof i.aS?G.perspectiveTransform:[0,0],un=new Float32Array(16),jn=new Float32Array(9),Un=new Float32Array(16),Wn=[0,0],Fr=new Float32Array(9);const Ar=If(ut,un,jn,Un,Fr,wt||[0,0],i.aj(m.transform.zoom),Wn,ln,Pt||1,Gt,c,cn,M?c.paint.get("raster-elevation"):0,2,Xe,Qe,V.range,At,Ye,Y),Lr=m.isTileAffectedByFog(Te),Hr=m.getOrCreateProgram("raster",{defines:V.defines,overrideFog:Lr});if(m.uploadCommonUniforms(z,Hr,Me),G instanceof i.aS){const Xn=G.elevatedGlobeVertexBuffer,Sr=G.elevatedGlobeIndexBuffer;if(Q||!A)G.boundsBuffer&&G.boundsSegments&&Hr.draw(m,B.TRIANGLES,je,In.disabled,J,Dn.disabled,Ar,c.id,G.boundsBuffer,m.quadTriangleIndexBuffer,G.boundsSegments);else if(Xn&&Sr){const Mr=dn.zoom<=i.cZ?G.elevatedGlobeSegments:G.getSegmentsForLongitude(dn.center.lng);Mr&&Hr.draw(m,B.TRIANGLES,je,In.disabled,J,Ie,Ar,c.id,Xn,Sr,Mr)}}else if(O){je=new Qt(B.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);const Xn=m.globeSharedBuffers;if(Xn){const[Sr,Mr,tr]=Xn.getGridBuffers(Bn,!1);Hr.draw(m,B.TRIANGLES,je,Ce||tt,m.colorModeForRenderPass(),Ie,Ar,c.id,Sr,Mr,tr)}}else{const{tileBoundsBuffer:Xn,tileBoundsIndexBuffer:Sr,tileBoundsSegments:Mr}=m.getTileBoundsBuffers(Ke);Hr.draw(m,B.TRIANGLES,je,tt,J,Dn.disabled,Ar,c.id,Xn,Sr,Mr)}}if(!(G instanceof i.aS)&&O)for(const Te of Ae){const Me=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&su(!0,Te,m,s,c,Y,V,Ie,Ce||In.disabled),Me&&su(!1,Te,m,s,c,Y,V,Ie===Dn.frontCW?Dn.backCW:Dn.frontCW,Ce||In.disabled)}};O?Pe(me,m.renderElevatedRasterBackface?Dn.backCW:Dn.frontCW,m.stencilModeFor3D()):Pe(me,Dn.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,c,p,x,w){m.renderPass==="offscreen"&&(function(A,M,O,z){if(!z.length)return;const B=A.context,G=B.gl,V=M.getSource();if(!(V instanceof gl))return;const Y=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let J=O.particlePositionRGBAImage;if(!J||J.width!==Y){const me=(function(ve){const Pe=ve*ve,Ae=new Uint8Array(4*Pe),Ie=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},Ce=1/1.1;for(let Te=0;Te<Pe;Te++){const Me=Ce*(Ie(2*Te+0)+wc),Ke=Ce*(Ie(2*Te+1)+wc),Be=255*Me%1,at=255*Ke%1,Xe=Be,Qe=Ke-at/255,At=at;Ae[4*Te+0]=255*(Me-Be/255),Ae[4*Te+1]=255*Xe,Ae[4*Te+2]=255*Qe,Ae[4*Te+3]=255*At}return Ae})(Y);J=O.particlePositionRGBAImage=new i.q({width:Y,height:Y},me)}let Q=O.particleFramebuffer;Q?Q.width!==Y&&(Q.destroy(),Q=O.particleFramebuffer=B.createFramebuffer(Y,Y,!0,null)):Q=O.particleFramebuffer=B.createFramebuffer(Y,Y,!0,null);const ce=[];for(const me of z){const ve=M.getTile(me);if(!(ve instanceof Ou))continue;const Pe=Vo(ve,V,O);if(!Pe)continue;const Ae=[ve.tileSize,ve.tileSize];let Ie=O.tileFramebuffer;Ie||(Ie=O.tileFramebuffer=B.createFramebuffer(Ae[0],Ae[1],!0,null));let Ce=ve.rasterParticleState;Ce||(Ce=ve.rasterParticleState=new pd(B,me,Ae,J));const Te=Ce.update(O.lastInvalidatedAt);Ce.particleTextureDimension!==Y&&Ce.updateParticleTexture(me,J);const Me=Ce.targetColorTexture;Ce.targetColorTexture=Ce.backgroundColorTexture,Ce.backgroundColorTexture=Me;const Ke=Ce.particleTexture0;Ce.particleTexture0=Ce.particleTexture1,Ce.particleTexture1=Ke,ce.push([me,Pe,Ce,Te])}if(ce.length===0)return;const ne=i.o.now(),he=O.previousDrawTimestamp?.001*(ne-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=ne,O.hasColorMap()){B.activeTexture.set(G.TEXTURE0+2);let me=O.colorRampTexture;me||(me=O.colorRampTexture=new i.T(B,O.colorRamp,G.RGBA8)),me.bind(G.LINEAR,G.CLAMP_TO_EDGE)}B.bindFramebuffer.set(O.tileFramebuffer.framebuffer),(function(me,ve,Pe){const Ae=me.context,Ie=Ae.gl,Ce=ve.tileFramebuffer;Ae.activeTexture.set(Ie.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(Ke=ve.paint.get("raster-particle-fade-opacity-factor"))/(Ke+.05)},Me=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ke;for(const Be of Pe){const[,,at,Xe]=Be;Ce.colorAttachment.set(at.targetColorTexture.texture),Ae.viewport.set([0,0,Ce.width,Ce.height]),Ae.clear({color:i.ao.transparent}),Xe&&(at.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),Me.draw(me,Ie.TRIANGLES,Qt.disabled,In.disabled,Gn.alphaBlended,Dn.disabled,Te,ve.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}})(A,O,ce),(function(me,ve,Pe,Ae){const Ie=me.context,Ce=Ie.gl,Te=Pe.tileFramebuffer,Me=me.transform.projection.name==="globe",Ke=Pe.paint.get("raster-particle-max-speed");for(const Be of Ae){const[at,Xe,Qe]=Be;Ie.activeTexture.set(Ce.TEXTURE0+0),Xe.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Te.colorAttachment.set(Qe.targetColorTexture.texture);const At=me.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});Ie.activeTexture.set(Ce.TEXTURE0+1);const Ye=Xe.scalarData?[]:[0,1,2,3].map((tt=>i.e6[tt](at)));Ye.push(at);const je=at.canonical.x,ut=at.canonical.y;for(const tt of Ye){const vt=ve.getTile(Me?tt.wrapped():tt);if(!vt)continue;const Dt=vt.rasterParticleState;if(!Dt)continue;const Gt=tt.canonical.x+(1<<tt.canonical.z)*(tt.wrap-at.wrap),Pt=tt.canonical.y;Dt.particleTexture0.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);const wt=Vp(1,Dt.particleTexture0.size[0],[Gt-je,Pt-ut],0,Xe.texture.size,2,Ke,Xe.textureOffset,Xe.scale,Xe.offset);At.draw(me,Ce.POINTS,Qt.disabled,In.disabled,Gn.alphaBlended,Dn.disabled,wt,Pe.id,Dt.particleIndexBuffer,void 0,Dt.particleSegment)}}})(A,M,O,ce),B.bindFramebuffer.set(O.particleFramebuffer.framebuffer),(function(me,ve,Pe,Ae){const Ie=me.context,Ce=Ie.gl,Te=ve.paint.get("raster-particle-max-speed"),Me=Ae*ve.paint.get("raster-particle-speed-factor")*.15,Ke=(function(at){return Math.pow(at,6)})(.01+1*ve.paint.get("raster-particle-reset-rate-factor")),Be=ve.particleFramebuffer;Ie.viewport.set([0,0,Be.width,Be.height]);for(const at of Pe){const[,Xe,Qe]=at;Ie.activeTexture.set(Ce.TEXTURE0+0),Xe.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Ie.activeTexture.set(Ce.TEXTURE0+1);const At=Qe.particleTexture0;At.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);const Ye=Qu(1,At.size[0],0,Xe.texture.size,Te,Me,Ke,Xe.textureOffset,Xe.scale,Xe.offset);Be.colorAttachment.set(Qe.particleTexture1.texture),Ie.clear({color:i.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(me,Ce.TRIANGLES,Qt.disabled,In.disabled,Gn.unblended,Dn.disabled,Ye,ve.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}})(A,O,ce,he)})(m,s,c,p),m.renderPass==="translucent"&&((function(A,M,O,z,B){const G=A.context,V=G.gl,Y=M.getSource().tileSize,J=5*(1-i.ah(i.cK,i.cK+1,A.transform.zoom))*Y+O.paint.get("raster-particle-elevation"),Q=!A.options.moving,ce=A.transform.projection.name==="globe";if(!z.length)return;const[ne,he]=A.stencilConfigForOverlap(z),me=[];ce&&me.push("PROJECTION_GLOBE_VIEW");const ve=A.stencilModeFor3D();for(const Pe of he){const Ae=Pe.toUnwrapped(),Ie=M.getTile(Pe);if(!Ie.rasterParticleState)continue;const Ce=Ie.rasterParticleState,Te=100;Ie.registerFadeDuration(Te);const Me=M.findLoadedParent(Pe,0),Ke=Xa(Ie,Me,M,A.transform,Te);let Be,at;A.terrain&&A.terrain.prepareDrawTile(),G.activeTexture.set(V.TEXTURE0),Ce.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),G.activeTexture.set(V.TEXTURE1),Me&&Me.rasterParticleState?(Me.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Be=Math.pow(2,Me.tileID.overscaledZ-Ie.tileID.overscaledZ),at=[Ie.tileID.canonical.x*Be%1,Ie.tileID.canonical.y*Be%1]):Ce.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const Xe=ce?Float32Array.from(A.transform.expandedFarZProjMatrix):A.transform.calculateProjMatrix(Ae,Q),Qe=A.transform,At=Rf(Qe),Ye=i.dC(Pe.canonical),je=i.dD(Ye.getCenter().lat);let ut,tt,vt,Dt,Gt;ce?(ut=Float32Array.from(i.bk(i.dF(Pe.canonical))),tt=Float32Array.from(Qe.globeMatrix),vt=Float32Array.from(i.dB(Qe)),Dt=[i.aF(Qe.center.lng),i.aJ(Qe.center.lat)],Gt=Float32Array.from(i.dE(Pe.canonical,Ye,je,Qe.worldSize/Qe._pixelsPerMercatorPixel))):(ut=new Float32Array(16),tt=new Float32Array(9),vt=new Float32Array(16),Dt=[0,0],Gt=new Float32Array(9));const Pt=$l(Xe,ut,tt,vt,Gt,at||[0,0],i.aj(A.transform.zoom),Dt,At,Be||1,Ke,J),wt=A.isTileAffectedByFog(Pe),dn=A.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:wt});if(A.uploadCommonUniforms(G,dn,Ae),ce){const cn=new Qt(V.LEQUAL,Qt.ReadOnly,A.depthRangeFor3D),ln=0,un=A.globeSharedBuffers;if(un){const[jn,Un,Wn]=un.getGridBuffers(je,ln!==0);dn.draw(A,V.TRIANGLES,cn,ve,Gn.alphaBlended,A.renderElevatedRasterBackface?Dn.frontCCW:Dn.backCCW,Pt,O.id,jn,Un,Wn)}}else{const cn=A.depthModeForSublayer(0,Qt.ReadOnly),ln=ne[Pe.overscaledZ],{tileBoundsBuffer:un,tileBoundsIndexBuffer:jn,tileBoundsSegments:Un}=A.getTileBoundsBuffers(Ie);dn.draw(A,V.TRIANGLES,cn,ln,Gn.alphaBlended,Dn.disabled,Pt,O.id,un,jn,Un)}}A.resetStencilClippingMasks()})(m,s,c,p),m.style.map.triggerRepaint())},background:function(m,s,c,p){const x=c.paint.get("background-color"),w=c.paint.get("background-color-use-theme").constantOr("default")==="none",A=c.paint.get("background-opacity"),M=c.paint.get("background-emissive-strength"),O=c.paint.get("background-pitch-alignment")==="viewport";if(A===0)return;const z=m.context,B=z.gl,G=m.transform,V=G.tileSize,Y=c.paint.get("background-pattern");let J;if(Y!==void 0&&(Y===null||(J=m.imageManager.getPattern(i.I.from(Y.toString()),c.scope,m.style.getLut(c.scope)),!J)))return;const Q=!Y&&x.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Q)return;const ce=In.disabled,ne=m.depthModeForSublayer(0,Q==="opaque"?Qt.ReadWrite:Qt.ReadOnly),he=m.colorModeForDrapableLayerRenderPass(M),me=Y?"backgroundPattern":"background";let ve,Pe=p;if(Pe||(ve=m.getBackgroundTiles(),Pe=Object.values(ve).map((Ae=>Ae.tileID))),Y&&(z.activeTexture.set(B.TEXTURE0),m.imageManager.bind(m.context,c.scope)),O){const Ae=m.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),Ie=new Float32Array(i.bA([])),Ce=new i.aO(0,0,0,0,0),Te=Y?Hp(Ie,M,A,m,0,c.scope,J,O,{tileID:Ce,tileSize:V}):hd(Ie,M,A,x.toPremultipliedRenderColor(w?null:c.lut));Ae.draw(m,B.TRIANGLES,ne,ce,he,Dn.disabled,Te,c.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Ae of Pe){const Ie=m.isTileAffectedByFog(Ae),Ce=m.getOrCreateProgram(me,{overrideFog:Ie}),Te=Ae.toUnwrapped(),Me=p?Ae.projMatrix:m.transform.calculateProjMatrix(Te);m.prepareDrawTile();const Ke=s?s.getTile(Ae):ve?ve[Ae.key]:new dc(Ae,V,G.zoom,m),Be=Y?Hp(Me,M,A,m,0,c.scope,J,O,{tileID:Ae,tileSize:V}):hd(Me,M,A,x.toPremultipliedRenderColor(w?null:c.lut));m.uploadCommonUniforms(z,Ce,Te);const{tileBoundsBuffer:at,tileBoundsIndexBuffer:Xe,tileBoundsSegments:Qe}=m.getTileBoundsBuffers(Ke);Ce.draw(m,B.TRIANGLES,ne,ce,he,Dn.disabled,Be,c.id,at,Xe,Qe)}},sky:function(m,s,c){const p=m._atmosphere?i.aj(m.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const w=m.context,A=c.paint.get("sky-type"),M=new Qt(w.gl.LEQUAL,Qt.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;A==="atmosphere"?m.renderPass==="offscreen"?c.needsSkyboxCapture(m)&&((function(z,B,G,V){const Y=z.context,J=Y.gl;let Q=B.skyboxFbo;if(!Q){Q=B.skyboxFbo=Y.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new tg(Y),B.skyboxTexture=Y.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,B.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let me=0;me<6;++me)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(Q.framebuffer),Y.viewport.set([0,0,32,32]);const ce=B.getCenter(z,!0),ne=z.getOrCreateProgram("skyboxCapture"),he=new Float64Array(16);i.bA(he),i.ek(he,he,.5*-Math.PI),ms(z,B,ne,he,ce,0),i.bA(he),i.ek(he,he,.5*Math.PI),ms(z,B,ne,he,ce,1),i.bA(he),i.cT(he,he,.5*-Math.PI),ms(z,B,ne,he,ce,2),i.bA(he),i.cT(he,he,.5*Math.PI),ms(z,B,ne,he,ce,3),i.bA(he),ms(z,B,ne,he,ce,4),i.bA(he),i.ek(he,he,Math.PI),ms(z,B,ne,he,ce,5),Y.viewport.set([0,0,z.width,z.height])})(m,c),c.markSkyboxValid(m)):m.renderPass==="sky"&&(function(z,B,G,V,Y){const J=z.context,Q=J.gl,ce=z.transform,ne=z.getOrCreateProgram("skybox");J.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,B.skyboxTexture);const he=((me,ve,Pe,Ae,Ie)=>({u_matrix:me,u_sun_direction:ve,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Ie}))(ce.skyboxMatrix,B.getCenter(z,!1),0,V,Y);z.uploadCommonUniforms(J,ne),ne.draw(z,Q.TRIANGLES,G,In.disabled,z.colorModeForRenderPass(),Dn.backCW,he,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)})(m,c,M,x,O):A==="gradient"&&m.renderPass==="sky"&&(function(z,B,G,V,Y){const J=z.context,Q=J.gl,ce=z.transform,ne=z.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new tg(J)),J.activeTexture.set(Q.TEXTURE0);let he=B.colorRampTexture;he||(he=B.colorRampTexture=new i.T(J,B.colorRamp,Q.RGBA8)),he.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const me=((ve,Pe,Ae,Ie,Ce)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:Pe,u_radius:i.an(Ae),u_opacity:Ie,u_temporal_offset:Ce}))(ce.skyboxMatrix,B.getCenter(z,!1),B.paint.get("sky-gradient-radius"),V,Y);z.uploadCommonUniforms(J,ne),ne.draw(z,Q.TRIANGLES,G,In.disabled,z.colorModeForRenderPass(),Dn.backCW,me,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)})(m,c,M,x,O)},custom:function(m,s,c,p){const x=m.context,w=c.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&c.isDraped(s)){if(m.renderPass==="offscreen"){const A=w.prerender;if(A){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const M=m.transform.pointMerc;A.call(w,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.aj(m.transform.zoom),[M.x,M.y],m.transform.pixelsPerMeterRatio)}else A.call(w,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const M=w.renderToTile;if(M){const O=p[0].canonical,z={x:O.x+p[0].wrap*(w.wrapTileId?0:1<<O.z),y:O.y,z:O.z};x.setDepthMode(Qt.disabled),x.setStencilMode(In.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),M.call(w,x.gl,z),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(In.disabled);const A=w.renderingMode==="3d"?new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Qt.ReadOnly);if(x.setDepthMode(A),m.transform.projection.name==="globe"){const M=m.transform.pointMerc;w.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.aj(m.transform.zoom),[M.x,M.y],m.transform.pixelsPerMeterRatio)}else w.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,c,p){if(m.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1);if(x===0)return;const w=c.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!w||m.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const A=m.shadowRenderer,M=c.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,M||(A.enabled=!1));const O=()=>{A&&(A.useNormalOffset=!0,M||(A.enabled=!0))},z=s.getSource();if(m.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return(function(ne,he,me,ve,Pe){const Ae=ne.transform;if(Ae.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Ie=Ae.getFreeCameraOptions().position;if(!ne.modelManager)return;const Ce=ne.modelManager;me.modelManager=Ce;const Te=ne.shadowRenderer;if(!me._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Me=me._unevaluatedLayout._values["model-id"],Ke=Object.assign({},me.layout.get("model-id").parameters),Be=ne.style.order.indexOf(me.fqid);for(const at of ve){const Xe=he.getTile(at).getBucket(me);if(!Xe||Xe.projection.name!==Ae.projection.name)continue;const Qe=Xe.getModelUris();Qe&&!Xe.modelsRequested&&(Ce.addModelsFromBucket(Qe,Pe),Xe.modelsRequested=!0);const At=sh(at,Ae);Ke.zoom=At;const Ye=Me.possiblyEvaluate(Ke);if(ng(ne,Xe,at),tl.shadowUniformsInitialized=!1,tl.useSingleShadowCascade=!!Te&&Te.getMaxCascadeForTile(at.toUnwrapped())===0,ne.renderPass==="shadow"&&Te){if(ne.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const tt=Ae.calculatePosMatrix(at.toUnwrapped(),Ae.worldSize);if(tl.tileMatrix.set(tt),tl.shadowTileMatrix=Float32Array.from(Te.calculateShadowPassMatrixFromMatrix(tt)),tl.aabb.min=[0,0,0],tl.aabb.max[0]=tl.aabb.max[1]=i.al,tl.aabb.max[2]=0,bd(Xe,tl,ne,me.scope))continue}const je=1<<at.canonical.z,ut=[((Ie.x-at.wrap)*je-at.canonical.x)*i.al,(Ie.y*je-at.canonical.y)*i.al,Ie.z*je*i.al];ne.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&ne.style.isLayerClipped(me,he.getSource())&&Xe.updateReplacement(at,ne.replacementSource,Be,Pe)&&(Xe.uploaded=!1,Xe.upload(ne.context));for(let tt in Xe.instancesPerModel){const vt=Xe.instancesPerModel[tt];vt.features.length>0&&(tt=Ye.evaluate(vt.features[0].feature,{}));const Dt=Ce.getModel(tt,Pe);if(Dt||Ce.hasURLBeenRequested(tt)||Xe.modelUris.includes(tt)||(Xe.modelUris.push(tt),Xe.modelsRequested=!1),Dt&&Dt.uploaded)for(const Gt of Dt.nodes)rg(ne,me,Gt,vt,ut,at,tl)}}})(m,s,c,p,z.type==="vector"?c.scope:""),void O();if(!z.loaded())return;if(z.type==="batched-model")return(function(ne,he,me,ve){me.resetLayerRenderingStats(ne);const Pe=ne.context,Ae=ne.transform,Ie=ne.style.fog,Ce=ne.shadowRenderer;if(Ae.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Te=ne.transform.getFreeCameraOptions().position,Me=i.c4([],[Te.x,Te.y,Te.z],ne.transform.worldSize),Ke=i.et([],Me),Be=i.bA([]),at=i.ec(Ae.center.lat,Ae.zoom),Xe=i.bq([],[1,1,1/at]);i.br(Be,Be,Ke);const Qe=me.paint.get("model-opacity").constantOr(1),At=new Qt(Pe.gl.LEQUAL,Qt.ReadWrite,ne.depthRangeFor3D),Ye=new Qt(Pe.gl.LEQUAL,Qt.ReadOnly,ne.depthRangeFor3D),je=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ut=ne.renderPass==="shadow",tt=ut&&Ce?Ce.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),vt=me.paint.get("model-front-cutoff"),Dt=vt[2]<1,Gt=Xc(ne,me.paint.get("model-cutoff-fade-range")),Pt=me.getLayerRenderingStats();(function(wt,dn,cn,ln){const un=wt.terrain?wt.terrain.exaggeration():0,jn=wt.transform.zoom;for(const Un of ln){const Wn=dn.getTile(Un).getBucket(cn);Wn&&(Wn.setFilter(cn.filter),wt.conflationActive&&Wn.updateReplacement(Un,wt.replacementSource),Wn.evaluateTransform(wt,cn),wt.terrain&&un>0&&Wn.elevationUpdate(wt.terrain,un,Un,cn.source),Wn.needsReEvaluation(wt,jn,cn)&&Wn.evaluate(cn))}})(ne,he,me,ve),(function(){let wt,dn,cn;Dt?(wt=ve.length-1,dn=-1,cn=-1):(wt=0,dn=ve.length,cn=1);const ln=new Float64Array(16),un=i.cz(),jn=new i.P(0,0);for(let Un=wt;Un!==dn;Un+=cn){const Wn=ve[Un],Fr=he.getTile(Wn).getBucket(me);if(!Fr||!Fr.uploaded)continue;let Bn=!1;Ce&&(Bn=Ce.getMaxCascadeForTile(Wn.toUnwrapped())===0);const Ar=Ae.calculatePosMatrix(Wn.toUnwrapped(),Ae.worldSize),Lr=Fr.modelTraits;!ut&&Dt&&(i.bl(ln,Ar),i.af(un,Me,ln),jn.x=un[0],jn.y=un[1]);const Hr=[];Fr.setFilter(me.filter);for(const Xn of Fr.getNodesInfo()){if(Xn.hiddenByReplacement||!Xn.node.meshes)continue;const Sr=Xn.node;let Mr=0;ne.terrain&&Sr.elevation&&(Mr=Sr.elevation*ne.terrain.exaggeration());const tr=(()=>{const Gi=Xn.aabb;return je.min=[...Gi.min],je.max=[...Gi.max],je.min[2]+=Mr,je.max[2]+=Mr,i.af(je.min,je.min,Ar),i.af(je.max,je.max,Ar),je})(),fi=Xn.evaluatedScale;if(fi[0]<=1&&fi[1]<=1&&fi[2]<=1&&tr.intersects(tt)===0)continue;if(!ut&&Dt){const Gi=.16666666666666666;Xn.cameraCollisionOpacity=Me[0]>tr.min[0]&&Me[0]<tr.max[0]&&Me[1]>tr.min[1]&&Me[1]<tr.max[1]&&Me[2]*at<tr.max[2]&&Sr.footprint&&i.b$(jn,Sr.footprint)?Math.max(Xn.cameraCollisionOpacity-Gi,0):Math.min(1,Xn.cameraCollisionOpacity+Gi)}const Di=[...Ar],gs=1/i.d6(Wn.canonical),pi=Sr.anchor?Sr.anchor[0]:0,Yn=Sr.anchor?Sr.anchor[1]:0;i.br(Di,Di,[pi*(fi[0]-1)+Xn.evaluatedTranslation[0]*gs,Yn*(fi[1]-1)+Xn.evaluatedTranslation[1]*gs,Mr+Xn.evaluatedTranslation[2]]),i.cp(fi,i.ev)||i.cR(Di,Di,fi);const Mn=i.aB([],Di,Sr.matrix),Br=i.aB([],Ae.expandedFarZProjMatrix,Mn),Gr=i.aB([],Ae.expandedFarZProjMatrix,Di),ai=i.aC([],[pi,Yn,Mr,1],Br)[2];Sr.hidden=!1;let Zi=Qe;ut||(Dt&&(Zi*=Xn.cameraCollisionOpacity,Zi*=wd(Di,Ae,Xn.aabb,vt)),Zi*=Lf(Gt,ai)),Zi!==0?Hr.push({nodeInfo:Xn,depth:ai,opacity:Zi,wvpForNode:Br,wvpForTile:Gr,nodeModelMatrix:Mn,tileModelMatrix:Di}):Sr.hidden=!0}ut||Hr.sort(((Xn,Sr)=>!Dt||Xn.opacity===1&&Sr.opacity===1?Xn.depth<Sr.depth?-1:1:Xn.opacity===1?-1:Sr.opacity===1?1:Xn.depth>Sr.depth?-1:1));for(const Xn of Hr){const Sr=Xn.nodeInfo,Mr=Sr.node;let tr=i.aB([],Xe,Xn.tileModelMatrix);i.aB(tr,Be,tr);const fi=i.bl([],tr);i.ed(fi,fi),i.cR(fi,fi,P_),tr=i.aB(tr,tr,Mr.matrix);const Di=ne.renderPass==="light-beam",gs=me.paint.get("model-color-use-theme").constantOr("default")==="none",pi=Lr&i.ez.HasMapboxMeshFeatures,Yn=pi?0:Sr.evaluatedRMEA[0][2];for(let Mn=0;Mn<Mr.meshes.length;++Mn){const Br=Mr.meshes[Mn],Gr=Mn===Mr.lightMeshIndex;let ai=Xn.wvpForNode;if(Gr){if(!Di&&!ne.terrain&&ne.shadowRenderer){ne.currentLayer<ne.firstLightBeamLayer&&(ne.firstLightBeamLayer=ne.currentLayer);continue}ai=Xn.wvpForTile}else if(Di)continue;const Zi={defines:[]},Gi=[];if(!ut&&Ce&&(Ce.useNormalOffset=!!Br.normalBuffer),vd(Zi.defines,Gi,Br,ne,gs?null:me.lut),pi||Zi.defines.push("DIFFUSE_SHADED"),Bn&&Zi.defines.push("SHADOWS_SINGLE_CASCADE"),Pt&&(ut?Pt.numRenderedVerticesInShadowPass+=Br.vertexArray.length:Pt.numRenderedVerticesInTransparentPass+=Br.vertexArray.length),ut){xd(Br,Xn.nodeModelMatrix,ne,me);continue}let To=null;if(Ie){const Ia=He(Xn.nodeModelMatrix,ne.transform);if(To=new Float32Array(Ia),Ae.projection.name!=="globe"){const Li=Br.aabb.min,ji=Br.aabb.max,[mi,Wi]=Ie.getOpacityForBounds(Ia,Li[0],Li[1],ji[0],ji[1]);Zi.overrideFog=mi>=gn||Wi>=gn}}const Us=Br.material;let ho;Us.occlusionTexture&&Us.occlusionTexture.offsetScale&&(ho=Us.occlusionTexture.offsetScale,Zi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Eo=ne.getOrCreateProgram("model",Zi);!ut&&Ce&&Ce.setupShadowsFromMatrix(Xn.tileModelMatrix,Eo,Ce.useNormalOffset),ne.uploadCommonUniforms(Pe,Eo,null,To);const Ys=Us.pbrMetallicRoughness;Ys.metallicFactor=.9,Ys.roughnessFactor=.5;const il=th(new Float32Array(ai),new Float32Array(tr),new Float32Array(fi),new Float32Array(Mr.matrix),ne,Xn.opacity,Ys.baseColorFactor,Us.emissiveFactor,Ys.metallicFactor,Ys.roughnessFactor,Us,Yn,me,[0,0,0],ho);!Gr&&(Sr.hasTranslucentParts||Xn.opacity<1)&&Eo.draw(ne,Pe.gl.TRIANGLES,At,In.disabled,Gn.disabled,Dn.backCCW,il,me.id,Br.vertexBuffer,Br.indexBuffer,Br.segments,me.paint,ne.transform.zoom,void 0,Gi),Eo.draw(ne,Pe.gl.TRIANGLES,Gr?Ye:At,In.disabled,Gr||Xn.opacity<1||Sr.hasTranslucentParts?Gn.alphaBlended:Gn.unblended,Dn.backCCW,il,me.id,Br.vertexBuffer,Br.indexBuffer,Br.segments,me.paint,ne.transform.zoom,void 0,Gi)}}}})()})(m,s,c,p),void O();if(z.type!=="model")return;const B=z.getModels(),G=[],V=m.transform.getFreeCameraOptions().position,Y=i.c4([],[V.x,V.y,V.z],m.transform.worldSize);i.et(Y,Y);const J=[],Q=[];let ce=0;for(const ne of B){const he=c.paint.get("model-rotation").constantOr(null),me=c.paint.get("model-scale").constantOr(null),ve=c.paint.get("model-translation").constantOr(null);ne.computeModelMatrix(m,he,me,ve,!0,!0,!1);const Pe=i.bA([]),Ae=i.ec(ne.position.lat,m.transform.zoom),Ie=i.bq([],[1,1,1/Ae]);i.br(Pe,Pe,Y),G.push({zScaleMatrix:Ie,negCameraPosMatrix:Pe});for(const Ce of ne.nodes)Df(m.transform,Ce,ne.matrix,m.transform.expandedFarZProjMatrix,ce,J,Q);ce++}if(J.sort(((ne,he)=>he.depth-ne.depth)),m.renderPass!=="shadow"){if(x===1)for(const ne of Q)au(ne,m,c,G[ne.modelIndex],In.disabled,m.colorModeForRenderPass());else{for(const ne of Q)au(ne,m,c,G[ne.modelIndex],In.disabled,Gn.disabled);for(const ne of Q)au(ne,m,c,G[ne.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const ne of J)au(ne,m,c,G[ne.modelIndex],In.disabled,m.colorModeForRenderPass());O()}else{for(const ne of Q)xd(ne.mesh,ne.nodeModelMatrix,m,c);for(const ne of J)xd(ne.mesh,ne.nodeModelMatrix,m,c);O()}}},cu={line:function(m,s,c){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const p=s.getVisibleCoordinates();for(const x of p){const w=s.getTile(x).getBucket(m);if(w&&(w.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,s,c){const p=s.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,p.type==="vector"?m.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const w of x)w.upload(c.context)},raster:function(m,s,c){const p=s.getSource();if(!(p instanceof gl&&p.loaded()))return;const x=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const w=m.paint.get("raster-array-band")||p.getInitialBand(x);if(w==null)return;const A=s.getIds().map((M=>s.getTileByID(M)));for(const M of A)M.updateNeeded(m.id,w)&&p.prepareTile(M,x,m.id,w)},"raster-particle":function(m,s,c){const p=s.getSource();if(!(p instanceof gl&&p.loaded()))return;const x=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const w=m.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(w==null)return;const A=s.getIds().map((M=>s.getTileByID(M)));for(const M of A)M.updateNeeded(m.id,w)&&p.prepareTile(M,x,m.id,w)}},Gl={fill:Bo},uu={fill:function(m,s,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const x=m.context.gl,w=new Qt(x.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D),A=new In({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),M=m.transform.getFreeCameraOptions().position,O=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of p){const B=s.getTile(z),G=B.getBucket(c);if(!G)continue;const V=G.elevatedStructures;if(!V||V.depthSegments.segments[0].primitiveLength===0)continue;const Y=Jm(z.toUnwrapped(),M),J=m.translatePosMatrix(z.projMatrix,B,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Q=Qa(J,Y,0,1,0);O.draw(m,x.TRIANGLES,w,A,Gn.disabled,Dn.disabled,Q,c.id,V.vertexBuffer,V.indexBuffer,V.depthSegments,c.paint,m.transform.zoom)}}};class ug{constructor(s,c,p,x,w,A){this.context=new ru(s,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of M)this._debugParams.enabledLayers[z]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of M)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new Sd(w),this.setup(),this.numSublayers=As.maxUnderzooming+As.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Hm(this),this._wireframeDebugCache=new ig,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const O=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,O,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=A}updateTerrain(s,c){const p=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cd(this,s));const x=this._terrain;this.transform.elevation=p?x:null,x.update(s,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const w=p+.78*(x-p);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new cd(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*i.o.devicePixelRatio,this.height=c*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const s=this.context,c=new i.bd;c.emplaceBack(0,0),c.emplaceBack(i.al,0),c.emplaceBack(0,i.al),c.emplaceBack(i.al,i.al),this.tileExtentBuffer=s.createVertexBuffer(c,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const p=new i.bd;p.emplaceBack(0,0),p.emplaceBack(i.al,0),p.emplaceBack(0,i.al),p.emplaceBack(i.al,i.al),this.debugBuffer=s.createVertexBuffer(p,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const x=new i.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const w=new i.b0;w.emplaceBack(0,0,0,0),w.emplaceBack(i.al,0,i.al,0),w.emplaceBack(0,i.al,0,i.al),w.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=s.createVertexBuffer(w,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const A=new i.b1;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A);const M=new i.be;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=s.createIndexBuffer(M),this.emptyTexture=new i.T(s,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=i.bC();const O=this.context.gl;this.stencilClearMode=new In({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Qt.disabled,this.stencilClearMode,Gn.disabled,Dn.disabled,va(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,p){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const O of p)if(this._tileClippingMaskIDs[O.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=c.id;const x=this.context,w=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(Gn.disabled),x.setDepthMode(Qt.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const O=c.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:V}=this.getTileBoundsBuffers(O);A.draw(this,w.TRIANGLES,Qt.disabled,new In({func:w.ALWAYS,mask:0},z,255,w.KEEP,w.KEEP,w.REPLACE),Gn.disabled,Dn.disabled,va(M.projMatrix),"$clipping",B,G,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new In({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new In({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,p=s.sort(((A,M)=>M.overscaledZ-A.overscaledZ)),x=p[p.length-1].overscaledZ,w=p[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const A={};for(let M=0;M<w;M++)A[M+x]=new In({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[A,p]}return[{[x]:In.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Gn([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gn.unblended:Gn.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Gn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,p,x=!1){if(this.depthOcclusion)return new Qt(this.context.gl.GREATER,Qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Qt.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Qt(p||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new rh(this.context,c,p,!1,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:p,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),s.bindTexture(s.TEXTURE_2D,w),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,p,0,0,c,p,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((s,c)=>s+c/this._fpsHistory.length),0))}render(s,c){const p=i.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const x=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),A=()=>this.style._getOrder(w).filter((Ye=>{const je=x[Ye];return!(je.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[je.type]}));let M=A(),O=!1,z=!1,B=null;for(const Ye of M){const je=x[Ye];je.type==="circle"?O=!0:je.type==="building"?B=je:je.type==="symbol"&&(je.hasOcclusionOpacityProperties?z=!0:O=!0)}let G=M.map((Ye=>x[Ye]));const V=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let Y=0,J=!1;for(const Ye in V){const je=V[Ye];je.used&&(je.prepare(this.context),je.getSource().usedInConflation&&++Y)}let Q=!1;for(const Ye of G)Ye.isHidden(this.transform.zoom)||(Ye.type==="clip"&&(Q=!0),this.prepareLayer(Ye));const ce={},ne={},he={},me={},ve={};for(const Ye in V){const je=V[Ye];ce[Ye]=je.getVisibleCoordinates(),ne[Ye]=ce[Ye].slice().reverse(),he[Ye]=je.getVisibleCoordinates(!0).reverse(),me[Ye]=je.getShadowCasterCoordinates(),ve[Ye]=je.sortCoordinatesByDistance(ce[Ye])}const Pe=Ye=>{const je=this.style.getLayerSourceCache(Ye);return je&&je.used?je.getSource():null};if(Y||Q||this._clippingActiveLastFrame){const Ye=[],je=[];let ut=0;for(const tt of G)this.isSourceForClippingOrConflation(tt,Pe(tt))&&(Ye.push(tt),je.push(ut)),ut++;if(Ye&&(Q||Ye.length>1)||this._clippingActiveLastFrame){Q=!1;const tt=[];for(let vt=0;vt<Ye.length;vt++){const Dt=Ye[vt],Gt=je[vt],Pt=this.style.getLayerSourceCache(Dt);if(!Pt||!Pt.used||!Pt.getSource().usedInConflation&&Dt.type!=="clip"&&Dt.type!=="building")continue;let wt=i.eH,dn=i.bZ.None;const cn=[];let ln=!0;if(Dt.type==="building")wt=i.eJ;else if(Dt.type==="clip"){wt=Gt;for(const un of Dt.layout.get("clip-layer-types"))dn|=un==="model"?i.bZ.Model:un==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const un of Dt.layout.get("clip-layer-scope"))cn.push(un);Dt.isHidden(this.transform.zoom)?ln=!1:Q=!0}ln&&tt.push({layer:Dt.fqid,cache:Pt,order:wt,clipMask:dn,clipScope:cn})}this.replacementSource.setSources(tt),J=!0}}this._clippingActiveLastFrame=Q,J||this.replacementSource.clear(),this.conflationActive=J,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ye=0;Ye<G.length;Ye++){const je=G[Ye],ut=je.cutoffRange();if(this.longestCutoffRange=Math.max(ut,this.longestCutoffRange),ut>0){const tt=Pe(je);tt&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom)),je.minzoom&&(this.minCutoffZoom=Math.max(je.minzoom,this.minCutoffZoom))}je.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ye),this._lastOcclusionLayer=Ye)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(he),this.opaquePassCutoff=0,M=A(),G=M.map((Ye=>x[Ye])));const Ie=this._shadowRenderer;if(Ie){Ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ye in V)for(const je of ce[Ye]){let ut={min:0,max:0};this.terrain&&(ut=this.terrain.getMinMaxForTile(je)||ut),Ie.addShadowReceiver(je.toUnwrapped(),ut.min,ut.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new co(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ce&&!this._snow&&(this._snow=new cg(this)),!Ce&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new oi(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),B){this.buildingTileBorderManager||(this.buildingTileBorderManager=new di);const Ye=this.style.getLayerSourceCache(B);this.buildingTileBorderManager.updateBorders(Ye,B)}if(!mr.has(this.context.gl))return;this.renderPass="offscreen";for(const Ye of G){const je=s.getLayerSourceCache(Ye);if(!Ye.hasOffscreenPass()||Ye.isHidden(this.transform.zoom))continue;const ut=je?ne[je.id]:void 0;(Ye.type==="custom"||Ye.type==="raster"||Ye.type==="raster-particle"||Ye.isSky()||ut&&ut.length)&&this.renderLayer(this,je,Ye,ut)}this.depthRangeFor3D=[0,1-(G.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ke=(()=>{if(c.showOverdrawInspector)return i.ao.black;const Ye=this.style.fog;if(Ye&&this.transform.projection.supportsFog){const je=this.style.getLut(Ye.scope);if(!Me){const ut=Ye.properties.get("color-use-theme")==="none",tt=Ye.properties.get("color").toNonPremultipliedRenderColor(ut?null:je).toArray01();return new i.ao(...tt)}if(Me){const ut=Ye.properties.get("space-color-use-theme")==="none",tt=Ye.properties.get("space-color").toNonPremultipliedRenderColor(ut?null:je).toArray01();return new i.ao(...tt)}}return i.ao.transparent})();if(this.context.clear({color:Ke,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const Ye=G[this.currentLayer],je=s.getLayerSourceCache(Ye);if(Ye.isSky())continue;const ut=je?(Ye.is3D(w)?ve:ne)[je.id]:void 0;this._renderTileClippingMasks(Ye,je,ut),this.renderLayer(this,je,Ye,ut)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Ye=G[this.currentLayer],je=s.getLayerSourceCache(Ye);Ye.isSky()&&this.renderLayer(this,je,Ye,je?ne[je.id]:void 0)}function Be(Ye,je){let ut;return je&&(ut=(Ye.type==="symbol"?he:Ye.is3D(w)?ve:ne)[je.id]),ut}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const Ye=G[this.currentLayer];if(Ye.type==="raster"||Ye.type==="raster-particle"){const je=s.getLayerSourceCache(Ye);this.renderLayer(this,je,Ye,Be(Ye,je))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let at=0;Ie&&(at=Ie.getShadowCastingLayerCount());let Xe=!1,Qe=-1;for(let Ye=0;Ye<M.length;++Ye){const je=G[Ye];je.isHidden(this.transform.zoom)||je.is3D(w)&&(Qe=Ye)}z&&Qe===-1&&(O=!0);let At=!1;for(;this.currentLayer<M.length;){const Ye=G[this.currentLayer],je=s.getLayerSourceCache(Ye);if(Ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ye)){if(Ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!At&&Ye.is3D(w)&&!w){const ut=this.currentLayer,tt=vt=>{for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const Dt=G[this.currentLayer];if(Gl[Dt.type]){const Gt=this.style.getLayerSourceCache(Dt);Gl[Dt.type](this,Gt,Dt,Be(Dt,Gt),vt)}}};tt("initialize"),tt("reset"),this.currentLayer=ut,At=!0}if(O&&!Xe&&this.terrain&&!this.transform.isOrthographic&&(Xe=!0,this.blitDepth()),z&&Qe!==-1&&this.currentLayer===Qe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ye,je,je?ce[je.id]:void 0),this.renderLayer(this,je,Ye,Be(Ye,je)),!this.terrain&&Ie&&at>0&&Ye.hasShadowPass()&&--at==0){{this.clearStencil(),this.resetStencilClippingMasks();const ut=this.currentLayer;for(this.currentLayer=0;this.currentLayer<G.length;this.currentLayer++){const tt=G[this.currentLayer];if(uu[tt.type]){const vt=this.style.getLayerSourceCache(tt);uu[tt.type](this,vt,tt,Be(tt,vt))}}this.currentLayer=ut}if(Ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ut=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ut;this.currentLayer++){const tt=G[this.currentLayer];if(!tt.hasLightBeamPass())continue;const vt=s.getLayerSourceCache(tt);this.renderLayer(this,vt,tt,vt?ne[vt.id]:void 0)}this.currentLayer=ut,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ut=this.currentLayer;this.depthOcclusion=!0;for(const tt of this.layersWithOcclusionOpacity){this.currentLayer=tt;const vt=G[this.currentLayer],Dt=s.getLayerSourceCache(vt),Gt=Dt?ne[Dt.id]:void 0;this.terrain||this._renderTileClippingMasks(vt,Dt,Dt?ce[Dt.id]:void 0),this.renderLayer(this,Dt,vt,Gt)}this.depthOcclusion=!1,this.currentLayer=ut,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ye=null;G.forEach((je=>{const ut=s.getLayerSourceCache(je);ut&&!je.isHidden(this.transform.zoom)&&ut.getVisibleCoordinates().length&&(!Ye||Ye.getSource().maxzoom<ut.getSource().maxzoom)&&(Ye=ut)})),Ye&&this.options.showTileBoundaries&&gd(this,Ye,Ye.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&gd(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Ye){const je=Ye.transform.padding;Ai(Ye,Ye.transform.height-(je.top||0),3,Qr),Ai(Ye,je.bottom||0,3,El),wr(Ye,je.left||0,3,qp),wr(Ye,Ye.transform.width-(je.right||0),3,Of);const ut=Ye.transform.centerPoint;(function(tt,vt,Dt,Gt){rs(tt,vt-1,Dt-10,2,20,Gt),rs(tt,vt-10,Dt-1,20,2,Gt)})(Ye,ut.x,Ye.transform.height-ut.y,md)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),J||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(s.type);if(cu[s.type]&&(p||this.terrain&&s.type==="custom")){const x=this.style.getLayerSourceCache(s);cu[s.type](s,x,this)}this.gpuTimingEnd()}renderLayer(s,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(p.type)&&(!s.terrain||p.type!=="custom")||p.type==="clip"||Ac[p.type](s,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[s.id];x||(x=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(s.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const p in s){const x=s[p],w=this.context.extTimerQuery,A=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),c[p]=A}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of s)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(s,c,p,x,w){if(!p[0]&&!p[1])return s;const A=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(A){const z=Math.sin(A),B=Math.cos(A);p=[p[0]*B-p[1]*z,p[0]*z+p[1]*B]}const M=[w?p[0]:i.ay(c,p[0],this.transform.zoom),w?p[1]:i.ay(c,p[1],this.transform.zoom),0],O=new Float32Array(16);return i.br(O,s,M),O}saveTileTexture(s){if(s.context!==this.context)return;const c=s.size[0],p=this._tileTextures[c];p?p.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,w=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(s,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,w=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(p),A=qu.cacheKey(sd[s],s,w,x);return this.cache[A]||(this.cache[A]=new qu(this.context,s,sd[s],x,C_[s],w)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const w=((A,M,O)=>{const z=A.properties.get("direction"),B=A.properties.get("color-use-theme")==="none",G=A.properties.get("color").toNonPremultipliedRenderColor(B?null:O.getLut(A.scope)).toArray01(),V=A.properties.get("intensity"),Y=M.properties.get("color-use-theme")==="none",J=M.properties.get("color").toNonPremultipliedRenderColor(Y?null:O.getLut(M.scope)).toArray01(),Q=M.properties.get("intensity"),ce=[z.x,z.y,z.z],ne=i.dK(J,Q),he=i.dK(G,V);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:ce,u_lighting_directional_color:he,u_ground_radiance:Wu(ce,he,ne)}})(p,x,this.style);c.setLightsUniformValues(s,w)}}}uploadCommonUniforms(s,c,p,x,w){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const M=A.getOpacity(this.transform.pitch),O=((z,B,G,V,Y,J,Q,ce,ne,he,me,ve)=>{const Pe=z.transform,Ae=B.properties.get("color-use-theme")==="none",Ie=B.properties.get("color").toNonPremultipliedRenderColor(Ae?null:z.style.getLut(B.scope)).toArray01();Ie[3]=V;const Ce=z.frameCounter/1e3%1,[Te,Me]=B.properties.get("vertical-range");return{u_fog_matrix:G?Pe.calculateFogTileMatrix(G):ve||z.identityMat,u_fog_range:B.getFovAdjustedRange(Pe._fov),u_fog_color:Ie,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,Me),Me],u_fog_temporal_offset:Ce,u_frustum_tl:Y,u_frustum_tr:J,u_frustum_br:Q,u_frustum_bl:ce,u_globe_pos:ne,u_globe_radius:he,u_viewport:me,u_globe_transition:i.aj(Pe.zoom),u_is_globe:+(Pe.projection.name==="globe")}})(this,A,p,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],x);c.setFogUniformValues(s,O)}w&&c.setCutoffUniformValues(s,w.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=s[x.key]||new dc(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=gn||c[1]>=gn}setupDepthForOcclusion(s,c,p){const x=this.context,w=x.gl,A=!!p;var M;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),A||c.setTerrainUniformValues(x,p)}}function Xp(m,s){let c=!1,p=null;const x=()=>{p=null,c&&(m(),p=setTimeout(x,s),c=!1)};return()=>(c=!0,p||x(),p)}class Aa{constructor(s){this._hashName=s&&encodeURIComponent(s),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xp(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=Ed(s);if(this._hashName){const p=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map((A=>{const M=A.split("=")[0];return M===p?(x=!0,`${M}=${c}`):A})).filter((A=>A));return x||w.push(`${p}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(c=p)})),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some((p=>isNaN(Number(p))))){const p=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ed(m,s){const c=m.getCenter(),p=Math.round(100*m.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),A=Math.round(c.lng*w)/w,M=Math.round(c.lat*w)/w,O=m.getBearing(),z=m.getPitch();let B=s?`/${A}/${M}/${p}`:`${p}/${M}/${A}`;return(O||z)&&(B+="/"+Math.round(10*O)/10),z&&(B+=`/${Math.round(z)}`),B}const qs={linearity:.3,easing:i.eK(0,0,.3,1)},Cc=Object.assign({deceleration:2500,maxSpeed:1400},qs),lh=Object.assign({deceleration:20,maxSpeed:1400},qs),zf=Object.assign({deceleration:1e3,maxSpeed:360},qs),Nf=Object.assign({deceleration:1e3,maxSpeed:90},qs);class hu{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=i.o.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const w=du(c.pan.mag(),p,Object.assign({},Cc,s||{}));x.offset=c.pan.mult(w.amount/c.pan.mag()),x.center=this._map.transform.center,Ca(x,w)}if(c.zoom){const w=du(c.zoom,p,lh);x.zoom=this._map.transform.zoom+w.amount,Ca(x,w)}if(c.bearing){const w=du(c.bearing,p,zf);x.bearing=this._map.transform.bearing+i.aA(w.amount,-179,179),Ca(x,w)}if(c.pitch){const w=du(c.pitch,p,Nf);x.pitch=this._map.transform.pitch+w.amount,Ca(x,w)}if(x.zoom||x.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Ca(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function du(m,s,c){const{maxSpeed:p,linearity:x,deceleration:w}=c,A=i.aA(m*x/(s/1e3),-p,p),M=Math.abs(A)/(w*x);return{easing:c.easing,duration:1e3*M,amount:A*(M/2)}}class is extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,p,x={}){const w=Ze(c.getCanvasContainer(),p),A=c.unproject(w);super(s,Object.assign({point:w,lngLat:A,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class ch extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,p){const x=s==="touchend"?p.changedTouches:p.touches,w=Ge(c.getCanvasContainer(),x),A=w.map((O=>c.unproject(O))),M=w.reduce(((O,z,B,G)=>O.add(z.div(G.length))),new i.P(0,0));super(s,{points:w,point:M,lngLats:A,lngLat:c.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class Ff extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Yp{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Ff(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new is(s.type,this._map,s))}mouseup(s){this._map.fire(new is(s.type,this._map,s))}preclick(s){const c=new MouseEvent("preclick",s);this._map.fire(new is(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new is(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new is(s.type,this._map,s))}mouseover(s){this._map.fire(new is(s.type,this._map,s))}mouseout(s){this._map.fire(new is(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ch(s.type,this._map,s))}touchmove(s){this._map.fire(new ch(s.type,this._map,s))}touchend(s){this._map.fire(new ch(s.type,this._map,s))}touchcancel(s){this._map.fire(new ch(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kp{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new is(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new is("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new is(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ss{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(ye(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const p=c,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const A=Math.min(x.x,p.x),M=Math.max(x.x,p.x),O=Math.min(x.y,p.y),z=Math.max(x.y,p.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${A}px,${O}px)`,this._box.style.width=M-A+"px",this._box.style.height=z-O+"px")}))}mouseupWindow(s,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&s.button===0){if(this.reset(),Le(),p.x!==x.x||p.y!==x.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ge(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new i.z(s,{originalEvent:c}))}}function Bf(m,s){const c={};for(let p=0;p<m.length;p++)c[m[p].identifier]=s[p];return c}class So{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const w=new i.P(0,0);for(const A of x)w._add(A);return w.div(x.length)})(c),this.touches=Bf(p,c)))}touchmove(s,c,p){if(this.aborted||!this.centroid)return;const x=Bf(p,c);for(const w in this.touches){const A=x[w];(!A||A.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,c,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Fs{constructor(s){this.singleTap=new So(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,p){this.singleTap.touchstart(s,c,p)}touchmove(s,c,p){this.singleTap.touchmove(s,c,p)}touchend(s,c,p){const x=this.singleTap.touchend(s,c,p);if(x){const w=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(x)<30;if(w&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class fu{constructor(){this._zoomIn=new Fs({numTouches:1,numTaps:2}),this._zoomOut=new Fs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,p){this._zoomIn.touchstart(s,c,p),this._zoomOut.touchstart(s,c,p)}touchmove(s,c,p){this._zoomIn.touchmove(s,c,p),this._zoomOut.touchmove(s,c,p)}touchend(s,c,p){const x=this._zoomIn.touchend(s,c,p),w=this._zoomOut.touchend(s,c,p);return x?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(x)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jp={0:1,2:2},Uf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ad{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const p=gt(s);this._correctButton(s,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(s,c){const p=this._lastPoint;if(p){if(s.preventDefault(),this._eventButton!=null&&(function(x,w){const A=Jp[w];return x.buttons===void 0||(x.buttons&A)!==A})(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(s){this._lastPoint&&gt(s)===this._eventButton&&(this._moved&&Le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uh extends Ad{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Cd extends Ad{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Uf[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const p=.8*(c.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class Vf extends Ad{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Uf[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const p=-.5*(c.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class $f{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(s,c,p){return this._calculateTransform(s,c,p)}touchmove(s,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,p)}}touchend(s,c,p){this._calculateTransform(s,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,p){p.length>0&&(this._active=!0);const x=Bf(p,c),w=new i.P(0,0),A=new i.P(0,0);let M=0;for(const z in x){const B=x[z],G=this._touches[z];G&&(w._add(B),A._add(B.sub(G)),M++,x[z]=B)}if(this._touches=x,M<this._minTouches||!A.mag())return;const O=A.div(M);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(M),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class hh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,p){return{}}touchstart(s,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,p){const x=this._firstTwoTouches;if(!x)return;s.preventDefault();const[w,A]=x,M=dh(p,c,w),O=dh(p,c,A);if(!M||!O)return;const z=this._aroundCenter?null:M.add(O).div(2);return this._move([M,O],z,s)}touchend(s,c,p){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,A=dh(p,c,x),M=dh(p,c,w);A&&M||(this._active&&Le(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function dh(m,s,c){for(let p=0;p<m.length;p++)if(m[p].identifier===c)return s[p]}function Pd(m,s){return Math.log2(m/s)}class Qp extends hh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Pd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pd(this._distance,p),pinchAround:c}}}function em(m,s){return 180*m.angleWith(s)/Math.PI}class tm extends hh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const p=this._vector;if(this._vector=s[0].sub(s[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:em(this._vector,p),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=em(s,p);return Math.abs(x)<c}}function fh(m){return Math.abs(m.y)>Math.abs(m.x)}class I_ extends hh{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,fh(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,p){const x=this._lastPoints;if(!x)return;const w=s[0].sub(x[0]),A=s[1].sub(x[1]);return this._map._cooperativeGestures&&!i.eL()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(w,A,p.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5})}gestureBeginsVertically(s,c,p){if(this._valid!==void 0)return this._valid;const x=s.mag()>=2,w=c.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=s.y>0==c.y>0;return fh(s)&&fh(c)&&A}}const hg={panStep:100,bearingStep:15,pitchStep:10};class nm{constructor(){const s=hg;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,p=0,x=0,w=0,A=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?x=1:(s.preventDefault(),A=-1);break;case 40:s.shiftKey?x=-1:(s.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:M=>{const O=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:dg,zoom:c?Math.round(O)+c*(s.shiftKey?2:1):O,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-A*this._panStep],center:M.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dg(m){return m*(2-m)}const Id=4.000244140625,Wl=1/450;class M_{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Wl,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||i.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=i.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%Id==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ze(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Id?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&B!==0&&(B=1/B);const G=c(),V=Math.pow(2,G),Y=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(Y*B))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,w=this._easing;let A,M=!1;if(this._type==="wheel"&&x&&w){const z=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),B=w(z);A=i.ak(x,p,B),z<1?this._frameId||(this._frameId=!0):M=!0}else A=p,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let O=A-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=i.eM;if(this._prevEase){const p=this._prevEase,x=(i.o.now()-p.start)/p.duration,w=p.easing(x+.01)-p.easing(x),A=.27/Math.sqrt(w*w+1e-4)*.01,M=Math.sqrt(.0729-A*A);c=i.eK(A,M,.25,1)}return this._prevEase={start:i.o.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class fg{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class k_{constructor(){this._tap=new Fs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,c,p))}touchmove(s,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,c,p)}touchend(s,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(s,c,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class R_{constructor(s,c,p){this._el=s,this._mousePan=c,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hf{constructor(s,c,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rr{constructor(s,c,p,x){this._el=s,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Gf=m=>m.zoom||m.drag||m.pitch||m.rotate;class Wy extends i.z{}class im{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const p=i.av([],c,s);this.radius=i.ag(p[2]<0?i.eO([],p,this.constants):[p[0],p[1],0])}projectRay(s){i.eO(s,s,this.constants),i.aw(s,s),i.eP(s,s,this.constants);const c=i.c4([],s,this.radius);if(c[2]>0){const p=i.c4([],[0,0,1],i.bJ(c,[0,0,1])),x=i.c4([],i.aw([],[c[0],c[1],0]),this.radius),w=i.d7([],c,i.c4([],i.av([],i.d7([],x,p),c),2));c[0]=w[0],c[1]=w[1]}return c}}function Bs(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Wf{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hu(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new im,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,A]of this._listeners){const M=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,M,A)}}destroy(){for(const[s,c,p]of this._listeners){const x=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,x,p)}}_addDefaultHandlers(s){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Yp(c,s));const x=c.boxZoom=new ss(c,s);this._add("boxZoom",x);const w=new fu,A=new rm;c.doubleClickZoom=new fg(A,w),this._add("tapZoom",w),this._add("clickZoom",A);const M=new k_;this._add("tapDragZoom",M);const O=c.touchPitch=new I_(c);this._add("touchPitch",O);const z=new Cd(s),B=new Vf(s);c.dragRotate=new Hf(s,z,B),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const G=new uh(s),V=new $f(c,s);c.dragPan=new R_(p,G,V),this._add("mousePan",G),this._add("touchPan",V,["touchZoom","touchRotate"]);const Y=new tm,J=new Qp;c.touchZoomRotate=new Rr(p,J,Y,M),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Kp(c));const Q=c.scrollZoom=new M_(c,this);this._add("scrollZoom",Q,["mousePan"]);const ce=c.keyboard=new nm;this._add("keyboard",ce);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ne]&&c[ne].enable(s[ne])}_add(s,c,p){this._handlers.push({handlerName:s,handler:c,allowed:p}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,p){for(const x in s)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const p of s)this._el.contains(p.target)&&c.push(p);return c}handleEvent(s,c){this._updatingCamera=!0;const p=s.type==="renderFrame",x=p?void 0:s,w={needsRenderFrame:!1},A={},M={},O=s.touches?this._getMapTouches(s.touches):void 0,z=O?Ge(this._el,O):p?void 0:Ze(this._el,s);for(const{handlerName:V,handler:Y,allowed:J}of this._handlers){if(!Y.isEnabled())continue;let Q;this._blockedByActive(M,J,V)?Y.reset():Y[c||s.type]&&(Q=Y[c||s.type](s,z,O),this.mergeHandlerResult(w,A,Q,V,x),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||Y.isActive())&&(M[V]=Y)}const B={};for(const V in this._previousActiveHandlers)M[V]||(B[V]=x);this._previousActiveHandlers=M,(Object.keys(B).length||Bs(w))&&(this._changes.push([w,A,B]),this._triggerRenderFrame()),(Object.keys(M).length||Bs(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=w;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(s,c,p,x,w){if(!p)return;Object.assign(s,p);const A={handlerName:x,originalEvent:p.originalEvent||w};p.zoomDelta!==void 0&&(c.zoom=A),p.panDelta!==void 0&&(c.drag=A),p.pitchDelta!==void 0&&(c.pitch=A),p.bearingDelta!==void 0&&(c.rotate=A)}_applyChanges(){const s={},c={},p={};for(const[x,w,A]of this._changes)x.panDelta&&(s.panDelta=(s.panDelta||new i.P(0,0))._add(x.panDelta)),x.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(s.around=x.around),x.aroundCoord!==void 0&&(s.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(s.pinchAround=x.pinchAround),x.noInertia&&(s.noInertia=x.noInertia),Object.assign(c,w),Object.assign(p,A);this._updateMapTransform(s,c,p),this._changes=[]}_updateMapTransform(s,c,p){const x=this._map,w=x.transform,A=he=>[he.x,he.y,he.z];if((he=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!Bs(s)){const he=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),he!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!Bs(s))return void this._fireEvents(c,p,!0);let{panDelta:M,zoomDelta:O,bearingDelta:z,pitchDelta:B,around:G,aroundCoord:V,pinchAround:Y}=s;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),Y!==void 0&&(G=Y),(O||(he=>c[he]&&!this._eventsInProgress[he])("drag"))&&G&&(this._dragOrigin=A(w.pointCoordinate3D(G)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),G=G||x.transform.centerPoint,z&&(w.bearing+=z),B&&(w.pitch+=B),w._updateCameraState();const J=[0,0,0];if(M)if(w.projection.name==="mercator"){const he=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(G).dir),me=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(G.sub(M)).dir);J[0]=me[0]-he[0],J[1]=me[1]-he[1]}else{const he=w.pointCoordinate(G);if(w.projection.name==="globe"){M=M.rotate(-w.angle);const me=w._pixelsPerMercatorPixel/w.worldSize;J[0]=-M.x*i.eN(i.a$(he.y))*me,J[1]=-M.y*i.eN(w.center.lat)*me}else{const me=w.pointCoordinate(G.sub(M));he&&me&&(J[0]=me.x-he.x,J[1]=me.y-he.y)}}const Q=w.zoom,ce=[0,0,0];if(O){const he=A(V||w.pointCoordinate3D(G)),me={dir:i.aw([],i.av([],he,w._camera.position))};if(me.dir[2]<0){const ve=w.zoomDeltaToMovement(he,O);i.c4(ce,me.dir,ve)}}const ne=i.d7(J,J,ce);w._translateCameraConstrained(ne),O&&Math.abs(w.zoom-Q)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,p,!0)}_fireEvents(s,c,p){const x=Gf(this._eventsInProgress),w=Gf(s),A={};for(const B in s){const{originalEvent:G}=s[B];this._eventsInProgress[B]||(A[`${B}start`]=G),this._eventsInProgress[B]=s[B]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const B in A)this._fireEvent(B,A[B]);w&&this._fireEvent("move",w.originalEvent);for(const B in s){const{originalEvent:G}=s[B];this._fireEvent(B,G)}const M={};let O;for(const B in this._eventsInProgress){const{handlerName:G,originalEvent:V}=this._eventsInProgress[B];this._handlersById[G].isActive()||(delete this._eventsInProgress[B],O=c[G]||V,M[`${B}end`]=O)}for(const B in M)this._fireEvent(B,M[B]);const z=Gf(this._eventsInProgress);if(p&&(x||w)&&!z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;B?(G(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:O})):(this._map.fire(new i.z("moveend",{originalEvent:O})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new i.z(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((s=>{this._frameId=void 0,this.handleEvent(new Wy("renderFrame",{timeStamp:s})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const er="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class pu extends i.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,p){return s=i.P.convert(s).mult(-1),this.panTo(this.transform.center,Object.assign({offset:s},c),p)}panTo(s,c,p){return this.easeTo(Object.assign({center:s},c),p)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,p){return this.easeTo(Object.assign({zoom:s},c),p)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,p){return this.easeTo(Object.assign({bearing:s},c),p)}resetNorth(s,c){return this.rotateTo(0,Object.assign({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=i.aI.convert(s);const p=c&&c.bearing||0,x=c&&c.pitch||0,w=s.getNorthWest(),A=s.getSouthEast();return this._cameraForBounds(this.transform,w,A,p,x,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return s==null?Object.assign({},c,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:Object.assign({},c,s)}_extendCameraOptions(s){return(s=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>s.aspect?p/(2*Math.tan(.5*s.fovX)*s.aspect):x/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,p,x,w,A){const M=s.clone(),O=this._extendCameraOptions(A);M.bearing=x,M.pitch=w;const z=i.aR.convert(c),B=i.aR.convert(p),G=.5*(z.lat+B.lat),V=.5*(z.lng+B.lng),Y=i.eQ(G,V),J=i.aw([],Y),Q=i.aw([],i.bI([],J,[0,1,0])),ce=i.bI([],Q,J),ne=[Q[0],Q[1],Q[2],0,ce[0],ce[1],ce[2],0,J[0],J[1],J[2],0,0,0,0,1],he=[Y,i.eQ(z.lat,z.lng),i.eQ(B.lat,z.lng),i.eQ(B.lat,B.lng),i.eQ(z.lat,B.lng),i.eQ(G,z.lng),i.eQ(G,B.lng),i.eQ(z.lat,V),i.eQ(B.lat,V)];let me=i.d8.fromPoints(he.map((tt=>[i.bJ(Q,tt),i.bJ(ce,tt),i.bJ(J,tt)])));const ve=i.af([],me.center,ne);i.eR(ve)===0&&i.eS(ve,0,0,1),i.aw(ve,ve),i.c4(ve,ve,i.aD),M.center=i.eT(ve);const Pe=M.getWorldToCameraMatrix(),Ae=i.bl(new Float64Array(16),Pe);me=i.d8.applyTransform(me,i.aB([],Pe,ne));const Ie=this._extendAABB(me,M,O,x);if(!Ie)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Ie,i.af(ve,ve,Pe);const Ce=.5*(me.max[2]-me.min[2]),Te=this._minimumAABBFrustumDistance(M,me),Me=i.c4([],[0,0,1],Ce),Ke=i.d7(Me,ve,Me),Be=Te+(M.pitch===0?0:i.bG(ve,Ke)),at=M.globeCenterInViewSpace,Xe=i.av([],ve,[at[0],at[1],at[2]]);i.aw(Xe,Xe),i.c4(Xe,Xe,Be);const Qe=i.d7([],ve,Xe);i.af(Qe,Qe,Ae);const At=i.eD/i.aD,Ye=i.ag(Qe),je=i.ce(Math.max(Ye*At-i.eD,Number.EPSILON),0),ut=Math.min(M.zoomFromMercatorZAdjusted(je),O.maxZoom);return ut>.5*(i.cZ+i.cK)?(M.setProjection({name:"mercator"}),M.zoom=ut,this._cameraForBounds(M,c,p,x,w,A)):{center:M.center,zoom:ut,bearing:x,pitch:w}}_extendAABB(s,c,p,x){const w=.5*((p.padding.left||0)+(p.padding.right||0)),A=.5*((p.padding.top||0)+(p.padding.bottom||0)),M=A,O=w,z=w,B=A,G=c.width-(O+z),V=c.height-(M+B),Y=i.av([],s.max,s.min),J=Math.min(G/Y[0],V/Y[1]),Q=Math.min(c.scaleZoom(c.scale*J),p.maxZoom);if(isNaN(Q))return null;const ce=c.scale/c.zoomScale(Q),ne=new i.d8([s.min[0]-O*ce,s.min[1]-B*ce,s.min[2]],[s.max[0]+z*ce,s.max[1]+M*ce,s.max[2]]),he=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new i.P(p.offset.x,p.offset.y):i.P.convert(p.offset)).rotate(-i.an(x));return ne.center[0]-=he.x*ce,ne.center[1]+=he.y*ce,ne}queryTerrainElevation(s,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(i.ae.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,p,x,w,A){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,p,x,w,A);const M=s.clone(),O=this._extendCameraOptions(A);M.bearing=x,M.pitch=w;const z=i.aR.convert(c),B=i.aR.convert(p),G=new i.aR(z.lng,B.lat),V=new i.aR(B.lng,z.lat),Y=M.project(z),J=M.project(B),Q=this.queryTerrainElevation(z),ce=this.queryTerrainElevation(B),ne=this.queryTerrainElevation(G),he=this.queryTerrainElevation(V),me=[[Y.x,Y.y,Math.min(Q||0,ce||0,ne||0,he||0)],[J.x,J.y,Math.max(Q||0,ce||0,ne||0,he||0)]];let ve=i.d8.fromPoints(me);const Pe=M.getWorldToCameraMatrix(),Ae=i.bl(new Float64Array(16),Pe);ve=i.d8.applyTransform(ve,Pe);const Ie=this._extendAABB(ve,M,O,x);if(!Ie)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Ie;const Ce=.5*i.av([],ve.max,ve.min)[2],Te=this._minimumAABBFrustumDistance(M,ve),Me=[0,0,1,0];i.aC(Me,Me,Pe),i.eU(Me,Me);const Ke=i.c4([],Me,Te+Ce),Be=i.d7([],ve.center,Ke);i.af(ve.center,ve.center,Ae),i.af(Be,Be,Ae);const at=M.unproject(new i.P(ve.center[0],ve.center[1])),Xe=i.eV(M.projection,at),Qe=Math.pow(2,Xe),At=Math.min(M._zoomFromMercatorZ(Be[2]*M.pixelsPerMeter*Qe/M.worldSize),O.maxZoom);return M.mercatorFromTransition&&At<.5*(i.cZ+i.cK)?(M.setProjection({name:"globe"}),M.zoom=At,this._cameraForBounds(M,c,p,x,w,A)):{center:at,zoom:At,bearing:x,pitch:w}}fitBounds(s,c,p){const x=this.cameraForBounds(s,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(s,c,p,x,w){const A=i.P.convert(s),M=i.P.convert(c),O=new i.P(Math.min(A.x,M.x),Math.min(A.y,M.y)),z=new i.P(Math.max(A.x,M.x),Math.max(A.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,M))return this;const B=this.transform.pointLocation3D(O),G=this.transform.pointLocation3D(z),V=this.transform.pointLocation3D(new i.P(O.x,z.y)),Y=this.transform.pointLocation3D(new i.P(z.x,O.y)),J=[Math.min(B.lng,G.lng,V.lng,Y.lng),Math.min(B.lat,G.lat,V.lat,Y.lat)],Q=[Math.max(B.lng,G.lng,V.lng,Y.lng),Math.max(B.lat,G.lat,V.lat,Y.lat)],ce=x&&x.pitch?x.pitch:this.getPitch(),ne=this._cameraForBounds(this.transform,J,Q,p,ce,x);return this._fitInternal(ne,x,w)}_fitInternal(s,c,p){return s?(c=Object.assign(s,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(s,c){this.stop();const p=s.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,A=!1;"zoom"in s&&p.zoom!==+s.zoom&&(x=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=i.aR.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(w=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(A=!0,p.pitch=+s.pitch);const M=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!p.isPaddingEqual(M))if(s.retainPadding===!1){const O=p.clone();O.padding=M,p.setLocationAtPoint(p.center,O.centerPoint)}else p.padding=M;return s.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),x&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),w&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),A&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(er),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return i.w(er),this;this.stop();const x=p.zoom,w=p.pitch,A=p.bearing;p.setFreeCameraOptions(s);const M=x!==p.zoom,O=w!==p.pitch,z=A!==p.bearing;return this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),M&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),z&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),O&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=Object.assign({offset:[0,0],duration:500,easing:i.eM},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const p=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),M=this.getPadding(),O="zoom"in s?+s.zoom:x,z="bearing"in s?this._normalizeBearing(s.bearing,w):w,B="pitch"in s?+s.pitch:A,G=this._extendPadding(s.padding),V=i.P.convert(s.offset);let Y,J,Q;if(p.projection.name==="globe"){const Me=i.ae.fromLngLat(p.center),Ke=V.rotate(-p.angle);Me.x+=Ke.x/p.worldSize,Me.y+=Ke.y/p.worldSize;const Be=Me.toLngLat(),at=i.aR.convert(s.center||Be);this._normalizeCenter(at),Y=p.centerPoint.add(Ke),J=new i.P(Me.x,Me.y).mult(p.worldSize),Q=new i.P(i.aF(at.lng),i.aJ(at.lat)).mult(p.worldSize).sub(J)}else{Y=p.centerPoint.add(V);const Me=p.pointLocation(Y),Ke=i.aR.convert(s.center||Me);this._normalizeCenter(Ke),J=p.project(Me),Q=p.project(Ke).sub(J)}const ce=p.zoomScale(O-x);let ne,he;s.around&&(ne=i.aR.convert(s.around),he=p.locationPoint(ne));const me=this._zooming||O!==x,ve=this._rotating||w!==z,Pe=this._pitching||B!==A,Ae=!p.isPaddingEqual(G),Ie=s.retainPadding===!1?p.clone():p,Ce=Me=>Ke=>{if(me&&(Me.zoom=i.ak(x,O,Ke)),ve&&(Me.bearing=i.ak(w,z,Ke)),Pe&&(Me.pitch=i.ak(A,B,Ke)),Ae&&(Ie.interpolatePadding(M,G,Ke),Y=Ie.centerPoint.add(V)),ne)Me.setLocationAtPoint(ne,he);else{const Be=Me.zoomScale(Me.zoom-x),at=O>x?Math.min(2,ce):Math.max(.5,ce),Xe=Math.pow(at,1-Ke),Qe=Me.unproject(J.add(Q.mult(Ke*Xe)).mult(Be));Me.setLocationAtPoint(Me.renderWorldCopies?Qe.wrap():Qe,Y)}return s.preloadOnly||this._fireMoveEvents(c),Me};if(s.preloadOnly){const Me=this._emulate(Ce,s.duration,p);return this._preloadTiles(Me),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=ve,this._pitching=Pe,this._padding=Ae,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,Te),this._ease(Ce(p),(Me=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Me)}),s),this}_prepareEase(s,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new i.z("movestart",s)),this._zooming&&!p.zooming&&this.fire(new i.z("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new i.z("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new i.z("pitchstart",s))}_fireMoveEvents(s){this.fire(new i.z("move",s)),this._zooming&&this.fire(new i.z("zoom",s)),this._rotating&&this.fire(new i.z("rotate",s)),this._pitching&&this.fire(new i.z("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.z("zoomend",s)),x&&this.fire(new i.z("rotateend",s)),w&&this.fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const tt=i.aH(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(tt,c)}this.stop(),s=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eM},s);const p=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),M=this.getPadding(),O="zoom"in s?i.aA(+s.zoom,p.minZoom,p.maxZoom):x,z="bearing"in s?this._normalizeBearing(s.bearing,w):w,B="pitch"in s?+s.pitch:A,G=this._extendPadding(s.padding),V=p.zoomScale(O-x),Y=i.P.convert(s.offset);let J=p.centerPoint.add(Y);const Q=p.pointLocation(J),ce=i.aR.convert(s.center||Q);this._normalizeCenter(ce);const ne=p.project(Q),he=p.project(ce).sub(ne);let me=s.curve;const ve=Math.max(p.width,p.height),Pe=ve/V,Ae=he.mag();if("minZoom"in s){const tt=i.aA(Math.min(s.minZoom,x,O),p.minZoom,p.maxZoom),vt=ve/p.zoomScale(tt-x);me=Math.sqrt(vt/Ae*2)}const Ie=me*me;function Ce(tt){const vt=(Pe*Pe-ve*ve+(tt?-1:1)*Ie*Ie*Ae*Ae)/(2*(tt?Pe:ve)*Ie*Ae);return Math.log(Math.sqrt(vt*vt+1)-vt)}function Te(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Me(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Ke=Ce(0);let Be=function(tt){return Me(Ke)/Me(Ke+me*tt)},at=function(tt){return ve*((Me(Ke)*(Te(vt=Ke+me*tt)/Me(vt))-Te(Ke))/Ie)/Ae;var vt},Xe=(Ce(1)-Ke)/me;if(Math.abs(Ae)<1e-6||!isFinite(Xe)){if(Math.abs(ve-Pe)<1e-6)return this.easeTo(s,c);const tt=Pe<ve?-1:1;Xe=Math.abs(Math.log(Pe/ve))/me,at=function(){return 0},Be=function(vt){return Math.exp(tt*me*vt)}}s.duration="duration"in s?+s.duration:1e3*Xe/("screenSpeed"in s?+s.screenSpeed/me:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Qe=w!==z,At=B!==A,Ye=!p.isPaddingEqual(G),je=s.retainPadding===!1?p.clone():p,ut=tt=>vt=>{const Dt=vt*Xe,Gt=1/Be(Dt);tt.zoom=vt===1?O:x+tt.scaleZoom(Gt),Qe&&(tt.bearing=i.ak(w,z,vt)),At&&(tt.pitch=i.ak(A,B,vt)),Ye&&(je.interpolatePadding(M,G,vt),J=je.centerPoint.add(Y));const Pt=vt===1?ce:tt.unproject(ne.add(he.mult(at(Dt))).mult(Gt));return tt.setLocationAtPoint(tt.renderWorldCopies?Pt.wrap():Pt,J),tt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),tt};if(s.preloadOnly){const tt=this._emulate(ut,s.duration,p);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=Qe,this._pitching=At,this._padding=Ye,this._prepareEase(c,!1),this._ease(ut(p),(()=>this._afterEase(c)),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,c,p){p.animate===!1||p.duration===0?(s(1),c()):(this._easeStart=i.o.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=i.bT(s,-180,180);const p=Math.abs(s-c);return Math.abs(s-360-c)<p&&(s-=360),Math.abs(s+360-c)<p&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=s.lng-c.center.lng;s.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,p){const x=Math.ceil(15*c/1e3),w=[],A=s(p.clone());for(let M=0;M<=x;M++){const O=A(M/x);w.push(O.clone())}return w}_preloadTiles(s,c){}}class ph{constructor(s={}){this.options=s,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,p=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=q("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(s){const p=c.reduce(((x,w,A)=>(w.value&&(x+=`${w.key}=${w.value}${A<c.length-1?"&":""}`),x)),"?");s.href=`${i.e.FEEDBACK_URL}/${p}#${Ed(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||(s.dataType!=="source"||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility")&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const w=c[x];if(w.used){const A=w.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s.sort(((x,w)=>x.length-w.length)),s=s.filter(((x,w)=>{for(let A=w+1;A<s.length;A++)if(s[A].indexOf(x)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Al{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=q("div","mapboxgl-ctrl");const c=q("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const p=s[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class qf{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(c=>this._onIndoorUpdate({selectedFloorId:c.selectedFloorId,floors:c.floors}))),this._container}_createButton(s,c){const p=q("button",s,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return q("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(s,c){this._map&&(s.setAttribute("aria-label",c),s.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return void(this._container.style.display="none");const c=this._model;this._model=s,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const p=s.floors.sort(((x,w)=>w.levelOrder-x.levelOrder));c?(Array.from(this._container.children).forEach((x=>x.remove())),this.addCurrentFloors(p)):this.addCurrentFloors(p)}addCurrentFloors(s){for(let c=0;c<s.length;c++){const p=s[c],x=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(p.id),this._model&&(this._model.selectedFloorId=p.id),Array.from(this._container.children).forEach((w=>{w.classList.contains("mapboxgl-ctrl-level-button")&&w.classList.remove("mapboxgl-ctrl-level-button-selected")})),x.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(x,p.shortName),this._model&&p.id===this._model.selectedFloorId&&x.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(x),c<s.length-1&&this._createSeparator()}}}class ki{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===s)return void(x.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Pa{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=i.dz((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,p){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+p}}const mh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Md extends i.z{constructor(s,c,p,x){const{point:w,lngLat:A,originalEvent:M,target:O}=s;super(s.type,{point:w,lngLat:A,originalEvent:M,target:O}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class pg{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(s,i.b6(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const w=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,c)):w.size===0&&this.map.on(x,this.handleType),w.size===0&&this.interactionsByType.set(x,w),w.set(s,c),this.typeById.set(s,x)}get(s){const c=this.typeById.get(s);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(s):void 0}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const p=this.interactionsByType.get(c);p&&(p.delete(s),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(s,c){const p=[];for(const[x,w]of c)w.target&&p.push({targetId:x,target:w.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(s,p,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());c.length&&(s.type="mouseenter",this.handleType(s,c));const p=new Map;for(const[x,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(w.id,w);p.size&&(s.type="mouseleave",this.handleType(s,Array.from(p.values())))}handleOut(s){const c=Array.from(this.hoveredFeatures.values()).map((({feature:p})=>p));c.length&&(s.type="mouseleave",this.handleType(s,c)),this.hoveredFeatures.clear()}handleType(s,c){const p=s.type==="mouseenter";if(p&&!this.interactionsByType.has(s.type))return void i.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(s.type)).reverse(),w=!!c;c=c||this.queryTargets(s.point,x);let A=!1;const M=new Set;for(const O of c){for(const[z,B]of x){if(!B.target)continue;const G=O.variants?O.variants[z]:null;if(G){for(const V of G){if(Bc(V,O,M,z))continue;const Y=new i.dt(O,V),J=Fc(V,O,z);w&&(Y.state=this.map.getFeatureState(Y));const Q=p?this.prevHoveredFeatures.get(J):null,ce=new Md(s,z,B,Y),ne=Q?Q.stop:B.handler(ce);if(p&&this.hoveredFeatures.set(J,{feature:O,stop:ne}),ne!==!1){A=!0;break}}if(A)break}}if(A)break}if(!A)for(const[O,z]of x){const{handler:B,target:G}=z;if(!G&&B(new Md(s,O,z,null))!==!1)break}}}function O_(m,s){if(Array.isArray(m)&&Array.isArray(s)){const c=new Set(m),p=new Set(s);return c.size===p.size&&m.every((x=>p.has(x)))}return i.by(m,s)}const gh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},mg={showCompass:!0,showZoom:!0,visualizePitch:!1};class uo{constructor(s,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Cd({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new Vf({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),ye()}move(s,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(s,c),w=x&&x.bearingDelta;if(w&&p.setBearing(p.getBearing()+w),this.mousePitch){const A=this.mousePitch.mousemoveWindow(s,c),M=A&&A.pitchDelta;M&&p.setPitch(p.getPitch()+M)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ge(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(Object.assign({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Ze(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Ze(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ge(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ge(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ra(m,s,c){if(m=new i.aR(m.lng,m.lat),s){const p=new i.aR(m.lng-360,m.lat),x=new i.aR(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-c.center.lng)/360),A=c.locationPoint3D(m).distSqr(s),M=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint3D(p).distSqr(s)<A&&(M||Math.abs(p.lng-c.center.lng)<w)?m=p:c.locationPoint3D(x).distSqr(s)<A&&(M||Math.abs(x.lng-c.center.lng)<w)&&(m=x)}for(;Math.abs(m.lng-c.center.lng)>180;){const p=c.locationPoint3D(m);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ia={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class mu extends i.E{constructor(s,c){super(),(s instanceof HTMLElement||c)&&(s=Object.assign({element:s},c)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:w=1,draggable:A=!1,clickTolerance:M=0,rotation:O=ia.rotation,rotationAlignment:z=ia.rotationAlignment,pitchAlignment:B=ia.pitchAlignment,occludedOpacity:G=ia.occludedOpacity,altitude:V=ia.altitude}=s||{};this._anchor=p,this._color=x,this._scale=w,this._draggable=A,this._clickTolerance=M,this._rotation=O,this._rotationAlignment=z,this._pitchAlignment=B,this._occludedOpacity=G,this._altitude=V,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=i.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(Q=>{Q.preventDefault()})),this._element.addEventListener("mousedown",(Q=>{Q.preventDefault()}));const Y=this._element.classList;for(const Q in nl)Y.remove(`mapboxgl-marker-anchor-${Q}`);Y.add(`mapboxgl-marker-anchor-${this._anchor}`);const J=s&&s.className?s.className.trim().split(/\s+/):[];Y.add(...J),this._popup=null}_createDefaultMarker(){const s=q("div"),c=X("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const p=X("radialGradient",{id:"shadowGradient"},X("defs",{},c));X("stop",{offset:"10%","stop-opacity":.4},p),X("stop",{offset:"100%","stop-opacity":.05},p),X("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return X("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),X("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),X("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=i.aR.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||ia.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,p=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const p=s.unproject(c,this._altitude),x=s.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(p)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const p=s.unproject(c,this._altitude);let x;s._showingGlobe()&&i.eY(s.transform,this._lngLat)?x=0:(x=1-s._queryFogOpacity(p),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${nl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!s||p!=="map")return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const x=i.cW(i.eZ(c.transform,this._lngLat)),w=s.sub(i.e_(c.transform)),A=Math.abs(w.x)+Math.abs(w.y);if(A===0)return"";const M=x/A;return`rotateX(${-w.y*M}deg) rotateY(${w.x*M}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const w=c.project(new i.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),A=c.project(new i.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);p=i.cW(Math.atan2(A.y,A.x))-90}else p=-c.getBearing();else if(x==="horizon"){const w=i.ah(4,6,c.getZoom()),A=i.e_(c.transform);A.y+=w*c.transform.height;const M=s.sub(A),O=i.cW(Math.atan2(M.y,M.x));p=(O>90?O-270:O+90)*(1-w)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=ra(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),c._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(s){return this._offset=i.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(s.point.dist(p)<w)return;this._isDragging=!0}this._pos=s.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,p=this._pos;c&&p&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(p),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||ia.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||ia.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||ia.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||ia.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Zs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ql={maxWidth:100,unit:"metric"},Xs={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_h={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gg(m=new i.P(0,0),s="bottom"){if(typeof m=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new i.P(0,m);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-m);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(m,0);case"right":return new i.P(-m,0)}return new i.P(0,0)}return m instanceof i.P||Array.isArray(m)?i.P.convert(m):i.P.convert(m[s]||[0,0])}return{version:E,supported:Z.supported,setRTLTextPlugin:i.f2,getRTLTextPluginStatus:i.f1,Map:class extends pu{constructor(m){I.mark(P.create);const s=m;if((m=Object.assign({},gh,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.eW(window)&&(m.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cs(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new ki,this._domRenderTaskQueue=new ki,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},mh,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Jt(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const c=document.getElementById(m.container);if(!c)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=c}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new oh),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Wf(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||i.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new gc(this),m.hash&&(this._hash=new Aa(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const c=m.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new ph({customAttribution:m.customAttribution})),this._logoControl=new Al,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(c=>{this._update(c.dataType==="style"),this.fire(new i.z(`${c.dataType}data`,c))})),this.on("dataloading",(c=>{this.fire(new i.z(`${c.dataType}dataloading`,c))})),this._interactions=new pg(this)}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new i.z("movestart",m)).fire(new i.z("move",m)),this.fire(new i.z("resize",m)),s&&this.fire(new i.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((s=>s.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map((s=>s==="auto"?navigator.language:s)):m}setLanguage(m){const s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,s=m.projection.name;let c;s==="globe"&&m.zoom>=i.cK?(m.setMercatorFromTransition(),c=!0):s==="mercator"&&m.zoom<i.cK&&(m.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s=m.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,s){return this.transform.locationPoint3D(i.aR.convert(m),s)}unproject(m,s){return this.transform.pointLocation3D(i.P.convert(m),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,c){const p=x=>{let w=[];if(Array.isArray(s)){const A=s.filter((M=>this.getLayer(M)));w=A.length?this.queryRenderedFeatures(x,{layers:A}):[]}else w=this.queryRenderedFeatures(x,{target:s});return w};if(m==="mouseenter"||m==="mouseover"){let x=!1;return{listener:c,targets:s,delegates:{mousemove:A=>{const M=p(A.point);M.length?x||(x=!0,c.call(this,new is(m,this,A.originalEvent,{features:M}))):x=!1},mouseout:()=>{x=!1}}}}if(m==="mouseleave"||m==="mouseout"){let x=!1;return{listener:c,targets:s,delegates:{mousemove:M=>{p(M.point).length?x=!0:x&&(x=!1,c.call(this,new is(m,this,M.originalEvent)))},mouseout:M=>{x&&(x=!1,c.call(this,new is(m,this,M.originalEvent)))}}}}{const x=w=>{const A=p(w.point);A.length&&(w.features=A,c.call(this,w),delete w.features)};return{listener:c,targets:s,delegates:{[m]:x}}}}on(m,s,c){if(typeof s=="function"||c===void 0)return super.on(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const p=this._createDelegatedListener(m,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(m,s,c){if(typeof s=="function"||c===void 0)return super.once(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const p=this._createDelegatedListener(m,s,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(m,s,c){if(typeof s=="function"||c===void 0)return super.off(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const p=this._delegatedListeners?this._delegatedListeners[m]:void 0;return p&&(x=>{for(let w=0;w<x.length;w++){const A=x[w];if(A.listener===c&&O_(A.targets,s)){for(const M in A.delegates)this.off(M,A.delegates[M]);return x.splice(w,1),this}}})(p),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(m===void 0||m instanceof i.P||Array.isArray(m)||s!==void 0||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!s){const w=this.style.queryRenderedFeatures(m,void 0,this.transform),A=this.style.queryRenderedFeatureset(m,void 0,this.transform);return w.concat(A)}let c=!0;if(s.target&&(c=this._isTargetValid(s.target),c&&!s.layers))return this.style.queryRenderedFeatureset(m,s,this.transform);let p=!0;if(s.layers&&Array.isArray(s.layers)){for(const w of s.layers)if(!this._isValidId(w)){p=!1;break}if(p&&!s.target)return this.style.queryRenderedFeatures(m,s,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(m,s,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(m,s,this.transform))),x}querySourceFeatures(m,s){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,s)}queryRasterValue(m,s,c){return this._isValidId(m)?this.style.queryRasterValue(m,s,c):Promise.resolve(null)}isPointOnSurface(m){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&i.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(m))}addInteraction(m,s){return this._interactions.add(m,s),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,s){return s=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,((c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(m,s)}else p&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const c=Object.assign({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new Qo(this,c).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dm(m)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const s of m)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(m)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,c)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:w,content:A}={}){this._lazyInitEmptyStyle();const M=i.I.from(m);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:O,height:z,data:B}=i.o.getImageData(s);this.style.addImage(M,{data:new i.q({width:O,height:z},B),pixelRatio:c,stretchX:x,stretchY:w,content:A,sdf:p,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:z}=s,B=s;this.style.addImage(M,{data:new i.q({width:O,height:z},new Uint8Array(B.data)),pixelRatio:c,stretchX:x,stretchY:w,content:A,sdf:p,usvg:!1,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();const c=i.I.from(m),p=this.style.getImage(c);if(!p)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?i.o.getImageData(s):s,{width:w,height:A,data:M}=x;if(w===void 0||A===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||A!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${w}, ${A})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const O=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let z=!1;p.usvg?(p.data=new i.q({width:w,height:A},new Uint8Array(M)),p.usvg=!1,p.icon=void 0,z=!0):p.data.replace(M,O),this.style.updateImage(c,p,z)}hasImage(m){return m?!!this.style&&!!this.style.getImage(i.I.from(m)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(i.I.from(m))}loadImage(m,s){i.n(this._requestManager.transformRequest(m,i.R.Image),((c,p)=>{s(c,p instanceof HTMLImageElement?i.o.getImageData(p):p)}))}listImages(){return this.style.listImages().map((m=>m.name))}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){const s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s).catch((c=>this.fire(new i.y(new Error("Failed to add import",c))))),this}updateImport(m,s){return typeof s!="string"&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const s=this.style.getOwnLayer(m);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,c){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,c),this._update(!0)):this}setFilter(m,s,c={}){return this._isValidId(m)?(this.style.setFilter(m,s,c),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,c,p={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,c,p),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,c,p={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,c,p),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,c){return this.style.setConfigProperty(m,s,c),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,s),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aR.convert(m),this.transform):0}setFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,s),this._update())}removeFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,s),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new qf),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,p,x,w=this._container;for(;w&&(!p||!x);){const A=window.getComputedStyle(w).transform;A&&A!=="none"&&(c=A.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),w=w.parentElement}this._containerWidth=p?Math.abs(m/p):m,this._containerHeight=x?Math.abs(s/x):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=q("div","mapboxgl-canvas-container",m);this._canvas=q("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=q("div","mapboxgl-control-container",m),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((x=>{p[x]=q("div",`mapboxgl-ctrl-${x}`,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const c=i.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(m),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);s!==-1&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const s=this._popups.indexOf(m);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const m=Object.assign({},Z.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(tn(s,!0),this.painter=new ug(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),i.k.testSupport(s)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new i.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=i.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,B=this.transform.pitch,G=i.o.now(),V=new i.ac(z,{now:G,fadeDuration:w,pitch:B,transition:this.style.transition,worldview:this._worldview});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(p);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(P.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const z=i.o.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout((()=>{const B=x.getQueryParameter(s,x.QUERY_RESULT)/1e6;x.deleteQuery(s),this.fire(new i.z("gpu-timing-frame",{cpuTime:z,gpuTime:B}))}),50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout((()=>{const B=this.painter.queryGpuTimers(z);this.fire(new i.z("gpu-timing-layer",{layerTimes:B}))}),50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const B=this.painter.queryGpuTimeDeferredRender(z);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:B}))}),50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(O||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(A=this._updateAverageElevation(p,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,I.mark(P.fullLoad),this._performanceMetricsCollection&&En(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const A=Math.abs(x-w);if(A>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,m,300)}else if(A>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(m)&&c(this._averageElevation.getValue(m))}_authenticate(){wn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(m=>{if(m&&(m.message===en||m.status===401)){const s=this.painter.context.gl;tn(s,!1),this._logoControl instanceof Al&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),$n(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&kn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const A=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,A),A}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(m),s.canvasCopies.map(x),s.timeStamps)}_canvasPixelComparison(m,s,c){let p=c[1]-c[0];const x=m.length/4;for(let w=0;w<s.length;w++){const A=s[w];let M=0;for(let O=0;O<A.length;O+=4)A[O]===m[O]&&A[O+1]===m[O+1]&&A[O+2]===m[O+2]&&A[O+3]===m[O+3]&&(M+=1);p+=(c[w+2]-c[w+1])*(1-M/x)}return p}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),mr.delete(this.painter.context.gl),Tt.remove(),Zn.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.o.frame((s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)})))}_preloadTiles(m){const s=this.style?this.style.getSourceCaches():[];return i.bw(s,((c,p)=>c._preloadTiles(m,p)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){i.eX(m,s)}get version(){return E}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},mg,m),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(s=>{this._map&&this._map.zoomIn({},{originalEvent:s})})),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(s=>{this._map&&this._map.zoomOut({},{originalEvent:s})})),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))})),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const s=m.getZoom(),c=s===m.getMaxZoom(),p=s===m.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=s)}))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uo(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){const c=q("button",m,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(m,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",c),m.firstElementChild&&m.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(m={}){super();const s=navigator.geolocation;this.options=Object.assign({geolocation:s},Zs,m),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,m(c)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((c=>s(c.state!=="denied"))).catch((()=>s())):s()}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),c=m.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",m)),this._finish()}}_updateCamera(m){const s=new i.aR(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),x,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new i.aR(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,s=i.ce(1,m._center.lat)*m.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new mu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))}))}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((s=>{s==="granted"&&m()})).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ph,ScaleControl:class{constructor(m={}){this.options=Object.assign({},ql,m),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,p=s._containerWidth/2-m/2,x=s.unproject([p,c]),w=s.unproject([p+m,c]),A=x.distanceTo(w);if(this.options.unit==="imperial"){const M=3.2808*A;M>5280?this._setScale(m,M/5280,"mile"):this._setScale(m,M,"foot")}else this.options.unit==="nautical"?this._setScale(m,A/1852,"nautical-mile"):A>=1e3?this._setScale(m,A/1e3,"kilometer"):this._setScale(m,A,"meter")}_setScale(m,s,c){this._map._requestDomTask((()=>{const p=(function(w){const A=Math.pow(10,`${Math.floor(w)}`.length-1);let M=w/A;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(O){const z=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*z)/z})(M),A*M})(s),x=p/s;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${Xs[c]}`,this._container.style.width=m*x+"px"}))}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:qf,Popup:class extends i.E{constructor(m){super(),this.options=Object.assign(Object.create(_h),m),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.aR.convert(m),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=m;p=c.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){const c=this._closeButton=q("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,p=this._pos;if(!s||!c||!p)return"bottom";const x=c.offsetWidth,w=c.offsetHeight,A=p.x<x/2,M=p.x>s.transform.width-x/2;if(p.y+m<w)return A?"top-left":M?"top-right":"top";if(p.y>s.transform.height-w){if(A)return"bottom-left";if(M)return"bottom-right"}return A?"left":M?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=q("div","mapboxgl-popup",s.getContainer()),this._tip=q("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ra(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m instanceof i.P?m:s.project(this._lngLat,this._altitude),w=gg(this.options.offset),A=this._anchor=this._getAnchor(w.y),M=gg(this.options.offset,A),O=x.add(M).round();s._requestDomTask((()=>{this._container&&A&&(this._container.style.transform=`${nl[A]} translate(${O.x}px,${O.y}px)`)}))}if(!this._marker&&s._showingGlobe()){const x=i.eY(s.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(rl);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:mu,Style:Qo,LngLat:i.aR,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:$m,Evented:i.E,config:i.e,prewarm:i.f0,clearPrewarmedResources:i.e$,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(m){i.e.ACCESS_TOKEN=m},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(m){i.e.API_URL=m},get workerCount(){return i.f9.workerCount},set workerCount(m){i.f9.workerCount=m},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.f8(m)},get workerUrl(){return i.f7.workerUrl},set workerUrl(m){i.f7.workerUrl=m},get workerClass(){return i.f7.workerClass},set workerClass(m){i.f7.workerClass=m},get workerParams(){return i.f7.workerParams},set workerParams(m){i.f7.workerParams=m},get dracoUrl(){return i.f6()},set dracoUrl(m){i.f5(m)},get meshoptUrl(){return i.f4()},set meshoptUrl(m){i.f3(m)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}}));var g=u;return g}))})(Ub)),Ub.exports}var vq=yq();const nx=zh(vq);function _F(e,t){return function(){return e.apply(t,arguments)}}const{toString:xq}=Object.prototype,{getPrototypeOf:hC}=Object,{iterator:uw,toStringTag:yF}=Symbol,hw=(e=>t=>{const n=xq.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Uh=e=>(e=e.toLowerCase(),t=>hw(t)===e),dw=e=>t=>typeof t===e,{isArray:My}=Array,py=dw("undefined");function Nx(e){return e!==null&&!py(e)&&e.constructor!==null&&!py(e.constructor)&&rc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const vF=Uh("ArrayBuffer");function bq(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&vF(e.buffer),t}const wq=dw("string"),rc=dw("function"),xF=dw("number"),Fx=e=>e!==null&&typeof e=="object",Sq=e=>e===!0||e===!1,Vb=e=>{if(hw(e)!=="object")return!1;const t=hC(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(yF in e)&&!(uw in e)},Tq=e=>{if(!Fx(e)||Nx(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Eq=Uh("Date"),Aq=Uh("File"),Cq=Uh("Blob"),Pq=Uh("FileList"),Iq=e=>Fx(e)&&rc(e.pipe),Mq=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||rc(e.append)&&((t=hw(e))==="formdata"||t==="object"&&rc(e.toString)&&e.toString()==="[object FormData]"))},kq=Uh("URLSearchParams"),[Rq,Oq,Dq,Lq]=["ReadableStream","Request","Response","Headers"].map(Uh),jq=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bx(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let o,u;if(typeof e!="object"&&(e=[e]),My(e))for(o=0,u=e.length;o<u;o++)t.call(null,e[o],o,e);else{if(Nx(e))return;const d=n?Object.getOwnPropertyNames(e):Object.keys(e),g=d.length;let i;for(o=0;o<g;o++)i=d[o],t.call(null,e[i],i,e)}}function bF(e,t){if(Nx(e))return null;t=t.toLowerCase();const n=Object.keys(e);let o=n.length,u;for(;o-- >0;)if(u=n[o],t===u.toLowerCase())return u;return null}const Dg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,wF=e=>!py(e)&&e!==Dg;function BE(){const{caseless:e,skipUndefined:t}=wF(this)&&this||{},n={},o=(u,d)=>{const g=e&&bF(n,d)||d;Vb(n[g])&&Vb(u)?n[g]=BE(n[g],u):Vb(u)?n[g]=BE({},u):My(u)?n[g]=u.slice():(!t||!py(u))&&(n[g]=u)};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&Bx(arguments[u],o);return n}const zq=(e,t,n,{allOwnKeys:o}={})=>(Bx(t,(u,d)=>{n&&rc(u)?e[d]=_F(u,n):e[d]=u},{allOwnKeys:o}),e),Nq=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Fq=(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},Bq=(e,t,n,o)=>{let u,d,g;const i={};if(t=t||{},e==null)return t;do{for(u=Object.getOwnPropertyNames(e),d=u.length;d-- >0;)g=u[d],(!o||o(g,e,t))&&!i[g]&&(t[g]=e[g],i[g]=!0);e=n!==!1&&hC(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},Uq=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const o=e.indexOf(t,n);return o!==-1&&o===n},Vq=e=>{if(!e)return null;if(My(e))return e;let t=e.length;if(!xF(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},$q=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&hC(Uint8Array)),Hq=(e,t)=>{const o=(e&&e[uw]).call(e);let u;for(;(u=o.next())&&!u.done;){const d=u.value;t.call(e,d[0],d[1])}},Gq=(e,t)=>{let n;const o=[];for(;(n=e.exec(t))!==null;)o.push(n);return o},Wq=Uh("HTMLFormElement"),qq=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,o,u){return o.toUpperCase()+u}),vO=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Zq=Uh("RegExp"),SF=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),o={};Bx(n,(u,d)=>{let g;(g=t(u,d,e))!==!1&&(o[d]=g||u)}),Object.defineProperties(e,o)},Xq=e=>{SF(e,(t,n)=>{if(rc(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=e[n];if(rc(o)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Yq=(e,t)=>{const n={},o=u=>{u.forEach(d=>{n[d]=!0})};return My(e)?o(e):o(String(e).split(t)),n},Kq=()=>{},Jq=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Qq(e){return!!(e&&rc(e.append)&&e[yF]==="FormData"&&e[uw])}const e9=e=>{const t=new Array(10),n=(o,u)=>{if(Fx(o)){if(t.indexOf(o)>=0)return;if(Nx(o))return o;if(!("toJSON"in o)){t[u]=o;const d=My(o)?[]:{};return Bx(o,(g,i)=>{const E=n(g,u+1);!py(E)&&(d[i]=E)}),t[u]=void 0,d}}return o};return n(e,0)},t9=Uh("AsyncFunction"),n9=e=>e&&(Fx(e)||rc(e))&&rc(e.then)&&rc(e.catch),TF=((e,t)=>e?setImmediate:t?((n,o)=>(Dg.addEventListener("message",({source:u,data:d})=>{u===Dg&&d===n&&o.length&&o.shift()()},!1),u=>{o.push(u),Dg.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",rc(Dg.postMessage)),r9=typeof queueMicrotask<"u"?queueMicrotask.bind(Dg):typeof process<"u"&&process.nextTick||TF,i9=e=>e!=null&&rc(e[uw]),Wt={isArray:My,isArrayBuffer:vF,isBuffer:Nx,isFormData:Mq,isArrayBufferView:bq,isString:wq,isNumber:xF,isBoolean:Sq,isObject:Fx,isPlainObject:Vb,isEmptyObject:Tq,isReadableStream:Rq,isRequest:Oq,isResponse:Dq,isHeaders:Lq,isUndefined:py,isDate:Eq,isFile:Aq,isBlob:Cq,isRegExp:Zq,isFunction:rc,isStream:Iq,isURLSearchParams:kq,isTypedArray:$q,isFileList:Pq,forEach:Bx,merge:BE,extend:zq,trim:jq,stripBOM:Nq,inherits:Fq,toFlatObject:Bq,kindOf:hw,kindOfTest:Uh,endsWith:Uq,toArray:Vq,forEachEntry:Hq,matchAll:Gq,isHTMLForm:Wq,hasOwnProperty:vO,hasOwnProp:vO,reduceDescriptors:SF,freezeMethods:Xq,toObjectSet:Yq,toCamelCase:qq,noop:Kq,toFiniteNumber:Jq,findKey:bF,global:Dg,isContextDefined:wF,isSpecCompliantForm:Qq,toJSONObject:e9,isAsyncFn:t9,isThenable:n9,setImmediate:TF,asap:r9,isIterable:i9};function ei(e,t,n,o,u){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),u&&(this.response=u,this.status=u.status?u.status:null)}Wt.inherits(ei,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Wt.toJSONObject(this.config),code:this.code,status:this.status}}});const EF=ei.prototype,AF={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{AF[e]={value:e}});Object.defineProperties(ei,AF);Object.defineProperty(EF,"isAxiosError",{value:!0});ei.from=(e,t,n,o,u,d)=>{const g=Object.create(EF);Wt.toFlatObject(e,g,function(I){return I!==Error.prototype},P=>P!=="isAxiosError");const i=e&&e.message?e.message:"Error",E=t==null&&e?e.code:t;return ei.call(g,i,E,n,o,u),e&&g.cause==null&&Object.defineProperty(g,"cause",{value:e,configurable:!0}),g.name=e&&e.name||"Error",d&&Object.assign(g,d),g};const s9=null;function UE(e){return Wt.isPlainObject(e)||Wt.isArray(e)}function CF(e){return Wt.endsWith(e,"[]")?e.slice(0,-2):e}function xO(e,t,n){return e?e.concat(t).map(function(u,d){return u=CF(u),!n&&d?"["+u+"]":u}).join(n?".":""):t}function o9(e){return Wt.isArray(e)&&!e.some(UE)}const a9=Wt.toFlatObject(Wt,{},null,function(t){return/^is[A-Z]/.test(t)});function fw(e,t,n){if(!Wt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=Wt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(q,X){return!Wt.isUndefined(X[q])});const o=n.metaTokens,u=n.visitor||I,d=n.dots,g=n.indexes,E=(n.Blob||typeof Blob<"u"&&Blob)&&Wt.isSpecCompliantForm(t);if(!Wt.isFunction(u))throw new TypeError("visitor must be a function");function P(Z){if(Z===null)return"";if(Wt.isDate(Z))return Z.toISOString();if(Wt.isBoolean(Z))return Z.toString();if(!E&&Wt.isBlob(Z))throw new ei("Blob is not supported. Use a Buffer instead.");return Wt.isArrayBuffer(Z)||Wt.isTypedArray(Z)?E&&typeof Blob=="function"?new Blob([Z]):Buffer.from(Z):Z}function I(Z,q,X){let re=Z;if(Z&&!X&&typeof Z=="object"){if(Wt.endsWith(q,"{}"))q=o?q:q.slice(0,-2),Z=JSON.stringify(Z);else if(Wt.isArray(Z)&&o9(Z)||(Wt.isFileList(Z)||Wt.endsWith(q,"[]"))&&(re=Wt.toArray(Z)))return q=CF(q),re.forEach(function(ue,ye){!(Wt.isUndefined(ue)||ue===null)&&t.append(g===!0?xO([q],ye,d):g===null?q:q+"[]",P(ue))}),!1}return UE(Z)?!0:(t.append(xO(X,q,d),P(Z)),!1)}const D=[],F=Object.assign(a9,{defaultVisitor:I,convertValue:P,isVisitable:UE});function $(Z,q){if(!Wt.isUndefined(Z)){if(D.indexOf(Z)!==-1)throw Error("Circular reference detected in "+q.join("."));D.push(Z),Wt.forEach(Z,function(re,le){(!(Wt.isUndefined(re)||re===null)&&u.call(t,re,Wt.isString(le)?le.trim():le,q,F))===!0&&$(re,q?q.concat(le):[le])}),D.pop()}}if(!Wt.isObject(e))throw new TypeError("data must be an object");return $(e),t}function bO(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return t[o]})}function dC(e,t){this._pairs=[],e&&fw(e,this,t)}const PF=dC.prototype;PF.append=function(t,n){this._pairs.push([t,n])};PF.toString=function(t){const n=t?function(o){return t.call(this,o,bO)}:bO;return this._pairs.map(function(u){return n(u[0])+"="+n(u[1])},"").join("&")};function l9(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function IF(e,t,n){if(!t)return e;const o=n&&n.encode||l9;Wt.isFunction(n)&&(n={serialize:n});const u=n&&n.serialize;let d;if(u?d=u(t,n):d=Wt.isURLSearchParams(t)?t.toString():new dC(t,n).toString(o),d){const g=e.indexOf("#");g!==-1&&(e=e.slice(0,g)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}class wO{constructor(){this.handlers=[]}use(t,n,o){return this.handlers.push({fulfilled:t,rejected:n,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Wt.forEach(this.handlers,function(o){o!==null&&t(o)})}}const MF={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},c9=typeof URLSearchParams<"u"?URLSearchParams:dC,u9=typeof FormData<"u"?FormData:null,h9=typeof Blob<"u"?Blob:null,d9={isBrowser:!0,classes:{URLSearchParams:c9,FormData:u9,Blob:h9},protocols:["http","https","file","blob","url","data"]},fC=typeof window<"u"&&typeof document<"u",VE=typeof navigator=="object"&&navigator||void 0,f9=fC&&(!VE||["ReactNative","NativeScript","NS"].indexOf(VE.product)<0),p9=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",m9=fC&&window.location.href||"http://localhost",g9=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:fC,hasStandardBrowserEnv:f9,hasStandardBrowserWebWorkerEnv:p9,navigator:VE,origin:m9},Symbol.toStringTag,{value:"Module"})),cl={...g9,...d9};function _9(e,t){return fw(e,new cl.classes.URLSearchParams,{visitor:function(n,o,u,d){return cl.isNode&&Wt.isBuffer(n)?(this.append(o,n.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)},...t})}function y9(e){return Wt.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function v9(e){const t={},n=Object.keys(e);let o;const u=n.length;let d;for(o=0;o<u;o++)d=n[o],t[d]=e[d];return t}function kF(e){function t(n,o,u,d){let g=n[d++];if(g==="__proto__")return!0;const i=Number.isFinite(+g),E=d>=n.length;return g=!g&&Wt.isArray(u)?u.length:g,E?(Wt.hasOwnProp(u,g)?u[g]=[u[g],o]:u[g]=o,!i):((!u[g]||!Wt.isObject(u[g]))&&(u[g]=[]),t(n,o,u[g],d)&&Wt.isArray(u[g])&&(u[g]=v9(u[g])),!i)}if(Wt.isFormData(e)&&Wt.isFunction(e.entries)){const n={};return Wt.forEachEntry(e,(o,u)=>{t(y9(o),u,n,0)}),n}return null}function x9(e,t,n){if(Wt.isString(e))try{return(t||JSON.parse)(e),Wt.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(n||JSON.stringify)(e)}const Ux={transitional:MF,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const o=n.getContentType()||"",u=o.indexOf("application/json")>-1,d=Wt.isObject(t);if(d&&Wt.isHTMLForm(t)&&(t=new FormData(t)),Wt.isFormData(t))return u?JSON.stringify(kF(t)):t;if(Wt.isArrayBuffer(t)||Wt.isBuffer(t)||Wt.isStream(t)||Wt.isFile(t)||Wt.isBlob(t)||Wt.isReadableStream(t))return t;if(Wt.isArrayBufferView(t))return t.buffer;if(Wt.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let i;if(d){if(o.indexOf("application/x-www-form-urlencoded")>-1)return _9(t,this.formSerializer).toString();if((i=Wt.isFileList(t))||o.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return fw(i?{"files[]":t}:t,E&&new E,this.formSerializer)}}return d||u?(n.setContentType("application/json",!1),x9(t)):t}],transformResponse:[function(t){const n=this.transitional||Ux.transitional,o=n&&n.forcedJSONParsing,u=this.responseType==="json";if(Wt.isResponse(t)||Wt.isReadableStream(t))return t;if(t&&Wt.isString(t)&&(o&&!this.responseType||u)){const g=!(n&&n.silentJSONParsing)&&u;try{return JSON.parse(t,this.parseReviver)}catch(i){if(g)throw i.name==="SyntaxError"?ei.from(i,ei.ERR_BAD_RESPONSE,this,null,this.response):i}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:cl.classes.FormData,Blob:cl.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Wt.forEach(["delete","get","head","post","put","patch"],e=>{Ux.headers[e]={}});const b9=Wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),w9=e=>{const t={};let n,o,u;return e&&e.split(`
`).forEach(function(g){u=g.indexOf(":"),n=g.substring(0,u).trim().toLowerCase(),o=g.substring(u+1).trim(),!(!n||t[n]&&b9[n])&&(n==="set-cookie"?t[n]?t[n].push(o):t[n]=[o]:t[n]=t[n]?t[n]+", "+o:o)}),t},SO=Symbol("internals");function Ov(e){return e&&String(e).trim().toLowerCase()}function $b(e){return e===!1||e==null?e:Wt.isArray(e)?e.map($b):String(e)}function S9(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(e);)t[o[1]]=o[2];return t}const T9=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function D2(e,t,n,o,u){if(Wt.isFunction(o))return o.call(this,t,n);if(u&&(t=n),!!Wt.isString(t)){if(Wt.isString(o))return t.indexOf(o)!==-1;if(Wt.isRegExp(o))return o.test(t)}}function E9(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,o)=>n.toUpperCase()+o)}function A9(e,t){const n=Wt.toCamelCase(" "+t);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+n,{value:function(u,d,g){return this[o].call(this,t,u,d,g)},configurable:!0})})}let ic=class{constructor(t){t&&this.set(t)}set(t,n,o){const u=this;function d(i,E,P){const I=Ov(E);if(!I)throw new Error("header name must be a non-empty string");const D=Wt.findKey(u,I);(!D||u[D]===void 0||P===!0||P===void 0&&u[D]!==!1)&&(u[D||E]=$b(i))}const g=(i,E)=>Wt.forEach(i,(P,I)=>d(P,I,E));if(Wt.isPlainObject(t)||t instanceof this.constructor)g(t,n);else if(Wt.isString(t)&&(t=t.trim())&&!T9(t))g(w9(t),n);else if(Wt.isObject(t)&&Wt.isIterable(t)){let i={},E,P;for(const I of t){if(!Wt.isArray(I))throw TypeError("Object iterator must return a key-value pair");i[P=I[0]]=(E=i[P])?Wt.isArray(E)?[...E,I[1]]:[E,I[1]]:I[1]}g(i,n)}else t!=null&&d(n,t,o);return this}get(t,n){if(t=Ov(t),t){const o=Wt.findKey(this,t);if(o){const u=this[o];if(!n)return u;if(n===!0)return S9(u);if(Wt.isFunction(n))return n.call(this,u,o);if(Wt.isRegExp(n))return n.exec(u);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Ov(t),t){const o=Wt.findKey(this,t);return!!(o&&this[o]!==void 0&&(!n||D2(this,this[o],o,n)))}return!1}delete(t,n){const o=this;let u=!1;function d(g){if(g=Ov(g),g){const i=Wt.findKey(o,g);i&&(!n||D2(o,o[i],i,n))&&(delete o[i],u=!0)}}return Wt.isArray(t)?t.forEach(d):d(t),u}clear(t){const n=Object.keys(this);let o=n.length,u=!1;for(;o--;){const d=n[o];(!t||D2(this,this[d],d,t,!0))&&(delete this[d],u=!0)}return u}normalize(t){const n=this,o={};return Wt.forEach(this,(u,d)=>{const g=Wt.findKey(o,d);if(g){n[g]=$b(u),delete n[d];return}const i=t?E9(d):String(d).trim();i!==d&&delete n[d],n[i]=$b(u),o[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return Wt.forEach(this,(o,u)=>{o!=null&&o!==!1&&(n[u]=t&&Wt.isArray(o)?o.join(", "):o)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const o=new this(t);return n.forEach(u=>o.set(u)),o}static accessor(t){const o=(this[SO]=this[SO]={accessors:{}}).accessors,u=this.prototype;function d(g){const i=Ov(g);o[i]||(A9(u,g),o[i]=!0)}return Wt.isArray(t)?t.forEach(d):d(t),this}};ic.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Wt.reduceDescriptors(ic.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(o){this[n]=o}}});Wt.freezeMethods(ic);function L2(e,t){const n=this||Ux,o=t||n,u=ic.from(o.headers);let d=o.data;return Wt.forEach(e,function(i){d=i.call(n,d,u.normalize(),t?t.status:void 0)}),u.normalize(),d}function RF(e){return!!(e&&e.__CANCEL__)}function ky(e,t,n){ei.call(this,e??"canceled",ei.ERR_CANCELED,t,n),this.name="CanceledError"}Wt.inherits(ky,ei,{__CANCEL__:!0});function OF(e,t,n){const o=n.config.validateStatus;!n.status||!o||o(n.status)?e(n):t(new ei("Request failed with status code "+n.status,[ei.ERR_BAD_REQUEST,ei.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function C9(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function P9(e,t){e=e||10;const n=new Array(e),o=new Array(e);let u=0,d=0,g;return t=t!==void 0?t:1e3,function(E){const P=Date.now(),I=o[d];g||(g=P),n[u]=E,o[u]=P;let D=d,F=0;for(;D!==u;)F+=n[D++],D=D%e;if(u=(u+1)%e,u===d&&(d=(d+1)%e),P-g<t)return;const $=I&&P-I;return $?Math.round(F*1e3/$):void 0}}function I9(e,t){let n=0,o=1e3/t,u,d;const g=(P,I=Date.now())=>{n=I,u=null,d&&(clearTimeout(d),d=null),e(...P)};return[(...P)=>{const I=Date.now(),D=I-n;D>=o?g(P,I):(u=P,d||(d=setTimeout(()=>{d=null,g(u)},o-D)))},()=>u&&g(u)]}const i1=(e,t,n=3)=>{let o=0;const u=P9(50,250);return I9(d=>{const g=d.loaded,i=d.lengthComputable?d.total:void 0,E=g-o,P=u(E),I=g<=i;o=g;const D={loaded:g,total:i,progress:i?g/i:void 0,bytes:E,rate:P||void 0,estimated:P&&i&&I?(i-g)/P:void 0,event:d,lengthComputable:i!=null,[t?"download":"upload"]:!0};e(D)},n)},TO=(e,t)=>{const n=e!=null;return[o=>t[0]({lengthComputable:n,total:e,loaded:o}),t[1]]},EO=e=>(...t)=>Wt.asap(()=>e(...t)),M9=cl.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,cl.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(cl.origin),cl.navigator&&/(msie|trident)/i.test(cl.navigator.userAgent)):()=>!0,k9=cl.hasStandardBrowserEnv?{write(e,t,n,o,u,d){const g=[e+"="+encodeURIComponent(t)];Wt.isNumber(n)&&g.push("expires="+new Date(n).toGMTString()),Wt.isString(o)&&g.push("path="+o),Wt.isString(u)&&g.push("domain="+u),d===!0&&g.push("secure"),document.cookie=g.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function R9(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function O9(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function DF(e,t,n){let o=!R9(t);return e&&(o||n==!1)?O9(e,t):t}const AO=e=>e instanceof ic?{...e}:e;function Yg(e,t){t=t||{};const n={};function o(P,I,D,F){return Wt.isPlainObject(P)&&Wt.isPlainObject(I)?Wt.merge.call({caseless:F},P,I):Wt.isPlainObject(I)?Wt.merge({},I):Wt.isArray(I)?I.slice():I}function u(P,I,D,F){if(Wt.isUndefined(I)){if(!Wt.isUndefined(P))return o(void 0,P,D,F)}else return o(P,I,D,F)}function d(P,I){if(!Wt.isUndefined(I))return o(void 0,I)}function g(P,I){if(Wt.isUndefined(I)){if(!Wt.isUndefined(P))return o(void 0,P)}else return o(void 0,I)}function i(P,I,D){if(D in t)return o(P,I);if(D in e)return o(void 0,P)}const E={url:d,method:d,data:d,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:i,headers:(P,I,D)=>u(AO(P),AO(I),D,!0)};return Wt.forEach(Object.keys({...e,...t}),function(I){const D=E[I]||u,F=D(e[I],t[I],I);Wt.isUndefined(F)&&D!==i||(n[I]=F)}),n}const LF=e=>{const t=Yg({},e);let{data:n,withXSRFToken:o,xsrfHeaderName:u,xsrfCookieName:d,headers:g,auth:i}=t;if(t.headers=g=ic.from(g),t.url=IF(DF(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),i&&g.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):""))),Wt.isFormData(n)){if(cl.hasStandardBrowserEnv||cl.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if(Wt.isFunction(n.getHeaders)){const E=n.getHeaders(),P=["content-type","content-length"];Object.entries(E).forEach(([I,D])=>{P.includes(I.toLowerCase())&&g.set(I,D)})}}if(cl.hasStandardBrowserEnv&&(o&&Wt.isFunction(o)&&(o=o(t)),o||o!==!1&&M9(t.url))){const E=u&&d&&k9.read(d);E&&g.set(u,E)}return t},D9=typeof XMLHttpRequest<"u",L9=D9&&function(e){return new Promise(function(n,o){const u=LF(e);let d=u.data;const g=ic.from(u.headers).normalize();let{responseType:i,onUploadProgress:E,onDownloadProgress:P}=u,I,D,F,$,Z;function q(){$&&$(),Z&&Z(),u.cancelToken&&u.cancelToken.unsubscribe(I),u.signal&&u.signal.removeEventListener("abort",I)}let X=new XMLHttpRequest;X.open(u.method.toUpperCase(),u.url,!0),X.timeout=u.timeout;function re(){if(!X)return;const ue=ic.from("getAllResponseHeaders"in X&&X.getAllResponseHeaders()),ge={data:!i||i==="text"||i==="json"?X.responseText:X.response,status:X.status,statusText:X.statusText,headers:ue,config:e,request:X};OF(function(Le){n(Le),q()},function(Le){o(Le),q()},ge),X=null}"onloadend"in X?X.onloadend=re:X.onreadystatechange=function(){!X||X.readyState!==4||X.status===0&&!(X.responseURL&&X.responseURL.indexOf("file:")===0)||setTimeout(re)},X.onabort=function(){X&&(o(new ei("Request aborted",ei.ECONNABORTED,e,X)),X=null)},X.onerror=function(ye){const ge=ye&&ye.message?ye.message:"Network Error",we=new ei(ge,ei.ERR_NETWORK,e,X);we.event=ye||null,o(we),X=null},X.ontimeout=function(){let ye=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded";const ge=u.transitional||MF;u.timeoutErrorMessage&&(ye=u.timeoutErrorMessage),o(new ei(ye,ge.clarifyTimeoutError?ei.ETIMEDOUT:ei.ECONNABORTED,e,X)),X=null},d===void 0&&g.setContentType(null),"setRequestHeader"in X&&Wt.forEach(g.toJSON(),function(ye,ge){X.setRequestHeader(ge,ye)}),Wt.isUndefined(u.withCredentials)||(X.withCredentials=!!u.withCredentials),i&&i!=="json"&&(X.responseType=u.responseType),P&&([F,Z]=i1(P,!0),X.addEventListener("progress",F)),E&&X.upload&&([D,$]=i1(E),X.upload.addEventListener("progress",D),X.upload.addEventListener("loadend",$)),(u.cancelToken||u.signal)&&(I=ue=>{X&&(o(!ue||ue.type?new ky(null,e,X):ue),X.abort(),X=null)},u.cancelToken&&u.cancelToken.subscribe(I),u.signal&&(u.signal.aborted?I():u.signal.addEventListener("abort",I)));const le=C9(u.url);if(le&&cl.protocols.indexOf(le)===-1){o(new ei("Unsupported protocol "+le+":",ei.ERR_BAD_REQUEST,e));return}X.send(d||null)})},j9=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let o=new AbortController,u;const d=function(P){if(!u){u=!0,i();const I=P instanceof Error?P:this.reason;o.abort(I instanceof ei?I:new ky(I instanceof Error?I.message:I))}};let g=t&&setTimeout(()=>{g=null,d(new ei(`timeout ${t} of ms exceeded`,ei.ETIMEDOUT))},t);const i=()=>{e&&(g&&clearTimeout(g),g=null,e.forEach(P=>{P.unsubscribe?P.unsubscribe(d):P.removeEventListener("abort",d)}),e=null)};e.forEach(P=>P.addEventListener("abort",d));const{signal:E}=o;return E.unsubscribe=()=>Wt.asap(i),E}},z9=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let o=0,u;for(;o<n;)u=o+t,yield e.slice(o,u),o=u},N9=async function*(e,t){for await(const n of F9(e))yield*z9(n,t)},F9=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:o}=await t.read();if(n)break;yield o}}finally{await t.cancel()}},CO=(e,t,n,o)=>{const u=N9(e,t);let d=0,g,i=E=>{g||(g=!0,o&&o(E))};return new ReadableStream({async pull(E){try{const{done:P,value:I}=await u.next();if(P){i(),E.close();return}let D=I.byteLength;if(n){let F=d+=D;n(F)}E.enqueue(new Uint8Array(I))}catch(P){throw i(P),P}},cancel(E){return i(E),u.return()}},{highWaterMark:2})},PO=64*1024,{isFunction:nb}=Wt,B9=(({Request:e,Response:t})=>({Request:e,Response:t}))(Wt.global),{ReadableStream:IO,TextEncoder:MO}=Wt.global,kO=(e,...t)=>{try{return!!e(...t)}catch{return!1}},U9=e=>{e=Wt.merge.call({skipUndefined:!0},B9,e);const{fetch:t,Request:n,Response:o}=e,u=t?nb(t):typeof fetch=="function",d=nb(n),g=nb(o);if(!u)return!1;const i=u&&nb(IO),E=u&&(typeof MO=="function"?(Z=>q=>Z.encode(q))(new MO):async Z=>new Uint8Array(await new n(Z).arrayBuffer())),P=d&&i&&kO(()=>{let Z=!1;const q=new n(cl.origin,{body:new IO,method:"POST",get duplex(){return Z=!0,"half"}}).headers.has("Content-Type");return Z&&!q}),I=g&&i&&kO(()=>Wt.isReadableStream(new o("").body)),D={stream:I&&(Z=>Z.body)};u&&["text","arrayBuffer","blob","formData","stream"].forEach(Z=>{!D[Z]&&(D[Z]=(q,X)=>{let re=q&&q[Z];if(re)return re.call(q);throw new ei(`Response type '${Z}' is not supported`,ei.ERR_NOT_SUPPORT,X)})});const F=async Z=>{if(Z==null)return 0;if(Wt.isBlob(Z))return Z.size;if(Wt.isSpecCompliantForm(Z))return(await new n(cl.origin,{method:"POST",body:Z}).arrayBuffer()).byteLength;if(Wt.isArrayBufferView(Z)||Wt.isArrayBuffer(Z))return Z.byteLength;if(Wt.isURLSearchParams(Z)&&(Z=Z+""),Wt.isString(Z))return(await E(Z)).byteLength},$=async(Z,q)=>{const X=Wt.toFiniteNumber(Z.getContentLength());return X??F(q)};return async Z=>{let{url:q,method:X,data:re,signal:le,cancelToken:ue,timeout:ye,onDownloadProgress:ge,onUploadProgress:we,responseType:Le,headers:Ze,withCredentials:Ge="same-origin",fetchOptions:gt}=LF(Z),lt=t||fetch;Le=Le?(Le+"").toLowerCase():"text";let qe=j9([le,ue&&ue.toAbortSignal()],ye),en=null;const Jt=qe&&qe.unsubscribe&&(()=>{qe.unsubscribe()});let Nt;try{if(we&&P&&X!=="get"&&X!=="head"&&(Nt=await $(Ze,re))!==0){let et=new n(q,{method:"POST",body:re,duplex:"half"}),zt;if(Wt.isFormData(re)&&(zt=et.headers.get("content-type"))&&Ze.setContentType(zt),et.body){const[Zn,$n]=TO(Nt,i1(EO(we)));re=CO(et.body,PO,Zn,$n)}}Wt.isString(Ge)||(Ge=Ge?"include":"omit");const St=d&&"credentials"in n.prototype,an={...gt,signal:qe,method:X.toUpperCase(),headers:Ze.normalize().toJSON(),body:re,duplex:"half",credentials:St?Ge:void 0};en=d&&new n(q,an);let Kt=await(d?lt(en,gt):lt(q,an));const hn=I&&(Le==="stream"||Le==="response");if(I&&(ge||hn&&Jt)){const et={};["status","statusText","headers"].forEach(fr=>{et[fr]=Kt[fr]});const zt=Wt.toFiniteNumber(Kt.headers.get("content-length")),[Zn,$n]=ge&&TO(zt,i1(EO(ge),!0))||[];Kt=new o(CO(Kt.body,PO,Zn,()=>{$n&&$n(),Jt&&Jt()}),et)}Le=Le||"text";let Xt=await D[Wt.findKey(D,Le)||"text"](Kt,Z);return!hn&&Jt&&Jt(),await new Promise((et,zt)=>{OF(et,zt,{data:Xt,headers:ic.from(Kt.headers),status:Kt.status,statusText:Kt.statusText,config:Z,request:en})})}catch(St){throw Jt&&Jt(),St&&St.name==="TypeError"&&/Load failed|fetch/i.test(St.message)?Object.assign(new ei("Network Error",ei.ERR_NETWORK,Z,en),{cause:St.cause||St}):ei.from(St,St&&St.code,Z,en)}}},V9=new Map,jF=e=>{let t=e?e.env:{};const{fetch:n,Request:o,Response:u}=t,d=[o,u,n];let g=d.length,i=g,E,P,I=V9;for(;i--;)E=d[i],P=I.get(E),P===void 0&&I.set(E,P=i?new Map:U9(t)),I=P;return P};jF();const $E={http:s9,xhr:L9,fetch:{get:jF}};Wt.forEach($E,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const RO=e=>`- ${e}`,$9=e=>Wt.isFunction(e)||e===null||e===!1,zF={getAdapter:(e,t)=>{e=Wt.isArray(e)?e:[e];const{length:n}=e;let o,u;const d={};for(let g=0;g<n;g++){o=e[g];let i;if(u=o,!$9(o)&&(u=$E[(i=String(o)).toLowerCase()],u===void 0))throw new ei(`Unknown adapter '${i}'`);if(u&&(Wt.isFunction(u)||(u=u.get(t))))break;d[i||"#"+g]=u}if(!u){const g=Object.entries(d).map(([E,P])=>`adapter ${E} `+(P===!1?"is not supported by the environment":"is not available in the build"));let i=n?g.length>1?`since :
`+g.map(RO).join(`
`):" "+RO(g[0]):"as no adapter specified";throw new ei("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return u},adapters:$E};function j2(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ky(null,e)}function OO(e){return j2(e),e.headers=ic.from(e.headers),e.data=L2.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),zF.getAdapter(e.adapter||Ux.adapter,e)(e).then(function(o){return j2(e),o.data=L2.call(e,e.transformResponse,o),o.headers=ic.from(o.headers),o},function(o){return RF(o)||(j2(e),o&&o.response&&(o.response.data=L2.call(e,e.transformResponse,o.response),o.response.headers=ic.from(o.response.headers))),Promise.reject(o)})}const NF="1.12.2",pw={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{pw[e]=function(o){return typeof o===e||"a"+(t<1?"n ":" ")+e}});const DO={};pw.transitional=function(t,n,o){function u(d,g){return"[Axios v"+NF+"] Transitional option '"+d+"'"+g+(o?". "+o:"")}return(d,g,i)=>{if(t===!1)throw new ei(u(g," has been removed"+(n?" in "+n:"")),ei.ERR_DEPRECATED);return n&&!DO[g]&&(DO[g]=!0,console.warn(u(g," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(d,g,i):!0}};pw.spelling=function(t){return(n,o)=>(console.warn(`${o} is likely a misspelling of ${t}`),!0)};function H9(e,t,n){if(typeof e!="object")throw new ei("options must be an object",ei.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let u=o.length;for(;u-- >0;){const d=o[u],g=t[d];if(g){const i=e[d],E=i===void 0||g(i,d,e);if(E!==!0)throw new ei("option "+d+" must be "+E,ei.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ei("Unknown option "+d,ei.ERR_BAD_OPTION)}}const Hb={assertOptions:H9,validators:pw},Dd=Hb.validators;let Bg=class{constructor(t){this.defaults=t||{},this.interceptors={request:new wO,response:new wO}}async request(t,n){try{return await this._request(t,n)}catch(o){if(o instanceof Error){let u={};Error.captureStackTrace?Error.captureStackTrace(u):u=new Error;const d=u.stack?u.stack.replace(/^.+\n/,""):"";try{o.stack?d&&!String(o.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+d):o.stack=d}catch{}}throw o}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=Yg(this.defaults,n);const{transitional:o,paramsSerializer:u,headers:d}=n;o!==void 0&&Hb.assertOptions(o,{silentJSONParsing:Dd.transitional(Dd.boolean),forcedJSONParsing:Dd.transitional(Dd.boolean),clarifyTimeoutError:Dd.transitional(Dd.boolean)},!1),u!=null&&(Wt.isFunction(u)?n.paramsSerializer={serialize:u}:Hb.assertOptions(u,{encode:Dd.function,serialize:Dd.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Hb.assertOptions(n,{baseUrl:Dd.spelling("baseURL"),withXsrfToken:Dd.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let g=d&&Wt.merge(d.common,d[n.method]);d&&Wt.forEach(["delete","get","head","post","put","patch","common"],Z=>{delete d[Z]}),n.headers=ic.concat(g,d);const i=[];let E=!0;this.interceptors.request.forEach(function(q){typeof q.runWhen=="function"&&q.runWhen(n)===!1||(E=E&&q.synchronous,i.unshift(q.fulfilled,q.rejected))});const P=[];this.interceptors.response.forEach(function(q){P.push(q.fulfilled,q.rejected)});let I,D=0,F;if(!E){const Z=[OO.bind(this),void 0];for(Z.unshift(...i),Z.push(...P),F=Z.length,I=Promise.resolve(n);D<F;)I=I.then(Z[D++],Z[D++]);return I}F=i.length;let $=n;for(;D<F;){const Z=i[D++],q=i[D++];try{$=Z($)}catch(X){q.call(this,X);break}}try{I=OO.call(this,$)}catch(Z){return Promise.reject(Z)}for(D=0,F=P.length;D<F;)I=I.then(P[D++],P[D++]);return I}getUri(t){t=Yg(this.defaults,t);const n=DF(t.baseURL,t.url,t.allowAbsoluteUrls);return IF(n,t.params,t.paramsSerializer)}};Wt.forEach(["delete","get","head","options"],function(t){Bg.prototype[t]=function(n,o){return this.request(Yg(o||{},{method:t,url:n,data:(o||{}).data}))}});Wt.forEach(["post","put","patch"],function(t){function n(o){return function(d,g,i){return this.request(Yg(i||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:d,data:g}))}}Bg.prototype[t]=n(),Bg.prototype[t+"Form"]=n(!0)});let G9=class FF{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(d){n=d});const o=this;this.promise.then(u=>{if(!o._listeners)return;let d=o._listeners.length;for(;d-- >0;)o._listeners[d](u);o._listeners=null}),this.promise.then=u=>{let d;const g=new Promise(i=>{o.subscribe(i),d=i}).then(u);return g.cancel=function(){o.unsubscribe(d)},g},t(function(d,g,i){o.reason||(o.reason=new ky(d,g,i),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=o=>{t.abort(o)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new FF(function(u){t=u}),cancel:t}}};function W9(e){return function(n){return e.apply(null,n)}}function q9(e){return Wt.isObject(e)&&e.isAxiosError===!0}const HE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HE).forEach(([e,t])=>{HE[t]=e});function BF(e){const t=new Bg(e),n=_F(Bg.prototype.request,t);return Wt.extend(n,Bg.prototype,t,{allOwnKeys:!0}),Wt.extend(n,t,null,{allOwnKeys:!0}),n.create=function(u){return BF(Yg(e,u))},n}const go=BF(Ux);go.Axios=Bg;go.CanceledError=ky;go.CancelToken=G9;go.isCancel=RF;go.VERSION=NF;go.toFormData=fw;go.AxiosError=ei;go.Cancel=go.CanceledError;go.all=function(t){return Promise.all(t)};go.spread=W9;go.isAxiosError=q9;go.mergeConfig=Yg;go.AxiosHeaders=ic;go.formToJSON=e=>kF(Wt.isHTMLForm(e)?new FormData(e):e);go.getAdapter=zF.getAdapter;go.HttpStatusCode=HE;go.default=go;const{Axios:e_e,AxiosError:t_e,CanceledError:n_e,isCancel:r_e,CancelToken:i_e,VERSION:s_e,all:o_e,Cancel:a_e,isAxiosError:l_e,spread:c_e,toFormData:u_e,AxiosHeaders:h_e,HttpStatusCode:d_e,formToJSON:f_e,getAdapter:p_e,mergeConfig:m_e}=go,ui=go.create({baseURL:"https://api.auxein.co.nz/api/v1",headers:{"Content-Type":"application/json"}});ui.interceptors.request.use(e=>{const t=localStorage.getItem("public_access_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));ui.interceptors.response.use(e=>e,async e=>{var n,o,u;const t=e.config;if(((n=e.response)==null?void 0:n.status)===401&&!t._retry)return t._retry=!0,localStorage.removeItem("public_access_token"),localStorage.removeItem("public_user"),Promise.reject(e);if(e.response){const d=((o=e.response.data)==null?void 0:o.detail)||((u=e.response.data)==null?void 0:u.message)||e.message;return Promise.reject(new Error(d))}return Promise.reject(new Error("Network error. Please check your connection."))});const Ql={signup:async function(e){return(await ui.post("/public/auth/signup",e)).data},login:async function(e,t){const n=await ui.post("/public/auth/login",{email:e,password:t});return n.data.access_token&&(localStorage.setItem("public_access_token",n.data.access_token),localStorage.setItem("public_user",JSON.stringify(n.data.user))),n.data},getCurrentUser:async function(){return(await ui.get("/public/auth/me")).data},updateProfile:async function(e){const t=await ui.patch("/public/auth/me",e);return t.data&&localStorage.setItem("public_user",JSON.stringify(t.data)),t.data},updateMarketingPreferences:async function(e){return(await ui.patch("/public/auth/me/marketing-preferences",e)).data},verifyEmail:async function(e){return(await ui.post("/public/auth/verify-email",{token:e})).data},resendVerification:async function(e){return(await ui.post("/public/auth/resend-verification",{email:e})).data},forgotPassword:async function(e){return(await ui.post("/public/auth/forgot-password",{email:e})).data},resetPassword:async function(e,t){return(await ui.post("/public/auth/reset-password",{token:e,new_password:t})).data},getUserTypes:async function(){return(await ui.get("/public/auth/user-types")).data},getRegions:async function(){return(await ui.get("/public/auth/regions")).data},logout:function(){localStorage.removeItem("public_access_token"),localStorage.removeItem("public_user")},isAuthenticated:function(){return!!localStorage.getItem("public_access_token")},getStoredUser:function(){const e=localStorage.getItem("public_user");return e?JSON.parse(e):null},getToken:function(){return localStorage.getItem("public_access_token")}},{signup:Z9,login:X9,getCurrentUser:Y9,updateProfile:K9,updateMarketingPreferences:J9,verifyEmail:Q9,resendVerification:eZ,forgotPassword:UF,resetPassword:tZ,getUserTypes:VF,getRegions:nZ,logout:rZ,isAuthenticated:iZ,getStoredUser:sZ,getToken:oZ}=Ql,pC=Object.freeze(Object.defineProperty({__proto__:null,default:Ql,forgotPassword:UF,getCurrentUser:Y9,getRegions:nZ,getStoredUser:sZ,getToken:oZ,getUserTypes:VF,isAuthenticated:iZ,login:X9,logout:rZ,resendVerification:eZ,resetPassword:tZ,signup:Z9,updateMarketingPreferences:J9,updateProfile:K9,verifyEmail:Q9},Symbol.toStringTag,{value:"Module"})),$F=te.createContext(null),HF=({children:e})=>{const[t,n]=te.useState(null),[o,u]=te.useState(!0),[d,g]=te.useState(!1);te.useEffect(()=>{(async()=>{const Z=Ql.getToken(),q=Ql.getStoredUser();if(Z&&q)try{const X=await Ql.getCurrentUser();n(X),g(!0)}catch{P()}u(!1)})()},[]);const i=async($,Z)=>{const q=await Ql.login($,Z);return n(q.user),g(!0),q},E=async $=>await Ql.signup($),P=()=>{Ql.logout(),n(null),g(!1)},F={user:t,loading:o,isAuthenticated:d,login:i,signup:E,logout:P,updateProfile:async $=>{const Z=await Ql.updateProfile($);return n(Z),Z},updateMarketingPreferences:async $=>{await Ql.updateMarketingPreferences($);const Z=await Ql.getCurrentUser();n(Z)}};return b.jsx($F.Provider,{value:F,children:e})},Ry=()=>{const e=te.useContext($F);if(!e)throw new Error("usePublicAuth must be used within PublicAuthProvider");return e},aZ=[{value:"wrong_variety",label:"Wrong Variety"},{value:"wrong_name",label:"Wrong Block Name"},{value:"wrong_area",label:"Wrong Area"},{value:"wrong_location",label:"Wrong Location"},{value:"other",label:"Other Issue"}];function lZ({block:e,onClose:t,onSuccess:n}){const[o,u]=te.useState(""),[d,g]=te.useState(""),[i,E]=te.useState(!1),[P,I]=te.useState(!1),[D,F]=te.useState(null),$=async Z=>{if(Z.preventDefault(),!o){F("Please select an issue type");return}if(!d.trim()){F("Please provide a description");return}E(!0),F(null);try{await ui.post("/public/feedback/report-issue",{block_id:e.id,block_name:e.block_name||"Unnamed Block",issue_type:o,description:d.trim(),reported_at:new Date().toISOString()}),I(!0),setTimeout(()=>{n&&n(),t&&t()},2e3)}catch(q){console.error("Error reporting issue:",q),F(q.message||"Failed to submit report. Please try again.")}finally{E(!1)}};return P?b.jsxs("div",{className:"report-success",children:[b.jsx(ZW,{size:24,className:"success-icon"}),b.jsx("p",{children:"Thank you! Your report has been submitted."})]}):b.jsxs("div",{className:"report-issue-form",children:[b.jsx("h4",{children:"Report Data Issue"}),b.jsxs("form",{onSubmit:$,children:[b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"issue-type",children:"Issue Type *"}),b.jsxs("select",{id:"issue-type",value:o,onChange:Z=>u(Z.target.value),required:!0,disabled:i,children:[b.jsx("option",{value:"",children:"Select an issue type..."}),aZ.map(Z=>b.jsx("option",{value:Z.value,children:Z.label},Z.value))]})]}),b.jsxs("div",{className:"form-group",children:[b.jsxs("label",{htmlFor:"description",children:["Description *",o&&b.jsx("span",{className:"label-hint",children:cZ(o,e)})]}),b.jsx("textarea",{id:"description",value:d,onChange:Z=>g(Z.target.value),placeholder:"Please describe the issue in detail...",rows:4,required:!0,disabled:i})]}),D&&b.jsxs("div",{className:"form-error",children:[b.jsx(Sm,{size:16}),b.jsx("span",{children:D})]}),b.jsxs("div",{className:"form-actions",children:[b.jsx("button",{type:"button",className:"btn-secondary",onClick:t,disabled:i,children:"Cancel"}),b.jsx("button",{type:"submit",className:"btn-primary",disabled:i,children:i?b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"spinner"}),"Submitting..."]}):b.jsxs(b.Fragment,{children:[b.jsx(H7,{size:16}),"Submit Report"]})})]})]}),b.jsx("p",{className:"form-note",children:"Reports are reviewed by our team and updates are typically processed within 2-3 business days."})]})}function cZ(e,t){var n;switch(e){case"wrong_variety":return`Current: ${t.variety||"Unknown"}. What is the correct variety?`;case"wrong_name":return`Current: ${t.block_name||"Unnamed"}. What is the correct name?`;case"wrong_area":return`Current: ${((n=t.area)==null?void 0:n.toFixed(2))||"Unknown"} ha. What is the correct area?`;case"wrong_location":return"Please describe the correct location or coordinates.";case"other":return"Please provide details about the issue.";default:return""}}function uZ({block:e,onClose:t}){const[n,o]=te.useState(!1),[u,d]=te.useState(!1),g=te.useRef(null);if(te.useEffect(()=>{const P=()=>d(window.innerWidth<=768);return P(),window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[]),te.useEffect(()=>{const P=I=>{I.key==="Escape"&&t()};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[t]),te.useEffect(()=>{if(u)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[u]),!e)return null;const i=[];e.organic&&i.push({icon:b.jsx(J7,{size:16}),label:"Organic",color:"#22c55e"}),e.biodynamic&&i.push({icon:b.jsx(k7,{size:16}),label:"Biodynamic",color:"#8b5cf6"}),e.regenerative&&i.push({icon:b.jsx(z7,{size:16}),label:"Regenerative",color:"#3b82f6"}),e.swnz&&i.push({icon:b.jsx(kW,{size:16}),label:"SWNZ",color:"#f59e0b"});const E=P=>{P.target===P.currentTarget&&t()};return b.jsx("div",{className:"block-popup-overlay",onClick:E,role:"dialog","aria-modal":"true","aria-labelledby":"block-popup-title",children:b.jsxs("div",{className:"block-popup",ref:g,onClick:P=>P.stopPropagation(),children:[u&&b.jsx("div",{className:"popup-drag-handle",children:b.jsx("div",{className:"drag-handle-bar"})}),b.jsxs("div",{className:"popup-header",children:[b.jsx("h3",{id:"block-popup-title",children:e.block_name||"Unnamed Block"}),b.jsx("button",{className:"popup-close-btn",onClick:t,"aria-label":"Close popup",type:"button",children:b.jsx(hl,{size:20})})]}),b.jsxs("div",{className:"popup-content",children:[e.variety&&b.jsxs("div",{className:"popup-row",children:[b.jsx("div",{className:"popup-icon",children:b.jsx($d,{size:18})}),b.jsxs("div",{className:"popup-details",children:[b.jsx("span",{className:"popup-label",children:"Variety"}),b.jsx("span",{className:"popup-value",children:e.variety})]})]}),e.area&&b.jsxs("div",{className:"popup-row",children:[b.jsx("div",{className:"popup-icon",children:b.jsx(aa,{size:18})}),b.jsxs("div",{className:"popup-details",children:[b.jsx("span",{className:"popup-label",children:"Area"}),b.jsxs("span",{className:"popup-value",children:[e.area.toFixed(2)," ha"]})]})]}),e.region&&b.jsxs("div",{className:"popup-row",children:[b.jsx("div",{className:"popup-icon",children:b.jsx(aa,{size:18})}),b.jsxs("div",{className:"popup-details",children:[b.jsx("span",{className:"popup-label",children:"Region"}),b.jsxs("span",{className:"popup-value",children:[e.region,e.gi&&` (${e.gi})`]})]})]}),e.planted_date&&b.jsxs("div",{className:"popup-row",children:[b.jsx("div",{className:"popup-icon",children:b.jsx(hp,{size:18})}),b.jsxs("div",{className:"popup-details",children:[b.jsx("span",{className:"popup-label",children:"Planted"}),b.jsxs("span",{className:"popup-value",children:[new Date(e.planted_date).getFullYear(),e.age_years&&` (${e.age_years} years old)`]})]})]}),e.elevation&&b.jsxs("div",{className:"popup-row",children:[b.jsx("div",{className:"popup-icon",children:b.jsx(O7,{size:18})}),b.jsxs("div",{className:"popup-details",children:[b.jsx("span",{className:"popup-label",children:"Elevation"}),b.jsxs("span",{className:"popup-value",children:[Math.round(e.elevation),"m"]})]})]}),e.winery&&b.jsxs("div",{className:"popup-row",children:[b.jsx("div",{className:"popup-icon",children:b.jsx(DW,{size:18})}),b.jsxs("div",{className:"popup-details",children:[b.jsx("span",{className:"popup-label",children:"Winery"}),b.jsx("span",{className:"popup-value",children:e.winery})]})]}),i.length>0&&b.jsxs("div",{className:"popup-badges",children:[b.jsx("span",{className:"popup-label",children:"Sustainability"}),b.jsx("div",{className:"badge-list",children:i.map((P,I)=>b.jsxs("div",{className:"sustainability-badge",style:{borderColor:P.color},children:[b.jsx("span",{style:{color:P.color},children:P.icon}),b.jsx("span",{children:P.label})]},I))})]})]}),b.jsx("div",{className:"popup-footer",children:n?b.jsx(lZ,{block:e,onClose:()=>o(!1),onSuccess:()=>{o(!1)}}):b.jsx("button",{className:"report-issue-btn",onClick:()=>o(!0),type:"button",children:"Suggest Data Update"})})]})})}function hZ({region:e,onClose:t,onExploreStats:n}){var F,$,Z;const[o,u]=te.useState(null),[d,g]=te.useState(!0),[i,E]=te.useState(null);te.useEffect(()=>{e!=null&&e.slug&&P()},[e==null?void 0:e.slug]);const P=async()=>{try{g(!0),E(null);const q=await ui.get(`/public/regions/${e.slug}`);u(q.data)}catch(q){console.error("Error loading region details:",q),E("Failed to load region details")}finally{g(!1)}},I=q=>q?new Intl.NumberFormat("en-NZ",{maximumFractionDigits:1}).format(q):"",D=(q,X=3)=>q!=null&&q.varieties?q.varieties.slice(0,X):[];return e?b.jsxs("div",{className:"region-popup",children:[b.jsxs("div",{className:"region-popup-header",children:[b.jsxs("div",{className:"region-popup-title",children:[b.jsx(aa,{size:18}),b.jsx("h3",{children:e.name||(o==null?void 0:o.name)})]}),b.jsx("button",{className:"popup-close-btn",onClick:t,children:b.jsx(hl,{size:18})})]}),b.jsx("div",{className:"region-popup-content",children:d?b.jsxs("div",{className:"popup-loading",children:[b.jsx("div",{className:"loading-spinner small"}),b.jsx("span",{children:"Loading..."})]}):i?b.jsx("div",{className:"popup-error",children:i}):o?b.jsxs(b.Fragment,{children:[o.summary&&b.jsx("p",{className:"region-summary",children:o.summary}),b.jsx("div",{className:"region-stats",children:b.jsxs("div",{className:"stat-item",children:[b.jsx("span",{className:"stat-label",children:"Total Planted"}),b.jsxs("span",{className:"stat-value",children:[I((F=o.stats)==null?void 0:F.total_planted_ha)," ha"]})]})}),(($=o.stats)==null?void 0:$.varieties)&&o.stats.varieties.length>0&&b.jsxs("div",{className:"region-varieties",children:[b.jsxs("h4",{children:[b.jsx($d,{size:14}),"Top Varieties"]}),b.jsx("div",{className:"variety-list",children:D(o.stats).map((q,X)=>b.jsxs("div",{className:"variety-item",children:[b.jsx("span",{className:"variety-name",children:q.name}),b.jsxs("span",{className:"variety-percent",children:[I(q.percentage),"%"]})]},X))})]}),o.climate_summary&&b.jsxs("div",{className:"region-climate",children:[b.jsx("h4",{children:"Climate"}),b.jsx("p",{children:o.climate_summary})]}),n&&b.jsxs("button",{className:"region-action-btn",onClick:()=>n(o),children:[b.jsx(lC,{size:16}),"Explore Region Stats",b.jsx(Fd,{size:16})]})]}):null}),((Z=o==null?void 0:o.stats)==null?void 0:Z.source)&&b.jsxs("div",{className:"popup-footer",children:["Source: ",o.stats.source]})]}):null}function dZ({gi:e,onClose:t}){const[n,o]=te.useState(null),[u,d]=te.useState(!0),[g,i]=te.useState(null);te.useEffect(()=>{e!=null&&e.slug&&E()},[e==null?void 0:e.slug]);const E=async()=>{try{d(!0),i(null);const D=await ui.get(`/public/gis/${e.slug}`);o(D.data)}catch(D){console.error("Error loading GI details:",D),i("Failed to load GI details")}finally{d(!1)}},P=D=>D?new Date(D).toLocaleDateString("en-NZ",{day:"numeric",month:"short",year:"numeric"}):"",I=D=>{switch(D==null?void 0:D.toLowerCase()){case"registered":return"status-registered";case"pending":return"status-pending";case"expired":return"status-expired";default:return""}};return e?b.jsxs("div",{className:"gi-popup",children:[b.jsxs("div",{className:"gi-popup-header",children:[b.jsxs("div",{className:"gi-popup-title",children:[b.jsx(Fg,{size:18}),b.jsx("h3",{children:e.name||(n==null?void 0:n.name)})]}),b.jsx("button",{className:"popup-close-btn",onClick:t,children:b.jsx(hl,{size:18})})]}),b.jsx("div",{className:"gi-popup-content",children:u?b.jsxs("div",{className:"popup-loading",children:[b.jsx("div",{className:"loading-spinner small"}),b.jsx("span",{children:"Loading..."})]}):g?b.jsx("div",{className:"popup-error",children:g}):n?b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"gi-status-row",children:[b.jsx("span",{className:`gi-status-badge ${I(n.status)}`,children:n.status||"Unknown"}),n.region_name&&b.jsxs("span",{className:"gi-region-tag",children:[b.jsx(aa,{size:12}),n.region_name]})]}),b.jsxs("div",{className:"gi-info",children:[b.jsx("h4",{children:"Registration Details"}),b.jsxs("div",{className:"gi-info-grid",children:[b.jsxs("div",{className:"gi-info-item",children:[b.jsx("span",{className:"gi-info-label",children:"IP Number"}),b.jsx("span",{className:"gi-info-value",children:n.ip_number||""})]}),b.jsxs("div",{className:"gi-info-item",children:[b.jsx("span",{className:"gi-info-label",children:"Registration Date"}),b.jsx("span",{className:"gi-info-value",children:P(n.registration_date)})]}),b.jsxs("div",{className:"gi-info-item",children:[b.jsx("span",{className:"gi-info-label",children:"Renewal Due"}),b.jsx("span",{className:"gi-info-value",children:P(n.renewal_date)})]})]})]}),n.notes&&b.jsx("div",{className:"gi-notes",children:b.jsx("p",{children:n.notes})}),n.iponz_url&&b.jsxs("a",{href:n.iponz_url,target:"_blank",rel:"noopener noreferrer",className:"gi-link-btn",children:[b.jsx("span",{children:"View on IPoNZ Register"}),b.jsx(Nd,{size:14})]})]}):null}),b.jsxs("div",{className:"popup-footer",children:[b.jsx(hp,{size:12}),b.jsx("span",{children:"Geographical Indication protected under NZ law"})]})]}):null}function GF(e){var t,n,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var u=e.length;for(t=0;t<u;t++)e[t]&&(n=GF(e[t]))&&(o&&(o+=" "),o+=n)}else for(n in e)e[n]&&(o&&(o+=" "),o+=n);return o}function Oo(){for(var e,t,n=0,o="",u=arguments.length;n<u;n++)(e=arguments[n])&&(t=GF(e))&&(o&&(o+=" "),o+=t);return o}var fZ=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function mC(e){if(typeof e!="string")return!1;var t=fZ;return t.includes(e)}var pZ=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],mZ=new Set(pZ);function WF(e){return typeof e!="string"?!1:mZ.has(e)}function qF(e){return typeof e=="string"&&e.startsWith("data-")}function my(e){if(typeof e!="object"||e===null)return{};var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(WF(n)||qF(n))&&(t[n]=e[n]);return t}function GE(e){if(e==null)return null;if(te.isValidElement(e)&&typeof e.props=="object"&&e.props!==null){var t=e.props;return my(t)}return typeof e=="object"&&!Array.isArray(e)?my(e):null}function Cu(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(WF(n)||qF(n)||mC(n))&&(t[n]=e[n]);return t}var gZ=["children","width","height","viewBox","className","style","title","desc"];function WE(){return WE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},WE.apply(null,arguments)}function _Z(e,t){if(e==null)return{};var n,o,u=yZ(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function yZ(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var ZF=te.forwardRef((e,t)=>{var{children:n,width:o,height:u,viewBox:d,className:g,style:i,title:E,desc:P}=e,I=_Z(e,gZ),D=d||{width:o,height:u,x:0,y:0},F=Oo("recharts-surface",g);return te.createElement("svg",WE({},Cu(I),{className:F,width:o,height:u,style:i,viewBox:"".concat(D.x," ").concat(D.y," ").concat(D.width," ").concat(D.height),ref:t}),te.createElement("title",null,E),te.createElement("desc",null,P),n)}),vZ=["children","className"];function qE(){return qE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},qE.apply(null,arguments)}function xZ(e,t){if(e==null)return{};var n,o,u=bZ(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function bZ(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var Cm=te.forwardRef((e,t)=>{var{children:n,className:o}=e,u=xZ(e,vZ),d=Oo("recharts-layer",o);return te.createElement("g",qE({className:d},Cu(u),{ref:t}),n)}),wZ=te.createContext(null);function vs(e){return function(){return e}}const XF=Math.cos,s1=Math.sin,Vh=Math.sqrt,o1=Math.PI,mw=2*o1,ZE=Math.PI,XE=2*ZE,Ig=1e-6,SZ=XE-Ig;function YF(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function TZ(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return YF;const n=10**t;return function(o){this._+=o[0];for(let u=1,d=o.length;u<d;++u)this._+=Math.round(arguments[u]*n)/n+o[u]}}class EZ{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?YF:TZ(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,o,u){this._append`Q${+t},${+n},${this._x1=+o},${this._y1=+u}`}bezierCurveTo(t,n,o,u,d,g){this._append`C${+t},${+n},${+o},${+u},${this._x1=+d},${this._y1=+g}`}arcTo(t,n,o,u,d){if(t=+t,n=+n,o=+o,u=+u,d=+d,d<0)throw new Error(`negative radius: ${d}`);let g=this._x1,i=this._y1,E=o-t,P=u-n,I=g-t,D=i-n,F=I*I+D*D;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(F>Ig)if(!(Math.abs(D*E-P*I)>Ig)||!d)this._append`L${this._x1=t},${this._y1=n}`;else{let $=o-g,Z=u-i,q=E*E+P*P,X=$*$+Z*Z,re=Math.sqrt(q),le=Math.sqrt(F),ue=d*Math.tan((ZE-Math.acos((q+F-X)/(2*re*le)))/2),ye=ue/le,ge=ue/re;Math.abs(ye-1)>Ig&&this._append`L${t+ye*I},${n+ye*D}`,this._append`A${d},${d},0,0,${+(D*$>I*Z)},${this._x1=t+ge*E},${this._y1=n+ge*P}`}}arc(t,n,o,u,d,g){if(t=+t,n=+n,o=+o,g=!!g,o<0)throw new Error(`negative radius: ${o}`);let i=o*Math.cos(u),E=o*Math.sin(u),P=t+i,I=n+E,D=1^g,F=g?u-d:d-u;this._x1===null?this._append`M${P},${I}`:(Math.abs(this._x1-P)>Ig||Math.abs(this._y1-I)>Ig)&&this._append`L${P},${I}`,o&&(F<0&&(F=F%XE+XE),F>SZ?this._append`A${o},${o},0,1,${D},${t-i},${n-E}A${o},${o},0,1,${D},${this._x1=P},${this._y1=I}`:F>Ig&&this._append`A${o},${o},0,${+(F>=ZE)},${D},${this._x1=t+o*Math.cos(d)},${this._y1=n+o*Math.sin(d)}`)}rect(t,n,o,u){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${o=+o}v${+u}h${-o}Z`}toString(){return this._}}function gC(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const o=Math.floor(n);if(!(o>=0))throw new RangeError(`invalid digits: ${n}`);t=o}return e},()=>new EZ(t)}function _C(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function KF(e){this._context=e}KF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function gw(e){return new KF(e)}function JF(e){return e[0]}function QF(e){return e[1]}function eB(e,t){var n=vs(!0),o=null,u=gw,d=null,g=gC(i);e=typeof e=="function"?e:e===void 0?JF:vs(e),t=typeof t=="function"?t:t===void 0?QF:vs(t);function i(E){var P,I=(E=_C(E)).length,D,F=!1,$;for(o==null&&(d=u($=g())),P=0;P<=I;++P)!(P<I&&n(D=E[P],P,E))===F&&((F=!F)?d.lineStart():d.lineEnd()),F&&d.point(+e(D,P,E),+t(D,P,E));if($)return d=null,$+""||null}return i.x=function(E){return arguments.length?(e=typeof E=="function"?E:vs(+E),i):e},i.y=function(E){return arguments.length?(t=typeof E=="function"?E:vs(+E),i):t},i.defined=function(E){return arguments.length?(n=typeof E=="function"?E:vs(!!E),i):n},i.curve=function(E){return arguments.length?(u=E,o!=null&&(d=u(o)),i):u},i.context=function(E){return arguments.length?(E==null?o=d=null:d=u(o=E),i):o},i}function rb(e,t,n){var o=null,u=vs(!0),d=null,g=gw,i=null,E=gC(P);e=typeof e=="function"?e:e===void 0?JF:vs(+e),t=typeof t=="function"?t:vs(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?QF:vs(+n);function P(D){var F,$,Z,q=(D=_C(D)).length,X,re=!1,le,ue=new Array(q),ye=new Array(q);for(d==null&&(i=g(le=E())),F=0;F<=q;++F){if(!(F<q&&u(X=D[F],F,D))===re)if(re=!re)$=F,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),Z=F-1;Z>=$;--Z)i.point(ue[Z],ye[Z]);i.lineEnd(),i.areaEnd()}re&&(ue[F]=+e(X,F,D),ye[F]=+t(X,F,D),i.point(o?+o(X,F,D):ue[F],n?+n(X,F,D):ye[F]))}if(le)return i=null,le+""||null}function I(){return eB().defined(u).curve(g).context(d)}return P.x=function(D){return arguments.length?(e=typeof D=="function"?D:vs(+D),o=null,P):e},P.x0=function(D){return arguments.length?(e=typeof D=="function"?D:vs(+D),P):e},P.x1=function(D){return arguments.length?(o=D==null?null:typeof D=="function"?D:vs(+D),P):o},P.y=function(D){return arguments.length?(t=typeof D=="function"?D:vs(+D),n=null,P):t},P.y0=function(D){return arguments.length?(t=typeof D=="function"?D:vs(+D),P):t},P.y1=function(D){return arguments.length?(n=D==null?null:typeof D=="function"?D:vs(+D),P):n},P.lineX0=P.lineY0=function(){return I().x(e).y(t)},P.lineY1=function(){return I().x(e).y(n)},P.lineX1=function(){return I().x(o).y(t)},P.defined=function(D){return arguments.length?(u=typeof D=="function"?D:vs(!!D),P):u},P.curve=function(D){return arguments.length?(g=D,d!=null&&(i=g(d)),P):g},P.context=function(D){return arguments.length?(D==null?d=i=null:i=g(d=D),P):d},P}class tB{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function AZ(e){return new tB(e,!0)}function CZ(e){return new tB(e,!1)}const yC={draw(e,t){const n=Vh(t/o1);e.moveTo(n,0),e.arc(0,0,n,0,mw)}},PZ={draw(e,t){const n=Vh(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},nB=Vh(1/3),IZ=nB*2,MZ={draw(e,t){const n=Vh(t/IZ),o=n*nB;e.moveTo(0,-n),e.lineTo(o,0),e.lineTo(0,n),e.lineTo(-o,0),e.closePath()}},kZ={draw(e,t){const n=Vh(t),o=-n/2;e.rect(o,o,n,n)}},RZ=.8908130915292852,rB=s1(o1/10)/s1(7*o1/10),OZ=s1(mw/10)*rB,DZ=-XF(mw/10)*rB,LZ={draw(e,t){const n=Vh(t*RZ),o=OZ*n,u=DZ*n;e.moveTo(0,-n),e.lineTo(o,u);for(let d=1;d<5;++d){const g=mw*d/5,i=XF(g),E=s1(g);e.lineTo(E*n,-i*n),e.lineTo(i*o-E*u,E*o+i*u)}e.closePath()}},z2=Vh(3),jZ={draw(e,t){const n=-Vh(t/(z2*3));e.moveTo(0,n*2),e.lineTo(-z2*n,-n),e.lineTo(z2*n,-n),e.closePath()}},yu=-.5,vu=Vh(3)/2,YE=1/Vh(12),zZ=(YE/2+1)*3,NZ={draw(e,t){const n=Vh(t/zZ),o=n/2,u=n*YE,d=o,g=n*YE+n,i=-d,E=g;e.moveTo(o,u),e.lineTo(d,g),e.lineTo(i,E),e.lineTo(yu*o-vu*u,vu*o+yu*u),e.lineTo(yu*d-vu*g,vu*d+yu*g),e.lineTo(yu*i-vu*E,vu*i+yu*E),e.lineTo(yu*o+vu*u,yu*u-vu*o),e.lineTo(yu*d+vu*g,yu*g-vu*d),e.lineTo(yu*i+vu*E,yu*E-vu*i),e.closePath()}};function FZ(e,t){let n=null,o=gC(u);e=typeof e=="function"?e:vs(e||yC),t=typeof t=="function"?t:vs(t===void 0?64:+t);function u(){let d;if(n||(n=d=o()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),d)return n=null,d+""||null}return u.type=function(d){return arguments.length?(e=typeof d=="function"?d:vs(d),u):e},u.size=function(d){return arguments.length?(t=typeof d=="function"?d:vs(+d),u):t},u.context=function(d){return arguments.length?(n=d??null,u):n},u}function a1(){}function l1(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function iB(e){this._context=e}iB.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:l1(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:l1(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function BZ(e){return new iB(e)}function sB(e){this._context=e}sB.prototype={areaStart:a1,areaEnd:a1,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:l1(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function UZ(e){return new sB(e)}function oB(e){this._context=e}oB.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 3:this._point=4;default:l1(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function VZ(e){return new oB(e)}function aB(e){this._context=e}aB.prototype={areaStart:a1,areaEnd:a1,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function $Z(e){return new aB(e)}function LO(e){return e<0?-1:1}function jO(e,t,n){var o=e._x1-e._x0,u=t-e._x1,d=(e._y1-e._y0)/(o||u<0&&-0),g=(n-e._y1)/(u||o<0&&-0),i=(d*u+g*o)/(o+u);return(LO(d)+LO(g))*Math.min(Math.abs(d),Math.abs(g),.5*Math.abs(i))||0}function zO(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function N2(e,t,n){var o=e._x0,u=e._y0,d=e._x1,g=e._y1,i=(d-o)/3;e._context.bezierCurveTo(o+i,u+i*t,d-i,g-i*n,d,g)}function c1(e){this._context=e}c1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:N2(this,this._t0,zO(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,N2(this,zO(this,n=jO(this,e,t)),n);break;default:N2(this,this._t0,n=jO(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function lB(e){this._context=new cB(e)}(lB.prototype=Object.create(c1.prototype)).point=function(e,t){c1.prototype.point.call(this,t,e)};function cB(e){this._context=e}cB.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,o,u,d){this._context.bezierCurveTo(t,e,o,n,d,u)}};function HZ(e){return new c1(e)}function GZ(e){return new lB(e)}function uB(e){this._context=e}uB.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var o=NO(e),u=NO(t),d=0,g=1;g<n;++d,++g)this._context.bezierCurveTo(o[0][d],u[0][d],o[1][d],u[1][d],e[g],t[g]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function NO(e){var t,n=e.length-1,o,u=new Array(n),d=new Array(n),g=new Array(n);for(u[0]=0,d[0]=2,g[0]=e[0]+2*e[1],t=1;t<n-1;++t)u[t]=1,d[t]=4,g[t]=4*e[t]+2*e[t+1];for(u[n-1]=2,d[n-1]=7,g[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)o=u[t]/d[t-1],d[t]-=o,g[t]-=o*g[t-1];for(u[n-1]=g[n-1]/d[n-1],t=n-2;t>=0;--t)u[t]=(g[t]-u[t+1])/d[t];for(d[n-1]=(e[n]+u[n-1])/2,t=0;t<n-1;++t)d[t]=2*e[t+1]-u[t+1];return[u,d]}function WZ(e){return new uB(e)}function _w(e,t){this._context=e,this._t=t}_w.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function qZ(e){return new _w(e,.5)}function ZZ(e){return new _w(e,0)}function XZ(e){return new _w(e,1)}function Kg(e,t){if((g=e.length)>1)for(var n=1,o,u,d=e[t[0]],g,i=d.length;n<g;++n)for(u=d,d=e[t[n]],o=0;o<i;++o)d[o][1]+=d[o][0]=isNaN(u[o][1])?u[o][0]:u[o][1]}function KE(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function YZ(e,t){return e[t]}function KZ(e){const t=[];return t.key=e,t}function JZ(){var e=vs([]),t=KE,n=Kg,o=YZ;function u(d){var g=Array.from(e.apply(this,arguments),KZ),i,E=g.length,P=-1,I;for(const D of d)for(i=0,++P;i<E;++i)(g[i][P]=[0,+o(D,g[i].key,P,d)]).data=D;for(i=0,I=_C(t(g));i<E;++i)g[I[i]].index=i;return n(g,I),g}return u.keys=function(d){return arguments.length?(e=typeof d=="function"?d:vs(Array.from(d)),u):e},u.value=function(d){return arguments.length?(o=typeof d=="function"?d:vs(+d),u):o},u.order=function(d){return arguments.length?(t=d==null?KE:typeof d=="function"?d:vs(Array.from(d)),u):t},u.offset=function(d){return arguments.length?(n=d??Kg,u):n},u}function QZ(e,t){if((o=e.length)>0){for(var n,o,u=0,d=e[0].length,g;u<d;++u){for(g=n=0;n<o;++n)g+=e[n][u][1]||0;if(g)for(n=0;n<o;++n)e[n][u][1]/=g}Kg(e,t)}}function eX(e,t){if((u=e.length)>0){for(var n=0,o=e[t[0]],u,d=o.length;n<d;++n){for(var g=0,i=0;g<u;++g)i+=e[g][n][1]||0;o[n][1]+=o[n][0]=-i/2}Kg(e,t)}}function tX(e,t){if(!(!((g=e.length)>0)||!((d=(u=e[t[0]]).length)>0))){for(var n=0,o=1,u,d,g;o<d;++o){for(var i=0,E=0,P=0;i<g;++i){for(var I=e[t[i]],D=I[o][1]||0,F=I[o-1][1]||0,$=(D-F)/2,Z=0;Z<i;++Z){var q=e[t[Z]],X=q[o][1]||0,re=q[o-1][1]||0;$+=X-re}E+=D,P+=$*D}u[o-1][1]+=u[o-1][0]=n,E&&(n-=P/E)}u[o-1][1]+=u[o-1][0]=n,Kg(e,t)}}var F2={},B2={},FO;function nX(){return FO||(FO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n==="__proto__"}e.isUnsafeProperty=t})(B2)),B2}var U2={},BO;function hB(){return BO||(BO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){switch(typeof n){case"number":case"symbol":return!1;case"string":return n.includes(".")||n.includes("[")||n.includes("]")}}e.isDeepKey=t})(U2)),U2}var V2={},UO;function vC(){return UO||(UO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){var o;return typeof n=="string"||typeof n=="symbol"?n:Object.is((o=n==null?void 0:n.valueOf)==null?void 0:o.call(n),-0)?"-0":String(n)}e.toKey=t})(V2)),V2}var $2={},H2={},VO;function rX(){return VO||(VO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){if(n==null)return"";if(typeof n=="string")return n;if(Array.isArray(n))return n.map(t).join(",");const o=String(n);return o==="0"&&Object.is(Number(n),-0)?"-0":o}e.toString=t})(H2)),H2}var $O;function xC(){return $O||($O=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=rX(),n=vC();function o(u){if(Array.isArray(u))return u.map(n.toKey);if(typeof u=="symbol")return[u];u=t.toString(u);const d=[],g=u.length;if(g===0)return d;let i=0,E="",P="",I=!1;for(u.charCodeAt(0)===46&&(d.push(""),i++);i<g;){const D=u[i];P?D==="\\"&&i+1<g?(i++,E+=u[i]):D===P?P="":E+=D:I?D==='"'||D==="'"?P=D:D==="]"?(I=!1,d.push(E),E=""):E+=D:D==="["?(I=!0,E&&(d.push(E),E="")):D==="."?E&&(d.push(E),E=""):E+=D,i++}return E&&d.push(E),d}e.toPath=o})($2)),$2}var HO;function bC(){return HO||(HO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=nX(),n=hB(),o=vC(),u=xC();function d(i,E,P){if(i==null)return P;switch(typeof E){case"string":{if(t.isUnsafeProperty(E))return P;const I=i[E];return I===void 0?n.isDeepKey(E)?d(i,u.toPath(E),P):P:I}case"number":case"symbol":{typeof E=="number"&&(E=o.toKey(E));const I=i[E];return I===void 0?P:I}default:{if(Array.isArray(E))return g(i,E,P);if(Object.is(E==null?void 0:E.valueOf(),-0)?E="-0":E=String(E),t.isUnsafeProperty(E))return P;const I=i[E];return I===void 0?P:I}}}function g(i,E,P){if(E.length===0)return P;let I=i;for(let D=0;D<E.length;D++){if(I==null||t.isUnsafeProperty(E[D]))return P;I=I[E[D]]}return I===void 0?P:I}e.get=d})(F2)),F2}var G2,GO;function iX(){return GO||(GO=1,G2=bC().get),G2}var sX=iX();const dx=zh(sX);var oX=4;function _m(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:oX,n=10**t,o=Math.round(e*n)/n;return Object.is(o,-0)?0:o}function Js(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return e.reduce((u,d,g)=>{var i=n[g-1];return typeof i=="string"?u+i+d:i!==void 0?u+_m(i)+d:u+d},"")}var tc=e=>e===0?0:e>0?1:-1,dp=e=>typeof e=="number"&&e!=+e,fp=e=>typeof e=="string"&&e.indexOf("%")===e.length-1,Wr=e=>(typeof e=="number"||e instanceof Number)&&!dp(e),pp=e=>Wr(e)||typeof e=="string",aX=0,fx=e=>{var t=++aX;return"".concat(e||"").concat(t)},Lc=function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Wr(t)&&typeof t!="string")return o;var d;if(fp(t)){if(n==null)return o;var g=t.indexOf("%");d=n*parseFloat(t.slice(0,g))/100}else d=+t;return dp(d)&&(d=o),u&&n!=null&&d>n&&(d=n),d},dB=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,n={},o=0;o<t;o++)if(!n[String(e[o])])n[String(e[o])]=!0;else return!0;return!1};function Ah(e,t,n){return Wr(e)&&Wr(t)?_m(e+n*(t-e)):t}function lX(e,t,n){if(!(!e||!e.length))return e.find(o=>o&&(typeof t=="function"?t(o):dx(o,t))===n)}var zc=e=>e===null||typeof e>"u",Vx=e=>zc(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));function cX(e){return e!=null}function $x(){}var uX=["type","size","sizeType"];function JE(){return JE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},JE.apply(null,arguments)}function WO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function qO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WO(Object(n),!0).forEach(function(o){hX(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WO(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function hX(e,t,n){return(t=dX(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dX(e){var t=fX(e,"string");return typeof t=="symbol"?t:t+""}function fX(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pX(e,t){if(e==null)return{};var n,o,u=mX(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function mX(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var fB={symbolCircle:yC,symbolCross:PZ,symbolDiamond:MZ,symbolSquare:kZ,symbolStar:LZ,symbolTriangle:jZ,symbolWye:NZ},gX=Math.PI/180,_X=e=>{var t="symbol".concat(Vx(e));return fB[t]||yC},yX=(e,t,n)=>{if(t==="area")return e;switch(n){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var o=18*gX;return 1.25*e*e*(Math.tan(o)-Math.tan(o*2)*Math.tan(o)**2)}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},vX=(e,t)=>{fB["symbol".concat(Vx(e))]=t},pB=e=>{var{type:t="circle",size:n=64,sizeType:o="area"}=e,u=pX(e,uX),d=qO(qO({},u),{},{type:t,size:n,sizeType:o}),g="circle";typeof t=="string"&&(g=t);var i=()=>{var F=_X(g),$=FZ().type(F).size(yX(n,o,g)),Z=$();if(Z!==null)return Z},{className:E,cx:P,cy:I}=d,D=Cu(d);return Wr(P)&&Wr(I)&&Wr(n)?te.createElement("path",JE({},D,{className:Oo("recharts-symbols",E),transform:"translate(".concat(P,", ").concat(I,")"),d:i()})):null};pB.registerSymbol=vX;var mB=e=>"radius"in e&&"startAngle"in e&&"endAngle"in e,xX=(e,t)=>{if(!e||typeof e=="function"||typeof e=="boolean")return null;var n=e;if(te.isValidElement(e)&&(n=e.props),typeof n!="object"&&typeof n!="function")return null;var o={};return Object.keys(n).forEach(u=>{mC(u)&&(o[u]=(d=>n[u](n,d)))}),o},bX=(e,t,n)=>o=>(e(t,n,o),null),wX=(e,t,n)=>{if(e===null||typeof e!="object"&&typeof e!="function")return null;var o=null;return Object.keys(e).forEach(u=>{var d=e[u];mC(u)&&typeof d=="function"&&(o||(o={}),o[u]=bX(d,t,n))}),o};function ZO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function SX(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZO(Object(n),!0).forEach(function(o){TX(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZO(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function TX(e,t,n){return(t=EX(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function EX(e){var t=AX(e,"string");return typeof t=="symbol"?t:t+""}function AX(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gd(e,t){var n=SX({},e),o=t,u=Object.keys(t),d=u.reduce((g,i)=>(g[i]===void 0&&o[i]!==void 0&&(g[i]=o[i]),g),n);return d}var W2={},q2={},XO;function CX(){return XO||(XO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,o){const u=new Map;for(let d=0;d<n.length;d++){const g=n[d],i=o(g);u.has(i)||u.set(i,g)}return Array.from(u.values())}e.uniqBy=t})(q2)),q2}var Z2={},YO;function gB(){return YO||(YO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n}e.identity=t})(Z2)),Z2}var X2={},Y2={},K2={},KO;function PX(){return KO||(KO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return Number.isSafeInteger(n)&&n>=0}e.isLength=t})(K2)),K2}var JO;function wC(){return JO||(JO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=PX();function n(o){return o!=null&&typeof o!="function"&&t.isLength(o.length)}e.isArrayLike=n})(Y2)),Y2}var J2={},QO;function IX(){return QO||(QO=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return typeof n=="object"&&n!==null}e.isObjectLike=t})(J2)),J2}var eD;function MX(){return eD||(eD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=wC(),n=IX();function o(u){return n.isObjectLike(u)&&t.isArrayLike(u)}e.isArrayLikeObject=o})(X2)),X2}var Q2={},eT={},tD;function kX(){return tD||(tD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=bC();function n(o){return function(u){return t.get(u,o)}}e.property=n})(eT)),eT}var tT={},nT={},rT={},iT={},nD;function _B(){return nD||(nD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n!==null&&(typeof n=="object"||typeof n=="function")}e.isObject=t})(iT)),iT}var sT={},rD;function yB(){return rD||(rD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n==null||typeof n!="object"&&typeof n!="function"}e.isPrimitive=t})(sT)),sT}var oT={},iD;function vB(){return iD||(iD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,o){return n===o||Number.isNaN(n)&&Number.isNaN(o)}e.eq=t})(oT)),oT}var sD;function RX(){return sD||(sD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=_B(),n=yB(),o=vB();function u(I,D,F){return typeof F!="function"?u(I,D,()=>{}):d(I,D,function $(Z,q,X,re,le,ue){const ye=F(Z,q,X,re,le,ue);return ye!==void 0?!!ye:d(Z,q,$,ue)},new Map)}function d(I,D,F,$){if(D===I)return!0;switch(typeof D){case"object":return g(I,D,F,$);case"function":return Object.keys(D).length>0?d(I,{...D},F,$):o.eq(I,D);default:return t.isObject(I)?typeof D=="string"?D==="":!0:o.eq(I,D)}}function g(I,D,F,$){if(D==null)return!0;if(Array.isArray(D))return E(I,D,F,$);if(D instanceof Map)return i(I,D,F,$);if(D instanceof Set)return P(I,D,F,$);const Z=Object.keys(D);if(I==null||n.isPrimitive(I))return Z.length===0;if(Z.length===0)return!0;if($!=null&&$.has(D))return $.get(D)===I;$==null||$.set(D,I);try{for(let q=0;q<Z.length;q++){const X=Z[q];if(!n.isPrimitive(I)&&!(X in I)||D[X]===void 0&&I[X]!==void 0||D[X]===null&&I[X]!==null||!F(I[X],D[X],X,I,D,$))return!1}return!0}finally{$==null||$.delete(D)}}function i(I,D,F,$){if(D.size===0)return!0;if(!(I instanceof Map))return!1;for(const[Z,q]of D.entries()){const X=I.get(Z);if(F(X,q,Z,I,D,$)===!1)return!1}return!0}function E(I,D,F,$){if(D.length===0)return!0;if(!Array.isArray(I))return!1;const Z=new Set;for(let q=0;q<D.length;q++){const X=D[q];let re=!1;for(let le=0;le<I.length;le++){if(Z.has(le))continue;const ue=I[le];let ye=!1;if(F(ue,X,q,I,D,$)&&(ye=!0),ye){Z.add(le),re=!0;break}}if(!re)return!1}return!0}function P(I,D,F,$){return D.size===0?!0:I instanceof Set?E([...I],[...D],F,$):!1}e.isMatchWith=u,e.isSetMatch=P})(rT)),rT}var oD;function xB(){return oD||(oD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=RX();function n(o,u){return t.isMatchWith(o,u,()=>{})}e.isMatch=n})(nT)),nT}var aT={},lT={},cT={},aD;function OX(){return aD||(aD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return Object.getOwnPropertySymbols(n).filter(o=>Object.prototype.propertyIsEnumerable.call(n,o))}e.getSymbols=t})(cT)),cT}var uT={},lD;function bB(){return lD||(lD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}e.getTag=t})(uT)),uT}var hT={},cD;function wB(){return cD||(cD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t="[object RegExp]",n="[object String]",o="[object Number]",u="[object Boolean]",d="[object Arguments]",g="[object Symbol]",i="[object Date]",E="[object Map]",P="[object Set]",I="[object Array]",D="[object Function]",F="[object ArrayBuffer]",$="[object Object]",Z="[object Error]",q="[object DataView]",X="[object Uint8Array]",re="[object Uint8ClampedArray]",le="[object Uint16Array]",ue="[object Uint32Array]",ye="[object BigUint64Array]",ge="[object Int8Array]",we="[object Int16Array]",Le="[object Int32Array]",Ze="[object BigInt64Array]",Ge="[object Float32Array]",gt="[object Float64Array]";e.argumentsTag=d,e.arrayBufferTag=F,e.arrayTag=I,e.bigInt64ArrayTag=Ze,e.bigUint64ArrayTag=ye,e.booleanTag=u,e.dataViewTag=q,e.dateTag=i,e.errorTag=Z,e.float32ArrayTag=Ge,e.float64ArrayTag=gt,e.functionTag=D,e.int16ArrayTag=we,e.int32ArrayTag=Le,e.int8ArrayTag=ge,e.mapTag=E,e.numberTag=o,e.objectTag=$,e.regexpTag=t,e.setTag=P,e.stringTag=n,e.symbolTag=g,e.uint16ArrayTag=le,e.uint32ArrayTag=ue,e.uint8ArrayTag=X,e.uint8ClampedArrayTag=re})(hT)),hT}var dT={},uD;function DX(){return uD||(uD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}e.isTypedArray=t})(dT)),dT}var hD;function SB(){return hD||(hD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=OX(),n=bB(),o=wB(),u=yB(),d=DX();function g(I,D){return i(I,void 0,I,new Map,D)}function i(I,D,F,$=new Map,Z=void 0){const q=Z==null?void 0:Z(I,D,F,$);if(q!==void 0)return q;if(u.isPrimitive(I))return I;if($.has(I))return $.get(I);if(Array.isArray(I)){const X=new Array(I.length);$.set(I,X);for(let re=0;re<I.length;re++)X[re]=i(I[re],re,F,$,Z);return Object.hasOwn(I,"index")&&(X.index=I.index),Object.hasOwn(I,"input")&&(X.input=I.input),X}if(I instanceof Date)return new Date(I.getTime());if(I instanceof RegExp){const X=new RegExp(I.source,I.flags);return X.lastIndex=I.lastIndex,X}if(I instanceof Map){const X=new Map;$.set(I,X);for(const[re,le]of I)X.set(re,i(le,re,F,$,Z));return X}if(I instanceof Set){const X=new Set;$.set(I,X);for(const re of I)X.add(i(re,void 0,F,$,Z));return X}if(typeof Buffer<"u"&&Buffer.isBuffer(I))return I.subarray();if(d.isTypedArray(I)){const X=new(Object.getPrototypeOf(I)).constructor(I.length);$.set(I,X);for(let re=0;re<I.length;re++)X[re]=i(I[re],re,F,$,Z);return X}if(I instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&I instanceof SharedArrayBuffer)return I.slice(0);if(I instanceof DataView){const X=new DataView(I.buffer.slice(0),I.byteOffset,I.byteLength);return $.set(I,X),E(X,I,F,$,Z),X}if(typeof File<"u"&&I instanceof File){const X=new File([I],I.name,{type:I.type});return $.set(I,X),E(X,I,F,$,Z),X}if(typeof Blob<"u"&&I instanceof Blob){const X=new Blob([I],{type:I.type});return $.set(I,X),E(X,I,F,$,Z),X}if(I instanceof Error){const X=new I.constructor;return $.set(I,X),X.message=I.message,X.name=I.name,X.stack=I.stack,X.cause=I.cause,E(X,I,F,$,Z),X}if(I instanceof Boolean){const X=new Boolean(I.valueOf());return $.set(I,X),E(X,I,F,$,Z),X}if(I instanceof Number){const X=new Number(I.valueOf());return $.set(I,X),E(X,I,F,$,Z),X}if(I instanceof String){const X=new String(I.valueOf());return $.set(I,X),E(X,I,F,$,Z),X}if(typeof I=="object"&&P(I)){const X=Object.create(Object.getPrototypeOf(I));return $.set(I,X),E(X,I,F,$,Z),X}return I}function E(I,D,F=I,$,Z){const q=[...Object.keys(D),...t.getSymbols(D)];for(let X=0;X<q.length;X++){const re=q[X],le=Object.getOwnPropertyDescriptor(I,re);(le==null||le.writable)&&(I[re]=i(D[re],re,F,$,Z))}}function P(I){switch(n.getTag(I)){case o.argumentsTag:case o.arrayTag:case o.arrayBufferTag:case o.dataViewTag:case o.booleanTag:case o.dateTag:case o.float32ArrayTag:case o.float64ArrayTag:case o.int8ArrayTag:case o.int16ArrayTag:case o.int32ArrayTag:case o.mapTag:case o.numberTag:case o.objectTag:case o.regexpTag:case o.setTag:case o.stringTag:case o.symbolTag:case o.uint8ArrayTag:case o.uint8ClampedArrayTag:case o.uint16ArrayTag:case o.uint32ArrayTag:return!0;default:return!1}}e.cloneDeepWith=g,e.cloneDeepWithImpl=i,e.copyProperties=E})(lT)),lT}var dD;function LX(){return dD||(dD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=SB();function n(o){return t.cloneDeepWithImpl(o,void 0,o,new Map,void 0)}e.cloneDeep=n})(aT)),aT}var fD;function jX(){return fD||(fD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=xB(),n=LX();function o(u){return u=n.cloneDeep(u),d=>t.isMatch(d,u)}e.matches=o})(tT)),tT}var fT={},pT={},mT={},pD;function zX(){return pD||(pD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=SB(),n=wB();function o(u,d){return t.cloneDeepWith(u,(g,i,E,P)=>{const I=d==null?void 0:d(g,i,E,P);if(I!==void 0)return I;if(typeof u=="object")switch(Object.prototype.toString.call(u)){case n.numberTag:case n.stringTag:case n.booleanTag:{const D=new u.constructor(u==null?void 0:u.valueOf());return t.copyProperties(D,u),D}case n.argumentsTag:{const D={};return t.copyProperties(D,u),D.length=u.length,D[Symbol.iterator]=u[Symbol.iterator],D}default:return}})}e.cloneDeepWith=o})(mT)),mT}var mD;function NX(){return mD||(mD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=zX();function n(o){return t.cloneDeepWith(o)}e.cloneDeep=n})(pT)),pT}var gT={},_T={},gD;function TB(){return gD||(gD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=/^(?:0|[1-9]\d*)$/;function n(o,u=Number.MAX_SAFE_INTEGER){switch(typeof o){case"number":return Number.isInteger(o)&&o>=0&&o<u;case"symbol":return!1;case"string":return t.test(o)}}e.isIndex=n})(_T)),_T}var yT={},_D;function FX(){return _D||(_D=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=bB();function n(o){return o!==null&&typeof o=="object"&&t.getTag(o)==="[object Arguments]"}e.isArguments=n})(yT)),yT}var yD;function BX(){return yD||(yD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=hB(),n=TB(),o=FX(),u=xC();function d(g,i){let E;if(Array.isArray(i)?E=i:typeof i=="string"&&t.isDeepKey(i)&&(g==null?void 0:g[i])==null?E=u.toPath(i):E=[i],E.length===0)return!1;let P=g;for(let I=0;I<E.length;I++){const D=E[I];if((P==null||!Object.hasOwn(P,D))&&!((Array.isArray(P)||o.isArguments(P))&&n.isIndex(D)&&D<P.length))return!1;P=P[D]}return!0}e.has=d})(gT)),gT}var vD;function UX(){return vD||(vD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=xB(),n=vC(),o=NX(),u=bC(),d=BX();function g(i,E){switch(typeof i){case"object":{Object.is(i==null?void 0:i.valueOf(),-0)&&(i="-0");break}case"number":{i=n.toKey(i);break}}return E=o.cloneDeep(E),function(P){const I=u.get(P,i);return I===void 0?d.has(P,i):E===void 0?I===void 0:t.isMatch(I,E)}}e.matchesProperty=g})(fT)),fT}var xD;function VX(){return xD||(xD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=gB(),n=kX(),o=jX(),u=UX();function d(g){if(g==null)return t.identity;switch(typeof g){case"function":return g;case"object":return Array.isArray(g)&&g.length===2?u.matchesProperty(g[0],g[1]):o.matches(g);case"string":case"symbol":case"number":return n.property(g)}}e.iteratee=d})(Q2)),Q2}var bD;function $X(){return bD||(bD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=CX(),n=gB(),o=MX(),u=VX();function d(g,i=n.identity){return o.isArrayLikeObject(g)?t.uniqBy(Array.from(g),u.iteratee(i)):[]}e.uniqBy=d})(W2)),W2}var vT,wD;function HX(){return wD||(wD=1,vT=$X().uniqBy),vT}var GX=HX();const SD=zh(GX);function WX(e,t,n){return t===!0?SD(e,n):typeof t=="function"?SD(e,t):e}var xT={exports:{}},bT={},wT={exports:{}},ST={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TD;function qX(){if(TD)return ST;TD=1;var e=Ey();function t(D,F){return D===F&&(D!==0||1/D===1/F)||D!==D&&F!==F}var n=typeof Object.is=="function"?Object.is:t,o=e.useState,u=e.useEffect,d=e.useLayoutEffect,g=e.useDebugValue;function i(D,F){var $=F(),Z=o({inst:{value:$,getSnapshot:F}}),q=Z[0].inst,X=Z[1];return d(function(){q.value=$,q.getSnapshot=F,E(q)&&X({inst:q})},[D,$,F]),u(function(){return E(q)&&X({inst:q}),D(function(){E(q)&&X({inst:q})})},[D]),g($),$}function E(D){var F=D.getSnapshot;D=D.value;try{var $=F();return!n(D,$)}catch{return!0}}function P(D,F){return F()}var I=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?P:i;return ST.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:I,ST}var ED;function ZX(){return ED||(ED=1,wT.exports=qX()),wT.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AD;function XX(){if(AD)return bT;AD=1;var e=Ey(),t=ZX();function n(P,I){return P===I&&(P!==0||1/P===1/I)||P!==P&&I!==I}var o=typeof Object.is=="function"?Object.is:n,u=t.useSyncExternalStore,d=e.useRef,g=e.useEffect,i=e.useMemo,E=e.useDebugValue;return bT.useSyncExternalStoreWithSelector=function(P,I,D,F,$){var Z=d(null);if(Z.current===null){var q={hasValue:!1,value:null};Z.current=q}else q=Z.current;Z=i(function(){function re(we){if(!le){if(le=!0,ue=we,we=F(we),$!==void 0&&q.hasValue){var Le=q.value;if($(Le,we))return ye=Le}return ye=we}if(Le=ye,o(ue,we))return Le;var Ze=F(we);return $!==void 0&&$(Le,Ze)?(ue=we,Le):(ue=we,ye=Ze)}var le=!1,ue,ye,ge=D===void 0?null:D;return[function(){return re(I())},ge===null?void 0:function(){return re(ge())}]},[I,D,F,$]);var X=u(P,Z[0],Z[1]);return g(function(){q.hasValue=!0,q.value=X},[X]),E(X),X},bT}var CD;function YX(){return CD||(CD=1,xT.exports=XX()),xT.exports}var KX=YX(),SC=te.createContext(null),JX=e=>e,qo=()=>{var e=te.useContext(SC);return e?e.store.dispatch:JX},Gb=()=>{},QX=()=>Gb,eY=(e,t)=>e===t;function ii(e){var t=te.useContext(SC);return KX.useSyncExternalStoreWithSelector(t?t.subscription.addNestedSub:QX,t?t.store.getState:Gb,t?t.store.getState:Gb,t?e:Gb,eY)}function tY(e,t=`expected a function, instead received ${typeof e}`){if(typeof e!="function")throw new TypeError(t)}function nY(e,t=`expected an object, instead received ${typeof e}`){if(typeof e!="object")throw new TypeError(t)}function rY(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(n=>typeof n=="function")){const n=e.map(o=>typeof o=="function"?`function ${o.name||"unnamed"}()`:typeof o).join(", ");throw new TypeError(`${t}[${n}]`)}}var PD=e=>Array.isArray(e)?e:[e];function iY(e){const t=Array.isArray(e[0])?e[0]:e;return rY(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function sY(e,t){const n=[],{length:o}=e;for(let u=0;u<o;u++)n.push(e[u].apply(null,t));return n}var oY=class{constructor(e){this.value=e}deref(){return this.value}},aY=typeof WeakRef<"u"?WeakRef:oY,lY=0,ID=1;function ib(){return{s:lY,v:void 0,o:null,p:null}}function EB(e,t={}){let n=ib();const{resultEqualityCheck:o}=t;let u,d=0;function g(){var D;let i=n;const{length:E}=arguments;for(let F=0,$=E;F<$;F++){const Z=arguments[F];if(typeof Z=="function"||typeof Z=="object"&&Z!==null){let q=i.o;q===null&&(i.o=q=new WeakMap);const X=q.get(Z);X===void 0?(i=ib(),q.set(Z,i)):i=X}else{let q=i.p;q===null&&(i.p=q=new Map);const X=q.get(Z);X===void 0?(i=ib(),q.set(Z,i)):i=X}}const P=i;let I;if(i.s===ID)I=i.v;else if(I=e.apply(null,arguments),d++,o){const F=((D=u==null?void 0:u.deref)==null?void 0:D.call(u))??u;F!=null&&o(F,I)&&(I=F,d!==0&&d--),u=typeof I=="object"&&I!==null||typeof I=="function"?new aY(I):I}return P.s=ID,P.v=I,I}return g.clearCache=()=>{n=ib(),g.resetResultsCount()},g.resultsCount=()=>d,g.resetResultsCount=()=>{d=0},g}function cY(e,...t){const n=typeof e=="function"?{memoize:e,memoizeOptions:t}:e,o=(...u)=>{let d=0,g=0,i,E={},P=u.pop();typeof P=="object"&&(E=P,P=u.pop()),tY(P,`createSelector expects an output function after the inputs, but received: [${typeof P}]`);const I={...n,...E},{memoize:D,memoizeOptions:F=[],argsMemoize:$=EB,argsMemoizeOptions:Z=[]}=I,q=PD(F),X=PD(Z),re=iY(u),le=D(function(){return d++,P.apply(null,arguments)},...q),ue=$(function(){g++;const ge=sY(re,arguments);return i=le.apply(null,ge),i},...X);return Object.assign(ue,{resultFunc:P,memoizedResultFunc:le,dependencies:re,dependencyRecomputations:()=>g,resetDependencyRecomputations:()=>{g=0},lastResult:()=>i,recomputations:()=>d,resetRecomputations:()=>{d=0},memoize:D,argsMemoize:$})};return Object.assign(o,{withTypes:()=>o}),o}var Ht=cY(EB),uY=Object.assign((e,t=Ht)=>{nY(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);const n=Object.keys(e),o=n.map(d=>e[d]);return t(o,(...d)=>d.reduce((g,i,E)=>(g[n[E]]=i,g),{}))},{withTypes:()=>uY}),TT={},ET={},AT={},MD;function hY(){return MD||(MD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(o){return typeof o=="symbol"?1:o===null?2:o===void 0?3:o!==o?4:0}const n=(o,u,d)=>{if(o!==u){const g=t(o),i=t(u);if(g===i&&g===0){if(o<u)return d==="desc"?1:-1;if(o>u)return d==="desc"?-1:1}return d==="desc"?i-g:g-i}return 0};e.compareValues=n})(AT)),AT}var CT={},PT={},kD;function AB(){return kD||(kD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return typeof n=="symbol"||n instanceof Symbol}e.isSymbol=t})(PT)),PT}var RD;function dY(){return RD||(RD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=AB(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;function u(d,g){return Array.isArray(d)?!1:typeof d=="number"||typeof d=="boolean"||d==null||t.isSymbol(d)?!0:typeof d=="string"&&(o.test(d)||!n.test(d))||g!=null&&Object.hasOwn(g,d)}e.isKey=u})(CT)),CT}var OD;function fY(){return OD||(OD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=hY(),n=dY(),o=xC();function u(d,g,i,E){if(d==null)return[];i=E?void 0:i,Array.isArray(d)||(d=Object.values(d)),Array.isArray(g)||(g=g==null?[null]:[g]),g.length===0&&(g=[null]),Array.isArray(i)||(i=i==null?[]:[i]),i=i.map($=>String($));const P=($,Z)=>{let q=$;for(let X=0;X<Z.length&&q!=null;++X)q=q[Z[X]];return q},I=($,Z)=>Z==null||$==null?Z:typeof $=="object"&&"key"in $?Object.hasOwn(Z,$.key)?Z[$.key]:P(Z,$.path):typeof $=="function"?$(Z):Array.isArray($)?P(Z,$):typeof Z=="object"?Z[$]:Z,D=g.map($=>(Array.isArray($)&&$.length===1&&($=$[0]),$==null||typeof $=="function"||Array.isArray($)||n.isKey($)?$:{key:$,path:o.toPath($)}));return d.map($=>({original:$,criteria:D.map(Z=>I(Z,$))})).slice().sort(($,Z)=>{for(let q=0;q<D.length;q++){const X=t.compareValues($.criteria[q],Z.criteria[q],i[q]);if(X!==0)return X}return 0}).map($=>$.original)}e.orderBy=u})(ET)),ET}var IT={},DD;function pY(){return DD||(DD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,o=1){const u=[],d=Math.floor(o),g=(i,E)=>{for(let P=0;P<i.length;P++){const I=i[P];Array.isArray(I)&&E<d?g(I,E+1):u.push(I)}};return g(n,0),u}e.flatten=t})(IT)),IT}var MT={},LD;function CB(){return LD||(LD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=TB(),n=wC(),o=_B(),u=vB();function d(g,i,E){return o.isObject(E)&&(typeof i=="number"&&n.isArrayLike(E)&&t.isIndex(i)&&i<E.length||typeof i=="string"&&i in E)?u.eq(E[i],g):!1}e.isIterateeCall=d})(MT)),MT}var jD;function mY(){return jD||(jD=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=fY(),n=pY(),o=CB();function u(d,...g){const i=g.length;return i>1&&o.isIterateeCall(d,g[0],g[1])?g=[]:i>2&&o.isIterateeCall(g[0],g[1],g[2])&&(g=[g[0]]),t.orderBy(d,n.flatten(g),["asc"])}e.sortBy=u})(TT)),TT}var kT,zD;function gY(){return zD||(zD=1,kT=mY().sortBy),kT}var _Y=gY();const yw=zh(_Y);var PB=e=>e.legend.settings,yY=e=>e.legend.size,vY=e=>e.legend.payload;Ht([vY,PB],(e,t)=>{var{itemSorter:n}=t,o=e.flat(1);return n?yw(o,n):o});var sb=1;function xY(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[t,n]=te.useState({height:0,left:0,top:0,width:0}),o=te.useCallback(u=>{if(u!=null){var d=u.getBoundingClientRect(),g={height:d.height,left:d.left,top:d.top,width:d.width};(Math.abs(g.height-t.height)>sb||Math.abs(g.left-t.left)>sb||Math.abs(g.top-t.top)>sb||Math.abs(g.width-t.width)>sb)&&n({height:g.height,left:g.left,top:g.top,width:g.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,o]}function Oa(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var bY=typeof Symbol=="function"&&Symbol.observable||"@@observable",ND=bY,RT=()=>Math.random().toString(36).substring(7).split("").join("."),wY={INIT:`@@redux/INIT${RT()}`,REPLACE:`@@redux/REPLACE${RT()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${RT()}`},u1=wY;function TC(e){if(typeof e!="object"||e===null)return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||Object.getPrototypeOf(e)===null}function IB(e,t,n){if(typeof e!="function")throw new Error(Oa(2));if(typeof t=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(Oa(0));if(typeof t=="function"&&typeof n>"u"&&(n=t,t=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(Oa(1));return n(IB)(e,t)}let o=e,u=t,d=new Map,g=d,i=0,E=!1;function P(){g===d&&(g=new Map,d.forEach((X,re)=>{g.set(re,X)}))}function I(){if(E)throw new Error(Oa(3));return u}function D(X){if(typeof X!="function")throw new Error(Oa(4));if(E)throw new Error(Oa(5));let re=!0;P();const le=i++;return g.set(le,X),function(){if(re){if(E)throw new Error(Oa(6));re=!1,P(),g.delete(le),d=null}}}function F(X){if(!TC(X))throw new Error(Oa(7));if(typeof X.type>"u")throw new Error(Oa(8));if(typeof X.type!="string")throw new Error(Oa(17));if(E)throw new Error(Oa(9));try{E=!0,u=o(u,X)}finally{E=!1}return(d=g).forEach(le=>{le()}),X}function $(X){if(typeof X!="function")throw new Error(Oa(10));o=X,F({type:u1.REPLACE})}function Z(){const X=D;return{subscribe(re){if(typeof re!="object"||re===null)throw new Error(Oa(11));function le(){const ye=re;ye.next&&ye.next(I())}return le(),{unsubscribe:X(le)}},[ND](){return this}}}return F({type:u1.INIT}),{dispatch:F,subscribe:D,getState:I,replaceReducer:$,[ND]:Z}}function SY(e){Object.keys(e).forEach(t=>{const n=e[t];if(typeof n(void 0,{type:u1.INIT})>"u")throw new Error(Oa(12));if(typeof n(void 0,{type:u1.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Oa(13))})}function MB(e){const t=Object.keys(e),n={};for(let d=0;d<t.length;d++){const g=t[d];typeof e[g]=="function"&&(n[g]=e[g])}const o=Object.keys(n);let u;try{SY(n)}catch(d){u=d}return function(g={},i){if(u)throw u;let E=!1;const P={};for(let I=0;I<o.length;I++){const D=o[I],F=n[D],$=g[D],Z=F($,i);if(typeof Z>"u")throw i&&i.type,new Error(Oa(14));P[D]=Z,E=E||Z!==$}return E=E||o.length!==Object.keys(g).length,E?P:g}}function h1(...e){return e.length===0?t=>t:e.length===1?e[0]:e.reduce((t,n)=>(...o)=>t(n(...o)))}function TY(...e){return t=>(n,o)=>{const u=t(n,o);let d=()=>{throw new Error(Oa(15))};const g={getState:u.getState,dispatch:(E,...P)=>d(E,...P)},i=e.map(E=>E(g));return d=h1(...i)(u.dispatch),{...u,dispatch:d}}}function kB(e){return TC(e)&&"type"in e&&typeof e.type=="string"}var RB=Symbol.for("immer-nothing"),FD=Symbol.for("immer-draftable"),Rl=Symbol.for("immer-state");function Ch(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Dc=Object,gy=Dc.getPrototypeOf,d1="constructor",vw="prototype",QE="configurable",f1="enumerable",Wb="writable",px="value",mp=e=>!!e&&!!e[Rl];function Lh(e){var t;return e?OB(e)||bw(e)||!!e[FD]||!!((t=e[d1])!=null&&t[FD])||ww(e)||Sw(e):!1}var EY=Dc[vw][d1].toString(),BD=new WeakMap;function OB(e){if(!e||!EC(e))return!1;const t=gy(e);if(t===null||t===Dc[vw])return!0;const n=Dc.hasOwnProperty.call(t,d1)&&t[d1];if(n===Object)return!0;if(!iy(n))return!1;let o=BD.get(n);return o===void 0&&(o=Function.toString.call(n),BD.set(n,o)),o===EY}function xw(e,t,n=!0){Hx(e)===0?(n?Reflect.ownKeys(e):Dc.keys(e)).forEach(u=>{t(u,e[u],e)}):e.forEach((o,u)=>t(u,o,e))}function Hx(e){const t=e[Rl];return t?t.type_:bw(e)?1:ww(e)?2:Sw(e)?3:0}var UD=(e,t,n=Hx(e))=>n===2?e.has(t):Dc[vw].hasOwnProperty.call(e,t),eA=(e,t,n=Hx(e))=>n===2?e.get(t):e[t],p1=(e,t,n,o=Hx(e))=>{o===2?e.set(t,n):o===3?e.add(n):e[t]=n};function AY(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}var bw=Array.isArray,ww=e=>e instanceof Map,Sw=e=>e instanceof Set,EC=e=>typeof e=="object",iy=e=>typeof e=="function",OT=e=>typeof e=="boolean";function CY(e){const t=+e;return Number.isInteger(t)&&String(t)===e}var ep=e=>e.copy_||e.base_,AC=e=>e.modified_?e.copy_:e.base_;function tA(e,t){if(ww(e))return new Map(e);if(Sw(e))return new Set(e);if(bw(e))return Array[vw].slice.call(e);const n=OB(e);if(t===!0||t==="class_only"&&!n){const o=Dc.getOwnPropertyDescriptors(e);delete o[Rl];let u=Reflect.ownKeys(o);for(let d=0;d<u.length;d++){const g=u[d],i=o[g];i[Wb]===!1&&(i[Wb]=!0,i[QE]=!0),(i.get||i.set)&&(o[g]={[QE]:!0,[Wb]:!0,[f1]:i[f1],[px]:e[g]})}return Dc.create(gy(e),o)}else{const o=gy(e);if(o!==null&&n)return{...e};const u=Dc.create(o);return Dc.assign(u,e)}}function CC(e,t=!1){return Tw(e)||mp(e)||!Lh(e)||(Hx(e)>1&&Dc.defineProperties(e,{set:ob,add:ob,clear:ob,delete:ob}),Dc.freeze(e),t&&xw(e,(n,o)=>{CC(o,!0)},!1)),e}function PY(){Ch(2)}var ob={[px]:PY};function Tw(e){return e===null||!EC(e)?!0:Dc.isFrozen(e)}var m1="MapSet",nA="Patches",VD="ArrayMethods",DB={};function Jg(e){const t=DB[e];return t||Ch(0,e),t}var $D=e=>!!DB[e],mx,LB=()=>mx,IY=(e,t)=>({drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:$D(m1)?Jg(m1):void 0,arrayMethodsPlugin_:$D(VD)?Jg(VD):void 0});function HD(e,t){t&&(e.patchPlugin_=Jg(nA),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function rA(e){iA(e),e.drafts_.forEach(MY),e.drafts_=null}function iA(e){e===mx&&(mx=e.parent_)}var GD=e=>mx=IY(mx,e);function MY(e){const t=e[Rl];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function WD(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];if(e!==void 0&&e!==n){n[Rl].modified_&&(rA(t),Ch(4)),Lh(e)&&(e=qD(t,e));const{patchPlugin_:u}=t;u&&u.generateReplacementPatches_(n[Rl].base_,e,t)}else e=qD(t,n);return kY(t,e,!0),rA(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==RB?e:void 0}function qD(e,t){if(Tw(t))return t;const n=t[Rl];if(!n)return g1(t,e.handledSet_,e);if(!Ew(n,e))return t;if(!n.modified_)return n.base_;if(!n.finalized_){const{callbacks_:o}=n;if(o)for(;o.length>0;)o.pop()(e);NB(n,e)}return n.copy_}function kY(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&CC(t,n)}function jB(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var Ew=(e,t)=>e.scope_===t,RY=[];function zB(e,t,n,o){const u=ep(e),d=e.type_;if(o!==void 0&&eA(u,o,d)===t){p1(u,o,n,d);return}if(!e.draftLocations_){const i=e.draftLocations_=new Map;xw(u,(E,P)=>{if(mp(P)){const I=i.get(P)||[];I.push(E),i.set(P,I)}})}const g=e.draftLocations_.get(t)??RY;for(const i of g)p1(u,i,n,d)}function OY(e,t,n){e.callbacks_.push(function(u){var i;const d=t;if(!d||!Ew(d,u))return;(i=u.mapSetPlugin_)==null||i.fixSetContents(d);const g=AC(d);zB(e,d.draft_??d,g,n),NB(d,u)})}function NB(e,t){var o;if(e.modified_&&!e.finalized_&&(e.type_===3||e.type_===1&&e.allIndicesReassigned_||(((o=e.assigned_)==null?void 0:o.size)??0)>0)){const{patchPlugin_:u}=t;if(u){const d=u.getPath(e);d&&u.generatePatches_(e,d,t)}jB(e)}}function DY(e,t,n){const{scope_:o}=e;if(mp(n)){const u=n[Rl];Ew(u,o)&&u.callbacks_.push(function(){qb(e);const g=AC(u);zB(e,n,g,t)})}else Lh(n)&&e.callbacks_.push(function(){const d=ep(e);e.type_===3?d.has(n)&&g1(n,o.handledSet_,o):eA(d,t,e.type_)===n&&o.drafts_.length>1&&(e.assigned_.get(t)??!1)===!0&&e.copy_&&g1(eA(e.copy_,t,e.type_),o.handledSet_,o)})}function g1(e,t,n){return!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1||mp(e)||t.has(e)||!Lh(e)||Tw(e)||(t.add(e),xw(e,(o,u)=>{if(mp(u)){const d=u[Rl];if(Ew(d,n)){const g=AC(d);p1(e,o,g,e.type_),jB(d)}}else Lh(u)&&g1(u,t,n)})),e}function LY(e,t){const n=bw(e),o={type_:n?1:0,scope_:t?t.scope_:LB(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let u=o,d=_1;n&&(u=[o],d=gx);const{revoke:g,proxy:i}=Proxy.revocable(u,d);return o.draft_=i,o.revoke_=g,[i,o]}var _1={get(e,t){if(t===Rl)return e;let n=e.scope_.arrayMethodsPlugin_;const o=e.type_===1&&typeof t=="string";if(o&&n!=null&&n.isArrayOperationMethod(t))return n.createMethodInterceptor(e,t);const u=ep(e);if(!UD(u,t,e.type_))return jY(e,u,t);const d=u[t];if(e.finalized_||!Lh(d)||o&&e.operationMethod&&(n!=null&&n.isMutatingArrayMethod(e.operationMethod))&&CY(t))return d;if(d===DT(e.base_,t)){qb(e);const g=e.type_===1?+t:t,i=oA(e.scope_,d,e,g);return e.copy_[g]=i}return d},has(e,t){return t in ep(e)},ownKeys(e){return Reflect.ownKeys(ep(e))},set(e,t,n){const o=FB(ep(e),t);if(o!=null&&o.set)return o.set.call(e.draft_,n),!0;if(!e.modified_){const u=DT(ep(e),t),d=u==null?void 0:u[Rl];if(d&&d.base_===n)return e.copy_[t]=n,e.assigned_.set(t,!1),!0;if(AY(n,u)&&(n!==void 0||UD(e.base_,t,e.type_)))return!0;qb(e),sA(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_.set(t,!0),DY(e,t,n)),!0},deleteProperty(e,t){return qb(e),DT(e.base_,t)!==void 0||t in e.base_?(e.assigned_.set(t,!1),sA(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=ep(e),o=Reflect.getOwnPropertyDescriptor(n,t);return o&&{[Wb]:!0,[QE]:e.type_!==1||t!=="length",[f1]:o[f1],[px]:n[t]}},defineProperty(){Ch(11)},getPrototypeOf(e){return gy(e.base_)},setPrototypeOf(){Ch(12)}},gx={};for(let e in _1){let t=_1[e];gx[e]=function(){const n=arguments;return n[0]=n[0][0],t.apply(this,n)}}gx.deleteProperty=function(e,t){return gx.set.call(this,e,t,void 0)};gx.set=function(e,t,n){return _1.set.call(this,e[0],t,n,e[0])};function DT(e,t){const n=e[Rl];return(n?ep(n):e)[t]}function jY(e,t,n){var u;const o=FB(t,n);return o?px in o?o[px]:(u=o.get)==null?void 0:u.call(e.draft_):void 0}function FB(e,t){if(!(t in e))return;let n=gy(e);for(;n;){const o=Object.getOwnPropertyDescriptor(n,t);if(o)return o;n=gy(n)}}function sA(e){e.modified_||(e.modified_=!0,e.parent_&&sA(e.parent_))}function qb(e){e.copy_||(e.assigned_=new Map,e.copy_=tA(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var zY=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(n,o,u)=>{if(iy(n)&&!iy(o)){const g=o;o=n;const i=this;return function(P=g,...I){return i.produce(P,D=>o.call(this,D,...I))}}iy(o)||Ch(6),u!==void 0&&!iy(u)&&Ch(7);let d;if(Lh(n)){const g=GD(this),i=oA(g,n,void 0);let E=!0;try{d=o(i),E=!1}finally{E?rA(g):iA(g)}return HD(g,u),WD(d,g)}else if(!n||!EC(n)){if(d=o(n),d===void 0&&(d=n),d===RB&&(d=void 0),this.autoFreeze_&&CC(d,!0),u){const g=[],i=[];Jg(nA).generateReplacementPatches_(n,d,{patches_:g,inversePatches_:i}),u(g,i)}return d}else Ch(1,n)},this.produceWithPatches=(n,o)=>{if(iy(n))return(i,...E)=>this.produceWithPatches(i,P=>n(P,...E));let u,d;return[this.produce(n,o,(i,E)=>{u=i,d=E}),u,d]},OT(t==null?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze),OT(t==null?void 0:t.useStrictShallowCopy)&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),OT(t==null?void 0:t.useStrictIteration)&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){Lh(t)||Ch(8),mp(t)&&(t=Rh(t));const n=GD(this),o=oA(n,t,void 0);return o[Rl].isManual_=!0,iA(n),o}finishDraft(t,n){const o=t&&t[Rl];(!o||!o.isManual_)&&Ch(9);const{scope_:u}=o;return HD(u,n),WD(void 0,u)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,n){let o;for(o=n.length-1;o>=0;o--){const d=n[o];if(d.path.length===0&&d.op==="replace"){t=d.value;break}}o>-1&&(n=n.slice(o+1));const u=Jg(nA).applyPatches_;return mp(t)?u(t,n):this.produce(t,d=>u(d,n))}};function oA(e,t,n,o){const[u,d]=ww(t)?Jg(m1).proxyMap_(t,n):Sw(t)?Jg(m1).proxySet_(t,n):LY(t,n);return((n==null?void 0:n.scope_)??LB()).drafts_.push(u),d.callbacks_=(n==null?void 0:n.callbacks_)??[],d.key_=o,n&&o!==void 0?OY(n,d,o):d.callbacks_.push(function(E){var I;(I=E.mapSetPlugin_)==null||I.fixSetContents(d);const{patchPlugin_:P}=E;d.modified_&&P&&P.generatePatches_(d,[],E)}),u}function Rh(e){return mp(e)||Ch(10,e),BB(e)}function BB(e){if(!Lh(e)||Tw(e))return e;const t=e[Rl];let n,o=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=tA(e,t.scope_.immer_.useStrictShallowCopy_),o=t.scope_.immer_.shouldUseStrictIteration()}else n=tA(e,!0);return xw(n,(u,d)=>{p1(n,u,BB(d))},o),t&&(t.finalized_=!1),n}var NY=new zY,UB=NY.produce;function VB(e){return({dispatch:n,getState:o})=>u=>d=>typeof d=="function"?d(n,o,e):u(d)}var FY=VB(),BY=VB,UY=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?h1:h1.apply(null,arguments)};function Pu(e,t){function n(...o){if(t){let u=t(...o);if(!u)throw new Error(jc(0));return{type:e,payload:u.payload,..."meta"in u&&{meta:u.meta},..."error"in u&&{error:u.error}}}return{type:e,payload:o[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=o=>kB(o)&&o.type===e,n}var $B=class Zv extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,Zv.prototype)}static get[Symbol.species](){return Zv}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new Zv(...t[0].concat(this)):new Zv(...t.concat(this))}};function ZD(e){return Lh(e)?UB(e,()=>{}):e}function ab(e,t,n){return e.has(t)?e.get(t):e.set(t,n(t)).get(t)}function VY(e){return typeof e=="boolean"}var $Y=()=>function(t){const{thunk:n=!0,immutableCheck:o=!0,serializableCheck:u=!0,actionCreatorCheck:d=!0}=t??{};let g=new $B;return n&&(VY(n)?g.push(FY):g.push(BY(n.extraArgument))),g},HB="RTK_autoBatch",Ms=()=>e=>({payload:e,meta:{[HB]:!0}}),XD=e=>t=>{setTimeout(t,e)},GB=(e={type:"raf"})=>t=>(...n)=>{const o=t(...n);let u=!0,d=!1,g=!1;const i=new Set,E=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:XD(10):e.type==="callback"?e.queueNotification:XD(e.timeout),P=()=>{g=!1,d&&(d=!1,i.forEach(I=>I()))};return Object.assign({},o,{subscribe(I){const D=()=>u&&I(),F=o.subscribe(D);return i.add(I),()=>{F(),i.delete(I)}},dispatch(I){var D;try{return u=!((D=I==null?void 0:I.meta)!=null&&D[HB]),d=!u,d&&(g||(g=!0,E(P))),o.dispatch(I)}finally{u=!0}}})},HY=e=>function(n){const{autoBatch:o=!0}=n??{};let u=new $B(e);return o&&u.push(GB(typeof o=="object"?o:void 0)),u};function GY(e){const t=$Y(),{reducer:n=void 0,middleware:o,devTools:u=!0,preloadedState:d=void 0,enhancers:g=void 0}=e||{};let i;if(typeof n=="function")i=n;else if(TC(n))i=MB(n);else throw new Error(jc(1));let E;typeof o=="function"?E=o(t):E=t();let P=h1;u&&(P=UY({trace:!1,...typeof u=="object"&&u}));const I=TY(...E),D=HY(I);let F=typeof g=="function"?g(D):D();const $=P(...F);return IB(i,d,$)}function WB(e){const t={},n=[];let o;const u={addCase(d,g){const i=typeof d=="string"?d:d.type;if(!i)throw new Error(jc(28));if(i in t)throw new Error(jc(29));return t[i]=g,u},addAsyncThunk(d,g){return g.pending&&(t[d.pending.type]=g.pending),g.rejected&&(t[d.rejected.type]=g.rejected),g.fulfilled&&(t[d.fulfilled.type]=g.fulfilled),g.settled&&n.push({matcher:d.settled,reducer:g.settled}),u},addMatcher(d,g){return n.push({matcher:d,reducer:g}),u},addDefaultCase(d){return o=d,u}};return e(u),[t,n,o]}function WY(e){return typeof e=="function"}function qY(e,t){let[n,o,u]=WB(t),d;if(WY(e))d=()=>ZD(e());else{const i=ZD(e);d=()=>i}function g(i=d(),E){let P=[n[E.type],...o.filter(({matcher:I})=>I(E)).map(({reducer:I})=>I)];return P.filter(I=>!!I).length===0&&(P=[u]),P.reduce((I,D)=>{if(D)if(mp(I)){const $=D(I,E);return $===void 0?I:$}else{if(Lh(I))return UB(I,F=>D(F,E));{const F=D(I,E);if(F===void 0){if(I===null)return I;throw Error("A case reducer on a non-draftable value must not return undefined")}return F}}return I},i)}return g.getInitialState=d,g}var ZY="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",XY=(e=21)=>{let t="",n=e;for(;n--;)t+=ZY[Math.random()*64|0];return t},YY=Symbol.for("rtk-slice-createasyncthunk");function KY(e,t){return`${e}/${t}`}function JY({creators:e}={}){var n;const t=(n=e==null?void 0:e.asyncThunk)==null?void 0:n[YY];return function(u){const{name:d,reducerPath:g=d}=u;if(!d)throw new Error(jc(11));const i=(typeof u.reducers=="function"?u.reducers(eK()):u.reducers)||{},E=Object.keys(i),P={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},I={addCase(ye,ge){const we=typeof ye=="string"?ye:ye.type;if(!we)throw new Error(jc(12));if(we in P.sliceCaseReducersByType)throw new Error(jc(13));return P.sliceCaseReducersByType[we]=ge,I},addMatcher(ye,ge){return P.sliceMatchers.push({matcher:ye,reducer:ge}),I},exposeAction(ye,ge){return P.actionCreators[ye]=ge,I},exposeCaseReducer(ye,ge){return P.sliceCaseReducersByName[ye]=ge,I}};E.forEach(ye=>{const ge=i[ye],we={reducerName:ye,type:KY(d,ye),createNotation:typeof u.reducers=="function"};nK(ge)?iK(we,ge,I,t):tK(we,ge,I)});function D(){const[ye={},ge=[],we=void 0]=typeof u.extraReducers=="function"?WB(u.extraReducers):[u.extraReducers],Le={...ye,...P.sliceCaseReducersByType};return qY(u.initialState,Ze=>{for(let Ge in Le)Ze.addCase(Ge,Le[Ge]);for(let Ge of P.sliceMatchers)Ze.addMatcher(Ge.matcher,Ge.reducer);for(let Ge of ge)Ze.addMatcher(Ge.matcher,Ge.reducer);we&&Ze.addDefaultCase(we)})}const F=ye=>ye,$=new Map,Z=new WeakMap;let q;function X(ye,ge){return q||(q=D()),q(ye,ge)}function re(){return q||(q=D()),q.getInitialState()}function le(ye,ge=!1){function we(Ze){let Ge=Ze[ye];return typeof Ge>"u"&&ge&&(Ge=ab(Z,we,re)),Ge}function Le(Ze=F){const Ge=ab($,ge,()=>new WeakMap);return ab(Ge,Ze,()=>{const gt={};for(const[lt,qe]of Object.entries(u.selectors??{}))gt[lt]=QY(qe,Ze,()=>ab(Z,Ze,re),ge);return gt})}return{reducerPath:ye,getSelectors:Le,get selectors(){return Le(we)},selectSlice:we}}const ue={name:d,reducer:X,actions:P.actionCreators,caseReducers:P.sliceCaseReducersByName,getInitialState:re,...le(g),injectInto(ye,{reducerPath:ge,...we}={}){const Le=ge??g;return ye.inject({reducerPath:Le,reducer:X},we),{...ue,...le(Le,!0)}}};return ue}}function QY(e,t,n,o){function u(d,...g){let i=t(d);return typeof i>"u"&&o&&(i=n()),e(i,...g)}return u.unwrapped=e,u}var oc=JY();function eK(){function e(t,n){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...n}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...n){return t(...n)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,n){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:n}},asyncThunk:e}}function tK({type:e,reducerName:t,createNotation:n},o,u){let d,g;if("reducer"in o){if(n&&!rK(o))throw new Error(jc(17));d=o.reducer,g=o.prepare}else d=o;u.addCase(e,d).exposeCaseReducer(t,d).exposeAction(t,g?Pu(e,g):Pu(e))}function nK(e){return e._reducerDefinitionType==="asyncThunk"}function rK(e){return e._reducerDefinitionType==="reducerWithPrepare"}function iK({type:e,reducerName:t},n,o,u){if(!u)throw new Error(jc(18));const{payloadCreator:d,fulfilled:g,pending:i,rejected:E,settled:P,options:I}=n,D=u(e,d,I);o.exposeAction(t,D),g&&o.addCase(D.fulfilled,g),i&&o.addCase(D.pending,i),E&&o.addCase(D.rejected,E),P&&o.addMatcher(D.settled,P),o.exposeCaseReducer(t,{fulfilled:g||lb,pending:i||lb,rejected:E||lb,settled:P||lb})}function lb(){}var sK="task",qB="listener",ZB="completed",PC="cancelled",oK=`task-${PC}`,aK=`task-${ZB}`,aA=`${qB}-${PC}`,lK=`${qB}-${ZB}`,Aw=class{constructor(e){zn(this,"name","TaskAbortError");zn(this,"message");this.code=e,this.message=`${sK} ${PC} (reason: ${e})`}},IC=(e,t)=>{if(typeof e!="function")throw new TypeError(jc(32))},y1=()=>{},XB=(e,t=y1)=>(e.catch(t),e),YB=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),Ug=e=>{if(e.aborted)throw new Aw(e.reason)};function KB(e,t){let n=y1;return new Promise((o,u)=>{const d=()=>u(new Aw(e.reason));if(e.aborted){d();return}n=YB(e,d),t.finally(()=>n()).then(o,u)}).finally(()=>{n=y1})}var cK=async(e,t)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(n){return{status:n instanceof Aw?"cancelled":"rejected",error:n}}finally{t==null||t()}},v1=e=>t=>XB(KB(e,t).then(n=>(Ug(e),n))),JB=e=>{const t=v1(e);return n=>t(new Promise(o=>setTimeout(o,n)))},{assign:ay}=Object,YD={},Cw="listenerMiddleware",uK=(e,t)=>{const n=o=>YB(e,()=>o.abort(e.reason));return(o,u)=>{IC(o);const d=new AbortController;n(d);const g=cK(async()=>{Ug(e),Ug(d.signal);const i=await o({pause:v1(d.signal),delay:JB(d.signal),signal:d.signal});return Ug(d.signal),i},()=>d.abort(aK));return u!=null&&u.autoJoin&&t.push(g.catch(y1)),{result:v1(e)(g),cancel(){d.abort(oK)}}}},hK=(e,t)=>{const n=async(o,u)=>{Ug(t);let d=()=>{};const i=[new Promise((E,P)=>{let I=e({predicate:o,effect:(D,F)=>{F.unsubscribe(),E([D,F.getState(),F.getOriginalState()])}});d=()=>{I(),P()}})];u!=null&&i.push(new Promise(E=>setTimeout(E,u,null)));try{const E=await KB(t,Promise.race(i));return Ug(t),E}finally{d()}};return(o,u)=>XB(n(o,u))},QB=e=>{let{type:t,actionCreator:n,matcher:o,predicate:u,effect:d}=e;if(t)u=Pu(t).match;else if(n)t=n.type,u=n.match;else if(o)u=o;else if(!u)throw new Error(jc(21));return IC(d),{predicate:u,type:t,effect:d}},e5=ay(e=>{const{type:t,predicate:n,effect:o}=QB(e);return{id:XY(),effect:o,type:t,predicate:n,pending:new Set,unsubscribe:()=>{throw new Error(jc(22))}}},{withTypes:()=>e5}),KD=(e,t)=>{const{type:n,effect:o,predicate:u}=QB(t);return Array.from(e.values()).find(d=>(typeof n=="string"?d.type===n:d.predicate===u)&&d.effect===o)},lA=e=>{e.pending.forEach(t=>{t.abort(aA)})},dK=(e,t)=>()=>{for(const n of t.keys())lA(n);e.clear()},JD=(e,t,n)=>{try{e(t,n)}catch(o){setTimeout(()=>{throw o},0)}},t5=ay(Pu(`${Cw}/add`),{withTypes:()=>t5}),fK=Pu(`${Cw}/removeAll`),n5=ay(Pu(`${Cw}/remove`),{withTypes:()=>n5}),pK=(...e)=>{console.error(`${Cw}/error`,...e)},Gx=(e={})=>{const t=new Map,n=new Map,o=$=>{const Z=n.get($)??0;n.set($,Z+1)},u=$=>{const Z=n.get($)??1;Z===1?n.delete($):n.set($,Z-1)},{extra:d,onError:g=pK}=e;IC(g);const i=$=>($.unsubscribe=()=>t.delete($.id),t.set($.id,$),Z=>{$.unsubscribe(),Z!=null&&Z.cancelActive&&lA($)}),E=$=>{const Z=KD(t,$)??e5($);return i(Z)};ay(E,{withTypes:()=>E});const P=$=>{const Z=KD(t,$);return Z&&(Z.unsubscribe(),$.cancelActive&&lA(Z)),!!Z};ay(P,{withTypes:()=>P});const I=async($,Z,q,X)=>{const re=new AbortController,le=hK(E,re.signal),ue=[];try{$.pending.add(re),o($),await Promise.resolve($.effect(Z,ay({},q,{getOriginalState:X,condition:(ye,ge)=>le(ye,ge).then(Boolean),take:le,delay:JB(re.signal),pause:v1(re.signal),extra:d,signal:re.signal,fork:uK(re.signal,ue),unsubscribe:$.unsubscribe,subscribe:()=>{t.set($.id,$)},cancelActiveListeners:()=>{$.pending.forEach((ye,ge,we)=>{ye!==re&&(ye.abort(aA),we.delete(ye))})},cancel:()=>{re.abort(aA),$.pending.delete(re)},throwIfCancelled:()=>{Ug(re.signal)}})))}catch(ye){ye instanceof Aw||JD(g,ye,{raisedBy:"effect"})}finally{await Promise.all(ue),re.abort(lK),u($),$.pending.delete(re)}},D=dK(t,n);return{middleware:$=>Z=>q=>{if(!kB(q))return Z(q);if(t5.match(q))return E(q.payload);if(fK.match(q)){D();return}if(n5.match(q))return P(q.payload);let X=$.getState();const re=()=>{if(X===YD)throw new Error(jc(23));return X};let le;try{if(le=Z(q),t.size>0){const ue=$.getState(),ye=Array.from(t.values());for(const ge of ye){let we=!1;try{we=ge.predicate(q,ue,X)}catch(Le){we=!1,JD(g,Le,{raisedBy:"predicate"})}we&&I(ge,q,$,re)}}}finally{X=YD}return le},startListening:E,stopListening:P,clearListeners:D}};function jc(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var mK={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},r5=oc({name:"chartLayout",initialState:mK,reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){var n,o,u,d;e.margin.top=(n=t.payload.top)!==null&&n!==void 0?n:0,e.margin.right=(o=t.payload.right)!==null&&o!==void 0?o:0,e.margin.bottom=(u=t.payload.bottom)!==null&&u!==void 0?u:0,e.margin.left=(d=t.payload.left)!==null&&d!==void 0?d:0},setScale(e,t){e.scale=t.payload}}}),{setMargin:gK,setLayout:_K,setChartSize:yK,setScale:vK}=r5.actions,xK=r5.reducer;function i5(e,t,n){return Array.isArray(e)&&e&&t+n!==0?e.slice(t,n+1):e}function Do(e){return Number.isFinite(e)}function Pm(e){return typeof e=="number"&&e>0&&Number.isFinite(e)}function QD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function sy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QD(Object(n),!0).forEach(function(o){bK(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QD(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function bK(e,t,n){return(t=wK(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wK(e){var t=SK(e,"string");return typeof t=="symbol"?t:t+""}function SK(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function eo(e,t,n){return zc(e)||zc(t)?n:pp(t)?dx(e,t,n):typeof t=="function"?t(e):n}var TK=(e,t,n)=>{if(t&&n){var{width:o,height:u}=n,{align:d,verticalAlign:g,layout:i}=t;if((i==="vertical"||i==="horizontal"&&g==="middle")&&d!=="center"&&Wr(e[d]))return sy(sy({},e),{},{[d]:e[d]+(o||0)});if((i==="horizontal"||i==="vertical"&&d==="center")&&g!=="middle"&&Wr(e[g]))return sy(sy({},e),{},{[g]:e[g]+(u||0)})}return e},a_=(e,t)=>e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis",eL=1e-4,EK=e=>{var t=e.domain();if(!(!t||t.length<=2)){var n=t.length,o=e.range(),u=Math.min(o[0],o[1])-eL,d=Math.max(o[0],o[1])+eL,g=e(t[0]),i=e(t[n-1]);(g<u||g>d||i<u||i>d)&&e.domain([t[0],t[n-1]])}},AK=e=>{var t,n=e.length;if(!(n<=0)){var o=(t=e[0])===null||t===void 0?void 0:t.length;if(!(o==null||o<=0))for(var u=0;u<o;++u)for(var d=0,g=0,i=0;i<n;++i){var E=e[i],P=E==null?void 0:E[u];if(P!=null){var I=P[1],D=P[0],F=dp(I)?D:I;F>=0?(P[0]=d,P[1]=d+F,d=I):(P[0]=g,P[1]=g+F,g=I)}}}},CK=e=>{var t,n=e.length;if(!(n<=0)){var o=(t=e[0])===null||t===void 0?void 0:t.length;if(!(o==null||o<=0))for(var u=0;u<o;++u)for(var d=0,g=0;g<n;++g){var i=e[g],E=i==null?void 0:i[u];if(E!=null){var P=dp(E[1])?E[0]:E[1];P>=0?(E[0]=d,E[1]=d+P,d=E[1]):(E[0]=0,E[1]=0)}}}},PK={sign:AK,expand:QZ,none:Kg,silhouette:eX,wiggle:tX,positive:CK},IK=(e,t,n)=>{var o,u=(o=PK[n])!==null&&o!==void 0?o:Kg,d=JZ().keys(t).value((i,E)=>Number(eo(i,E,0))).order(KE).offset(u),g=d(e);return g.forEach((i,E)=>{i.forEach((P,I)=>{var D=eo(e[I],t[E],0);Array.isArray(D)&&D.length===2&&Wr(D[0])&&Wr(D[1])&&(P[0]=D[0],P[1]=D[1])})}),g},MK=e=>{var t=e.flat(2).filter(Wr);return[Math.min(...t),Math.max(...t)]},kK=e=>[e[0]===1/0?0:e[0],e[1]===-1/0?0:e[1]],RK=(e,t,n)=>{if(e!=null)return kK(Object.keys(e).reduce((o,u)=>{var d=e[u];if(!d)return o;var{stackedData:g}=d,i=g.reduce((E,P)=>{var I=i5(P,t,n),D=MK(I);return!Do(D[0])||!Do(D[1])?E:[Math.min(E[0],D[0]),Math.max(E[1],D[1])]},[1/0,-1/0]);return[Math.min(i[0],o[0]),Math.max(i[1],o[1])]},[1/0,-1/0]))},tL=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nL=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,rL=(e,t,n)=>{if(e&&e.scale&&e.scale.bandwidth){var o=e.scale.bandwidth();return o}if(e&&t&&t.length>=2){for(var u=yw(t,I=>I.coordinate),d=1/0,g=1,i=u.length;g<i;g++){var E=u[g],P=u[g-1];d=Math.min(((E==null?void 0:E.coordinate)||0)-((P==null?void 0:P.coordinate)||0),d)}return d===1/0?0:d}return n?void 0:0};function iL(e){var{tooltipEntrySettings:t,dataKey:n,payload:o,value:u,name:d}=e;return sy(sy({},t),{},{dataKey:n,payload:o,value:u,name:d})}function s5(e,t){if(e)return String(e);if(typeof t=="string")return t}var OK=(e,t)=>{if(t==="horizontal")return e.chartX;if(t==="vertical")return e.chartY},DK=(e,t)=>t==="centric"?e.angle:e.radius,xp=e=>e.layout.width,bp=e=>e.layout.height,LK=e=>e.layout.scale,o5=e=>e.layout.margin,Pw=Ht(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),Iw=Ht(e=>e.cartesianAxis.yAxis,e=>Object.values(e)),a5="data-recharts-item-index",l5="data-recharts-item-id",Wx=60;function sL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function cb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sL(Object(n),!0).forEach(function(o){jK(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function jK(e,t,n){return(t=zK(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zK(e){var t=NK(e,"string");return typeof t=="symbol"?t:t+""}function NK(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var FK=e=>e.brush.height;function BK(e){var t=Iw(e);return t.reduce((n,o)=>{if(o.orientation==="left"&&!o.mirror&&!o.hide){var u=typeof o.width=="number"?o.width:Wx;return n+u}return n},0)}function UK(e){var t=Iw(e);return t.reduce((n,o)=>{if(o.orientation==="right"&&!o.mirror&&!o.hide){var u=typeof o.width=="number"?o.width:Wx;return n+u}return n},0)}function VK(e){var t=Pw(e);return t.reduce((n,o)=>o.orientation==="top"&&!o.mirror&&!o.hide?n+o.height:n,0)}function $K(e){var t=Pw(e);return t.reduce((n,o)=>o.orientation==="bottom"&&!o.mirror&&!o.hide?n+o.height:n,0)}var ca=Ht([xp,bp,o5,FK,BK,UK,VK,$K,PB,yY],(e,t,n,o,u,d,g,i,E,P)=>{var I={left:(n.left||0)+u,right:(n.right||0)+d},D={top:(n.top||0)+g,bottom:(n.bottom||0)+i},F=cb(cb({},D),I),$=F.bottom;F.bottom+=o,F=TK(F,E,P);var Z=e-F.left-F.right,q=t-F.top-F.bottom;return cb(cb({brushBottom:$},F),{},{width:Math.max(Z,0),height:Math.max(q,0)})}),HK=Ht(ca,e=>({x:e.left,y:e.top,width:e.width,height:e.height}));Ht(xp,bp,(e,t)=>({x:0,y:0,width:e,height:t}));var GK=te.createContext(null),Dm=()=>te.useContext(GK)!=null,Mw=e=>e.brush,kw=Ht([Mw,ca,o5],(e,t,n)=>({height:e.height,x:Wr(e.x)?e.x:t.left,y:Wr(e.y)?e.y:t.top+t.height+t.brushBottom-((n==null?void 0:n.bottom)||0),width:Wr(e.width)?e.width:t.width})),LT={},jT={},zT={},oL;function WK(){return oL||(oL=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,o,{signal:u,edges:d}={}){let g,i=null;const E=d!=null&&d.includes("leading"),P=d==null||d.includes("trailing"),I=()=>{i!==null&&(n.apply(g,i),g=void 0,i=null)},D=()=>{P&&I(),q()};let F=null;const $=()=>{F!=null&&clearTimeout(F),F=setTimeout(()=>{F=null,D()},o)},Z=()=>{F!==null&&(clearTimeout(F),F=null)},q=()=>{Z(),g=void 0,i=null},X=()=>{I()},re=function(...le){if(u!=null&&u.aborted)return;g=this,i=le;const ue=F==null;$(),E&&ue&&I()};return re.schedule=$,re.cancel=q,re.flush=X,u==null||u.addEventListener("abort",q,{once:!0}),re}e.debounce=t})(zT)),zT}var aL;function qK(){return aL||(aL=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=WK();function n(o,u=0,d={}){typeof d!="object"&&(d={});const{leading:g=!1,trailing:i=!0,maxWait:E}=d,P=Array(2);g&&(P[0]="leading"),i&&(P[1]="trailing");let I,D=null;const F=t.debounce(function(...q){I=o.apply(this,q),D=null},u,{edges:P}),$=function(...q){return E!=null&&(D===null&&(D=Date.now()),Date.now()-D>=E)?(I=o.apply(this,q),D=Date.now(),F.cancel(),F.schedule(),I):(F.apply(this,q),I)},Z=()=>(F.flush(),I);return $.cancel=F.cancel,$.flush=Z,$}e.debounce=n})(jT)),jT}var lL;function ZK(){return lL||(lL=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=qK();function n(o,u=0,d={}){const{leading:g=!0,trailing:i=!0}=d;return t.debounce(o,u,{leading:g,maxWait:u,trailing:i})}e.throttle=n})(LT)),LT}var NT,cL;function XK(){return cL||(cL=1,NT=ZK().throttle),NT}var YK=XK();const KK=zh(YK);var uL=function(t,n){for(var o=arguments.length,u=new Array(o>2?o-2:0),d=2;d<o;d++)u[d-2]=arguments[d];if(typeof console<"u"&&console.warn&&(n===void 0&&console.warn("LogUtils requires an error message argument"),!t))if(n===void 0)console.warn("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var g=0;console.warn(n.replace(/%s/g,()=>u[g++]))}},c5=(e,t,n)=>{var{width:o="100%",height:u="100%",aspect:d,maxHeight:g}=n,i=fp(o)?e:Number(o),E=fp(u)?t:Number(u);return d&&d>0&&(i?E=i/d:E&&(i=E*d),g&&E!=null&&E>g&&(E=g)),{calculatedWidth:i,calculatedHeight:E}},JK={width:0,height:0,overflow:"visible"},QK={width:0,overflowX:"visible"},eJ={height:0,overflowY:"visible"},tJ={},nJ=e=>{var{width:t,height:n}=e,o=fp(t),u=fp(n);return o&&u?JK:o?QK:u?eJ:tJ};function rJ(e){var{width:t,height:n,aspect:o}=e,u=t,d=n;return u===void 0&&d===void 0?(u="100%",d="100%"):u===void 0?u=o&&o>0?void 0:"100%":d===void 0&&(d=o&&o>0?void 0:"100%"),{width:u,height:d}}function cA(){return cA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},cA.apply(null,arguments)}function hL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function dL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hL(Object(n),!0).forEach(function(o){iJ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function iJ(e,t,n){return(t=sJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sJ(e){var t=oJ(e,"string");return typeof t=="symbol"?t:t+""}function oJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var u5=te.createContext({width:-1,height:-1});function aJ(e){return Pm(e.width)&&Pm(e.height)}function h5(e){var{children:t,width:n,height:o}=e,u=te.useMemo(()=>({width:n,height:o}),[n,o]);return aJ(u)?te.createElement(u5.Provider,{value:u},t):null}var MC=()=>te.useContext(u5),lJ=te.forwardRef((e,t)=>{var{aspect:n,initialDimension:o={width:-1,height:-1},width:u,height:d,minWidth:g=0,minHeight:i,maxHeight:E,children:P,debounce:I=0,id:D,className:F,onResize:$,style:Z={}}=e,q=te.useRef(null),X=te.useRef();X.current=$,te.useImperativeHandle(t,()=>q.current);var[re,le]=te.useState({containerWidth:o.width,containerHeight:o.height}),ue=te.useCallback((Ze,Ge)=>{le(gt=>{var lt=Math.round(Ze),qe=Math.round(Ge);return gt.containerWidth===lt&&gt.containerHeight===qe?gt:{containerWidth:lt,containerHeight:qe}})},[]);te.useEffect(()=>{if(q.current==null||typeof ResizeObserver>"u")return $x;var Ze=qe=>{var en,{width:Jt,height:Nt}=qe[0].contentRect;ue(Jt,Nt),(en=X.current)===null||en===void 0||en.call(X,Jt,Nt)};I>0&&(Ze=KK(Ze,I,{trailing:!0,leading:!1}));var Ge=new ResizeObserver(Ze),{width:gt,height:lt}=q.current.getBoundingClientRect();return ue(gt,lt),Ge.observe(q.current),()=>{Ge.disconnect()}},[ue,I]);var{containerWidth:ye,containerHeight:ge}=re;uL(!n||n>0,"The aspect(%s) must be greater than zero.",n);var{calculatedWidth:we,calculatedHeight:Le}=c5(ye,ge,{width:u,height:d,aspect:n,maxHeight:E});return uL(we!=null&&we>0||Le!=null&&Le>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,we,Le,u,d,g,i,n),te.createElement("div",{id:D?"".concat(D):void 0,className:Oo("recharts-responsive-container",F),style:dL(dL({},Z),{},{width:u,height:d,minWidth:g,minHeight:i,maxHeight:E}),ref:q},te.createElement("div",{style:nJ({width:u,height:d})},te.createElement(h5,{width:we,height:Le},P)))}),cJ=te.forwardRef((e,t)=>{var n=MC();if(Pm(n.width)&&Pm(n.height))return e.children;var{width:o,height:u}=rJ({width:e.width,height:e.height,aspect:e.aspect}),{calculatedWidth:d,calculatedHeight:g}=c5(void 0,void 0,{width:o,height:u,aspect:e.aspect,maxHeight:e.maxHeight});return Wr(d)&&Wr(g)?te.createElement(h5,{width:d,height:g},e.children):te.createElement(lJ,cA({},e,{width:o,height:u,ref:t}))});function d5(e){if(e)return{x:e.x,y:e.y,upperWidth:"upperWidth"in e?e.upperWidth:e.width,lowerWidth:"lowerWidth"in e?e.lowerWidth:e.width,width:e.width,height:e.height}}var Rw=()=>{var e,t=Dm(),n=ii(HK),o=ii(kw),u=(e=ii(Mw))===null||e===void 0?void 0:e.padding;return!t||!o||!u?n:{width:o.width-u.left-u.right,height:o.height-u.top-u.bottom,x:u.left,y:u.top}},uJ={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},hJ=()=>{var e;return(e=ii(ca))!==null&&e!==void 0?e:uJ},dJ=()=>ii(xp),fJ=()=>ii(bp),bs=e=>e.layout.layoutType,Ow=()=>ii(bs),pJ=()=>{var e=Ow();return e!==void 0},Dw=e=>{var t=qo(),n=Dm(),{width:o,height:u}=e,d=MC(),g=o,i=u;return d&&(g=d.width>0?d.width:o,i=d.height>0?d.height:u),te.useEffect(()=>{!n&&Pm(g)&&Pm(i)&&t(yK({width:g,height:i}))},[t,n,g,i]),null},f5=Symbol.for("immer-nothing"),fL=Symbol.for("immer-draftable"),Nc=Symbol.for("immer-state");function Ph(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var _x=Object.getPrototypeOf;function _y(e){return!!e&&!!e[Nc]}function Qg(e){var t;return e?p5(e)||Array.isArray(e)||!!e[fL]||!!((t=e.constructor)!=null&&t[fL])||qx(e)||jw(e):!1}var mJ=Object.prototype.constructor.toString(),pL=new WeakMap;function p5(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);if(t===null||t===Object.prototype)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(n===Object)return!0;if(typeof n!="function")return!1;let o=pL.get(n);return o===void 0&&(o=Function.toString.call(n),pL.set(n,o)),o===mJ}function x1(e,t,n=!0){Lw(e)===0?(n?Reflect.ownKeys(e):Object.keys(e)).forEach(u=>{t(u,e[u],e)}):e.forEach((o,u)=>t(u,o,e))}function Lw(e){const t=e[Nc];return t?t.type_:Array.isArray(e)?1:qx(e)?2:jw(e)?3:0}function uA(e,t){return Lw(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function m5(e,t,n){const o=Lw(e);o===2?e.set(t,n):o===3?e.add(n):e[t]=n}function gJ(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function qx(e){return e instanceof Map}function jw(e){return e instanceof Set}function Mg(e){return e.copy_||e.base_}function hA(e,t){if(qx(e))return new Map(e);if(jw(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=p5(e);if(t===!0||t==="class_only"&&!n){const o=Object.getOwnPropertyDescriptors(e);delete o[Nc];let u=Reflect.ownKeys(o);for(let d=0;d<u.length;d++){const g=u[d],i=o[g];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(o[g]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[g]})}return Object.create(_x(e),o)}else{const o=_x(e);if(o!==null&&n)return{...e};const u=Object.create(o);return Object.assign(u,e)}}function kC(e,t=!1){return zw(e)||_y(e)||!Qg(e)||(Lw(e)>1&&Object.defineProperties(e,{set:ub,add:ub,clear:ub,delete:ub}),Object.freeze(e),t&&Object.values(e).forEach(n=>kC(n,!0))),e}function _J(){Ph(2)}var ub={value:_J};function zw(e){return e===null||typeof e!="object"?!0:Object.isFrozen(e)}var yJ={};function e_(e){const t=yJ[e];return t||Ph(0,e),t}var yx;function g5(){return yx}function vJ(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function mL(e,t){t&&(e_("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function dA(e){fA(e),e.drafts_.forEach(xJ),e.drafts_=null}function fA(e){e===yx&&(yx=e.parent_)}function gL(e){return yx=vJ(yx,e)}function xJ(e){const t=e[Nc];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function _L(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[Nc].modified_&&(dA(t),Ph(4)),Qg(e)&&(e=b1(t,e),t.parent_||w1(t,e)),t.patches_&&e_("Patches").generateReplacementPatches_(n[Nc].base_,e,t.patches_,t.inversePatches_)):e=b1(t,n,[]),dA(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==f5?e:void 0}function b1(e,t,n){if(zw(t))return t;const o=e.immer_.shouldUseStrictIteration(),u=t[Nc];if(!u)return x1(t,(d,g)=>yL(e,u,t,d,g,n),o),t;if(u.scope_!==e)return t;if(!u.modified_)return w1(e,u.base_,!0),u.base_;if(!u.finalized_){u.finalized_=!0,u.scope_.unfinalizedDrafts_--;const d=u.copy_;let g=d,i=!1;u.type_===3&&(g=new Set(d),d.clear(),i=!0),x1(g,(E,P)=>yL(e,u,d,E,P,n,i),o),w1(e,d,!1),n&&e.patches_&&e_("Patches").generatePatches_(u,n,e.patches_,e.inversePatches_)}return u.copy_}function yL(e,t,n,o,u,d,g){if(u==null||typeof u!="object"&&!g)return;const i=zw(u);if(!(i&&!g)){if(_y(u)){const E=d&&t&&t.type_!==3&&!uA(t.assigned_,o)?d.concat(o):void 0,P=b1(e,u,E);if(m5(n,o,P),_y(P))e.canAutoFreeze_=!1;else return}else g&&n.add(u);if(Qg(u)&&!i){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||t&&t.base_&&t.base_[o]===u&&i)return;b1(e,u),(!t||!t.scope_.parent_)&&typeof o!="symbol"&&(qx(n)?n.has(o):Object.prototype.propertyIsEnumerable.call(n,o))&&w1(e,u)}}}function w1(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&kC(t,n)}function bJ(e,t){const n=Array.isArray(e),o={type_:n?1:0,scope_:t?t.scope_:g5(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let u=o,d=RC;n&&(u=[o],d=vx);const{revoke:g,proxy:i}=Proxy.revocable(u,d);return o.draft_=i,o.revoke_=g,i}var RC={get(e,t){if(t===Nc)return e;const n=Mg(e);if(!uA(n,t))return wJ(e,n,t);const o=n[t];return e.finalized_||!Qg(o)?o:o===FT(e.base_,t)?(BT(e),e.copy_[t]=mA(o,e)):o},has(e,t){return t in Mg(e)},ownKeys(e){return Reflect.ownKeys(Mg(e))},set(e,t,n){const o=_5(Mg(e),t);if(o!=null&&o.set)return o.set.call(e.draft_,n),!0;if(!e.modified_){const u=FT(Mg(e),t),d=u==null?void 0:u[Nc];if(d&&d.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(gJ(n,u)&&(n!==void 0||uA(e.base_,t)))return!0;BT(e),pA(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return FT(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,BT(e),pA(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=Mg(e),o=Reflect.getOwnPropertyDescriptor(n,t);return o&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:o.enumerable,value:n[t]}},defineProperty(){Ph(11)},getPrototypeOf(e){return _x(e.base_)},setPrototypeOf(){Ph(12)}},vx={};x1(RC,(e,t)=>{vx[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});vx.deleteProperty=function(e,t){return vx.set.call(this,e,t,void 0)};vx.set=function(e,t,n){return RC.set.call(this,e[0],t,n,e[0])};function FT(e,t){const n=e[Nc];return(n?Mg(n):e)[t]}function wJ(e,t,n){var u;const o=_5(t,n);return o?"value"in o?o.value:(u=o.get)==null?void 0:u.call(e.draft_):void 0}function _5(e,t){if(!(t in e))return;let n=_x(e);for(;n;){const o=Object.getOwnPropertyDescriptor(n,t);if(o)return o;n=_x(n)}}function pA(e){e.modified_||(e.modified_=!0,e.parent_&&pA(e.parent_))}function BT(e){e.copy_||(e.copy_=hA(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var SJ=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(t,n,o)=>{if(typeof t=="function"&&typeof n!="function"){const d=n;n=t;const g=this;return function(E=d,...P){return g.produce(E,I=>n.call(this,I,...P))}}typeof n!="function"&&Ph(6),o!==void 0&&typeof o!="function"&&Ph(7);let u;if(Qg(t)){const d=gL(this),g=mA(t,void 0);let i=!0;try{u=n(g),i=!1}finally{i?dA(d):fA(d)}return mL(d,o),_L(u,d)}else if(!t||typeof t!="object"){if(u=n(t),u===void 0&&(u=t),u===f5&&(u=void 0),this.autoFreeze_&&kC(u,!0),o){const d=[],g=[];e_("Patches").generateReplacementPatches_(t,u,d,g),o(d,g)}return u}else Ph(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(g,...i)=>this.produceWithPatches(g,E=>t(E,...i));let o,u;return[this.produce(t,n,(g,i)=>{o=g,u=i}),o,u]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),typeof(e==null?void 0:e.useStrictIteration)=="boolean"&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){Qg(e)||Ph(8),_y(e)&&(e=TJ(e));const t=gL(this),n=mA(e,void 0);return n[Nc].isManual_=!0,fA(t),n}finishDraft(e,t){const n=e&&e[Nc];(!n||!n.isManual_)&&Ph(9);const{scope_:o}=n;return mL(o,t),_L(void 0,o)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const u=t[n];if(u.path.length===0&&u.op==="replace"){e=u.value;break}}n>-1&&(t=t.slice(n+1));const o=e_("Patches").applyPatches_;return _y(e)?o(e,t):this.produce(e,u=>o(u,t))}};function mA(e,t){const n=qx(e)?e_("MapSet").proxyMap_(e,t):jw(e)?e_("MapSet").proxySet_(e,t):bJ(e,t);return(t?t.scope_:g5()).drafts_.push(n),n}function TJ(e){return _y(e)||Ph(10,e),y5(e)}function y5(e){if(!Qg(e)||zw(e))return e;const t=e[Nc];let n,o=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=hA(e,t.scope_.immer_.useStrictShallowCopy_),o=t.scope_.immer_.shouldUseStrictIteration()}else n=hA(e,!0);return x1(n,(u,d)=>{m5(n,u,y5(d))},o),t&&(t.finalized_=!1),n}var EJ=new SJ;EJ.produce;var AJ={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},v5=oc({name:"legend",initialState:AJ,reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload:{reducer(e,t){e.payload.push(t.payload)},prepare:Ms()},replaceLegendPayload:{reducer(e,t){var{prev:n,next:o}=t.payload,u=Rh(e).payload.indexOf(n);u>-1&&(e.payload[u]=o)},prepare:Ms()},removeLegendPayload:{reducer(e,t){var n=Rh(e).payload.indexOf(t.payload);n>-1&&e.payload.splice(n,1)},prepare:Ms()}}}),{setLegendSize:__e,setLegendSettings:y_e,addLegendPayload:CJ,replaceLegendPayload:PJ,removeLegendPayload:IJ}=v5.actions,MJ=v5.reducer;function gA(){return gA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},gA.apply(null,arguments)}function vL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function UT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vL(Object(n),!0).forEach(function(o){kJ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function kJ(e,t,n){return(t=RJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RJ(e){var t=OJ(e,"string");return typeof t=="symbol"?t:t+""}function OJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function DJ(e){return Array.isArray(e)&&pp(e[0])&&pp(e[1])?e.join(" ~ "):e}var LJ=e=>{var{separator:t=" : ",contentStyle:n={},itemStyle:o={},labelStyle:u={},payload:d,formatter:g,itemSorter:i,wrapperClassName:E,labelClassName:P,label:I,labelFormatter:D,accessibilityLayer:F=!1}=e,$=()=>{if(d&&d.length){var ge={padding:0,margin:0},we=(i?yw(d,i):d).map((Le,Ze)=>{if(Le.type==="none")return null;var Ge=Le.formatter||g||DJ,{value:gt,name:lt}=Le,qe=gt,en=lt;if(Ge){var Jt=Ge(gt,lt,Le,Ze,d);if(Array.isArray(Jt))[qe,en]=Jt;else if(Jt!=null)qe=Jt;else return null}var Nt=UT({display:"block",paddingTop:4,paddingBottom:4,color:Le.color||"#000"},o);return te.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Ze),style:Nt},pp(en)?te.createElement("span",{className:"recharts-tooltip-item-name"},en):null,pp(en)?te.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,te.createElement("span",{className:"recharts-tooltip-item-value"},qe),te.createElement("span",{className:"recharts-tooltip-item-unit"},Le.unit||""))});return te.createElement("ul",{className:"recharts-tooltip-item-list",style:ge},we)}return null},Z=UT({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},n),q=UT({margin:0},u),X=!zc(I),re=X?I:"",le=Oo("recharts-default-tooltip",E),ue=Oo("recharts-tooltip-label",P);X&&D&&d!==void 0&&d!==null&&(re=D(I,d));var ye=F?{role:"status","aria-live":"assertive"}:{};return te.createElement("div",gA({className:le,style:Z},ye),te.createElement("p",{className:ue,style:q},te.isValidElement(re)?re:"".concat(re)),$())},Dv="recharts-tooltip-wrapper",jJ={visibility:"hidden"};function zJ(e){var{coordinate:t,translateX:n,translateY:o}=e;return Oo(Dv,{["".concat(Dv,"-right")]:Wr(n)&&t&&Wr(t.x)&&n>=t.x,["".concat(Dv,"-left")]:Wr(n)&&t&&Wr(t.x)&&n<t.x,["".concat(Dv,"-bottom")]:Wr(o)&&t&&Wr(t.y)&&o>=t.y,["".concat(Dv,"-top")]:Wr(o)&&t&&Wr(t.y)&&o<t.y})}function xL(e){var{allowEscapeViewBox:t,coordinate:n,key:o,offsetTopLeft:u,position:d,reverseDirection:g,tooltipDimension:i,viewBox:E,viewBoxDimension:P}=e;if(d&&Wr(d[o]))return d[o];var I=n[o]-i-(u>0?u:0),D=n[o]+u;if(t[o])return g[o]?I:D;var F=E[o];if(F==null)return 0;if(g[o]){var $=I,Z=F;return $<Z?Math.max(D,F):Math.max(I,F)}if(P==null)return 0;var q=D+i,X=F+P;return q>X?Math.max(I,F):Math.max(D,F)}function NJ(e){var{translateX:t,translateY:n,useTranslate3d:o}=e;return{transform:o?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}function FJ(e){var{allowEscapeViewBox:t,coordinate:n,offsetTopLeft:o,position:u,reverseDirection:d,tooltipBox:g,useTranslate3d:i,viewBox:E}=e,P,I,D;return g.height>0&&g.width>0&&n?(I=xL({allowEscapeViewBox:t,coordinate:n,key:"x",offsetTopLeft:o,position:u,reverseDirection:d,tooltipDimension:g.width,viewBox:E,viewBoxDimension:E.width}),D=xL({allowEscapeViewBox:t,coordinate:n,key:"y",offsetTopLeft:o,position:u,reverseDirection:d,tooltipDimension:g.height,viewBox:E,viewBoxDimension:E.height}),P=NJ({translateX:I,translateY:D,useTranslate3d:i})):P=jJ,{cssProperties:P,cssClasses:zJ({translateX:I,translateY:D,coordinate:n})}}function bL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function hb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bL(Object(n),!0).forEach(function(o){_A(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function _A(e,t,n){return(t=BJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function BJ(e){var t=UJ(e,"string");return typeof t=="symbol"?t:t+""}function UJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class VJ extends te.PureComponent{constructor(){super(...arguments),_A(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),_A(this,"handleKeyDown",t=>{if(t.key==="Escape"){var n,o,u,d;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(n=(o=this.props.coordinate)===null||o===void 0?void 0:o.x)!==null&&n!==void 0?n:0,y:(u=(d=this.props.coordinate)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var t,n;this.state.dismissed&&(((t=this.props.coordinate)===null||t===void 0?void 0:t.x)!==this.state.dismissedAtCoordinate.x||((n=this.props.coordinate)===null||n===void 0?void 0:n.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:t,allowEscapeViewBox:n,animationDuration:o,animationEasing:u,children:d,coordinate:g,hasPayload:i,isAnimationActive:E,offset:P,position:I,reverseDirection:D,useTranslate3d:F,viewBox:$,wrapperStyle:Z,lastBoundingBox:q,innerRef:X,hasPortalFromProps:re}=this.props,{cssClasses:le,cssProperties:ue}=FJ({allowEscapeViewBox:n,coordinate:g,offsetTopLeft:P,position:I,reverseDirection:D,tooltipBox:{height:q.height,width:q.width},useTranslate3d:F,viewBox:$}),ye=re?{}:hb(hb({transition:E&&t?"transform ".concat(o,"ms ").concat(u):void 0},ue),{},{pointerEvents:"none",visibility:!this.state.dismissed&&t&&i?"visible":"hidden",position:"absolute",top:0,left:0}),ge=hb(hb({},ye),{},{visibility:!this.state.dismissed&&t&&i?"visible":"hidden"},Z);return te.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:le,style:ge,ref:X},d)}}var x5=()=>{var e;return(e=ii(t=>t.rootProps.accessibilityLayer))!==null&&e!==void 0?e:!0};function yA(){return yA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},yA.apply(null,arguments)}function wL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function SL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wL(Object(n),!0).forEach(function(o){$J(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function $J(e,t,n){return(t=HJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function HJ(e){var t=GJ(e,"string");return typeof t=="symbol"?t:t+""}function GJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var TL={curveBasisClosed:UZ,curveBasisOpen:VZ,curveBasis:BZ,curveBumpX:AZ,curveBumpY:CZ,curveLinearClosed:$Z,curveLinear:gw,curveMonotoneX:HZ,curveMonotoneY:GZ,curveNatural:WZ,curveStep:qZ,curveStepAfter:XZ,curveStepBefore:ZZ},S1=e=>Do(e.x)&&Do(e.y),EL=e=>e.base!=null&&S1(e.base)&&S1(e),Lv=e=>e.x,jv=e=>e.y,WJ=(e,t)=>{if(typeof e=="function")return e;var n="curve".concat(Vx(e));return(n==="curveMonotone"||n==="curveBump")&&t?TL["".concat(n).concat(t==="vertical"?"Y":"X")]:TL[n]||gw},qJ=e=>{var{type:t="linear",points:n=[],baseLine:o,layout:u,connectNulls:d=!1}=e,g=WJ(t,u),i=d?n.filter(S1):n,E;if(Array.isArray(o)){var P=n.map(($,Z)=>SL(SL({},$),{},{base:o[Z]}));u==="vertical"?E=rb().y(jv).x1(Lv).x0($=>$.base.x):E=rb().x(Lv).y1(jv).y0($=>$.base.y);var I=E.defined(EL).curve(g),D=d?P.filter(EL):P;return I(D)}u==="vertical"&&Wr(o)?E=rb().y(jv).x1(Lv).x0(o):Wr(o)?E=rb().x(Lv).y1(jv).y0(o):E=eB().x(Lv).y(jv);var F=E.defined(S1).curve(g);return F(i)},OC=e=>{var{className:t,points:n,path:o,pathRef:u}=e,d=Ow();if((!n||!n.length)&&!o)return null;var g={type:e.type,points:e.points,baseLine:e.baseLine,layout:e.layout||d,connectNulls:e.connectNulls},i=n&&n.length?qJ(g):o;return te.createElement("path",yA({},my(e),xX(e),{className:Oo("recharts-curve",t),d:i===null?void 0:i,ref:u}))},ZJ=["x","y","top","left","width","height","className"];function vA(){return vA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},vA.apply(null,arguments)}function AL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function XJ(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AL(Object(n),!0).forEach(function(o){YJ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function YJ(e,t,n){return(t=KJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KJ(e){var t=JJ(e,"string");return typeof t=="symbol"?t:t+""}function JJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QJ(e,t){if(e==null)return{};var n,o,u=eQ(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function eQ(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var tQ=(e,t,n,o,u,d)=>"M".concat(e,",").concat(u,"v").concat(o,"M").concat(d,",").concat(t,"h").concat(n),nQ=e=>{var{x:t=0,y:n=0,top:o=0,left:u=0,width:d=0,height:g=0,className:i}=e,E=QJ(e,ZJ),P=XJ({x:t,y:n,top:o,left:u,width:d,height:g},E);return!Wr(t)||!Wr(n)||!Wr(d)||!Wr(g)||!Wr(o)||!Wr(u)?null:te.createElement("path",vA({},Cu(P),{className:Oo("recharts-cross",i),d:tQ(t,n,d,g,o,u)}))};function rQ(e,t,n,o){var u=o/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-u:n.left+.5,y:e==="horizontal"?n.top+.5:t.y-u,width:e==="horizontal"?o:n.width-1,height:e==="horizontal"?n.height-1:o}}function CL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function PL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?CL(Object(n),!0).forEach(function(o){iQ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function iQ(e,t,n){return(t=sQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sQ(e){var t=oQ(e,"string");return typeof t=="symbol"?t:t+""}function oQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aQ=e=>e.replace(/([A-Z])/g,t=>"-".concat(t.toLowerCase())),b5=(e,t,n)=>e.map(o=>"".concat(aQ(o)," ").concat(t,"ms ").concat(n)).join(","),lQ=(e,t)=>[Object.keys(e),Object.keys(t)].reduce((n,o)=>n.filter(u=>o.includes(u))),xx=(e,t)=>Object.keys(t).reduce((n,o)=>PL(PL({},n),{},{[o]:e(o,t[o])}),{});function IL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IL(Object(n),!0).forEach(function(o){cQ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function cQ(e,t,n){return(t=uQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uQ(e){var t=hQ(e,"string");return typeof t=="symbol"?t:t+""}function hQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var T1=(e,t,n)=>e+(t-e)*n,xA=e=>{var{from:t,to:n}=e;return t!==n},w5=(e,t,n)=>{var o=xx((u,d)=>{if(xA(d)){var[g,i]=e(d.from,d.to,d.velocity);return Ho(Ho({},d),{},{from:g,velocity:i})}return d},t);return n<1?xx((u,d)=>xA(d)&&o[u]!=null?Ho(Ho({},d),{},{velocity:T1(d.velocity,o[u].velocity,n),from:T1(d.from,o[u].from,n)}):d,t):w5(e,o,n-1)};function dQ(e,t,n,o,u,d){var g,i=o.reduce((F,$)=>Ho(Ho({},F),{},{[$]:{from:e[$],velocity:0,to:t[$]}}),{}),E=()=>xx((F,$)=>$.from,i),P=()=>!Object.values(i).filter(xA).length,I=null,D=F=>{g||(g=F);var $=F-g,Z=$/n.dt;i=w5(n,i,Z),u(Ho(Ho(Ho({},e),t),E())),g=F,P()||(I=d.setTimeout(D))};return()=>(I=d.setTimeout(D),()=>{var F;(F=I)===null||F===void 0||F()})}function fQ(e,t,n,o,u,d,g){var i=null,E=u.reduce((D,F)=>{var $=e[F],Z=t[F];return $==null||Z==null?D:Ho(Ho({},D),{},{[F]:[$,Z]})},{}),P,I=D=>{P||(P=D);var F=(D-P)/o,$=xx((q,X)=>T1(...X,n(F)),E);if(d(Ho(Ho(Ho({},e),t),$)),F<1)i=g.setTimeout(I);else{var Z=xx((q,X)=>T1(...X,n(1)),E);d(Ho(Ho(Ho({},e),t),Z))}};return()=>(i=g.setTimeout(I),()=>{var D;(D=i)===null||D===void 0||D()})}const pQ=(e,t,n,o,u,d)=>{var g=lQ(e,t);return n==null?()=>(u(Ho(Ho({},e),t)),()=>{}):n.isStepper===!0?dQ(e,t,n,g,u,d):fQ(e,t,n,o,g,u,d)};var E1=1e-4,S5=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],T5=(e,t)=>e.map((n,o)=>n*t**o).reduce((n,o)=>n+o),ML=(e,t)=>n=>{var o=S5(e,t);return T5(o,n)},mQ=(e,t)=>n=>{var o=S5(e,t),u=[...o.map((d,g)=>d*g).slice(1),0];return T5(u,n)},gQ=e=>{var t,n=e.split("(");if(n.length!==2||n[0]!=="cubic-bezier")return null;var o=(t=n[1])===null||t===void 0||(t=t.split(")")[0])===null||t===void 0?void 0:t.split(",");if(o==null||o.length!==4)return null;var u=o.map(d=>parseFloat(d));return[u[0],u[1],u[2],u[3]]},_Q=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if(n.length===1)switch(n[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:{var u=gQ(n[0]);if(u)return u}}return n.length===4?n:[0,0,1,1]},yQ=(e,t,n,o)=>{var u=ML(e,n),d=ML(t,o),g=mQ(e,n),i=P=>P>1?1:P<0?0:P,E=P=>{for(var I=P>1?1:P,D=I,F=0;F<8;++F){var $=u(D)-I,Z=g(D);if(Math.abs($-I)<E1||Z<E1)return d(D);D=i(D-$/Z)}return d(D)};return E.isStepper=!1,E},kL=function(){return yQ(..._Q(...arguments))},vQ=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:n=100,damping:o=8,dt:u=17}=t,d=(g,i,E)=>{var P=-(g-i)*n,I=E*o,D=E+(P-I)*u/1e3,F=E*u/1e3+g;return Math.abs(F-i)<E1&&Math.abs(D)<E1?[i,0]:[F,D]};return d.isStepper=!0,d.dt=u,d},xQ=e=>{if(typeof e=="string")switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return kL(e);case"spring":return vQ();default:if(e.split("(")[0]==="cubic-bezier")return kL(e)}return typeof e=="function"?e:null};function bQ(e){var t,n=()=>null,o=!1,u=null,d=g=>{if(!o){if(Array.isArray(g)){if(!g.length)return;var i=g,[E,...P]=i;if(typeof E=="number"){u=e.setTimeout(d.bind(null,P),E);return}d(E),u=e.setTimeout(d.bind(null,P));return}typeof g=="string"&&(t=g,n(t)),typeof g=="object"&&(t=g,n(t)),typeof g=="function"&&g()}};return{stop:()=>{o=!0},start:g=>{o=!1,u&&(u(),u=null),d(g)},subscribe:g=>(n=g,()=>{n=()=>null}),getTimeoutController:()=>e}}class wQ{setTimeout(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=performance.now(),u=null,d=g=>{g-o>=n?t(g):typeof requestAnimationFrame=="function"&&(u=requestAnimationFrame(d))};return u=requestAnimationFrame(d),()=>{u!=null&&cancelAnimationFrame(u)}}}function SQ(){return bQ(new wQ)}var TQ=te.createContext(SQ);function EQ(e,t){var n=te.useContext(TQ);return te.useMemo(()=>t??n(e),[e,t,n])}var AQ=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),DC={isSsr:AQ()},CQ={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},RL={t:0},VT={t:1};function LC(e){var t=Gd(e,CQ),{isActive:n,canBegin:o,duration:u,easing:d,begin:g,onAnimationEnd:i,onAnimationStart:E,children:P}=t,I=n==="auto"?!DC.isSsr:n,D=EQ(t.animationId,t.animationManager),[F,$]=te.useState(I?RL:VT),Z=te.useRef(null);return te.useEffect(()=>{I||$(VT)},[I]),te.useEffect(()=>{if(!I||!o)return $x;var q=pQ(RL,VT,xQ(d),u,$,D.getTimeoutController()),X=()=>{Z.current=q()};return D.start([E,g,X,u,i]),()=>{D.stop(),Z.current&&Z.current(),i()}},[I,o,u,d,g,E,i,D]),P(F.t)}function jC(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",n=te.useRef(fx(t)),o=te.useRef(e);return o.current!==e&&(n.current=fx(t),o.current=e),n.current}var PQ=["radius"],IQ=["radius"],OL,DL,LL,jL,zL,NL,FL,BL,UL,VL;function $L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function HL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$L(Object(n),!0).forEach(function(o){MQ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$L(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function MQ(e,t,n){return(t=kQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kQ(e){var t=RQ(e,"string");return typeof t=="symbol"?t:t+""}function RQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function A1(){return A1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},A1.apply(null,arguments)}function GL(e,t){if(e==null)return{};var n,o,u=OQ(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function OQ(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function Ld(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var WL=(e,t,n,o,u)=>{var d=_m(n),g=_m(o),i=Math.min(Math.abs(d)/2,Math.abs(g)/2),E=g>=0?1:-1,P=d>=0?1:-1,I=g>=0&&d>=0||g<0&&d<0?1:0,D;if(i>0&&u instanceof Array){for(var F=[0,0,0,0],$=0,Z=4;$<Z;$++)F[$]=u[$]>i?i:u[$];D=Js(OL||(OL=Ld(["M",",",""])),e,t+E*F[0]),F[0]>0&&(D+=Js(DL||(DL=Ld(["A ",",",",0,0,",",",",",""])),F[0],F[0],I,e+P*F[0],t)),D+=Js(LL||(LL=Ld(["L ",",",""])),e+n-P*F[1],t),F[1]>0&&(D+=Js(jL||(jL=Ld(["A ",",",",0,0,",`,
        `,",",""])),F[1],F[1],I,e+n,t+E*F[1])),D+=Js(zL||(zL=Ld(["L ",",",""])),e+n,t+o-E*F[2]),F[2]>0&&(D+=Js(NL||(NL=Ld(["A ",",",",0,0,",`,
        `,",",""])),F[2],F[2],I,e+n-P*F[2],t+o)),D+=Js(FL||(FL=Ld(["L ",",",""])),e+P*F[3],t+o),F[3]>0&&(D+=Js(BL||(BL=Ld(["A ",",",",0,0,",`,
        `,",",""])),F[3],F[3],I,e,t+o-E*F[3])),D+="Z"}else if(i>0&&u===+u&&u>0){var q=Math.min(i,u);D=Js(UL||(UL=Ld(["M ",",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",",",`
            L `,",",`
            A `,",",",0,0,",",",","," Z"])),e,t+E*q,q,q,I,e+P*q,t,e+n-P*q,t,q,q,I,e+n,t+E*q,e+n,t+o-E*q,q,q,I,e+n-P*q,t+o,e+P*q,t+o,q,q,I,e,t+o-E*q)}else D=Js(VL||(VL=Ld(["M ",","," h "," v "," h "," Z"])),e,t,n,o,-n);return D},qL={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},E5=e=>{var t=Gd(e,qL),n=te.useRef(null),[o,u]=te.useState(-1);te.useEffect(()=>{if(n.current&&n.current.getTotalLength)try{var an=n.current.getTotalLength();an&&u(an)}catch{}},[]);var{x:d,y:g,width:i,height:E,radius:P,className:I}=t,{animationEasing:D,animationDuration:F,animationBegin:$,isAnimationActive:Z,isUpdateAnimationActive:q}=t,X=te.useRef(i),re=te.useRef(E),le=te.useRef(d),ue=te.useRef(g),ye=te.useMemo(()=>({x:d,y:g,width:i,height:E,radius:P}),[d,g,i,E,P]),ge=jC(ye,"rectangle-");if(d!==+d||g!==+g||i!==+i||E!==+E||i===0||E===0)return null;var we=Oo("recharts-rectangle",I);if(!q){var Le=Cu(t),{radius:Ze}=Le,Ge=GL(Le,PQ);return te.createElement("path",A1({},Ge,{x:_m(d),y:_m(g),width:_m(i),height:_m(E),radius:typeof P=="number"?P:void 0,className:we,d:WL(d,g,i,E,P)}))}var gt=X.current,lt=re.current,qe=le.current,en=ue.current,Jt="0px ".concat(o===-1?1:o,"px"),Nt="".concat(o,"px 0px"),St=b5(["strokeDasharray"],F,typeof D=="string"?D:qL.animationEasing);return te.createElement(LC,{animationId:ge,key:ge,canBegin:o>0,duration:F,easing:D,isActive:q,begin:$},an=>{var Kt=Ah(gt,i,an),hn=Ah(lt,E,an),Xt=Ah(qe,d,an),et=Ah(en,g,an);n.current&&(X.current=Kt,re.current=hn,le.current=Xt,ue.current=et);var zt;Z?an>0?zt={transition:St,strokeDasharray:Nt}:zt={strokeDasharray:Jt}:zt={strokeDasharray:Nt};var Zn=Cu(t),{radius:$n}=Zn,fr=GL(Zn,IQ);return te.createElement("path",A1({},fr,{radius:typeof P=="number"?P:void 0,className:we,d:WL(Xt,et,Kt,hn,P),ref:n,style:HL(HL({},zt),t.style)}))})};function ZL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function XL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZL(Object(n),!0).forEach(function(o){DQ(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZL(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function DQ(e,t,n){return(t=LQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LQ(e){var t=jQ(e,"string");return typeof t=="symbol"?t:t+""}function jQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var C1=Math.PI/180,zQ=e=>e*180/Math.PI,ko=(e,t,n,o)=>({x:e+Math.cos(-C1*o)*n,y:t+Math.sin(-C1*o)*n}),A5=function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(o.left||0)-(o.right||0)),Math.abs(n-(o.top||0)-(o.bottom||0)))/2},NQ=(e,t)=>{var{x:n,y:o}=e,{x:u,y:d}=t;return Math.sqrt((n-u)**2+(o-d)**2)},FQ=(e,t)=>{var{x:n,y:o}=e,{cx:u,cy:d}=t,g=NQ({x:n,y:o},{x:u,y:d});if(g<=0)return{radius:g,angle:0};var i=(n-u)/g,E=Math.acos(i);return o>d&&(E=2*Math.PI-E),{radius:g,angle:zQ(E),angleInRadian:E}},BQ=e=>{var{startAngle:t,endAngle:n}=e,o=Math.floor(t/360),u=Math.floor(n/360),d=Math.min(o,u);return{startAngle:t-d*360,endAngle:n-d*360}},UQ=(e,t)=>{var{startAngle:n,endAngle:o}=t,u=Math.floor(n/360),d=Math.floor(o/360),g=Math.min(u,d);return e+g*360},VQ=(e,t)=>{var{chartX:n,chartY:o}=e,{radius:u,angle:d}=FQ({x:n,y:o},t),{innerRadius:g,outerRadius:i}=t;if(u<g||u>i||u===0)return null;var{startAngle:E,endAngle:P}=BQ(t),I=d,D;if(E<=P){for(;I>P;)I-=360;for(;I<E;)I+=360;D=I>=E&&I<=P}else{for(;I>E;)I-=360;for(;I<P;)I+=360;D=I>=P&&I<=E}return D?XL(XL({},t),{},{radius:u,angle:UQ(I,t)}):null};function C5(e){var{cx:t,cy:n,radius:o,startAngle:u,endAngle:d}=e,g=ko(t,n,o,u),i=ko(t,n,o,d);return{points:[g,i],cx:t,cy:n,radius:o,startAngle:u,endAngle:d}}var YL,KL,JL,QL,ej,tj,nj;function bA(){return bA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},bA.apply(null,arguments)}function Lg(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var $Q=(e,t)=>{var n=tc(t-e),o=Math.min(Math.abs(t-e),359.999);return n*o},db=e=>{var{cx:t,cy:n,radius:o,angle:u,sign:d,isExternal:g,cornerRadius:i,cornerIsExternal:E}=e,P=i*(g?1:-1)+o,I=Math.asin(i/P)/C1,D=E?u:u+d*I,F=ko(t,n,P,D),$=ko(t,n,o,D),Z=E?u-d*I:u,q=ko(t,n,P*Math.cos(I*C1),Z);return{center:F,circleTangency:$,lineTangency:q,theta:I}},P5=e=>{var{cx:t,cy:n,innerRadius:o,outerRadius:u,startAngle:d,endAngle:g}=e,i=$Q(d,g),E=d+i,P=ko(t,n,u,d),I=ko(t,n,u,E),D=Js(YL||(YL=Lg(["M ",",",`
    A `,",",`,0,
    `,",",`,
    `,",",`
  `])),P.x,P.y,u,u,+(Math.abs(i)>180),+(d>E),I.x,I.y);if(o>0){var F=ko(t,n,o,d),$=ko(t,n,o,E);D+=Js(KL||(KL=Lg(["L ",",",`
            A `,",",`,0,
            `,",",`,
            `,","," Z"])),$.x,$.y,o,o,+(Math.abs(i)>180),+(d<=E),F.x,F.y)}else D+=Js(JL||(JL=Lg(["L ",","," Z"])),t,n);return D},HQ=e=>{var{cx:t,cy:n,innerRadius:o,outerRadius:u,cornerRadius:d,forceCornerRadius:g,cornerIsExternal:i,startAngle:E,endAngle:P}=e,I=tc(P-E),{circleTangency:D,lineTangency:F,theta:$}=db({cx:t,cy:n,radius:u,angle:E,sign:I,cornerRadius:d,cornerIsExternal:i}),{circleTangency:Z,lineTangency:q,theta:X}=db({cx:t,cy:n,radius:u,angle:P,sign:-I,cornerRadius:d,cornerIsExternal:i}),re=i?Math.abs(E-P):Math.abs(E-P)-$-X;if(re<0)return g?Js(QL||(QL=Lg(["M ",",",`
        a`,",",",0,0,1,",`,0
        a`,",",",0,0,1,",`,0
      `])),F.x,F.y,d,d,d*2,d,d,-d*2):P5({cx:t,cy:n,innerRadius:o,outerRadius:u,startAngle:E,endAngle:P});var le=Js(ej||(ej=Lg(["M ",",",`
    A`,",",",0,0,",",",",",`
    A`,",",",0,",",",",",",",`
    A`,",",",0,0,",",",",",`
  `])),F.x,F.y,d,d,+(I<0),D.x,D.y,u,u,+(re>180),+(I<0),Z.x,Z.y,d,d,+(I<0),q.x,q.y);if(o>0){var{circleTangency:ue,lineTangency:ye,theta:ge}=db({cx:t,cy:n,radius:o,angle:E,sign:I,isExternal:!0,cornerRadius:d,cornerIsExternal:i}),{circleTangency:we,lineTangency:Le,theta:Ze}=db({cx:t,cy:n,radius:o,angle:P,sign:-I,isExternal:!0,cornerRadius:d,cornerIsExternal:i}),Ge=i?Math.abs(E-P):Math.abs(E-P)-ge-Ze;if(Ge<0&&d===0)return"".concat(le,"L").concat(t,",").concat(n,"Z");le+=Js(tj||(tj=Lg(["L",",",`
      A`,",",",0,0,",",",",",`
      A`,",",",0,",",",",",",",`
      A`,",",",0,0,",",",",","Z"])),Le.x,Le.y,d,d,+(I<0),we.x,we.y,o,o,+(Ge>180),+(I>0),ue.x,ue.y,d,d,+(I<0),ye.x,ye.y)}else le+=Js(nj||(nj=Lg(["L",",","Z"])),t,n);return le},GQ={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},I5=e=>{var t=Gd(e,GQ),{cx:n,cy:o,innerRadius:u,outerRadius:d,cornerRadius:g,forceCornerRadius:i,cornerIsExternal:E,startAngle:P,endAngle:I,className:D}=t;if(d<u||P===I)return null;var F=Oo("recharts-sector",D),$=d-u,Z=Lc(g,$,0,!0),q;return Z>0&&Math.abs(P-I)<360?q=HQ({cx:n,cy:o,innerRadius:u,outerRadius:d,cornerRadius:Math.min(Z,$/2),forceCornerRadius:i,cornerIsExternal:E,startAngle:P,endAngle:I}):q=P5({cx:n,cy:o,innerRadius:u,outerRadius:d,startAngle:P,endAngle:I}),te.createElement("path",bA({},Cu(t),{className:F,d:q}))};function WQ(e,t,n){if(e==="horizontal")return[{x:t.x,y:n.top},{x:t.x,y:n.top+n.height}];if(e==="vertical")return[{x:n.left,y:t.y},{x:n.left+n.width,y:t.y}];if(mB(t)){if(e==="centric"){var{cx:o,cy:u,innerRadius:d,outerRadius:g,angle:i}=t,E=ko(o,u,d,i),P=ko(o,u,g,i);return[{x:E.x,y:E.y},{x:P.x,y:P.y}]}return C5(t)}}var $T={},HT={},GT={},rj;function qQ(){return rj||(rj=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=AB();function n(o){return t.isSymbol(o)?NaN:Number(o)}e.toNumber=n})(GT)),GT}var ij;function ZQ(){return ij||(ij=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=qQ();function n(o){return o?(o=t.toNumber(o),o===1/0||o===-1/0?(o<0?-1:1)*Number.MAX_VALUE:o===o?o:0):o===0?o:0}e.toFinite=n})(HT)),HT}var sj;function XQ(){return sj||(sj=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=CB(),n=ZQ();function o(u,d,g){g&&typeof g!="number"&&t.isIterateeCall(u,d,g)&&(d=g=void 0),u=n.toFinite(u),d===void 0?(d=u,u=0):d=n.toFinite(d),g=g===void 0?u<d?1:-1:n.toFinite(g);const i=Math.max(Math.ceil((d-u)/(g||1)),0),E=new Array(i);for(let P=0;P<i;P++)E[P]=u,u+=g;return E}e.range=o})($T)),$T}var WT,oj;function YQ(){return oj||(oj=1,WT=XQ().range),WT}var KQ=YQ();const M5=zh(KQ);function Tm(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function JQ(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function k5(e){let t,n,o;e.length!==2?(t=Tm,n=(i,E)=>Tm(e(i),E),o=(i,E)=>e(i)-E):(t=e===Tm||e===JQ?e:QQ,n=e,o=e);function u(i,E,P=0,I=i.length){if(P<I){if(t(E,E)!==0)return I;do{const D=P+I>>>1;n(i[D],E)<0?P=D+1:I=D}while(P<I)}return P}function d(i,E,P=0,I=i.length){if(P<I){if(t(E,E)!==0)return I;do{const D=P+I>>>1;n(i[D],E)<=0?P=D+1:I=D}while(P<I)}return P}function g(i,E,P=0,I=i.length){const D=u(i,E,P,I-1);return D>P&&o(i[D-1],E)>-o(i[D],E)?D-1:D}return{left:u,center:g,right:d}}function QQ(){return 0}function R5(e){return e===null?NaN:+e}function*eee(e,t){for(let n of e)n!=null&&(n=+n)>=n&&(yield n)}const tee=k5(Tm),Zx=tee.right;k5(R5).center;class aj extends Map{constructor(t,n=iee){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[o,u]of t)this.set(o,u)}get(t){return super.get(lj(this,t))}has(t){return super.has(lj(this,t))}set(t,n){return super.set(nee(this,t),n)}delete(t){return super.delete(ree(this,t))}}function lj({_intern:e,_key:t},n){const o=t(n);return e.has(o)?e.get(o):n}function nee({_intern:e,_key:t},n){const o=t(n);return e.has(o)?e.get(o):(e.set(o,n),n)}function ree({_intern:e,_key:t},n){const o=t(n);return e.has(o)&&(n=e.get(o),e.delete(o)),n}function iee(e){return e!==null&&typeof e=="object"?e.valueOf():e}function see(e=Tm){if(e===Tm)return O5;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const o=e(t,n);return o||o===0?o:(e(n,n)===0)-(e(t,t)===0)}}function O5(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const oee=Math.sqrt(50),aee=Math.sqrt(10),lee=Math.sqrt(2);function P1(e,t,n){const o=(t-e)/Math.max(0,n),u=Math.floor(Math.log10(o)),d=o/Math.pow(10,u),g=d>=oee?10:d>=aee?5:d>=lee?2:1;let i,E,P;return u<0?(P=Math.pow(10,-u)/g,i=Math.round(e*P),E=Math.round(t*P),i/P<e&&++i,E/P>t&&--E,P=-P):(P=Math.pow(10,u)*g,i=Math.round(e/P),E=Math.round(t/P),i*P<e&&++i,E*P>t&&--E),E<i&&.5<=n&&n<2?P1(e,t,n*2):[i,E,P]}function wA(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const o=t<e,[u,d,g]=o?P1(t,e,n):P1(e,t,n);if(!(d>=u))return[];const i=d-u+1,E=new Array(i);if(o)if(g<0)for(let P=0;P<i;++P)E[P]=(d-P)/-g;else for(let P=0;P<i;++P)E[P]=(d-P)*g;else if(g<0)for(let P=0;P<i;++P)E[P]=(u+P)/-g;else for(let P=0;P<i;++P)E[P]=(u+P)*g;return E}function SA(e,t,n){return t=+t,e=+e,n=+n,P1(e,t,n)[2]}function cee(e,t,n){t=+t,e=+e,n=+n;const o=t<e,u=o?SA(t,e,n):SA(e,t,n);return(o?-1:1)*(u<0?1/-u:u)}function cj(e,t){let n;for(const o of e)o!=null&&(n<o||n===void 0&&o>=o)&&(n=o);return n}function uj(e,t){let n;for(const o of e)o!=null&&(n>o||n===void 0&&o>=o)&&(n=o);return n}function D5(e,t,n=0,o=1/0,u){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),o=Math.floor(Math.min(e.length-1,o)),!(n<=t&&t<=o))return e;for(u=u===void 0?O5:see(u);o>n;){if(o-n>600){const E=o-n+1,P=t-n+1,I=Math.log(E),D=.5*Math.exp(2*I/3),F=.5*Math.sqrt(I*D*(E-D)/E)*(P-E/2<0?-1:1),$=Math.max(n,Math.floor(t-P*D/E+F)),Z=Math.min(o,Math.floor(t+(E-P)*D/E+F));D5(e,t,$,Z,u)}const d=e[t];let g=n,i=o;for(zv(e,n,t),u(e[o],d)>0&&zv(e,n,o);g<i;){for(zv(e,g,i),++g,--i;u(e[g],d)<0;)++g;for(;u(e[i],d)>0;)--i}u(e[n],d)===0?zv(e,n,i):(++i,zv(e,i,o)),i<=t&&(n=i+1),t<=i&&(o=i-1)}return e}function zv(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function uee(e,t,n){if(e=Float64Array.from(eee(e)),!(!(o=e.length)||isNaN(t=+t))){if(t<=0||o<2)return uj(e);if(t>=1)return cj(e);var o,u=(o-1)*t,d=Math.floor(u),g=cj(D5(e,d).subarray(0,d+1)),i=uj(e.subarray(d+1));return g+(i-g)*(u-d)}}function hee(e,t,n=R5){if(!(!(o=e.length)||isNaN(t=+t))){if(t<=0||o<2)return+n(e[0],0,e);if(t>=1)return+n(e[o-1],o-1,e);var o,u=(o-1)*t,d=Math.floor(u),g=+n(e[d],d,e),i=+n(e[d+1],d+1,e);return g+(i-g)*(u-d)}}function dee(e,t,n){e=+e,t=+t,n=(u=arguments.length)<2?(t=e,e=0,1):u<3?1:+n;for(var o=-1,u=Math.max(0,Math.ceil((t-e)/n))|0,d=new Array(u);++o<u;)d[o]=e+o*n;return d}function Mu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function wp(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const TA=Symbol("implicit");function zC(){var e=new aj,t=[],n=[],o=TA;function u(d){let g=e.get(d);if(g===void 0){if(o!==TA)return o;e.set(d,g=t.push(d)-1)}return n[g%n.length]}return u.domain=function(d){if(!arguments.length)return t.slice();t=[],e=new aj;for(const g of d)e.has(g)||e.set(g,t.push(g)-1);return u},u.range=function(d){return arguments.length?(n=Array.from(d),u):n.slice()},u.unknown=function(d){return arguments.length?(o=d,u):o},u.copy=function(){return zC(t,n).unknown(o)},Mu.apply(u,arguments),u}function NC(){var e=zC().unknown(void 0),t=e.domain,n=e.range,o=0,u=1,d,g,i=!1,E=0,P=0,I=.5;delete e.unknown;function D(){var F=t().length,$=u<o,Z=$?u:o,q=$?o:u;d=(q-Z)/Math.max(1,F-E+P*2),i&&(d=Math.floor(d)),Z+=(q-Z-d*(F-E))*I,g=d*(1-E),i&&(Z=Math.round(Z),g=Math.round(g));var X=dee(F).map(function(re){return Z+d*re});return n($?X.reverse():X)}return e.domain=function(F){return arguments.length?(t(F),D()):t()},e.range=function(F){return arguments.length?([o,u]=F,o=+o,u=+u,D()):[o,u]},e.rangeRound=function(F){return[o,u]=F,o=+o,u=+u,i=!0,D()},e.bandwidth=function(){return g},e.step=function(){return d},e.round=function(F){return arguments.length?(i=!!F,D()):i},e.padding=function(F){return arguments.length?(E=Math.min(1,P=+F),D()):E},e.paddingInner=function(F){return arguments.length?(E=Math.min(1,F),D()):E},e.paddingOuter=function(F){return arguments.length?(P=+F,D()):P},e.align=function(F){return arguments.length?(I=Math.max(0,Math.min(1,F)),D()):I},e.copy=function(){return NC(t(),[o,u]).round(i).paddingInner(E).paddingOuter(P).align(I)},Mu.apply(D(),arguments)}function L5(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return L5(t())},e}function fee(){return L5(NC.apply(null,arguments).paddingInner(1))}function FC(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function j5(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function Xx(){}var bx=.7,I1=1/bx,ly="\\s*([+-]?\\d+)\\s*",wx="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ud="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pee=/^#([0-9a-f]{3,8})$/,mee=new RegExp(`^rgb\\(${ly},${ly},${ly}\\)$`),gee=new RegExp(`^rgb\\(${Ud},${Ud},${Ud}\\)$`),_ee=new RegExp(`^rgba\\(${ly},${ly},${ly},${wx}\\)$`),yee=new RegExp(`^rgba\\(${Ud},${Ud},${Ud},${wx}\\)$`),vee=new RegExp(`^hsl\\(${wx},${Ud},${Ud}\\)$`),xee=new RegExp(`^hsla\\(${wx},${Ud},${Ud},${wx}\\)$`),hj={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};FC(Xx,Sx,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:dj,formatHex:dj,formatHex8:bee,formatHsl:wee,formatRgb:fj,toString:fj});function dj(){return this.rgb().formatHex()}function bee(){return this.rgb().formatHex8()}function wee(){return z5(this).formatHsl()}function fj(){return this.rgb().formatRgb()}function Sx(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=pee.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?pj(t):n===3?new nc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?fb(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?fb(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=mee.exec(e))?new nc(t[1],t[2],t[3],1):(t=gee.exec(e))?new nc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=_ee.exec(e))?fb(t[1],t[2],t[3],t[4]):(t=yee.exec(e))?fb(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=vee.exec(e))?_j(t[1],t[2]/100,t[3]/100,1):(t=xee.exec(e))?_j(t[1],t[2]/100,t[3]/100,t[4]):hj.hasOwnProperty(e)?pj(hj[e]):e==="transparent"?new nc(NaN,NaN,NaN,0):null}function pj(e){return new nc(e>>16&255,e>>8&255,e&255,1)}function fb(e,t,n,o){return o<=0&&(e=t=n=NaN),new nc(e,t,n,o)}function See(e){return e instanceof Xx||(e=Sx(e)),e?(e=e.rgb(),new nc(e.r,e.g,e.b,e.opacity)):new nc}function EA(e,t,n,o){return arguments.length===1?See(e):new nc(e,t,n,o??1)}function nc(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}FC(nc,EA,j5(Xx,{brighter(e){return e=e==null?I1:Math.pow(I1,e),new nc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?bx:Math.pow(bx,e),new nc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new nc(Vg(this.r),Vg(this.g),Vg(this.b),M1(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mj,formatHex:mj,formatHex8:Tee,formatRgb:gj,toString:gj}));function mj(){return`#${jg(this.r)}${jg(this.g)}${jg(this.b)}`}function Tee(){return`#${jg(this.r)}${jg(this.g)}${jg(this.b)}${jg((isNaN(this.opacity)?1:this.opacity)*255)}`}function gj(){const e=M1(this.opacity);return`${e===1?"rgb(":"rgba("}${Vg(this.r)}, ${Vg(this.g)}, ${Vg(this.b)}${e===1?")":`, ${e})`}`}function M1(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Vg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function jg(e){return e=Vg(e),(e<16?"0":"")+e.toString(16)}function _j(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ih(e,t,n,o)}function z5(e){if(e instanceof Ih)return new Ih(e.h,e.s,e.l,e.opacity);if(e instanceof Xx||(e=Sx(e)),!e)return new Ih;if(e instanceof Ih)return e;e=e.rgb();var t=e.r/255,n=e.g/255,o=e.b/255,u=Math.min(t,n,o),d=Math.max(t,n,o),g=NaN,i=d-u,E=(d+u)/2;return i?(t===d?g=(n-o)/i+(n<o)*6:n===d?g=(o-t)/i+2:g=(t-n)/i+4,i/=E<.5?d+u:2-d-u,g*=60):i=E>0&&E<1?0:g,new Ih(g,i,E,e.opacity)}function Eee(e,t,n,o){return arguments.length===1?z5(e):new Ih(e,t,n,o??1)}function Ih(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}FC(Ih,Eee,j5(Xx,{brighter(e){return e=e==null?I1:Math.pow(I1,e),new Ih(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?bx:Math.pow(bx,e),new Ih(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,u=2*n-o;return new nc(qT(e>=240?e-240:e+120,u,o),qT(e,u,o),qT(e<120?e+240:e-120,u,o),this.opacity)},clamp(){return new Ih(yj(this.h),pb(this.s),pb(this.l),M1(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=M1(this.opacity);return`${e===1?"hsl(":"hsla("}${yj(this.h)}, ${pb(this.s)*100}%, ${pb(this.l)*100}%${e===1?")":`, ${e})`}`}}));function yj(e){return e=(e||0)%360,e<0?e+360:e}function pb(e){return Math.max(0,Math.min(1,e||0))}function qT(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const BC=e=>()=>e;function Aee(e,t){return function(n){return e+n*t}}function Cee(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(o){return Math.pow(e+o*t,n)}}function Pee(e){return(e=+e)==1?N5:function(t,n){return n-t?Cee(t,n,e):BC(isNaN(t)?n:t)}}function N5(e,t){var n=t-e;return n?Aee(e,n):BC(isNaN(e)?t:e)}const vj=(function e(t){var n=Pee(t);function o(u,d){var g=n((u=EA(u)).r,(d=EA(d)).r),i=n(u.g,d.g),E=n(u.b,d.b),P=N5(u.opacity,d.opacity);return function(I){return u.r=g(I),u.g=i(I),u.b=E(I),u.opacity=P(I),u+""}}return o.gamma=e,o})(1);function Iee(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,o=t.slice(),u;return function(d){for(u=0;u<n;++u)o[u]=e[u]*(1-d)+t[u]*d;return o}}function Mee(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function kee(e,t){var n=t?t.length:0,o=e?Math.min(n,e.length):0,u=new Array(o),d=new Array(n),g;for(g=0;g<o;++g)u[g]=Oy(e[g],t[g]);for(;g<n;++g)d[g]=t[g];return function(i){for(g=0;g<o;++g)d[g]=u[g](i);return d}}function Ree(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function k1(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Oee(e,t){var n={},o={},u;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(u in t)u in e?n[u]=Oy(e[u],t[u]):o[u]=t[u];return function(d){for(u in n)o[u]=n[u](d);return o}}var AA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ZT=new RegExp(AA.source,"g");function Dee(e){return function(){return e}}function Lee(e){return function(t){return e(t)+""}}function jee(e,t){var n=AA.lastIndex=ZT.lastIndex=0,o,u,d,g=-1,i=[],E=[];for(e=e+"",t=t+"";(o=AA.exec(e))&&(u=ZT.exec(t));)(d=u.index)>n&&(d=t.slice(n,d),i[g]?i[g]+=d:i[++g]=d),(o=o[0])===(u=u[0])?i[g]?i[g]+=u:i[++g]=u:(i[++g]=null,E.push({i:g,x:k1(o,u)})),n=ZT.lastIndex;return n<t.length&&(d=t.slice(n),i[g]?i[g]+=d:i[++g]=d),i.length<2?E[0]?Lee(E[0].x):Dee(t):(t=E.length,function(P){for(var I=0,D;I<t;++I)i[(D=E[I]).i]=D.x(P);return i.join("")})}function Oy(e,t){var n=typeof t,o;return t==null||n==="boolean"?BC(t):(n==="number"?k1:n==="string"?(o=Sx(t))?(t=o,vj):jee:t instanceof Sx?vj:t instanceof Date?Ree:Mee(t)?Iee:Array.isArray(t)?kee:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Oee:k1)(e,t)}function UC(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function zee(e,t){t===void 0&&(t=e,e=Oy);for(var n=0,o=t.length-1,u=t[0],d=new Array(o<0?0:o);n<o;)d[n]=e(u,u=t[++n]);return function(g){var i=Math.max(0,Math.min(o-1,Math.floor(g*=o)));return d[i](g-i)}}function Nee(e){return function(){return e}}function R1(e){return+e}var xj=[0,1];function kl(e){return e}function CA(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Nee(isNaN(t)?NaN:.5)}function Fee(e,t){var n;return e>t&&(n=e,e=t,t=n),function(o){return Math.max(e,Math.min(t,o))}}function Bee(e,t,n){var o=e[0],u=e[1],d=t[0],g=t[1];return u<o?(o=CA(u,o),d=n(g,d)):(o=CA(o,u),d=n(d,g)),function(i){return d(o(i))}}function Uee(e,t,n){var o=Math.min(e.length,t.length)-1,u=new Array(o),d=new Array(o),g=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++g<o;)u[g]=CA(e[g],e[g+1]),d[g]=n(t[g],t[g+1]);return function(i){var E=Zx(e,i,1,o)-1;return d[E](u[E](i))}}function Yx(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Nw(){var e=xj,t=xj,n=Oy,o,u,d,g=kl,i,E,P;function I(){var F=Math.min(e.length,t.length);return g!==kl&&(g=Fee(e[0],e[F-1])),i=F>2?Uee:Bee,E=P=null,D}function D(F){return F==null||isNaN(F=+F)?d:(E||(E=i(e.map(o),t,n)))(o(g(F)))}return D.invert=function(F){return g(u((P||(P=i(t,e.map(o),k1)))(F)))},D.domain=function(F){return arguments.length?(e=Array.from(F,R1),I()):e.slice()},D.range=function(F){return arguments.length?(t=Array.from(F),I()):t.slice()},D.rangeRound=function(F){return t=Array.from(F),n=UC,I()},D.clamp=function(F){return arguments.length?(g=F?!0:kl,I()):g!==kl},D.interpolate=function(F){return arguments.length?(n=F,I()):n},D.unknown=function(F){return arguments.length?(d=F,D):d},function(F,$){return o=F,u=$,I()}}function VC(){return Nw()(kl,kl)}function Vee(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function O1(e,t){if(!isFinite(e)||e===0)return null;var n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"),o=e.slice(0,n);return[o.length>1?o[0]+o.slice(2):o,+e.slice(n+1)]}function yy(e){return e=O1(Math.abs(e)),e?e[1]:NaN}function $ee(e,t){return function(n,o){for(var u=n.length,d=[],g=0,i=e[0],E=0;u>0&&i>0&&(E+i+1>o&&(i=Math.max(1,o-E)),d.push(n.substring(u-=i,u+i)),!((E+=i+1)>o));)i=e[g=(g+1)%e.length];return d.reverse().join(t)}}function Hee(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Gee=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Tx(e){if(!(t=Gee.exec(e)))throw new Error("invalid format: "+e);var t;return new $C({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Tx.prototype=$C.prototype;function $C(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}$C.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Wee(e){e:for(var t=e.length,n=1,o=-1,u;n<t;++n)switch(e[n]){case".":o=u=n;break;case"0":o===0&&(o=n),u=n;break;default:if(!+e[n])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(u+1):e}var D1;function qee(e,t){var n=O1(e,t);if(!n)return D1=void 0,e.toPrecision(t);var o=n[0],u=n[1],d=u-(D1=Math.max(-8,Math.min(8,Math.floor(u/3)))*3)+1,g=o.length;return d===g?o:d>g?o+new Array(d-g+1).join("0"):d>0?o.slice(0,d)+"."+o.slice(d):"0."+new Array(1-d).join("0")+O1(e,Math.max(0,t+d-1))[0]}function bj(e,t){var n=O1(e,t);if(!n)return e+"";var o=n[0],u=n[1];return u<0?"0."+new Array(-u).join("0")+o:o.length>u+1?o.slice(0,u+1)+"."+o.slice(u+1):o+new Array(u-o.length+2).join("0")}const wj={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Vee,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>bj(e*100,t),r:bj,s:qee,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Sj(e){return e}var Tj=Array.prototype.map,Ej=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Zee(e){var t=e.grouping===void 0||e.thousands===void 0?Sj:$ee(Tj.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",u=e.decimal===void 0?".":e.decimal+"",d=e.numerals===void 0?Sj:Hee(Tj.call(e.numerals,String)),g=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",E=e.nan===void 0?"NaN":e.nan+"";function P(D,F){D=Tx(D);var $=D.fill,Z=D.align,q=D.sign,X=D.symbol,re=D.zero,le=D.width,ue=D.comma,ye=D.precision,ge=D.trim,we=D.type;we==="n"?(ue=!0,we="g"):wj[we]||(ye===void 0&&(ye=12),ge=!0,we="g"),(re||$==="0"&&Z==="=")&&(re=!0,$="0",Z="=");var Le=(F&&F.prefix!==void 0?F.prefix:"")+(X==="$"?n:X==="#"&&/[boxX]/.test(we)?"0"+we.toLowerCase():""),Ze=(X==="$"?o:/[%p]/.test(we)?g:"")+(F&&F.suffix!==void 0?F.suffix:""),Ge=wj[we],gt=/[defgprs%]/.test(we);ye=ye===void 0?6:/[gprs]/.test(we)?Math.max(1,Math.min(21,ye)):Math.max(0,Math.min(20,ye));function lt(qe){var en=Le,Jt=Ze,Nt,St,an;if(we==="c")Jt=Ge(qe)+Jt,qe="";else{qe=+qe;var Kt=qe<0||1/qe<0;if(qe=isNaN(qe)?E:Ge(Math.abs(qe),ye),ge&&(qe=Wee(qe)),Kt&&+qe==0&&q!=="+"&&(Kt=!1),en=(Kt?q==="("?q:i:q==="-"||q==="("?"":q)+en,Jt=(we==="s"&&!isNaN(qe)&&D1!==void 0?Ej[8+D1/3]:"")+Jt+(Kt&&q==="("?")":""),gt){for(Nt=-1,St=qe.length;++Nt<St;)if(an=qe.charCodeAt(Nt),48>an||an>57){Jt=(an===46?u+qe.slice(Nt+1):qe.slice(Nt))+Jt,qe=qe.slice(0,Nt);break}}}ue&&!re&&(qe=t(qe,1/0));var hn=en.length+qe.length+Jt.length,Xt=hn<le?new Array(le-hn+1).join($):"";switch(ue&&re&&(qe=t(Xt+qe,Xt.length?le-Jt.length:1/0),Xt=""),Z){case"<":qe=en+qe+Jt+Xt;break;case"=":qe=en+Xt+qe+Jt;break;case"^":qe=Xt.slice(0,hn=Xt.length>>1)+en+qe+Jt+Xt.slice(hn);break;default:qe=Xt+en+qe+Jt;break}return d(qe)}return lt.toString=function(){return D+""},lt}function I(D,F){var $=Math.max(-8,Math.min(8,Math.floor(yy(F)/3)))*3,Z=Math.pow(10,-$),q=P((D=Tx(D),D.type="f",D),{suffix:Ej[8+$/3]});return function(X){return q(Z*X)}}return{format:P,formatPrefix:I}}var mb,HC,F5;Xee({thousands:",",grouping:[3],currency:["$",""]});function Xee(e){return mb=Zee(e),HC=mb.format,F5=mb.formatPrefix,mb}function Yee(e){return Math.max(0,-yy(Math.abs(e)))}function Kee(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yy(t)/3)))*3-yy(Math.abs(e)))}function Jee(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,yy(t)-yy(e))+1}function B5(e,t,n,o){var u=cee(e,t,n),d;switch(o=Tx(o??",f"),o.type){case"s":{var g=Math.max(Math.abs(e),Math.abs(t));return o.precision==null&&!isNaN(d=Kee(u,g))&&(o.precision=d),F5(o,g)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(d=Jee(u,Math.max(Math.abs(e),Math.abs(t))))&&(o.precision=d-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(d=Yee(u))&&(o.precision=d-(o.type==="%")*2);break}}return HC(o)}function Lm(e){var t=e.domain;return e.ticks=function(n){var o=t();return wA(o[0],o[o.length-1],n??10)},e.tickFormat=function(n,o){var u=t();return B5(u[0],u[u.length-1],n??10,o)},e.nice=function(n){n==null&&(n=10);var o=t(),u=0,d=o.length-1,g=o[u],i=o[d],E,P,I=10;for(i<g&&(P=g,g=i,i=P,P=u,u=d,d=P);I-- >0;){if(P=SA(g,i,n),P===E)return o[u]=g,o[d]=i,t(o);if(P>0)g=Math.floor(g/P)*P,i=Math.ceil(i/P)*P;else if(P<0)g=Math.ceil(g*P)/P,i=Math.floor(i*P)/P;else break;E=P}return e},e}function U5(){var e=VC();return e.copy=function(){return Yx(e,U5())},Mu.apply(e,arguments),Lm(e)}function V5(e){var t;function n(o){return o==null||isNaN(o=+o)?t:o}return n.invert=n,n.domain=n.range=function(o){return arguments.length?(e=Array.from(o,R1),n):e.slice()},n.unknown=function(o){return arguments.length?(t=o,n):t},n.copy=function(){return V5(e).unknown(t)},e=arguments.length?Array.from(e,R1):[0,1],Lm(n)}function $5(e,t){e=e.slice();var n=0,o=e.length-1,u=e[n],d=e[o],g;return d<u&&(g=n,n=o,o=g,g=u,u=d,d=g),e[n]=t.floor(u),e[o]=t.ceil(d),e}function Aj(e){return Math.log(e)}function Cj(e){return Math.exp(e)}function Qee(e){return-Math.log(-e)}function ete(e){return-Math.exp(-e)}function tte(e){return isFinite(e)?+("1e"+e):e<0?0:e}function nte(e){return e===10?tte:e===Math.E?Math.exp:t=>Math.pow(e,t)}function rte(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function Pj(e){return(t,n)=>-e(-t,n)}function GC(e){const t=e(Aj,Cj),n=t.domain;let o=10,u,d;function g(){return u=rte(o),d=nte(o),n()[0]<0?(u=Pj(u),d=Pj(d),e(Qee,ete)):e(Aj,Cj),t}return t.base=function(i){return arguments.length?(o=+i,g()):o},t.domain=function(i){return arguments.length?(n(i),g()):n()},t.ticks=i=>{const E=n();let P=E[0],I=E[E.length-1];const D=I<P;D&&([P,I]=[I,P]);let F=u(P),$=u(I),Z,q;const X=i==null?10:+i;let re=[];if(!(o%1)&&$-F<X){if(F=Math.floor(F),$=Math.ceil($),P>0){for(;F<=$;++F)for(Z=1;Z<o;++Z)if(q=F<0?Z/d(-F):Z*d(F),!(q<P)){if(q>I)break;re.push(q)}}else for(;F<=$;++F)for(Z=o-1;Z>=1;--Z)if(q=F>0?Z/d(-F):Z*d(F),!(q<P)){if(q>I)break;re.push(q)}re.length*2<X&&(re=wA(P,I,X))}else re=wA(F,$,Math.min($-F,X)).map(d);return D?re.reverse():re},t.tickFormat=(i,E)=>{if(i==null&&(i=10),E==null&&(E=o===10?"s":","),typeof E!="function"&&(!(o%1)&&(E=Tx(E)).precision==null&&(E.trim=!0),E=HC(E)),i===1/0)return E;const P=Math.max(1,o*i/t.ticks().length);return I=>{let D=I/d(Math.round(u(I)));return D*o<o-.5&&(D*=o),D<=P?E(I):""}},t.nice=()=>n($5(n(),{floor:i=>d(Math.floor(u(i))),ceil:i=>d(Math.ceil(u(i)))})),t}function H5(){const e=GC(Nw()).domain([1,10]);return e.copy=()=>Yx(e,H5()).base(e.base()),Mu.apply(e,arguments),e}function Ij(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Mj(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function WC(e){var t=1,n=e(Ij(t),Mj(t));return n.constant=function(o){return arguments.length?e(Ij(t=+o),Mj(t)):t},Lm(n)}function G5(){var e=WC(Nw());return e.copy=function(){return Yx(e,G5()).constant(e.constant())},Mu.apply(e,arguments)}function kj(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ite(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ste(e){return e<0?-e*e:e*e}function qC(e){var t=e(kl,kl),n=1;function o(){return n===1?e(kl,kl):n===.5?e(ite,ste):e(kj(n),kj(1/n))}return t.exponent=function(u){return arguments.length?(n=+u,o()):n},Lm(t)}function ZC(){var e=qC(Nw());return e.copy=function(){return Yx(e,ZC()).exponent(e.exponent())},Mu.apply(e,arguments),e}function ote(){return ZC.apply(null,arguments).exponent(.5)}function Rj(e){return Math.sign(e)*e*e}function ate(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function W5(){var e=VC(),t=[0,1],n=!1,o;function u(d){var g=ate(e(d));return isNaN(g)?o:n?Math.round(g):g}return u.invert=function(d){return e.invert(Rj(d))},u.domain=function(d){return arguments.length?(e.domain(d),u):e.domain()},u.range=function(d){return arguments.length?(e.range((t=Array.from(d,R1)).map(Rj)),u):t.slice()},u.rangeRound=function(d){return u.range(d).round(!0)},u.round=function(d){return arguments.length?(n=!!d,u):n},u.clamp=function(d){return arguments.length?(e.clamp(d),u):e.clamp()},u.unknown=function(d){return arguments.length?(o=d,u):o},u.copy=function(){return W5(e.domain(),t).round(n).clamp(e.clamp()).unknown(o)},Mu.apply(u,arguments),Lm(u)}function q5(){var e=[],t=[],n=[],o;function u(){var g=0,i=Math.max(1,t.length);for(n=new Array(i-1);++g<i;)n[g-1]=hee(e,g/i);return d}function d(g){return g==null||isNaN(g=+g)?o:t[Zx(n,g)]}return d.invertExtent=function(g){var i=t.indexOf(g);return i<0?[NaN,NaN]:[i>0?n[i-1]:e[0],i<n.length?n[i]:e[e.length-1]]},d.domain=function(g){if(!arguments.length)return e.slice();e=[];for(let i of g)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Tm),u()},d.range=function(g){return arguments.length?(t=Array.from(g),u()):t.slice()},d.unknown=function(g){return arguments.length?(o=g,d):o},d.quantiles=function(){return n.slice()},d.copy=function(){return q5().domain(e).range(t).unknown(o)},Mu.apply(d,arguments)}function Z5(){var e=0,t=1,n=1,o=[.5],u=[0,1],d;function g(E){return E!=null&&E<=E?u[Zx(o,E,0,n)]:d}function i(){var E=-1;for(o=new Array(n);++E<n;)o[E]=((E+1)*t-(E-n)*e)/(n+1);return g}return g.domain=function(E){return arguments.length?([e,t]=E,e=+e,t=+t,i()):[e,t]},g.range=function(E){return arguments.length?(n=(u=Array.from(E)).length-1,i()):u.slice()},g.invertExtent=function(E){var P=u.indexOf(E);return P<0?[NaN,NaN]:P<1?[e,o[0]]:P>=n?[o[n-1],t]:[o[P-1],o[P]]},g.unknown=function(E){return arguments.length&&(d=E),g},g.thresholds=function(){return o.slice()},g.copy=function(){return Z5().domain([e,t]).range(u).unknown(d)},Mu.apply(Lm(g),arguments)}function X5(){var e=[.5],t=[0,1],n,o=1;function u(d){return d!=null&&d<=d?t[Zx(e,d,0,o)]:n}return u.domain=function(d){return arguments.length?(e=Array.from(d),o=Math.min(e.length,t.length-1),u):e.slice()},u.range=function(d){return arguments.length?(t=Array.from(d),o=Math.min(e.length,t.length-1),u):t.slice()},u.invertExtent=function(d){var g=t.indexOf(d);return[e[g-1],e[g]]},u.unknown=function(d){return arguments.length?(n=d,u):n},u.copy=function(){return X5().domain(e).range(t).unknown(n)},Mu.apply(u,arguments)}const XT=new Date,YT=new Date;function Zo(e,t,n,o){function u(d){return e(d=arguments.length===0?new Date:new Date(+d)),d}return u.floor=d=>(e(d=new Date(+d)),d),u.ceil=d=>(e(d=new Date(d-1)),t(d,1),e(d),d),u.round=d=>{const g=u(d),i=u.ceil(d);return d-g<i-d?g:i},u.offset=(d,g)=>(t(d=new Date(+d),g==null?1:Math.floor(g)),d),u.range=(d,g,i)=>{const E=[];if(d=u.ceil(d),i=i==null?1:Math.floor(i),!(d<g)||!(i>0))return E;let P;do E.push(P=new Date(+d)),t(d,i),e(d);while(P<d&&d<g);return E},u.filter=d=>Zo(g=>{if(g>=g)for(;e(g),!d(g);)g.setTime(g-1)},(g,i)=>{if(g>=g)if(i<0)for(;++i<=0;)for(;t(g,-1),!d(g););else for(;--i>=0;)for(;t(g,1),!d(g););}),n&&(u.count=(d,g)=>(XT.setTime(+d),YT.setTime(+g),e(XT),e(YT),Math.floor(n(XT,YT))),u.every=d=>(d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?u.filter(o?g=>o(g)%d===0:g=>u.count(0,g)%d===0):u)),u}const L1=Zo(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);L1.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Zo(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):L1);L1.range;const rp=1e3,Su=rp*60,ip=Su*60,gp=ip*24,XC=gp*7,Oj=gp*30,KT=gp*365,zg=Zo(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*rp)},(e,t)=>(t-e)/rp,e=>e.getUTCSeconds());zg.range;const YC=Zo(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*rp)},(e,t)=>{e.setTime(+e+t*Su)},(e,t)=>(t-e)/Su,e=>e.getMinutes());YC.range;const KC=Zo(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Su)},(e,t)=>(t-e)/Su,e=>e.getUTCMinutes());KC.range;const JC=Zo(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*rp-e.getMinutes()*Su)},(e,t)=>{e.setTime(+e+t*ip)},(e,t)=>(t-e)/ip,e=>e.getHours());JC.range;const QC=Zo(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*ip)},(e,t)=>(t-e)/ip,e=>e.getUTCHours());QC.range;const Kx=Zo(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Su)/gp,e=>e.getDate()-1);Kx.range;const Fw=Zo(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/gp,e=>e.getUTCDate()-1);Fw.range;const Y5=Zo(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/gp,e=>Math.floor(e/gp));Y5.range;function l_(e){return Zo(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Su)/XC)}const Bw=l_(0),j1=l_(1),lte=l_(2),cte=l_(3),vy=l_(4),ute=l_(5),hte=l_(6);Bw.range;j1.range;lte.range;cte.range;vy.range;ute.range;hte.range;function c_(e){return Zo(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/XC)}const Uw=c_(0),z1=c_(1),dte=c_(2),fte=c_(3),xy=c_(4),pte=c_(5),mte=c_(6);Uw.range;z1.range;dte.range;fte.range;xy.range;pte.range;mte.range;const eP=Zo(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());eP.range;const tP=Zo(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());tP.range;const _p=Zo(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());_p.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Zo(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});_p.range;const yp=Zo(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());yp.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Zo(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});yp.range;function JT(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function gte(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function _te(e){let t,n,o;e.length!==2?(t=JT,n=(i,E)=>JT(e(i),E),o=(i,E)=>e(i)-E):(t=e===JT||e===gte?e:yte,n=e,o=e);function u(i,E,P=0,I=i.length){if(P<I){if(t(E,E)!==0)return I;do{const D=P+I>>>1;n(i[D],E)<0?P=D+1:I=D}while(P<I)}return P}function d(i,E,P=0,I=i.length){if(P<I){if(t(E,E)!==0)return I;do{const D=P+I>>>1;n(i[D],E)<=0?P=D+1:I=D}while(P<I)}return P}function g(i,E,P=0,I=i.length){const D=u(i,E,P,I-1);return D>P&&o(i[D-1],E)>-o(i[D],E)?D-1:D}return{left:u,center:g,right:d}}function yte(){return 0}const vte=Math.sqrt(50),xte=Math.sqrt(10),bte=Math.sqrt(2);function K5(e,t,n){const o=(t-e)/Math.max(0,n),u=Math.floor(Math.log10(o)),d=o/Math.pow(10,u),g=d>=vte?10:d>=xte?5:d>=bte?2:1;let i,E,P;return u<0?(P=Math.pow(10,-u)/g,i=Math.round(e*P),E=Math.round(t*P),i/P<e&&++i,E/P>t&&--E,P=-P):(P=Math.pow(10,u)*g,i=Math.round(e/P),E=Math.round(t/P),i*P<e&&++i,E*P>t&&--E),E<i&&.5<=n&&n<2?K5(e,t,n*2):[i,E,P]}function Dj(e,t,n){return t=+t,e=+e,n=+n,K5(e,t,n)[2]}function Lj(e,t,n){t=+t,e=+e,n=+n;const o=t<e,u=o?Dj(t,e,n):Dj(e,t,n);return(o?-1:1)*(u<0?1/-u:u)}function J5(e,t,n,o,u,d){const g=[[zg,1,rp],[zg,5,5*rp],[zg,15,15*rp],[zg,30,30*rp],[d,1,Su],[d,5,5*Su],[d,15,15*Su],[d,30,30*Su],[u,1,ip],[u,3,3*ip],[u,6,6*ip],[u,12,12*ip],[o,1,gp],[o,2,2*gp],[n,1,XC],[t,1,Oj],[t,3,3*Oj],[e,1,KT]];function i(P,I,D){const F=I<P;F&&([P,I]=[I,P]);const $=D&&typeof D.range=="function"?D:E(P,I,D),Z=$?$.range(P,+I+1):[];return F?Z.reverse():Z}function E(P,I,D){const F=Math.abs(I-P)/D,$=_te(([,,X])=>X).right(g,F);if($===g.length)return e.every(Lj(P/KT,I/KT,D));if($===0)return L1.every(Math.max(Lj(P,I,D),1));const[Z,q]=g[F/g[$-1][2]<g[$][2]/F?$-1:$];return Z.every(q)}return[i,E]}const[wte,Ste]=J5(yp,tP,Uw,Y5,QC,KC),[Tte,Ete]=J5(_p,eP,Bw,Kx,JC,YC);function QT(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function eE(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Nv(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Ate(e){var t=e.dateTime,n=e.date,o=e.time,u=e.periods,d=e.days,g=e.shortDays,i=e.months,E=e.shortMonths,P=Fv(u),I=Bv(u),D=Fv(d),F=Bv(d),$=Fv(g),Z=Bv(g),q=Fv(i),X=Bv(i),re=Fv(E),le=Bv(E),ue={a:an,A:Kt,b:hn,B:Xt,c:null,d:Uj,e:Uj,f:Xte,g:sne,G:ane,H:Wte,I:qte,j:Zte,L:Q5,m:Yte,M:Kte,p:et,q:zt,Q:Hj,s:Gj,S:Jte,u:Qte,U:ene,V:tne,w:nne,W:rne,x:null,X:null,y:ine,Y:one,Z:lne,"%":$j},ye={a:Zn,A:$n,b:fr,B:kn,c:null,d:Vj,e:Vj,f:dne,g:wne,G:Tne,H:cne,I:une,j:hne,L:t4,m:fne,M:pne,p:Bt,q:En,Q:Hj,s:Gj,S:mne,u:gne,U:_ne,V:yne,w:vne,W:xne,x:null,X:null,y:bne,Y:Sne,Z:Ene,"%":$j},ge={a:gt,A:lt,b:qe,B:en,c:Jt,d:Fj,e:Fj,f:Vte,g:Nj,G:zj,H:Bj,I:Bj,j:Nte,L:Ute,m:zte,M:Fte,p:Ge,q:jte,Q:Hte,s:Gte,S:Bte,u:kte,U:Rte,V:Ote,w:Mte,W:Dte,x:Nt,X:St,y:Nj,Y:zj,Z:Lte,"%":$te};ue.x=we(n,ue),ue.X=we(o,ue),ue.c=we(t,ue),ye.x=we(n,ye),ye.X=we(o,ye),ye.c=we(t,ye);function we(Tt,wn){return function(mr){var tn=[],Ii=-1,Hn=0,nr=Tt.length,Mi,Sn,si;for(mr instanceof Date||(mr=new Date(+mr));++Ii<nr;)Tt.charCodeAt(Ii)===37&&(tn.push(Tt.slice(Hn,Ii)),(Sn=jj[Mi=Tt.charAt(++Ii)])!=null?Mi=Tt.charAt(++Ii):Sn=Mi==="e"?" ":"0",(si=wn[Mi])&&(Mi=si(mr,Sn)),tn.push(Mi),Hn=Ii+1);return tn.push(Tt.slice(Hn,Ii)),tn.join("")}}function Le(Tt,wn){return function(mr){var tn=Nv(1900,void 0,1),Ii=Ze(tn,Tt,mr+="",0),Hn,nr;if(Ii!=mr.length)return null;if("Q"in tn)return new Date(tn.Q);if("s"in tn)return new Date(tn.s*1e3+("L"in tn?tn.L:0));if(wn&&!("Z"in tn)&&(tn.Z=0),"p"in tn&&(tn.H=tn.H%12+tn.p*12),tn.m===void 0&&(tn.m="q"in tn?tn.q:0),"V"in tn){if(tn.V<1||tn.V>53)return null;"w"in tn||(tn.w=1),"Z"in tn?(Hn=eE(Nv(tn.y,0,1)),nr=Hn.getUTCDay(),Hn=nr>4||nr===0?z1.ceil(Hn):z1(Hn),Hn=Fw.offset(Hn,(tn.V-1)*7),tn.y=Hn.getUTCFullYear(),tn.m=Hn.getUTCMonth(),tn.d=Hn.getUTCDate()+(tn.w+6)%7):(Hn=QT(Nv(tn.y,0,1)),nr=Hn.getDay(),Hn=nr>4||nr===0?j1.ceil(Hn):j1(Hn),Hn=Kx.offset(Hn,(tn.V-1)*7),tn.y=Hn.getFullYear(),tn.m=Hn.getMonth(),tn.d=Hn.getDate()+(tn.w+6)%7)}else("W"in tn||"U"in tn)&&("w"in tn||(tn.w="u"in tn?tn.u%7:"W"in tn?1:0),nr="Z"in tn?eE(Nv(tn.y,0,1)).getUTCDay():QT(Nv(tn.y,0,1)).getDay(),tn.m=0,tn.d="W"in tn?(tn.w+6)%7+tn.W*7-(nr+5)%7:tn.w+tn.U*7-(nr+6)%7);return"Z"in tn?(tn.H+=tn.Z/100|0,tn.M+=tn.Z%100,eE(tn)):QT(tn)}}function Ze(Tt,wn,mr,tn){for(var Ii=0,Hn=wn.length,nr=mr.length,Mi,Sn;Ii<Hn;){if(tn>=nr)return-1;if(Mi=wn.charCodeAt(Ii++),Mi===37){if(Mi=wn.charAt(Ii++),Sn=ge[Mi in jj?wn.charAt(Ii++):Mi],!Sn||(tn=Sn(Tt,mr,tn))<0)return-1}else if(Mi!=mr.charCodeAt(tn++))return-1}return tn}function Ge(Tt,wn,mr){var tn=P.exec(wn.slice(mr));return tn?(Tt.p=I.get(tn[0].toLowerCase()),mr+tn[0].length):-1}function gt(Tt,wn,mr){var tn=$.exec(wn.slice(mr));return tn?(Tt.w=Z.get(tn[0].toLowerCase()),mr+tn[0].length):-1}function lt(Tt,wn,mr){var tn=D.exec(wn.slice(mr));return tn?(Tt.w=F.get(tn[0].toLowerCase()),mr+tn[0].length):-1}function qe(Tt,wn,mr){var tn=re.exec(wn.slice(mr));return tn?(Tt.m=le.get(tn[0].toLowerCase()),mr+tn[0].length):-1}function en(Tt,wn,mr){var tn=q.exec(wn.slice(mr));return tn?(Tt.m=X.get(tn[0].toLowerCase()),mr+tn[0].length):-1}function Jt(Tt,wn,mr){return Ze(Tt,t,wn,mr)}function Nt(Tt,wn,mr){return Ze(Tt,n,wn,mr)}function St(Tt,wn,mr){return Ze(Tt,o,wn,mr)}function an(Tt){return g[Tt.getDay()]}function Kt(Tt){return d[Tt.getDay()]}function hn(Tt){return E[Tt.getMonth()]}function Xt(Tt){return i[Tt.getMonth()]}function et(Tt){return u[+(Tt.getHours()>=12)]}function zt(Tt){return 1+~~(Tt.getMonth()/3)}function Zn(Tt){return g[Tt.getUTCDay()]}function $n(Tt){return d[Tt.getUTCDay()]}function fr(Tt){return E[Tt.getUTCMonth()]}function kn(Tt){return i[Tt.getUTCMonth()]}function Bt(Tt){return u[+(Tt.getUTCHours()>=12)]}function En(Tt){return 1+~~(Tt.getUTCMonth()/3)}return{format:function(Tt){var wn=we(Tt+="",ue);return wn.toString=function(){return Tt},wn},parse:function(Tt){var wn=Le(Tt+="",!1);return wn.toString=function(){return Tt},wn},utcFormat:function(Tt){var wn=we(Tt+="",ye);return wn.toString=function(){return Tt},wn},utcParse:function(Tt){var wn=Le(Tt+="",!0);return wn.toString=function(){return Tt},wn}}}var jj={"-":"",_:" ",0:"0"},ua=/^\s*\d+/,Cte=/^%/,Pte=/[\\^$*+?|[\]().{}]/g;function $i(e,t,n){var o=e<0?"-":"",u=(o?-e:e)+"",d=u.length;return o+(d<n?new Array(n-d+1).join(t)+u:u)}function Ite(e){return e.replace(Pte,"\\$&")}function Fv(e){return new RegExp("^(?:"+e.map(Ite).join("|")+")","i")}function Bv(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Mte(e,t,n){var o=ua.exec(t.slice(n,n+1));return o?(e.w=+o[0],n+o[0].length):-1}function kte(e,t,n){var o=ua.exec(t.slice(n,n+1));return o?(e.u=+o[0],n+o[0].length):-1}function Rte(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.U=+o[0],n+o[0].length):-1}function Ote(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.V=+o[0],n+o[0].length):-1}function Dte(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.W=+o[0],n+o[0].length):-1}function zj(e,t,n){var o=ua.exec(t.slice(n,n+4));return o?(e.y=+o[0],n+o[0].length):-1}function Nj(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),n+o[0].length):-1}function Lte(e,t,n){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),n+o[0].length):-1}function jte(e,t,n){var o=ua.exec(t.slice(n,n+1));return o?(e.q=o[0]*3-3,n+o[0].length):-1}function zte(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.m=o[0]-1,n+o[0].length):-1}function Fj(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.d=+o[0],n+o[0].length):-1}function Nte(e,t,n){var o=ua.exec(t.slice(n,n+3));return o?(e.m=0,e.d=+o[0],n+o[0].length):-1}function Bj(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.H=+o[0],n+o[0].length):-1}function Fte(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.M=+o[0],n+o[0].length):-1}function Bte(e,t,n){var o=ua.exec(t.slice(n,n+2));return o?(e.S=+o[0],n+o[0].length):-1}function Ute(e,t,n){var o=ua.exec(t.slice(n,n+3));return o?(e.L=+o[0],n+o[0].length):-1}function Vte(e,t,n){var o=ua.exec(t.slice(n,n+6));return o?(e.L=Math.floor(o[0]/1e3),n+o[0].length):-1}function $te(e,t,n){var o=Cte.exec(t.slice(n,n+1));return o?n+o[0].length:-1}function Hte(e,t,n){var o=ua.exec(t.slice(n));return o?(e.Q=+o[0],n+o[0].length):-1}function Gte(e,t,n){var o=ua.exec(t.slice(n));return o?(e.s=+o[0],n+o[0].length):-1}function Uj(e,t){return $i(e.getDate(),t,2)}function Wte(e,t){return $i(e.getHours(),t,2)}function qte(e,t){return $i(e.getHours()%12||12,t,2)}function Zte(e,t){return $i(1+Kx.count(_p(e),e),t,3)}function Q5(e,t){return $i(e.getMilliseconds(),t,3)}function Xte(e,t){return Q5(e,t)+"000"}function Yte(e,t){return $i(e.getMonth()+1,t,2)}function Kte(e,t){return $i(e.getMinutes(),t,2)}function Jte(e,t){return $i(e.getSeconds(),t,2)}function Qte(e){var t=e.getDay();return t===0?7:t}function ene(e,t){return $i(Bw.count(_p(e)-1,e),t,2)}function e4(e){var t=e.getDay();return t>=4||t===0?vy(e):vy.ceil(e)}function tne(e,t){return e=e4(e),$i(vy.count(_p(e),e)+(_p(e).getDay()===4),t,2)}function nne(e){return e.getDay()}function rne(e,t){return $i(j1.count(_p(e)-1,e),t,2)}function ine(e,t){return $i(e.getFullYear()%100,t,2)}function sne(e,t){return e=e4(e),$i(e.getFullYear()%100,t,2)}function one(e,t){return $i(e.getFullYear()%1e4,t,4)}function ane(e,t){var n=e.getDay();return e=n>=4||n===0?vy(e):vy.ceil(e),$i(e.getFullYear()%1e4,t,4)}function lne(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+$i(t/60|0,"0",2)+$i(t%60,"0",2)}function Vj(e,t){return $i(e.getUTCDate(),t,2)}function cne(e,t){return $i(e.getUTCHours(),t,2)}function une(e,t){return $i(e.getUTCHours()%12||12,t,2)}function hne(e,t){return $i(1+Fw.count(yp(e),e),t,3)}function t4(e,t){return $i(e.getUTCMilliseconds(),t,3)}function dne(e,t){return t4(e,t)+"000"}function fne(e,t){return $i(e.getUTCMonth()+1,t,2)}function pne(e,t){return $i(e.getUTCMinutes(),t,2)}function mne(e,t){return $i(e.getUTCSeconds(),t,2)}function gne(e){var t=e.getUTCDay();return t===0?7:t}function _ne(e,t){return $i(Uw.count(yp(e)-1,e),t,2)}function n4(e){var t=e.getUTCDay();return t>=4||t===0?xy(e):xy.ceil(e)}function yne(e,t){return e=n4(e),$i(xy.count(yp(e),e)+(yp(e).getUTCDay()===4),t,2)}function vne(e){return e.getUTCDay()}function xne(e,t){return $i(z1.count(yp(e)-1,e),t,2)}function bne(e,t){return $i(e.getUTCFullYear()%100,t,2)}function wne(e,t){return e=n4(e),$i(e.getUTCFullYear()%100,t,2)}function Sne(e,t){return $i(e.getUTCFullYear()%1e4,t,4)}function Tne(e,t){var n=e.getUTCDay();return e=n>=4||n===0?xy(e):xy.ceil(e),$i(e.getUTCFullYear()%1e4,t,4)}function Ene(){return"+0000"}function $j(){return"%"}function Hj(e){return+e}function Gj(e){return Math.floor(+e/1e3)}var K_,r4,i4;Ane({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ane(e){return K_=Ate(e),r4=K_.format,K_.parse,i4=K_.utcFormat,K_.utcParse,K_}function Cne(e){return new Date(e)}function Pne(e){return e instanceof Date?+e:+new Date(+e)}function nP(e,t,n,o,u,d,g,i,E,P){var I=VC(),D=I.invert,F=I.domain,$=P(".%L"),Z=P(":%S"),q=P("%I:%M"),X=P("%I %p"),re=P("%a %d"),le=P("%b %d"),ue=P("%B"),ye=P("%Y");function ge(we){return(E(we)<we?$:i(we)<we?Z:g(we)<we?q:d(we)<we?X:o(we)<we?u(we)<we?re:le:n(we)<we?ue:ye)(we)}return I.invert=function(we){return new Date(D(we))},I.domain=function(we){return arguments.length?F(Array.from(we,Pne)):F().map(Cne)},I.ticks=function(we){var Le=F();return e(Le[0],Le[Le.length-1],we??10)},I.tickFormat=function(we,Le){return Le==null?ge:P(Le)},I.nice=function(we){var Le=F();return(!we||typeof we.range!="function")&&(we=t(Le[0],Le[Le.length-1],we??10)),we?F($5(Le,we)):I},I.copy=function(){return Yx(I,nP(e,t,n,o,u,d,g,i,E,P))},I}function Ine(){return Mu.apply(nP(Tte,Ete,_p,eP,Bw,Kx,JC,YC,zg,r4).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Mne(){return Mu.apply(nP(wte,Ste,yp,tP,Uw,Fw,QC,KC,zg,i4).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Vw(){var e=0,t=1,n,o,u,d,g=kl,i=!1,E;function P(D){return D==null||isNaN(D=+D)?E:g(u===0?.5:(D=(d(D)-n)*u,i?Math.max(0,Math.min(1,D)):D))}P.domain=function(D){return arguments.length?([e,t]=D,n=d(e=+e),o=d(t=+t),u=n===o?0:1/(o-n),P):[e,t]},P.clamp=function(D){return arguments.length?(i=!!D,P):i},P.interpolator=function(D){return arguments.length?(g=D,P):g};function I(D){return function(F){var $,Z;return arguments.length?([$,Z]=F,g=D($,Z),P):[g(0),g(1)]}}return P.range=I(Oy),P.rangeRound=I(UC),P.unknown=function(D){return arguments.length?(E=D,P):E},function(D){return d=D,n=D(e),o=D(t),u=n===o?0:1/(o-n),P}}function jm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function s4(){var e=Lm(Vw()(kl));return e.copy=function(){return jm(e,s4())},wp.apply(e,arguments)}function o4(){var e=GC(Vw()).domain([1,10]);return e.copy=function(){return jm(e,o4()).base(e.base())},wp.apply(e,arguments)}function a4(){var e=WC(Vw());return e.copy=function(){return jm(e,a4()).constant(e.constant())},wp.apply(e,arguments)}function rP(){var e=qC(Vw());return e.copy=function(){return jm(e,rP()).exponent(e.exponent())},wp.apply(e,arguments)}function kne(){return rP.apply(null,arguments).exponent(.5)}function l4(){var e=[],t=kl;function n(o){if(o!=null&&!isNaN(o=+o))return t((Zx(e,o,1)-1)/(e.length-1))}return n.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let u of o)u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(Tm),n},n.interpolator=function(o){return arguments.length?(t=o,n):t},n.range=function(){return e.map((o,u)=>t(u/(e.length-1)))},n.quantiles=function(o){return Array.from({length:o+1},(u,d)=>uee(e,d/o))},n.copy=function(){return l4(t).domain(e)},wp.apply(n,arguments)}function $w(){var e=0,t=.5,n=1,o=1,u,d,g,i,E,P=kl,I,D=!1,F;function $(q){return isNaN(q=+q)?F:(q=.5+((q=+I(q))-d)*(o*q<o*d?i:E),P(D?Math.max(0,Math.min(1,q)):q))}$.domain=function(q){return arguments.length?([e,t,n]=q,u=I(e=+e),d=I(t=+t),g=I(n=+n),i=u===d?0:.5/(d-u),E=d===g?0:.5/(g-d),o=d<u?-1:1,$):[e,t,n]},$.clamp=function(q){return arguments.length?(D=!!q,$):D},$.interpolator=function(q){return arguments.length?(P=q,$):P};function Z(q){return function(X){var re,le,ue;return arguments.length?([re,le,ue]=X,P=zee(q,[re,le,ue]),$):[P(0),P(.5),P(1)]}}return $.range=Z(Oy),$.rangeRound=Z(UC),$.unknown=function(q){return arguments.length?(F=q,$):F},function(q){return I=q,u=q(e),d=q(t),g=q(n),i=u===d?0:.5/(d-u),E=d===g?0:.5/(g-d),o=d<u?-1:1,$}}function c4(){var e=Lm($w()(kl));return e.copy=function(){return jm(e,c4())},wp.apply(e,arguments)}function u4(){var e=GC($w()).domain([.1,1,10]);return e.copy=function(){return jm(e,u4()).base(e.base())},wp.apply(e,arguments)}function h4(){var e=WC($w());return e.copy=function(){return jm(e,h4()).constant(e.constant())},wp.apply(e,arguments)}function iP(){var e=qC($w());return e.copy=function(){return jm(e,iP()).exponent(e.exponent())},wp.apply(e,arguments)}function Rne(){return iP.apply(null,arguments).exponent(.5)}const Xv=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:NC,scaleDiverging:c4,scaleDivergingLog:u4,scaleDivergingPow:iP,scaleDivergingSqrt:Rne,scaleDivergingSymlog:h4,scaleIdentity:V5,scaleImplicit:TA,scaleLinear:U5,scaleLog:H5,scaleOrdinal:zC,scalePoint:fee,scalePow:ZC,scaleQuantile:q5,scaleQuantize:Z5,scaleRadial:W5,scaleSequential:s4,scaleSequentialLog:o4,scaleSequentialPow:rP,scaleSequentialQuantile:l4,scaleSequentialSqrt:kne,scaleSequentialSymlog:a4,scaleSqrt:ote,scaleSymlog:G5,scaleThreshold:X5,scaleTime:Ine,scaleUtc:Mne,tickFormat:B5},Symbol.toStringTag,{value:"Module"}));var zm=e=>e.chartData,sP=Ht([zm],e=>{var t=e.chartData!=null?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),d4=(e,t,n,o)=>o?sP(e):zm(e);function Im(e){if(Array.isArray(e)&&e.length===2){var[t,n]=e;if(Do(t)&&Do(n))return!0}return!1}function Wj(e,t,n){return n?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function f4(e,t){if(t&&typeof e!="function"&&Array.isArray(e)&&e.length===2){var[n,o]=e,u,d;if(Do(n))u=n;else if(typeof n=="function")return;if(Do(o))d=o;else if(typeof o=="function")return;var g=[u,d];if(Im(g))return g}}function One(e,t,n){if(!(!n&&t==null)){if(typeof e=="function"&&t!=null)try{var o=e(t,n);if(Im(o))return Wj(o,t,n)}catch{}if(Array.isArray(e)&&e.length===2){var[u,d]=e,g,i;if(u==="auto")t!=null&&(g=Math.min(...t));else if(Wr(u))g=u;else if(typeof u=="function")try{t!=null&&(g=u(t==null?void 0:t[0]))}catch{}else if(typeof u=="string"&&tL.test(u)){var E=tL.exec(u);if(E==null||E[1]==null||t==null)g=void 0;else{var P=+E[1];g=t[0]-P}}else g=t==null?void 0:t[0];if(d==="auto")t!=null&&(i=Math.max(...t));else if(Wr(d))i=d;else if(typeof d=="function")try{t!=null&&(i=d(t==null?void 0:t[1]))}catch{}else if(typeof d=="string"&&nL.test(d)){var I=nL.exec(d);if(I==null||I[1]==null||t==null)i=void 0;else{var D=+I[1];i=t[1]+D}}else i=t==null?void 0:t[1];var F=[g,i];if(Im(F))return t==null?F:Wj(F,t,n)}}}var Dy=1e9,Dne={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},aP,Rs=!0,Iu="[DecimalError] ",$g=Iu+"Invalid argument: ",oP=Iu+"Exponent out of range: ",Ly=Math.floor,kg=Math.pow,Lne=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Oc,oa=1e7,Ss=7,p4=9007199254740991,N1=Ly(p4/Ss),dr={};dr.absoluteValue=dr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};dr.comparedTo=dr.cmp=function(e){var t,n,o,u,d=this;if(e=new d.constructor(e),d.s!==e.s)return d.s||-e.s;if(d.e!==e.e)return d.e>e.e^d.s<0?1:-1;for(o=d.d.length,u=e.d.length,t=0,n=o<u?o:u;t<n;++t)if(d.d[t]!==e.d[t])return d.d[t]>e.d[t]^d.s<0?1:-1;return o===u?0:o>u^d.s<0?1:-1};dr.decimalPlaces=dr.dp=function(){var e=this,t=e.d.length-1,n=(t-e.e)*Ss;if(t=e.d[t],t)for(;t%10==0;t/=10)n--;return n<0?0:n};dr.dividedBy=dr.div=function(e){return cp(this,new this.constructor(e))};dr.dividedToIntegerBy=dr.idiv=function(e){var t=this,n=t.constructor;return cs(cp(t,new n(e),0,1),n.precision)};dr.equals=dr.eq=function(e){return!this.cmp(e)};dr.exponent=function(){return Ro(this)};dr.greaterThan=dr.gt=function(e){return this.cmp(e)>0};dr.greaterThanOrEqualTo=dr.gte=function(e){return this.cmp(e)>=0};dr.isInteger=dr.isint=function(){return this.e>this.d.length-2};dr.isNegative=dr.isneg=function(){return this.s<0};dr.isPositive=dr.ispos=function(){return this.s>0};dr.isZero=function(){return this.s===0};dr.lessThan=dr.lt=function(e){return this.cmp(e)<0};dr.lessThanOrEqualTo=dr.lte=function(e){return this.cmp(e)<1};dr.logarithm=dr.log=function(e){var t,n=this,o=n.constructor,u=o.precision,d=u+5;if(e===void 0)e=new o(10);else if(e=new o(e),e.s<1||e.eq(Oc))throw Error(Iu+"NaN");if(n.s<1)throw Error(Iu+(n.s?"NaN":"-Infinity"));return n.eq(Oc)?new o(0):(Rs=!1,t=cp(Ex(n,d),Ex(e,d),d),Rs=!0,cs(t,u))};dr.minus=dr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?_4(t,e):m4(t,(e.s=-e.s,e))};dr.modulo=dr.mod=function(e){var t,n=this,o=n.constructor,u=o.precision;if(e=new o(e),!e.s)throw Error(Iu+"NaN");return n.s?(Rs=!1,t=cp(n,e,0,1).times(e),Rs=!0,n.minus(t)):cs(new o(n),u)};dr.naturalExponential=dr.exp=function(){return g4(this)};dr.naturalLogarithm=dr.ln=function(){return Ex(this)};dr.negated=dr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};dr.plus=dr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?m4(t,e):_4(t,(e.s=-e.s,e))};dr.precision=dr.sd=function(e){var t,n,o,u=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error($g+e);if(t=Ro(u)+1,o=u.d.length-1,n=o*Ss+1,o=u.d[o],o){for(;o%10==0;o/=10)n--;for(o=u.d[0];o>=10;o/=10)n++}return e&&t>n?t:n};dr.squareRoot=dr.sqrt=function(){var e,t,n,o,u,d,g,i=this,E=i.constructor;if(i.s<1){if(!i.s)return new E(0);throw Error(Iu+"NaN")}for(e=Ro(i),Rs=!1,u=Math.sqrt(+i),u==0||u==1/0?(t=Bd(i.d),(t.length+e)%2==0&&(t+="0"),u=Math.sqrt(t),e=Ly((e+1)/2)-(e<0||e%2),u==1/0?t="5e"+e:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),o=new E(t)):o=new E(u.toString()),n=E.precision,u=g=n+3;;)if(d=o,o=d.plus(cp(i,d,g+2)).times(.5),Bd(d.d).slice(0,g)===(t=Bd(o.d)).slice(0,g)){if(t=t.slice(g-3,g+1),u==g&&t=="4999"){if(cs(d,n+1,0),d.times(d).eq(i)){o=d;break}}else if(t!="9999")break;g+=4}return Rs=!0,cs(o,n)};dr.times=dr.mul=function(e){var t,n,o,u,d,g,i,E,P,I=this,D=I.constructor,F=I.d,$=(e=new D(e)).d;if(!I.s||!e.s)return new D(0);for(e.s*=I.s,n=I.e+e.e,E=F.length,P=$.length,E<P&&(d=F,F=$,$=d,g=E,E=P,P=g),d=[],g=E+P,o=g;o--;)d.push(0);for(o=P;--o>=0;){for(t=0,u=E+o;u>o;)i=d[u]+$[o]*F[u-o-1]+t,d[u--]=i%oa|0,t=i/oa|0;d[u]=(d[u]+t)%oa|0}for(;!d[--g];)d.pop();return t?++n:d.shift(),e.d=d,e.e=n,Rs?cs(e,D.precision):e};dr.toDecimalPlaces=dr.todp=function(e,t){var n=this,o=n.constructor;return n=new o(n),e===void 0?n:(Hd(e,0,Dy),t===void 0?t=o.rounding:Hd(t,0,8),cs(n,e+Ro(n)+1,t))};dr.toExponential=function(e,t){var n,o=this,u=o.constructor;return e===void 0?n=t_(o,!0):(Hd(e,0,Dy),t===void 0?t=u.rounding:Hd(t,0,8),o=cs(new u(o),e+1,t),n=t_(o,!0,e+1)),n};dr.toFixed=function(e,t){var n,o,u=this,d=u.constructor;return e===void 0?t_(u):(Hd(e,0,Dy),t===void 0?t=d.rounding:Hd(t,0,8),o=cs(new d(u),e+Ro(u)+1,t),n=t_(o.abs(),!1,e+Ro(o)+1),u.isneg()&&!u.isZero()?"-"+n:n)};dr.toInteger=dr.toint=function(){var e=this,t=e.constructor;return cs(new t(e),Ro(e)+1,t.rounding)};dr.toNumber=function(){return+this};dr.toPower=dr.pow=function(e){var t,n,o,u,d,g,i=this,E=i.constructor,P=12,I=+(e=new E(e));if(!e.s)return new E(Oc);if(i=new E(i),!i.s){if(e.s<1)throw Error(Iu+"Infinity");return i}if(i.eq(Oc))return i;if(o=E.precision,e.eq(Oc))return cs(i,o);if(t=e.e,n=e.d.length-1,g=t>=n,d=i.s,g){if((n=I<0?-I:I)<=p4){for(u=new E(Oc),t=Math.ceil(o/Ss+4),Rs=!1;n%2&&(u=u.times(i),Zj(u.d,t)),n=Ly(n/2),n!==0;)i=i.times(i),Zj(i.d,t);return Rs=!0,e.s<0?new E(Oc).div(u):cs(u,o)}}else if(d<0)throw Error(Iu+"NaN");return d=d<0&&e.d[Math.max(t,n)]&1?-1:1,i.s=1,Rs=!1,u=e.times(Ex(i,o+P)),Rs=!0,u=g4(u),u.s=d,u};dr.toPrecision=function(e,t){var n,o,u=this,d=u.constructor;return e===void 0?(n=Ro(u),o=t_(u,n<=d.toExpNeg||n>=d.toExpPos)):(Hd(e,1,Dy),t===void 0?t=d.rounding:Hd(t,0,8),u=cs(new d(u),e,t),n=Ro(u),o=t_(u,e<=n||n<=d.toExpNeg,e)),o};dr.toSignificantDigits=dr.tosd=function(e,t){var n=this,o=n.constructor;return e===void 0?(e=o.precision,t=o.rounding):(Hd(e,1,Dy),t===void 0?t=o.rounding:Hd(t,0,8)),cs(new o(n),e,t)};dr.toString=dr.valueOf=dr.val=dr.toJSON=dr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Ro(e),n=e.constructor;return t_(e,t<=n.toExpNeg||t>=n.toExpPos)};function m4(e,t){var n,o,u,d,g,i,E,P,I=e.constructor,D=I.precision;if(!e.s||!t.s)return t.s||(t=new I(e)),Rs?cs(t,D):t;if(E=e.d,P=t.d,g=e.e,u=t.e,E=E.slice(),d=g-u,d){for(d<0?(o=E,d=-d,i=P.length):(o=P,u=g,i=E.length),g=Math.ceil(D/Ss),i=g>i?g+1:i+1,d>i&&(d=i,o.length=1),o.reverse();d--;)o.push(0);o.reverse()}for(i=E.length,d=P.length,i-d<0&&(d=i,o=P,P=E,E=o),n=0;d;)n=(E[--d]=E[d]+P[d]+n)/oa|0,E[d]%=oa;for(n&&(E.unshift(n),++u),i=E.length;E[--i]==0;)E.pop();return t.d=E,t.e=u,Rs?cs(t,D):t}function Hd(e,t,n){if(e!==~~e||e<t||e>n)throw Error($g+e)}function Bd(e){var t,n,o,u=e.length-1,d="",g=e[0];if(u>0){for(d+=g,t=1;t<u;t++)o=e[t]+"",n=Ss-o.length,n&&(d+=mm(n)),d+=o;g=e[t],o=g+"",n=Ss-o.length,n&&(d+=mm(n))}else if(g===0)return"0";for(;g%10===0;)g/=10;return d+g}var cp=(function(){function e(o,u){var d,g=0,i=o.length;for(o=o.slice();i--;)d=o[i]*u+g,o[i]=d%oa|0,g=d/oa|0;return g&&o.unshift(g),o}function t(o,u,d,g){var i,E;if(d!=g)E=d>g?1:-1;else for(i=E=0;i<d;i++)if(o[i]!=u[i]){E=o[i]>u[i]?1:-1;break}return E}function n(o,u,d){for(var g=0;d--;)o[d]-=g,g=o[d]<u[d]?1:0,o[d]=g*oa+o[d]-u[d];for(;!o[0]&&o.length>1;)o.shift()}return function(o,u,d,g){var i,E,P,I,D,F,$,Z,q,X,re,le,ue,ye,ge,we,Le,Ze,Ge=o.constructor,gt=o.s==u.s?1:-1,lt=o.d,qe=u.d;if(!o.s)return new Ge(o);if(!u.s)throw Error(Iu+"Division by zero");for(E=o.e-u.e,Le=qe.length,ge=lt.length,$=new Ge(gt),Z=$.d=[],P=0;qe[P]==(lt[P]||0);)++P;if(qe[P]>(lt[P]||0)&&--E,d==null?le=d=Ge.precision:g?le=d+(Ro(o)-Ro(u))+1:le=d,le<0)return new Ge(0);if(le=le/Ss+2|0,P=0,Le==1)for(I=0,qe=qe[0],le++;(P<ge||I)&&le--;P++)ue=I*oa+(lt[P]||0),Z[P]=ue/qe|0,I=ue%qe|0;else{for(I=oa/(qe[0]+1)|0,I>1&&(qe=e(qe,I),lt=e(lt,I),Le=qe.length,ge=lt.length),ye=Le,q=lt.slice(0,Le),X=q.length;X<Le;)q[X++]=0;Ze=qe.slice(),Ze.unshift(0),we=qe[0],qe[1]>=oa/2&&++we;do I=0,i=t(qe,q,Le,X),i<0?(re=q[0],Le!=X&&(re=re*oa+(q[1]||0)),I=re/we|0,I>1?(I>=oa&&(I=oa-1),D=e(qe,I),F=D.length,X=q.length,i=t(D,q,F,X),i==1&&(I--,n(D,Le<F?Ze:qe,F))):(I==0&&(i=I=1),D=qe.slice()),F=D.length,F<X&&D.unshift(0),n(q,D,X),i==-1&&(X=q.length,i=t(qe,q,Le,X),i<1&&(I++,n(q,Le<X?Ze:qe,X))),X=q.length):i===0&&(I++,q=[0]),Z[P++]=I,i&&q[0]?q[X++]=lt[ye]||0:(q=[lt[ye]],X=1);while((ye++<ge||q[0]!==void 0)&&le--)}return Z[0]||Z.shift(),$.e=E,cs($,g?d+Ro($)+1:d)}})();function g4(e,t){var n,o,u,d,g,i,E=0,P=0,I=e.constructor,D=I.precision;if(Ro(e)>16)throw Error(oP+Ro(e));if(!e.s)return new I(Oc);for(Rs=!1,i=D,g=new I(.03125);e.abs().gte(.1);)e=e.times(g),P+=5;for(o=Math.log(kg(2,P))/Math.LN10*2+5|0,i+=o,n=u=d=new I(Oc),I.precision=i;;){if(u=cs(u.times(e),i),n=n.times(++E),g=d.plus(cp(u,n,i)),Bd(g.d).slice(0,i)===Bd(d.d).slice(0,i)){for(;P--;)d=cs(d.times(d),i);return I.precision=D,t==null?(Rs=!0,cs(d,D)):d}d=g}}function Ro(e){for(var t=e.e*Ss,n=e.d[0];n>=10;n/=10)t++;return t}function tE(e,t,n){if(t>e.LN10.sd())throw Rs=!0,n&&(e.precision=n),Error(Iu+"LN10 precision limit exceeded");return cs(new e(e.LN10),t)}function mm(e){for(var t="";e--;)t+="0";return t}function Ex(e,t){var n,o,u,d,g,i,E,P,I,D=1,F=10,$=e,Z=$.d,q=$.constructor,X=q.precision;if($.s<1)throw Error(Iu+($.s?"NaN":"-Infinity"));if($.eq(Oc))return new q(0);if(t==null?(Rs=!1,P=X):P=t,$.eq(10))return t==null&&(Rs=!0),tE(q,P);if(P+=F,q.precision=P,n=Bd(Z),o=n.charAt(0),d=Ro($),Math.abs(d)<15e14){for(;o<7&&o!=1||o==1&&n.charAt(1)>3;)$=$.times(e),n=Bd($.d),o=n.charAt(0),D++;d=Ro($),o>1?($=new q("0."+n),d++):$=new q(o+"."+n.slice(1))}else return E=tE(q,P+2,X).times(d+""),$=Ex(new q(o+"."+n.slice(1)),P-F).plus(E),q.precision=X,t==null?(Rs=!0,cs($,X)):$;for(i=g=$=cp($.minus(Oc),$.plus(Oc),P),I=cs($.times($),P),u=3;;){if(g=cs(g.times(I),P),E=i.plus(cp(g,new q(u),P)),Bd(E.d).slice(0,P)===Bd(i.d).slice(0,P))return i=i.times(2),d!==0&&(i=i.plus(tE(q,P+2,X).times(d+""))),i=cp(i,new q(D),P),q.precision=X,t==null?(Rs=!0,cs(i,X)):i;i=E,u+=2}}function qj(e,t){var n,o,u;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(o=t.search(/e/i))>0?(n<0&&(n=o),n+=+t.slice(o+1),t=t.substring(0,o)):n<0&&(n=t.length),o=0;t.charCodeAt(o)===48;)++o;for(u=t.length;t.charCodeAt(u-1)===48;)--u;if(t=t.slice(o,u),t){if(u-=o,n=n-o-1,e.e=Ly(n/Ss),e.d=[],o=(n+1)%Ss,n<0&&(o+=Ss),o<u){for(o&&e.d.push(+t.slice(0,o)),u-=Ss;o<u;)e.d.push(+t.slice(o,o+=Ss));t=t.slice(o),o=Ss-t.length}else o-=u;for(;o--;)t+="0";if(e.d.push(+t),Rs&&(e.e>N1||e.e<-N1))throw Error(oP+n)}else e.s=0,e.e=0,e.d=[0];return e}function cs(e,t,n){var o,u,d,g,i,E,P,I,D=e.d;for(g=1,d=D[0];d>=10;d/=10)g++;if(o=t-g,o<0)o+=Ss,u=t,P=D[I=0];else{if(I=Math.ceil((o+1)/Ss),d=D.length,I>=d)return e;for(P=d=D[I],g=1;d>=10;d/=10)g++;o%=Ss,u=o-Ss+g}if(n!==void 0&&(d=kg(10,g-u-1),i=P/d%10|0,E=t<0||D[I+1]!==void 0||P%d,E=n<4?(i||E)&&(n==0||n==(e.s<0?3:2)):i>5||i==5&&(n==4||E||n==6&&(o>0?u>0?P/kg(10,g-u):0:D[I-1])%10&1||n==(e.s<0?8:7))),t<1||!D[0])return E?(d=Ro(e),D.length=1,t=t-d-1,D[0]=kg(10,(Ss-t%Ss)%Ss),e.e=Ly(-t/Ss)||0):(D.length=1,D[0]=e.e=e.s=0),e;if(o==0?(D.length=I,d=1,I--):(D.length=I+1,d=kg(10,Ss-o),D[I]=u>0?(P/kg(10,g-u)%kg(10,u)|0)*d:0),E)for(;;)if(I==0){(D[0]+=d)==oa&&(D[0]=1,++e.e);break}else{if(D[I]+=d,D[I]!=oa)break;D[I--]=0,d=1}for(o=D.length;D[--o]===0;)D.pop();if(Rs&&(e.e>N1||e.e<-N1))throw Error(oP+Ro(e));return e}function _4(e,t){var n,o,u,d,g,i,E,P,I,D,F=e.constructor,$=F.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new F(e),Rs?cs(t,$):t;if(E=e.d,D=t.d,o=t.e,P=e.e,E=E.slice(),g=P-o,g){for(I=g<0,I?(n=E,g=-g,i=D.length):(n=D,o=P,i=E.length),u=Math.max(Math.ceil($/Ss),i)+2,g>u&&(g=u,n.length=1),n.reverse(),u=g;u--;)n.push(0);n.reverse()}else{for(u=E.length,i=D.length,I=u<i,I&&(i=u),u=0;u<i;u++)if(E[u]!=D[u]){I=E[u]<D[u];break}g=0}for(I&&(n=E,E=D,D=n,t.s=-t.s),i=E.length,u=D.length-i;u>0;--u)E[i++]=0;for(u=D.length;u>g;){if(E[--u]<D[u]){for(d=u;d&&E[--d]===0;)E[d]=oa-1;--E[d],E[u]+=oa}E[u]-=D[u]}for(;E[--i]===0;)E.pop();for(;E[0]===0;E.shift())--o;return E[0]?(t.d=E,t.e=o,Rs?cs(t,$):t):new F(0)}function t_(e,t,n){var o,u=Ro(e),d=Bd(e.d),g=d.length;return t?(n&&(o=n-g)>0?d=d.charAt(0)+"."+d.slice(1)+mm(o):g>1&&(d=d.charAt(0)+"."+d.slice(1)),d=d+(u<0?"e":"e+")+u):u<0?(d="0."+mm(-u-1)+d,n&&(o=n-g)>0&&(d+=mm(o))):u>=g?(d+=mm(u+1-g),n&&(o=n-u-1)>0&&(d=d+"."+mm(o))):((o=u+1)<g&&(d=d.slice(0,o)+"."+d.slice(o)),n&&(o=n-g)>0&&(u+1===g&&(d+="."),d+=mm(o))),e.s<0?"-"+d:d}function Zj(e,t){if(e.length>t)return e.length=t,!0}function y4(e){var t,n,o;function u(d){var g=this;if(!(g instanceof u))return new u(d);if(g.constructor=u,d instanceof u){g.s=d.s,g.e=d.e,g.d=(d=d.d)?d.slice():d;return}if(typeof d=="number"){if(d*0!==0)throw Error($g+d);if(d>0)g.s=1;else if(d<0)d=-d,g.s=-1;else{g.s=0,g.e=0,g.d=[0];return}if(d===~~d&&d<1e7){g.e=0,g.d=[d];return}return qj(g,d.toString())}else if(typeof d!="string")throw Error($g+d);if(d.charCodeAt(0)===45?(d=d.slice(1),g.s=-1):g.s=1,Lne.test(d))qj(g,d);else throw Error($g+d)}if(u.prototype=dr,u.ROUND_UP=0,u.ROUND_DOWN=1,u.ROUND_CEIL=2,u.ROUND_FLOOR=3,u.ROUND_HALF_UP=4,u.ROUND_HALF_DOWN=5,u.ROUND_HALF_EVEN=6,u.ROUND_HALF_CEIL=7,u.ROUND_HALF_FLOOR=8,u.clone=y4,u.config=u.set=jne,e===void 0&&(e={}),e)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<o.length;)e.hasOwnProperty(n=o[t++])||(e[n]=this[n]);return u.config(e),u}function jne(e){if(!e||typeof e!="object")throw Error(Iu+"Object expected");var t,n,o,u=["precision",1,Dy,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<u.length;t+=3)if((o=e[n=u[t]])!==void 0)if(Ly(o)===o&&o>=u[t+1]&&o<=u[t+2])this[n]=o;else throw Error($g+n+": "+o);if((o=e[n="LN10"])!==void 0)if(o==Math.LN10)this[n]=new this(o);else throw Error($g+n+": "+o);return this}var aP=y4(Dne);Oc=new aP(1);const es=aP;var zne=e=>e,v4={},x4=e=>e===v4,Xj=e=>function t(){return arguments.length===0||arguments.length===1&&x4(arguments.length<=0?void 0:arguments[0])?t:e(...arguments)},b4=(e,t)=>e===1?t:Xj(function(){for(var n=arguments.length,o=new Array(n),u=0;u<n;u++)o[u]=arguments[u];var d=o.filter(g=>g!==v4).length;return d>=e?t(...o):b4(e-d,Xj(function(){for(var g=arguments.length,i=new Array(g),E=0;E<g;E++)i[E]=arguments[E];var P=o.map(I=>x4(I)?i.shift():I);return t(...P,...i)}))}),Nne=e=>b4(e.length,e),PA=(e,t)=>{for(var n=[],o=e;o<t;++o)n[o-e]=o;return n},Fne=Nne((e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(n=>t[n]).map(e)),Bne=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if(!n.length)return zne;var u=n.reverse(),d=u[0],g=u.slice(1);return function(){return g.reduce((i,E)=>E(i),d(...arguments))}};function w4(e){var t;return e===0?t=1:t=Math.floor(new es(e).abs().log(10).toNumber())+1,t}function S4(e,t,n){for(var o=new es(e),u=0,d=[];o.lt(t)&&u<1e5;)d.push(o.toNumber()),o=o.add(n),u++;return d}var T4=e=>{var[t,n]=e,[o,u]=[t,n];return t>n&&([o,u]=[n,t]),[o,u]},E4=(e,t,n)=>{if(e.lte(0))return new es(0);var o=w4(e.toNumber()),u=new es(10).pow(o),d=e.div(u),g=o!==1?.05:.1,i=new es(Math.ceil(d.div(g).toNumber())).add(n).mul(g),E=i.mul(u);return t?new es(E.toNumber()):new es(Math.ceil(E.toNumber()))},Une=(e,t,n)=>{var o=new es(1),u=new es(e);if(!u.isint()&&n){var d=Math.abs(e);d<1?(o=new es(10).pow(w4(e)-1),u=new es(Math.floor(u.div(o).toNumber())).mul(o)):d>1&&(u=new es(Math.floor(e)))}else e===0?u=new es(Math.floor((t-1)/2)):n||(u=new es(Math.floor(e)));var g=Math.floor((t-1)/2),i=Bne(Fne(E=>u.add(new es(E-g).mul(o)).toNumber()),PA);return i(0,t)},A4=function(t,n,o,u){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-t)/(o-1)))return{step:new es(0),tickMin:new es(0),tickMax:new es(0)};var g=E4(new es(n).sub(t).div(o-1),u,d),i;t<=0&&n>=0?i=new es(0):(i=new es(t).add(n).div(2),i=i.sub(new es(i).mod(g)));var E=Math.ceil(i.sub(t).div(g).toNumber()),P=Math.ceil(new es(n).sub(i).div(g).toNumber()),I=E+P+1;return I>o?A4(t,n,o,u,d+1):(I<o&&(P=n>0?P+(o-I):P,E=n>0?E:E+(o-I)),{step:g,tickMin:i.sub(new es(E).mul(g)),tickMax:i.add(new es(P).mul(g))})},Vne=function(t){var[n,o]=t,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,g=Math.max(u,2),[i,E]=T4([n,o]);if(i===-1/0||E===1/0){var P=E===1/0?[i,...PA(0,u-1).map(()=>1/0)]:[...PA(0,u-1).map(()=>-1/0),E];return n>o?P.reverse():P}if(i===E)return Une(i,u,d);var{step:I,tickMin:D,tickMax:F}=A4(i,E,g,d,0),$=S4(D,F.add(new es(.1).mul(I)),I);return n>o?$.reverse():$},$ne=function(t,n){var[o,u]=t,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[g,i]=T4([o,u]);if(g===-1/0||i===1/0)return[o,u];if(g===i)return[g];var E=Math.max(n,2),P=E4(new es(i).sub(g).div(E-1),d,0),I=[...S4(new es(g),new es(i),P),i];return d===!1&&(I=I.map(D=>Math.round(D))),o>u?I.reverse():I},Hne=e=>e.rootProps.barCategoryGap,Jx=e=>e.rootProps.stackOffset,C4=e=>e.rootProps.reverseStackOrder,lP=e=>e.options.chartName,cP=e=>e.rootProps.syncId,P4=e=>e.rootProps.syncMethod,uP=e=>e.options.eventEmitter,Mh={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},np={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},Rc={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},Hw=(e,t)=>{if(!(!e||!t))return e!=null&&e.reversed?[t[1],t[0]]:t},Gne={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:np.angleAxisId,includeHidden:!1,name:void 0,reversed:np.reversed,scale:np.scale,tick:np.tick,tickCount:void 0,ticks:void 0,type:np.type,unit:void 0},Wne={allowDataOverflow:Rc.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Rc.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Rc.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Rc.scale,tick:Rc.tick,tickCount:Rc.tickCount,ticks:void 0,type:Rc.type,unit:void 0},qne={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:np.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:np.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:np.scale,tick:np.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},Zne={allowDataOverflow:Rc.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Rc.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Rc.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Rc.scale,tick:Rc.tick,tickCount:Rc.tickCount,ticks:void 0,type:"category",unit:void 0},hP=(e,t)=>e.polarAxis.angleAxis[t]!=null?e.polarAxis.angleAxis[t]:e.layout.layoutType==="radial"?qne:Gne,dP=(e,t)=>e.polarAxis.radiusAxis[t]!=null?e.polarAxis.radiusAxis[t]:e.layout.layoutType==="radial"?Zne:Wne,Gw=e=>e.polarOptions,fP=Ht([xp,bp,ca],A5),I4=Ht([Gw,fP],(e,t)=>{if(e!=null)return Lc(e.innerRadius,t,0)}),M4=Ht([Gw,fP],(e,t)=>{if(e!=null)return Lc(e.outerRadius,t,t*.8)}),Xne=e=>{if(e==null)return[0,0];var{startAngle:t,endAngle:n}=e;return[t,n]},k4=Ht([Gw],Xne);Ht([hP,k4],Hw);var R4=Ht([fP,I4,M4],(e,t,n)=>{if(!(e==null||t==null||n==null))return[t,n]});Ht([dP,R4],Hw);var O4=Ht([bs,Gw,I4,M4,xp,bp],(e,t,n,o,u,d)=>{if(!(e!=="centric"&&e!=="radial"||t==null||n==null||o==null)){var{cx:g,cy:i,startAngle:E,endAngle:P}=t;return{cx:Lc(g,u,u/2),cy:Lc(i,d,d/2),innerRadius:n,outerRadius:o,startAngle:E,endAngle:P,clockWise:!1}}}),Ls=(e,t)=>t,Qx=(e,t,n)=>n;function D4(e){return e==null?void 0:e.id}function L4(e,t,n){var{chartData:o=[]}=t,{allowDuplicatedCategory:u,dataKey:d}=n,g=new Map;return e.forEach(i=>{var E,P=(E=i.data)!==null&&E!==void 0?E:o;if(!(P==null||P.length===0)){var I=D4(i);P.forEach((D,F)=>{var $=d==null||u?F:String(eo(D,d,null)),Z=eo(D,i.dataKey,0),q;g.has($)?q=g.get($):q={},Object.assign(q,{[I]:Z}),g.set($,q)})}}),Array.from(g.values())}function pP(e){return"stackId"in e&&e.stackId!=null&&e.dataKey!=null}var Ww=(e,t)=>e===t?!0:e==null||t==null?!1:e[0]===t[0]&&e[1]===t[1];function qw(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===0&&t.length===0?!0:e===t}function Yne(e,t){if(e.length===t.length){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}var Xo=e=>{var t=bs(e);return t==="horizontal"?"xAxis":t==="vertical"?"yAxis":t==="centric"?"angleAxis":"radiusAxis"},jy=e=>e.tooltip.settings.axisId;function Yj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function F1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yj(Object(n),!0).forEach(function(o){Kne(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yj(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Kne(e,t,n){return(t=Jne(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jne(e){var t=Qne(e,"string");return typeof t=="symbol"?t:t+""}function Qne(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var IA=[0,"auto"],ere={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},tre=(e,t)=>e.cartesianAxis.xAxis[t],Nm=(e,t)=>{var n=tre(e,t);return n??ere},nre={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:IA,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:Wx},rre=(e,t)=>e.cartesianAxis.yAxis[t],Fm=(e,t)=>{var n=rre(e,t);return n??nre},ire={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},mP=(e,t)=>{var n=e.cartesianAxis.zAxis[t];return n??ire},$s=(e,t,n)=>{switch(t){case"xAxis":return Nm(e,n);case"yAxis":return Fm(e,n);case"zAxis":return mP(e,n);case"angleAxis":return hP(e,n);case"radiusAxis":return dP(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},sre=(e,t,n)=>{switch(t){case"xAxis":return Nm(e,n);case"yAxis":return Fm(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},e0=(e,t,n)=>{switch(t){case"xAxis":return Nm(e,n);case"yAxis":return Fm(e,n);case"angleAxis":return hP(e,n);case"radiusAxis":return dP(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},j4=e=>e.graphicalItems.cartesianItems.some(t=>t.type==="bar")||e.graphicalItems.polarItems.some(t=>t.type==="radialBar");function gP(e,t){return n=>{switch(e){case"xAxis":return"xAxisId"in n&&n.xAxisId===t;case"yAxis":return"yAxisId"in n&&n.yAxisId===t;case"zAxis":return"zAxisId"in n&&n.zAxisId===t;case"angleAxis":return"angleAxisId"in n&&n.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in n&&n.radiusAxisId===t;default:return!1}}}var ore=e=>e.graphicalItems.cartesianItems,are=Ht([Ls,Qx],gP),_P=(e,t,n)=>e.filter(n).filter(o=>(t==null?void 0:t.includeHidden)===!0?!0:!o.hide),t0=Ht([ore,$s,are],_P,{memoizeOptions:{resultEqualityCheck:qw}}),z4=Ht([t0],e=>e.filter(t=>t.type==="area"||t.type==="bar").filter(pP)),N4=e=>e.filter(t=>!("stackId"in t)||t.stackId===void 0),lre=Ht([t0],N4),yP=e=>e.map(t=>t.data).filter(Boolean).flat(1),cre=Ht([t0],yP,{memoizeOptions:{resultEqualityCheck:qw}}),vP=(e,t)=>{var{chartData:n=[],dataStartIndex:o,dataEndIndex:u}=t;return e.length>0?e:n.slice(o,u+1)},xP=Ht([cre,d4],vP),bP=(e,t,n)=>(t==null?void 0:t.dataKey)!=null?e.map(o=>({value:eo(o,t.dataKey)})):n.length>0?n.map(o=>o.dataKey).flatMap(o=>e.map(u=>({value:eo(u,o)}))):e.map(o=>({value:o})),Zw=Ht([xP,$s,t0],bP);function F4(e,t){switch(e){case"xAxis":return t.direction==="x";case"yAxis":return t.direction==="y";default:return!1}}function Zb(e){if(pp(e)||e instanceof Date){var t=Number(e);if(Do(t))return t}}function Kj(e){if(Array.isArray(e)){var t=[Zb(e[0]),Zb(e[1])];return Im(t)?t:void 0}var n=Zb(e);if(n!=null)return[n,n]}function vp(e){return e.map(Zb).filter(cX)}function ure(e,t,n){return!n||typeof t!="number"||dp(t)?[]:n.length?vp(n.flatMap(o=>{var u=eo(e,o.dataKey),d,g;if(Array.isArray(u)?[d,g]=u:d=g=u,!(!Do(d)||!Do(g)))return[t-d,t+g]})):[]}var Yo=e=>{var t=Xo(e),n=jy(e);return e0(e,t,n)},n0=Ht([Yo],e=>e==null?void 0:e.dataKey),hre=Ht([z4,d4,Yo],L4),B4=(e,t,n,o)=>{var u={},d=t.reduce((g,i)=>{if(i.stackId==null)return g;var E=g[i.stackId];return E==null&&(E=[]),E.push(i),g[i.stackId]=E,g},u);return Object.fromEntries(Object.entries(d).map(g=>{var[i,E]=g,P=o?[...E].reverse():E,I=P.map(D4);return[i,{stackedData:IK(e,I,n),graphicalItems:P}]}))},dre=Ht([hre,z4,Jx,C4],B4),U4=(e,t,n,o)=>{var{dataStartIndex:u,dataEndIndex:d}=t;if(o==null&&n!=="zAxis"){var g=RK(e,u,d);if(!(g!=null&&g[0]===0&&g[1]===0))return g}},fre=Ht([$s],e=>e.allowDataOverflow),wP=e=>{var t;if(e==null||!("domain"in e))return IA;if(e.domain!=null)return e.domain;if("ticks"in e&&e.ticks!=null){if(e.type==="number"){var n=vp(e.ticks);return[Math.min(...n),Math.max(...n)]}if(e.type==="category")return e.ticks.map(String)}return(t=e==null?void 0:e.domain)!==null&&t!==void 0?t:IA},SP=Ht([$s],wP),TP=Ht([SP,fre],f4),pre=Ht([dre,zm,Ls,TP],U4,{memoizeOptions:{resultEqualityCheck:Ww}}),Xw=e=>e.errorBars,mre=(e,t,n)=>e.flatMap(o=>t[o.id]).filter(Boolean).filter(o=>F4(n,o)),B1=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var u=n.filter(Boolean);if(u.length!==0){var d=u.flat(),g=Math.min(...d),i=Math.max(...d);return[g,i]}},EP=(e,t,n,o,u)=>{var d,g;if(n.length>0&&e.forEach(i=>{n.forEach(E=>{var P,I,D=(P=o[E.id])===null||P===void 0?void 0:P.filter(re=>F4(u,re)),F=eo(i,(I=t.dataKey)!==null&&I!==void 0?I:E.dataKey),$=ure(i,F,D);if($.length>=2){var Z=Math.min(...$),q=Math.max(...$);(d==null||Z<d)&&(d=Z),(g==null||q>g)&&(g=q)}var X=Kj(F);X!=null&&(d=d==null?X[0]:Math.min(d,X[0]),g=g==null?X[1]:Math.max(g,X[1]))})}),(t==null?void 0:t.dataKey)!=null&&e.forEach(i=>{var E=Kj(eo(i,t.dataKey));E!=null&&(d=d==null?E[0]:Math.min(d,E[0]),g=g==null?E[1]:Math.max(g,E[1]))}),Do(d)&&Do(g))return[d,g]},gre=Ht([xP,$s,lre,Xw,Ls],EP,{memoizeOptions:{resultEqualityCheck:Ww}});function _re(e){var{value:t}=e;if(pp(t)||t instanceof Date)return t}var yre=(e,t,n)=>{var o=e.map(_re).filter(u=>u!=null);return n&&(t.dataKey==null||t.allowDuplicatedCategory&&dB(o))?M5(0,e.length):t.allowDuplicatedCategory?o:Array.from(new Set(o))},V4=e=>e.referenceElements.dots,zy=(e,t,n)=>e.filter(o=>o.ifOverflow==="extendDomain").filter(o=>t==="xAxis"?o.xAxisId===n:o.yAxisId===n),vre=Ht([V4,Ls,Qx],zy),$4=e=>e.referenceElements.areas,xre=Ht([$4,Ls,Qx],zy),H4=e=>e.referenceElements.lines,bre=Ht([H4,Ls,Qx],zy),G4=(e,t)=>{if(e!=null){var n=vp(e.map(o=>t==="xAxis"?o.x:o.y));if(n.length!==0)return[Math.min(...n),Math.max(...n)]}},wre=Ht(vre,Ls,G4),W4=(e,t)=>{if(e!=null){var n=vp(e.flatMap(o=>[t==="xAxis"?o.x1:o.y1,t==="xAxis"?o.x2:o.y2]));if(n.length!==0)return[Math.min(...n),Math.max(...n)]}},Sre=Ht([xre,Ls],W4);function Tre(e){var t;if(e.x!=null)return vp([e.x]);var n=(t=e.segment)===null||t===void 0?void 0:t.map(o=>o.x);return n==null||n.length===0?[]:vp(n)}function Ere(e){var t;if(e.y!=null)return vp([e.y]);var n=(t=e.segment)===null||t===void 0?void 0:t.map(o=>o.y);return n==null||n.length===0?[]:vp(n)}var q4=(e,t)=>{if(e!=null){var n=e.flatMap(o=>t==="xAxis"?Tre(o):Ere(o));if(n.length!==0)return[Math.min(...n),Math.max(...n)]}},Are=Ht([bre,Ls],q4),Cre=Ht(wre,Are,Sre,(e,t,n)=>B1(e,n,t)),AP=(e,t,n,o,u,d,g,i)=>{if(n!=null)return n;var E=g==="vertical"&&i==="xAxis"||g==="horizontal"&&i==="yAxis",P=E?B1(o,d,u):B1(d,u);return One(t,P,e.allowDataOverflow)},Pre=Ht([$s,SP,TP,pre,gre,Cre,bs,Ls],AP,{memoizeOptions:{resultEqualityCheck:Ww}}),Ire=[0,1],CP=(e,t,n,o,u,d,g)=>{if(!((e==null||n==null||n.length===0)&&g===void 0)){var{dataKey:i,type:E}=e,P=a_(t,d);if(P&&i==null){var I;return M5(0,(I=n==null?void 0:n.length)!==null&&I!==void 0?I:0)}return E==="category"?yre(o,e,P):u==="expand"?Ire:g}},PP=Ht([$s,bs,xP,Zw,Jx,Ls,Pre],CP),Z4=(e,t,n,o,u)=>{if(e!=null){var{scale:d,type:g}=e;if(d==="auto")return t==="radial"&&u==="radiusAxis"?"band":t==="radial"&&u==="angleAxis"?"linear":g==="category"&&o&&(o.indexOf("LineChart")>=0||o.indexOf("AreaChart")>=0||o.indexOf("ComposedChart")>=0&&!n)?"point":g==="category"?"band":"linear";if(typeof d=="string"){var i="scale".concat(Vx(d));return i in Xv?i:"point"}}},Ny=Ht([$s,bs,j4,lP,Ls],Z4);function Mre(e){if(e!=null){if(e in Xv)return Xv[e]();var t="scale".concat(Vx(e));if(t in Xv)return Xv[t]()}}function IP(e,t,n,o){if(!(n==null||o==null)){if(typeof e.scale=="function")return e.scale.copy().domain(n).range(o);var u=Mre(t);if(u!=null){var d=u.domain(n).range(o);return EK(d),d}}}var MP=(e,t,n)=>{var o=wP(t);if(!(n!=="auto"&&n!=="linear")){if(t!=null&&t.tickCount&&Array.isArray(o)&&(o[0]==="auto"||o[1]==="auto")&&Im(e))return Vne(e,t.tickCount,t.allowDecimals);if(t!=null&&t.tickCount&&t.type==="number"&&Im(e))return $ne(e,t.tickCount,t.allowDecimals)}},kP=Ht([PP,e0,Ny],MP),RP=(e,t,n,o)=>{if(o!=="angleAxis"&&(e==null?void 0:e.type)==="number"&&Im(t)&&Array.isArray(n)&&n.length>0){var u=t[0],d=n[0],g=t[1],i=n[n.length-1];return[Math.min(u,d),Math.max(g,i)]}return t},kre=Ht([$s,PP,kP,Ls],RP),Rre=Ht(Zw,$s,(e,t)=>{if(!(!t||t.type!=="number")){var n=1/0,o=Array.from(vp(e.map(D=>D.value))).sort((D,F)=>D-F),u=o[0],d=o[o.length-1];if(u==null||d==null)return 1/0;var g=d-u;if(g===0)return 1/0;for(var i=0;i<o.length-1;i++){var E=o[i],P=o[i+1];if(!(E==null||P==null)){var I=P-E;n=Math.min(n,I)}}return n/g}}),X4=Ht(Rre,bs,Hne,ca,(e,t,n,o,u)=>u,(e,t,n,o,u)=>{if(!Do(e))return 0;var d=t==="vertical"?o.height:o.width;if(u==="gap")return e*d/2;if(u==="no-gap"){var g=Lc(n,e*d),i=e*d/2;return i-g-(i-g)/d*g}return 0}),Ore=(e,t,n)=>{var o=Nm(e,t);return o==null||typeof o.padding!="string"?0:X4(e,"xAxis",t,n,o.padding)},Dre=(e,t,n)=>{var o=Fm(e,t);return o==null||typeof o.padding!="string"?0:X4(e,"yAxis",t,n,o.padding)},Lre=Ht(Nm,Ore,(e,t)=>{var n,o;if(e==null)return{left:0,right:0};var{padding:u}=e;return typeof u=="string"?{left:t,right:t}:{left:((n=u.left)!==null&&n!==void 0?n:0)+t,right:((o=u.right)!==null&&o!==void 0?o:0)+t}}),jre=Ht(Fm,Dre,(e,t)=>{var n,o;if(e==null)return{top:0,bottom:0};var{padding:u}=e;return typeof u=="string"?{top:t,bottom:t}:{top:((n=u.top)!==null&&n!==void 0?n:0)+t,bottom:((o=u.bottom)!==null&&o!==void 0?o:0)+t}}),zre=Ht([ca,Lre,kw,Mw,(e,t,n)=>n],(e,t,n,o,u)=>{var{padding:d}=o;return u?[d.left,n.width-d.right]:[e.left+t.left,e.left+e.width-t.right]}),Nre=Ht([ca,bs,jre,kw,Mw,(e,t,n)=>n],(e,t,n,o,u,d)=>{var{padding:g}=u;return d?[o.height-g.bottom,g.top]:t==="horizontal"?[e.top+e.height-n.bottom,e.top+n.top]:[e.top+n.top,e.top+e.height-n.bottom]}),r0=(e,t,n,o)=>{var u;switch(t){case"xAxis":return zre(e,n,o);case"yAxis":return Nre(e,n,o);case"zAxis":return(u=mP(e,n))===null||u===void 0?void 0:u.range;case"angleAxis":return k4(e);case"radiusAxis":return R4(e,n);default:return}},Y4=Ht([$s,r0],Hw),Yw=Ht([$s,Ny,kre,Y4],IP);Ht([t0,Xw,Ls],mre);function K4(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var Kw=(e,t)=>t,Jw=(e,t,n)=>n,Fre=Ht(Pw,Kw,Jw,(e,t,n)=>e.filter(o=>o.orientation===t).filter(o=>o.mirror===n).sort(K4)),Bre=Ht(Iw,Kw,Jw,(e,t,n)=>e.filter(o=>o.orientation===t).filter(o=>o.mirror===n).sort(K4)),J4=(e,t)=>({width:e.width,height:t.height}),Ure=(e,t)=>{var n=typeof t.width=="number"?t.width:Wx;return{width:n,height:e.height}};Ht(ca,Nm,J4);var Vre=(e,t,n)=>{switch(t){case"top":return e.top;case"bottom":return n-e.bottom;default:return 0}},$re=(e,t,n)=>{switch(t){case"left":return e.left;case"right":return n-e.right;default:return 0}},Hre=Ht(bp,ca,Fre,Kw,Jw,(e,t,n,o,u)=>{var d={},g;return n.forEach(i=>{var E=J4(t,i);g==null&&(g=Vre(t,o,e));var P=o==="top"&&!u||o==="bottom"&&u;d[i.id]=g-Number(P)*E.height,g+=(P?-1:1)*E.height}),d}),Gre=Ht(xp,ca,Bre,Kw,Jw,(e,t,n,o,u)=>{var d={},g;return n.forEach(i=>{var E=Ure(t,i);g==null&&(g=$re(t,o,e));var P=o==="left"&&!u||o==="right"&&u;d[i.id]=g-Number(P)*E.width,g+=(P?-1:1)*E.width}),d}),Wre=(e,t)=>{var n=Nm(e,t);if(n!=null)return Hre(e,n.orientation,n.mirror)};Ht([ca,Nm,Wre,(e,t)=>t],(e,t,n,o)=>{if(t!=null){var u=n==null?void 0:n[o];return u==null?{x:e.left,y:0}:{x:e.left,y:u}}});var qre=(e,t)=>{var n=Fm(e,t);if(n!=null)return Gre(e,n.orientation,n.mirror)};Ht([ca,Fm,qre,(e,t)=>t],(e,t,n,o)=>{if(t!=null){var u=n==null?void 0:n[o];return u==null?{x:0,y:e.top}:{x:u,y:e.top}}});Ht(ca,Fm,(e,t)=>{var n=typeof t.width=="number"?t.width:Wx;return{width:n,height:e.height}});var Q4=(e,t,n,o)=>{if(n!=null){var{allowDuplicatedCategory:u,type:d,dataKey:g}=n,i=a_(e,o),E=t.map(P=>P.value);if(g&&i&&d==="category"&&u&&dB(E))return E}},OP=Ht([bs,Zw,$s,Ls],Q4),eU=(e,t,n,o)=>{if(!(n==null||n.dataKey==null)){var{type:u,scale:d}=n,g=a_(e,o);if(g&&(u==="number"||d!=="auto"))return t.map(i=>i.value)}},DP=Ht([bs,Zw,e0,Ls],eU);Ht([bs,sre,Ny,Yw,OP,DP,r0,kP,Ls],(e,t,n,o,u,d,g,i,E)=>{if(t!=null){var P=a_(e,E);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:E,categoricalDomain:d,duplicateDomain:u,isCategorical:P,niceTicks:i,range:g,realScaleType:n,scale:o}}});var Zre=(e,t,n,o,u,d,g,i,E)=>{if(!(t==null||o==null)){var P=a_(e,E),{type:I,ticks:D,tickCount:F}=t,$=n==="scaleBand"&&typeof o.bandwidth=="function"?o.bandwidth()/2:2,Z=I==="category"&&o.bandwidth?o.bandwidth()/$:0;Z=E==="angleAxis"&&d!=null&&d.length>=2?tc(d[0]-d[1])*2*Z:Z;var q=D||u;if(q){var X=q.map((re,le)=>{var ue=g?g.indexOf(re):re;return{index:le,coordinate:o(ue)+Z,value:re,offset:Z}});return X.filter(re=>Do(re.coordinate))}return P&&i?i.map((re,le)=>({coordinate:o(re)+Z,value:re,index:le,offset:Z})).filter(re=>Do(re.coordinate)):o.ticks?o.ticks(F).map(re=>({coordinate:o(re)+Z,value:re,offset:Z})):o.domain().map((re,le)=>({coordinate:o(re)+Z,value:g?g[re]:re,index:le,offset:Z}))}};Ht([bs,e0,Ny,Yw,kP,r0,OP,DP,Ls],Zre);var Xre=(e,t,n,o,u,d,g)=>{if(!(t==null||n==null||o==null||o[0]===o[1])){var i=a_(e,g),{tickCount:E}=t,P=0;return P=g==="angleAxis"&&(o==null?void 0:o.length)>=2?tc(o[0]-o[1])*2*P:P,i&&d?d.map((I,D)=>({coordinate:n(I)+P,value:I,index:D,offset:P})):n.ticks?n.ticks(E).map(I=>({coordinate:n(I)+P,value:I,offset:P})):n.domain().map((I,D)=>({coordinate:n(I)+P,value:u?u[I]:I,index:D,offset:P}))}};Ht([bs,e0,Yw,r0,OP,DP,Ls],Xre);Ht($s,Yw,(e,t)=>{if(!(e==null||t==null))return F1(F1({},e),{},{scale:t})});var Yre=Ht([$s,Ny,PP,Y4],IP);Ht((e,t,n)=>mP(e,n),Yre,(e,t)=>{if(!(e==null||t==null))return F1(F1({},e),{},{scale:t})});var Kre=Ht([bs,Pw,Iw],(e,t,n)=>{switch(e){case"horizontal":return t.some(o=>o.reversed)?"right-to-left":"left-to-right";case"vertical":return n.some(o=>o.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),tU=e=>e.options.defaultTooltipEventType,nU=e=>e.options.validateTooltipEventTypes;function rU(e,t,n){if(e==null)return t;var o=e?"axis":"item";return n==null?t:n.includes(o)?o:t}function LP(e,t){var n=tU(e),o=nU(e);return rU(t,n,o)}function Jre(e){return ii(t=>LP(t,e))}var iU=(e,t)=>{var n,o=Number(t);if(!(dp(o)||t==null))return o>=0?e==null||(n=e[o])===null||n===void 0?void 0:n.value:void 0},Qre=e=>e.tooltip.settings,gm={active:!1,index:null,dataKey:void 0,graphicalItemId:void 0,coordinate:void 0},eie={itemInteraction:{click:gm,hover:gm},axisInteraction:{click:gm,hover:gm},keyboardInteraction:gm,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0,graphicalItemId:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},sU=oc({name:"tooltip",initialState:eie,reducers:{addTooltipEntrySettings:{reducer(e,t){e.tooltipItemPayloads.push(t.payload)},prepare:Ms()},replaceTooltipEntrySettings:{reducer(e,t){var{prev:n,next:o}=t.payload,u=Rh(e).tooltipItemPayloads.indexOf(n);u>-1&&(e.tooltipItemPayloads[u]=o)},prepare:Ms()},removeTooltipEntrySettings:{reducer(e,t){var n=Rh(e).tooltipItemPayloads.indexOf(t.payload);n>-1&&e.tooltipItemPayloads.splice(n,1)},prepare:Ms()},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate}}}),{addTooltipEntrySettings:tie,replaceTooltipEntrySettings:nie,removeTooltipEntrySettings:rie,setTooltipSettingsState:iie,setActiveMouseOverItemIndex:oU,mouseLeaveItem:sie,mouseLeaveChart:aU,setActiveClickItemIndex:oie,setMouseOverAxisIndex:lU,setMouseClickAxisIndex:aie,setSyncInteraction:MA,setKeyboardInteraction:kA}=sU.actions,lie=sU.reducer;function Jj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function gb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jj(Object(n),!0).forEach(function(o){cie(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jj(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function cie(e,t,n){return(t=uie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uie(e){var t=hie(e,"string");return typeof t=="symbol"?t:t+""}function hie(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function die(e,t,n){return t==="axis"?n==="click"?e.axisInteraction.click:e.axisInteraction.hover:n==="click"?e.itemInteraction.click:e.itemInteraction.hover}function fie(e){return e.index!=null}var cU=(e,t,n,o)=>{if(t==null)return gm;var u=die(e,t,n);if(u==null)return gm;if(u.active)return u;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&e.syncInteraction.index!=null)return e.syncInteraction;var d=e.settings.active===!0;if(fie(u)){if(d)return gb(gb({},u),{},{active:!0})}else if(o!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:o,graphicalItemId:void 0};return gb(gb({},gm),{},{coordinate:u.coordinate})};function pie(e){if(typeof e=="number")return Number.isFinite(e)?e:void 0;if(e instanceof Date){var t=e.valueOf();return Number.isFinite(t)?t:void 0}var n=Number(e);return Number.isFinite(n)?n:void 0}function mie(e,t){var n=pie(e),o=t[0],u=t[1];if(n===void 0)return!1;var d=Math.min(o,u),g=Math.max(o,u);return n>=d&&n<=g}function gie(e,t,n){if(n==null||t==null)return!0;var o=eo(e,t);return o==null||!Im(n)?!0:mie(o,n)}var jP=(e,t,n,o)=>{var u=e==null?void 0:e.index;if(u==null)return null;var d=Number(u);if(!Do(d))return u;var g=0,i=1/0;t.length>0&&(i=t.length-1);var E=Math.max(g,Math.min(d,i)),P=t[E];return P==null||gie(P,n,o)?String(E):null},uU=(e,t,n,o,u,d,g,i)=>{if(!(d==null||i==null)){var E=g[0],P=E==null?void 0:i(E.positions,d);if(P!=null)return P;var I=u==null?void 0:u[Number(d)];if(I)switch(n){case"horizontal":return{x:I.coordinate,y:(o.top+t)/2};default:return{x:(o.left+e)/2,y:I.coordinate}}}},hU=(e,t,n,o)=>{if(t==="axis")return e.tooltipItemPayloads;if(e.tooltipItemPayloads.length===0)return[];var u;if(n==="hover"?u=e.itemInteraction.hover.graphicalItemId:u=e.itemInteraction.click.graphicalItemId,u==null&&o!=null){var d=e.tooltipItemPayloads[0];return d!=null?[d]:[]}return e.tooltipItemPayloads.filter(g=>{var i;return((i=g.settings)===null||i===void 0?void 0:i.graphicalItemId)===u})},i0=e=>e.options.tooltipPayloadSearcher,Fy=e=>e.tooltip;function Qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function ez(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qj(Object(n),!0).forEach(function(o){_ie(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qj(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function _ie(e,t,n){return(t=yie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yie(e){var t=vie(e,"string");return typeof t=="symbol"?t:t+""}function vie(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xie(e,t){return e??t}var dU=(e,t,n,o,u,d,g)=>{if(!(t==null||d==null)){var{chartData:i,computedData:E,dataStartIndex:P,dataEndIndex:I}=n,D=[];return e.reduce((F,$)=>{var Z,{dataDefinedOnItem:q,settings:X}=$,re=xie(q,i),le=Array.isArray(re)?i5(re,P,I):re,ue=(Z=X==null?void 0:X.dataKey)!==null&&Z!==void 0?Z:o,ye=X==null?void 0:X.nameKey,ge;if(o&&Array.isArray(le)&&!Array.isArray(le[0])&&g==="axis"?ge=lX(le,o,u):ge=d(le,t,E,ye),Array.isArray(ge))ge.forEach(Le=>{var Ze=ez(ez({},X),{},{name:Le.name,unit:Le.unit,color:void 0,fill:void 0});F.push(iL({tooltipEntrySettings:Ze,dataKey:Le.dataKey,payload:Le.payload,value:eo(Le.payload,Le.dataKey),name:Le.name}))});else{var we;F.push(iL({tooltipEntrySettings:X,dataKey:ue,payload:ge,value:eo(ge,ue),name:(we=eo(ge,ye))!==null&&we!==void 0?we:X==null?void 0:X.name}))}return F},D)}},zP=Ht([Yo,bs,j4,lP,Xo],Z4),bie=Ht([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),wie=Ht([Xo,jy],gP),By=Ht([bie,Yo,wie],_P,{memoizeOptions:{resultEqualityCheck:qw}}),Sie=Ht([By],e=>e.filter(pP)),Tie=Ht([By],yP,{memoizeOptions:{resultEqualityCheck:qw}}),Uy=Ht([Tie,zm],vP),Eie=Ht([Sie,zm,Yo],L4),NP=Ht([Uy,Yo,By],bP),fU=Ht([Yo],wP),Aie=Ht([Yo],e=>e.allowDataOverflow),pU=Ht([fU,Aie],f4),Cie=Ht([By],e=>e.filter(pP)),Pie=Ht([Eie,Cie,Jx,C4],B4),Iie=Ht([Pie,zm,Xo,pU],U4),Mie=Ht([By],N4),kie=Ht([Uy,Yo,Mie,Xw,Xo],EP,{memoizeOptions:{resultEqualityCheck:Ww}}),Rie=Ht([V4,Xo,jy],zy),Oie=Ht([Rie,Xo],G4),Die=Ht([$4,Xo,jy],zy),Lie=Ht([Die,Xo],W4),jie=Ht([H4,Xo,jy],zy),zie=Ht([jie,Xo],q4),Nie=Ht([Oie,zie,Lie],B1),Fie=Ht([Yo,fU,pU,Iie,kie,Nie,bs,Xo],AP),s0=Ht([Yo,bs,Uy,NP,Jx,Xo,Fie],CP),Bie=Ht([s0,Yo,zP],MP),Uie=Ht([Yo,s0,Bie,Xo],RP),mU=e=>{var t=Xo(e),n=jy(e),o=!1;return r0(e,t,n,o)},gU=Ht([Yo,mU],Hw),_U=Ht([Yo,zP,Uie,gU],IP),Vie=Ht([bs,NP,Yo,Xo],Q4),$ie=Ht([bs,NP,Yo,Xo],eU),Hie=(e,t,n,o,u,d,g,i)=>{if(t){var{type:E}=t,P=a_(e,i);if(o){var I=n==="scaleBand"&&o.bandwidth?o.bandwidth()/2:2,D=E==="category"&&o.bandwidth?o.bandwidth()/I:0;return D=i==="angleAxis"&&u!=null&&(u==null?void 0:u.length)>=2?tc(u[0]-u[1])*2*D:D,P&&g?g.map((F,$)=>({coordinate:o(F)+D,value:F,index:$,offset:D})):o.domain().map((F,$)=>({coordinate:o(F)+D,value:d?d[F]:F,index:$,offset:D}))}}},Sp=Ht([bs,Yo,zP,_U,mU,Vie,$ie,Xo],Hie),FP=Ht([tU,nU,Qre],(e,t,n)=>rU(n.shared,e,t)),yU=e=>e.tooltip.settings.trigger,BP=e=>e.tooltip.settings.defaultIndex,o0=Ht([Fy,FP,yU,BP],cU),Ax=Ht([o0,Uy,n0,s0],jP),vU=Ht([Sp,Ax],iU),xU=Ht([o0],e=>{if(e)return e.dataKey}),Gie=Ht([o0],e=>{if(e)return e.graphicalItemId}),bU=Ht([Fy,FP,yU,BP],hU),Wie=Ht([xp,bp,bs,ca,Sp,BP,bU,i0],uU),qie=Ht([o0,Wie],(e,t)=>e!=null&&e.coordinate?e.coordinate:t),Zie=Ht([o0],e=>{var t;return(t=e==null?void 0:e.active)!==null&&t!==void 0?t:!1}),Xie=Ht([bU,Ax,zm,n0,vU,i0,FP],dU);Ht([Xie],e=>{if(e!=null){var t=e.map(n=>n.payload).filter(n=>n!=null);return Array.from(new Set(t))}});function tz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function nz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tz(Object(n),!0).forEach(function(o){Yie(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Yie(e,t,n){return(t=Kie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kie(e){var t=Jie(e,"string");return typeof t=="symbol"?t:t+""}function Jie(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Qie=()=>ii(Yo),ese=()=>{var e=Qie(),t=ii(Sp),n=ii(_U);return rL(!e||!n?void 0:nz(nz({},e),{},{scale:n}),t)};function rz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function J_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rz(Object(n),!0).forEach(function(o){tse(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function tse(e,t,n){return(t=nse(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nse(e){var t=rse(e,"string");return typeof t=="symbol"?t:t+""}function rse(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ise=(e,t,n,o)=>{var u=t.find(d=>d&&d.index===n);if(u){if(e==="horizontal")return{x:u.coordinate,y:o.chartY};if(e==="vertical")return{x:o.chartX,y:u.coordinate}}return{x:0,y:0}},sse=(e,t,n,o)=>{var u=t.find(P=>P&&P.index===n);if(u){if(e==="centric"){var d=u.coordinate,{radius:g}=o;return J_(J_(J_({},o),ko(o.cx,o.cy,g,d)),{},{angle:d,radius:g})}var i=u.coordinate,{angle:E}=o;return J_(J_(J_({},o),ko(o.cx,o.cy,i,E)),{},{angle:E,radius:i})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}};function ose(e,t){var{chartX:n,chartY:o}=e;return n>=t.left&&n<=t.left+t.width&&o>=t.top&&o<=t.top+t.height}var wU=(e,t,n,o,u)=>{var d,g=(d=t==null?void 0:t.length)!==null&&d!==void 0?d:0;if(g<=1||e==null)return 0;if(o==="angleAxis"&&u!=null&&Math.abs(Math.abs(u[1]-u[0])-360)<=1e-6)for(var i=0;i<g;i++){var E,P,I,D,F,$=i>0?(E=n[i-1])===null||E===void 0?void 0:E.coordinate:(P=n[g-1])===null||P===void 0?void 0:P.coordinate,Z=(I=n[i])===null||I===void 0?void 0:I.coordinate,q=i>=g-1?(D=n[0])===null||D===void 0?void 0:D.coordinate:(F=n[i+1])===null||F===void 0?void 0:F.coordinate,X=void 0;if(!($==null||Z==null||q==null))if(tc(Z-$)!==tc(q-Z)){var re=[];if(tc(q-Z)===tc(u[1]-u[0])){X=q;var le=Z+u[1]-u[0];re[0]=Math.min(le,(le+$)/2),re[1]=Math.max(le,(le+$)/2)}else{X=$;var ue=q+u[1]-u[0];re[0]=Math.min(Z,(ue+Z)/2),re[1]=Math.max(Z,(ue+Z)/2)}var ye=[Math.min(Z,(X+Z)/2),Math.max(Z,(X+Z)/2)];if(e>ye[0]&&e<=ye[1]||e>=re[0]&&e<=re[1]){var ge;return(ge=n[i])===null||ge===void 0?void 0:ge.index}}else{var we=Math.min($,q),Le=Math.max($,q);if(e>(we+Z)/2&&e<=(Le+Z)/2){var Ze;return(Ze=n[i])===null||Ze===void 0?void 0:Ze.index}}}else if(t)for(var Ge=0;Ge<g;Ge++){var gt=t[Ge];if(gt!=null){var lt=t[Ge+1],qe=t[Ge-1];if(Ge===0&&lt!=null&&e<=(gt.coordinate+lt.coordinate)/2||Ge===g-1&&qe!=null&&e>(gt.coordinate+qe.coordinate)/2||Ge>0&&Ge<g-1&&qe!=null&&lt!=null&&e>(gt.coordinate+qe.coordinate)/2&&e<=(gt.coordinate+lt.coordinate)/2)return gt.index}}return-1},ase=()=>ii(lP),UP=(e,t)=>t,SU=(e,t,n)=>n,VP=(e,t,n,o)=>o,lse=Ht(Sp,e=>yw(e,t=>t.coordinate)),$P=Ht([Fy,UP,SU,VP],cU),HP=Ht([$P,Uy,n0,s0],jP),cse=(e,t,n)=>{if(t!=null){var o=Fy(e);return t==="axis"?n==="hover"?o.axisInteraction.hover.dataKey:o.axisInteraction.click.dataKey:n==="hover"?o.itemInteraction.hover.dataKey:o.itemInteraction.click.dataKey}},TU=Ht([Fy,UP,SU,VP],hU),U1=Ht([xp,bp,bs,ca,Sp,VP,TU,i0],uU),use=Ht([$P,U1],(e,t)=>{var n;return(n=e.coordinate)!==null&&n!==void 0?n:t}),EU=Ht([Sp,HP],iU),hse=Ht([TU,HP,zm,n0,EU,i0,UP],dU),dse=Ht([$P,HP],(e,t)=>({isActive:e.active&&t!=null,activeIndex:t})),fse=(e,t,n,o,u,d,g)=>{if(!(!e||!n||!o||!u)&&ose(e,g)){var i=OK(e,t),E=wU(i,d,u,n,o),P=ise(t,u,E,e);return{activeIndex:String(E),activeCoordinate:P}}},pse=(e,t,n,o,u,d,g)=>{if(!(!e||!o||!u||!d||!n)){var i=VQ(e,n);if(i){var E=DK(i,t),P=wU(E,g,d,o,u),I=sse(t,d,P,i);return{activeIndex:String(P),activeCoordinate:I}}}},mse=(e,t,n,o,u,d,g,i)=>{if(!(!e||!t||!o||!u||!d))return t==="horizontal"||t==="vertical"?fse(e,t,o,u,d,g,i):pse(e,t,n,o,u,d,g)},gse=Ht(e=>e.zIndex.zIndexMap,(e,t)=>t,(e,t,n)=>n,(e,t,n)=>{if(t!=null){var o=e[t];if(o!=null)return n?o.panoramaElement:o.element}}),_se=Ht(e=>e.zIndex.zIndexMap,e=>{var t=Object.keys(e).map(o=>parseInt(o,10)).concat(Object.values(Mh)),n=Array.from(new Set(t));return n.sort((o,u)=>o-u)},{memoizeOptions:{resultEqualityCheck:Yne}});function iz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function sz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iz(Object(n),!0).forEach(function(o){yse(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function yse(e,t,n){return(t=vse(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vse(e){var t=xse(e,"string");return typeof t=="symbol"?t:t+""}function xse(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var bse={},wse={zIndexMap:Object.values(Mh).reduce((e,t)=>sz(sz({},e),{},{[t]:{element:void 0,panoramaElement:void 0,consumers:0}}),bse)},Sse=new Set(Object.values(Mh));function Tse(e){return Sse.has(e)}var AU=oc({name:"zIndex",initialState:wse,reducers:{registerZIndexPortal:{reducer:(e,t)=>{var{zIndex:n}=t.payload;e.zIndexMap[n]?e.zIndexMap[n].consumers+=1:e.zIndexMap[n]={consumers:1,element:void 0,panoramaElement:void 0}},prepare:Ms()},unregisterZIndexPortal:{reducer:(e,t)=>{var{zIndex:n}=t.payload;e.zIndexMap[n]&&(e.zIndexMap[n].consumers-=1,e.zIndexMap[n].consumers<=0&&!Tse(n)&&delete e.zIndexMap[n])},prepare:Ms()},registerZIndexPortalElement:{reducer:(e,t)=>{var{zIndex:n,element:o,isPanorama:u}=t.payload;e.zIndexMap[n]?u?e.zIndexMap[n].panoramaElement=o:e.zIndexMap[n].element=o:e.zIndexMap[n]={consumers:0,element:u?void 0:o,panoramaElement:u?o:void 0}},prepare:Ms()},unregisterZIndexPortalElement:{reducer:(e,t)=>{var{zIndex:n}=t.payload;e.zIndexMap[n]&&(t.payload.isPanorama?e.zIndexMap[n].panoramaElement=void 0:e.zIndexMap[n].element=void 0)},prepare:Ms()}}}),{registerZIndexPortal:Ese,unregisterZIndexPortal:Ase,registerZIndexPortalElement:Cse,unregisterZIndexPortalElement:Pse}=AU.actions,Ise=AU.reducer;function a0(e){var{zIndex:t,children:n}=e,o=pJ(),u=o&&t!==void 0&&t!==0,d=Dm(),g=qo();te.useLayoutEffect(()=>u?(g(Ese({zIndex:t})),()=>{g(Ase({zIndex:t}))}):$x,[g,t,u]);var i=ii(E=>gse(E,t,d));return u?i?sF.createPortal(n,i):null:n}function RA(){return RA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},RA.apply(null,arguments)}function oz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function _b(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oz(Object(n),!0).forEach(function(o){Mse(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Mse(e,t,n){return(t=kse(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kse(e){var t=Rse(e,"string");return typeof t=="symbol"?t:t+""}function Rse(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ose(e){var{cursor:t,cursorComp:n,cursorProps:o}=e;return te.isValidElement(t)?te.cloneElement(t,o):te.createElement(n,o)}function Dse(e){var t,{coordinate:n,payload:o,index:u,offset:d,tooltipAxisBandSize:g,layout:i,cursor:E,tooltipEventType:P,chartName:I}=e,D=n,F=o,$=u;if(!E||!D||I!=="ScatterChart"&&P!=="axis")return null;var Z,q,X;if(I==="ScatterChart")Z=D,q=nQ,X=Mh.cursorLine;else if(I==="BarChart")Z=rQ(i,D,d,g),q=E5,X=Mh.cursorRectangle;else if(i==="radial"&&mB(D)){var{cx:re,cy:le,radius:ue,startAngle:ye,endAngle:ge}=C5(D);Z={cx:re,cy:le,startAngle:ye,endAngle:ge,innerRadius:ue,outerRadius:ue},q=I5,X=Mh.cursorLine}else Z={points:WQ(i,D,d)},q=OC,X=Mh.cursorLine;var we=typeof E=="object"&&"className"in E?E.className:void 0,Le=_b(_b(_b(_b({stroke:"#ccc",pointerEvents:"none"},d),Z),GE(E)),{},{payload:F,payloadIndex:$,className:Oo("recharts-tooltip-cursor",we)});return te.createElement(a0,{zIndex:(t=e.zIndex)!==null&&t!==void 0?t:X},te.createElement(Ose,{cursor:E,cursorComp:q,cursorProps:Le}))}function Lse(e){var t=ese(),n=hJ(),o=Ow(),u=ase();return t==null||n==null||o==null||u==null?null:te.createElement(Dse,RA({},e,{offset:n,layout:o,tooltipAxisBandSize:t,chartName:u}))}var CU=te.createContext(null),jse=()=>te.useContext(CU),nE={exports:{}},az;function zse(){return az||(az=1,(function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(n=!1));function u(E,P,I){this.fn=E,this.context=P,this.once=I||!1}function d(E,P,I,D,F){if(typeof I!="function")throw new TypeError("The listener must be a function");var $=new u(I,D||E,F),Z=n?n+P:P;return E._events[Z]?E._events[Z].fn?E._events[Z]=[E._events[Z],$]:E._events[Z].push($):(E._events[Z]=$,E._eventsCount++),E}function g(E,P){--E._eventsCount===0?E._events=new o:delete E._events[P]}function i(){this._events=new o,this._eventsCount=0}i.prototype.eventNames=function(){var P=[],I,D;if(this._eventsCount===0)return P;for(D in I=this._events)t.call(I,D)&&P.push(n?D.slice(1):D);return Object.getOwnPropertySymbols?P.concat(Object.getOwnPropertySymbols(I)):P},i.prototype.listeners=function(P){var I=n?n+P:P,D=this._events[I];if(!D)return[];if(D.fn)return[D.fn];for(var F=0,$=D.length,Z=new Array($);F<$;F++)Z[F]=D[F].fn;return Z},i.prototype.listenerCount=function(P){var I=n?n+P:P,D=this._events[I];return D?D.fn?1:D.length:0},i.prototype.emit=function(P,I,D,F,$,Z){var q=n?n+P:P;if(!this._events[q])return!1;var X=this._events[q],re=arguments.length,le,ue;if(X.fn){switch(X.once&&this.removeListener(P,X.fn,void 0,!0),re){case 1:return X.fn.call(X.context),!0;case 2:return X.fn.call(X.context,I),!0;case 3:return X.fn.call(X.context,I,D),!0;case 4:return X.fn.call(X.context,I,D,F),!0;case 5:return X.fn.call(X.context,I,D,F,$),!0;case 6:return X.fn.call(X.context,I,D,F,$,Z),!0}for(ue=1,le=new Array(re-1);ue<re;ue++)le[ue-1]=arguments[ue];X.fn.apply(X.context,le)}else{var ye=X.length,ge;for(ue=0;ue<ye;ue++)switch(X[ue].once&&this.removeListener(P,X[ue].fn,void 0,!0),re){case 1:X[ue].fn.call(X[ue].context);break;case 2:X[ue].fn.call(X[ue].context,I);break;case 3:X[ue].fn.call(X[ue].context,I,D);break;case 4:X[ue].fn.call(X[ue].context,I,D,F);break;default:if(!le)for(ge=1,le=new Array(re-1);ge<re;ge++)le[ge-1]=arguments[ge];X[ue].fn.apply(X[ue].context,le)}}return!0},i.prototype.on=function(P,I,D){return d(this,P,I,D,!1)},i.prototype.once=function(P,I,D){return d(this,P,I,D,!0)},i.prototype.removeListener=function(P,I,D,F){var $=n?n+P:P;if(!this._events[$])return this;if(!I)return g(this,$),this;var Z=this._events[$];if(Z.fn)Z.fn===I&&(!F||Z.once)&&(!D||Z.context===D)&&g(this,$);else{for(var q=0,X=[],re=Z.length;q<re;q++)(Z[q].fn!==I||F&&!Z[q].once||D&&Z[q].context!==D)&&X.push(Z[q]);X.length?this._events[$]=X.length===1?X[0]:X:g(this,$)}return this},i.prototype.removeAllListeners=function(P){var I;return P?(I=n?n+P:P,this._events[I]&&g(this,I)):(this._events=new o,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=n,i.EventEmitter=i,e.exports=i})(nE)),nE.exports}var Nse=zse();const Fse=zh(Nse);var Cx=new Fse,OA="recharts.syncEvent.tooltip",lz="recharts.syncEvent.brush";function Bse(e,t){if(t){var n=Number.parseInt(t,10);if(!dp(n))return e==null?void 0:e[n]}}var Use={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},PU=oc({name:"options",initialState:Use,reducers:{createEventEmitter:e=>{e.eventEmitter==null&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),Vse=PU.reducer,{createEventEmitter:$se}=PU.actions;function Hse(e){return e.tooltip.syncInteraction}var Gse={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},IU=oc({name:"chartData",initialState:Gse,reducers:{setChartData(e,t){if(e.chartData=t.payload,t.payload==null){e.dataStartIndex=0,e.dataEndIndex=0;return}t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:n,endIndex:o}=t.payload;n!=null&&(e.dataStartIndex=n),o!=null&&(e.dataEndIndex=o)}}}),{setChartData:cz,setDataStartEndIndexes:Wse,setComputedData:v_e}=IU.actions,qse=IU.reducer,Zse=["x","y"];function uz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Q_(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uz(Object(n),!0).forEach(function(o){Xse(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Xse(e,t,n){return(t=Yse(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yse(e){var t=Kse(e,"string");return typeof t=="symbol"?t:t+""}function Kse(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jse(e,t){if(e==null)return{};var n,o,u=Qse(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function Qse(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function eoe(){var e=ii(cP),t=ii(uP),n=qo(),o=ii(P4),u=ii(Sp),d=Ow(),g=Rw(),i=ii(E=>E.rootProps.className);te.useEffect(()=>{if(e==null)return $x;var E=(P,I,D)=>{if(t!==D&&e===P){if(o==="index"){var F;if(g&&I!==null&&I!==void 0&&(F=I.payload)!==null&&F!==void 0&&F.coordinate&&I.payload.sourceViewBox){var $=I.payload.coordinate,{x:Z,y:q}=$,X=Jse($,Zse),{x:re,y:le,width:ue,height:ye}=I.payload.sourceViewBox,ge=Q_(Q_({},X),{},{x:g.x+(ue?(Z-re)/ue:0)*g.width,y:g.y+(ye?(q-le)/ye:0)*g.height});n(Q_(Q_({},I),{},{payload:Q_(Q_({},I.payload),{},{coordinate:ge})}))}else n(I);return}if(u!=null){var we;if(typeof o=="function"){var Le={activeTooltipIndex:I.payload.index==null?void 0:Number(I.payload.index),isTooltipActive:I.payload.active,activeIndex:I.payload.index==null?void 0:Number(I.payload.index),activeLabel:I.payload.label,activeDataKey:I.payload.dataKey,activeCoordinate:I.payload.coordinate},Ze=o(u,Le);we=u[Ze]}else o==="value"&&(we=u.find(St=>String(St.value)===I.payload.label));var{coordinate:Ge}=I.payload;if(we==null||I.payload.active===!1||Ge==null||g==null){n(MA({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0,graphicalItemId:void 0}));return}var{x:gt,y:lt}=Ge,qe=Math.min(gt,g.x+g.width),en=Math.min(lt,g.y+g.height),Jt={x:d==="horizontal"?we.coordinate:qe,y:d==="horizontal"?en:we.coordinate},Nt=MA({active:I.payload.active,coordinate:Jt,dataKey:I.payload.dataKey,index:String(we.index),label:I.payload.label,sourceViewBox:I.payload.sourceViewBox,graphicalItemId:I.payload.graphicalItemId});n(Nt)}}};return Cx.on(OA,E),()=>{Cx.off(OA,E)}},[i,n,t,e,o,u,d,g])}function toe(){var e=ii(cP),t=ii(uP),n=qo();te.useEffect(()=>{if(e==null)return $x;var o=(u,d,g)=>{t!==g&&e===u&&n(Wse(d))};return Cx.on(lz,o),()=>{Cx.off(lz,o)}},[n,t,e])}function noe(){var e=qo();te.useEffect(()=>{e($se())},[e]),eoe(),toe()}function roe(e,t,n,o,u,d){var g=ii($=>cse($,e,t)),i=ii(uP),E=ii(cP),P=ii(P4),I=ii(Hse),D=I==null?void 0:I.active,F=Rw();te.useEffect(()=>{if(!D&&E!=null&&i!=null){var $=MA({active:d,coordinate:n,dataKey:g,index:u,label:typeof o=="number"?String(o):o,sourceViewBox:F,graphicalItemId:void 0});Cx.emit(OA,E,$,i)}},[D,n,g,u,o,i,E,P,d,F])}function hz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function dz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hz(Object(n),!0).forEach(function(o){ioe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function ioe(e,t,n){return(t=soe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function soe(e){var t=ooe(e,"string");return typeof t=="symbol"?t:t+""}function ooe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function aoe(e){return e.dataKey}function loe(e,t){return te.isValidElement(e)?te.cloneElement(e,t):typeof e=="function"?te.createElement(e,t):te.createElement(LJ,t)}var fz=[],coe={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,includeHidden:!1,isAnimationActive:"auto",itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function uoe(e){var t,n,o=Gd(e,coe),{active:u,allowEscapeViewBox:d,animationDuration:g,animationEasing:i,content:E,filterNull:P,isAnimationActive:I,offset:D,payloadUniqBy:F,position:$,reverseDirection:Z,useTranslate3d:q,wrapperStyle:X,cursor:re,shared:le,trigger:ue,defaultIndex:ye,portal:ge,axisId:we}=o,Le=qo(),Ze=typeof ye=="number"?String(ye):ye;te.useEffect(()=>{Le(iie({shared:le,trigger:ue,axisId:we,active:u,defaultIndex:Ze}))},[Le,le,ue,we,u,Ze]);var Ge=Rw(),gt=x5(),lt=Jre(le),{activeIndex:qe,isActive:en}=(t=ii(Bt=>dse(Bt,lt,ue,Ze)))!==null&&t!==void 0?t:{},Jt=ii(Bt=>hse(Bt,lt,ue,Ze)),Nt=ii(Bt=>EU(Bt,lt,ue,Ze)),St=ii(Bt=>use(Bt,lt,ue,Ze)),an=Jt,Kt=jse(),hn=(n=u??en)!==null&&n!==void 0?n:!1,[Xt,et]=xY([an,hn]),zt=lt==="axis"?Nt:void 0;roe(lt,ue,St,zt,qe,hn);var Zn=ge??Kt;if(Zn==null||Ge==null||lt==null)return null;var $n=an??fz;hn||($n=fz),P&&$n.length&&($n=WX($n.filter(Bt=>Bt.value!=null&&(Bt.hide!==!0||o.includeHidden)),F,aoe));var fr=$n.length>0,kn=te.createElement(VJ,{allowEscapeViewBox:d,animationDuration:g,animationEasing:i,isAnimationActive:I,active:hn,coordinate:St,hasPayload:fr,offset:D,position:$,reverseDirection:Z,useTranslate3d:q,viewBox:Ge,wrapperStyle:X,lastBoundingBox:Xt,innerRef:et,hasPortalFromProps:!!ge},loe(E,dz(dz({},o),{},{payload:$n,label:zt,active:hn,activeIndex:qe,coordinate:St,accessibilityLayer:gt})));return te.createElement(te.Fragment,null,sF.createPortal(kn,Zn),hn&&te.createElement(Lse,{cursor:re,tooltipEventType:lt,coordinate:St,payload:$n,index:qe}))}var Qw=e=>null;Qw.displayName="Cell";function hoe(e,t,n){return(t=doe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function doe(e){var t=foe(e,"string");return typeof t=="symbol"?t:t+""}function foe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class poe{constructor(t){hoe(this,"cache",new Map),this.maxSize=t}get(t){var n=this.cache.get(t);return n!==void 0&&(this.cache.delete(t),this.cache.set(t,n)),n}set(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxSize){var o=this.cache.keys().next().value;o!=null&&this.cache.delete(o)}this.cache.set(t,n)}clear(){this.cache.clear()}size(){return this.cache.size}}function pz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function moe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pz(Object(n),!0).forEach(function(o){goe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function goe(e,t,n){return(t=_oe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _oe(e){var t=yoe(e,"string");return typeof t=="symbol"?t:t+""}function yoe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var voe={cacheSize:2e3,enableCache:!0},MU=moe({},voe),mz=new poe(MU.cacheSize),xoe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},gz="recharts_measurement_span";function boe(e,t){var n=t.fontSize||"",o=t.fontFamily||"",u=t.fontWeight||"",d=t.fontStyle||"",g=t.letterSpacing||"",i=t.textTransform||"";return"".concat(e,"|").concat(n,"|").concat(o,"|").concat(u,"|").concat(d,"|").concat(g,"|").concat(i)}var _z=(e,t)=>{try{var n=document.getElementById(gz);n||(n=document.createElement("span"),n.setAttribute("id",gz),n.setAttribute("aria-hidden","true"),document.body.appendChild(n)),Object.assign(n.style,xoe,t),n.textContent="".concat(e);var o=n.getBoundingClientRect();return{width:o.width,height:o.height}}catch{return{width:0,height:0}}},yz=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||DC.isSsr)return{width:0,height:0};if(!MU.enableCache)return _z(t,n);var o=boe(t,n),u=mz.get(o);if(u)return u;var d=_z(t,n);return mz.set(o,d),d},kU;function woe(e,t,n){return(t=Soe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Soe(e){var t=Toe(e,"string");return typeof t=="symbol"?t:t+""}function Toe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,xz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Eoe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,Aoe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Coe={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},Poe=["cm","mm","pt","pc","in","Q","px"];function Ioe(e){return Poe.includes(e)}var oy="NaN";function Moe(e,t){return e*Coe[t]}class Da{static parse(t){var n,[,o,u]=(n=Aoe.exec(t))!==null&&n!==void 0?n:[];return o==null?Da.NaN:new Da(parseFloat(o),u??"")}constructor(t,n){this.num=t,this.unit=n,this.num=t,this.unit=n,dp(t)&&(this.unit=""),n!==""&&!Eoe.test(n)&&(this.num=NaN,this.unit=""),Ioe(n)&&(this.num=Moe(t,n),this.unit="px")}add(t){return this.unit!==t.unit?new Da(NaN,""):new Da(this.num+t.num,this.unit)}subtract(t){return this.unit!==t.unit?new Da(NaN,""):new Da(this.num-t.num,this.unit)}multiply(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new Da(NaN,""):new Da(this.num*t.num,this.unit||t.unit)}divide(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new Da(NaN,""):new Da(this.num/t.num,this.unit||t.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return dp(this.num)}}kU=Da;woe(Da,"NaN",new kU(NaN,""));function RU(e){if(e==null||e.includes(oy))return oy;for(var t=e;t.includes("*")||t.includes("/");){var n,[,o,u,d]=(n=vz.exec(t))!==null&&n!==void 0?n:[],g=Da.parse(o??""),i=Da.parse(d??""),E=u==="*"?g.multiply(i):g.divide(i);if(E.isNaN())return oy;t=t.replace(vz,E.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var P,[,I,D,F]=(P=xz.exec(t))!==null&&P!==void 0?P:[],$=Da.parse(I??""),Z=Da.parse(F??""),q=D==="+"?$.add(Z):$.subtract(Z);if(q.isNaN())return oy;t=t.replace(xz,q.toString())}return t}var bz=/\(([^()]*)\)/;function koe(e){for(var t=e,n;(n=bz.exec(t))!=null;){var[,o]=n;t=t.replace(bz,RU(o))}return t}function Roe(e){var t=e.replace(/\s+/g,"");return t=koe(t),t=RU(t),t}function Ooe(e){try{return Roe(e)}catch{return oy}}function rE(e){var t=Ooe(e.slice(5,-1));return t===oy?"":t}var Doe=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],Loe=["dx","dy","angle","className","breakAll"];function DA(){return DA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},DA.apply(null,arguments)}function wz(e,t){if(e==null)return{};var n,o,u=joe(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function joe(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var OU=/[ \f\n\r\t\v\u2028\u2029]+/,DU=e=>{var{children:t,breakAll:n,style:o}=e;try{var u=[];zc(t)||(n?u=t.toString().split(""):u=t.toString().split(OU));var d=u.map(i=>({word:i,width:yz(i,o).width})),g=n?0:yz("",o).width;return{wordsWithComputedWidth:d,spaceWidth:g}}catch{return null}};function zoe(e){return e==="start"||e==="middle"||e==="end"||e==="inherit"}var LU=(e,t,n,o)=>e.reduce((u,d)=>{var{word:g,width:i}=d,E=u[u.length-1];if(E&&i!=null&&(t==null||o||E.width+i+n<Number(t)))E.words.push(g),E.width+=i+n;else{var P={words:[g],width:i};u.push(P)}return u},[]),jU=e=>e.reduce((t,n)=>t.width>n.width?t:n),Noe="",Sz=(e,t,n,o,u,d,g,i)=>{var E=e.slice(0,t),P=DU({breakAll:n,style:o,children:E+Noe});if(!P)return[!1,[]];var I=LU(P.wordsWithComputedWidth,d,g,i),D=I.length>u||jU(I).width>Number(d);return[D,I]},Foe=(e,t,n,o,u)=>{var{maxLines:d,children:g,style:i,breakAll:E}=e,P=Wr(d),I=String(g),D=LU(t,o,n,u);if(!P||u)return D;var F=D.length>d||jU(D).width>Number(o);if(!F)return D;for(var $=0,Z=I.length-1,q=0,X;$<=Z&&q<=I.length-1;){var re=Math.floor(($+Z)/2),le=re-1,[ue,ye]=Sz(I,le,E,i,d,o,n,u),[ge]=Sz(I,re,E,i,d,o,n,u);if(!ue&&!ge&&($=re+1),ue&&ge&&(Z=re-1),!ue&&ge){X=ye;break}q++}return X||D},Tz=e=>{var t=zc(e)?[]:e.toString().split(OU);return[{words:t,width:void 0}]},Boe=e=>{var{width:t,scaleToFit:n,children:o,style:u,breakAll:d,maxLines:g}=e;if((t||n)&&!DC.isSsr){var i,E,P=DU({breakAll:d,children:o,style:u});if(P){var{wordsWithComputedWidth:I,spaceWidth:D}=P;i=I,E=D}else return Tz(o);return Foe({breakAll:d,children:o,maxLines:g,style:u},i,E,t,!!n)}return Tz(o)},zU="#808080",Uoe={angle:0,breakAll:!1,capHeight:"0.71em",fill:zU,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},GP=te.forwardRef((e,t)=>{var n=Gd(e,Uoe),{x:o,y:u,lineHeight:d,capHeight:g,fill:i,scaleToFit:E,textAnchor:P,verticalAnchor:I}=n,D=wz(n,Doe),F=te.useMemo(()=>Boe({breakAll:D.breakAll,children:D.children,maxLines:D.maxLines,scaleToFit:E,style:D.style,width:D.width}),[D.breakAll,D.children,D.maxLines,E,D.style,D.width]),{dx:$,dy:Z,angle:q,className:X,breakAll:re}=D,le=wz(D,Loe);if(!pp(o)||!pp(u)||F.length===0)return null;var ue=Number(o)+(Wr($)?$:0),ye=Number(u)+(Wr(Z)?Z:0);if(!Do(ue)||!Do(ye))return null;var ge;switch(I){case"start":ge=rE("calc(".concat(g,")"));break;case"middle":ge=rE("calc(".concat((F.length-1)/2," * -").concat(d," + (").concat(g," / 2))"));break;default:ge=rE("calc(".concat(F.length-1," * -").concat(d,")"));break}var we=[];if(E){var Le=F[0].width,{width:Ze}=D;we.push("scale(".concat(Wr(Ze)&&Wr(Le)?Ze/Le:1,")"))}return q&&we.push("rotate(".concat(q,", ").concat(ue,", ").concat(ye,")")),we.length&&(le.transform=we.join(" ")),te.createElement("text",DA({},Cu(le),{ref:t,x:ue,y:ye,className:Oo("recharts-text",X),textAnchor:P,fill:i.includes("url")?zU:i}),F.map((Ge,gt)=>{var lt=Ge.words.join(re?"":" ");return te.createElement("tspan",{x:ue,dy:gt===0?ge:d,key:"".concat(lt,"-").concat(gt)},lt)}))});GP.displayName="Text";var Voe=["labelRef"],$oe=["content"];function Ez(e,t){if(e==null)return{};var n,o,u=Hoe(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function Hoe(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function Az(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Mo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Az(Object(n),!0).forEach(function(o){Goe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Az(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Goe(e,t,n){return(t=Woe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Woe(e){var t=qoe(e,"string");return typeof t=="symbol"?t:t+""}function qoe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function V1(){return V1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},V1.apply(null,arguments)}var Zoe=te.createContext(null),Xoe=()=>{var e=te.useContext(Zoe),t=Rw();return e||d5(t)},Yoe=te.createContext(null),Koe=()=>{var e=te.useContext(Yoe),t=ii(O4);return e||t},Joe=e=>{var{value:t,formatter:n}=e,o=zc(e.children)?t:e.children;return typeof n=="function"?n(o):o},Qoe=e=>e!=null&&typeof e=="function",eae=(e,t)=>{var n=tc(t-e),o=Math.min(Math.abs(t-e),360);return n*o},tae=(e,t,n,o,u)=>{var{offset:d,className:g}=e,{cx:i,cy:E,innerRadius:P,outerRadius:I,startAngle:D,endAngle:F,clockWise:$}=u,Z=(P+I)/2,q=eae(D,F),X=q>=0?1:-1,re,le;switch(t){case"insideStart":re=D+X*d,le=$;break;case"insideEnd":re=F-X*d,le=!$;break;case"end":re=F+X*d,le=$;break;default:throw new Error("Unsupported position ".concat(t))}le=q<=0?le:!le;var ue=ko(i,E,Z,re),ye=ko(i,E,Z,re+(le?1:-1)*359),ge="M".concat(ue.x,",").concat(ue.y,`
    A`).concat(Z,",").concat(Z,",0,1,").concat(le?0:1,`,
    `).concat(ye.x,",").concat(ye.y),we=zc(e.id)?fx("recharts-radial-line-"):e.id;return te.createElement("text",V1({},o,{dominantBaseline:"central",className:Oo("recharts-radial-bar-label",g)}),te.createElement("defs",null,te.createElement("path",{id:we,d:ge})),te.createElement("textPath",{xlinkHref:"#".concat(we)},n))},nae=(e,t,n)=>{var{cx:o,cy:u,innerRadius:d,outerRadius:g,startAngle:i,endAngle:E}=e,P=(i+E)/2;if(n==="outside"){var{x:I,y:D}=ko(o,u,g+t,P);return{x:I,y:D,textAnchor:I>=o?"start":"end",verticalAnchor:"middle"}}if(n==="center")return{x:o,y:u,textAnchor:"middle",verticalAnchor:"middle"};if(n==="centerTop")return{x:o,y:u,textAnchor:"middle",verticalAnchor:"start"};if(n==="centerBottom")return{x:o,y:u,textAnchor:"middle",verticalAnchor:"end"};var F=(d+g)/2,{x:$,y:Z}=ko(o,u,F,P);return{x:$,y:Z,textAnchor:"middle",verticalAnchor:"middle"}},LA=e=>"cx"in e&&Wr(e.cx),rae=(e,t)=>{var{parentViewBox:n,offset:o,position:u}=e,d;n!=null&&!LA(n)&&(d=n);var{x:g,y:i,upperWidth:E,lowerWidth:P,height:I}=t,D=g,F=g+(E-P)/2,$=(D+F)/2,Z=(E+P)/2,q=D+E/2,X=I>=0?1:-1,re=X*o,le=X>0?"end":"start",ue=X>0?"start":"end",ye=E>=0?1:-1,ge=ye*o,we=ye>0?"end":"start",Le=ye>0?"start":"end";if(u==="top"){var Ze={x:D+E/2,y:i-re,textAnchor:"middle",verticalAnchor:le};return Mo(Mo({},Ze),d?{height:Math.max(i-d.y,0),width:E}:{})}if(u==="bottom"){var Ge={x:F+P/2,y:i+I+re,textAnchor:"middle",verticalAnchor:ue};return Mo(Mo({},Ge),d?{height:Math.max(d.y+d.height-(i+I),0),width:P}:{})}if(u==="left"){var gt={x:$-ge,y:i+I/2,textAnchor:we,verticalAnchor:"middle"};return Mo(Mo({},gt),d?{width:Math.max(gt.x-d.x,0),height:I}:{})}if(u==="right"){var lt={x:$+Z+ge,y:i+I/2,textAnchor:Le,verticalAnchor:"middle"};return Mo(Mo({},lt),d?{width:Math.max(d.x+d.width-lt.x,0),height:I}:{})}var qe=d?{width:Z,height:I}:{};return u==="insideLeft"?Mo({x:$+ge,y:i+I/2,textAnchor:Le,verticalAnchor:"middle"},qe):u==="insideRight"?Mo({x:$+Z-ge,y:i+I/2,textAnchor:we,verticalAnchor:"middle"},qe):u==="insideTop"?Mo({x:D+E/2,y:i+re,textAnchor:"middle",verticalAnchor:ue},qe):u==="insideBottom"?Mo({x:F+P/2,y:i+I-re,textAnchor:"middle",verticalAnchor:le},qe):u==="insideTopLeft"?Mo({x:D+ge,y:i+re,textAnchor:Le,verticalAnchor:ue},qe):u==="insideTopRight"?Mo({x:D+E-ge,y:i+re,textAnchor:we,verticalAnchor:ue},qe):u==="insideBottomLeft"?Mo({x:F+ge,y:i+I-re,textAnchor:Le,verticalAnchor:le},qe):u==="insideBottomRight"?Mo({x:F+P-ge,y:i+I-re,textAnchor:we,verticalAnchor:le},qe):u&&typeof u=="object"&&(Wr(u.x)||fp(u.x))&&(Wr(u.y)||fp(u.y))?Mo({x:g+Lc(u.x,Z),y:i+Lc(u.y,I),textAnchor:"end",verticalAnchor:"end"},qe):Mo({x:q,y:i+I/2,textAnchor:"middle",verticalAnchor:"middle"},qe)},iae={angle:0,offset:5,zIndex:Mh.label,position:"middle",textBreakAll:!1};function NU(e){var t=Gd(e,iae),{viewBox:n,position:o,value:u,children:d,content:g,className:i="",textBreakAll:E,labelRef:P}=t,I=Koe(),D=Xoe(),F=o==="center"?D:I??D,$,Z,q;if(n==null?$=F:LA(n)?$=n:$=d5(n),!$||zc(u)&&zc(d)&&!te.isValidElement(g)&&typeof g!="function")return null;var X=Mo(Mo({},t),{},{viewBox:$});if(te.isValidElement(g)){var{labelRef:re}=X,le=Ez(X,Voe);return te.cloneElement(g,le)}if(typeof g=="function"){var{content:ue}=X,ye=Ez(X,$oe);if(Z=te.createElement(g,ye),te.isValidElement(Z))return Z}else Z=Joe(t);var ge=Cu(t);if(LA($)){if(o==="insideStart"||o==="insideEnd"||o==="end")return tae(t,o,Z,ge,$);q=nae($,t.offset,t.position)}else q=rae(t,$);return te.createElement(a0,{zIndex:t.zIndex},te.createElement(GP,V1({ref:P,className:Oo("recharts-label",i)},ge,q,{textAnchor:zoe(ge.textAnchor)?ge.textAnchor:q.textAnchor,breakAll:E}),Z))}NU.displayName="Label";var iE={},sE={},Cz;function sae(){return Cz||(Cz=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n[n.length-1]}e.last=t})(sE)),sE}var oE={},Pz;function oae(){return Pz||(Pz=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return Array.isArray(n)?n:Array.from(n)}e.toArray=t})(oE)),oE}var Iz;function aae(){return Iz||(Iz=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=sae(),n=oae(),o=wC();function u(d){if(o.isArrayLike(d))return t.last(n.toArray(d))}e.last=u})(iE)),iE}var aE,Mz;function lae(){return Mz||(Mz=1,aE=aae().last),aE}var cae=lae();const uae=zh(cae);var hae=["valueAccessor"],dae=["dataKey","clockWise","id","textBreakAll","zIndex"];function $1(){return $1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},$1.apply(null,arguments)}function kz(e,t){if(e==null)return{};var n,o,u=fae(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function fae(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var pae=e=>Array.isArray(e.value)?uae(e.value):e.value,FU=te.createContext(void 0);FU.Provider;var BU=te.createContext(void 0),mae=BU.Provider;function gae(){return te.useContext(FU)}function _ae(){return te.useContext(BU)}function Xb(e){var{valueAccessor:t=pae}=e,n=kz(e,hae),{dataKey:o,clockWise:u,id:d,textBreakAll:g,zIndex:i}=n,E=kz(n,dae),P=gae(),I=_ae(),D=P||I;return!D||!D.length?null:te.createElement(a0,{zIndex:i??Mh.label},te.createElement(Cm,{className:"recharts-label-list"},D.map((F,$)=>{var Z,q=zc(o)?t(F,$):eo(F&&F.payload,o),X=zc(d)?{}:{id:"".concat(d,"-").concat($)};return te.createElement(NU,$1({key:"label-".concat($)},Cu(F),E,X,{fill:(Z=n.fill)!==null&&Z!==void 0?Z:F.fill,parentViewBox:F.parentViewBox,value:q,textBreakAll:g,viewBox:F.viewBox,index:$,zIndex:0}))})))}Xb.displayName="LabelList";function yae(e){var{label:t}=e;return t?t===!0?te.createElement(Xb,{key:"labelList-implicit"}):te.isValidElement(t)||Qoe(t)?te.createElement(Xb,{key:"labelList-implicit",content:t}):typeof t=="object"?te.createElement(Xb,$1({key:"labelList-implicit"},t,{type:String(t.type)})):null:null}var UU=e=>e.graphicalItems.polarItems,vae=Ht([Ls,Qx],gP),eS=Ht([UU,$s,vae],_P),xae=Ht([eS],yP),tS=Ht([xae,sP],vP),bae=Ht([tS,$s,eS],bP);Ht([tS,$s,eS],(e,t,n)=>n.length>0?e.flatMap(o=>n.flatMap(u=>{var d,g=eo(o,(d=t.dataKey)!==null&&d!==void 0?d:u.dataKey);return{value:g,errorDomain:[]}})).filter(Boolean):(t==null?void 0:t.dataKey)!=null?e.map(o=>({value:eo(o,t.dataKey),errorDomain:[]})):e.map(o=>({value:o,errorDomain:[]})));var Rz=()=>{},wae=Ht([tS,$s,eS,Xw,Ls],EP),Sae=Ht([$s,SP,TP,Rz,wae,Rz,bs,Ls],AP),VU=Ht([$s,bs,tS,bae,Jx,Ls,Sae],CP),Tae=Ht([VU,$s,Ny],MP);Ht([$s,VU,Tae,Ls],RP);var Eae={radiusAxis:{},angleAxis:{}},$U=oc({name:"polarAxis",initialState:Eae,reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:x_e,removeRadiusAxis:b_e,addAngleAxis:w_e,removeAngleAxis:S_e}=$U.actions,Aae=$U.reducer;function Oz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Dz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Oz(Object(n),!0).forEach(function(o){Cae(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Cae(e,t,n){return(t=Pae(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pae(e){var t=Iae(e,"string");return typeof t=="symbol"?t:t+""}function Iae(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Mae=(e,t)=>t,WP=Ht([UU,Mae],(e,t)=>e.filter(n=>n.type==="pie").find(n=>n.id===t)),kae=[],qP=(e,t,n)=>(n==null?void 0:n.length)===0?kae:n,HU=Ht([sP,WP,qP],(e,t,n)=>{var{chartData:o}=e;if(t!=null){var u;if((t==null?void 0:t.data)!=null&&t.data.length>0?u=t.data:u=o,(!u||!u.length)&&n!=null&&(u=n.map(d=>Dz(Dz({},t.presentationProps),d.props))),u!=null)return u}}),Rae=Ht([HU,WP,qP],(e,t,n)=>{if(!(e==null||t==null))return e.map((o,u)=>{var d,g=eo(o,t.nameKey,t.name),i;return n!=null&&(d=n[u])!==null&&d!==void 0&&(d=d.props)!==null&&d!==void 0&&d.fill?i=n[u].props.fill:typeof o=="object"&&o!=null&&"fill"in o?i=o.fill:i=t.fill,{value:s5(g,t.dataKey),color:i,payload:o,type:t.legendType}})}),Oae=Ht([HU,WP,qP,ca],(e,t,n,o)=>{if(!(t==null||e==null))return zle({offset:o,pieSettings:t,displayedData:e,cells:n})}),lE={exports:{}},Xi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lz;function Dae(){if(Lz)return Xi;Lz=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),g=Symbol.for("react.context"),i=Symbol.for("react.server_context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),$=Symbol.for("react.offscreen"),Z;Z=Symbol.for("react.module.reference");function q(X){if(typeof X=="object"&&X!==null){var re=X.$$typeof;switch(re){case e:switch(X=X.type,X){case n:case u:case o:case P:case I:return X;default:switch(X=X&&X.$$typeof,X){case i:case g:case E:case F:case D:case d:return X;default:return re}}case t:return re}}}return Xi.ContextConsumer=g,Xi.ContextProvider=d,Xi.Element=e,Xi.ForwardRef=E,Xi.Fragment=n,Xi.Lazy=F,Xi.Memo=D,Xi.Portal=t,Xi.Profiler=u,Xi.StrictMode=o,Xi.Suspense=P,Xi.SuspenseList=I,Xi.isAsyncMode=function(){return!1},Xi.isConcurrentMode=function(){return!1},Xi.isContextConsumer=function(X){return q(X)===g},Xi.isContextProvider=function(X){return q(X)===d},Xi.isElement=function(X){return typeof X=="object"&&X!==null&&X.$$typeof===e},Xi.isForwardRef=function(X){return q(X)===E},Xi.isFragment=function(X){return q(X)===n},Xi.isLazy=function(X){return q(X)===F},Xi.isMemo=function(X){return q(X)===D},Xi.isPortal=function(X){return q(X)===t},Xi.isProfiler=function(X){return q(X)===u},Xi.isStrictMode=function(X){return q(X)===o},Xi.isSuspense=function(X){return q(X)===P},Xi.isSuspenseList=function(X){return q(X)===I},Xi.isValidElementType=function(X){return typeof X=="string"||typeof X=="function"||X===n||X===u||X===o||X===P||X===I||X===$||typeof X=="object"&&X!==null&&(X.$$typeof===F||X.$$typeof===D||X.$$typeof===d||X.$$typeof===g||X.$$typeof===E||X.$$typeof===Z||X.getModuleId!==void 0)},Xi.typeOf=q,Xi}var jz;function Lae(){return jz||(jz=1,lE.exports=Dae()),lE.exports}var jae=Lae(),zz=e=>typeof e=="string"?e:e?e.displayName||e.name||"Component":"",Nz=null,cE=null,GU=e=>{if(e===Nz&&Array.isArray(cE))return cE;var t=[];return te.Children.forEach(e,n=>{zc(n)||(jae.isFragment(n)?t=t.concat(GU(n.props.children)):t.push(n))}),cE=t,Nz=e,t};function WU(e,t){var n=[],o=[];return Array.isArray(t)?o=t.map(u=>zz(u)):o=[zz(t)],GU(e).forEach(u=>{var d=dx(u,"type.displayName")||dx(u,"type.name");d&&o.indexOf(d)!==-1&&n.push(u)}),n}var uE={},Fz;function zae(){return Fz||(Fz=1,(function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){var u;if(typeof n!="object"||n==null)return!1;if(Object.getPrototypeOf(n)===null)return!0;if(Object.prototype.toString.call(n)!=="[object Object]"){const d=n[Symbol.toStringTag];return d==null||!((u=Object.getOwnPropertyDescriptor(n,Symbol.toStringTag))!=null&&u.writable)?!1:n.toString()===`[object ${d}]`}let o=n;for(;Object.getPrototypeOf(o)!==null;)o=Object.getPrototypeOf(o);return Object.getPrototypeOf(n)===o}e.isPlainObject=t})(uE)),uE}var hE,Bz;function Nae(){return Bz||(Bz=1,hE=zae().isPlainObject),hE}var Fae=Nae();const Bae=zh(Fae);var Uz,Vz,$z,Hz,Gz;function Wz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function qz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Wz(Object(n),!0).forEach(function(o){Uae(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Uae(e,t,n){return(t=Vae(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vae(e){var t=$ae(e,"string");return typeof t=="symbol"?t:t+""}function $ae(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function H1(){return H1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},H1.apply(null,arguments)}function Uv(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Zz=(e,t,n,o,u)=>{var d=n-o,g;return g=Js(Uz||(Uz=Uv(["M ",",",""])),e,t),g+=Js(Vz||(Vz=Uv(["L ",",",""])),e+n,t),g+=Js($z||($z=Uv(["L ",",",""])),e+n-d/2,t+u),g+=Js(Hz||(Hz=Uv(["L ",",",""])),e+n-d/2-o,t+u),g+=Js(Gz||(Gz=Uv(["L ",","," Z"])),e,t),g},Hae={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Gae=e=>{var t=Gd(e,Hae),{x:n,y:o,upperWidth:u,lowerWidth:d,height:g,className:i}=t,{animationEasing:E,animationDuration:P,animationBegin:I,isUpdateAnimationActive:D}=t,F=te.useRef(null),[$,Z]=te.useState(-1),q=te.useRef(u),X=te.useRef(d),re=te.useRef(g),le=te.useRef(n),ue=te.useRef(o),ye=jC(e,"trapezoid-");if(te.useEffect(()=>{if(F.current&&F.current.getTotalLength)try{var Jt=F.current.getTotalLength();Jt&&Z(Jt)}catch{}},[]),n!==+n||o!==+o||u!==+u||d!==+d||g!==+g||u===0&&d===0||g===0)return null;var ge=Oo("recharts-trapezoid",i);if(!D)return te.createElement("g",null,te.createElement("path",H1({},Cu(t),{className:ge,d:Zz(n,o,u,d,g)})));var we=q.current,Le=X.current,Ze=re.current,Ge=le.current,gt=ue.current,lt="0px ".concat($===-1?1:$,"px"),qe="".concat($,"px 0px"),en=b5(["strokeDasharray"],P,E);return te.createElement(LC,{animationId:ye,key:ye,canBegin:$>0,duration:P,easing:E,isActive:D,begin:I},Jt=>{var Nt=Ah(we,u,Jt),St=Ah(Le,d,Jt),an=Ah(Ze,g,Jt),Kt=Ah(Ge,n,Jt),hn=Ah(gt,o,Jt);F.current&&(q.current=Nt,X.current=St,re.current=an,le.current=Kt,ue.current=hn);var Xt=Jt>0?{transition:en,strokeDasharray:qe}:{strokeDasharray:lt};return te.createElement("path",H1({},Cu(t),{className:ge,d:Zz(Kt,hn,Nt,St,an),ref:F,style:qz(qz({},Xt),t.style)}))})},Wae=["option","shapeType","activeClassName"];function qae(e,t){if(e==null)return{};var n,o,u=Zae(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function Zae(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function Xz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function G1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xz(Object(n),!0).forEach(function(o){Xae(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Xae(e,t,n){return(t=Yae(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yae(e){var t=Kae(e,"string");return typeof t=="symbol"?t:t+""}function Kae(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jae(e,t){return G1(G1({},t),e)}function Qae(e,t){return e==="symbols"}function Yz(e){var{shapeType:t,elementProps:n}=e;switch(t){case"rectangle":return te.createElement(E5,n);case"trapezoid":return te.createElement(Gae,n);case"sector":return te.createElement(I5,n);case"symbols":if(Qae(t))return te.createElement(pB,n);break;case"curve":return te.createElement(OC,n);default:return null}}function ele(e){return te.isValidElement(e)?e.props:e}function tle(e){var{option:t,shapeType:n,activeClassName:o="recharts-active-shape"}=e,u=qae(e,Wae),d;if(te.isValidElement(t))d=te.cloneElement(t,G1(G1({},u),ele(t)));else if(typeof t=="function")d=t(u,u.index);else if(Bae(t)&&typeof t!="boolean"){var g=Jae(t,u);d=te.createElement(Yz,{shapeType:n,elementProps:g})}else{var i=u;d=te.createElement(Yz,{shapeType:n,elementProps:i})}return u.isActive?te.createElement(Cm,{className:o},d):d}var nle=(e,t,n)=>{var o=qo();return(u,d)=>g=>{e==null||e(u,d,g),o(oU({activeIndex:String(d),activeDataKey:t,activeCoordinate:u.tooltipPosition,activeGraphicalItemId:n}))}},rle=e=>{var t=qo();return(n,o)=>u=>{e==null||e(n,o,u),t(sie())}},ile=(e,t,n)=>{var o=qo();return(u,d)=>g=>{e==null||e(u,d,g),o(oie({activeIndex:String(d),activeDataKey:t,activeCoordinate:u.tooltipPosition,activeGraphicalItemId:n}))}};function sle(e){var{tooltipEntrySettings:t}=e,n=qo(),o=Dm(),u=te.useRef(null);return te.useLayoutEffect(()=>{o||(u.current===null?n(tie(t)):u.current!==t&&n(nie({prev:u.current,next:t})),u.current=t)},[t,n,o]),te.useLayoutEffect(()=>()=>{u.current&&(n(rie(u.current)),u.current=null)},[n]),null}function ole(e){var{legendPayload:t}=e,n=qo(),o=ii(bs),u=te.useRef(null);return te.useLayoutEffect(()=>{o!=="centric"&&o!=="radial"||(u.current===null?n(CJ(t)):u.current!==t&&n(PJ({prev:u.current,next:t})),u.current=t)},[n,o,t]),te.useLayoutEffect(()=>()=>{u.current&&(n(IJ(u.current)),u.current=null)},[n]),null}var dE,ale=()=>{var[e]=te.useState(()=>fx("uid-"));return e},lle=(dE=GH.useId)!==null&&dE!==void 0?dE:ale;function cle(e,t){var n=lle();return t||(e?"".concat(e,"-").concat(n):n)}var ule=te.createContext(void 0),hle=e=>{var{id:t,type:n,children:o}=e,u=cle("recharts-".concat(n),t);return te.createElement(ule.Provider,{value:u},o(u))},dle={cartesianItems:[],polarItems:[]},qU=oc({name:"graphicalItems",initialState:dle,reducers:{addCartesianGraphicalItem:{reducer(e,t){e.cartesianItems.push(t.payload)},prepare:Ms()},replaceCartesianGraphicalItem:{reducer(e,t){var{prev:n,next:o}=t.payload,u=Rh(e).cartesianItems.indexOf(n);u>-1&&(e.cartesianItems[u]=o)},prepare:Ms()},removeCartesianGraphicalItem:{reducer(e,t){var n=Rh(e).cartesianItems.indexOf(t.payload);n>-1&&e.cartesianItems.splice(n,1)},prepare:Ms()},addPolarGraphicalItem:{reducer(e,t){e.polarItems.push(t.payload)},prepare:Ms()},removePolarGraphicalItem:{reducer(e,t){var n=Rh(e).polarItems.indexOf(t.payload);n>-1&&e.polarItems.splice(n,1)},prepare:Ms()}}}),{addCartesianGraphicalItem:T_e,replaceCartesianGraphicalItem:E_e,removeCartesianGraphicalItem:A_e,addPolarGraphicalItem:fle,removePolarGraphicalItem:ple}=qU.actions,mle=qU.reducer;function gle(e){var t=qo();return te.useLayoutEffect(()=>(t(fle(e)),()=>{t(ple(e))}),[t,e]),null}var _le=["key"],yle=["onMouseEnter","onClick","onMouseLeave"],vle=["id"],xle=["id"];function Kz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Qs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Kz(Object(n),!0).forEach(function(o){ble(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function ble(e,t,n){return(t=wle(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wle(e){var t=Sle(e,"string");return typeof t=="symbol"?t:t+""}function Sle(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Mm(){return Mm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Mm.apply(null,arguments)}function nS(e,t){if(e==null)return{};var n,o,u=Tle(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function Tle(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function Ele(e){var t=te.useMemo(()=>WU(e.children,Qw),[e.children]),n=ii(o=>Rae(o,e.id,t));return n==null?null:te.createElement(ole,{legendPayload:n})}var Ale=te.memo(e=>{var{dataKey:t,nameKey:n,sectors:o,stroke:u,strokeWidth:d,fill:g,name:i,hide:E,tooltipType:P,id:I}=e,D={dataDefinedOnItem:o.map(F=>F.tooltipPayload),positions:o.map(F=>F.tooltipPosition),settings:{stroke:u,strokeWidth:d,fill:g,dataKey:t,nameKey:n,name:s5(i,t),hide:E,type:P,color:g,unit:"",graphicalItemId:I}};return te.createElement(sle,{tooltipEntrySettings:D})}),Cle=(e,t)=>e>t?"start":e<t?"end":"middle",Ple=(e,t,n)=>Lc(typeof t=="function"?t(e):t,n,n*.8),Ile=(e,t,n)=>{var{top:o,left:u,width:d,height:g}=t,i=A5(d,g),E=u+Lc(e.cx,d,d/2),P=o+Lc(e.cy,g,g/2),I=Lc(e.innerRadius,i,0),D=Ple(n,e.outerRadius,i),F=e.maxRadius||Math.sqrt(d*d+g*g)/2;return{cx:E,cy:P,innerRadius:I,outerRadius:D,maxRadius:F}},Mle=(e,t)=>{var n=tc(t-e),o=Math.min(Math.abs(t-e),360);return n*o};function kle(e){return e&&typeof e=="object"&&"className"in e&&typeof e.className=="string"?e.className:""}var Rle=(e,t)=>{if(te.isValidElement(e))return te.cloneElement(e,t);if(typeof e=="function")return e(t);var n=Oo("recharts-pie-label-line",typeof e!="boolean"?e.className:""),{key:o}=t,u=nS(t,_le);return te.createElement(OC,Mm({},u,{type:"linear",className:n}))},Ole=(e,t,n)=>{if(te.isValidElement(e))return te.cloneElement(e,t);var o=n;if(typeof e=="function"&&(o=e(t),te.isValidElement(o)))return o;var u=Oo("recharts-pie-label-text",kle(e));return te.createElement(GP,Mm({},t,{alignmentBaseline:"middle",className:u}),o)};function Dle(e){var{sectors:t,props:n,showLabels:o}=e,{label:u,labelLine:d,dataKey:g}=n;if(!o||!u||!t)return null;var i=my(n),E=GE(u),P=GE(d),I=typeof u=="object"&&"offsetRadius"in u&&typeof u.offsetRadius=="number"&&u.offsetRadius||20,D=t.map((F,$)=>{var Z=(F.startAngle+F.endAngle)/2,q=ko(F.cx,F.cy,F.outerRadius+I,Z),X=Qs(Qs(Qs(Qs({},i),F),{},{stroke:"none"},E),{},{index:$,textAnchor:Cle(q.x,F.cx)},q),re=Qs(Qs(Qs(Qs({},i),F),{},{fill:"none",stroke:F.fill},P),{},{index:$,points:[ko(F.cx,F.cy,F.outerRadius,Z),q],key:"line"});return te.createElement(a0,{zIndex:Mh.label,key:"label-".concat(F.startAngle,"-").concat(F.endAngle,"-").concat(F.midAngle,"-").concat($)},te.createElement(Cm,null,d&&Rle(d,re),Ole(u,X,eo(F,g))))});return te.createElement(Cm,{className:"recharts-pie-labels"},D)}function Lle(e){var{sectors:t,props:n,showLabels:o}=e,{label:u}=n;return typeof u=="object"&&u!=null&&"position"in u?te.createElement(yae,{label:u}):te.createElement(Dle,{sectors:t,props:n,showLabels:o})}function jle(e){var{sectors:t,activeShape:n,inactiveShape:o,allOtherPieProps:u,shape:d,id:g}=e,i=ii(Ax),E=ii(xU),P=ii(Gie),{onMouseEnter:I,onClick:D,onMouseLeave:F}=u,$=nS(u,yle),Z=nle(I,u.dataKey,g),q=rle(F),X=ile(D,u.dataKey,g);return t==null||t.length===0?null:te.createElement(te.Fragment,null,t.map((re,le)=>{if((re==null?void 0:re.startAngle)===0&&(re==null?void 0:re.endAngle)===0&&t.length!==1)return null;var ue=P==null||P===g,ye=String(le)===i&&(E==null||u.dataKey===E)&&ue,ge=i?o:null,we=n&&ye?n:ge,Le=Qs(Qs({},re),{},{stroke:re.stroke,tabIndex:-1,[a5]:le,[l5]:g});return te.createElement(Cm,Mm({key:"sector-".concat(re==null?void 0:re.startAngle,"-").concat(re==null?void 0:re.endAngle,"-").concat(re.midAngle,"-").concat(le),tabIndex:-1,className:"recharts-pie-sector"},wX($,re,le),{onMouseEnter:Z(re,le),onMouseLeave:q(re,le),onClick:X(re,le)}),te.createElement(tle,Mm({option:d??we,index:le,shapeType:"sector",isActive:ye},Le)))}))}function zle(e){var t,{pieSettings:n,displayedData:o,cells:u,offset:d}=e,{cornerRadius:g,startAngle:i,endAngle:E,dataKey:P,nameKey:I,tooltipType:D}=n,F=Math.abs(n.minAngle),$=Mle(i,E),Z=Math.abs($),q=o.length<=1?0:(t=n.paddingAngle)!==null&&t!==void 0?t:0,X=o.filter(we=>eo(we,P,0)!==0).length,re=(Z>=360?X:X-1)*q,le=Z-X*F-re,ue=o.reduce((we,Le)=>{var Ze=eo(Le,P,0);return we+(Wr(Ze)?Ze:0)},0),ye;if(ue>0){var ge;ye=o.map((we,Le)=>{var Ze=eo(we,P,0),Ge=eo(we,I,Le),gt=Ile(n,d,we),lt=(Wr(Ze)?Ze:0)/ue,qe,en=Qs(Qs({},we),u&&u[Le]&&u[Le].props);Le?qe=ge.endAngle+tc($)*q*(Ze!==0?1:0):qe=i;var Jt=qe+tc($)*((Ze!==0?F:0)+lt*le),Nt=(qe+Jt)/2,St=(gt.innerRadius+gt.outerRadius)/2,an=[{name:Ge,value:Ze,payload:en,dataKey:P,type:D,graphicalItemId:n.id}],Kt=ko(gt.cx,gt.cy,St,Nt);return ge=Qs(Qs(Qs(Qs({},n.presentationProps),{},{percent:lt,cornerRadius:typeof g=="string"?parseFloat(g):g,name:Ge,tooltipPayload:an,midAngle:Nt,middleRadius:St,tooltipPosition:Kt},en),gt),{},{value:Ze,dataKey:P,startAngle:qe,endAngle:Jt,payload:en,paddingAngle:tc($)*q}),ge})}return ye}function Nle(e){var{showLabels:t,sectors:n,children:o}=e,u=te.useMemo(()=>!t||!n?[]:n.map(d=>({value:d.value,payload:d.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:d.cx,cy:d.cy,innerRadius:d.innerRadius,outerRadius:d.outerRadius,startAngle:d.startAngle,endAngle:d.endAngle,clockWise:!1},fill:d.fill})),[n,t]);return te.createElement(mae,{value:t?u:void 0},o)}function Fle(e){var{props:t,previousSectorsRef:n,id:o}=e,{sectors:u,isAnimationActive:d,animationBegin:g,animationDuration:i,animationEasing:E,activeShape:P,inactiveShape:I,onAnimationStart:D,onAnimationEnd:F}=t,$=jC(t,"recharts-pie-"),Z=n.current,[q,X]=te.useState(!1),re=te.useCallback(()=>{typeof F=="function"&&F(),X(!1)},[F]),le=te.useCallback(()=>{typeof D=="function"&&D(),X(!0)},[D]);return te.createElement(Nle,{showLabels:!q,sectors:u},te.createElement(LC,{animationId:$,begin:g,duration:i,isActive:d,easing:E,onAnimationStart:le,onAnimationEnd:re,key:$},ue=>{var ye=[],ge=u&&u[0],we=ge==null?void 0:ge.startAngle;return u==null||u.forEach((Le,Ze)=>{var Ge=Z&&Z[Ze],gt=Ze>0?dx(Le,"paddingAngle",0):0;if(Ge){var lt=Ah(Ge.endAngle-Ge.startAngle,Le.endAngle-Le.startAngle,ue),qe=Qs(Qs({},Le),{},{startAngle:we+gt,endAngle:we+lt+gt});ye.push(qe),we=qe.endAngle}else{var{endAngle:en,startAngle:Jt}=Le,Nt=Ah(0,en-Jt,ue),St=Qs(Qs({},Le),{},{startAngle:we+gt,endAngle:we+Nt+gt});ye.push(St),we=St.endAngle}}),n.current=ye,te.createElement(Cm,null,te.createElement(jle,{sectors:ye,activeShape:P,inactiveShape:I,allOtherPieProps:t,shape:t.shape,id:o}))}),te.createElement(Lle,{showLabels:!q,sectors:u,props:t}),t.children)}var Ble={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:"auto",label:!1,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:Mh.area};function Ule(e){var{id:t}=e,n=nS(e,vle),{hide:o,className:u,rootTabIndex:d}=e,g=te.useMemo(()=>WU(e.children,Qw),[e.children]),i=ii(I=>Oae(I,t,g)),E=te.useRef(null),P=Oo("recharts-pie",u);return o||i==null?(E.current=null,te.createElement(Cm,{tabIndex:d,className:P})):te.createElement(a0,{zIndex:e.zIndex},te.createElement(Ale,{dataKey:e.dataKey,nameKey:e.nameKey,sectors:i,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,tooltipType:e.tooltipType,id:t}),te.createElement(Cm,{tabIndex:d,className:P},te.createElement(Fle,{props:Qs(Qs({},n),{},{sectors:i}),previousSectorsRef:E,id:t})))}function ZU(e){var t=Gd(e,Ble),{id:n}=t,o=nS(t,xle),u=my(o);return te.createElement(hle,{id:n,type:"pie"},d=>te.createElement(te.Fragment,null,te.createElement(gle,{type:"pie",id:d,data:o.data,dataKey:o.dataKey,hide:o.hide,angleAxisId:0,radiusAxisId:0,name:o.name,nameKey:o.nameKey,tooltipType:o.tooltipType,legendType:o.legendType,fill:o.fill,cx:o.cx,cy:o.cy,startAngle:o.startAngle,endAngle:o.endAngle,paddingAngle:o.paddingAngle,minAngle:o.minAngle,innerRadius:o.innerRadius,outerRadius:o.outerRadius,cornerRadius:o.cornerRadius,presentationProps:u,maxRadius:t.maxRadius}),te.createElement(Ele,Mm({},o,{id:d})),te.createElement(Ule,Mm({},o,{id:d}))))}ZU.displayName="Pie";function Jz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Qz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jz(Object(n),!0).forEach(function(o){Vle(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Vle(e,t,n){return(t=$le(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $le(e){var t=Hle(e,"string");return typeof t=="symbol"?t:t+""}function Hle(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Gle={xAxis:{},yAxis:{},zAxis:{}},XU=oc({name:"cartesianAxis",initialState:Gle,reducers:{addXAxis:{reducer(e,t){e.xAxis[t.payload.id]=t.payload},prepare:Ms()},replaceXAxis:{reducer(e,t){var{prev:n,next:o}=t.payload;e.xAxis[n.id]!==void 0&&(n.id!==o.id&&delete e.xAxis[n.id],e.xAxis[o.id]=o)},prepare:Ms()},removeXAxis:{reducer(e,t){delete e.xAxis[t.payload.id]},prepare:Ms()},addYAxis:{reducer(e,t){e.yAxis[t.payload.id]=t.payload},prepare:Ms()},replaceYAxis:{reducer(e,t){var{prev:n,next:o}=t.payload;e.yAxis[n.id]!==void 0&&(n.id!==o.id&&delete e.yAxis[n.id],e.yAxis[o.id]=o)},prepare:Ms()},removeYAxis:{reducer(e,t){delete e.yAxis[t.payload.id]},prepare:Ms()},addZAxis:{reducer(e,t){e.zAxis[t.payload.id]=t.payload},prepare:Ms()},replaceZAxis:{reducer(e,t){var{prev:n,next:o}=t.payload;e.zAxis[n.id]!==void 0&&(n.id!==o.id&&delete e.zAxis[n.id],e.zAxis[o.id]=o)},prepare:Ms()},removeZAxis:{reducer(e,t){delete e.zAxis[t.payload.id]},prepare:Ms()},updateYAxisWidth(e,t){var{id:n,width:o}=t.payload,u=e.yAxis[n];if(u){var d=u.widthHistory||[];if(d.length===3&&d[0]===d[2]&&o===d[1]&&o!==u.width&&Math.abs(o-d[0])<=1)return;var g=[...d,o].slice(-3);e.yAxis[n]=Qz(Qz({},e.yAxis[n]),{},{width:o,widthHistory:g})}}}}),{addXAxis:C_e,replaceXAxis:P_e,removeXAxis:I_e,addYAxis:M_e,replaceYAxis:k_e,removeYAxis:R_e,addZAxis:O_e,replaceZAxis:D_e,removeZAxis:L_e,updateYAxisWidth:j_e}=XU.actions,Wle=XU.reducer,qle=Ht([ca],e=>({top:e.top,bottom:e.bottom,left:e.left,right:e.right})),Zle=Ht([qle,xp,bp],(e,t,n)=>{if(!(!e||t==null||n==null))return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,n-e.top-e.bottom)}}),Xle=()=>ii(Zle),Yle=e=>{var{chartData:t}=e,n=qo(),o=Dm();return te.useEffect(()=>o?()=>{}:(n(cz(t)),()=>{n(cz(void 0))}),[t,n,o]),null},eN={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},YU=oc({name:"brush",initialState:eN,reducers:{setBrushSettings(e,t){return t.payload==null?eN:t.payload}}}),{setBrushSettings:z_e}=YU.actions,Kle=YU.reducer,Jle={dots:[],areas:[],lines:[]},KU=oc({name:"referenceElements",initialState:Jle,reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var n=Rh(e).dots.findIndex(o=>o===t.payload);n!==-1&&e.dots.splice(n,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var n=Rh(e).areas.findIndex(o=>o===t.payload);n!==-1&&e.areas.splice(n,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var n=Rh(e).lines.findIndex(o=>o===t.payload);n!==-1&&e.lines.splice(n,1)}}}),{addDot:N_e,removeDot:F_e,addArea:B_e,removeArea:U_e,addLine:V_e,removeLine:$_e}=KU.actions,Qle=KU.reducer,ece=te.createContext(void 0),tce=e=>{var{children:t}=e,[n]=te.useState("".concat(fx("recharts"),"-clip")),o=Xle();if(o==null)return null;var{x:u,y:d,width:g,height:i}=o;return te.createElement(ece.Provider,{value:n},te.createElement("defs",null,te.createElement("clipPath",{id:n},te.createElement("rect",{x:u,y:d,height:i,width:g}))),t)},nce={},JU=oc({name:"errorBars",initialState:nce,reducers:{addErrorBar:(e,t)=>{var{itemId:n,errorBar:o}=t.payload;e[n]||(e[n]=[]),e[n].push(o)},replaceErrorBar:(e,t)=>{var{itemId:n,prev:o,next:u}=t.payload;e[n]&&(e[n]=e[n].map(d=>d.dataKey===o.dataKey&&d.direction===o.direction?u:d))},removeErrorBar:(e,t)=>{var{itemId:n,errorBar:o}=t.payload;e[n]&&(e[n]=e[n].filter(u=>u.dataKey!==o.dataKey||u.direction!==o.direction))}}}),{addErrorBar:H_e,replaceErrorBar:G_e,removeErrorBar:W_e}=JU.actions,rce=JU.reducer,fE={exports:{}},pE={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tN;function ice(){if(tN)return pE;tN=1;var e=Ey();function t(E,P){return E===P&&(E!==0||1/E===1/P)||E!==E&&P!==P}var n=typeof Object.is=="function"?Object.is:t,o=e.useSyncExternalStore,u=e.useRef,d=e.useEffect,g=e.useMemo,i=e.useDebugValue;return pE.useSyncExternalStoreWithSelector=function(E,P,I,D,F){var $=u(null);if($.current===null){var Z={hasValue:!1,value:null};$.current=Z}else Z=$.current;$=g(function(){function X(ge){if(!re){if(re=!0,le=ge,ge=D(ge),F!==void 0&&Z.hasValue){var we=Z.value;if(F(we,ge))return ue=we}return ue=ge}if(we=ue,n(le,ge))return we;var Le=D(ge);return F!==void 0&&F(we,Le)?(le=ge,we):(le=ge,ue=Le)}var re=!1,le,ue,ye=I===void 0?null:I;return[function(){return X(P())},ye===null?void 0:function(){return X(ye())}]},[P,I,D,F]);var q=o(E,$[0],$[1]);return d(function(){Z.hasValue=!0,Z.value=q},[q]),i(q),q},pE}var nN;function sce(){return nN||(nN=1,fE.exports=ice()),fE.exports}sce();function oce(e){e()}function ace(){let e=null,t=null;return{clear(){e=null,t=null},notify(){oce(()=>{let n=e;for(;n;)n.callback(),n=n.next})},get(){const n=[];let o=e;for(;o;)n.push(o),o=o.next;return n},subscribe(n){let o=!0;const u=t={callback:n,next:null,prev:t};return u.prev?u.prev.next=u:e=u,function(){!o||e===null||(o=!1,u.next?u.next.prev=u.prev:t=u.prev,u.prev?u.prev.next=u.next:e=u.next)}}}}var rN={notify(){},get:()=>[]};function lce(e,t){let n,o=rN,u=0,d=!1;function g(q){I();const X=o.subscribe(q);let re=!1;return()=>{re||(re=!0,X(),D())}}function i(){o.notify()}function E(){Z.onStateChange&&Z.onStateChange()}function P(){return d}function I(){u++,n||(n=e.subscribe(E),o=ace())}function D(){u--,n&&u===0&&(n(),n=void 0,o.clear(),o=rN)}function F(){d||(d=!0,I())}function $(){d&&(d=!1,D())}const Z={addNestedSub:g,notifyNestedSubs:i,handleChangeWrapper:E,isSubscribed:P,trySubscribe:F,tryUnsubscribe:$,getListeners:()=>o};return Z}var cce=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",uce=cce(),hce=()=>typeof navigator<"u"&&navigator.product==="ReactNative",dce=hce(),fce=()=>uce||dce?te.useLayoutEffect:te.useEffect,pce=fce();function iN(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function mce(e,t){if(iN(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(let u=0;u<n.length;u++)if(!Object.prototype.hasOwnProperty.call(t,n[u])||!iN(e[n[u]],t[n[u]]))return!1;return!0}var mE=Symbol.for("react-redux-context"),gE=typeof globalThis<"u"?globalThis:{};function gce(){if(!te.createContext)return{};const e=gE[mE]??(gE[mE]=new Map);let t=e.get(te.createContext);return t||(t=te.createContext(null),e.set(te.createContext,t)),t}var _ce=gce();function yce(e){const{children:t,context:n,serverState:o,store:u}=e,d=te.useMemo(()=>{const E=lce(u);return{store:u,subscription:E,getServerState:o?()=>o:void 0}},[u,o]),g=te.useMemo(()=>u.getState(),[u]);pce(()=>{const{subscription:E}=d;return E.onStateChange=E.notifyNestedSubs,E.trySubscribe(),g!==u.getState()&&E.notifyNestedSubs(),()=>{E.tryUnsubscribe(),E.onStateChange=void 0}},[d,g]);const i=n||_ce;return te.createElement(i.Provider,{value:d},t)}var vce=yce,xce=new Set(["axisLine","tickLine","activeBar","activeDot","activeLabel","activeShape","allowEscapeViewBox","background","cursor","dot","label","line","margin","padding","position","shape","style","tick","wrapperStyle","radius"]);function bce(e,t){return e==null&&t==null?!0:typeof e=="number"&&typeof t=="number"?e===t||e!==e&&t!==t:e===t}function wce(e,t){var n=new Set([...Object.keys(e),...Object.keys(t)]);for(var o of n)if(xce.has(o)){if(e[o]==null&&t[o]==null)continue;if(!mce(e[o],t[o]))return!1}else if(!bce(e[o],t[o]))return!1;return!0}var Sce=(e,t)=>t,ZP=Ht([Sce,bs,O4,Xo,gU,Sp,lse,ca],mse),XP=e=>{var t=e.currentTarget.getBoundingClientRect(),n=t.width/e.currentTarget.offsetWidth,o=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/n),chartY:Math.round((e.clientY-t.top)/o)}},QU=Pu("mouseClick"),eV=Gx();eV.startListening({actionCreator:QU,effect:(e,t)=>{var n=e.payload,o=ZP(t.getState(),XP(n));(o==null?void 0:o.activeIndex)!=null&&t.dispatch(aie({activeIndex:o.activeIndex,activeDataKey:void 0,activeCoordinate:o.activeCoordinate}))}});var jA=Pu("mouseMove"),tV=Gx(),yb=null;tV.startListening({actionCreator:jA,effect:(e,t)=>{var n=e.payload;yb!==null&&cancelAnimationFrame(yb);var o=XP(n);yb=requestAnimationFrame(()=>{var u=t.getState(),d=LP(u,u.tooltip.settings.shared);if(d==="axis"){var g=ZP(u,o);(g==null?void 0:g.activeIndex)!=null?t.dispatch(lU({activeIndex:g.activeIndex,activeDataKey:void 0,activeCoordinate:g.activeCoordinate})):t.dispatch(aU())}yb=null})}});function Tce(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":e==="children"&&typeof t=="object"&&t!==null?"<<CHILDREN>>":t}var sN={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0,reverseStackOrder:!1},nV=oc({name:"rootProps",initialState:sN,reducers:{updateOptions:(e,t)=>{var n;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=(n=t.payload.barGap)!==null&&n!==void 0?n:sN.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className,e.baseValue=t.payload.baseValue,e.reverseStackOrder=t.payload.reverseStackOrder}}}),Ece=nV.reducer,{updateOptions:Ace}=nV.actions,rV=oc({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:Cce}=rV.actions,Pce=rV.reducer,iV=Pu("keyDown"),sV=Pu("focus"),YP=Gx();YP.startListening({actionCreator:iV,effect:(e,t)=>{var n=t.getState(),o=n.rootProps.accessibilityLayer!==!1;if(o){var{keyboardInteraction:u}=n.tooltip,d=e.payload;if(!(d!=="ArrowRight"&&d!=="ArrowLeft"&&d!=="Enter")){var g=jP(u,Uy(n),n0(n),s0(n)),i=g==null?-1:Number(g);if(!(!Number.isFinite(i)||i<0)){var E=Sp(n);if(d==="Enter"){var P=U1(n,"axis","hover",String(u.index));t.dispatch(kA({active:!u.active,activeIndex:u.index,activeCoordinate:P}));return}var I=Kre(n),D=I==="left-to-right"?1:-1,F=d==="ArrowRight"?1:-1,$=i+F*D;if(!(E==null||$>=E.length||$<0)){var Z=U1(n,"axis","hover",String($));t.dispatch(kA({active:!0,activeIndex:$.toString(),activeCoordinate:Z}))}}}}}});YP.startListening({actionCreator:sV,effect:(e,t)=>{var n=t.getState(),o=n.rootProps.accessibilityLayer!==!1;if(o){var{keyboardInteraction:u}=n.tooltip;if(!u.active&&u.index==null){var d="0",g=U1(n,"axis","hover",String(d));t.dispatch(kA({active:!0,activeIndex:d,activeCoordinate:g}))}}}});var wu=Pu("externalEvent"),oV=Gx(),_E=new Map;oV.startListening({actionCreator:wu,effect:(e,t)=>{var{handler:n,reactEvent:o}=e.payload;if(n!=null){o.persist();var u=o.type,d=_E.get(u);d!==void 0&&cancelAnimationFrame(d);var g=requestAnimationFrame(()=>{try{var i=t.getState(),E={activeCoordinate:qie(i),activeDataKey:xU(i),activeIndex:Ax(i),activeLabel:vU(i),activeTooltipIndex:Ax(i),isTooltipActive:Zie(i)};n(E,o)}finally{_E.delete(u)}});_E.set(u,g)}}});var Ice=Ht([Fy],e=>e.tooltipItemPayloads),Mce=Ht([Ice,i0,(e,t)=>t,(e,t,n)=>n],(e,t,n,o)=>{var u=e.find(i=>i.settings.graphicalItemId===o);if(u!=null){var{positions:d}=u;if(d!=null){var g=t(d,n);return g}}}),aV=Pu("touchMove"),lV=Gx();lV.startListening({actionCreator:aV,effect:(e,t)=>{var n=e.payload;if(!(n.touches==null||n.touches.length===0)){var o=t.getState(),u=LP(o,o.tooltip.settings.shared);if(u==="axis"){var d=n.touches[0];if(d==null)return;var g=ZP(o,XP({clientX:d.clientX,clientY:d.clientY,currentTarget:n.currentTarget}));(g==null?void 0:g.activeIndex)!=null&&t.dispatch(lU({activeIndex:g.activeIndex,activeDataKey:void 0,activeCoordinate:g.activeCoordinate}))}else if(u==="item"){var i,E=n.touches[0];if(document.elementFromPoint==null||E==null)return;var P=document.elementFromPoint(E.clientX,E.clientY);if(!P||!P.getAttribute)return;var I=P.getAttribute(a5),D=(i=P.getAttribute(l5))!==null&&i!==void 0?i:void 0,F=By(o).find(q=>q.id===D);if(I==null||F==null||D==null)return;var{dataKey:$}=F,Z=Mce(o,I,D);t.dispatch(oU({activeDataKey:$,activeIndex:I,activeCoordinate:Z,activeGraphicalItemId:D}))}}}});var kce=MB({brush:Kle,cartesianAxis:Wle,chartData:qse,errorBars:rce,graphicalItems:mle,layout:xK,legend:MJ,options:Vse,polarAxis:Aae,polarOptions:Pce,referenceElements:Qle,rootProps:Ece,tooltip:lie,zIndex:Ise}),Rce=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Chart";return GY({reducer:kce,preloadedState:t,middleware:o=>{var u;return o({serializableCheck:!1,immutableCheck:!["commonjs","es6","production"].includes((u="es6")!==null&&u!==void 0?u:"")}).concat([eV.middleware,tV.middleware,YP.middleware,oV.middleware,lV.middleware])},enhancers:o=>{var u=o;return typeof o=="function"&&(u=o()),u.concat(GB({type:"raf"}))},devTools:{serialize:{replacer:Tce},name:"recharts-".concat(n)}})};function Oce(e){var{preloadedState:t,children:n,reduxStoreName:o}=e,u=Dm(),d=te.useRef(null);if(u)return n;d.current==null&&(d.current=Rce(t,o));var g=SC;return te.createElement(vce,{context:g,store:d.current},n)}function Dce(e){var{layout:t,margin:n}=e,o=qo(),u=Dm();return te.useEffect(()=>{u||(o(_K(t)),o(gK(n)))},[o,u,t,n]),null}var Lce=te.memo(Dce,wce);function jce(e){var t=qo();return te.useEffect(()=>{t(Ace(e))},[t,e]),null}function oN(e){var{zIndex:t,isPanorama:n}=e,o=te.useRef(null),u=qo();return te.useLayoutEffect(()=>(o.current&&u(Cse({zIndex:t,element:o.current,isPanorama:n})),()=>{u(Pse({zIndex:t,isPanorama:n}))}),[u,t,n]),te.createElement("g",{tabIndex:-1,ref:o})}function aN(e){var{children:t,isPanorama:n}=e,o=ii(_se);if(!o||o.length===0)return t;var u=o.filter(g=>g<0),d=o.filter(g=>g>0);return te.createElement(te.Fragment,null,u.map(g=>te.createElement(oN,{key:g,zIndex:g,isPanorama:n})),t,d.map(g=>te.createElement(oN,{key:g,zIndex:g,isPanorama:n})))}var zce=["children"];function Nce(e,t){if(e==null)return{};var n,o,u=Fce(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function Fce(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}function W1(){return W1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},W1.apply(null,arguments)}var Bce={width:"100%",height:"100%",display:"block"},Uce=te.forwardRef((e,t)=>{var n=dJ(),o=fJ(),u=x5();if(!Pm(n)||!Pm(o))return null;var{children:d,otherAttributes:g,title:i,desc:E}=e,P,I;return g!=null&&(typeof g.tabIndex=="number"?P=g.tabIndex:P=u?0:void 0,typeof g.role=="string"?I=g.role:I=u?"application":void 0),te.createElement(ZF,W1({},g,{title:i,desc:E,role:I,tabIndex:P,width:n,height:o,style:Bce,ref:t}),d)}),Vce=e=>{var{children:t}=e,n=ii(kw);if(!n)return null;var{width:o,height:u,y:d,x:g}=n;return te.createElement(ZF,{width:o,height:u,x:g,y:d},t)},lN=te.forwardRef((e,t)=>{var{children:n}=e,o=Nce(e,zce),u=Dm();return u?te.createElement(Vce,null,te.createElement(aN,{isPanorama:!0},n)):te.createElement(Uce,W1({ref:t},o),te.createElement(aN,{isPanorama:!1},n))});function $ce(){var e=qo(),[t,n]=te.useState(null),o=ii(LK);return te.useEffect(()=>{if(t!=null){var u=t.getBoundingClientRect(),d=u.width/t.offsetWidth;Do(d)&&d!==o&&e(vK(d))}},[t,e,o]),n}function cN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function Hce(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cN(Object(n),!0).forEach(function(o){Gce(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cN(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Gce(e,t,n){return(t=Wce(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wce(e){var t=qce(e,"string");return typeof t=="symbol"?t:t+""}function qce(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function n_(){return n_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n_.apply(null,arguments)}var Zce=()=>(noe(),null);function q1(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=parseFloat(e);if(!Number.isNaN(t))return t}return 0}var Xce=te.forwardRef((e,t)=>{var n,o,u=te.useRef(null),[d,g]=te.useState({containerWidth:q1((n=e.style)===null||n===void 0?void 0:n.width),containerHeight:q1((o=e.style)===null||o===void 0?void 0:o.height)}),i=te.useCallback((P,I)=>{g(D=>{var F=Math.round(P),$=Math.round(I);return D.containerWidth===F&&D.containerHeight===$?D:{containerWidth:F,containerHeight:$}})},[]),E=te.useCallback(P=>{if(typeof t=="function"&&t(P),P!=null&&typeof ResizeObserver<"u"){var{width:I,height:D}=P.getBoundingClientRect();i(I,D);var F=Z=>{var{width:q,height:X}=Z[0].contentRect;i(q,X)},$=new ResizeObserver(F);$.observe(P),u.current=$}},[t,i]);return te.useEffect(()=>()=>{var P=u.current;P!=null&&P.disconnect()},[i]),te.createElement(te.Fragment,null,te.createElement(Dw,{width:d.containerWidth,height:d.containerHeight}),te.createElement("div",n_({ref:E},e)))}),Yce=te.forwardRef((e,t)=>{var{width:n,height:o}=e,[u,d]=te.useState({containerWidth:q1(n),containerHeight:q1(o)}),g=te.useCallback((E,P)=>{d(I=>{var D=Math.round(E),F=Math.round(P);return I.containerWidth===D&&I.containerHeight===F?I:{containerWidth:D,containerHeight:F}})},[]),i=te.useCallback(E=>{if(typeof t=="function"&&t(E),E!=null){var{width:P,height:I}=E.getBoundingClientRect();g(P,I)}},[t,g]);return te.createElement(te.Fragment,null,te.createElement(Dw,{width:u.containerWidth,height:u.containerHeight}),te.createElement("div",n_({ref:i},e)))}),Kce=te.forwardRef((e,t)=>{var{width:n,height:o}=e;return te.createElement(te.Fragment,null,te.createElement(Dw,{width:n,height:o}),te.createElement("div",n_({ref:t},e)))}),Jce=te.forwardRef((e,t)=>{var{width:n,height:o}=e;return fp(n)||fp(o)?te.createElement(Yce,n_({},e,{ref:t})):te.createElement(Kce,n_({},e,{ref:t}))});function Qce(e){return e===!0?Xce:Jce}var eue=te.forwardRef((e,t)=>{var{children:n,className:o,height:u,onClick:d,onContextMenu:g,onDoubleClick:i,onMouseDown:E,onMouseEnter:P,onMouseLeave:I,onMouseMove:D,onMouseUp:F,onTouchEnd:$,onTouchMove:Z,onTouchStart:q,style:X,width:re,responsive:le,dispatchTouchEvents:ue=!0}=e,ye=te.useRef(null),ge=qo(),[we,Le]=te.useState(null),[Ze,Ge]=te.useState(null),gt=$ce(),lt=MC(),qe=(lt==null?void 0:lt.width)>0?lt.width:re,en=(lt==null?void 0:lt.height)>0?lt.height:u,Jt=te.useCallback(Tt=>{gt(Tt),typeof t=="function"&&t(Tt),Le(Tt),Ge(Tt),Tt!=null&&(ye.current=Tt)},[gt,t,Le,Ge]),Nt=te.useCallback(Tt=>{ge(QU(Tt)),ge(wu({handler:d,reactEvent:Tt}))},[ge,d]),St=te.useCallback(Tt=>{ge(jA(Tt)),ge(wu({handler:P,reactEvent:Tt}))},[ge,P]),an=te.useCallback(Tt=>{ge(aU()),ge(wu({handler:I,reactEvent:Tt}))},[ge,I]),Kt=te.useCallback(Tt=>{ge(jA(Tt)),ge(wu({handler:D,reactEvent:Tt}))},[ge,D]),hn=te.useCallback(()=>{ge(sV())},[ge]),Xt=te.useCallback(Tt=>{ge(iV(Tt.key))},[ge]),et=te.useCallback(Tt=>{ge(wu({handler:g,reactEvent:Tt}))},[ge,g]),zt=te.useCallback(Tt=>{ge(wu({handler:i,reactEvent:Tt}))},[ge,i]),Zn=te.useCallback(Tt=>{ge(wu({handler:E,reactEvent:Tt}))},[ge,E]),$n=te.useCallback(Tt=>{ge(wu({handler:F,reactEvent:Tt}))},[ge,F]),fr=te.useCallback(Tt=>{ge(wu({handler:q,reactEvent:Tt}))},[ge,q]),kn=te.useCallback(Tt=>{ue&&ge(aV(Tt)),ge(wu({handler:Z,reactEvent:Tt}))},[ge,ue,Z]),Bt=te.useCallback(Tt=>{ge(wu({handler:$,reactEvent:Tt}))},[ge,$]),En=Qce(le);return te.createElement(CU.Provider,{value:we},te.createElement(wZ.Provider,{value:Ze},te.createElement(En,{width:qe??(X==null?void 0:X.width),height:en??(X==null?void 0:X.height),className:Oo("recharts-wrapper",o),style:Hce({position:"relative",cursor:"default",width:qe,height:en},X),onClick:Nt,onContextMenu:et,onDoubleClick:zt,onFocus:hn,onKeyDown:Xt,onMouseDown:Zn,onMouseEnter:St,onMouseLeave:an,onMouseMove:Kt,onMouseUp:$n,onTouchEnd:Bt,onTouchMove:kn,onTouchStart:fr,ref:Jt},te.createElement(Zce,null),n)))}),tue=["width","height","responsive","children","className","style","compact","title","desc"];function nue(e,t){if(e==null)return{};var n,o,u=rue(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function rue(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var iue=te.forwardRef((e,t)=>{var{width:n,height:o,responsive:u,children:d,className:g,style:i,compact:E,title:P,desc:I}=e,D=nue(e,tue),F=my(D);return E?te.createElement(te.Fragment,null,te.createElement(Dw,{width:n,height:o}),te.createElement(lN,{otherAttributes:F,title:P,desc:I},d)):te.createElement(eue,{className:g,style:i,width:n,height:o,responsive:u??!1,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},te.createElement(lN,{otherAttributes:F,title:P,desc:I,ref:t},te.createElement(tce,null,d)))});function sue(e){var t=qo();return te.useEffect(()=>{t(Cce(e))},[t,e]),null}var oue=["layout"];function zA(){return zA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},zA.apply(null,arguments)}function aue(e,t){if(e==null)return{};var n,o,u=lue(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(o=0;o<d.length;o++)n=d[o],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(u[n]=e[n])}return u}function lue(e,t){if(e==null)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.indexOf(o)!==-1)continue;n[o]=e[o]}return n}var cue={top:5,right:5,bottom:5,left:5},cV={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:cue,reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},uue=te.forwardRef(function(t,n){var o,u=Gd(t.categoricalChartProps,cV),{layout:d}=u,g=aue(u,oue),{chartName:i,defaultTooltipEventType:E,validateTooltipEventTypes:P,tooltipPayloadSearcher:I}=t,D={chartName:i,defaultTooltipEventType:E,validateTooltipEventTypes:P,tooltipPayloadSearcher:I,eventEmitter:void 0};return te.createElement(Oce,{preloadedState:{options:D},reduxStoreName:(o=u.id)!==null&&o!==void 0?o:i},te.createElement(Yle,{chartData:u.data}),te.createElement(Lce,{layout:d,margin:u.margin}),te.createElement(jce,{baseValue:void 0,accessibilityLayer:u.accessibilityLayer,barCategoryGap:u.barCategoryGap,maxBarSize:u.maxBarSize,stackOffset:u.stackOffset,barGap:u.barGap,barSize:u.barSize,syncId:u.syncId,syncMethod:u.syncMethod,className:u.className,reverseStackOrder:u.reverseStackOrder}),te.createElement(sue,{cx:u.cx,cy:u.cy,startAngle:u.startAngle,endAngle:u.endAngle,innerRadius:u.innerRadius,outerRadius:u.outerRadius}),te.createElement(iue,zA({},g,{ref:n})))});function uN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),n.push.apply(n,o)}return n}function hN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uN(Object(n),!0).forEach(function(o){hue(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uN(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function hue(e,t,n){return(t=due(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function due(e){var t=fue(e,"string");return typeof t=="symbol"?t:t+""}function fue(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pue=["item"],mue=hN(hN({},cV),{},{layout:"centric",startAngle:0,endAngle:360}),gue=te.forwardRef((e,t)=>{var n=Gd(e,mue);return te.createElement(uue,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:pue,tooltipPayloadSearcher:Bse,categoricalChartProps:n,ref:t})});const vb=["#199b49","#65cbf3","#b37af5","#e2a73a","#ef8844"];function _ue({region:e,onClose:t}){var F;const[n,o]=te.useState("overview"),[u,d]=te.useState("pie");if(!e)return null;const g=e.stats||{},i=g.varieties||[],E=g.total_planted_ha||0,P=te.useMemo(()=>{if(!i.length)return[];const $=i.slice(0,5),Z=i.slice(5).reduce((X,re)=>X+(re.percentage||0),0),q=$.map((X,re)=>({name:X.name,value:X.percentage||0,area:X.area_ha||0,color:vb[re%vb.length]}));return Z>0&&q.push({name:"Other",value:Z,area:E-$.reduce((X,re)=>X+(re.area_ha||0),0),color:"#94a3b8"}),q},[i,E]),I=($,Z=1)=>!$&&$!==0?"":new Intl.NumberFormat("en-NZ",{maximumFractionDigits:Z,minimumFractionDigits:Z}).format($),D=({active:$,payload:Z})=>{if($&&Z&&Z.length){const q=Z[0].payload;return b.jsxs("div",{className:"stats-chart-tooltip",children:[b.jsx("p",{className:"tooltip-name",children:q.name}),b.jsxs("p",{className:"tooltip-value",children:[I(q.value),"%"]}),b.jsxs("p",{className:"tooltip-area",children:[I(q.area,2)," ha"]})]})}return null};return b.jsx("div",{className:"stats-modal-overlay",onClick:t,children:b.jsxs("div",{className:"stats-modal",onClick:$=>$.stopPropagation(),children:[b.jsxs("div",{className:"stats-modal-header",children:[b.jsxs("div",{className:"stats-modal-title",children:[b.jsx(aa,{size:24}),b.jsxs("div",{children:[b.jsx("h2",{children:e.name}),b.jsxs("span",{className:"stats-subtitle",children:["Regional Statistics ",g.year||2024]})]})]}),b.jsx("button",{className:"stats-modal-close",onClick:t,children:b.jsx(hl,{size:24})})]}),b.jsxs("div",{className:"stats-modal-tabs",children:[b.jsxs("button",{className:`stats-tab ${n==="overview"?"active":""}`,onClick:()=>o("overview"),children:[b.jsx(lC,{size:16}),"Overview"]}),b.jsxs("button",{className:`stats-tab ${n==="varieties"?"active":""}`,onClick:()=>o("varieties"),children:[b.jsx($d,{size:16}),"All Varieties"]})]}),b.jsxs("div",{className:"stats-modal-content",children:[n==="overview"&&b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"stats-summary-grid",children:[b.jsxs("div",{className:"summary-card",children:[b.jsx("div",{className:"summary-icon",children:b.jsx(aa,{size:20})}),b.jsxs("div",{className:"summary-info",children:[b.jsx("span",{className:"summary-label",children:"Total Planted Area"}),b.jsxs("span",{className:"summary-value",children:[I(E,2)," ha"]})]})]}),b.jsxs("div",{className:"summary-card",children:[b.jsx("div",{className:"summary-icon",children:b.jsx($d,{size:20})}),b.jsxs("div",{className:"summary-info",children:[b.jsx("span",{className:"summary-label",children:"Varieties Grown"}),b.jsx("span",{className:"summary-value",children:i.length})]})]}),b.jsxs("div",{className:"summary-card highlight",children:[b.jsx("div",{className:"summary-icon",children:b.jsx(Am,{size:20})}),b.jsxs("div",{className:"summary-info",children:[b.jsx("span",{className:"summary-label",children:"Top Variety"}),b.jsx("span",{className:"summary-value",children:((F=i[0])==null?void 0:F.name)||""}),b.jsx("span",{className:"summary-detail",children:i[0]?`${I(i[0].percentage)}% of region`:""})]})]})]}),b.jsx("div",{className:"chart-section",children:b.jsx("div",{className:"chart-container",children:P.length>0?b.jsx(cJ,{width:"100%",height:300,children:b.jsxs(gue,{children:[b.jsx(ZU,{data:P,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",label:({name:$,value:Z})=>`${$}: ${I(Z)}%`,labelLine:!1,children:P.map(($,Z)=>b.jsx(Qw,{fill:$.color},`cell-${Z}`))}),b.jsx(uoe,{content:b.jsx(D,{})})]})}):b.jsx("div",{className:"no-data",children:"No variety data available"})})})]}),n==="varieties"&&b.jsxs("div",{className:"varieties-table-section",children:[b.jsx("div",{className:"table-header",children:b.jsxs("h3",{children:["All Varieties (",i.length,")"]})}),b.jsx("div",{className:"varieties-table-wrapper",children:b.jsxs("table",{className:"varieties-table",children:[b.jsx("thead",{children:b.jsxs("tr",{children:[b.jsx("th",{children:"#"}),b.jsx("th",{children:"Variety"}),b.jsx("th",{className:"text-right",children:"Area (ha)"}),b.jsx("th",{className:"text-right",children:"% of Region"})]})}),b.jsx("tbody",{children:i.map(($,Z)=>b.jsxs("tr",{children:[b.jsx("td",{className:"rank-cell",children:b.jsx("span",{className:"rank-badge",style:{backgroundColor:Z<5?vb[Z]:"#94a3b8"},children:Z+1})}),b.jsx("td",{className:"variety-cell",children:$.name}),b.jsx("td",{className:"text-right",children:I($.area_ha,2)}),b.jsxs("td",{className:"text-right percent-cell",children:[b.jsx("div",{className:"percent-bar-container",children:b.jsx("div",{className:"percent-bar",style:{width:`${Math.min($.percentage,100)}%`,backgroundColor:Z<5?vb[Z]:"#94a3b8"}})}),b.jsxs("span",{children:[I($.percentage),"%"]})]})]},Z))}),b.jsx("tfoot",{children:b.jsxs("tr",{children:[b.jsx("td",{}),b.jsx("td",{children:b.jsx("strong",{children:"Total"})}),b.jsx("td",{className:"text-right",children:b.jsx("strong",{children:I(E,2)})}),b.jsx("td",{className:"text-right",children:b.jsx("strong",{children:"100%"})})]})})]})})]})]}),b.jsx("div",{className:"stats-modal-footer",children:b.jsxs("span",{className:"stats-source",children:["Source: ",g.source||"NZ Winegrowers Annual Report 2024"]})})]})})}const yue=[{id:"satellite-streets-v12",name:"Satellite",icon:""},{id:"streets-v12",name:"Streets",icon:""},{id:"outdoors-v12",name:"Outdoors",icon:""}],vue=[{name:"Northland",slug:"northland",bounds:{min_lng:173,min_lat:-35.8,max_lng:174.5,max_lat:-34.4}},{name:"Auckland",slug:"auckland",bounds:{min_lng:174.4,min_lat:-37.2,max_lng:175.3,max_lat:-36.2}},{name:"Waikato / Bay of Plenty",slug:"waikato-bay-of-plenty",bounds:{min_lng:175,min_lat:-38.8,max_lng:178,max_lat:-36.8}},{name:"Gisborne",slug:"gisborne",bounds:{min_lng:177,min_lat:-39,max_lng:178.7,max_lat:-37.5}},{name:"Hawke's Bay",slug:"hawkes-bay",bounds:{min_lng:176,min_lat:-40,max_lng:178,max_lat:-38.5}},{name:"Wairarapa",slug:"wairarapa",bounds:{min_lng:175.2,min_lat:-41.5,max_lng:176.2,max_lat:-40.8}},{name:"Nelson",slug:"nelson",bounds:{min_lng:172.5,min_lat:-41.8,max_lng:173.5,max_lat:-40.8}},{name:"Marlborough",slug:"marlborough",bounds:{min_lng:173,min_lat:-42.2,max_lng:174.5,max_lat:-41}},{name:"North Canterbury",slug:"north-canterbury",bounds:{min_lng:172,min_lat:-43.3,max_lng:173.5,max_lat:-42.5}},{name:"Waitaki Valley",slug:"waitaki-valley",bounds:{min_lng:170,min_lat:-45.2,max_lng:171.5,max_lat:-44.5}},{name:"Central Otago",slug:"central-otago",bounds:{min_lng:168.5,min_lat:-45.5,max_lng:170,max_lat:-44.5}}];function xue({currentStyle:e,onStyleChange:t,opacity:n,onOpacityChange:o,showBlocks:u=!0,onToggleBlocks:d,showRegions:g=!0,onToggleRegions:i,regionOpacity:E=.5,onRegionOpacityChange:P,showGIs:I=!0,onToggleGIs:D,giOpacity:F=0,onRegionClick:$}){const[Z,q]=te.useState(!1),[X,re]=te.useState("layers"),[le,ue]=te.useState([]),[ye,ge]=te.useState(!0),[we,Le]=te.useState(!1),[Ze,Ge]=te.useState(!1);te.useEffect(()=>{const St=()=>{Le(window.innerWidth<=768)};return St(),window.addEventListener("resize",St),()=>window.removeEventListener("resize",St)},[]),te.useEffect(()=>{gt()},[]);const gt=async()=>{try{ge(!0);const St=await ui.get("/public/regions");ue(St.data)}catch(St){console.error("Error loading regions:",St),ue(vue)}finally{ge(!1)}},lt=St=>{re(X===St?null:St)},qe=St=>St?St>=1e3?`${(St/1e3).toFixed(1)}k ha`:`${Math.round(St)} ha`:"",en=St=>{$(St),we&&Ge(!1)},Jt=()=>{Ge(!1)},Nt=()=>b.jsxs("div",{className:"sidebar-content",children:[b.jsxs("div",{className:"sidebar-section",children:[b.jsxs("button",{className:"section-header",onClick:()=>lt("styles"),children:[b.jsxs("div",{className:"section-title",children:[b.jsx(gO,{size:18}),b.jsx("span",{children:"Map Styles"})]}),b.jsx(Fd,{size:16,className:`chevron ${X==="styles"?"rotated":""}`})]}),X==="styles"&&b.jsx("div",{className:"section-content",children:b.jsx("div",{className:"style-options",children:yue.map(St=>b.jsxs("button",{className:`style-btn ${e===St.id?"active":""}`,onClick:()=>t(St.id),children:[b.jsx("span",{className:"style-icon",children:St.icon}),b.jsx("span",{className:"style-name",children:St.name})]},St.id))})})]}),b.jsxs("div",{className:"sidebar-section",children:[b.jsxs("button",{className:"section-header",onClick:()=>lt("layers"),children:[b.jsxs("div",{className:"section-title",children:[b.jsx(R2,{size:18}),b.jsx("span",{children:"Layers"})]}),b.jsx(Fd,{size:16,className:`chevron ${X==="layers"?"rotated":""}`})]}),X==="layers"&&b.jsxs("div",{className:"section-content",children:[b.jsxs("div",{className:"layer-item",children:[b.jsx("div",{className:"layer-header",children:b.jsxs("label",{className:"layer-label",children:[b.jsx("button",{className:"layer-toggle-btn",onClick:d,title:u?"Hide layer":"Show layer",children:u?b.jsx(Fb,{size:16}):b.jsx(k2,{size:16})}),b.jsx($d,{size:14,className:"layer-icon-grape"}),b.jsx("span",{children:"Vineyard Blocks"})]})}),u&&b.jsxs("div",{className:"opacity-control",children:[b.jsxs("label",{htmlFor:"block-opacity-slider",children:["Opacity: ",Math.round(n*100),"%"]}),b.jsx("input",{id:"block-opacity-slider",type:"range",min:"0",max:"1",step:"0.05",value:n,onChange:St=>o(parseFloat(St.target.value)),className:"opacity-slider"})]})]}),b.jsxs("div",{className:"layer-item",children:[b.jsx("div",{className:"layer-header",children:b.jsxs("label",{className:"layer-label",children:[b.jsx("button",{className:"layer-toggle-btn",onClick:i,title:g?"Hide layer":"Show layer",children:g?b.jsx(Fb,{size:16}):b.jsx(k2,{size:16})}),b.jsx(aa,{size:14,className:"layer-icon-region"}),b.jsx("span",{children:"Wine Regions"})]})}),g&&b.jsxs("div",{className:"opacity-control",children:[b.jsxs("label",{htmlFor:"region-opacity-slider",children:["Opacity: ",Math.round(E*100),"%"]}),b.jsx("input",{id:"region-opacity-slider",type:"range",min:"0",max:"1",step:"0.05",value:E,onChange:St=>P(parseFloat(St.target.value)),className:"opacity-slider"})]})]}),b.jsx("div",{className:"layer-item",children:b.jsx("div",{className:"layer-header",children:b.jsxs("label",{className:"layer-label",children:[b.jsx("button",{className:"layer-toggle-btn",onClick:D,title:I?"Hide layer":"Show layer",children:I?b.jsx(Fb,{size:16}):b.jsx(k2,{size:16})}),b.jsx(Fg,{size:14,className:"layer-icon-gi"}),b.jsx("span",{children:"Protected GIs"})]})})})]})]}),b.jsxs("div",{className:"sidebar-section",children:[b.jsxs("button",{className:"section-header",onClick:()=>lt("regions"),children:[b.jsxs("div",{className:"section-title",children:[b.jsx(aa,{size:18}),b.jsx("span",{children:"Explore Regions"})]}),b.jsx(Fd,{size:16,className:`chevron ${X==="regions"?"rotated":""}`})]}),X==="regions"&&b.jsx("div",{className:"section-content",children:ye?b.jsxs("div",{className:"loading-regions",children:[b.jsx("div",{className:"loading-spinner small"}),b.jsx("span",{children:"Loading regions..."})]}):b.jsx("div",{className:"regions-list",children:le.map(St=>b.jsxs("button",{className:"region-btn",onClick:()=>en(St),children:[b.jsx(aa,{size:14}),b.jsx("span",{className:"region-name",children:St.name}),St.total_planted_ha&&b.jsx("span",{className:"region-area",children:qe(St.total_planted_ha)})]},St.slug))})})]}),b.jsxs("div",{className:"sidebar-section",children:[b.jsx("div",{className:"section-header",style:{cursor:"default"},children:b.jsx("div",{className:"section-title",children:b.jsx("span",{children:"Legend"})})}),b.jsx("div",{className:"section-content",children:b.jsxs("div",{className:"legend-content",children:[b.jsxs("div",{className:"legend-item",children:[b.jsx("div",{className:"legend-color",style:{backgroundColor:"#22c55e"}}),b.jsx("span",{children:"Vineyard Blocks"})]}),b.jsxs("div",{className:"legend-item",children:[b.jsx("div",{className:"legend-color",style:{backgroundColor:"#3b82f6"}}),b.jsx("span",{children:"Wine Regions"})]}),b.jsxs("div",{className:"legend-item",children:[b.jsx("div",{className:"legend-color",style:{backgroundColor:"#961111"}}),b.jsx("span",{children:"Protected GIs"})]}),b.jsx("p",{className:"legend-note",children:"Click any feature to view details"})]})})]})]});return we?b.jsxs(b.Fragment,{children:[Ze&&b.jsx("div",{className:"mobile-sidebar-overlay",onClick:Jt}),b.jsxs("div",{className:`map-sidebar-mobile ${Ze?"expanded":""}`,children:[b.jsxs("button",{className:"mobile-sidebar-header",onClick:()=>Ge(!Ze),"aria-expanded":Ze,"aria-label":Ze?"Collapse map controls":"Expand map controls",children:[b.jsx("div",{className:"mobile-drag-handle"}),b.jsxs("div",{className:"mobile-header-content",children:[b.jsx(R2,{size:18}),b.jsx("span",{children:"Map Controls"}),Ze?b.jsx(Iy,{size:20}):b.jsx(uF,{size:20})]})]}),Ze&&b.jsx("div",{className:"mobile-sidebar-content",children:Nt()})]})]}):b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:`map-sidebar ${Z?"collapsed":""}`,children:[b.jsx("button",{className:"sidebar-toggle",onClick:()=>q(!Z),"aria-label":Z?"Expand sidebar":"Collapse sidebar",children:Z?b.jsx(Fd,{size:20}):b.jsx(cC,{size:20})}),!Z&&Nt()]}),Z&&b.jsxs("div",{className:"sidebar-collapsed-buttons",children:[b.jsx("button",{className:"collapsed-btn",onClick:()=>{q(!1),re("styles")},title:"Map Styles",children:b.jsx(gO,{size:20})}),b.jsx("button",{className:"collapsed-btn",onClick:()=>{q(!1),re("layers")},title:"Layers",children:b.jsx(R2,{size:20})}),b.jsx("button",{className:"collapsed-btn",onClick:()=>{q(!1),re("regions")},title:"Regions",children:b.jsx(aa,{size:20})})]})]})}nx.accessToken="pk.eyJ1IjoicGV0ZXRheWxvciIsImEiOiJjbTRtaHNxcHAwZDZ4MmxwbjZkeXNneTZnIn0.RJ9B3Q3-t_-gFrEkgshH9Q";nx.accessToken?console.log(" Mapbox token loaded successfully"):console.error(" Missing Mapbox token. Set VITE_MAPBOX_TOKEN in root/.env file");const xb={min_lng:166,max_lng:179,min_lat:-47.5,max_lat:-34},bue="#22c55e",wue="#065f46",Sue="#16a34a",Tue="#3b82f6",Eue="#1d4ed8",Aue="#8a5cf600",Cue="#961111";function dN(){const e=te.useRef(null),t=te.useRef(null),n=te.useRef(null);te.useRef(null),te.useRef(null);const{isAuthenticated:o}=Ry(),[u,d]=te.useState(!1),[g,i]=te.useState("satellite-streets-v12"),[E,P]=te.useState(null),[I,D]=te.useState(null),[F,$]=te.useState(null),[Z,q]=te.useState(!1),[X,re]=te.useState(!1),[le,ue]=te.useState(null),[ye,ge]=te.useState(!0),[we,Le]=te.useState(!0),[Ze,Ge]=te.useState(!0),[gt,lt]=te.useState(.7),[qe,en]=te.useState(.3),[Jt,Nt]=te.useState(0),[St,an]=te.useState(null),[Kt,hn]=te.useState(null),[Xt,et]=te.useState(null),[zt,Zn]=te.useState(null);te.useEffect(()=>{if(!t.current)return t.current=new nx.Map({container:e.current,style:`mapbox://styles/mapbox/${g}`,center:[171.5,-41.5],zoom:5.5,minZoom:5,maxZoom:18,maxBounds:[[xb.min_lng-2,xb.min_lat-2],[xb.max_lng+2,xb.max_lat+2]]}),t.current.addControl(new nx.NavigationControl,"top-right"),t.current.addControl(new nx.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-right"),t.current.on("load",()=>{console.log(" Map loaded successfully"),d(!0)}),()=>{t.current&&(t.current.remove(),t.current=null)}},[]),te.useEffect(()=>{!u||!o||($n(),fr(),kn())},[u,o]);const $n=async()=>{var Sn;if(!E){q(!0),ue(null);try{console.log(" Fetching blocks GeoJSON...");const si=await ui.get("/public/blocks/geojson");console.log(` Loaded ${si.data.features.length} blocks`),P(si.data)}catch(si){console.error(" Error loading blocks:",si),((Sn=si.response)==null?void 0:Sn.status)===429&&ue("Rate limit exceeded. Please try again later.")}finally{q(!1)}}},fr=async()=>{if(!I)try{console.log(" Fetching regions GeoJSON...");const Sn=await ui.get("/public/regions/geojson");console.log(` Loaded ${Sn.data.features.length} regions`),D(Sn.data)}catch(Sn){console.error(" Error loading regions:",Sn)}},kn=async()=>{if(!F)try{console.log(" Fetching GIs GeoJSON...");const Sn=await ui.get("/public/gis/geojson");console.log(` Loaded ${Sn.data.features.length} GIs`),$(Sn.data)}catch(Sn){console.error(" Error loading GIs:",Sn)}};te.useEffect(()=>{!t.current||!u||(I&&we&&En(),F&&Ze&&Tt(),E&&ye&&Bt())},[u,E,I,F]);const Bt=()=>{if(!(!t.current||!E))try{wn("blocks-fill"),wn("blocks-outline"),mr("blocks"),t.current.addSource("blocks",{type:"geojson",data:E,generateId:!0}),t.current.addLayer({id:"blocks-fill",type:"fill",source:"blocks",paint:{"fill-color":["case",["boolean",["feature-state","hover"],!1],Sue,bue],"fill-opacity":gt}}),t.current.addLayer({id:"blocks-outline",type:"line",source:"blocks",paint:{"line-color":wue,"line-width":["case",["boolean",["feature-state","hover"],!1],2,1]}}),t.current.on("click","blocks-fill",tn),t.current.on("mousemove","blocks-fill",Sn=>{Sn.features.length!==0&&(n.current!==null&&t.current.setFeatureState({source:"blocks",id:n.current},{hover:!1}),n.current=Sn.features[0].id,t.current.setFeatureState({source:"blocks",id:n.current},{hover:!0}),t.current.getCanvas().style.cursor="pointer")}),t.current.on("mouseleave","blocks-fill",()=>{n.current!==null&&t.current.setFeatureState({source:"blocks",id:n.current},{hover:!1}),n.current=null,t.current.getCanvas().style.cursor=""}),console.log(" Blocks layer added")}catch(Sn){console.error("Error adding blocks layer:",Sn)}},En=()=>{if(!(!t.current||!I))try{wn("regions-fill"),wn("regions-outline"),mr("regions"),t.current.addSource("regions",{type:"geojson",data:I,generateId:!0}),t.current.addLayer({id:"regions-fill",type:"fill",source:"regions",paint:{"fill-color":["coalesce",["get","color"],Tue],"fill-opacity":qe}},"blocks-fill"),t.current.addLayer({id:"regions-outline",type:"line",source:"regions",paint:{"line-color":Eue,"line-width":2,"line-opacity":.8}},"blocks-fill"),t.current.on("click","regions-fill",Ii),t.current.on("mouseenter","regions-fill",()=>{t.current.getCanvas().style.cursor="pointer"}),t.current.on("mouseleave","regions-fill",()=>{t.current.getCanvas().style.cursor=""}),console.log(" Regions layer added")}catch(Sn){console.error("Error adding regions layer:",Sn)}},Tt=()=>{if(!(!t.current||!F))try{wn("gis-fill"),wn("gis-outline"),mr("gis"),t.current.addSource("gis",{type:"geojson",data:F,generateId:!0}),t.current.addLayer({id:"gis-fill",type:"fill",source:"gis",paint:{"fill-color":["coalesce",["get","color"],Aue],"fill-opacity":Jt}},"blocks-fill"),t.current.addLayer({id:"gis-outline",type:"line",source:"gis",paint:{"line-color":Cue,"line-width":2}},"blocks-fill"),t.current.on("click","gis-fill",Hn),t.current.on("mouseenter","gis-fill",()=>{t.current.getCanvas().style.cursor="pointer"}),t.current.on("mouseleave","gis-fill",()=>{t.current.getCanvas().style.cursor=""}),console.log(" GIs layer added")}catch(Sn){console.error("Error adding GIs layer:",Sn)}},wn=Sn=>{var si;(si=t.current)!=null&&si.getLayer(Sn)&&t.current.removeLayer(Sn)},mr=Sn=>{var si;(si=t.current)!=null&&si.getSource(Sn)&&t.current.removeSource(Sn)},tn=async Sn=>{if(!Sn.features||Sn.features.length===0)return;Sn.originalEvent.stopPropagation();const Fi=Sn.features[0].properties.id;re(!0),an(null),hn(null),et(null);try{const js=await ui.get(`/public/blocks/${Fi}`);an({...js.data,coordinates:[Sn.lngLat.lng,Sn.lngLat.lat]})}catch(js){console.error("Block query error:",js),ue("Failed to load block details.")}finally{re(!1)}},Ii=Sn=>{if(!Sn.features||Sn.features.length===0)return;Sn.originalEvent.stopPropagation();const si=Sn.features[0];an(null),et(null),hn({slug:si.properties.slug,name:si.properties.name,coordinates:[Sn.lngLat.lng,Sn.lngLat.lat]})},Hn=Sn=>{if(!Sn.features||Sn.features.length===0)return;Sn.originalEvent.stopPropagation();let si=Sn.features[0];Sn.features.length>1&&(si=Sn.features.reduce((Fi,js)=>{const us=ha=>{try{const ja=ha.geometry.coordinates;let za=1/0,Na=-1/0,Es=1/0,zs=-1/0;const fl=Fa=>{Fa.forEach(no=>{Array.isArray(no[0])?fl(no):(za=Math.min(za,no[0]),Na=Math.max(Na,no[0]),Es=Math.min(Es,no[1]),zs=Math.max(zs,no[1]))})};return fl(ja),(Na-za)*(zs-Es)}catch{return 1/0}};return us(js)<us(Fi)?js:Fi},Sn.features[0]),console.log(` Multiple GIs at click point, selected: ${si.properties.name}`)),an(null),hn(null),et({slug:si.properties.slug,name:si.properties.name,coordinates:[Sn.lngLat.lng,Sn.lngLat.lat]})};te.useEffect(()=>{if(!t.current||!u)return;const Sn=ye?"visible":"none";t.current.getLayer("blocks-fill")&&(t.current.setLayoutProperty("blocks-fill","visibility",Sn),t.current.setLayoutProperty("blocks-outline","visibility",Sn))},[ye,u]),te.useEffect(()=>{if(!t.current||!u)return;const Sn=we?"visible":"none";t.current.getLayer("regions-fill")&&(t.current.setLayoutProperty("regions-fill","visibility",Sn),t.current.setLayoutProperty("regions-outline","visibility",Sn))},[we,u]),te.useEffect(()=>{if(!t.current||!u)return;const Sn=Ze?"visible":"none";t.current.getLayer("gis-fill")&&(t.current.setLayoutProperty("gis-fill","visibility",Sn),t.current.setLayoutProperty("gis-outline","visibility",Sn))},[Ze,u]),te.useEffect(()=>{!t.current||!u||t.current.getLayer("blocks-fill")&&t.current.setPaintProperty("blocks-fill","fill-opacity",gt)},[gt,u]),te.useEffect(()=>{!t.current||!u||t.current.getLayer("regions-fill")&&t.current.setPaintProperty("regions-fill","fill-opacity",qe)},[qe,u]),te.useEffect(()=>{!t.current||!u||t.current.getLayer("gis-fill")&&t.current.setPaintProperty("gis-fill","fill-opacity",Jt)},[Jt,u]);const nr=Sn=>{!t.current||!u||(i(Sn),t.current.setStyle(`mapbox://styles/mapbox/${Sn}`),t.current.once("style.load",()=>{I&&En(),F&&Tt(),E&&Bt()}))},Mi=Sn=>{!t.current||!Sn||Sn.bounds&&t.current.fitBounds([[Sn.bounds.min_lng,Sn.bounds.min_lat],[Sn.bounds.max_lng,Sn.bounds.max_lat]],{padding:50,duration:1500})};return b.jsxs("div",{className:"regional-map-container",children:[b.jsx("div",{ref:e,className:"map-canvas"}),Z&&b.jsxs("div",{className:"blocks-loading",children:[b.jsx("div",{className:"loading-spinner"}),b.jsx("span",{children:"Loading vineyard blocks..."})]}),X&&b.jsxs("div",{className:"query-loading",children:[b.jsx("div",{className:"loading-spinner"}),b.jsx("span",{children:"Loading details..."})]}),le&&b.jsxs("div",{className:"query-error",children:[b.jsx("span",{children:le}),b.jsx("button",{onClick:()=>ue(null),children:""})]}),o&&u&&b.jsx(xue,{currentStyle:g,onStyleChange:nr,opacity:gt,onOpacityChange:lt,showBlocks:ye,onToggleBlocks:()=>ge(!ye),showRegions:we,onToggleRegions:()=>Le(!we),regionOpacity:qe,onRegionOpacityChange:en,showGIs:Ze,onToggleGIs:()=>Ge(!Ze),giOpacity:Jt,onGIOpacityChange:Nt,onRegionClick:Mi}),St&&b.jsx(uZ,{block:St,onClose:()=>an(null)}),Kt&&b.jsx(hZ,{region:Kt,onClose:()=>hn(null),onExploreStats:Sn=>{Zn(Sn),hn(null)}}),Xt&&b.jsx(dZ,{gi:Xt,onClose:()=>et(null)}),zt&&(console.log(" Rendering stats modal for:",zt.name),b.jsx(_ue,{region:zt,onClose:()=>Zn(null)})),!o&&b.jsx("div",{className:"map-auth-overlay",children:b.jsxs("div",{className:"auth-message",children:[b.jsx("h3",{children:"Sign in to explore vineyard blocks"}),b.jsx("p",{children:"Click anywhere on the map to discover New Zealand wine regions"})]})})]})}const Pue="/assets/App_Logo_September%2020251-B5IzEWOO.jpg",uV="/assets/Logo_September%202025-DCvy4MUi.png";function Iue({onSuccess:e,onSwitchToSignup:t,onSwitchToForgot:n}){const{login:o}=Ry(),[u,d]=te.useState({email:"",password:""}),[g,i]=te.useState(""),[E,P]=te.useState(!1),I=F=>{d({...u,[F.target.name]:F.target.value}),i("")},D=async F=>{F.preventDefault(),i(""),P(!0);try{await o(u.email,u.password),e()}catch($){i($.message)}finally{P(!1)}};return b.jsxs("form",{onSubmit:D,className:"auth-form",children:[g&&b.jsx("div",{className:"auth-error",children:g}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"email",children:"Email"}),b.jsx("input",{type:"email",id:"email",name:"email",value:u.email,onChange:I,required:!0,placeholder:"your.email@example.com",autoComplete:"email"})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"password",children:"Password"}),b.jsx("input",{type:"password",id:"password",name:"password",value:u.password,onChange:I,required:!0,placeholder:"",autoComplete:"current-password"})]}),b.jsx("div",{className:"form-footer",children:b.jsx("button",{type:"button",className:"link-button",onClick:n,children:"Forgot password?"})}),b.jsx("button",{type:"submit",className:"auth-submit-btn",disabled:E,children:E?"Signing in...":"Sign In"}),b.jsxs("div",{className:"auth-switch",children:["Don't have an account?"," ",b.jsx("button",{type:"button",className:"link-button",onClick:t,children:"Create one for free"})]})]})}console.log("publicAuthService methods:",Object.keys(pC));console.log("getUserTypes type:",typeof VF);function Mue({onSuccess:e,onSwitchToLogin:t}){const{signup:n}=Ry(),[o,u]=te.useState(1),[d,g]=te.useState([]),[i,E]=te.useState([]),P=Ql||pC,[I,D]=te.useState({email:"",password:"",first_name:"",last_name:"",user_type:"",company_name:"",job_title:"",region_of_interest:"",newsletter_opt_in:!1,marketing_opt_in:!1,research_opt_in:!1}),[F,$]=te.useState(""),[Z,q]=te.useState(""),[X,re]=te.useState(!1);te.useEffect(()=>{(async()=>{try{const[gt,lt]=await Promise.all([await P.getUserTypes(),await P.getRegions()]);g(gt),E(lt)}catch(gt){console.error("Failed to load options:",gt)}})()},[]);const le=Ge=>{const{name:gt,value:lt,type:qe,checked:en}=Ge.target;D({...I,[gt]:qe==="checkbox"?en:lt}),$("")},ue=()=>!I.email||!I.password?($("Email and password are required"),!1):I.password.length<8?($("Password must be at least 8 characters"),!1):!0,ye=()=>{o===1&&!ue()||u(o+1)},ge=()=>{u(o-1),$("")},we=async Ge=>{Ge.preventDefault(),$(""),re(!0);try{await n(I),q("Account created! Please check your email to verify your account."),setTimeout(()=>{e()},3e3)}catch(gt){$(gt.message)}finally{re(!1)}},Le=d.find(Ge=>Ge.value===I.user_type),Ze=Le==null?void 0:Le.requires_company;return b.jsxs("form",{onSubmit:we,className:"auth-form signup-form",children:[F&&b.jsx("div",{className:"auth-error",children:F}),Z&&b.jsx("div",{className:"auth-success",children:Z}),b.jsxs("div",{className:"signup-progress",children:[b.jsx("div",{className:`progress-step ${o>=1?"active":""}`,children:"1"}),b.jsx("div",{className:`progress-line ${o>=2?"active":""}`}),b.jsx("div",{className:`progress-step ${o>=2?"active":""}`,children:"2"}),b.jsx("div",{className:`progress-line ${o>=3?"active":""}`}),b.jsx("div",{className:`progress-step ${o>=3?"active":""}`,children:"3"})]}),o===1&&b.jsxs("div",{className:"signup-step",children:[b.jsx("h3",{children:"Basic Information"}),b.jsxs("div",{className:"form-row",children:[b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"first_name",children:"First Name"}),b.jsx("input",{type:"text",id:"first_name",name:"first_name",value:I.first_name,onChange:le,placeholder:"John"})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"last_name",children:"Last Name"}),b.jsx("input",{type:"text",id:"last_name",name:"last_name",value:I.last_name,onChange:le,placeholder:"Doe"})]})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"email",children:"Email *"}),b.jsx("input",{type:"email",id:"email",name:"email",value:I.email,onChange:le,required:!0,placeholder:"your.email@example.com"})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"password",children:"Password *"}),b.jsx("input",{type:"password",id:"password",name:"password",value:I.password,onChange:le,required:!0,placeholder:"Min. 8 characters"}),b.jsx("small",{children:"Must include uppercase, lowercase, and number"})]}),b.jsx("button",{type:"button",className:"auth-submit-btn",onClick:ye,children:"Next "})]}),o===2&&b.jsxs("div",{className:"signup-step",children:[b.jsx("h3",{children:"About You (Optional)"}),b.jsx("p",{className:"step-description",children:"Help us personalize your experience"}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"user_type",children:"I am a..."}),b.jsxs("select",{id:"user_type",name:"user_type",value:I.user_type,onChange:le,children:[b.jsx("option",{value:"",children:"Select type"}),d.map(Ge=>b.jsx("option",{value:Ge.value,children:Ge.label},Ge.value))]}),Le&&b.jsx("small",{children:Le.description})]}),Ze&&b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"company_name",children:"Company Name"}),b.jsx("input",{type:"text",id:"company_name",name:"company_name",value:I.company_name,onChange:le,placeholder:"Your winery or vineyard"})]}),I.user_type&&b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"job_title",children:"Job Title / Role"}),b.jsx("input",{type:"text",id:"job_title",name:"job_title",value:I.job_title,onChange:le,placeholder:"e.g., Viticulturist, Owner"})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"region_of_interest",children:"Region of Interest"}),b.jsxs("select",{id:"region_of_interest",name:"region_of_interest",value:I.region_of_interest,onChange:le,children:[b.jsx("option",{value:"",children:"Select region"}),i.map(Ge=>b.jsx("option",{value:Ge.value,children:Ge.label},Ge.value))]})]}),b.jsxs("div",{className:"form-actions",children:[b.jsx("button",{type:"button",className:"auth-back-btn",onClick:ge,children:" Back"}),b.jsx("button",{type:"button",className:"auth-submit-btn",onClick:ye,children:"Next "})]})]}),o===3&&b.jsxs("div",{className:"signup-step",children:[b.jsx("h3",{children:"Stay Connected"}),b.jsx("p",{className:"step-description",children:"Choose what you'd like to receive"}),b.jsxs("div",{className:"checkbox-group",children:[b.jsxs("label",{className:"checkbox-label",children:[b.jsx("input",{type:"checkbox",name:"newsletter_opt_in",checked:I.newsletter_opt_in,onChange:le}),b.jsxs("div",{className:"checkbox-content",children:[b.jsx("strong",{children:"Platform Updates & Climate Insights"}),b.jsx("small",{children:"Monthly newsletter with regional climate trends"})]})]}),b.jsxs("label",{className:"checkbox-label",children:[b.jsx("input",{type:"checkbox",name:"marketing_opt_in",checked:I.marketing_opt_in,onChange:le}),b.jsxs("div",{className:"checkbox-content",children:[b.jsx("strong",{children:"Premium Features & Offers"}),b.jsx("small",{children:"Information about Auxein Insights Pro platform"})]})]}),b.jsxs("label",{className:"checkbox-label",children:[b.jsx("input",{type:"checkbox",name:"research_opt_in",checked:I.research_opt_in,onChange:le}),b.jsxs("div",{className:"checkbox-content",children:[b.jsx("strong",{children:"Research & Surveys"}),b.jsx("small",{children:"Help improve wine industry climate intelligence"})]})]})]}),b.jsxs("div",{className:"form-actions",children:[b.jsx("button",{type:"button",className:"auth-back-btn",onClick:ge,children:" Back"}),b.jsx("button",{type:"submit",className:"auth-submit-btn",disabled:X,children:X?"Creating Account...":"Create Account"})]})]}),b.jsxs("div",{className:"auth-switch",children:["Already have an account?"," ",b.jsx("button",{type:"button",className:"link-button",onClick:t,children:"Sign in"})]})]})}function kue({onBack:e}){const[t,n]=te.useState(""),[o,u]=te.useState(""),[d,g]=te.useState(""),[i,E]=te.useState(!1),P=async I=>{I.preventDefault(),u(""),g(""),E(!0);try{await UF(t),g("If an account exists with this email, you will receive a password reset link shortly."),n("")}catch(D){u(D.message)}finally{E(!1)}};return b.jsxs("form",{onSubmit:P,className:"auth-form",children:[o&&b.jsx("div",{className:"auth-error",children:o}),d&&b.jsx("div",{className:"auth-success",children:d}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"email",children:"Email Address"}),b.jsx("input",{type:"email",id:"email",name:"email",value:t,onChange:I=>n(I.target.value),required:!0,placeholder:"your.email@example.com",autoComplete:"email"}),b.jsx("small",{children:"We'll send you a link to reset your password"})]}),b.jsx("button",{type:"submit",className:"auth-submit-btn",disabled:i,children:i?"Sending...":"Send Reset Link"}),b.jsx("div",{className:"auth-switch",children:b.jsx("button",{type:"button",className:"link-button",onClick:e,children:" Back to Sign In"})})]})}function Rue({isOpen:e,onClose:t,initialView:n="login"}){const[o,u]=te.useState(n);if(!e)return null;const d=()=>{t()};return b.jsx("div",{className:"auth-modal-overlay",onClick:t,children:b.jsxs("div",{className:"auth-modal-content",onClick:g=>g.stopPropagation(),children:[b.jsx("button",{className:"auth-modal-close",onClick:t,children:b.jsx(hl,{size:24})}),b.jsxs("div",{className:"auth-modal-header",children:[b.jsxs("h2",{children:[o==="login"&&"Welcome Back",o==="signup"&&"Create Account",o==="forgot"&&"Reset Password"]}),b.jsxs("p",{children:[o==="login"&&"Sign in to access climate insights and maps",o==="signup"&&"Join to explore New Zealand wine regions",o==="forgot"&&"Enter your email to receive a reset link"]})]}),b.jsxs("div",{className:"auth-modal-body",children:[o==="login"&&b.jsx(Iue,{onSuccess:d,onSwitchToSignup:()=>u("signup"),onSwitchToForgot:()=>u("forgot")}),o==="signup"&&b.jsx(Mue,{onSuccess:d,onSwitchToLogin:()=>u("login")}),o==="forgot"&&b.jsx(kue,{onBack:()=>u("login")})]})]})})}function Oue({isOpen:e,onClose:t}){const{user:n,updateProfile:o,updateMarketingPreferences:u}=Ry(),[d,g]=te.useState("profile"),[i,E]=te.useState([]),[P,I]=te.useState([]),D=Ql||pC,[F,$]=te.useState({first_name:"",last_name:"",user_type:"",company_name:"",job_title:"",region_of_interest:"",newsletter_opt_in:!1,marketing_opt_in:!1,research_opt_in:!1}),[Z,q]=te.useState(""),[X,re]=te.useState(""),[le,ue]=te.useState(!1);if(te.useEffect(()=>{n&&e&&($({first_name:n.first_name||"",last_name:n.last_name||"",user_type:n.user_type||"",company_name:n.company_name||"",job_title:n.job_title||"",region_of_interest:n.region_of_interest||"",newsletter_opt_in:n.newsletter_opt_in||!1,marketing_opt_in:n.marketing_opt_in||!1,research_opt_in:n.research_opt_in||!1}),(async()=>{try{const[gt,lt]=await Promise.all([await D.getUserTypes(),await D.getRegions()]);E(gt),I(lt)}catch(gt){console.error("Failed to load options:",gt)}})())},[n,e]),!e)return null;const ye=Ge=>{const{name:gt,value:lt,type:qe,checked:en}=Ge.target;$({...F,[gt]:qe==="checkbox"?en:lt}),q(""),re("")},ge=async()=>{q(""),re(""),ue(!0);try{await o({first_name:F.first_name,last_name:F.last_name,user_type:F.user_type,company_name:F.company_name,job_title:F.job_title,region_of_interest:F.region_of_interest}),re("Profile updated successfully!")}catch(Ge){q(Ge.message)}finally{ue(!1)}},we=async()=>{q(""),re(""),ue(!0);try{await u({newsletter_opt_in:F.newsletter_opt_in,marketing_opt_in:F.marketing_opt_in,research_opt_in:F.research_opt_in}),re("Preferences updated successfully!")}catch(Ge){q(Ge.message)}finally{ue(!1)}},Le=i.find(Ge=>Ge.value===F.user_type),Ze=Le==null?void 0:Le.requires_company;return b.jsx("div",{className:"auth-modal-overlay",onClick:t,children:b.jsxs("div",{className:"auth-modal-content preferences-modal",onClick:Ge=>Ge.stopPropagation(),children:[b.jsx("button",{className:"auth-modal-close",onClick:t,children:b.jsx(hl,{size:24})}),b.jsxs("div",{className:"auth-modal-header",children:[b.jsx("h2",{children:"Account Preferences"}),b.jsx("p",{children:"Manage your profile and communication preferences"})]}),b.jsxs("div",{className:"preferences-tabs",children:[b.jsx("button",{className:`tab ${d==="profile"?"active":""}`,onClick:()=>{g("profile"),q(""),re("")},children:"Profile"}),b.jsx("button",{className:`tab ${d==="marketing"?"active":""}`,onClick:()=>{g("marketing"),q(""),re("")},children:"Communications"})]}),b.jsxs("div",{className:"auth-modal-body",children:[Z&&b.jsx("div",{className:"auth-error",children:Z}),X&&b.jsx("div",{className:"auth-success",children:X}),d==="profile"&&b.jsxs("div",{className:"preferences-content",children:[b.jsxs("div",{className:"form-row",children:[b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"first_name",children:"First Name"}),b.jsx("input",{type:"text",id:"first_name",name:"first_name",value:F.first_name,onChange:ye})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"last_name",children:"Last Name"}),b.jsx("input",{type:"text",id:"last_name",name:"last_name",value:F.last_name,onChange:ye})]})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"user_type",children:"I am a..."}),b.jsxs("select",{id:"user_type",name:"user_type",value:F.user_type,onChange:ye,children:[b.jsx("option",{value:"",children:"Select type"}),i.map(Ge=>b.jsx("option",{value:Ge.value,children:Ge.label},Ge.value))]})]}),Ze&&b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"company_name",children:"Company Name"}),b.jsx("input",{type:"text",id:"company_name",name:"company_name",value:F.company_name,onChange:ye})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"job_title",children:"Job Title"}),b.jsx("input",{type:"text",id:"job_title",name:"job_title",value:F.job_title,onChange:ye})]}),b.jsxs("div",{className:"form-group",children:[b.jsx("label",{htmlFor:"region_of_interest",children:"Region of Interest"}),b.jsxs("select",{id:"region_of_interest",name:"region_of_interest",value:F.region_of_interest,onChange:ye,children:[b.jsx("option",{value:"",children:"Select region"}),P.map(Ge=>b.jsx("option",{value:Ge.value,children:Ge.label},Ge.value))]})]}),b.jsx("button",{onClick:ge,className:"auth-submit-btn",disabled:le,children:le?"Saving...":"Save Profile"})]}),d==="marketing"&&b.jsxs("div",{className:"preferences-content",children:[b.jsxs("div",{className:"checkbox-group",children:[b.jsxs("label",{className:"checkbox-label",children:[b.jsx("input",{type:"checkbox",name:"newsletter_opt_in",checked:F.newsletter_opt_in,onChange:ye}),b.jsxs("div",{className:"checkbox-content",children:[b.jsx("strong",{children:"Platform Updates & Climate Insights"}),b.jsx("small",{children:"Monthly newsletter with regional climate trends"})]})]}),b.jsxs("label",{className:"checkbox-label",children:[b.jsx("input",{type:"checkbox",name:"marketing_opt_in",checked:F.marketing_opt_in,onChange:ye}),b.jsxs("div",{className:"checkbox-content",children:[b.jsx("strong",{children:"Premium Features & Offers"}),b.jsx("small",{children:"Information about Auxein Insights Pro platform"})]})]}),b.jsxs("label",{className:"checkbox-label",children:[b.jsx("input",{type:"checkbox",name:"research_opt_in",checked:F.research_opt_in,onChange:ye}),b.jsxs("div",{className:"checkbox-content",children:[b.jsx("strong",{children:"Research & Surveys"}),b.jsx("small",{children:"Help improve wine industry climate intelligence"})]})]})]}),b.jsx("button",{onClick:we,className:"auth-submit-btn",disabled:le,children:le?"Saving...":"Save Preferences"})]})]})]})})}function Due({isOpen:e,onClose:t,token:n}){const[o,u]=te.useState("verifying"),[d,g]=te.useState("");return te.useEffect(()=>{if(!e||!n)return;(async()=>{try{const E=await Ql.verifyEmail(n);u("success"),g(E.message||"Email verified successfully!"),setTimeout(()=>{t()},3e3)}catch(E){u("error"),g(E.message||"Verification failed. The link may have expired.")}})()},[e,n,t]),e?b.jsx("div",{className:"auth-modal-overlay",children:b.jsxs("div",{className:"auth-modal-content",children:[b.jsx("button",{className:"auth-modal-close",onClick:t,children:b.jsx(hl,{size:24})}),b.jsx("div",{className:"auth-modal-header",children:b.jsx("h2",{children:"Email Verification"})}),b.jsxs("div",{className:"auth-modal-body",children:[o==="verifying"&&b.jsxs("div",{className:"verification-status",children:[b.jsx("div",{className:"spinner"}),b.jsx("p",{children:"Verifying your email address..."})]}),o==="success"&&b.jsxs("div",{className:"verification-success",children:[b.jsx("div",{className:"success-icon",children:""}),b.jsx("h3",{children:"Success!"}),b.jsx("p",{children:d}),b.jsx("p",{className:"redirect-message",children:"You can now sign in."})]}),o==="error"&&b.jsxs("div",{className:"verification-error",children:[b.jsx("div",{className:"error-icon",children:""}),b.jsx("h3",{children:"Verification Failed"}),b.jsx("p",{children:d}),b.jsx("button",{className:"auth-submit-btn",onClick:t,children:"Close"})]})]})]})}):null}const Lue="https://api.auxein.co.nz/api/v1",jue=`${Lue}/public/public_climate`,u_=async(e,t={})=>{const n=`${jue}${e}`;try{const o=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!o.ok){const u=await o.json().catch(()=>({}));throw new Error(u.detail||`API error: ${o.status}`)}return await o.json()}catch(o){throw console.error(`API Error [${e}]:`,o),o}},rS=e=>{const t=Object.entries(e||{}).filter(([n,o])=>o!=null&&o!=="").map(([n,o])=>`${encodeURIComponent(n)}=${encodeURIComponent(o)}`);return t.length>0?`?${t.join("&")}`:""},zue=async()=>u_("/regions"),Nue=async()=>u_("/zones"),hV=async e=>u_(`/zones/${e}/baseline`),KP=async(e,t={})=>{const n=rS(t);return u_(`/zones/${e}/history${n}`)},Fue=async(e,t={})=>{const n=rS(t);return u_(`/zones/${e}/seasons${n}`)},Bue=async(e,t={})=>{const n=rS(t);return u_(`/zones/${e}/projections${n}`)},Uue=async e=>{const t=rS(e);return u_(`/compare/zones${t}`)},yE={SSP126:{code:"SSP126",name:"SSP1-2.6",shortName:"Low Emissions",description:"Sustainability pathway with strong mitigation",color:"#22c55e"},SSP245:{code:"SSP245",name:"SSP2-4.5",shortName:"Middle Road",description:"Intermediate emissions scenario",color:"#f59e0b"},SSP370:{code:"SSP370",name:"SSP3-7.0",shortName:"High Emissions",description:"Regional rivalry with limited mitigation",color:"#ef4444"}},vE={"2021_2040":{code:"2021_2040",name:"Near-term",label:"2021-2040",midpoint:2030},"2041_2060":{code:"2041_2060",name:"Mid-century",label:"2041-2060",midpoint:2050},"2080_2099":{code:"2080_2099",name:"End of century",label:"2080-2099",midpoint:2090}},Ml=(e,t)=>{if(e==null)return"N/A";switch(t){case"gdd":return`${Math.round(e)} Cdays`;case"rain":return`${Math.round(e)} mm`;case"tmean":case"tmax":case"tmin":return`${Number(e).toFixed(1)}C`;default:return String(e)}},Z1=e=>e==null?"":`${e>=0?"+":""}${Number(e).toFixed(1)}%`,Vue=({selectedZone:e,onZoneChange:t,comparisonZones:n=[],onComparisonZonesChange:o,allowComparison:u=!1,maxComparison:d=4,loading:g=!1,disabled:i=!1})=>{const[E,P]=te.useState([]),[I,D]=te.useState(!0),[F,$]=te.useState(null),[Z,q]=te.useState(!1),[X,re]=te.useState(!1),le=E.flatMap(we=>we.zones.map(Le=>({...Le,region_name:we.name})));te.useEffect(()=>{(async()=>{try{D(!0),$(null);const Le=await zue();P(Le.regions||[])}catch(Le){console.error("Error loading regions:",Le),$("Failed to load climate zones")}finally{D(!1)}})()},[]);const ue=we=>{t(we),q(!1)},ye=we=>{n.length<d&&!n.find(Le=>Le.slug===we.slug)&&o([...n,we]),re(!1)},ge=we=>{o(n.filter(Le=>Le.slug!==we))};return le.filter(we=>we.slug!==(e==null?void 0:e.slug)&&!n.find(Le=>Le.slug===we.slug)),I?b.jsx("div",{className:"zone-selector",children:b.jsx("div",{className:"zone-selector-loading",children:b.jsx("span",{children:"Loading climate zones..."})})}):F?b.jsx("div",{className:"zone-selector",children:b.jsx("div",{className:"zone-selector-error",children:b.jsx("span",{children:F})})}):b.jsxs("div",{className:"zone-selector",children:[b.jsxs("div",{className:"zone-selector-row",children:[b.jsxs("label",{className:"zone-selector-label",children:[b.jsx(aa,{size:16}),b.jsx("span",{children:"Climate Zone"})]}),b.jsxs("div",{className:"zone-dropdown-container",children:[b.jsxs("button",{className:`zone-dropdown-trigger ${Z?"open":""}`,onClick:()=>q(!Z),disabled:i||g,children:[b.jsx("span",{className:"zone-dropdown-text",children:(e==null?void 0:e.name)||"Select a climate zone"}),b.jsx(Iy,{size:18,className:`dropdown-chevron ${Z?"rotated":""}`})]}),Z&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"zone-dropdown-overlay",onClick:()=>q(!1)}),b.jsx("div",{className:"zone-dropdown-menu",children:E.map(we=>b.jsxs("div",{className:"zone-region-group",children:[b.jsx("div",{className:"zone-region-header",children:we.name}),b.jsx("div",{className:"zone-region-zones",children:we.zones.map(Le=>b.jsx("button",{className:`zone-option ${(e==null?void 0:e.slug)===Le.slug?"selected":""}`,onClick:()=>ue(Le),children:b.jsx("span",{className:"zone-option-name",children:Le.name})},Le.id))})]},we.id))})]})]})]}),u&&e&&b.jsxs("div",{className:"zone-comparison-section",children:[b.jsxs("div",{className:"comparison-header",children:[b.jsx("span",{className:"comparison-label",children:"Compare with:"}),n.length<d&&b.jsxs("div",{className:"add-comparison-container",children:[b.jsxs("button",{className:"add-comparison-btn",onClick:()=>re(!X),children:[b.jsx(L7,{size:14}),"Add Zone"]}),X&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"zone-dropdown-overlay",onClick:()=>re(!1)}),b.jsx("div",{className:"zone-dropdown-menu comparison-menu",children:E.map(we=>{const Le=we.zones.filter(Ze=>Ze.slug!==(e==null?void 0:e.slug)&&!n.find(Ge=>Ge.slug===Ze.slug));return Le.length===0?null:b.jsxs("div",{className:"zone-region-group",children:[b.jsx("div",{className:"zone-region-header",children:we.name}),b.jsx("div",{className:"zone-region-zones",children:Le.map(Ze=>b.jsx("button",{className:"zone-option",onClick:()=>ye(Ze),children:b.jsx("span",{className:"zone-option-name",children:Ze.name})},Ze.id))})]},we.id)})})]})]})]}),n.length>0&&b.jsx("div",{className:"zone-comparison-tags",children:n.map(we=>b.jsxs("span",{className:"zone-tag",children:[we.name,b.jsx("button",{className:"zone-tag-remove",onClick:()=>ge(we.slug),"aria-label":`Remove ${we.name}`,children:b.jsx(hl,{size:12})})]},we.slug))}),n.length===0&&b.jsxs("span",{className:"comparison-hint",children:["Add zones to compare ",e.name," with other regions"]})]})]})},$ue="https://api.auxein.co.nz/api/v1",Hue=`${$ue}/public/realtime`,Vy=async(e,t={})=>{const n=`${Hue}${e}`;try{const o=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!o.ok){const u=await o.json().catch(()=>({}));throw new Error(u.detail||`API error: ${o.status}`)}return await o.json()}catch(o){throw console.error(`Realtime API Error [${e}]:`,o),o}},l0=e=>{const t=Object.entries(e||{}).filter(([n,o])=>o!=null&&o!=="").map(([n,o])=>`${encodeURIComponent(n)}=${encodeURIComponent(o)}`);return t.length>0?`?${t.join("&")}`:""},Gue=async(e={})=>{const t=l0(e);return Vy(`/zones${t}`)},Wue=async(e,t={})=>{const n=l0(t);return Vy(`/current-season/${e}${n}`)},que=async(e,t={})=>{const n=l0(t);return Vy(`/gdd-progress/${e}${n}`)},Zue=async()=>Vy("/varieties"),Xue=async(e,t={})=>{const n=l0(t);return Vy(`/phenology/${e}${n}`)},Yue=async(e,t={})=>{const n=l0(t);return Vy(`/disease-pressure/${e}${n}`)},fN={dormant:{name:"Dormant",color:"#94A3B8",icon:""},budburst:{name:"Budburst",color:"#22C55E",icon:""},pre_flowering:{name:"Pre-flowering",color:"#84CC16",icon:""},flowering:{name:"Flowering",color:"#EAB308",icon:""},fruit_set:{name:"Fruit Set",color:"#F59E0B",icon:""},veraison:{name:"Vraison",color:"#8B5CF6",icon:""},ripening:{name:"Ripening",color:"#EC4899",icon:""},harvest_ready:{name:"Harvest Ready",color:"#EF4444",icon:""},unknown:{name:"Unknown",color:"#6B7280",icon:""}},pN={low:{name:"Low",color:"#22C55E",bgColor:"#DCFCE7"},moderate:{name:"Moderate",color:"#F59E0B",bgColor:"#FEF3C7"},high:{name:"High",color:"#EF4444",bgColor:"#FEE2E2"},extreme:{name:"Extreme",color:"#991B1B",bgColor:"#FCA5A5"},unknown:{name:"Unknown",color:"#6B7280",bgColor:"#F3F4F6"}},Kue={downy_mildew:"Downy Mildew",powdery_mildew:"Powdery Mildew",botrytis:"Botrytis"},X1=e=>e==null?"N/A":`${Math.round(Number(e))} Cdays`,ey=e=>e==null?"N/A":`${Number(e).toFixed(1)}C`,mN=e=>e==null?"N/A":`${Number(e).toFixed(1)} mm`,gN=e=>e==null?"":`${e>=0?"+":""}${Number(e).toFixed(1)}%`,Y1=e=>e?new Date(e).toLocaleDateString("en-NZ",{day:"numeric",month:"short",year:"numeric"}):"N/A",ym=e=>e?new Date(e).toLocaleDateString("en-NZ",{day:"numeric",month:"short"}):"N/A",_N=e=>{switch(e){case"ahead":return"#22C55E";case"behind":return"#EF4444";case"normal":return"#6B7280";default:return"#6B7280"}},Jue=e=>{if(!e)return null;const t=new Date(e),n=new Date;return n.setHours(0,0,0,0),t.setHours(0,0,0,0),Math.ceil((t-n)/(1e3*60*60*24))},Que="insights@auxein.co.nz",ehe=({selectedZone:e,onZoneChange:t,label:n="Select Zone"})=>{const[o,u]=te.useState([]),[d,g]=te.useState(new Set),[i,E]=te.useState(!1),[P,I]=te.useState(!0),[D,F]=te.useState(!1),[$,Z]=te.useState(null);te.useEffect(()=>{(async()=>{var ue;try{I(!0);const[ye,ge]=await Promise.all([Nue(),Gue()]),we=new Set((ge.zones||[]).map(Le=>Le.id));u(ye.zones||[]),g(we),!e&&((ue=ge.zones)==null?void 0:ue.length)>0&&t(ge.zones[0])}catch(ye){console.error("Error loading zones:",ye)}finally{I(!1)}})()},[]);const q=le=>{d.has(le.id)?(t(le),E(!1)):(Z(le),F(!0),E(!1))},X=()=>{const le=encodeURIComponent(`Weather Station Data - ${($==null?void 0:$.name)||"Region"}`),ue=encodeURIComponent(`Hi Auxein Team,

I'm interested in having realtime climate data available for ${($==null?void 0:$.name)||"my region"}.

Weather Station Details:
- Location: 
- Station Type/Model: 
- Data Format Available: 
- Contact Details: 

Please let me know what's needed to integrate this data.

Thanks!`);window.open(`mailto:${Que}?subject=${le}&body=${ue}`,"_blank")},re=o.reduce((le,ue)=>{const ye=ue.region_name||"Other";return le[ye]||(le[ye]=[]),le[ye].push(ue),le},{});return b.jsxs("div",{className:"zone-selector-realtime",children:[b.jsxs("div",{className:"selector-wrapper",children:[b.jsx("label",{className:"selector-label",children:n}),b.jsxs("button",{className:"selector-trigger",onClick:()=>E(!i),disabled:P,children:[b.jsx(aa,{size:16,className:"trigger-icon"}),P?b.jsx("span",{className:"zone-name",children:"Loading zones..."}):e?b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"zone-name",children:e.name}),e.region_name&&b.jsx("span",{className:"region-name",children:e.region_name})]}):b.jsx("span",{className:"zone-name placeholder",children:"Select a zone..."}),b.jsx(Iy,{size:16,className:`chevron ${i?"open":""}`})]})]}),i&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"selector-backdrop",onClick:()=>E(!1)}),b.jsxs("div",{className:"selector-dropdown",children:[b.jsxs("div",{className:"dropdown-header",children:[b.jsx("span",{children:"Select Climate Zone"}),b.jsxs("span",{className:"data-hint",children:[b.jsx(qg,{size:12})," = Live data available"]})]}),b.jsx("div",{className:"dropdown-content",children:Object.entries(re).map(([le,ue])=>b.jsxs("div",{className:"rt-region-group",children:[b.jsx("div",{className:"rt-region-header",children:le}),ue.map(ye=>{const ge=d.has(ye.id),we=(e==null?void 0:e.id)===ye.id;return b.jsxs("button",{className:`rt-zone-option ${we?"rt-selected":""} ${ge?"rt-has-data":"rt-no-data"}`,onClick:()=>q(ye),children:[b.jsx("span",{className:"rt-zone-name",children:ye.name}),ge?b.jsx("span",{className:"rt-indicator rt-available",children:b.jsx(qg,{size:14})}):b.jsx("span",{className:"rt-indicator rt-unavailable",children:b.jsx(o_,{size:14})})]},ye.id)})]},le))})]})]}),D&&b.jsx("div",{className:"cta-overlay",onClick:()=>F(!1),children:b.jsxs("div",{className:"cta-modal",onClick:le=>le.stopPropagation(),children:[b.jsx("button",{className:"cta-close",onClick:()=>F(!1),children:b.jsx(hl,{size:20})}),b.jsx("div",{className:"cta-icon",children:b.jsx(fq,{size:48})}),b.jsx("h3",{children:"No Live Data Available"}),b.jsx("p",{className:"cta-zone-name",children:$==null?void 0:$.name}),b.jsx("p",{className:"cta-description",children:"Realtime climate data isn't currently available for this zone. Help us expand our coverage by sharing your weather station details!"}),b.jsxs("div",{className:"cta-benefits",children:[b.jsx("h4",{children:"Benefits of contributing data:"}),b.jsxs("ul",{children:[b.jsx("li",{children:"Access to regional climate insights"}),b.jsx("li",{children:"Phenology predictions for your area"}),b.jsx("li",{children:"Disease pressure monitoring"}),b.jsx("li",{children:"Comparison with other regions"})]})]}),b.jsxs("div",{className:"cta-actions",children:[b.jsxs("button",{className:"cta-email-btn",onClick:X,children:[b.jsx(cw,{size:18}),"Submit Weather Station Details"]}),b.jsxs("a",{href:"https://auxein.co.nz/contact",target:"_blank",rel:"noopener noreferrer",className:"cta-learn-more",children:["Learn more about data partnerships",b.jsx(Nd,{size:14})]})]}),b.jsx("p",{className:"cta-privacy",children:"Your data remains yours. We only use aggregated, anonymized data for regional insights."})]})})]})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function c0(e){return e+.5|0}const vm=(e,t,n)=>Math.max(Math.min(e,n),t);function Yv(e){return vm(c0(e*2.55),0,255)}function Em(e){return vm(c0(e*255),0,255)}function tp(e){return vm(c0(e/2.55)/100,0,1)}function yN(e){return vm(c0(e*100),0,100)}const xu={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},NA=[..."0123456789ABCDEF"],the=e=>NA[e&15],nhe=e=>NA[(e&240)>>4]+NA[e&15],bb=e=>(e&240)>>4===(e&15),rhe=e=>bb(e.r)&&bb(e.g)&&bb(e.b)&&bb(e.a);function ihe(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&xu[e[1]]*17,g:255&xu[e[2]]*17,b:255&xu[e[3]]*17,a:t===5?xu[e[4]]*17:255}:(t===7||t===9)&&(n={r:xu[e[1]]<<4|xu[e[2]],g:xu[e[3]]<<4|xu[e[4]],b:xu[e[5]]<<4|xu[e[6]],a:t===9?xu[e[7]]<<4|xu[e[8]]:255})),n}const she=(e,t)=>e<255?t(e):"";function ohe(e){var t=rhe(e)?the:nhe;return e?"#"+t(e.r)+t(e.g)+t(e.b)+she(e.a,t):void 0}const ahe=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function dV(e,t,n){const o=t*Math.min(n,1-n),u=(d,g=(d+e/30)%12)=>n-o*Math.max(Math.min(g-3,9-g,1),-1);return[u(0),u(8),u(4)]}function lhe(e,t,n){const o=(u,d=(u+e/60)%6)=>n-n*t*Math.max(Math.min(d,4-d,1),0);return[o(5),o(3),o(1)]}function che(e,t,n){const o=dV(e,1,.5);let u;for(t+n>1&&(u=1/(t+n),t*=u,n*=u),u=0;u<3;u++)o[u]*=1-t-n,o[u]+=t;return o}function uhe(e,t,n,o,u){return e===u?(t-n)/o+(t<n?6:0):t===u?(n-e)/o+2:(e-t)/o+4}function JP(e){const n=e.r/255,o=e.g/255,u=e.b/255,d=Math.max(n,o,u),g=Math.min(n,o,u),i=(d+g)/2;let E,P,I;return d!==g&&(I=d-g,P=i>.5?I/(2-d-g):I/(d+g),E=uhe(n,o,u,I,d),E=E*60+.5),[E|0,P||0,i]}function QP(e,t,n,o){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,o)).map(Em)}function eI(e,t,n){return QP(dV,e,t,n)}function hhe(e,t,n){return QP(che,e,t,n)}function dhe(e,t,n){return QP(lhe,e,t,n)}function fV(e){return(e%360+360)%360}function fhe(e){const t=ahe.exec(e);let n=255,o;if(!t)return;t[5]!==o&&(n=t[6]?Yv(+t[5]):Em(+t[5]));const u=fV(+t[2]),d=+t[3]/100,g=+t[4]/100;return t[1]==="hwb"?o=hhe(u,d,g):t[1]==="hsv"?o=dhe(u,d,g):o=eI(u,d,g),{r:o[0],g:o[1],b:o[2],a:n}}function phe(e,t){var n=JP(e);n[0]=fV(n[0]+t),n=eI(n),e.r=n[0],e.g=n[1],e.b=n[2]}function mhe(e){if(!e)return;const t=JP(e),n=t[0],o=yN(t[1]),u=yN(t[2]);return e.a<255?`hsla(${n}, ${o}%, ${u}%, ${tp(e.a)})`:`hsl(${n}, ${o}%, ${u}%)`}const vN={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},xN={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ghe(){const e={},t=Object.keys(xN),n=Object.keys(vN);let o,u,d,g,i;for(o=0;o<t.length;o++){for(g=i=t[o],u=0;u<n.length;u++)d=n[u],i=i.replace(d,vN[d]);d=parseInt(xN[g],16),e[i]=[d>>16&255,d>>8&255,d&255]}return e}let wb;function _he(e){wb||(wb=ghe(),wb.transparent=[0,0,0,0]);const t=wb[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const yhe=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function vhe(e){const t=yhe.exec(e);let n=255,o,u,d;if(t){if(t[7]!==o){const g=+t[7];n=t[8]?Yv(g):vm(g*255,0,255)}return o=+t[1],u=+t[3],d=+t[5],o=255&(t[2]?Yv(o):vm(o,0,255)),u=255&(t[4]?Yv(u):vm(u,0,255)),d=255&(t[6]?Yv(d):vm(d,0,255)),{r:o,g:u,b:d,a:n}}}function xhe(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${tp(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const xE=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,ty=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function bhe(e,t,n){const o=ty(tp(e.r)),u=ty(tp(e.g)),d=ty(tp(e.b));return{r:Em(xE(o+n*(ty(tp(t.r))-o))),g:Em(xE(u+n*(ty(tp(t.g))-u))),b:Em(xE(d+n*(ty(tp(t.b))-d))),a:e.a+n*(t.a-e.a)}}function Sb(e,t,n){if(e){let o=JP(e);o[t]=Math.max(0,Math.min(o[t]+o[t]*n,t===0?360:1)),o=eI(o),e.r=o[0],e.g=o[1],e.b=o[2]}}function pV(e,t){return e&&Object.assign(t||{},e)}function bN(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Em(e[3]))):(t=pV(e,{r:0,g:0,b:0,a:1}),t.a=Em(t.a)),t}function whe(e){return e.charAt(0)==="r"?vhe(e):fhe(e)}class Px{constructor(t){if(t instanceof Px)return t;const n=typeof t;let o;n==="object"?o=bN(t):n==="string"&&(o=ihe(t)||_he(t)||whe(t)),this._rgb=o,this._valid=!!o}get valid(){return this._valid}get rgb(){var t=pV(this._rgb);return t&&(t.a=tp(t.a)),t}set rgb(t){this._rgb=bN(t)}rgbString(){return this._valid?xhe(this._rgb):void 0}hexString(){return this._valid?ohe(this._rgb):void 0}hslString(){return this._valid?mhe(this._rgb):void 0}mix(t,n){if(t){const o=this.rgb,u=t.rgb;let d;const g=n===d?.5:n,i=2*g-1,E=o.a-u.a,P=((i*E===-1?i:(i+E)/(1+i*E))+1)/2;d=1-P,o.r=255&P*o.r+d*u.r+.5,o.g=255&P*o.g+d*u.g+.5,o.b=255&P*o.b+d*u.b+.5,o.a=g*o.a+(1-g)*u.a,this.rgb=o}return this}interpolate(t,n){return t&&(this._rgb=bhe(this._rgb,t._rgb,n)),this}clone(){return new Px(this.rgb)}alpha(t){return this._rgb.a=Em(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=c0(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Sb(this._rgb,2,t),this}darken(t){return Sb(this._rgb,2,-t),this}saturate(t){return Sb(this._rgb,1,t),this}desaturate(t){return Sb(this._rgb,1,-t),this}rotate(t){return phe(this._rgb,t),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Yf(){}const She=(()=>{let e=0;return()=>e++})();function Ei(e){return e==null}function ks(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Pi(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function to(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function kc(e,t){return to(e)?e:t}function Kr(e,t){return typeof e>"u"?t:e}const The=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,mV=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function xs(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function Qi(e,t,n,o){let u,d,g;if(ks(e))for(d=e.length,u=0;u<d;u++)t.call(n,e[u],u);else if(Pi(e))for(g=Object.keys(e),d=g.length,u=0;u<d;u++)t.call(n,e[g[u]],g[u])}function K1(e,t){let n,o,u,d;if(!e||!t||e.length!==t.length)return!1;for(n=0,o=e.length;n<o;++n)if(u=e[n],d=t[n],u.datasetIndex!==d.datasetIndex||u.index!==d.index)return!1;return!0}function J1(e){if(ks(e))return e.map(J1);if(Pi(e)){const t=Object.create(null),n=Object.keys(e),o=n.length;let u=0;for(;u<o;++u)t[n[u]]=J1(e[n[u]]);return t}return e}function gV(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function Ehe(e,t,n,o){if(!gV(e))return;const u=t[e],d=n[e];Pi(u)&&Pi(d)?Ix(u,d,o):t[e]=J1(d)}function Ix(e,t,n){const o=ks(t)?t:[t],u=o.length;if(!Pi(e))return e;n=n||{};const d=n.merger||Ehe;let g;for(let i=0;i<u;++i){if(g=o[i],!Pi(g))continue;const E=Object.keys(g);for(let P=0,I=E.length;P<I;++P)d(E[P],e,g,n)}return e}function rx(e,t){return Ix(e,t,{merger:Ahe})}function Ahe(e,t,n){if(!gV(e))return;const o=t[e],u=n[e];Pi(o)&&Pi(u)?rx(o,u):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=J1(u))}const wN={"":e=>e,x:e=>e.x,y:e=>e.y};function Che(e){const t=e.split("."),n=[];let o="";for(const u of t)o+=u,o.endsWith("\\")?o=o.slice(0,-1)+".":(n.push(o),o="");return n}function Phe(e){const t=Che(e);return n=>{for(const o of t){if(o==="")break;n=n&&n[o]}return n}}function km(e,t){return(wN[t]||(wN[t]=Phe(t)))(e)}function tI(e){return e.charAt(0).toUpperCase()+e.slice(1)}const Mx=e=>typeof e<"u",Rm=e=>typeof e=="function",SN=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function Ihe(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const Vi=Math.PI,Ts=2*Vi,Mhe=Ts+Vi,Q1=Number.POSITIVE_INFINITY,khe=Vi/180,mo=Vi/2,Tg=Vi/4,TN=Vi*2/3,xm=Math.log10,Vd=Math.sign;function ix(e,t,n){return Math.abs(e-t)<n}function EN(e){const t=Math.round(e);e=ix(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(xm(e))),o=e/n;return(o<=1?1:o<=2?2:o<=5?5:10)*n}function Rhe(e){const t=[],n=Math.sqrt(e);let o;for(o=1;o<n;o++)e%o===0&&(t.push(o),t.push(e/o));return n===(n|0)&&t.push(n),t.sort((u,d)=>u-d).pop(),t}function Ohe(e){return typeof e=="symbol"||typeof e=="object"&&e!==null&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}function by(e){return!Ohe(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function Dhe(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function _V(e,t,n){let o,u,d;for(o=0,u=e.length;o<u;o++)d=e[o][n],isNaN(d)||(t.min=Math.min(t.min,d),t.max=Math.max(t.max,d))}function kh(e){return e*(Vi/180)}function nI(e){return e*(180/Vi)}function AN(e){if(!to(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function yV(e,t){const n=t.x-e.x,o=t.y-e.y,u=Math.sqrt(n*n+o*o);let d=Math.atan2(o,n);return d<-.5*Vi&&(d+=Ts),{angle:d,distance:u}}function FA(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Lhe(e,t){return(e-t+Mhe)%Ts-Vi}function ll(e){return(e%Ts+Ts)%Ts}function kx(e,t,n,o){const u=ll(e),d=ll(t),g=ll(n),i=ll(d-u),E=ll(g-u),P=ll(u-d),I=ll(u-g);return u===d||u===g||o&&d===g||i>E&&P<I}function la(e,t,n){return Math.max(t,Math.min(n,e))}function jhe(e){return la(e,-32768,32767)}function sp(e,t,n,o=1e-6){return e>=Math.min(t,n)-o&&e<=Math.max(t,n)+o}function rI(e,t,n){n=n||(g=>e[g]<t);let o=e.length-1,u=0,d;for(;o-u>1;)d=u+o>>1,n(d)?u=d:o=d;return{lo:u,hi:o}}const op=(e,t,n,o)=>rI(e,n,o?u=>{const d=e[u][t];return d<n||d===n&&e[u+1][t]===n}:u=>e[u][t]<n),zhe=(e,t,n)=>rI(e,n,o=>e[o][t]>=n);function Nhe(e,t,n){let o=0,u=e.length;for(;o<u&&e[o]<t;)o++;for(;u>o&&e[u-1]>n;)u--;return o>0||u<e.length?e.slice(o,u):e}const vV=["push","pop","shift","splice","unshift"];function Fhe(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),vV.forEach(n=>{const o="_onData"+tI(n),u=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...d){const g=u.apply(this,d);return e._chartjs.listeners.forEach(i=>{typeof i[o]=="function"&&i[o](...d)}),g}})})}function CN(e,t){const n=e._chartjs;if(!n)return;const o=n.listeners,u=o.indexOf(t);u!==-1&&o.splice(u,1),!(o.length>0)&&(vV.forEach(d=>{delete e[d]}),delete e._chartjs)}function xV(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const bV=(function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame})();function wV(e,t){let n=[],o=!1;return function(...u){n=u,o||(o=!0,bV.call(window,()=>{o=!1,e.apply(t,n)}))}}function Bhe(e,t){let n;return function(...o){return t?(clearTimeout(n),n=setTimeout(e,t,o)):e.apply(this,o),t}}const iI=e=>e==="start"?"left":e==="end"?"right":"center",al=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,Uhe=(e,t,n,o)=>e===(o?"left":"right")?n:e==="center"?(t+n)/2:t;function SV(e,t,n){const o=t.length;let u=0,d=o;if(e._sorted){const{iScale:g,vScale:i,_parsed:E}=e,P=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,I=g.axis,{min:D,max:F,minDefined:$,maxDefined:Z}=g.getUserBounds();if($){if(u=Math.min(op(E,I,D).lo,n?o:op(t,I,g.getPixelForValue(D)).lo),P){const q=E.slice(0,u+1).reverse().findIndex(X=>!Ei(X[i.axis]));u-=Math.max(0,q)}u=la(u,0,o-1)}if(Z){let q=Math.max(op(E,g.axis,F,!0).hi+1,n?0:op(t,I,g.getPixelForValue(F),!0).hi+1);if(P){const X=E.slice(q-1).findIndex(re=>!Ei(re[i.axis]));q+=Math.max(0,X)}d=la(q,u,o)-u}else d=o-u}return{start:u,count:d}}function TV(e){const{xScale:t,yScale:n,_scaleRanges:o}=e,u={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!o)return e._scaleRanges=u,!0;const d=o.xmin!==t.min||o.xmax!==t.max||o.ymin!==n.min||o.ymax!==n.max;return Object.assign(o,u),d}const Tb=e=>e===0||e===1,PN=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*Ts/n)),IN=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*Ts/n)+1,sx={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*mo)+1,easeOutSine:e=>Math.sin(e*mo),easeInOutSine:e=>-.5*(Math.cos(Vi*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>Tb(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Tb(e)?e:PN(e,.075,.3),easeOutElastic:e=>Tb(e)?e:IN(e,.075,.3),easeInOutElastic(e){return Tb(e)?e:e<.5?.5*PN(e*2,.1125,.45):.5+.5*IN(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-sx.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?sx.easeInBounce(e*2)*.5:sx.easeOutBounce(e*2-1)*.5+.5};function sI(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function MN(e){return sI(e)?e:new Px(e)}function bE(e){return sI(e)?e:new Px(e).saturate(.5).darken(.1).hexString()}const Vhe=["x","y","borderWidth","radius","tension"],$he=["color","borderColor","backgroundColor"];function Hhe(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:$he},numbers:{type:"number",properties:Vhe}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Ghe(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const kN=new Map;function Whe(e,t){t=t||{};const n=e+JSON.stringify(t);let o=kN.get(n);return o||(o=new Intl.NumberFormat(e,t),kN.set(n,o)),o}function u0(e,t,n){return Whe(t,n).format(e)}const EV={values(e){return ks(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const o=this.chart.options.locale;let u,d=e;if(n.length>1){const P=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(P<1e-4||P>1e15)&&(u="scientific"),d=qhe(e,n)}const g=xm(Math.abs(d)),i=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),E={notation:u,minimumFractionDigits:i,maximumFractionDigits:i};return Object.assign(E,this.options.ticks.format),u0(e,o,E)},logarithmic(e,t,n){if(e===0)return"0";const o=n[t].significand||e/Math.pow(10,Math.floor(xm(e)));return[1,2,3,5,10,15].includes(o)||t>.8*n.length?EV.numeric.call(this,e,t,n):""}};function qhe(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var iS={formatters:EV};function Zhe(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:iS.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const r_=Object.create(null),BA=Object.create(null);function ox(e,t){if(!t)return e;const n=t.split(".");for(let o=0,u=n.length;o<u;++o){const d=n[o];e=e[d]||(e[d]=Object.create(null))}return e}function wE(e,t,n){return typeof t=="string"?Ix(ox(e,t),n):Ix(ox(e,""),t)}class Xhe{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=o=>o.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(o,u)=>bE(u.backgroundColor),this.hoverBorderColor=(o,u)=>bE(u.borderColor),this.hoverColor=(o,u)=>bE(u.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return wE(this,t,n)}get(t){return ox(this,t)}describe(t,n){return wE(BA,t,n)}override(t,n){return wE(r_,t,n)}route(t,n,o,u){const d=ox(this,t),g=ox(this,o),i="_"+n;Object.defineProperties(d,{[i]:{value:d[n],writable:!0},[n]:{enumerable:!0,get(){const E=this[i],P=g[u];return Pi(E)?Object.assign({},P,E):Kr(E,P)},set(E){this[i]=E}}})}apply(t){t.forEach(n=>n(this))}}var Os=new Xhe({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Hhe,Ghe,Zhe]);function Yhe(e){return!e||Ei(e.size)||Ei(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function ew(e,t,n,o,u){let d=t[u];return d||(d=t[u]=e.measureText(u).width,n.push(u)),d>o&&(o=d),o}function Khe(e,t,n,o){o=o||{};let u=o.data=o.data||{},d=o.garbageCollect=o.garbageCollect||[];o.font!==t&&(u=o.data={},d=o.garbageCollect=[],o.font=t),e.save(),e.font=t;let g=0;const i=n.length;let E,P,I,D,F;for(E=0;E<i;E++)if(D=n[E],D!=null&&!ks(D))g=ew(e,u,d,g,D);else if(ks(D))for(P=0,I=D.length;P<I;P++)F=D[P],F!=null&&!ks(F)&&(g=ew(e,u,d,g,F));e.restore();const $=d.length/2;if($>n.length){for(E=0;E<$;E++)delete u[d[E]];d.splice(0,$)}return g}function Eg(e,t,n){const o=e.currentDevicePixelRatio,u=n!==0?Math.max(n/2,.5):0;return Math.round((t-u)*o)/o+u}function RN(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function UA(e,t,n,o){AV(e,t,n,o,null)}function AV(e,t,n,o,u){let d,g,i,E,P,I,D,F;const $=t.pointStyle,Z=t.rotation,q=t.radius;let X=(Z||0)*khe;if($&&typeof $=="object"&&(d=$.toString(),d==="[object HTMLImageElement]"||d==="[object HTMLCanvasElement]")){e.save(),e.translate(n,o),e.rotate(X),e.drawImage($,-$.width/2,-$.height/2,$.width,$.height),e.restore();return}if(!(isNaN(q)||q<=0)){switch(e.beginPath(),$){default:u?e.ellipse(n,o,u/2,q,0,0,Ts):e.arc(n,o,q,0,Ts),e.closePath();break;case"triangle":I=u?u/2:q,e.moveTo(n+Math.sin(X)*I,o-Math.cos(X)*q),X+=TN,e.lineTo(n+Math.sin(X)*I,o-Math.cos(X)*q),X+=TN,e.lineTo(n+Math.sin(X)*I,o-Math.cos(X)*q),e.closePath();break;case"rectRounded":P=q*.516,E=q-P,g=Math.cos(X+Tg)*E,D=Math.cos(X+Tg)*(u?u/2-P:E),i=Math.sin(X+Tg)*E,F=Math.sin(X+Tg)*(u?u/2-P:E),e.arc(n-D,o-i,P,X-Vi,X-mo),e.arc(n+F,o-g,P,X-mo,X),e.arc(n+D,o+i,P,X,X+mo),e.arc(n-F,o+g,P,X+mo,X+Vi),e.closePath();break;case"rect":if(!Z){E=Math.SQRT1_2*q,I=u?u/2:E,e.rect(n-I,o-E,2*I,2*E);break}X+=Tg;case"rectRot":D=Math.cos(X)*(u?u/2:q),g=Math.cos(X)*q,i=Math.sin(X)*q,F=Math.sin(X)*(u?u/2:q),e.moveTo(n-D,o-i),e.lineTo(n+F,o-g),e.lineTo(n+D,o+i),e.lineTo(n-F,o+g),e.closePath();break;case"crossRot":X+=Tg;case"cross":D=Math.cos(X)*(u?u/2:q),g=Math.cos(X)*q,i=Math.sin(X)*q,F=Math.sin(X)*(u?u/2:q),e.moveTo(n-D,o-i),e.lineTo(n+D,o+i),e.moveTo(n+F,o-g),e.lineTo(n-F,o+g);break;case"star":D=Math.cos(X)*(u?u/2:q),g=Math.cos(X)*q,i=Math.sin(X)*q,F=Math.sin(X)*(u?u/2:q),e.moveTo(n-D,o-i),e.lineTo(n+D,o+i),e.moveTo(n+F,o-g),e.lineTo(n-F,o+g),X+=Tg,D=Math.cos(X)*(u?u/2:q),g=Math.cos(X)*q,i=Math.sin(X)*q,F=Math.sin(X)*(u?u/2:q),e.moveTo(n-D,o-i),e.lineTo(n+D,o+i),e.moveTo(n+F,o-g),e.lineTo(n-F,o+g);break;case"line":g=u?u/2:Math.cos(X)*q,i=Math.sin(X)*q,e.moveTo(n-g,o-i),e.lineTo(n+g,o+i);break;case"dash":e.moveTo(n,o),e.lineTo(n+Math.cos(X)*(u?u/2:q),o+Math.sin(X)*q);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function ap(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function sS(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function oS(e){e.restore()}function Jhe(e,t,n,o,u){if(!t)return e.lineTo(n.x,n.y);if(u==="middle"){const d=(t.x+n.x)/2;e.lineTo(d,t.y),e.lineTo(d,n.y)}else u==="after"!=!!o?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function Qhe(e,t,n,o){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(o?t.cp1x:t.cp2x,o?t.cp1y:t.cp2y,o?n.cp2x:n.cp1x,o?n.cp2y:n.cp1y,n.x,n.y)}function ede(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),Ei(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function tde(e,t,n,o,u){if(u.strikethrough||u.underline){const d=e.measureText(o),g=t-d.actualBoundingBoxLeft,i=t+d.actualBoundingBoxRight,E=n-d.actualBoundingBoxAscent,P=n+d.actualBoundingBoxDescent,I=u.strikethrough?(E+P)/2:P;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=u.decorationWidth||2,e.moveTo(g,I),e.lineTo(i,I),e.stroke()}}function nde(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function i_(e,t,n,o,u,d={}){const g=ks(t)?t:[t],i=d.strokeWidth>0&&d.strokeColor!=="";let E,P;for(e.save(),e.font=u.string,ede(e,d),E=0;E<g.length;++E)P=g[E],d.backdrop&&nde(e,d.backdrop),i&&(d.strokeColor&&(e.strokeStyle=d.strokeColor),Ei(d.strokeWidth)||(e.lineWidth=d.strokeWidth),e.strokeText(P,n,o,d.maxWidth)),e.fillText(P,n,o,d.maxWidth),tde(e,n,o,P,d),o+=Number(u.lineHeight);e.restore()}function Rx(e,t){const{x:n,y:o,w:u,h:d,radius:g}=t;e.arc(n+g.topLeft,o+g.topLeft,g.topLeft,1.5*Vi,Vi,!0),e.lineTo(n,o+d-g.bottomLeft),e.arc(n+g.bottomLeft,o+d-g.bottomLeft,g.bottomLeft,Vi,mo,!0),e.lineTo(n+u-g.bottomRight,o+d),e.arc(n+u-g.bottomRight,o+d-g.bottomRight,g.bottomRight,mo,0,!0),e.lineTo(n+u,o+g.topRight),e.arc(n+u-g.topRight,o+g.topRight,g.topRight,0,-mo,!0),e.lineTo(n+g.topLeft,o)}const rde=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,ide=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function sde(e,t){const n=(""+e).match(rde);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const ode=e=>+e||0;function oI(e,t){const n={},o=Pi(t),u=o?Object.keys(t):t,d=Pi(e)?o?g=>Kr(e[g],e[t[g]]):g=>e[g]:()=>e;for(const g of u)n[g]=ode(d(g));return n}function CV(e){return oI(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Hg(e){return oI(e,["topLeft","topRight","bottomLeft","bottomRight"])}function dl(e){const t=CV(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Wo(e,t){e=e||{},t=t||Os.font;let n=Kr(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let o=Kr(e.style,t.style);o&&!(""+o).match(ide)&&(console.warn('Invalid font style specified: "'+o+'"'),o=void 0);const u={family:Kr(e.family,t.family),lineHeight:sde(Kr(e.lineHeight,t.lineHeight),n),size:n,style:o,weight:Kr(e.weight,t.weight),string:""};return u.string=Yhe(u),u}function Kv(e,t,n,o){let u,d,g;for(u=0,d=e.length;u<d;++u)if(g=e[u],g!==void 0&&g!==void 0)return g}function ade(e,t,n){const{min:o,max:u}=e,d=mV(t,(u-o)/2),g=(i,E)=>n&&i===0?0:i+E;return{min:g(o,-Math.abs(d)),max:g(u,d)}}function Bm(e,t){return Object.assign(Object.create(e),t)}function aI(e,t=[""],n,o,u=()=>e[0]){const d=n||e;typeof o>"u"&&(o=kV("_fallback",e));const g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:d,_fallback:o,_getTarget:u,override:i=>aI([i,...e],t,d,o)};return new Proxy(g,{deleteProperty(i,E){return delete i[E],delete i._keys,delete e[0][E],!0},get(i,E){return IV(i,E,()=>mde(E,t,e,i))},getOwnPropertyDescriptor(i,E){return Reflect.getOwnPropertyDescriptor(i._scopes[0],E)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(i,E){return DN(i).includes(E)},ownKeys(i){return DN(i)},set(i,E,P){const I=i._storage||(i._storage=u());return i[E]=I[E]=P,delete i._keys,!0}})}function wy(e,t,n,o){const u={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:PV(e,o),setContext:d=>wy(e,d,n,o),override:d=>wy(e.override(d),t,n,o)};return new Proxy(u,{deleteProperty(d,g){return delete d[g],delete e[g],!0},get(d,g,i){return IV(d,g,()=>cde(d,g,i))},getOwnPropertyDescriptor(d,g){return d._descriptors.allKeys?Reflect.has(e,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,g)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(d,g){return Reflect.has(e,g)},ownKeys(){return Reflect.ownKeys(e)},set(d,g,i){return e[g]=i,delete d[g],!0}})}function PV(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:o=t.indexable,_allKeys:u=t.allKeys}=e;return{allKeys:u,scriptable:n,indexable:o,isScriptable:Rm(n)?n:()=>n,isIndexable:Rm(o)?o:()=>o}}const lde=(e,t)=>e?e+tI(t):t,lI=(e,t)=>Pi(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function IV(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const o=n();return e[t]=o,o}function cde(e,t,n){const{_proxy:o,_context:u,_subProxy:d,_descriptors:g}=e;let i=o[t];return Rm(i)&&g.isScriptable(t)&&(i=ude(t,i,e,n)),ks(i)&&i.length&&(i=hde(t,i,e,g.isIndexable)),lI(t,i)&&(i=wy(i,u,d&&d[t],g)),i}function ude(e,t,n,o){const{_proxy:u,_context:d,_subProxy:g,_stack:i}=n;if(i.has(e))throw new Error("Recursion detected: "+Array.from(i).join("->")+"->"+e);i.add(e);let E=t(d,g||o);return i.delete(e),lI(e,E)&&(E=cI(u._scopes,u,e,E)),E}function hde(e,t,n,o){const{_proxy:u,_context:d,_subProxy:g,_descriptors:i}=n;if(typeof d.index<"u"&&o(e))return t[d.index%t.length];if(Pi(t[0])){const E=t,P=u._scopes.filter(I=>I!==E);t=[];for(const I of E){const D=cI(P,u,e,I);t.push(wy(D,d,g&&g[e],i))}}return t}function MV(e,t,n){return Rm(e)?e(t,n):e}const dde=(e,t)=>e===!0?t:typeof e=="string"?km(t,e):void 0;function fde(e,t,n,o,u){for(const d of t){const g=dde(n,d);if(g){e.add(g);const i=MV(g._fallback,n,u);if(typeof i<"u"&&i!==n&&i!==o)return i}else if(g===!1&&typeof o<"u"&&n!==o)return null}return!1}function cI(e,t,n,o){const u=t._rootScopes,d=MV(t._fallback,n,o),g=[...e,...u],i=new Set;i.add(o);let E=ON(i,g,n,d||n,o);return E===null||typeof d<"u"&&d!==n&&(E=ON(i,g,d,E,o),E===null)?!1:aI(Array.from(i),[""],u,d,()=>pde(t,n,o))}function ON(e,t,n,o,u){for(;n;)n=fde(e,t,n,o,u);return n}function pde(e,t,n){const o=e._getTarget();t in o||(o[t]={});const u=o[t];return ks(u)&&Pi(n)?n:u||{}}function mde(e,t,n,o){let u;for(const d of t)if(u=kV(lde(d,e),n),typeof u<"u")return lI(e,u)?cI(n,o,e,u):u}function kV(e,t){for(const n of t){if(!n)continue;const o=n[e];if(typeof o<"u")return o}}function DN(e){let t=e._keys;return t||(t=e._keys=gde(e._scopes)),t}function gde(e){const t=new Set;for(const n of e)for(const o of Object.keys(n).filter(u=>!u.startsWith("_")))t.add(o);return Array.from(t)}function RV(e,t,n,o){const{iScale:u}=e,{key:d="r"}=this._parsing,g=new Array(o);let i,E,P,I;for(i=0,E=o;i<E;++i)P=i+n,I=t[P],g[i]={r:u.parse(km(I,d),P)};return g}const _de=Number.EPSILON||1e-14,Sy=(e,t)=>t<e.length&&!e[t].skip&&e[t],OV=e=>e==="x"?"y":"x";function yde(e,t,n,o){const u=e.skip?t:e,d=t,g=n.skip?t:n,i=FA(d,u),E=FA(g,d);let P=i/(i+E),I=E/(i+E);P=isNaN(P)?0:P,I=isNaN(I)?0:I;const D=o*P,F=o*I;return{previous:{x:d.x-D*(g.x-u.x),y:d.y-D*(g.y-u.y)},next:{x:d.x+F*(g.x-u.x),y:d.y+F*(g.y-u.y)}}}function vde(e,t,n){const o=e.length;let u,d,g,i,E,P=Sy(e,0);for(let I=0;I<o-1;++I)if(E=P,P=Sy(e,I+1),!(!E||!P)){if(ix(t[I],0,_de)){n[I]=n[I+1]=0;continue}u=n[I]/t[I],d=n[I+1]/t[I],i=Math.pow(u,2)+Math.pow(d,2),!(i<=9)&&(g=3/Math.sqrt(i),n[I]=u*g*t[I],n[I+1]=d*g*t[I])}}function xde(e,t,n="x"){const o=OV(n),u=e.length;let d,g,i,E=Sy(e,0);for(let P=0;P<u;++P){if(g=i,i=E,E=Sy(e,P+1),!i)continue;const I=i[n],D=i[o];g&&(d=(I-g[n])/3,i[`cp1${n}`]=I-d,i[`cp1${o}`]=D-d*t[P]),E&&(d=(E[n]-I)/3,i[`cp2${n}`]=I+d,i[`cp2${o}`]=D+d*t[P])}}function bde(e,t="x"){const n=OV(t),o=e.length,u=Array(o).fill(0),d=Array(o);let g,i,E,P=Sy(e,0);for(g=0;g<o;++g)if(i=E,E=P,P=Sy(e,g+1),!!E){if(P){const I=P[t]-E[t];u[g]=I!==0?(P[n]-E[n])/I:0}d[g]=i?P?Vd(u[g-1])!==Vd(u[g])?0:(u[g-1]+u[g])/2:u[g-1]:u[g]}vde(e,u,d),xde(e,d,t)}function Eb(e,t,n){return Math.max(Math.min(e,n),t)}function wde(e,t){let n,o,u,d,g,i=ap(e[0],t);for(n=0,o=e.length;n<o;++n)g=d,d=i,i=n<o-1&&ap(e[n+1],t),d&&(u=e[n],g&&(u.cp1x=Eb(u.cp1x,t.left,t.right),u.cp1y=Eb(u.cp1y,t.top,t.bottom)),i&&(u.cp2x=Eb(u.cp2x,t.left,t.right),u.cp2y=Eb(u.cp2y,t.top,t.bottom)))}function Sde(e,t,n,o,u){let d,g,i,E;if(t.spanGaps&&(e=e.filter(P=>!P.skip)),t.cubicInterpolationMode==="monotone")bde(e,u);else{let P=o?e[e.length-1]:e[0];for(d=0,g=e.length;d<g;++d)i=e[d],E=yde(P,i,e[Math.min(d+1,g-(o?0:1))%g],t.tension),i.cp1x=E.previous.x,i.cp1y=E.previous.y,i.cp2x=E.next.x,i.cp2y=E.next.y,P=i}t.capBezierPoints&&wde(e,n)}function uI(){return typeof window<"u"&&typeof document<"u"}function hI(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function tw(e,t,n){let o;return typeof e=="string"?(o=parseInt(e,10),e.indexOf("%")!==-1&&(o=o/100*t.parentNode[n])):o=e,o}const aS=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function Tde(e,t){return aS(e).getPropertyValue(t)}const Ede=["top","right","bottom","left"];function Gg(e,t,n){const o={};n=n?"-"+n:"";for(let u=0;u<4;u++){const d=Ede[u];o[d]=parseFloat(e[t+"-"+d+n])||0}return o.width=o.left+o.right,o.height=o.top+o.bottom,o}const Ade=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function Cde(e,t){const n=e.touches,o=n&&n.length?n[0]:e,{offsetX:u,offsetY:d}=o;let g=!1,i,E;if(Ade(u,d,e.target))i=u,E=d;else{const P=t.getBoundingClientRect();i=o.clientX-P.left,E=o.clientY-P.top,g=!0}return{x:i,y:E,box:g}}function Rg(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:o}=t,u=aS(n),d=u.boxSizing==="border-box",g=Gg(u,"padding"),i=Gg(u,"border","width"),{x:E,y:P,box:I}=Cde(e,n),D=g.left+(I&&i.left),F=g.top+(I&&i.top);let{width:$,height:Z}=t;return d&&($-=g.width+i.width,Z-=g.height+i.height),{x:Math.round((E-D)/$*n.width/o),y:Math.round((P-F)/Z*n.height/o)}}function Pde(e,t,n){let o,u;if(t===void 0||n===void 0){const d=e&&hI(e);if(!d)t=e.clientWidth,n=e.clientHeight;else{const g=d.getBoundingClientRect(),i=aS(d),E=Gg(i,"border","width"),P=Gg(i,"padding");t=g.width-P.width-E.width,n=g.height-P.height-E.height,o=tw(i.maxWidth,d,"clientWidth"),u=tw(i.maxHeight,d,"clientHeight")}}return{width:t,height:n,maxWidth:o||Q1,maxHeight:u||Q1}}const Ab=e=>Math.round(e*10)/10;function Ide(e,t,n,o){const u=aS(e),d=Gg(u,"margin"),g=tw(u.maxWidth,e,"clientWidth")||Q1,i=tw(u.maxHeight,e,"clientHeight")||Q1,E=Pde(e,t,n);let{width:P,height:I}=E;if(u.boxSizing==="content-box"){const F=Gg(u,"border","width"),$=Gg(u,"padding");P-=$.width+F.width,I-=$.height+F.height}return P=Math.max(0,P-d.width),I=Math.max(0,o?P/o:I-d.height),P=Ab(Math.min(P,g,E.maxWidth)),I=Ab(Math.min(I,i,E.maxHeight)),P&&!I&&(I=Ab(P/2)),(t!==void 0||n!==void 0)&&o&&E.height&&I>E.height&&(I=E.height,P=Ab(Math.floor(I*o))),{width:P,height:I}}function LN(e,t,n){const o=t||1,u=Math.floor(e.height*o),d=Math.floor(e.width*o);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const g=e.canvas;return g.style&&(n||!g.style.height&&!g.style.width)&&(g.style.height=`${e.height}px`,g.style.width=`${e.width}px`),e.currentDevicePixelRatio!==o||g.height!==u||g.width!==d?(e.currentDevicePixelRatio=o,g.height=u,g.width=d,e.ctx.setTransform(o,0,0,o,0,0),!0):!1}const Mde=(function(){let e=!1;try{const t={get passive(){return e=!0,!1}};uI()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e})();function jN(e,t){const n=Tde(e,t),o=n&&n.match(/^(\d+)(\.\d+)?px$/);return o?+o[1]:void 0}function Og(e,t,n,o){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function kde(e,t,n,o){return{x:e.x+n*(t.x-e.x),y:o==="middle"?n<.5?e.y:t.y:o==="after"?n<1?e.y:t.y:n>0?t.y:e.y}}function Rde(e,t,n,o){const u={x:e.cp2x,y:e.cp2y},d={x:t.cp1x,y:t.cp1y},g=Og(e,u,n),i=Og(u,d,n),E=Og(d,t,n),P=Og(g,i,n),I=Og(i,E,n);return Og(P,I,n)}const Ode=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,o){return n-o},leftForLtr(n,o){return n-o}}},Dde=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function cy(e,t,n){return e?Ode(t,n):Dde()}function DV(e,t){let n,o;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,o=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=o)}function LV(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function jV(e){return e==="angle"?{between:kx,compare:Lhe,normalize:ll}:{between:sp,compare:(t,n)=>t-n,normalize:t=>t}}function zN({start:e,end:t,count:n,loop:o,style:u}){return{start:e%n,end:t%n,loop:o&&(t-e+1)%n===0,style:u}}function Lde(e,t,n){const{property:o,start:u,end:d}=n,{between:g,normalize:i}=jV(o),E=t.length;let{start:P,end:I,loop:D}=e,F,$;if(D){for(P+=E,I+=E,F=0,$=E;F<$&&g(i(t[P%E][o]),u,d);++F)P--,I--;P%=E,I%=E}return I<P&&(I+=E),{start:P,end:I,loop:D,style:e.style}}function zV(e,t,n){if(!n)return[e];const{property:o,start:u,end:d}=n,g=t.length,{compare:i,between:E,normalize:P}=jV(o),{start:I,end:D,loop:F,style:$}=Lde(e,t,n),Z=[];let q=!1,X=null,re,le,ue;const ye=()=>E(u,ue,re)&&i(u,ue)!==0,ge=()=>i(d,re)===0||E(d,ue,re),we=()=>q||ye(),Le=()=>!q||ge();for(let Ze=I,Ge=I;Ze<=D;++Ze)le=t[Ze%g],!le.skip&&(re=P(le[o]),re!==ue&&(q=E(re,u,d),X===null&&we()&&(X=i(re,u)===0?Ze:Ge),X!==null&&Le()&&(Z.push(zN({start:X,end:Ze,loop:F,count:g,style:$})),X=null),Ge=Ze,ue=re));return X!==null&&Z.push(zN({start:X,end:D,loop:F,count:g,style:$})),Z}function NV(e,t){const n=[],o=e.segments;for(let u=0;u<o.length;u++){const d=zV(o[u],e.points,t);d.length&&n.push(...d)}return n}function jde(e,t,n,o){let u=0,d=t-1;if(n&&!o)for(;u<t&&!e[u].skip;)u++;for(;u<t&&e[u].skip;)u++;for(u%=t,n&&(d+=u);d>u&&e[d%t].skip;)d--;return d%=t,{start:u,end:d}}function zde(e,t,n,o){const u=e.length,d=[];let g=t,i=e[t],E;for(E=t+1;E<=n;++E){const P=e[E%u];P.skip||P.stop?i.skip||(o=!1,d.push({start:t%u,end:(E-1)%u,loop:o}),t=g=P.stop?E:null):(g=E,i.skip&&(t=E)),i=P}return g!==null&&d.push({start:t%u,end:g%u,loop:o}),d}function Nde(e,t){const n=e.points,o=e.options.spanGaps,u=n.length;if(!u)return[];const d=!!e._loop,{start:g,end:i}=jde(n,u,d,o);if(o===!0)return NN(e,[{start:g,end:i,loop:d}],n,t);const E=i<g?i+u:i,P=!!e._fullLoop&&g===0&&i===u-1;return NN(e,zde(n,g,E,P),n,t)}function NN(e,t,n,o){return!o||!o.setContext||!n?t:Fde(e,t,n,o)}function Fde(e,t,n,o){const u=e._chart.getContext(),d=FN(e.options),{_datasetIndex:g,options:{spanGaps:i}}=e,E=n.length,P=[];let I=d,D=t[0].start,F=D;function $(Z,q,X,re){const le=i?-1:1;if(Z!==q){for(Z+=E;n[Z%E].skip;)Z-=le;for(;n[q%E].skip;)q+=le;Z%E!==q%E&&(P.push({start:Z%E,end:q%E,loop:X,style:re}),I=re,D=q%E)}}for(const Z of t){D=i?D:Z.start;let q=n[D%E],X;for(F=D+1;F<=Z.end;F++){const re=n[F%E];X=FN(o.setContext(Bm(u,{type:"segment",p0:q,p1:re,p0DataIndex:(F-1)%E,p1DataIndex:F%E,datasetIndex:g}))),Bde(X,I)&&$(D,F-1,Z.loop,I),q=re,I=X}D<F-1&&$(D,F-1,Z.loop,I)}return P}function FN(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function Bde(e,t){if(!t)return!1;const n=[],o=function(u,d){return sI(d)?(n.includes(d)||n.push(d),n.indexOf(d)):d};return JSON.stringify(e,o)!==JSON.stringify(t,o)}function Cb(e,t,n){return e.options.clip?e[n]:t[n]}function Ude(e,t){const{xScale:n,yScale:o}=e;return n&&o?{left:Cb(n,t,"left"),right:Cb(n,t,"right"),top:Cb(o,t,"top"),bottom:Cb(o,t,"bottom")}:t}function FV(e,t){const n=t._clip;if(n.disabled)return!1;const o=Ude(t,e.chartArea);return{left:n.left===!1?0:o.left-(n.left===!0?0:n.left),right:n.right===!1?e.width:o.right+(n.right===!0?0:n.right),top:n.top===!1?0:o.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?e.height:o.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Vde{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,o,u){const d=n.listeners[u],g=n.duration;d.forEach(i=>i({chart:t,initial:n.initial,numSteps:g,currentStep:Math.min(o-n.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=bV.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((o,u)=>{if(!o.running||!o.items.length)return;const d=o.items;let g=d.length-1,i=!1,E;for(;g>=0;--g)E=d[g],E._active?(E._total>o.duration&&(o.duration=E._total),E.tick(t),i=!0):(d[g]=d[d.length-1],d.pop());i&&(u.draw(),this._notify(u,o,t,"progress")),d.length||(o.running=!1,this._notify(u,o,t,"complete"),o.initial=!1),n+=d.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let o=n.get(t);return o||(o={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,o)),o}listen(t,n,o){this._getAnims(t).listeners[n].push(o)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((o,u)=>Math.max(o,u._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const o=n.items;let u=o.length-1;for(;u>=0;--u)o[u].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Jf=new Vde;const BN="transparent",$de={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const o=MN(e||BN),u=o.valid&&MN(t||BN);return u&&u.valid?u.mix(o,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class Hde{constructor(t,n,o,u){const d=n[o];u=Kv([t.to,u,d,t.from]);const g=Kv([t.from,d,u]);this._active=!0,this._fn=t.fn||$de[t.type||typeof g],this._easing=sx[t.easing]||sx.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=o,this._from=g,this._to=u,this._promises=void 0}active(){return this._active}update(t,n,o){if(this._active){this._notify(!1);const u=this._target[this._prop],d=o-this._start,g=this._duration-d;this._start=o,this._duration=Math.floor(Math.max(g,t.duration)),this._total+=d,this._loop=!!t.loop,this._to=Kv([t.to,n,u,t.from]),this._from=Kv([t.from,u,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,o=this._duration,u=this._prop,d=this._from,g=this._loop,i=this._to;let E;if(this._active=d!==i&&(g||n<o),!this._active){this._target[u]=i,this._notify(!0);return}if(n<0){this._target[u]=d;return}E=n/o%2,E=g&&E>1?2-E:E,E=this._easing(Math.min(1,Math.max(0,E))),this._target[u]=this._fn(d,i,E)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,o)=>{t.push({res:n,rej:o})})}_notify(t){const n=t?"res":"rej",o=this._promises||[];for(let u=0;u<o.length;u++)o[u][n]()}}class BV{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!Pi(t))return;const n=Object.keys(Os.animation),o=this._properties;Object.getOwnPropertyNames(t).forEach(u=>{const d=t[u];if(!Pi(d))return;const g={};for(const i of n)g[i]=d[i];(ks(d.properties)&&d.properties||[u]).forEach(i=>{(i===u||!o.has(i))&&o.set(i,g)})})}_animateOptions(t,n){const o=n.options,u=Wde(t,o);if(!u)return[];const d=this._createAnimations(u,o);return o.$shared&&Gde(t.options.$animations,o).then(()=>{t.options=o},()=>{}),d}_createAnimations(t,n){const o=this._properties,u=[],d=t.$animations||(t.$animations={}),g=Object.keys(n),i=Date.now();let E;for(E=g.length-1;E>=0;--E){const P=g[E];if(P.charAt(0)==="$")continue;if(P==="options"){u.push(...this._animateOptions(t,n));continue}const I=n[P];let D=d[P];const F=o.get(P);if(D)if(F&&D.active()){D.update(F,I,i);continue}else D.cancel();if(!F||!F.duration){t[P]=I;continue}d[P]=D=new Hde(F,t,P,I),u.push(D)}return u}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const o=this._createAnimations(t,n);if(o.length)return Jf.add(this._chart,o),!0}}function Gde(e,t){const n=[],o=Object.keys(t);for(let u=0;u<o.length;u++){const d=e[o[u]];d&&d.active()&&n.push(d.wait())}return Promise.all(n)}function Wde(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function UN(e,t){const n=e&&e.options||{},o=n.reverse,u=n.min===void 0?t:0,d=n.max===void 0?t:0;return{start:o?d:u,end:o?u:d}}function qde(e,t,n){if(n===!1)return!1;const o=UN(e,n),u=UN(t,n);return{top:u.end,right:o.end,bottom:u.start,left:o.start}}function Zde(e){let t,n,o,u;return Pi(e)?(t=e.top,n=e.right,o=e.bottom,u=e.left):t=n=o=u=e,{top:t,right:n,bottom:o,left:u,disabled:e===!1}}function UV(e,t){const n=[],o=e._getSortedDatasetMetas(t);let u,d;for(u=0,d=o.length;u<d;++u)n.push(o[u].index);return n}function VN(e,t,n,o={}){const u=e.keys,d=o.mode==="single";let g,i,E,P;if(t===null)return;let I=!1;for(g=0,i=u.length;g<i;++g){if(E=+u[g],E===n){if(I=!0,o.all)continue;break}P=e.values[E],to(P)&&(d||t===0||Vd(t)===Vd(P))&&(t+=P)}return!I&&!o.all?0:t}function Xde(e,t){const{iScale:n,vScale:o}=t,u=n.axis==="x"?"x":"y",d=o.axis==="x"?"x":"y",g=Object.keys(e),i=new Array(g.length);let E,P,I;for(E=0,P=g.length;E<P;++E)I=g[E],i[E]={[u]:I,[d]:e[I]};return i}function SE(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function Yde(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function Kde(e){const{min:t,max:n,minDefined:o,maxDefined:u}=e.getUserBounds();return{min:o?t:Number.NEGATIVE_INFINITY,max:u?n:Number.POSITIVE_INFINITY}}function Jde(e,t,n){const o=e[t]||(e[t]={});return o[n]||(o[n]={})}function $N(e,t,n,o){for(const u of t.getMatchingVisibleMetas(o).reverse()){const d=e[u.index];if(n&&d>0||!n&&d<0)return u.index}return null}function HN(e,t){const{chart:n,_cachedMeta:o}=e,u=n._stacks||(n._stacks={}),{iScale:d,vScale:g,index:i}=o,E=d.axis,P=g.axis,I=Yde(d,g,o),D=t.length;let F;for(let $=0;$<D;++$){const Z=t[$],{[E]:q,[P]:X}=Z,re=Z._stacks||(Z._stacks={});F=re[P]=Jde(u,I,q),F[i]=X,F._top=$N(F,g,!0,o.type),F._bottom=$N(F,g,!1,o.type);const le=F._visualValues||(F._visualValues={});le[i]=X}}function TE(e,t){const n=e.scales;return Object.keys(n).filter(o=>n[o].axis===t).shift()}function Qde(e,t){return Bm(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function efe(e,t,n){return Bm(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function Vv(e,t){const n=e.controller.index,o=e.vScale&&e.vScale.axis;if(o){t=t||e._parsed;for(const u of t){const d=u._stacks;if(!d||d[o]===void 0||d[o][n]===void 0)return;delete d[o][n],d[o]._visualValues!==void 0&&d[o]._visualValues[n]!==void 0&&delete d[o]._visualValues[n]}}}const EE=e=>e==="reset"||e==="none",GN=(e,t)=>t?e:Object.assign({},e),tfe=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:UV(n,!0),values:null};class Oh{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=SE(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Vv(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,o=this.getDataset(),u=(D,F,$,Z)=>D==="x"?F:D==="r"?Z:$,d=n.xAxisID=Kr(o.xAxisID,TE(t,"x")),g=n.yAxisID=Kr(o.yAxisID,TE(t,"y")),i=n.rAxisID=Kr(o.rAxisID,TE(t,"r")),E=n.indexAxis,P=n.iAxisID=u(E,d,g,i),I=n.vAxisID=u(E,g,d,i);n.xScale=this.getScaleForId(d),n.yScale=this.getScaleForId(g),n.rScale=this.getScaleForId(i),n.iScale=this.getScaleForId(P),n.vScale=this.getScaleForId(I)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&CN(this._data,this),t._stacked&&Vv(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),o=this._data;if(Pi(n)){const u=this._cachedMeta;this._data=Xde(n,u)}else if(o!==n){if(o){CN(o,this);const u=this._cachedMeta;Vv(u),u._parsed=[]}n&&Object.isExtensible(n)&&Fhe(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,o=this.getDataset();let u=!1;this._dataCheck();const d=n._stacked;n._stacked=SE(n.vScale,n),n.stack!==o.stack&&(u=!0,Vv(n),n.stack=o.stack),this._resyncElements(t),(u||d!==n._stacked)&&(HN(this,n._parsed),n._stacked=SE(n.vScale,n))}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),o=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(o,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:o,_data:u}=this,{iScale:d,_stacked:g}=o,i=d.axis;let E=t===0&&n===u.length?!0:o._sorted,P=t>0&&o._parsed[t-1],I,D,F;if(this._parsing===!1)o._parsed=u,o._sorted=!0,F=u;else{ks(u[t])?F=this.parseArrayData(o,u,t,n):Pi(u[t])?F=this.parseObjectData(o,u,t,n):F=this.parsePrimitiveData(o,u,t,n);const $=()=>D[i]===null||P&&D[i]<P[i];for(I=0;I<n;++I)o._parsed[I+t]=D=F[I],E&&($()&&(E=!1),P=D);o._sorted=E}g&&HN(this,F)}parsePrimitiveData(t,n,o,u){const{iScale:d,vScale:g}=t,i=d.axis,E=g.axis,P=d.getLabels(),I=d===g,D=new Array(u);let F,$,Z;for(F=0,$=u;F<$;++F)Z=F+o,D[F]={[i]:I||d.parse(P[Z],Z),[E]:g.parse(n[Z],Z)};return D}parseArrayData(t,n,o,u){const{xScale:d,yScale:g}=t,i=new Array(u);let E,P,I,D;for(E=0,P=u;E<P;++E)I=E+o,D=n[I],i[E]={x:d.parse(D[0],I),y:g.parse(D[1],I)};return i}parseObjectData(t,n,o,u){const{xScale:d,yScale:g}=t,{xAxisKey:i="x",yAxisKey:E="y"}=this._parsing,P=new Array(u);let I,D,F,$;for(I=0,D=u;I<D;++I)F=I+o,$=n[F],P[I]={x:d.parse(km($,i),F),y:g.parse(km($,E),F)};return P}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,o){const u=this.chart,d=this._cachedMeta,g=n[t.axis],i={keys:UV(u,!0),values:n._stacks[t.axis]._visualValues};return VN(i,g,d.index,{mode:o})}updateRangeFromParsed(t,n,o,u){const d=o[n.axis];let g=d===null?NaN:d;const i=u&&o._stacks[n.axis];u&&i&&(u.values=i,g=VN(u,d,this._cachedMeta.index)),t.min=Math.min(t.min,g),t.max=Math.max(t.max,g)}getMinMax(t,n){const o=this._cachedMeta,u=o._parsed,d=o._sorted&&t===o.iScale,g=u.length,i=this._getOtherScale(t),E=tfe(n,o,this.chart),P={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:I,max:D}=Kde(i);let F,$;function Z(){$=u[F];const q=$[i.axis];return!to($[t.axis])||I>q||D<q}for(F=0;F<g&&!(!Z()&&(this.updateRangeFromParsed(P,t,$,E),d));++F);if(d){for(F=g-1;F>=0;--F)if(!Z()){this.updateRangeFromParsed(P,t,$,E);break}}return P}getAllParsedValues(t){const n=this._cachedMeta._parsed,o=[];let u,d,g;for(u=0,d=n.length;u<d;++u)g=n[u][t.axis],to(g)&&o.push(g);return o}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,o=n.iScale,u=n.vScale,d=this.getParsed(t);return{label:o?""+o.getLabelForValue(d[o.axis]):"",value:u?""+u.getLabelForValue(d[u.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=Zde(Kr(this.options.clip,qde(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,o=this._cachedMeta,u=o.data||[],d=n.chartArea,g=[],i=this._drawStart||0,E=this._drawCount||u.length-i,P=this.options.drawActiveElementsOnTop;let I;for(o.dataset&&o.dataset.draw(t,d,i,E),I=i;I<i+E;++I){const D=u[I];D.hidden||(D.active&&P?g.push(D):D.draw(t,d))}for(I=0;I<g.length;++I)g[I].draw(t,d)}getStyle(t,n){const o=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(o):this.resolveDataElementOptions(t||0,o)}getContext(t,n,o){const u=this.getDataset();let d;if(t>=0&&t<this._cachedMeta.data.length){const g=this._cachedMeta.data[t];d=g.$context||(g.$context=efe(this.getContext(),t,g)),d.parsed=this.getParsed(t),d.raw=u.data[t],d.index=d.dataIndex=t}else d=this.$context||(this.$context=Qde(this.chart.getContext(),this.index)),d.dataset=u,d.index=d.datasetIndex=this.index;return d.active=!!n,d.mode=o,d}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",o){const u=n==="active",d=this._cachedDataOpts,g=t+"-"+n,i=d[g],E=this.enableOptionSharing&&Mx(o);if(i)return GN(i,E);const P=this.chart.config,I=P.datasetElementScopeKeys(this._type,t),D=u?[`${t}Hover`,"hover",t,""]:[t,""],F=P.getOptionScopes(this.getDataset(),I),$=Object.keys(Os.elements[t]),Z=()=>this.getContext(o,u,n),q=P.resolveNamedOptions(F,$,Z,D);return q.$shared&&(q.$shared=E,d[g]=Object.freeze(GN(q,E))),q}_resolveAnimations(t,n,o){const u=this.chart,d=this._cachedDataOpts,g=`animation-${n}`,i=d[g];if(i)return i;let E;if(u.options.animation!==!1){const I=this.chart.config,D=I.datasetAnimationScopeKeys(this._type,n),F=I.getOptionScopes(this.getDataset(),D);E=I.createResolver(F,this.getContext(t,o,n))}const P=new BV(u,E&&E.animations);return E&&E._cacheable&&(d[g]=Object.freeze(P)),P}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||EE(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const o=this.resolveDataElementOptions(t,n),u=this._sharedOptions,d=this.getSharedOptions(o),g=this.includeOptions(n,d)||d!==u;return this.updateSharedOptions(d,n,o),{sharedOptions:d,includeOptions:g}}updateElement(t,n,o,u){EE(u)?Object.assign(t,o):this._resolveAnimations(n,u).update(t,o)}updateSharedOptions(t,n,o){t&&!EE(n)&&this._resolveAnimations(void 0,n).update(t,o)}_setStyle(t,n,o,u){t.active=u;const d=this.getStyle(n,u);this._resolveAnimations(n,o,u).update(t,{options:!u&&this.getSharedOptions(d)||d})}removeHoverStyle(t,n,o){this._setStyle(t,o,"active",!1)}setHoverStyle(t,n,o){this._setStyle(t,o,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,o=this._cachedMeta.data;for(const[i,E,P]of this._syncList)this[i](E,P);this._syncList=[];const u=o.length,d=n.length,g=Math.min(d,u);g&&this.parse(0,g),d>u?this._insertElements(u,d-u,t):d<u&&this._removeElements(d,u-d)}_insertElements(t,n,o=!0){const u=this._cachedMeta,d=u.data,g=t+n;let i;const E=P=>{for(P.length+=n,i=P.length-1;i>=g;i--)P[i]=P[i-n]};for(E(d),i=t;i<g;++i)d[i]=new this.dataElementType;this._parsing&&E(u._parsed),this.parse(t,n),o&&this.updateElements(d,t,n,"reset")}updateElements(t,n,o,u){}_removeElements(t,n){const o=this._cachedMeta;if(this._parsing){const u=o._parsed.splice(t,n);o._stacked&&Vv(o,u)}o.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,o,u]=t;this[n](o,u)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const o=arguments.length-2;o&&this._sync(["_insertElements",t,o])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}zn(Oh,"defaults",{}),zn(Oh,"datasetElementType",null),zn(Oh,"dataElementType",null);function nfe(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let o=[];for(let u=0,d=n.length;u<d;u++)o=o.concat(n[u].controller.getAllParsedValues(e));e._cache.$bar=xV(o.sort((u,d)=>u-d))}return e._cache.$bar}function rfe(e){const t=e.iScale,n=nfe(t,e.type);let o=t._length,u,d,g,i;const E=()=>{g===32767||g===-32768||(Mx(i)&&(o=Math.min(o,Math.abs(g-i)||o)),i=g)};for(u=0,d=n.length;u<d;++u)g=t.getPixelForValue(n[u]),E();for(i=void 0,u=0,d=t.ticks.length;u<d;++u)g=t.getPixelForTick(u),E();return o}function ife(e,t,n,o){const u=n.barThickness;let d,g;return Ei(u)?(d=t.min*n.categoryPercentage,g=n.barPercentage):(d=u*o,g=1),{chunk:d/o,ratio:g,start:t.pixels[e]-d/2}}function sfe(e,t,n,o){const u=t.pixels,d=u[e];let g=e>0?u[e-1]:null,i=e<u.length-1?u[e+1]:null;const E=n.categoryPercentage;g===null&&(g=d-(i===null?t.end-t.start:i-d)),i===null&&(i=d+d-g);const P=d-(d-Math.min(g,i))/2*E;return{chunk:Math.abs(i-g)/2*E/o,ratio:n.barPercentage,start:P}}function ofe(e,t,n,o){const u=n.parse(e[0],o),d=n.parse(e[1],o),g=Math.min(u,d),i=Math.max(u,d);let E=g,P=i;Math.abs(g)>Math.abs(i)&&(E=i,P=g),t[n.axis]=P,t._custom={barStart:E,barEnd:P,start:u,end:d,min:g,max:i}}function VV(e,t,n,o){return ks(e)?ofe(e,t,n,o):t[n.axis]=n.parse(e,o),t}function WN(e,t,n,o){const u=e.iScale,d=e.vScale,g=u.getLabels(),i=u===d,E=[];let P,I,D,F;for(P=n,I=n+o;P<I;++P)F=t[P],D={},D[u.axis]=i||u.parse(g[P],P),E.push(VV(F,D,d,P));return E}function AE(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function afe(e,t,n){return e!==0?Vd(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function lfe(e){let t,n,o,u,d;return e.horizontal?(t=e.base>e.x,n="left",o="right"):(t=e.base<e.y,n="bottom",o="top"),t?(u="end",d="start"):(u="start",d="end"),{start:n,end:o,reverse:t,top:u,bottom:d}}function cfe(e,t,n,o){let u=t.borderSkipped;const d={};if(!u){e.borderSkipped=d;return}if(u===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:g,end:i,reverse:E,top:P,bottom:I}=lfe(e);u==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===o?u=P:(n._bottom||0)===o?u=I:(d[qN(I,g,i,E)]=!0,u=P)),d[qN(u,g,i,E)]=!0,e.borderSkipped=d}function qN(e,t,n,o){return o?(e=ufe(e,t,n),e=ZN(e,n,t)):e=ZN(e,t,n),e}function ufe(e,t,n){return e===t?n:e===n?t:e}function ZN(e,t,n){return e==="start"?t:e==="end"?n:e}function hfe(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class ax extends Oh{parsePrimitiveData(t,n,o,u){return WN(t,n,o,u)}parseArrayData(t,n,o,u){return WN(t,n,o,u)}parseObjectData(t,n,o,u){const{iScale:d,vScale:g}=t,{xAxisKey:i="x",yAxisKey:E="y"}=this._parsing,P=d.axis==="x"?i:E,I=g.axis==="x"?i:E,D=[];let F,$,Z,q;for(F=o,$=o+u;F<$;++F)q=n[F],Z={},Z[d.axis]=d.parse(km(q,P),F),D.push(VV(km(q,I),Z,g,F));return D}updateRangeFromParsed(t,n,o,u){super.updateRangeFromParsed(t,n,o,u);const d=o._custom;d&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,d.min),t.max=Math.max(t.max,d.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:o,vScale:u}=n,d=this.getParsed(t),g=d._custom,i=AE(g)?"["+g.start+", "+g.end+"]":""+u.getLabelForValue(d[u.axis]);return{label:""+o.getLabelForValue(d[o.axis]),value:i}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,o,u){const d=u==="reset",{index:g,_cachedMeta:{vScale:i}}=this,E=i.getBasePixel(),P=i.isHorizontal(),I=this._getRuler(),{sharedOptions:D,includeOptions:F}=this._getSharedOptions(n,u);for(let $=n;$<n+o;$++){const Z=this.getParsed($),q=d||Ei(Z[i.axis])?{base:E,head:E}:this._calculateBarValuePixels($),X=this._calculateBarIndexPixels($,I),re=(Z._stacks||{})[i.axis],le={horizontal:P,base:q.base,enableBorderRadius:!re||AE(Z._custom)||g===re._top||g===re._bottom,x:P?q.head:X.center,y:P?X.center:q.head,height:P?X.size:Math.abs(q.size),width:P?Math.abs(q.size):X.size};F&&(le.options=D||this.resolveDataElementOptions($,t[$].active?"active":u));const ue=le.options||t[$].options;cfe(le,ue,re,g),hfe(le,ue,I.ratio),this.updateElement(t[$],$,le,u)}}_getStacks(t,n){const{iScale:o}=this._cachedMeta,u=o.getMatchingVisibleMetas(this._type).filter(I=>I.controller.options.grouped),d=o.options.stacked,g=[],i=this._cachedMeta.controller.getParsed(n),E=i&&i[o.axis],P=I=>{const D=I._parsed.find($=>$[o.axis]===E),F=D&&D[I.vScale.axis];if(Ei(F)||isNaN(F))return!0};for(const I of u)if(!(n!==void 0&&P(I))&&((d===!1||g.indexOf(I.stack)===-1||d===void 0&&I.stack===void 0)&&g.push(I.stack),I.index===t))break;return g.length||g.push(void 0),g}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,n=this.chart.options.indexAxis;return Object.keys(t).filter(o=>t[o].axis===n).shift()}_getAxis(){const t={},n=this.getFirstScaleIdForIndexAxis();for(const o of this.chart.data.datasets)t[Kr(this.chart.options.indexAxis==="x"?o.xAxisID:o.yAxisID,n)]=!0;return Object.keys(t)}_getStackIndex(t,n,o){const u=this._getStacks(t,o),d=n!==void 0?u.indexOf(n):-1;return d===-1?u.length-1:d}_getRuler(){const t=this.options,n=this._cachedMeta,o=n.iScale,u=[];let d,g;for(d=0,g=n.data.length;d<g;++d)u.push(o.getPixelForValue(this.getParsed(d)[o.axis],d));const i=t.barThickness;return{min:i||rfe(n),pixels:u,start:o._startPixel,end:o._endPixel,stackCount:this._getStackCount(),scale:o,grouped:t.grouped,ratio:i?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:o,index:u},options:{base:d,minBarLength:g}}=this,i=d||0,E=this.getParsed(t),P=E._custom,I=AE(P);let D=E[n.axis],F=0,$=o?this.applyStack(n,E,o):D,Z,q;$!==D&&(F=$-D,$=D),I&&(D=P.barStart,$=P.barEnd-P.barStart,D!==0&&Vd(D)!==Vd(P.barEnd)&&(F=0),F+=D);const X=!Ei(d)&&!I?d:F;let re=n.getPixelForValue(X);if(this.chart.getDataVisibility(t)?Z=n.getPixelForValue(F+$):Z=re,q=Z-re,Math.abs(q)<g){q=afe(q,n,i)*g,D===i&&(re-=q/2);const le=n.getPixelForDecimal(0),ue=n.getPixelForDecimal(1),ye=Math.min(le,ue),ge=Math.max(le,ue);re=Math.max(Math.min(re,ge),ye),Z=re+q,o&&!I&&(E._stacks[n.axis]._visualValues[u]=n.getValueForPixel(Z)-n.getValueForPixel(re))}if(re===n.getPixelForValue(i)){const le=Vd(q)*n.getLineWidthForValue(i)/2;re+=le,q-=le}return{size:q,base:re,head:Z,center:Z+q/2}}_calculateBarIndexPixels(t,n){const o=n.scale,u=this.options,d=u.skipNull,g=Kr(u.maxBarThickness,1/0);let i,E;const P=this._getAxisCount();if(n.grouped){const I=d?this._getStackCount(t):n.stackCount,D=u.barThickness==="flex"?sfe(t,n,u,I*P):ife(t,n,u,I*P),F=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,$=this._getAxis().indexOf(Kr(F,this.getFirstScaleIdForIndexAxis())),Z=this._getStackIndex(this.index,this._cachedMeta.stack,d?t:void 0)+$;i=D.start+D.chunk*Z+D.chunk/2,E=Math.min(g,D.chunk*D.ratio)}else i=o.getPixelForValue(this.getParsed(t)[o.axis],t),E=Math.min(g,n.min*n.ratio);return{base:i-E/2,head:i+E/2,center:i,size:E}}draw(){const t=this._cachedMeta,n=t.vScale,o=t.data,u=o.length;let d=0;for(;d<u;++d)this.getParsed(d)[n.axis]!==null&&!o[d].hidden&&o[d].draw(this._ctx)}}zn(ax,"id","bar"),zn(ax,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),zn(ax,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Yb extends Oh{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,o,u){const d=super.parsePrimitiveData(t,n,o,u);for(let g=0;g<d.length;g++)d[g]._custom=this.resolveDataElementOptions(g+o).radius;return d}parseArrayData(t,n,o,u){const d=super.parseArrayData(t,n,o,u);for(let g=0;g<d.length;g++){const i=n[o+g];d[g]._custom=Kr(i[2],this.resolveDataElementOptions(g+o).radius)}return d}parseObjectData(t,n,o,u){const d=super.parseObjectData(t,n,o,u);for(let g=0;g<d.length;g++){const i=n[o+g];d[g]._custom=Kr(i&&i.r&&+i.r,this.resolveDataElementOptions(g+o).radius)}return d}getMaxOverflow(){const t=this._cachedMeta.data;let n=0;for(let o=t.length-1;o>=0;--o)n=Math.max(n,t[o].size(this.resolveDataElementOptions(o))/2);return n>0&&n}getLabelAndValue(t){const n=this._cachedMeta,o=this.chart.data.labels||[],{xScale:u,yScale:d}=n,g=this.getParsed(t),i=u.getLabelForValue(g.x),E=d.getLabelForValue(g.y),P=g._custom;return{label:o[t]||"",value:"("+i+", "+E+(P?", "+P:"")+")"}}update(t){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,o,u){const d=u==="reset",{iScale:g,vScale:i}=this._cachedMeta,{sharedOptions:E,includeOptions:P}=this._getSharedOptions(n,u),I=g.axis,D=i.axis;for(let F=n;F<n+o;F++){const $=t[F],Z=!d&&this.getParsed(F),q={},X=q[I]=d?g.getPixelForDecimal(.5):g.getPixelForValue(Z[I]),re=q[D]=d?i.getBasePixel():i.getPixelForValue(Z[D]);q.skip=isNaN(X)||isNaN(re),P&&(q.options=E||this.resolveDataElementOptions(F,$.active?"active":u),d&&(q.options.radius=0)),this.updateElement($,F,q,u)}}resolveDataElementOptions(t,n){const o=this.getParsed(t);let u=super.resolveDataElementOptions(t,n);u.$shared&&(u=Object.assign({},u,{$shared:!1}));const d=u.radius;return n!=="active"&&(u.radius=0),u.radius+=Kr(o&&o._custom,d),u}}zn(Yb,"id","bubble"),zn(Yb,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),zn(Yb,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function dfe(e,t,n){let o=1,u=1,d=0,g=0;if(t<Ts){const i=e,E=i+t,P=Math.cos(i),I=Math.sin(i),D=Math.cos(E),F=Math.sin(E),$=(ue,ye,ge)=>kx(ue,i,E,!0)?1:Math.max(ye,ye*n,ge,ge*n),Z=(ue,ye,ge)=>kx(ue,i,E,!0)?-1:Math.min(ye,ye*n,ge,ge*n),q=$(0,P,D),X=$(mo,I,F),re=Z(Vi,P,D),le=Z(Vi+mo,I,F);o=(q-re)/2,u=(X-le)/2,d=-(q+re)/2,g=-(X+le)/2}return{ratioX:o,ratioY:u,offsetX:d,offsetY:g}}class Ng extends Oh{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const o=this.getDataset().data,u=this._cachedMeta;if(this._parsing===!1)u._parsed=o;else{let d=E=>+o[E];if(Pi(o[t])){const{key:E="value"}=this._parsing;d=P=>+km(o[P],E)}let g,i;for(g=t,i=t+n;g<i;++g)u._parsed[g]=d(g)}}_getRotation(){return kh(this.options.rotation-90)}_getCircumference(){return kh(this.options.circumference)}_getRotationExtents(){let t=Ts,n=-Ts;for(let o=0;o<this.chart.data.datasets.length;++o)if(this.chart.isDatasetVisible(o)&&this.chart.getDatasetMeta(o).type===this._type){const u=this.chart.getDatasetMeta(o).controller,d=u._getRotation(),g=u._getCircumference();t=Math.min(t,d),n=Math.max(n,d+g)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:o}=n,u=this._cachedMeta,d=u.data,g=this.getMaxBorderWidth()+this.getMaxOffset(d)+this.options.spacing,i=Math.max((Math.min(o.width,o.height)-g)/2,0),E=Math.min(The(this.options.cutout,i),1),P=this._getRingWeight(this.index),{circumference:I,rotation:D}=this._getRotationExtents(),{ratioX:F,ratioY:$,offsetX:Z,offsetY:q}=dfe(D,I,E),X=(o.width-g)/F,re=(o.height-g)/$,le=Math.max(Math.min(X,re)/2,0),ue=mV(this.options.radius,le),ye=Math.max(ue*E,0),ge=(ue-ye)/this._getVisibleDatasetWeightTotal();this.offsetX=Z*ue,this.offsetY=q*ue,u.total=this.calculateTotal(),this.outerRadius=ue-ge*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-ge*P,0),this.updateElements(d,0,d.length,t)}_circumference(t,n){const o=this.options,u=this._cachedMeta,d=this._getCircumference();return n&&o.animation.animateRotate||!this.chart.getDataVisibility(t)||u._parsed[t]===null||u.data[t].hidden?0:this.calculateCircumference(u._parsed[t]*d/Ts)}updateElements(t,n,o,u){const d=u==="reset",g=this.chart,i=g.chartArea,P=g.options.animation,I=(i.left+i.right)/2,D=(i.top+i.bottom)/2,F=d&&P.animateScale,$=F?0:this.innerRadius,Z=F?0:this.outerRadius,{sharedOptions:q,includeOptions:X}=this._getSharedOptions(n,u);let re=this._getRotation(),le;for(le=0;le<n;++le)re+=this._circumference(le,d);for(le=n;le<n+o;++le){const ue=this._circumference(le,d),ye=t[le],ge={x:I+this.offsetX,y:D+this.offsetY,startAngle:re,endAngle:re+ue,circumference:ue,outerRadius:Z,innerRadius:$};X&&(ge.options=q||this.resolveDataElementOptions(le,ye.active?"active":u)),re+=ue,this.updateElement(ye,le,ge,u)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let o=0,u;for(u=0;u<n.length;u++){const d=t._parsed[u];d!==null&&!isNaN(d)&&this.chart.getDataVisibility(u)&&!n[u].hidden&&(o+=Math.abs(d))}return o}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?Ts*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,o=this.chart,u=o.data.labels||[],d=u0(n._parsed[t],o.options.locale);return{label:u[t]||"",value:d}}getMaxBorderWidth(t){let n=0;const o=this.chart;let u,d,g,i,E;if(!t){for(u=0,d=o.data.datasets.length;u<d;++u)if(o.isDatasetVisible(u)){g=o.getDatasetMeta(u),t=g.data,i=g.controller;break}}if(!t)return 0;for(u=0,d=t.length;u<d;++u)E=i.resolveDataElementOptions(u),E.borderAlign!=="inner"&&(n=Math.max(n,E.borderWidth||0,E.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let o=0,u=t.length;o<u;++o){const d=this.resolveDataElementOptions(o);n=Math.max(n,d.offset||0,d.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let o=0;o<t;++o)this.chart.isDatasetVisible(o)&&(n+=this._getRingWeight(o));return n}_getRingWeight(t){return Math.max(Kr(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}zn(Ng,"id","doughnut"),zn(Ng,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),zn(Ng,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),zn(Ng,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:o,color:u}}=t.legend.options;return n.labels.map((d,g)=>{const E=t.getDatasetMeta(0).controller.getStyle(g);return{text:d,fillStyle:E.backgroundColor,strokeStyle:E.borderColor,fontColor:u,lineWidth:E.borderWidth,pointStyle:o,hidden:!t.getDataVisibility(g),index:g}})}return[]}},onClick(t,n,o){o.chart.toggleDataVisibility(n.index),o.chart.update()}}}});class lx extends Oh{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const n=this._cachedMeta,{dataset:o,data:u=[],_dataset:d}=n,g=this.chart._animationsDisabled;let{start:i,count:E}=SV(n,u,g);this._drawStart=i,this._drawCount=E,TV(n)&&(i=0,E=u.length),o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!d._decimated,o.points=u;const P=this.resolveDatasetElementOptions(t);this.options.showLine||(P.borderWidth=0),P.segment=this.options.segment,this.updateElement(o,void 0,{animated:!g,options:P},t),this.updateElements(u,i,E,t)}updateElements(t,n,o,u){const d=u==="reset",{iScale:g,vScale:i,_stacked:E,_dataset:P}=this._cachedMeta,{sharedOptions:I,includeOptions:D}=this._getSharedOptions(n,u),F=g.axis,$=i.axis,{spanGaps:Z,segment:q}=this.options,X=by(Z)?Z:Number.POSITIVE_INFINITY,re=this.chart._animationsDisabled||d||u==="none",le=n+o,ue=t.length;let ye=n>0&&this.getParsed(n-1);for(let ge=0;ge<ue;++ge){const we=t[ge],Le=re?we:{};if(ge<n||ge>=le){Le.skip=!0;continue}const Ze=this.getParsed(ge),Ge=Ei(Ze[$]),gt=Le[F]=g.getPixelForValue(Ze[F],ge),lt=Le[$]=d||Ge?i.getBasePixel():i.getPixelForValue(E?this.applyStack(i,Ze,E):Ze[$],ge);Le.skip=isNaN(gt)||isNaN(lt)||Ge,Le.stop=ge>0&&Math.abs(Ze[F]-ye[F])>X,q&&(Le.parsed=Ze,Le.raw=P.data[ge]),D&&(Le.options=I||this.resolveDataElementOptions(ge,we.active?"active":u)),re||this.updateElement(we,ge,Le,u),ye=Ze}}getMaxOverflow(){const t=this._cachedMeta,n=t.dataset,o=n.options&&n.options.borderWidth||0,u=t.data||[];if(!u.length)return o;const d=u[0].size(this.resolveDataElementOptions(0)),g=u[u.length-1].size(this.resolveDataElementOptions(u.length-1));return Math.max(o,d,g)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}zn(lx,"id","line"),zn(lx,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),zn(lx,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class cx extends Oh{constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const n=this._cachedMeta,o=this.chart,u=o.data.labels||[],d=u0(n._parsed[t].r,o.options.locale);return{label:u[t]||"",value:d}}parseObjectData(t,n,o,u){return RV.bind(this)(t,n,o,u)}update(t){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){const t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((o,u)=>{const d=this.getParsed(u).r;!isNaN(d)&&this.chart.getDataVisibility(u)&&(d<n.min&&(n.min=d),d>n.max&&(n.max=d))}),n}_updateRadius(){const t=this.chart,n=t.chartArea,o=t.options,u=Math.min(n.right-n.left,n.bottom-n.top),d=Math.max(u/2,0),g=Math.max(o.cutoutPercentage?d/100*o.cutoutPercentage:1,0),i=(d-g)/t.getVisibleDatasetCount();this.outerRadius=d-i*this.index,this.innerRadius=this.outerRadius-i}updateElements(t,n,o,u){const d=u==="reset",g=this.chart,E=g.options.animation,P=this._cachedMeta.rScale,I=P.xCenter,D=P.yCenter,F=P.getIndexAngle(0)-.5*Vi;let $=F,Z;const q=360/this.countVisibleElements();for(Z=0;Z<n;++Z)$+=this._computeAngle(Z,u,q);for(Z=n;Z<n+o;Z++){const X=t[Z];let re=$,le=$+this._computeAngle(Z,u,q),ue=g.getDataVisibility(Z)?P.getDistanceFromCenterForValue(this.getParsed(Z).r):0;$=le,d&&(E.animateScale&&(ue=0),E.animateRotate&&(re=le=F));const ye={x:I,y:D,innerRadius:0,outerRadius:ue,startAngle:re,endAngle:le,options:this.resolveDataElementOptions(Z,X.active?"active":u)};this.updateElement(X,Z,ye,u)}}countVisibleElements(){const t=this._cachedMeta;let n=0;return t.data.forEach((o,u)=>{!isNaN(this.getParsed(u).r)&&this.chart.getDataVisibility(u)&&n++}),n}_computeAngle(t,n,o){return this.chart.getDataVisibility(t)?kh(this.resolveDataElementOptions(t,n).angle||o):0}}zn(cx,"id","polarArea"),zn(cx,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),zn(cx,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:o,color:u}}=t.legend.options;return n.labels.map((d,g)=>{const E=t.getDatasetMeta(0).controller.getStyle(g);return{text:d,fillStyle:E.backgroundColor,strokeStyle:E.borderColor,fontColor:u,lineWidth:E.borderWidth,pointStyle:o,hidden:!t.getDataVisibility(g),index:g}})}return[]}},onClick(t,n,o){o.chart.toggleDataVisibility(n.index),o.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class VA extends Ng{}zn(VA,"id","pie"),zn(VA,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Kb extends Oh{getLabelAndValue(t){const n=this._cachedMeta.vScale,o=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(o[n.axis])}}parseObjectData(t,n,o,u){return RV.bind(this)(t,n,o,u)}update(t){const n=this._cachedMeta,o=n.dataset,u=n.data||[],d=n.iScale.getLabels();if(o.points=u,t!=="resize"){const g=this.resolveDatasetElementOptions(t);this.options.showLine||(g.borderWidth=0);const i={_loop:!0,_fullLoop:d.length===u.length,options:g};this.updateElement(o,void 0,i,t)}this.updateElements(u,0,u.length,t)}updateElements(t,n,o,u){const d=this._cachedMeta.rScale,g=u==="reset";for(let i=n;i<n+o;i++){const E=t[i],P=this.resolveDataElementOptions(i,E.active?"active":u),I=d.getPointPositionForValue(i,this.getParsed(i).r),D=g?d.xCenter:I.x,F=g?d.yCenter:I.y,$={x:D,y:F,angle:I.angle,skip:isNaN(D)||isNaN(F),options:P};this.updateElement(E,i,$,u)}}}zn(Kb,"id","radar"),zn(Kb,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),zn(Kb,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Jb extends Oh{getLabelAndValue(t){const n=this._cachedMeta,o=this.chart.data.labels||[],{xScale:u,yScale:d}=n,g=this.getParsed(t),i=u.getLabelForValue(g.x),E=d.getLabelForValue(g.y);return{label:o[t]||"",value:"("+i+", "+E+")"}}update(t){const n=this._cachedMeta,{data:o=[]}=n,u=this.chart._animationsDisabled;let{start:d,count:g}=SV(n,o,u);if(this._drawStart=d,this._drawCount=g,TV(n)&&(d=0,g=o.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:i,_dataset:E}=n;i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!E._decimated,i.points=o;const P=this.resolveDatasetElementOptions(t);P.segment=this.options.segment,this.updateElement(i,void 0,{animated:!u,options:P},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(o,d,g,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,o,u){const d=u==="reset",{iScale:g,vScale:i,_stacked:E,_dataset:P}=this._cachedMeta,I=this.resolveDataElementOptions(n,u),D=this.getSharedOptions(I),F=this.includeOptions(u,D),$=g.axis,Z=i.axis,{spanGaps:q,segment:X}=this.options,re=by(q)?q:Number.POSITIVE_INFINITY,le=this.chart._animationsDisabled||d||u==="none";let ue=n>0&&this.getParsed(n-1);for(let ye=n;ye<n+o;++ye){const ge=t[ye],we=this.getParsed(ye),Le=le?ge:{},Ze=Ei(we[Z]),Ge=Le[$]=g.getPixelForValue(we[$],ye),gt=Le[Z]=d||Ze?i.getBasePixel():i.getPixelForValue(E?this.applyStack(i,we,E):we[Z],ye);Le.skip=isNaN(Ge)||isNaN(gt)||Ze,Le.stop=ye>0&&Math.abs(we[$]-ue[$])>re,X&&(Le.parsed=we,Le.raw=P.data[ye]),F&&(Le.options=D||this.resolveDataElementOptions(ye,ge.active?"active":u)),le||this.updateElement(ge,ye,Le,u),ue=we}this.updateSharedOptions(D,u,I)}getMaxOverflow(){const t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let i=0;for(let E=n.length-1;E>=0;--E)i=Math.max(i,n[E].size(this.resolveDataElementOptions(E))/2);return i>0&&i}const o=t.dataset,u=o.options&&o.options.borderWidth||0;if(!n.length)return u;const d=n[0].size(this.resolveDataElementOptions(0)),g=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(u,d,g)/2}}zn(Jb,"id","scatter"),zn(Jb,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),zn(Jb,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var ffe=Object.freeze({__proto__:null,BarController:ax,BubbleController:Yb,DoughnutController:Ng,LineController:lx,PieController:VA,PolarAreaController:cx,RadarController:Kb,ScatterController:Jb});function Ag(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class dI{constructor(t){zn(this,"options");this.options=t||{}}static override(t){Object.assign(dI.prototype,t)}init(){}formats(){return Ag()}parse(){return Ag()}format(){return Ag()}add(){return Ag()}diff(){return Ag()}startOf(){return Ag()}endOf(){return Ag()}}var pfe={_date:dI};function mfe(e,t,n,o){const{controller:u,data:d,_sorted:g}=e,i=u._cachedMeta.iScale,E=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(i&&t===i.axis&&t!=="r"&&g&&d.length){const P=i._reversePixels?zhe:op;if(o){if(u._sharedOptions){const I=d[0],D=typeof I.getRange=="function"&&I.getRange(t);if(D){const F=P(d,t,n-D),$=P(d,t,n+D);return{lo:F.lo,hi:$.hi}}}}else{const I=P(d,t,n);if(E){const{vScale:D}=u._cachedMeta,{_parsed:F}=e,$=F.slice(0,I.lo+1).reverse().findIndex(q=>!Ei(q[D.axis]));I.lo-=Math.max(0,$);const Z=F.slice(I.hi).findIndex(q=>!Ei(q[D.axis]));I.hi+=Math.max(0,Z)}return I}}return{lo:0,hi:d.length-1}}function lS(e,t,n,o,u){const d=e.getSortedVisibleDatasetMetas(),g=n[t];for(let i=0,E=d.length;i<E;++i){const{index:P,data:I}=d[i],{lo:D,hi:F}=mfe(d[i],t,g,u);for(let $=D;$<=F;++$){const Z=I[$];Z.skip||o(Z,P,$)}}}function gfe(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(o,u){const d=t?Math.abs(o.x-u.x):0,g=n?Math.abs(o.y-u.y):0;return Math.sqrt(Math.pow(d,2)+Math.pow(g,2))}}function CE(e,t,n,o,u){const d=[];return!u&&!e.isPointInArea(t)||lS(e,n,t,function(i,E,P){!u&&!ap(i,e.chartArea,0)||i.inRange(t.x,t.y,o)&&d.push({element:i,datasetIndex:E,index:P})},!0),d}function _fe(e,t,n,o){let u=[];function d(g,i,E){const{startAngle:P,endAngle:I}=g.getProps(["startAngle","endAngle"],o),{angle:D}=yV(g,{x:t.x,y:t.y});kx(D,P,I)&&u.push({element:g,datasetIndex:i,index:E})}return lS(e,n,t,d),u}function yfe(e,t,n,o,u,d){let g=[];const i=gfe(n);let E=Number.POSITIVE_INFINITY;function P(I,D,F){const $=I.inRange(t.x,t.y,u);if(o&&!$)return;const Z=I.getCenterPoint(u);if(!(!!d||e.isPointInArea(Z))&&!$)return;const X=i(t,Z);X<E?(g=[{element:I,datasetIndex:D,index:F}],E=X):X===E&&g.push({element:I,datasetIndex:D,index:F})}return lS(e,n,t,P),g}function PE(e,t,n,o,u,d){return!d&&!e.isPointInArea(t)?[]:n==="r"&&!o?_fe(e,t,n,u):yfe(e,t,n,o,u,d)}function XN(e,t,n,o,u){const d=[],g=n==="x"?"inXRange":"inYRange";let i=!1;return lS(e,n,t,(E,P,I)=>{E[g]&&E[g](t[n],u)&&(d.push({element:E,datasetIndex:P,index:I}),i=i||E.inRange(t.x,t.y,u))}),o&&!i?[]:d}var vfe={modes:{index(e,t,n,o){const u=Rg(t,e),d=n.axis||"x",g=n.includeInvisible||!1,i=n.intersect?CE(e,u,d,o,g):PE(e,u,d,!1,o,g),E=[];return i.length?(e.getSortedVisibleDatasetMetas().forEach(P=>{const I=i[0].index,D=P.data[I];D&&!D.skip&&E.push({element:D,datasetIndex:P.index,index:I})}),E):[]},dataset(e,t,n,o){const u=Rg(t,e),d=n.axis||"xy",g=n.includeInvisible||!1;let i=n.intersect?CE(e,u,d,o,g):PE(e,u,d,!1,o,g);if(i.length>0){const E=i[0].datasetIndex,P=e.getDatasetMeta(E).data;i=[];for(let I=0;I<P.length;++I)i.push({element:P[I],datasetIndex:E,index:I})}return i},point(e,t,n,o){const u=Rg(t,e),d=n.axis||"xy",g=n.includeInvisible||!1;return CE(e,u,d,o,g)},nearest(e,t,n,o){const u=Rg(t,e),d=n.axis||"xy",g=n.includeInvisible||!1;return PE(e,u,d,n.intersect,o,g)},x(e,t,n,o){const u=Rg(t,e);return XN(e,u,"x",n.intersect,o)},y(e,t,n,o){const u=Rg(t,e);return XN(e,u,"y",n.intersect,o)}}};const $V=["left","top","right","bottom"];function $v(e,t){return e.filter(n=>n.pos===t)}function YN(e,t){return e.filter(n=>$V.indexOf(n.pos)===-1&&n.box.axis===t)}function Hv(e,t){return e.sort((n,o)=>{const u=t?o:n,d=t?n:o;return u.weight===d.weight?u.index-d.index:u.weight-d.weight})}function xfe(e){const t=[];let n,o,u,d,g,i;for(n=0,o=(e||[]).length;n<o;++n)u=e[n],{position:d,options:{stack:g,stackWeight:i=1}}=u,t.push({index:n,box:u,pos:d,horizontal:u.isHorizontal(),weight:u.weight,stack:g&&d+g,stackWeight:i});return t}function bfe(e){const t={};for(const n of e){const{stack:o,pos:u,stackWeight:d}=n;if(!o||!$V.includes(u))continue;const g=t[o]||(t[o]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=d}return t}function wfe(e,t){const n=bfe(e),{vBoxMaxWidth:o,hBoxMaxHeight:u}=t;let d,g,i;for(d=0,g=e.length;d<g;++d){i=e[d];const{fullSize:E}=i.box,P=n[i.stack],I=P&&i.stackWeight/P.weight;i.horizontal?(i.width=I?I*o:E&&t.availableWidth,i.height=u):(i.width=o,i.height=I?I*u:E&&t.availableHeight)}return n}function Sfe(e){const t=xfe(e),n=Hv(t.filter(P=>P.box.fullSize),!0),o=Hv($v(t,"left"),!0),u=Hv($v(t,"right")),d=Hv($v(t,"top"),!0),g=Hv($v(t,"bottom")),i=YN(t,"x"),E=YN(t,"y");return{fullSize:n,leftAndTop:o.concat(d),rightAndBottom:u.concat(E).concat(g).concat(i),chartArea:$v(t,"chartArea"),vertical:o.concat(u).concat(E),horizontal:d.concat(g).concat(i)}}function KN(e,t,n,o){return Math.max(e[n],t[n])+Math.max(e[o],t[o])}function HV(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Tfe(e,t,n,o){const{pos:u,box:d}=n,g=e.maxPadding;if(!Pi(u)){n.size&&(e[u]-=n.size);const D=o[n.stack]||{size:0,count:1};D.size=Math.max(D.size,n.horizontal?d.height:d.width),n.size=D.size/D.count,e[u]+=n.size}d.getPadding&&HV(g,d.getPadding());const i=Math.max(0,t.outerWidth-KN(g,e,"left","right")),E=Math.max(0,t.outerHeight-KN(g,e,"top","bottom")),P=i!==e.w,I=E!==e.h;return e.w=i,e.h=E,n.horizontal?{same:P,other:I}:{same:I,other:P}}function Efe(e){const t=e.maxPadding;function n(o){const u=Math.max(t[o]-e[o],0);return e[o]+=u,u}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function Afe(e,t){const n=t.maxPadding;function o(u){const d={left:0,top:0,right:0,bottom:0};return u.forEach(g=>{d[g]=Math.max(t[g],n[g])}),d}return o(e?["left","right"]:["top","bottom"])}function Jv(e,t,n,o){const u=[];let d,g,i,E,P,I;for(d=0,g=e.length,P=0;d<g;++d){i=e[d],E=i.box,E.update(i.width||t.w,i.height||t.h,Afe(i.horizontal,t));const{same:D,other:F}=Tfe(t,n,i,o);P|=D&&u.length,I=I||F,E.fullSize||u.push(i)}return P&&Jv(u,t,n,o)||I}function Pb(e,t,n,o,u){e.top=n,e.left=t,e.right=t+o,e.bottom=n+u,e.width=o,e.height=u}function JN(e,t,n,o){const u=n.padding;let{x:d,y:g}=t;for(const i of e){const E=i.box,P=o[i.stack]||{placed:0,weight:1},I=i.stackWeight/P.weight||1;if(i.horizontal){const D=t.w*I,F=P.size||E.height;Mx(P.start)&&(g=P.start),E.fullSize?Pb(E,u.left,g,n.outerWidth-u.right-u.left,F):Pb(E,t.left+P.placed,g,D,F),P.start=g,P.placed+=D,g=E.bottom}else{const D=t.h*I,F=P.size||E.width;Mx(P.start)&&(d=P.start),E.fullSize?Pb(E,d,u.top,F,n.outerHeight-u.bottom-u.top):Pb(E,d,t.top+P.placed,F,D),P.start=d,P.placed+=D,d=E.right}}t.x=d,t.y=g}var ul={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,o){if(!e)return;const u=dl(e.options.layout.padding),d=Math.max(t-u.width,0),g=Math.max(n-u.height,0),i=Sfe(e.boxes),E=i.vertical,P=i.horizontal;Qi(e.boxes,q=>{typeof q.beforeLayout=="function"&&q.beforeLayout()});const I=E.reduce((q,X)=>X.box.options&&X.box.options.display===!1?q:q+1,0)||1,D=Object.freeze({outerWidth:t,outerHeight:n,padding:u,availableWidth:d,availableHeight:g,vBoxMaxWidth:d/2/I,hBoxMaxHeight:g/2}),F=Object.assign({},u);HV(F,dl(o));const $=Object.assign({maxPadding:F,w:d,h:g,x:u.left,y:u.top},u),Z=wfe(E.concat(P),D);Jv(i.fullSize,$,D,Z),Jv(E,$,D,Z),Jv(P,$,D,Z)&&Jv(E,$,D,Z),Efe($),JN(i.leftAndTop,$,D,Z),$.x+=$.w,$.y+=$.h,JN(i.rightAndBottom,$,D,Z),e.chartArea={left:$.left,top:$.top,right:$.left+$.w,bottom:$.top+$.h,height:$.h,width:$.w},Qi(i.chartArea,q=>{const X=q.box;Object.assign(X,e.chartArea),X.update($.w,$.h,{left:0,top:0,right:0,bottom:0})})}};class GV{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,o){}removeEventListener(t,n,o){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,o,u){return n=Math.max(0,n||t.width),o=o||t.height,{width:n,height:Math.max(0,u?Math.floor(n/u):o)}}isAttached(t){return!0}updateConfig(t){}}class Cfe extends GV{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Qb="$chartjs",Pfe={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},QN=e=>e===null||e==="";function Ife(e,t){const n=e.style,o=e.getAttribute("height"),u=e.getAttribute("width");if(e[Qb]={initial:{height:o,width:u,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",QN(u)){const d=jN(e,"width");d!==void 0&&(e.width=d)}if(QN(o))if(e.style.height==="")e.height=e.width/(t||2);else{const d=jN(e,"height");d!==void 0&&(e.height=d)}return e}const WV=Mde?{passive:!0}:!1;function Mfe(e,t,n){e&&e.addEventListener(t,n,WV)}function kfe(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,WV)}function Rfe(e,t){const n=Pfe[e.type]||e.type,{x:o,y:u}=Rg(e,t);return{type:n,chart:t,native:e,x:o!==void 0?o:null,y:u!==void 0?u:null}}function nw(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function Ofe(e,t,n){const o=e.canvas,u=new MutationObserver(d=>{let g=!1;for(const i of d)g=g||nw(i.addedNodes,o),g=g&&!nw(i.removedNodes,o);g&&n()});return u.observe(document,{childList:!0,subtree:!0}),u}function Dfe(e,t,n){const o=e.canvas,u=new MutationObserver(d=>{let g=!1;for(const i of d)g=g||nw(i.removedNodes,o),g=g&&!nw(i.addedNodes,o);g&&n()});return u.observe(document,{childList:!0,subtree:!0}),u}const Ox=new Map;let e3=0;function qV(){const e=window.devicePixelRatio;e!==e3&&(e3=e,Ox.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function Lfe(e,t){Ox.size||window.addEventListener("resize",qV),Ox.set(e,t)}function jfe(e){Ox.delete(e),Ox.size||window.removeEventListener("resize",qV)}function zfe(e,t,n){const o=e.canvas,u=o&&hI(o);if(!u)return;const d=wV((i,E)=>{const P=u.clientWidth;n(i,E),P<u.clientWidth&&n()},window),g=new ResizeObserver(i=>{const E=i[0],P=E.contentRect.width,I=E.contentRect.height;P===0&&I===0||d(P,I)});return g.observe(u),Lfe(e,d),g}function IE(e,t,n){n&&n.disconnect(),t==="resize"&&jfe(e)}function Nfe(e,t,n){const o=e.canvas,u=wV(d=>{e.ctx!==null&&n(Rfe(d,e))},e);return Mfe(o,t,u),u}class Ffe extends GV{acquireContext(t,n){const o=t&&t.getContext&&t.getContext("2d");return o&&o.canvas===t?(Ife(t,n),o):null}releaseContext(t){const n=t.canvas;if(!n[Qb])return!1;const o=n[Qb].initial;["height","width"].forEach(d=>{const g=o[d];Ei(g)?n.removeAttribute(d):n.setAttribute(d,g)});const u=o.style||{};return Object.keys(u).forEach(d=>{n.style[d]=u[d]}),n.width=n.width,delete n[Qb],!0}addEventListener(t,n,o){this.removeEventListener(t,n);const u=t.$proxies||(t.$proxies={}),g={attach:Ofe,detach:Dfe,resize:zfe}[n]||Nfe;u[n]=g(t,n,o)}removeEventListener(t,n){const o=t.$proxies||(t.$proxies={}),u=o[n];if(!u)return;({attach:IE,detach:IE,resize:IE}[n]||kfe)(t,n,u),o[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,o,u){return Ide(t,n,o,u)}isAttached(t){const n=t&&hI(t);return!!(n&&n.isConnected)}}function Bfe(e){return!uI()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?Cfe:Ffe}class jh{constructor(){zn(this,"x");zn(this,"y");zn(this,"active",!1);zn(this,"options");zn(this,"$animations")}tooltipPosition(t){const{x:n,y:o}=this.getProps(["x","y"],t);return{x:n,y:o}}hasValue(){return by(this.x)&&by(this.y)}getProps(t,n){const o=this.$animations;if(!n||!o)return this;const u={};return t.forEach(d=>{u[d]=o[d]&&o[d].active()?o[d]._to:this[d]}),u}}zn(jh,"defaults",{}),zn(jh,"defaultRoutes");function Ufe(e,t){const n=e.options.ticks,o=Vfe(e),u=Math.min(n.maxTicksLimit||o,o),d=n.major.enabled?Hfe(t):[],g=d.length,i=d[0],E=d[g-1],P=[];if(g>u)return Gfe(t,P,d,g/u),P;const I=$fe(d,t,u);if(g>0){let D,F;const $=g>1?Math.round((E-i)/(g-1)):null;for(Ib(t,P,I,Ei($)?0:i-$,i),D=0,F=g-1;D<F;D++)Ib(t,P,I,d[D],d[D+1]);return Ib(t,P,I,E,Ei($)?t.length:E+$),P}return Ib(t,P,I),P}function Vfe(e){const t=e.options.offset,n=e._tickSize(),o=e._length/n+(t?0:1),u=e._maxLength/n;return Math.floor(Math.min(o,u))}function $fe(e,t,n){const o=Wfe(e),u=t.length/n;if(!o)return Math.max(u,1);const d=Rhe(o);for(let g=0,i=d.length-1;g<i;g++){const E=d[g];if(E>u)return E}return Math.max(u,1)}function Hfe(e){const t=[];let n,o;for(n=0,o=e.length;n<o;n++)e[n].major&&t.push(n);return t}function Gfe(e,t,n,o){let u=0,d=n[0],g;for(o=Math.ceil(o),g=0;g<e.length;g++)g===d&&(t.push(e[g]),u++,d=n[u*o])}function Ib(e,t,n,o,u){const d=Kr(o,0),g=Math.min(Kr(u,e.length),e.length);let i=0,E,P,I;for(n=Math.ceil(n),u&&(E=u-o,n=E/Math.floor(E/n)),I=d;I<0;)i++,I=Math.round(d+i*n);for(P=Math.max(d,0);P<g;P++)P===I&&(t.push(e[P]),i++,I=Math.round(d+i*n))}function Wfe(e){const t=e.length;let n,o;if(t<2)return!1;for(o=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==o)return!1;return o}const qfe=e=>e==="left"?"right":e==="right"?"left":e,t3=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,n3=(e,t)=>Math.min(t||e,e);function r3(e,t){const n=[],o=e.length/t,u=e.length;let d=0;for(;d<u;d+=o)n.push(e[Math.floor(d)]);return n}function Zfe(e,t,n){const o=e.ticks.length,u=Math.min(t,o-1),d=e._startPixel,g=e._endPixel,i=1e-6;let E=e.getPixelForTick(u),P;if(!(n&&(o===1?P=Math.max(E-d,g-E):t===0?P=(e.getPixelForTick(1)-E)/2:P=(E-e.getPixelForTick(u-1))/2,E+=u<t?P:-P,E<d-i||E>g+i)))return E}function Xfe(e,t){Qi(e,n=>{const o=n.gc,u=o.length/2;let d;if(u>t){for(d=0;d<u;++d)delete n.data[o[d]];o.splice(0,u)}})}function Gv(e){return e.drawTicks?e.tickLength:0}function i3(e,t){if(!e.display)return 0;const n=Wo(e.font,t),o=dl(e.padding);return(ks(e.text)?e.text.length:1)*n.lineHeight+o.height}function Yfe(e,t){return Bm(e,{scale:t,type:"scale"})}function Kfe(e,t,n){return Bm(e,{tick:n,index:t,type:"tick"})}function Jfe(e,t,n){let o=iI(e);return(n&&t!=="right"||!n&&t==="right")&&(o=qfe(o)),o}function Qfe(e,t,n,o){const{top:u,left:d,bottom:g,right:i,chart:E}=e,{chartArea:P,scales:I}=E;let D=0,F,$,Z;const q=g-u,X=i-d;if(e.isHorizontal()){if($=al(o,d,i),Pi(n)){const re=Object.keys(n)[0],le=n[re];Z=I[re].getPixelForValue(le)+q-t}else n==="center"?Z=(P.bottom+P.top)/2+q-t:Z=t3(e,n,t);F=i-d}else{if(Pi(n)){const re=Object.keys(n)[0],le=n[re];$=I[re].getPixelForValue(le)-X+t}else n==="center"?$=(P.left+P.right)/2-X+t:$=t3(e,n,t);Z=al(o,g,u),D=n==="left"?-mo:mo}return{titleX:$,titleY:Z,maxWidth:F,rotation:D}}class h_ extends jh{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:o,_suggestedMax:u}=this;return t=kc(t,Number.POSITIVE_INFINITY),n=kc(n,Number.NEGATIVE_INFINITY),o=kc(o,Number.POSITIVE_INFINITY),u=kc(u,Number.NEGATIVE_INFINITY),{min:kc(t,o),max:kc(n,u),minDefined:to(t),maxDefined:to(n)}}getMinMax(t){let{min:n,max:o,minDefined:u,maxDefined:d}=this.getUserBounds(),g;if(u&&d)return{min:n,max:o};const i=this.getMatchingVisibleMetas();for(let E=0,P=i.length;E<P;++E)g=i[E].controller.getMinMax(this,t),u||(n=Math.min(n,g.min)),d||(o=Math.max(o,g.max));return n=d&&n>o?o:n,o=u&&n>o?n:o,{min:kc(n,kc(o,n)),max:kc(o,kc(n,o))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){xs(this.options.beforeUpdate,[this])}update(t,n,o){const{beginAtZero:u,grace:d,ticks:g}=this.options,i=g.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=o=Object.assign({left:0,right:0,top:0,bottom:0},o),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+o.left+o.right:this.height+o.top+o.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=ade(this,d,u),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const E=i<this.ticks.length;this._convertTicksToLabels(E?r3(this.ticks,i):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=Ufe(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),E&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,o;this.isHorizontal()?(n=this.left,o=this.right):(n=this.top,o=this.bottom,t=!t),this._startPixel=n,this._endPixel=o,this._reversePixels=t,this._length=o-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){xs(this.options.afterUpdate,[this])}beforeSetDimensions(){xs(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){xs(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),xs(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){xs(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let o,u,d;for(o=0,u=t.length;o<u;o++)d=t[o],d.label=xs(n.callback,[d.value,o,t],this)}afterTickToLabelConversion(){xs(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){xs(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,o=n3(this.ticks.length,t.ticks.maxTicksLimit),u=n.minRotation||0,d=n.maxRotation;let g=u,i,E,P;if(!this._isVisible()||!n.display||u>=d||o<=1||!this.isHorizontal()){this.labelRotation=u;return}const I=this._getLabelSizes(),D=I.widest.width,F=I.highest.height,$=la(this.chart.width-D,0,this.maxWidth);i=t.offset?this.maxWidth/o:$/(o-1),D+6>i&&(i=$/(o-(t.offset?.5:1)),E=this.maxHeight-Gv(t.grid)-n.padding-i3(t.title,this.chart.options.font),P=Math.sqrt(D*D+F*F),g=nI(Math.min(Math.asin(la((I.highest.height+6)/i,-1,1)),Math.asin(la(E/P,-1,1))-Math.asin(la(F/P,-1,1)))),g=Math.max(u,Math.min(d,g))),this.labelRotation=g}afterCalculateLabelRotation(){xs(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){xs(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:o,title:u,grid:d}}=this,g=this._isVisible(),i=this.isHorizontal();if(g){const E=i3(u,n.options.font);if(i?(t.width=this.maxWidth,t.height=Gv(d)+E):(t.height=this.maxHeight,t.width=Gv(d)+E),o.display&&this.ticks.length){const{first:P,last:I,widest:D,highest:F}=this._getLabelSizes(),$=o.padding*2,Z=kh(this.labelRotation),q=Math.cos(Z),X=Math.sin(Z);if(i){const re=o.mirror?0:X*D.width+q*F.height;t.height=Math.min(this.maxHeight,t.height+re+$)}else{const re=o.mirror?0:q*D.width+X*F.height;t.width=Math.min(this.maxWidth,t.width+re+$)}this._calculatePadding(P,I,X,q)}}this._handleMargins(),i?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,o,u){const{ticks:{align:d,padding:g},position:i}=this.options,E=this.labelRotation!==0,P=i!=="top"&&this.axis==="x";if(this.isHorizontal()){const I=this.getPixelForTick(0)-this.left,D=this.right-this.getPixelForTick(this.ticks.length-1);let F=0,$=0;E?P?(F=u*t.width,$=o*n.height):(F=o*t.height,$=u*n.width):d==="start"?$=n.width:d==="end"?F=t.width:d!=="inner"&&(F=t.width/2,$=n.width/2),this.paddingLeft=Math.max((F-I+g)*this.width/(this.width-I),0),this.paddingRight=Math.max(($-D+g)*this.width/(this.width-D),0)}else{let I=n.height/2,D=t.height/2;d==="start"?(I=0,D=t.height):d==="end"&&(I=n.height,D=0),this.paddingTop=I+g,this.paddingBottom=D+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){xs(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,o;for(n=0,o=t.length;n<o;n++)Ei(t[n].label)&&(t.splice(n,1),o--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let o=this.ticks;n<o.length&&(o=r3(o,n)),this._labelSizes=t=this._computeLabelSizes(o,o.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,o){const{ctx:u,_longestTextCache:d}=this,g=[],i=[],E=Math.floor(n/n3(n,o));let P=0,I=0,D,F,$,Z,q,X,re,le,ue,ye,ge;for(D=0;D<n;D+=E){if(Z=t[D].label,q=this._resolveTickFontOptions(D),u.font=X=q.string,re=d[X]=d[X]||{data:{},gc:[]},le=q.lineHeight,ue=ye=0,!Ei(Z)&&!ks(Z))ue=ew(u,re.data,re.gc,ue,Z),ye=le;else if(ks(Z))for(F=0,$=Z.length;F<$;++F)ge=Z[F],!Ei(ge)&&!ks(ge)&&(ue=ew(u,re.data,re.gc,ue,ge),ye+=le);g.push(ue),i.push(ye),P=Math.max(ue,P),I=Math.max(ye,I)}Xfe(d,n);const we=g.indexOf(P),Le=i.indexOf(I),Ze=Ge=>({width:g[Ge]||0,height:i[Ge]||0});return{first:Ze(0),last:Ze(n-1),widest:Ze(we),highest:Ze(Le),widths:g,heights:i}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return jhe(this._alignToPixels?Eg(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const o=n[t];return o.$context||(o.$context=Kfe(this.getContext(),t,o))}return this.$context||(this.$context=Yfe(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=kh(this.labelRotation),o=Math.abs(Math.cos(n)),u=Math.abs(Math.sin(n)),d=this._getLabelSizes(),g=t.autoSkipPadding||0,i=d?d.widest.width+g:0,E=d?d.highest.height+g:0;return this.isHorizontal()?E*o>i*u?i/o:E/u:E*u<i*o?E/o:i/u}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,o=this.chart,u=this.options,{grid:d,position:g,border:i}=u,E=d.offset,P=this.isHorizontal(),D=this.ticks.length+(E?1:0),F=Gv(d),$=[],Z=i.setContext(this.getContext()),q=Z.display?Z.width:0,X=q/2,re=function(St){return Eg(o,St,q)};let le,ue,ye,ge,we,Le,Ze,Ge,gt,lt,qe,en;if(g==="top")le=re(this.bottom),Le=this.bottom-F,Ge=le-X,lt=re(t.top)+X,en=t.bottom;else if(g==="bottom")le=re(this.top),lt=t.top,en=re(t.bottom)-X,Le=le+X,Ge=this.top+F;else if(g==="left")le=re(this.right),we=this.right-F,Ze=le-X,gt=re(t.left)+X,qe=t.right;else if(g==="right")le=re(this.left),gt=t.left,qe=re(t.right)-X,we=le+X,Ze=this.left+F;else if(n==="x"){if(g==="center")le=re((t.top+t.bottom)/2+.5);else if(Pi(g)){const St=Object.keys(g)[0],an=g[St];le=re(this.chart.scales[St].getPixelForValue(an))}lt=t.top,en=t.bottom,Le=le+X,Ge=Le+F}else if(n==="y"){if(g==="center")le=re((t.left+t.right)/2);else if(Pi(g)){const St=Object.keys(g)[0],an=g[St];le=re(this.chart.scales[St].getPixelForValue(an))}we=le-X,Ze=we-F,gt=t.left,qe=t.right}const Jt=Kr(u.ticks.maxTicksLimit,D),Nt=Math.max(1,Math.ceil(D/Jt));for(ue=0;ue<D;ue+=Nt){const St=this.getContext(ue),an=d.setContext(St),Kt=i.setContext(St),hn=an.lineWidth,Xt=an.color,et=Kt.dash||[],zt=Kt.dashOffset,Zn=an.tickWidth,$n=an.tickColor,fr=an.tickBorderDash||[],kn=an.tickBorderDashOffset;ye=Zfe(this,ue,E),ye!==void 0&&(ge=Eg(o,ye,hn),P?we=Ze=gt=qe=ge:Le=Ge=lt=en=ge,$.push({tx1:we,ty1:Le,tx2:Ze,ty2:Ge,x1:gt,y1:lt,x2:qe,y2:en,width:hn,color:Xt,borderDash:et,borderDashOffset:zt,tickWidth:Zn,tickColor:$n,tickBorderDash:fr,tickBorderDashOffset:kn}))}return this._ticksLength=D,this._borderValue=le,$}_computeLabelItems(t){const n=this.axis,o=this.options,{position:u,ticks:d}=o,g=this.isHorizontal(),i=this.ticks,{align:E,crossAlign:P,padding:I,mirror:D}=d,F=Gv(o.grid),$=F+I,Z=D?-I:$,q=-kh(this.labelRotation),X=[];let re,le,ue,ye,ge,we,Le,Ze,Ge,gt,lt,qe,en="middle";if(u==="top")we=this.bottom-Z,Le=this._getXAxisLabelAlignment();else if(u==="bottom")we=this.top+Z,Le=this._getXAxisLabelAlignment();else if(u==="left"){const Nt=this._getYAxisLabelAlignment(F);Le=Nt.textAlign,ge=Nt.x}else if(u==="right"){const Nt=this._getYAxisLabelAlignment(F);Le=Nt.textAlign,ge=Nt.x}else if(n==="x"){if(u==="center")we=(t.top+t.bottom)/2+$;else if(Pi(u)){const Nt=Object.keys(u)[0],St=u[Nt];we=this.chart.scales[Nt].getPixelForValue(St)+$}Le=this._getXAxisLabelAlignment()}else if(n==="y"){if(u==="center")ge=(t.left+t.right)/2-$;else if(Pi(u)){const Nt=Object.keys(u)[0],St=u[Nt];ge=this.chart.scales[Nt].getPixelForValue(St)}Le=this._getYAxisLabelAlignment(F).textAlign}n==="y"&&(E==="start"?en="top":E==="end"&&(en="bottom"));const Jt=this._getLabelSizes();for(re=0,le=i.length;re<le;++re){ue=i[re],ye=ue.label;const Nt=d.setContext(this.getContext(re));Ze=this.getPixelForTick(re)+d.labelOffset,Ge=this._resolveTickFontOptions(re),gt=Ge.lineHeight,lt=ks(ye)?ye.length:1;const St=lt/2,an=Nt.color,Kt=Nt.textStrokeColor,hn=Nt.textStrokeWidth;let Xt=Le;g?(ge=Ze,Le==="inner"&&(re===le-1?Xt=this.options.reverse?"left":"right":re===0?Xt=this.options.reverse?"right":"left":Xt="center"),u==="top"?P==="near"||q!==0?qe=-lt*gt+gt/2:P==="center"?qe=-Jt.highest.height/2-St*gt+gt:qe=-Jt.highest.height+gt/2:P==="near"||q!==0?qe=gt/2:P==="center"?qe=Jt.highest.height/2-St*gt:qe=Jt.highest.height-lt*gt,D&&(qe*=-1),q!==0&&!Nt.showLabelBackdrop&&(ge+=gt/2*Math.sin(q))):(we=Ze,qe=(1-lt)*gt/2);let et;if(Nt.showLabelBackdrop){const zt=dl(Nt.backdropPadding),Zn=Jt.heights[re],$n=Jt.widths[re];let fr=qe-zt.top,kn=0-zt.left;switch(en){case"middle":fr-=Zn/2;break;case"bottom":fr-=Zn;break}switch(Le){case"center":kn-=$n/2;break;case"right":kn-=$n;break;case"inner":re===le-1?kn-=$n:re>0&&(kn-=$n/2);break}et={left:kn,top:fr,width:$n+zt.width,height:Zn+zt.height,color:Nt.backdropColor}}X.push({label:ye,font:Ge,textOffset:qe,options:{rotation:q,color:an,strokeColor:Kt,strokeWidth:hn,textAlign:Xt,textBaseline:en,translation:[ge,we],backdrop:et}})}return X}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-kh(this.labelRotation))return t==="top"?"left":"right";let u="center";return n.align==="start"?u="left":n.align==="end"?u="right":n.align==="inner"&&(u="inner"),u}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:o,mirror:u,padding:d}}=this.options,g=this._getLabelSizes(),i=t+d,E=g.widest.width;let P,I;return n==="left"?u?(I=this.right+d,o==="near"?P="left":o==="center"?(P="center",I+=E/2):(P="right",I+=E)):(I=this.right-i,o==="near"?P="right":o==="center"?(P="center",I-=E/2):(P="left",I=this.left)):n==="right"?u?(I=this.left+d,o==="near"?P="right":o==="center"?(P="center",I-=E/2):(P="left",I-=E)):(I=this.left+i,o==="near"?P="left":o==="center"?(P="center",I+=E/2):(P="right",I=this.right)):P="right",{textAlign:P,x:I}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:o,top:u,width:d,height:g}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(o,u,d,g),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const u=this.ticks.findIndex(d=>d.value===t);return u>=0?n.setContext(this.getContext(u)).lineWidth:0}drawGrid(t){const n=this.options.grid,o=this.ctx,u=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let d,g;const i=(E,P,I)=>{!I.width||!I.color||(o.save(),o.lineWidth=I.width,o.strokeStyle=I.color,o.setLineDash(I.borderDash||[]),o.lineDashOffset=I.borderDashOffset,o.beginPath(),o.moveTo(E.x,E.y),o.lineTo(P.x,P.y),o.stroke(),o.restore())};if(n.display)for(d=0,g=u.length;d<g;++d){const E=u[d];n.drawOnChartArea&&i({x:E.x1,y:E.y1},{x:E.x2,y:E.y2},E),n.drawTicks&&i({x:E.tx1,y:E.ty1},{x:E.tx2,y:E.ty2},{color:E.tickColor,width:E.tickWidth,borderDash:E.tickBorderDash,borderDashOffset:E.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:o,grid:u}}=this,d=o.setContext(this.getContext()),g=o.display?d.width:0;if(!g)return;const i=u.setContext(this.getContext(0)).lineWidth,E=this._borderValue;let P,I,D,F;this.isHorizontal()?(P=Eg(t,this.left,g)-g/2,I=Eg(t,this.right,i)+i/2,D=F=E):(D=Eg(t,this.top,g)-g/2,F=Eg(t,this.bottom,i)+i/2,P=I=E),n.save(),n.lineWidth=d.width,n.strokeStyle=d.color,n.beginPath(),n.moveTo(P,D),n.lineTo(I,F),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const o=this.ctx,u=this._computeLabelArea();u&&sS(o,u);const d=this.getLabelItems(t);for(const g of d){const i=g.options,E=g.font,P=g.label,I=g.textOffset;i_(o,P,0,I,E,i)}u&&oS(o)}drawTitle(){const{ctx:t,options:{position:n,title:o,reverse:u}}=this;if(!o.display)return;const d=Wo(o.font),g=dl(o.padding),i=o.align;let E=d.lineHeight/2;n==="bottom"||n==="center"||Pi(n)?(E+=g.bottom,ks(o.text)&&(E+=d.lineHeight*(o.text.length-1))):E+=g.top;const{titleX:P,titleY:I,maxWidth:D,rotation:F}=Qfe(this,E,n,i);i_(t,o.text,0,0,d,{color:o.color,maxWidth:D,rotation:F,textAlign:Jfe(i,n,u),textBaseline:"middle",translation:[P,I]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,o=Kr(t.grid&&t.grid.z,-1),u=Kr(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==h_.prototype.draw?[{z:n,draw:d=>{this.draw(d)}}]:[{z:o,draw:d=>{this.drawBackground(),this.drawGrid(d),this.drawTitle()}},{z:u,draw:()=>{this.drawBorder()}},{z:n,draw:d=>{this.drawLabels(d)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),o=this.axis+"AxisID",u=[];let d,g;for(d=0,g=n.length;d<g;++d){const i=n[d];i[o]===this.id&&(!t||i.type===t)&&u.push(i)}return u}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return Wo(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Mb{constructor(t,n,o){this.type=t,this.scope=n,this.override=o,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let o;npe(n)&&(o=this.register(n));const u=this.items,d=t.id,g=this.scope+"."+d;if(!d)throw new Error("class does not have id: "+t);return d in u||(u[d]=t,epe(t,g,o),this.override&&Os.override(t.id,t.overrides)),g}get(t){return this.items[t]}unregister(t){const n=this.items,o=t.id,u=this.scope;o in n&&delete n[o],u&&o in Os[u]&&(delete Os[u][o],this.override&&delete r_[o])}}function epe(e,t,n){const o=Ix(Object.create(null),[n?Os.get(n):{},Os.get(t),e.defaults]);Os.set(t,o),e.defaultRoutes&&tpe(t,e.defaultRoutes),e.descriptors&&Os.describe(t,e.descriptors)}function tpe(e,t){Object.keys(t).forEach(n=>{const o=n.split("."),u=o.pop(),d=[e].concat(o).join("."),g=t[n].split("."),i=g.pop(),E=g.join(".");Os.route(d,u,E,i)})}function npe(e){return"id"in e&&"defaults"in e}class rpe{constructor(){this.controllers=new Mb(Oh,"datasets",!0),this.elements=new Mb(jh,"elements"),this.plugins=new Mb(Object,"plugins"),this.scales=new Mb(h_,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,o){[...n].forEach(u=>{const d=o||this._getRegistryForType(u);o||d.isForType(u)||d===this.plugins&&u.id?this._exec(t,d,u):Qi(u,g=>{const i=o||this._getRegistryForType(g);this._exec(t,i,g)})})}_exec(t,n,o){const u=tI(t);xs(o["before"+u],[],o),n[t](o),xs(o["after"+u],[],o)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const o=this._typedRegistries[n];if(o.isForType(t))return o}return this.plugins}_get(t,n,o){const u=n.get(t);if(u===void 0)throw new Error('"'+t+'" is not a registered '+o+".");return u}}var zd=new rpe;class ipe{constructor(){this._init=[]}notify(t,n,o,u){n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const d=u?this._descriptors(t).filter(u):this._descriptors(t),g=this._notify(d,t,n,o);return n==="afterDestroy"&&(this._notify(d,t,"stop"),this._notify(this._init,t,"uninstall")),g}_notify(t,n,o,u){u=u||{};for(const d of t){const g=d.plugin,i=g[o],E=[n,u,d.options];if(xs(i,E,g)===!1&&u.cancelable)return!1}return!0}invalidate(){Ei(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const o=t&&t.config,u=Kr(o.options&&o.options.plugins,{}),d=spe(o);return u===!1&&!n?[]:ape(t,d,u,n)}_notifyStateChanges(t){const n=this._oldCache||[],o=this._cache,u=(d,g)=>d.filter(i=>!g.some(E=>i.plugin.id===E.plugin.id));this._notify(u(n,o),t,"stop"),this._notify(u(o,n),t,"start")}}function spe(e){const t={},n=[],o=Object.keys(zd.plugins.items);for(let d=0;d<o.length;d++)n.push(zd.getPlugin(o[d]));const u=e.plugins||[];for(let d=0;d<u.length;d++){const g=u[d];n.indexOf(g)===-1&&(n.push(g),t[g.id]=!0)}return{plugins:n,localIds:t}}function ope(e,t){return!t&&e===!1?null:e===!0?{}:e}function ape(e,{plugins:t,localIds:n},o,u){const d=[],g=e.getContext();for(const i of t){const E=i.id,P=ope(o[E],u);P!==null&&d.push({plugin:i,options:lpe(e.config,{plugin:i,local:n[E]},P,g)})}return d}function lpe(e,{plugin:t,local:n},o,u){const d=e.pluginScopeKeys(t),g=e.getOptionScopes(o,d);return n&&t.defaults&&g.push(t.defaults),e.createResolver(g,u,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function $A(e,t){const n=Os.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function cpe(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function upe(e,t){return e===t?"_index_":"_value_"}function s3(e){if(e==="x"||e==="y"||e==="r")return e}function hpe(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function HA(e,...t){if(s3(e))return e;for(const n of t){const o=n.axis||hpe(n.position)||e.length>1&&s3(e[0].toLowerCase());if(o)return o}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function o3(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function dpe(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(o=>o.xAxisID===e||o.yAxisID===e);if(n.length)return o3(e,"x",n[0])||o3(e,"y",n[0])}return{}}function fpe(e,t){const n=r_[e.type]||{scales:{}},o=t.scales||{},u=$A(e.type,t),d=Object.create(null);return Object.keys(o).forEach(g=>{const i=o[g];if(!Pi(i))return console.error(`Invalid scale configuration for scale: ${g}`);if(i._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);const E=HA(g,i,dpe(g,e),Os.scales[i.type]),P=upe(E,u),I=n.scales||{};d[g]=rx(Object.create(null),[{axis:E},i,I[E],I[P]])}),e.data.datasets.forEach(g=>{const i=g.type||e.type,E=g.indexAxis||$A(i,t),I=(r_[i]||{}).scales||{};Object.keys(I).forEach(D=>{const F=cpe(D,E),$=g[F+"AxisID"]||F;d[$]=d[$]||Object.create(null),rx(d[$],[{axis:F},o[$],I[D]])})}),Object.keys(d).forEach(g=>{const i=d[g];rx(i,[Os.scales[i.type],Os.scale])}),d}function ZV(e){const t=e.options||(e.options={});t.plugins=Kr(t.plugins,{}),t.scales=fpe(e,t)}function XV(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function ppe(e){return e=e||{},e.data=XV(e.data),ZV(e),e}const a3=new Map,YV=new Set;function kb(e,t){let n=a3.get(e);return n||(n=t(),a3.set(e,n),YV.add(n)),n}const Wv=(e,t,n)=>{const o=km(t,n);o!==void 0&&e.add(o)};class mpe{constructor(t){this._config=ppe(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=XV(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ZV(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return kb(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return kb(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return kb(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,o=this.type;return kb(`${o}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const o=this._scopeCache;let u=o.get(t);return(!u||n)&&(u=new Map,o.set(t,u)),u}getOptionScopes(t,n,o){const{options:u,type:d}=this,g=this._cachedScopes(t,o),i=g.get(n);if(i)return i;const E=new Set;n.forEach(I=>{t&&(E.add(t),I.forEach(D=>Wv(E,t,D))),I.forEach(D=>Wv(E,u,D)),I.forEach(D=>Wv(E,r_[d]||{},D)),I.forEach(D=>Wv(E,Os,D)),I.forEach(D=>Wv(E,BA,D))});const P=Array.from(E);return P.length===0&&P.push(Object.create(null)),YV.has(n)&&g.set(n,P),P}chartOptionScopes(){const{options:t,type:n}=this;return[t,r_[n]||{},Os.datasets[n]||{},{type:n},Os,BA]}resolveNamedOptions(t,n,o,u=[""]){const d={$shared:!0},{resolver:g,subPrefixes:i}=l3(this._resolverCache,t,u);let E=g;if(_pe(g,n)){d.$shared=!1,o=Rm(o)?o():o;const P=this.createResolver(t,o,i);E=wy(g,o,P)}for(const P of n)d[P]=E[P];return d}createResolver(t,n,o=[""],u){const{resolver:d}=l3(this._resolverCache,t,o);return Pi(n)?wy(d,n,void 0,u):d}}function l3(e,t,n){let o=e.get(t);o||(o=new Map,e.set(t,o));const u=n.join();let d=o.get(u);return d||(d={resolver:aI(t,n),subPrefixes:n.filter(i=>!i.toLowerCase().includes("hover"))},o.set(u,d)),d}const gpe=e=>Pi(e)&&Object.getOwnPropertyNames(e).some(t=>Rm(e[t]));function _pe(e,t){const{isScriptable:n,isIndexable:o}=PV(e);for(const u of t){const d=n(u),g=o(u),i=(g||d)&&e[u];if(d&&(Rm(i)||gpe(i))||g&&ks(i))return!0}return!1}var ype="4.5.0";const vpe=["top","bottom","left","right","chartArea"];function c3(e,t){return e==="top"||e==="bottom"||vpe.indexOf(e)===-1&&t==="x"}function u3(e,t){return function(n,o){return n[e]===o[e]?n[t]-o[t]:n[e]-o[e]}}function h3(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),xs(n&&n.onComplete,[e],t)}function xpe(e){const t=e.chart,n=t.options.animation;xs(n&&n.onProgress,[e],t)}function KV(e){return uI()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const e1={},d3=e=>{const t=KV(e);return Object.values(e1).filter(n=>n.canvas===t).pop()};function bpe(e,t,n){const o=Object.keys(e);for(const u of o){const d=+u;if(d>=t){const g=e[u];delete e[u],(n>0||d>t)&&(e[d+n]=g)}}}function wpe(e,t,n,o){return!n||e.type==="mouseout"?null:o?t:e}var pm;let cS=(pm=class{static register(...t){zd.add(...t),f3()}static unregister(...t){zd.remove(...t),f3()}constructor(t,n){const o=this.config=new mpe(n),u=KV(t),d=d3(u);if(d)throw new Error("Canvas is already in use. Chart with ID '"+d.id+"' must be destroyed before the canvas with ID '"+d.canvas.id+"' can be reused.");const g=o.createResolver(o.chartOptionScopes(),this.getContext());this.platform=new(o.platform||Bfe(u)),this.platform.updateConfig(o);const i=this.platform.acquireContext(u,g.aspectRatio),E=i&&i.canvas,P=E&&E.height,I=E&&E.width;if(this.id=She(),this.ctx=i,this.canvas=E,this.width=I,this.height=P,this._options=g,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ipe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Bhe(D=>this.update(D),g.resizeDelay||0),this._dataChanges=[],e1[this.id]=this,!i||!E){console.error("Failed to create chart: can't acquire context from the given item");return}Jf.listen(this,"complete",h3),Jf.listen(this,"progress",xpe),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:o,height:u,_aspectRatio:d}=this;return Ei(t)?n&&d?d:u?o/u:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return zd}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():LN(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return RN(this.canvas,this.ctx),this}stop(){return Jf.stop(this),this}resize(t,n){Jf.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const o=this.options,u=this.canvas,d=o.maintainAspectRatio&&this.aspectRatio,g=this.platform.getMaximumSize(u,t,n,d),i=o.devicePixelRatio||this.platform.getDevicePixelRatio(),E=this.width?"resize":"attach";this.width=g.width,this.height=g.height,this._aspectRatio=this.aspectRatio,LN(this,i,!0)&&(this.notifyPlugins("resize",{size:g}),xs(o.onResize,[this,g],this),this.attached&&this._doResize(E)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};Qi(n,(o,u)=>{o.id=u})}buildOrUpdateScales(){const t=this.options,n=t.scales,o=this.scales,u=Object.keys(o).reduce((g,i)=>(g[i]=!1,g),{});let d=[];n&&(d=d.concat(Object.keys(n).map(g=>{const i=n[g],E=HA(g,i),P=E==="r",I=E==="x";return{options:i,dposition:P?"chartArea":I?"bottom":"left",dtype:P?"radialLinear":I?"category":"linear"}}))),Qi(d,g=>{const i=g.options,E=i.id,P=HA(E,i),I=Kr(i.type,g.dtype);(i.position===void 0||c3(i.position,P)!==c3(g.dposition))&&(i.position=g.dposition),u[E]=!0;let D=null;if(E in o&&o[E].type===I)D=o[E];else{const F=zd.getScale(I);D=new F({id:E,type:I,ctx:this.ctx,chart:this}),o[D.id]=D}D.init(i,t)}),Qi(u,(g,i)=>{g||delete o[i]}),Qi(o,g=>{ul.configure(this,g,g.options),ul.addBox(this,g)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,o=t.length;if(t.sort((u,d)=>u.index-d.index),o>n){for(let u=n;u<o;++u)this._destroyDatasetMeta(u);t.splice(n,o-n)}this._sortedMetasets=t.slice(0).sort(u3("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((o,u)=>{n.filter(d=>d===o._dataset).length===0&&this._destroyDatasetMeta(u)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let o,u;for(this._removeUnreferencedMetasets(),o=0,u=n.length;o<u;o++){const d=n[o];let g=this.getDatasetMeta(o);const i=d.type||this.config.type;if(g.type&&g.type!==i&&(this._destroyDatasetMeta(o),g=this.getDatasetMeta(o)),g.type=i,g.indexAxis=d.indexAxis||$A(i,this.options),g.order=d.order||0,g.index=o,g.label=""+d.label,g.visible=this.isDatasetVisible(o),g.controller)g.controller.updateIndex(o),g.controller.linkScales();else{const E=zd.getController(i),{datasetElementType:P,dataElementType:I}=Os.datasets[i];Object.assign(E,{dataElementType:zd.getElement(I),datasetElementType:P&&zd.getElement(P)}),g.controller=new E(this,o),t.push(g.controller)}}return this._updateMetasets(),t}_resetElements(){Qi(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const o=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),u=this._animationsDisabled=!o.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const d=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let g=0;for(let P=0,I=this.data.datasets.length;P<I;P++){const{controller:D}=this.getDatasetMeta(P),F=!u&&d.indexOf(D)===-1;D.buildOrUpdateElements(F),g=Math.max(+D.getMaxOverflow(),g)}g=this._minPadding=o.layout.autoPadding?g:0,this._updateLayout(g),u||Qi(d,P=>{P.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(u3("z","_idx"));const{_active:i,_lastEvent:E}=this;E?this._eventHandler(E,!0):i.length&&this._updateHoverStyles(i,i,!0),this.render()}_updateScales(){Qi(this.scales,t=>{ul.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),o=new Set(t.events);(!SN(n,o)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:o,start:u,count:d}of n){const g=o==="_removeElements"?-d:d;bpe(t,u,g)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,o=d=>new Set(t.filter(g=>g[0]===d).map((g,i)=>i+","+g.splice(1).join(","))),u=o(0);for(let d=1;d<n;d++)if(!SN(u,o(d)))return;return Array.from(u).map(d=>d.split(",")).map(d=>({method:d[1],start:+d[2],count:+d[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ul.update(this,this.width,this.height,t);const n=this.chartArea,o=n.width<=0||n.height<=0;this._layers=[],Qi(this.boxes,u=>{o&&u.position==="chartArea"||(u.configure&&u.configure(),this._layers.push(...u._layers()))},this),this._layers.forEach((u,d)=>{u._idx=d}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,o=this.data.datasets.length;n<o;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,o=this.data.datasets.length;n<o;++n)this._updateDataset(n,Rm(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const o=this.getDatasetMeta(t),u={meta:o,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",u)!==!1&&(o.controller._update(n),u.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",u))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Jf.has(this)?this.attached&&!Jf.running(this)&&Jf.start(this):(this.draw(),h3({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:o,height:u}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(o,u)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,o=[];let u,d;for(u=0,d=n.length;u<d;++u){const g=n[u];(!t||g.visible)&&o.push(g)}return o}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,o={meta:t,index:t.index,cancelable:!0},u=FV(this,t);this.notifyPlugins("beforeDatasetDraw",o)!==!1&&(u&&sS(n,u),t.controller.draw(),u&&oS(n),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}isPointInArea(t){return ap(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,o,u){const d=vfe.modes[n];return typeof d=="function"?d(this,t,o,u):[]}getDatasetMeta(t){const n=this.data.datasets[t],o=this._metasets;let u=o.filter(d=>d&&d._dataset===n).pop();return u||(u={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},o.push(u)),u}getContext(){return this.$context||(this.$context=Bm(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const o=this.getDatasetMeta(t);return typeof o.hidden=="boolean"?!o.hidden:!n.hidden}setDatasetVisibility(t,n){const o=this.getDatasetMeta(t);o.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,o){const u=o?"show":"hide",d=this.getDatasetMeta(t),g=d.controller._resolveAnimations(void 0,u);Mx(n)?(d.data[n].hidden=!o,this.update()):(this.setDatasetVisibility(t,o),g.update(d,{visible:o}),this.update(i=>i.datasetIndex===t?u:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),Jf.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),RN(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete e1[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,o=(d,g)=>{n.addEventListener(this,d,g),t[d]=g},u=(d,g,i)=>{d.offsetX=g,d.offsetY=i,this._eventHandler(d)};Qi(this.options.events,d=>o(d,u))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,o=(E,P)=>{n.addEventListener(this,E,P),t[E]=P},u=(E,P)=>{t[E]&&(n.removeEventListener(this,E,P),delete t[E])},d=(E,P)=>{this.canvas&&this.resize(E,P)};let g;const i=()=>{u("attach",i),this.attached=!0,this.resize(),o("resize",d),o("detach",g)};g=()=>{this.attached=!1,u("resize",d),this._stop(),this._resize(0,0),o("attach",i)},n.isAttached(this.canvas)?i():g()}unbindEvents(){Qi(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},Qi(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,o){const u=o?"set":"remove";let d,g,i,E;for(n==="dataset"&&(d=this.getDatasetMeta(t[0].datasetIndex),d.controller["_"+u+"DatasetHoverStyle"]()),i=0,E=t.length;i<E;++i){g=t[i];const P=g&&this.getDatasetMeta(g.datasetIndex).controller;P&&P[u+"HoverStyle"](g.element,g.datasetIndex,g.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],o=t.map(({datasetIndex:d,index:g})=>{const i=this.getDatasetMeta(d);if(!i)throw new Error("No dataset found at index "+d);return{datasetIndex:d,element:i.data[g],index:g}});!K1(o,n)&&(this._active=o,this._lastEvent=null,this._updateHoverStyles(o,n))}notifyPlugins(t,n,o){return this._plugins.notify(this,t,n,o)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,o){const u=this.options.hover,d=(E,P)=>E.filter(I=>!P.some(D=>I.datasetIndex===D.datasetIndex&&I.index===D.index)),g=d(n,t),i=o?t:d(t,n);g.length&&this.updateHoverStyle(g,u.mode,!1),i.length&&u.mode&&this.updateHoverStyle(i,u.mode,!0)}_eventHandler(t,n){const o={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},u=g=>(g.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",o,u)===!1)return;const d=this._handleEvent(t,n,o.inChartArea);return o.cancelable=!1,this.notifyPlugins("afterEvent",o,u),(d||o.changed)&&this.render(),this}_handleEvent(t,n,o){const{_active:u=[],options:d}=this,g=n,i=this._getActiveElements(t,u,o,g),E=Ihe(t),P=wpe(t,this._lastEvent,o,E);o&&(this._lastEvent=null,xs(d.onHover,[t,i,this],this),E&&xs(d.onClick,[t,i,this],this));const I=!K1(i,u);return(I||n)&&(this._active=i,this._updateHoverStyles(i,u,n)),this._lastEvent=P,I}_getActiveElements(t,n,o,u){if(t.type==="mouseout")return[];if(!o)return n;const d=this.options.hover;return this.getElementsAtEventForMode(t,d.mode,d,u)}},zn(pm,"defaults",Os),zn(pm,"instances",e1),zn(pm,"overrides",r_),zn(pm,"registry",zd),zn(pm,"version",ype),zn(pm,"getChart",d3),pm);function f3(){return Qi(cS.instances,e=>e._plugins.invalidate())}function Spe(e,t,n){const{startAngle:o,x:u,y:d,outerRadius:g,innerRadius:i,options:E}=t,{borderWidth:P,borderJoinStyle:I}=E,D=Math.min(P/g,ll(o-n));if(e.beginPath(),e.arc(u,d,g-P/2,o+D/2,n-D/2),i>0){const F=Math.min(P/i,ll(o-n));e.arc(u,d,i+P/2,n-F/2,o+F/2,!0)}else{const F=Math.min(P/2,g*ll(o-n));if(I==="round")e.arc(u,d,F,n-Vi/2,o+Vi/2,!0);else if(I==="bevel"){const $=2*F*F,Z=-$*Math.cos(n+Vi/2)+u,q=-$*Math.sin(n+Vi/2)+d,X=$*Math.cos(o+Vi/2)+u,re=$*Math.sin(o+Vi/2)+d;e.lineTo(Z,q),e.lineTo(X,re)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}function Tpe(e,t,n){const{startAngle:o,pixelMargin:u,x:d,y:g,outerRadius:i,innerRadius:E}=t;let P=u/i;e.beginPath(),e.arc(d,g,i,o-P,n+P),E>u?(P=u/E,e.arc(d,g,E,n+P,o-P,!0)):e.arc(d,g,u,n+mo,o-mo),e.closePath(),e.clip()}function Epe(e){return oI(e,["outerStart","outerEnd","innerStart","innerEnd"])}function Ape(e,t,n,o){const u=Epe(e.options.borderRadius),d=(n-t)/2,g=Math.min(d,o*t/2),i=E=>{const P=(n-Math.min(d,E))*o/2;return la(E,0,Math.min(d,P))};return{outerStart:i(u.outerStart),outerEnd:i(u.outerEnd),innerStart:la(u.innerStart,0,g),innerEnd:la(u.innerEnd,0,g)}}function ny(e,t,n,o){return{x:n+e*Math.cos(t),y:o+e*Math.sin(t)}}function rw(e,t,n,o,u,d){const{x:g,y:i,startAngle:E,pixelMargin:P,innerRadius:I}=t,D=Math.max(t.outerRadius+o+n-P,0),F=I>0?I+o+n+P:0;let $=0;const Z=u-E;if(o){const Nt=I>0?I-o:0,St=D>0?D-o:0,an=(Nt+St)/2,Kt=an!==0?Z*an/(an+o):Z;$=(Z-Kt)/2}const q=Math.max(.001,Z*D-n/Vi)/D,X=(Z-q)/2,re=E+X+$,le=u-X-$,{outerStart:ue,outerEnd:ye,innerStart:ge,innerEnd:we}=Ape(t,F,D,le-re),Le=D-ue,Ze=D-ye,Ge=re+ue/Le,gt=le-ye/Ze,lt=F+ge,qe=F+we,en=re+ge/lt,Jt=le-we/qe;if(e.beginPath(),d){const Nt=(Ge+gt)/2;if(e.arc(g,i,D,Ge,Nt),e.arc(g,i,D,Nt,gt),ye>0){const hn=ny(Ze,gt,g,i);e.arc(hn.x,hn.y,ye,gt,le+mo)}const St=ny(qe,le,g,i);if(e.lineTo(St.x,St.y),we>0){const hn=ny(qe,Jt,g,i);e.arc(hn.x,hn.y,we,le+mo,Jt+Math.PI)}const an=(le-we/F+(re+ge/F))/2;if(e.arc(g,i,F,le-we/F,an,!0),e.arc(g,i,F,an,re+ge/F,!0),ge>0){const hn=ny(lt,en,g,i);e.arc(hn.x,hn.y,ge,en+Math.PI,re-mo)}const Kt=ny(Le,re,g,i);if(e.lineTo(Kt.x,Kt.y),ue>0){const hn=ny(Le,Ge,g,i);e.arc(hn.x,hn.y,ue,re-mo,Ge)}}else{e.moveTo(g,i);const Nt=Math.cos(Ge)*D+g,St=Math.sin(Ge)*D+i;e.lineTo(Nt,St);const an=Math.cos(gt)*D+g,Kt=Math.sin(gt)*D+i;e.lineTo(an,Kt)}e.closePath()}function Cpe(e,t,n,o,u){const{fullCircles:d,startAngle:g,circumference:i}=t;let E=t.endAngle;if(d){rw(e,t,n,o,E,u);for(let P=0;P<d;++P)e.fill();isNaN(i)||(E=g+(i%Ts||Ts))}return rw(e,t,n,o,E,u),e.fill(),E}function Ppe(e,t,n,o,u){const{fullCircles:d,startAngle:g,circumference:i,options:E}=t,{borderWidth:P,borderJoinStyle:I,borderDash:D,borderDashOffset:F,borderRadius:$}=E,Z=E.borderAlign==="inner";if(!P)return;e.setLineDash(D||[]),e.lineDashOffset=F,Z?(e.lineWidth=P*2,e.lineJoin=I||"round"):(e.lineWidth=P,e.lineJoin=I||"bevel");let q=t.endAngle;if(d){rw(e,t,n,o,q,u);for(let X=0;X<d;++X)e.stroke();isNaN(i)||(q=g+(i%Ts||Ts))}Z&&Tpe(e,t,q),E.selfJoin&&q-g>=Vi&&$===0&&I!=="miter"&&Spe(e,t,q),d||(rw(e,t,n,o,q,u),e.stroke())}class Qv extends jh{constructor(n){super();zn(this,"circumference");zn(this,"endAngle");zn(this,"fullCircles");zn(this,"innerRadius");zn(this,"outerRadius");zn(this,"pixelMargin");zn(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,o,u){const d=this.getProps(["x","y"],u),{angle:g,distance:i}=yV(d,{x:n,y:o}),{startAngle:E,endAngle:P,innerRadius:I,outerRadius:D,circumference:F}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],u),$=(this.options.spacing+this.options.borderWidth)/2,Z=Kr(F,P-E),q=kx(g,E,P)&&E!==P,X=Z>=Ts||q,re=sp(i,I+$,D+$);return X&&re}getCenterPoint(n){const{x:o,y:u,startAngle:d,endAngle:g,innerRadius:i,outerRadius:E}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:P,spacing:I}=this.options,D=(d+g)/2,F=(i+E+I+P)/2;return{x:o+Math.cos(D)*F,y:u+Math.sin(D)*F}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:o,circumference:u}=this,d=(o.offset||0)/4,g=(o.spacing||0)/2,i=o.circular;if(this.pixelMargin=o.borderAlign==="inner"?.33:0,this.fullCircles=u>Ts?Math.floor(u/Ts):0,u===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const E=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(E)*d,Math.sin(E)*d);const P=1-Math.sin(Math.min(Vi,u||0)),I=d*P;n.fillStyle=o.backgroundColor,n.strokeStyle=o.borderColor,Cpe(n,this,I,g,i),Ppe(n,this,I,g,i),n.restore()}}zn(Qv,"id","arc"),zn(Qv,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),zn(Qv,"defaultRoutes",{backgroundColor:"backgroundColor"}),zn(Qv,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function JV(e,t,n=t){e.lineCap=Kr(n.borderCapStyle,t.borderCapStyle),e.setLineDash(Kr(n.borderDash,t.borderDash)),e.lineDashOffset=Kr(n.borderDashOffset,t.borderDashOffset),e.lineJoin=Kr(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=Kr(n.borderWidth,t.borderWidth),e.strokeStyle=Kr(n.borderColor,t.borderColor)}function Ipe(e,t,n){e.lineTo(n.x,n.y)}function Mpe(e){return e.stepped?Jhe:e.tension||e.cubicInterpolationMode==="monotone"?Qhe:Ipe}function QV(e,t,n={}){const o=e.length,{start:u=0,end:d=o-1}=n,{start:g,end:i}=t,E=Math.max(u,g),P=Math.min(d,i),I=u<g&&d<g||u>i&&d>i;return{count:o,start:E,loop:t.loop,ilen:P<E&&!I?o+P-E:P-E}}function kpe(e,t,n,o){const{points:u,options:d}=t,{count:g,start:i,loop:E,ilen:P}=QV(u,n,o),I=Mpe(d);let{move:D=!0,reverse:F}=o||{},$,Z,q;for($=0;$<=P;++$)Z=u[(i+(F?P-$:$))%g],!Z.skip&&(D?(e.moveTo(Z.x,Z.y),D=!1):I(e,q,Z,F,d.stepped),q=Z);return E&&(Z=u[(i+(F?P:0))%g],I(e,q,Z,F,d.stepped)),!!E}function Rpe(e,t,n,o){const u=t.points,{count:d,start:g,ilen:i}=QV(u,n,o),{move:E=!0,reverse:P}=o||{};let I=0,D=0,F,$,Z,q,X,re;const le=ye=>(g+(P?i-ye:ye))%d,ue=()=>{q!==X&&(e.lineTo(I,X),e.lineTo(I,q),e.lineTo(I,re))};for(E&&($=u[le(0)],e.moveTo($.x,$.y)),F=0;F<=i;++F){if($=u[le(F)],$.skip)continue;const ye=$.x,ge=$.y,we=ye|0;we===Z?(ge<q?q=ge:ge>X&&(X=ge),I=(D*I+ye)/++D):(ue(),e.lineTo(ye,ge),Z=we,D=0,q=X=ge),re=ge}ue()}function GA(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!n?Rpe:kpe}function Ope(e){return e.stepped?kde:e.tension||e.cubicInterpolationMode==="monotone"?Rde:Og}function Dpe(e,t,n,o){let u=t._path;u||(u=t._path=new Path2D,t.path(u,n,o)&&u.closePath()),JV(e,t.options),e.stroke(u)}function Lpe(e,t,n,o){const{segments:u,options:d}=t,g=GA(t);for(const i of u)JV(e,d,i.style),e.beginPath(),g(e,t,i,{start:n,end:n+o-1})&&e.closePath(),e.stroke()}const jpe=typeof Path2D=="function";function zpe(e,t,n,o){jpe&&!t.options.segment?Dpe(e,t,n,o):Lpe(e,t,n,o)}class bm extends jh{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){const o=this.options;if((o.tension||o.cubicInterpolationMode==="monotone")&&!o.stepped&&!this._pointsUpdated){const u=o.spanGaps?this._loop:this._fullLoop;Sde(this._points,o,t,u,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Nde(this,this.options.segment))}first(){const t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){const t=this.segments,n=this.points,o=t.length;return o&&n[t[o-1].end]}interpolate(t,n){const o=this.options,u=t[n],d=this.points,g=NV(this,{property:n,start:u,end:u});if(!g.length)return;const i=[],E=Ope(o);let P,I;for(P=0,I=g.length;P<I;++P){const{start:D,end:F}=g[P],$=d[D],Z=d[F];if($===Z){i.push($);continue}const q=Math.abs((u-$[n])/(Z[n]-$[n])),X=E($,Z,q,o.stepped);X[n]=t[n],i.push(X)}return i.length===1?i[0]:i}pathSegment(t,n,o){return GA(this)(t,this,n,o)}path(t,n,o){const u=this.segments,d=GA(this);let g=this._loop;n=n||0,o=o||this.points.length-n;for(const i of u)g&=d(t,this,i,{start:n,end:n+o-1});return!!g}draw(t,n,o,u){const d=this.options||{};(this.points||[]).length&&d.borderWidth&&(t.save(),zpe(t,this,o,u),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}zn(bm,"id","line"),zn(bm,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),zn(bm,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),zn(bm,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function p3(e,t,n,o){const u=e.options,{[n]:d}=e.getProps([n],o);return Math.abs(t-d)<u.radius+u.hitRadius}class t1 extends jh{constructor(n){super();zn(this,"parsed");zn(this,"skip");zn(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,o,u){const d=this.options,{x:g,y:i}=this.getProps(["x","y"],u);return Math.pow(n-g,2)+Math.pow(o-i,2)<Math.pow(d.hitRadius+d.radius,2)}inXRange(n,o){return p3(this,n,"x",o)}inYRange(n,o){return p3(this,n,"y",o)}getCenterPoint(n){const{x:o,y:u}=this.getProps(["x","y"],n);return{x:o,y:u}}size(n){n=n||this.options||{};let o=n.radius||0;o=Math.max(o,o&&n.hoverRadius||0);const u=o&&n.borderWidth||0;return(o+u)*2}draw(n,o){const u=this.options;this.skip||u.radius<.1||!ap(this,o,this.size(u)/2)||(n.strokeStyle=u.borderColor,n.lineWidth=u.borderWidth,n.fillStyle=u.backgroundColor,UA(n,u,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}zn(t1,"id","point"),zn(t1,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),zn(t1,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function e6(e,t){const{x:n,y:o,base:u,width:d,height:g}=e.getProps(["x","y","base","width","height"],t);let i,E,P,I,D;return e.horizontal?(D=g/2,i=Math.min(n,u),E=Math.max(n,u),P=o-D,I=o+D):(D=d/2,i=n-D,E=n+D,P=Math.min(o,u),I=Math.max(o,u)),{left:i,top:P,right:E,bottom:I}}function wm(e,t,n,o){return e?0:la(t,n,o)}function Npe(e,t,n){const o=e.options.borderWidth,u=e.borderSkipped,d=CV(o);return{t:wm(u.top,d.top,0,n),r:wm(u.right,d.right,0,t),b:wm(u.bottom,d.bottom,0,n),l:wm(u.left,d.left,0,t)}}function Fpe(e,t,n){const{enableBorderRadius:o}=e.getProps(["enableBorderRadius"]),u=e.options.borderRadius,d=Hg(u),g=Math.min(t,n),i=e.borderSkipped,E=o||Pi(u);return{topLeft:wm(!E||i.top||i.left,d.topLeft,0,g),topRight:wm(!E||i.top||i.right,d.topRight,0,g),bottomLeft:wm(!E||i.bottom||i.left,d.bottomLeft,0,g),bottomRight:wm(!E||i.bottom||i.right,d.bottomRight,0,g)}}function Bpe(e){const t=e6(e),n=t.right-t.left,o=t.bottom-t.top,u=Npe(e,n/2,o/2),d=Fpe(e,n/2,o/2);return{outer:{x:t.left,y:t.top,w:n,h:o,radius:d},inner:{x:t.left+u.l,y:t.top+u.t,w:n-u.l-u.r,h:o-u.t-u.b,radius:{topLeft:Math.max(0,d.topLeft-Math.max(u.t,u.l)),topRight:Math.max(0,d.topRight-Math.max(u.t,u.r)),bottomLeft:Math.max(0,d.bottomLeft-Math.max(u.b,u.l)),bottomRight:Math.max(0,d.bottomRight-Math.max(u.b,u.r))}}}}function ME(e,t,n,o){const u=t===null,d=n===null,i=e&&!(u&&d)&&e6(e,o);return i&&(u||sp(t,i.left,i.right))&&(d||sp(n,i.top,i.bottom))}function Upe(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function Vpe(e,t){e.rect(t.x,t.y,t.w,t.h)}function kE(e,t,n={}){const o=e.x!==n.x?-t:0,u=e.y!==n.y?-t:0,d=(e.x+e.w!==n.x+n.w?t:0)-o,g=(e.y+e.h!==n.y+n.h?t:0)-u;return{x:e.x+o,y:e.y+u,w:e.w+d,h:e.h+g,radius:e.radius}}class n1 extends jh{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:o,backgroundColor:u}}=this,{inner:d,outer:g}=Bpe(this),i=Upe(g.radius)?Rx:Vpe;t.save(),(g.w!==d.w||g.h!==d.h)&&(t.beginPath(),i(t,kE(g,n,d)),t.clip(),i(t,kE(d,-n,g)),t.fillStyle=o,t.fill("evenodd")),t.beginPath(),i(t,kE(d,n)),t.fillStyle=u,t.fill(),t.restore()}inRange(t,n,o){return ME(this,t,n,o)}inXRange(t,n){return ME(this,t,null,n)}inYRange(t,n){return ME(this,null,t,n)}getCenterPoint(t){const{x:n,y:o,base:u,horizontal:d}=this.getProps(["x","y","base","horizontal"],t);return{x:d?(n+u)/2:n,y:d?o:(o+u)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}zn(n1,"id","bar"),zn(n1,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),zn(n1,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var $pe=Object.freeze({__proto__:null,ArcElement:Qv,BarElement:n1,LineElement:bm,PointElement:t1});const WA=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],m3=WA.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function t6(e){return WA[e%WA.length]}function n6(e){return m3[e%m3.length]}function Hpe(e,t){return e.borderColor=t6(t),e.backgroundColor=n6(t),++t}function Gpe(e,t){return e.backgroundColor=e.data.map(()=>t6(t++)),t}function Wpe(e,t){return e.backgroundColor=e.data.map(()=>n6(t++)),t}function qpe(e){let t=0;return(n,o)=>{const u=e.getDatasetMeta(o).controller;u instanceof Ng?t=Gpe(n,t):u instanceof cx?t=Wpe(n,t):u&&(t=Hpe(n,t))}}function g3(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}function Zpe(e){return e&&(e.borderColor||e.backgroundColor)}function Xpe(){return Os.borderColor!=="rgba(0,0,0,0.1)"||Os.backgroundColor!=="rgba(0,0,0,0.1)"}var Ype={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:o},options:u}=e.config,{elements:d}=u,g=g3(o)||Zpe(u)||d&&g3(d)||Xpe();if(!n.forceOverride&&g)return;const i=qpe(e);o.forEach(i)}};function Kpe(e,t,n,o,u){const d=u.samples||o;if(d>=n)return e.slice(t,t+n);const g=[],i=(n-2)/(d-2);let E=0;const P=t+n-1;let I=t,D,F,$,Z,q;for(g[E++]=e[I],D=0;D<d-2;D++){let X=0,re=0,le;const ue=Math.floor((D+1)*i)+1+t,ye=Math.min(Math.floor((D+2)*i)+1,n)+t,ge=ye-ue;for(le=ue;le<ye;le++)X+=e[le].x,re+=e[le].y;X/=ge,re/=ge;const we=Math.floor(D*i)+1+t,Le=Math.min(Math.floor((D+1)*i)+1,n)+t,{x:Ze,y:Ge}=e[I];for($=Z=-1,le=we;le<Le;le++)Z=.5*Math.abs((Ze-X)*(e[le].y-Ge)-(Ze-e[le].x)*(re-Ge)),Z>$&&($=Z,F=e[le],q=le);g[E++]=F,I=q}return g[E++]=e[P],g}function Jpe(e,t,n,o){let u=0,d=0,g,i,E,P,I,D,F,$,Z,q;const X=[],re=t+n-1,le=e[t].x,ye=e[re].x-le;for(g=t;g<t+n;++g){i=e[g],E=(i.x-le)/ye*o,P=i.y;const ge=E|0;if(ge===I)P<Z?(Z=P,D=g):P>q&&(q=P,F=g),u=(d*u+i.x)/++d;else{const we=g-1;if(!Ei(D)&&!Ei(F)){const Le=Math.min(D,F),Ze=Math.max(D,F);Le!==$&&Le!==we&&X.push({...e[Le],x:u}),Ze!==$&&Ze!==we&&X.push({...e[Ze],x:u})}g>0&&we!==$&&X.push(e[we]),X.push(i),I=ge,d=0,Z=q=P,D=F=$=g}}return X}function r6(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function _3(e){e.data.datasets.forEach(t=>{r6(t)})}function Qpe(e,t){const n=t.length;let o=0,u;const{iScale:d}=e,{min:g,max:i,minDefined:E,maxDefined:P}=d.getUserBounds();return E&&(o=la(op(t,d.axis,g).lo,0,n-1)),P?u=la(op(t,d.axis,i).hi+1,o,n)-o:u=n-o,{start:o,count:u}}var eme={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled){_3(e);return}const o=e.width;e.data.datasets.forEach((u,d)=>{const{_data:g,indexAxis:i}=u,E=e.getDatasetMeta(d),P=g||u.data;if(Kv([i,e.options.indexAxis])==="y"||!E.controller.supportsDecimation)return;const I=e.scales[E.xAxisID];if(I.type!=="linear"&&I.type!=="time"||e.options.parsing)return;let{start:D,count:F}=Qpe(E,P);const $=n.threshold||4*o;if(F<=$){r6(u);return}Ei(g)&&(u._data=P,delete u.data,Object.defineProperty(u,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(q){this._data=q}}));let Z;switch(n.algorithm){case"lttb":Z=Kpe(P,D,F,o,n);break;case"min-max":Z=Jpe(P,D,F,o);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}u._decimated=Z})},destroy(e){_3(e)}};function tme(e,t,n){const o=e.segments,u=e.points,d=t.points,g=[];for(const i of o){let{start:E,end:P}=i;P=uS(E,P,u);const I=qA(n,u[E],u[P],i.loop);if(!t.segments){g.push({source:i,target:I,start:u[E],end:u[P]});continue}const D=NV(t,I);for(const F of D){const $=qA(n,d[F.start],d[F.end],F.loop),Z=zV(i,u,$);for(const q of Z)g.push({source:q,target:F,start:{[n]:y3(I,$,"start",Math.max)},end:{[n]:y3(I,$,"end",Math.min)}})}}return g}function qA(e,t,n,o){if(o)return;let u=t[e],d=n[e];return e==="angle"&&(u=ll(u),d=ll(d)),{property:e,start:u,end:d}}function nme(e,t){const{x:n=null,y:o=null}=e||{},u=t.points,d=[];return t.segments.forEach(({start:g,end:i})=>{i=uS(g,i,u);const E=u[g],P=u[i];o!==null?(d.push({x:E.x,y:o}),d.push({x:P.x,y:o})):n!==null&&(d.push({x:n,y:E.y}),d.push({x:n,y:P.y}))}),d}function uS(e,t,n){for(;t>e;t--){const o=n[t];if(!isNaN(o.x)&&!isNaN(o.y))break}return t}function y3(e,t,n,o){return e&&t?o(e[n],t[n]):e?e[n]:t?t[n]:0}function i6(e,t){let n=[],o=!1;return ks(e)?(o=!0,n=e):n=nme(e,t),n.length?new bm({points:n,options:{tension:0},_loop:o,_fullLoop:o}):null}function v3(e){return e&&e.fill!==!1}function rme(e,t,n){let u=e[t].fill;const d=[t];let g;if(!n)return u;for(;u!==!1&&d.indexOf(u)===-1;){if(!to(u))return u;if(g=e[u],!g)return!1;if(g.visible)return u;d.push(u),u=g.fill}return!1}function ime(e,t,n){const o=lme(e);if(Pi(o))return isNaN(o.value)?!1:o;let u=parseFloat(o);return to(u)&&Math.floor(u)===u?sme(o[0],t,u,n):["origin","start","end","stack","shape"].indexOf(o)>=0&&o}function sme(e,t,n,o){return(e==="-"||e==="+")&&(n=t+n),n===t||n<0||n>=o?!1:n}function ome(e,t){let n=null;return e==="start"?n=t.bottom:e==="end"?n=t.top:Pi(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}function ame(e,t,n){let o;return e==="start"?o=n:e==="end"?o=t.options.reverse?t.min:t.max:Pi(e)?o=e.value:o=t.getBaseValue(),o}function lme(e){const t=e.options,n=t.fill;let o=Kr(n&&n.target,n);return o===void 0&&(o=!!t.backgroundColor),o===!1||o===null?!1:o===!0?"origin":o}function cme(e){const{scale:t,index:n,line:o}=e,u=[],d=o.segments,g=o.points,i=ume(t,n);i.push(i6({x:null,y:t.bottom},o));for(let E=0;E<d.length;E++){const P=d[E];for(let I=P.start;I<=P.end;I++)hme(u,g[I],i)}return new bm({points:u,options:{}})}function ume(e,t){const n=[],o=e.getMatchingVisibleMetas("line");for(let u=0;u<o.length;u++){const d=o[u];if(d.index===t)break;d.hidden||n.unshift(d.dataset)}return n}function hme(e,t,n){const o=[];for(let u=0;u<n.length;u++){const d=n[u],{first:g,last:i,point:E}=dme(d,t,"x");if(!(!E||g&&i)){if(g)o.unshift(E);else if(e.push(E),!i)break}}e.push(...o)}function dme(e,t,n){const o=e.interpolate(t,n);if(!o)return{};const u=o[n],d=e.segments,g=e.points;let i=!1,E=!1;for(let P=0;P<d.length;P++){const I=d[P],D=g[I.start][n],F=g[I.end][n];if(sp(u,D,F)){i=u===D,E=u===F;break}}return{first:i,last:E,point:o}}class s6{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,o){const{x:u,y:d,radius:g}=this;return n=n||{start:0,end:Ts},t.arc(u,d,g,n.end,n.start,!0),!o.bounds}interpolate(t){const{x:n,y:o,radius:u}=this,d=t.angle;return{x:n+Math.cos(d)*u,y:o+Math.sin(d)*u,angle:d}}}function fme(e){const{chart:t,fill:n,line:o}=e;if(to(n))return pme(t,n);if(n==="stack")return cme(e);if(n==="shape")return!0;const u=mme(e);return u instanceof s6?u:i6(u,o)}function pme(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}function mme(e){return(e.scale||{}).getPointPositionForValue?_me(e):gme(e)}function gme(e){const{scale:t={},fill:n}=e,o=ome(n,t);if(to(o)){const u=t.isHorizontal();return{x:u?o:null,y:u?null:o}}return null}function _me(e){const{scale:t,fill:n}=e,o=t.options,u=t.getLabels().length,d=o.reverse?t.max:t.min,g=ame(n,t,d),i=[];if(o.grid.circular){const E=t.getPointPositionForValue(0,d);return new s6({x:E.x,y:E.y,radius:t.getDistanceFromCenterForValue(g)})}for(let E=0;E<u;++E)i.push(t.getPointPositionForValue(E,g));return i}function RE(e,t,n){const o=fme(t),{chart:u,index:d,line:g,scale:i,axis:E}=t,P=g.options,I=P.fill,D=P.backgroundColor,{above:F=D,below:$=D}=I||{},Z=u.getDatasetMeta(d),q=FV(u,Z);o&&g.points.length&&(sS(e,n),yme(e,{line:g,target:o,above:F,below:$,area:n,scale:i,axis:E,clip:q}),oS(e))}function yme(e,t){const{line:n,target:o,above:u,below:d,area:g,scale:i,clip:E}=t,P=n._loop?"angle":t.axis;e.save();let I=d;d!==u&&(P==="x"?(x3(e,o,g.top),OE(e,{line:n,target:o,color:u,scale:i,property:P,clip:E}),e.restore(),e.save(),x3(e,o,g.bottom)):P==="y"&&(b3(e,o,g.left),OE(e,{line:n,target:o,color:d,scale:i,property:P,clip:E}),e.restore(),e.save(),b3(e,o,g.right),I=u)),OE(e,{line:n,target:o,color:I,scale:i,property:P,clip:E}),e.restore()}function x3(e,t,n){const{segments:o,points:u}=t;let d=!0,g=!1;e.beginPath();for(const i of o){const{start:E,end:P}=i,I=u[E],D=u[uS(E,P,u)];d?(e.moveTo(I.x,I.y),d=!1):(e.lineTo(I.x,n),e.lineTo(I.x,I.y)),g=!!t.pathSegment(e,i,{move:g}),g?e.closePath():e.lineTo(D.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function b3(e,t,n){const{segments:o,points:u}=t;let d=!0,g=!1;e.beginPath();for(const i of o){const{start:E,end:P}=i,I=u[E],D=u[uS(E,P,u)];d?(e.moveTo(I.x,I.y),d=!1):(e.lineTo(n,I.y),e.lineTo(I.x,I.y)),g=!!t.pathSegment(e,i,{move:g}),g?e.closePath():e.lineTo(n,D.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function OE(e,t){const{line:n,target:o,property:u,color:d,scale:g,clip:i}=t,E=tme(n,o,u);for(const{source:P,target:I,start:D,end:F}of E){const{style:{backgroundColor:$=d}={}}=P,Z=o!==!0;e.save(),e.fillStyle=$,vme(e,g,i,Z&&qA(u,D,F)),e.beginPath();const q=!!n.pathSegment(e,P);let X;if(Z){q?e.closePath():w3(e,o,F,u);const re=!!o.pathSegment(e,I,{move:q,reverse:!0});X=q&&re,X||w3(e,o,D,u)}e.closePath(),e.fill(X?"evenodd":"nonzero"),e.restore()}}function vme(e,t,n,o){const u=t.chart.chartArea,{property:d,start:g,end:i}=o||{};if(d==="x"||d==="y"){let E,P,I,D;d==="x"?(E=g,P=u.top,I=i,D=u.bottom):(E=u.left,P=g,I=u.right,D=i),e.beginPath(),n&&(E=Math.max(E,n.left),I=Math.min(I,n.right),P=Math.max(P,n.top),D=Math.min(D,n.bottom)),e.rect(E,P,I-E,D-P),e.clip()}}function w3(e,t,n,o){const u=t.interpolate(n,o);u&&e.lineTo(u.x,u.y)}var xme={id:"filler",afterDatasetsUpdate(e,t,n){const o=(e.data.datasets||[]).length,u=[];let d,g,i,E;for(g=0;g<o;++g)d=e.getDatasetMeta(g),i=d.dataset,E=null,i&&i.options&&i instanceof bm&&(E={visible:e.isDatasetVisible(g),index:g,fill:ime(i,g,o),chart:e,axis:d.controller.options.indexAxis,scale:d.vScale,line:i}),d.$filler=E,u.push(E);for(g=0;g<o;++g)E=u[g],!(!E||E.fill===!1)&&(E.fill=rme(u,g,n.propagate))},beforeDraw(e,t,n){const o=n.drawTime==="beforeDraw",u=e.getSortedVisibleDatasetMetas(),d=e.chartArea;for(let g=u.length-1;g>=0;--g){const i=u[g].$filler;i&&(i.line.updateControlPoints(d,i.axis),o&&i.fill&&RE(e.ctx,i,d))}},beforeDatasetsDraw(e,t,n){if(n.drawTime!=="beforeDatasetsDraw")return;const o=e.getSortedVisibleDatasetMetas();for(let u=o.length-1;u>=0;--u){const d=o[u].$filler;v3(d)&&RE(e.ctx,d,e.chartArea)}},beforeDatasetDraw(e,t,n){const o=t.meta.$filler;!v3(o)||n.drawTime!=="beforeDatasetDraw"||RE(e.ctx,o,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const S3=(e,t)=>{let{boxHeight:n=t,boxWidth:o=t}=e;return e.usePointStyle&&(n=Math.min(n,t),o=e.pointStyleWidth||Math.min(o,t)),{boxWidth:o,boxHeight:n,itemHeight:Math.max(t,n)}},bme=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class T3 extends jh{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,o){this.maxWidth=t,this.maxHeight=n,this._margins=o,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=xs(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(o=>t.filter(o,this.chart.data))),t.sort&&(n=n.sort((o,u)=>t.sort(o,u,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const o=t.labels,u=Wo(o.font),d=u.size,g=this._computeTitleHeight(),{boxWidth:i,itemHeight:E}=S3(o,d);let P,I;n.font=u.string,this.isHorizontal()?(P=this.maxWidth,I=this._fitRows(g,d,i,E)+10):(I=this.maxHeight,P=this._fitCols(g,u,i,E)+10),this.width=Math.min(P,t.maxWidth||this.maxWidth),this.height=Math.min(I,t.maxHeight||this.maxHeight)}_fitRows(t,n,o,u){const{ctx:d,maxWidth:g,options:{labels:{padding:i}}}=this,E=this.legendHitBoxes=[],P=this.lineWidths=[0],I=u+i;let D=t;d.textAlign="left",d.textBaseline="middle";let F=-1,$=-I;return this.legendItems.forEach((Z,q)=>{const X=o+n/2+d.measureText(Z.text).width;(q===0||P[P.length-1]+X+2*i>g)&&(D+=I,P[P.length-(q>0?0:1)]=0,$+=I,F++),E[q]={left:0,top:$,row:F,width:X,height:u},P[P.length-1]+=X+i}),D}_fitCols(t,n,o,u){const{ctx:d,maxHeight:g,options:{labels:{padding:i}}}=this,E=this.legendHitBoxes=[],P=this.columnSizes=[],I=g-t;let D=i,F=0,$=0,Z=0,q=0;return this.legendItems.forEach((X,re)=>{const{itemWidth:le,itemHeight:ue}=wme(o,n,d,X,u);re>0&&$+ue+2*i>I&&(D+=F+i,P.push({width:F,height:$}),Z+=F+i,q++,F=$=0),E[re]={left:Z,top:$,col:q,width:le,height:ue},F=Math.max(F,le),$+=ue+i}),D+=F,P.push({width:F,height:$}),D}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:o,labels:{padding:u},rtl:d}}=this,g=cy(d,this.left,this.width);if(this.isHorizontal()){let i=0,E=al(o,this.left+u,this.right-this.lineWidths[i]);for(const P of n)i!==P.row&&(i=P.row,E=al(o,this.left+u,this.right-this.lineWidths[i])),P.top+=this.top+t+u,P.left=g.leftForLtr(g.x(E),P.width),E+=P.width+u}else{let i=0,E=al(o,this.top+t+u,this.bottom-this.columnSizes[i].height);for(const P of n)P.col!==i&&(i=P.col,E=al(o,this.top+t+u,this.bottom-this.columnSizes[i].height)),P.top=E,P.left+=this.left+u,P.left=g.leftForLtr(g.x(P.left),P.width),E+=P.height+u}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;sS(t,this),this._draw(),oS(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:o,ctx:u}=this,{align:d,labels:g}=t,i=Os.color,E=cy(t.rtl,this.left,this.width),P=Wo(g.font),{padding:I}=g,D=P.size,F=D/2;let $;this.drawTitle(),u.textAlign=E.textAlign("left"),u.textBaseline="middle",u.lineWidth=.5,u.font=P.string;const{boxWidth:Z,boxHeight:q,itemHeight:X}=S3(g,D),re=function(we,Le,Ze){if(isNaN(Z)||Z<=0||isNaN(q)||q<0)return;u.save();const Ge=Kr(Ze.lineWidth,1);if(u.fillStyle=Kr(Ze.fillStyle,i),u.lineCap=Kr(Ze.lineCap,"butt"),u.lineDashOffset=Kr(Ze.lineDashOffset,0),u.lineJoin=Kr(Ze.lineJoin,"miter"),u.lineWidth=Ge,u.strokeStyle=Kr(Ze.strokeStyle,i),u.setLineDash(Kr(Ze.lineDash,[])),g.usePointStyle){const gt={radius:q*Math.SQRT2/2,pointStyle:Ze.pointStyle,rotation:Ze.rotation,borderWidth:Ge},lt=E.xPlus(we,Z/2),qe=Le+F;AV(u,gt,lt,qe,g.pointStyleWidth&&Z)}else{const gt=Le+Math.max((D-q)/2,0),lt=E.leftForLtr(we,Z),qe=Hg(Ze.borderRadius);u.beginPath(),Object.values(qe).some(en=>en!==0)?Rx(u,{x:lt,y:gt,w:Z,h:q,radius:qe}):u.rect(lt,gt,Z,q),u.fill(),Ge!==0&&u.stroke()}u.restore()},le=function(we,Le,Ze){i_(u,Ze.text,we,Le+X/2,P,{strikethrough:Ze.hidden,textAlign:E.textAlign(Ze.textAlign)})},ue=this.isHorizontal(),ye=this._computeTitleHeight();ue?$={x:al(d,this.left+I,this.right-o[0]),y:this.top+I+ye,line:0}:$={x:this.left+I,y:al(d,this.top+ye+I,this.bottom-n[0].height),line:0},DV(this.ctx,t.textDirection);const ge=X+I;this.legendItems.forEach((we,Le)=>{u.strokeStyle=we.fontColor,u.fillStyle=we.fontColor;const Ze=u.measureText(we.text).width,Ge=E.textAlign(we.textAlign||(we.textAlign=g.textAlign)),gt=Z+F+Ze;let lt=$.x,qe=$.y;E.setWidth(this.width),ue?Le>0&&lt+gt+I>this.right&&(qe=$.y+=ge,$.line++,lt=$.x=al(d,this.left+I,this.right-o[$.line])):Le>0&&qe+ge>this.bottom&&(lt=$.x=lt+n[$.line].width+I,$.line++,qe=$.y=al(d,this.top+ye+I,this.bottom-n[$.line].height));const en=E.x(lt);if(re(en,qe,we),lt=Uhe(Ge,lt+Z+F,ue?lt+gt:this.right,t.rtl),le(E.x(lt),qe,we),ue)$.x+=gt+I;else if(typeof we.text!="string"){const Jt=P.lineHeight;$.y+=o6(we,Jt)+I}else $.y+=ge}),LV(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,o=Wo(n.font),u=dl(n.padding);if(!n.display)return;const d=cy(t.rtl,this.left,this.width),g=this.ctx,i=n.position,E=o.size/2,P=u.top+E;let I,D=this.left,F=this.width;if(this.isHorizontal())F=Math.max(...this.lineWidths),I=this.top+P,D=al(t.align,D,this.right-F);else{const Z=this.columnSizes.reduce((q,X)=>Math.max(q,X.height),0);I=P+al(t.align,this.top,this.bottom-Z-t.labels.padding-this._computeTitleHeight())}const $=al(i,D,D+F);g.textAlign=d.textAlign(iI(i)),g.textBaseline="middle",g.strokeStyle=n.color,g.fillStyle=n.color,g.font=o.string,i_(g,n.text,$,I,o)}_computeTitleHeight(){const t=this.options.title,n=Wo(t.font),o=dl(t.padding);return t.display?n.lineHeight+o.height:0}_getLegendItemAt(t,n){let o,u,d;if(sp(t,this.left,this.right)&&sp(n,this.top,this.bottom)){for(d=this.legendHitBoxes,o=0;o<d.length;++o)if(u=d[o],sp(t,u.left,u.left+u.width)&&sp(n,u.top,u.top+u.height))return this.legendItems[o]}return null}handleEvent(t){const n=this.options;if(!Eme(t.type,n))return;const o=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const u=this._hoveredItem,d=bme(u,o);u&&!d&&xs(n.onLeave,[t,u,this],this),this._hoveredItem=o,o&&!d&&xs(n.onHover,[t,o,this],this)}else o&&xs(n.onClick,[t,o,this],this)}}function wme(e,t,n,o,u){const d=Sme(o,e,t,n),g=Tme(u,o,t.lineHeight);return{itemWidth:d,itemHeight:g}}function Sme(e,t,n,o){let u=e.text;return u&&typeof u!="string"&&(u=u.reduce((d,g)=>d.length>g.length?d:g)),t+n.size/2+o.measureText(u).width}function Tme(e,t,n){let o=e;return typeof t.text!="string"&&(o=o6(t,n)),o}function o6(e,t){const n=e.text?e.text.length:0;return t*n}function Eme(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var Ame={id:"legend",_element:T3,start(e,t,n){const o=e.legend=new T3({ctx:e.ctx,options:n,chart:e});ul.configure(e,o,n),ul.addBox(e,o)},stop(e){ul.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const o=e.legend;ul.configure(e,o,n),o.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const o=t.datasetIndex,u=n.chart;u.isDatasetVisible(o)?(u.hide(o),t.hidden=!0):(u.show(o),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:o,textAlign:u,color:d,useBorderRadius:g,borderRadius:i}}=e.legend.options;return e._getSortedDatasetMetas().map(E=>{const P=E.controller.getStyle(n?0:void 0),I=dl(P.borderWidth);return{text:t[E.index].label,fillStyle:P.backgroundColor,fontColor:d,hidden:!E.visible,lineCap:P.borderCapStyle,lineDash:P.borderDash,lineDashOffset:P.borderDashOffset,lineJoin:P.borderJoinStyle,lineWidth:(I.width+I.height)/4,strokeStyle:P.borderColor,pointStyle:o||P.pointStyle,rotation:P.rotation,textAlign:u||P.textAlign,borderRadius:g&&(i||P.borderRadius),datasetIndex:E.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class fI extends jh{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const o=this.options;if(this.left=0,this.top=0,!o.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const u=ks(o.text)?o.text.length:1;this._padding=dl(o.padding);const d=u*Wo(o.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=d:this.width=d}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:o,bottom:u,right:d,options:g}=this,i=g.align;let E=0,P,I,D;return this.isHorizontal()?(I=al(i,o,d),D=n+t,P=d-o):(g.position==="left"?(I=o+t,D=al(i,u,n),E=Vi*-.5):(I=d-t,D=al(i,n,u),E=Vi*.5),P=u-n),{titleX:I,titleY:D,maxWidth:P,rotation:E}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const o=Wo(n.font),d=o.lineHeight/2+this._padding.top,{titleX:g,titleY:i,maxWidth:E,rotation:P}=this._drawArgs(d);i_(t,n.text,0,0,o,{color:n.color,maxWidth:E,rotation:P,textAlign:iI(n.align),textBaseline:"middle",translation:[g,i]})}}function Cme(e,t){const n=new fI({ctx:e.ctx,options:t,chart:e});ul.configure(e,n,t),ul.addBox(e,n),e.titleBlock=n}var Pme={id:"title",_element:fI,start(e,t,n){Cme(e,n)},stop(e){const t=e.titleBlock;ul.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const o=e.titleBlock;ul.configure(e,o,n),o.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Rb=new WeakMap;var Ime={id:"subtitle",start(e,t,n){const o=new fI({ctx:e.ctx,options:n,chart:e});ul.configure(e,o,n),ul.addBox(e,o),Rb.set(e,o)},stop(e){ul.removeBox(e,Rb.get(e)),Rb.delete(e)},beforeUpdate(e,t,n){const o=Rb.get(e);ul.configure(e,o,n),o.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ex={average(e){if(!e.length)return!1;let t,n,o=new Set,u=0,d=0;for(t=0,n=e.length;t<n;++t){const i=e[t].element;if(i&&i.hasValue()){const E=i.tooltipPosition();o.add(E.x),u+=E.y,++d}}return d===0||o.size===0?!1:{x:[...o].reduce((i,E)=>i+E)/o.size,y:u/d}},nearest(e,t){if(!e.length)return!1;let n=t.x,o=t.y,u=Number.POSITIVE_INFINITY,d,g,i;for(d=0,g=e.length;d<g;++d){const E=e[d].element;if(E&&E.hasValue()){const P=E.getCenterPoint(),I=FA(t,P);I<u&&(u=I,i=E)}}if(i){const E=i.tooltipPosition();n=E.x,o=E.y}return{x:n,y:o}}};function jd(e,t){return t&&(ks(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function Qf(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function Mme(e,t){const{element:n,datasetIndex:o,index:u}=t,d=e.getDatasetMeta(o).controller,{label:g,value:i}=d.getLabelAndValue(u);return{chart:e,label:g,parsed:d.getParsed(u),raw:e.data.datasets[o].data[u],formattedValue:i,dataset:d.getDataset(),dataIndex:u,datasetIndex:o,element:n}}function E3(e,t){const n=e.chart.ctx,{body:o,footer:u,title:d}=e,{boxWidth:g,boxHeight:i}=t,E=Wo(t.bodyFont),P=Wo(t.titleFont),I=Wo(t.footerFont),D=d.length,F=u.length,$=o.length,Z=dl(t.padding);let q=Z.height,X=0,re=o.reduce((ye,ge)=>ye+ge.before.length+ge.lines.length+ge.after.length,0);if(re+=e.beforeBody.length+e.afterBody.length,D&&(q+=D*P.lineHeight+(D-1)*t.titleSpacing+t.titleMarginBottom),re){const ye=t.displayColors?Math.max(i,E.lineHeight):E.lineHeight;q+=$*ye+(re-$)*E.lineHeight+(re-1)*t.bodySpacing}F&&(q+=t.footerMarginTop+F*I.lineHeight+(F-1)*t.footerSpacing);let le=0;const ue=function(ye){X=Math.max(X,n.measureText(ye).width+le)};return n.save(),n.font=P.string,Qi(e.title,ue),n.font=E.string,Qi(e.beforeBody.concat(e.afterBody),ue),le=t.displayColors?g+2+t.boxPadding:0,Qi(o,ye=>{Qi(ye.before,ue),Qi(ye.lines,ue),Qi(ye.after,ue)}),le=0,n.font=I.string,Qi(e.footer,ue),n.restore(),X+=Z.width,{width:X,height:q}}function kme(e,t){const{y:n,height:o}=t;return n<o/2?"top":n>e.height-o/2?"bottom":"center"}function Rme(e,t,n,o){const{x:u,width:d}=o,g=n.caretSize+n.caretPadding;if(e==="left"&&u+d+g>t.width||e==="right"&&u-d-g<0)return!0}function Ome(e,t,n,o){const{x:u,width:d}=n,{width:g,chartArea:{left:i,right:E}}=e;let P="center";return o==="center"?P=u<=(i+E)/2?"left":"right":u<=d/2?P="left":u>=g-d/2&&(P="right"),Rme(P,e,t,n)&&(P="center"),P}function A3(e,t,n){const o=n.yAlign||t.yAlign||kme(e,n);return{xAlign:n.xAlign||t.xAlign||Ome(e,t,n,o),yAlign:o}}function Dme(e,t){let{x:n,width:o}=e;return t==="right"?n-=o:t==="center"&&(n-=o/2),n}function Lme(e,t,n){let{y:o,height:u}=e;return t==="top"?o+=n:t==="bottom"?o-=u+n:o-=u/2,o}function C3(e,t,n,o){const{caretSize:u,caretPadding:d,cornerRadius:g}=e,{xAlign:i,yAlign:E}=n,P=u+d,{topLeft:I,topRight:D,bottomLeft:F,bottomRight:$}=Hg(g);let Z=Dme(t,i);const q=Lme(t,E,P);return E==="center"?i==="left"?Z+=P:i==="right"&&(Z-=P):i==="left"?Z-=Math.max(I,F)+u:i==="right"&&(Z+=Math.max(D,$)+u),{x:la(Z,0,o.width-t.width),y:la(q,0,o.height-t.height)}}function Ob(e,t,n){const o=dl(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-o.right:e.x+o.left}function P3(e){return jd([],Qf(e))}function jme(e,t,n){return Bm(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function I3(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const a6={beforeTitle:Yf,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,o=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(o>0&&t.dataIndex<o)return n[t.dataIndex]}return""},afterTitle:Yf,beforeBody:Yf,beforeLabel:Yf,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return Ei(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Yf,afterBody:Yf,beforeFooter:Yf,footer:Yf,afterFooter:Yf};function Jl(e,t,n,o){const u=e[t].call(n,o);return typeof u>"u"?a6[t].call(n,o):u}class ZA extends jh{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,o=this.options.setContext(this.getContext()),u=o.enabled&&n.options.animation&&o.animations,d=new BV(this.chart,u);return u._cacheable&&(this._cachedAnimations=Object.freeze(d)),d}getContext(){return this.$context||(this.$context=jme(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:o}=n,u=Jl(o,"beforeTitle",this,t),d=Jl(o,"title",this,t),g=Jl(o,"afterTitle",this,t);let i=[];return i=jd(i,Qf(u)),i=jd(i,Qf(d)),i=jd(i,Qf(g)),i}getBeforeBody(t,n){return P3(Jl(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:o}=n,u=[];return Qi(t,d=>{const g={before:[],lines:[],after:[]},i=I3(o,d);jd(g.before,Qf(Jl(i,"beforeLabel",this,d))),jd(g.lines,Jl(i,"label",this,d)),jd(g.after,Qf(Jl(i,"afterLabel",this,d))),u.push(g)}),u}getAfterBody(t,n){return P3(Jl(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:o}=n,u=Jl(o,"beforeFooter",this,t),d=Jl(o,"footer",this,t),g=Jl(o,"afterFooter",this,t);let i=[];return i=jd(i,Qf(u)),i=jd(i,Qf(d)),i=jd(i,Qf(g)),i}_createItems(t){const n=this._active,o=this.chart.data,u=[],d=[],g=[];let i=[],E,P;for(E=0,P=n.length;E<P;++E)i.push(Mme(this.chart,n[E]));return t.filter&&(i=i.filter((I,D,F)=>t.filter(I,D,F,o))),t.itemSort&&(i=i.sort((I,D)=>t.itemSort(I,D,o))),Qi(i,I=>{const D=I3(t.callbacks,I);u.push(Jl(D,"labelColor",this,I)),d.push(Jl(D,"labelPointStyle",this,I)),g.push(Jl(D,"labelTextColor",this,I))}),this.labelColors=u,this.labelPointStyles=d,this.labelTextColors=g,this.dataPoints=i,i}update(t,n){const o=this.options.setContext(this.getContext()),u=this._active;let d,g=[];if(!u.length)this.opacity!==0&&(d={opacity:0});else{const i=ex[o.position].call(this,u,this._eventPosition);g=this._createItems(o),this.title=this.getTitle(g,o),this.beforeBody=this.getBeforeBody(g,o),this.body=this.getBody(g,o),this.afterBody=this.getAfterBody(g,o),this.footer=this.getFooter(g,o);const E=this._size=E3(this,o),P=Object.assign({},i,E),I=A3(this.chart,o,P),D=C3(o,P,I,this.chart);this.xAlign=I.xAlign,this.yAlign=I.yAlign,d={opacity:1,x:D.x,y:D.y,width:E.width,height:E.height,caretX:i.x,caretY:i.y}}this._tooltipItems=g,this.$context=void 0,d&&this._resolveAnimations().update(this,d),t&&o.external&&o.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,o,u){const d=this.getCaretPosition(t,o,u);n.lineTo(d.x1,d.y1),n.lineTo(d.x2,d.y2),n.lineTo(d.x3,d.y3)}getCaretPosition(t,n,o){const{xAlign:u,yAlign:d}=this,{caretSize:g,cornerRadius:i}=o,{topLeft:E,topRight:P,bottomLeft:I,bottomRight:D}=Hg(i),{x:F,y:$}=t,{width:Z,height:q}=n;let X,re,le,ue,ye,ge;return d==="center"?(ye=$+q/2,u==="left"?(X=F,re=X-g,ue=ye+g,ge=ye-g):(X=F+Z,re=X+g,ue=ye-g,ge=ye+g),le=X):(u==="left"?re=F+Math.max(E,I)+g:u==="right"?re=F+Z-Math.max(P,D)-g:re=this.caretX,d==="top"?(ue=$,ye=ue-g,X=re-g,le=re+g):(ue=$+q,ye=ue+g,X=re+g,le=re-g),ge=ue),{x1:X,x2:re,x3:le,y1:ue,y2:ye,y3:ge}}drawTitle(t,n,o){const u=this.title,d=u.length;let g,i,E;if(d){const P=cy(o.rtl,this.x,this.width);for(t.x=Ob(this,o.titleAlign,o),n.textAlign=P.textAlign(o.titleAlign),n.textBaseline="middle",g=Wo(o.titleFont),i=o.titleSpacing,n.fillStyle=o.titleColor,n.font=g.string,E=0;E<d;++E)n.fillText(u[E],P.x(t.x),t.y+g.lineHeight/2),t.y+=g.lineHeight+i,E+1===d&&(t.y+=o.titleMarginBottom-i)}}_drawColorBox(t,n,o,u,d){const g=this.labelColors[o],i=this.labelPointStyles[o],{boxHeight:E,boxWidth:P}=d,I=Wo(d.bodyFont),D=Ob(this,"left",d),F=u.x(D),$=E<I.lineHeight?(I.lineHeight-E)/2:0,Z=n.y+$;if(d.usePointStyle){const q={radius:Math.min(P,E)/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:1},X=u.leftForLtr(F,P)+P/2,re=Z+E/2;t.strokeStyle=d.multiKeyBackground,t.fillStyle=d.multiKeyBackground,UA(t,q,X,re),t.strokeStyle=g.borderColor,t.fillStyle=g.backgroundColor,UA(t,q,X,re)}else{t.lineWidth=Pi(g.borderWidth)?Math.max(...Object.values(g.borderWidth)):g.borderWidth||1,t.strokeStyle=g.borderColor,t.setLineDash(g.borderDash||[]),t.lineDashOffset=g.borderDashOffset||0;const q=u.leftForLtr(F,P),X=u.leftForLtr(u.xPlus(F,1),P-2),re=Hg(g.borderRadius);Object.values(re).some(le=>le!==0)?(t.beginPath(),t.fillStyle=d.multiKeyBackground,Rx(t,{x:q,y:Z,w:P,h:E,radius:re}),t.fill(),t.stroke(),t.fillStyle=g.backgroundColor,t.beginPath(),Rx(t,{x:X,y:Z+1,w:P-2,h:E-2,radius:re}),t.fill()):(t.fillStyle=d.multiKeyBackground,t.fillRect(q,Z,P,E),t.strokeRect(q,Z,P,E),t.fillStyle=g.backgroundColor,t.fillRect(X,Z+1,P-2,E-2))}t.fillStyle=this.labelTextColors[o]}drawBody(t,n,o){const{body:u}=this,{bodySpacing:d,bodyAlign:g,displayColors:i,boxHeight:E,boxWidth:P,boxPadding:I}=o,D=Wo(o.bodyFont);let F=D.lineHeight,$=0;const Z=cy(o.rtl,this.x,this.width),q=function(Ze){n.fillText(Ze,Z.x(t.x+$),t.y+F/2),t.y+=F+d},X=Z.textAlign(g);let re,le,ue,ye,ge,we,Le;for(n.textAlign=g,n.textBaseline="middle",n.font=D.string,t.x=Ob(this,X,o),n.fillStyle=o.bodyColor,Qi(this.beforeBody,q),$=i&&X!=="right"?g==="center"?P/2+I:P+2+I:0,ye=0,we=u.length;ye<we;++ye){for(re=u[ye],le=this.labelTextColors[ye],n.fillStyle=le,Qi(re.before,q),ue=re.lines,i&&ue.length&&(this._drawColorBox(n,t,ye,Z,o),F=Math.max(D.lineHeight,E)),ge=0,Le=ue.length;ge<Le;++ge)q(ue[ge]),F=D.lineHeight;Qi(re.after,q)}$=0,F=D.lineHeight,Qi(this.afterBody,q),t.y-=d}drawFooter(t,n,o){const u=this.footer,d=u.length;let g,i;if(d){const E=cy(o.rtl,this.x,this.width);for(t.x=Ob(this,o.footerAlign,o),t.y+=o.footerMarginTop,n.textAlign=E.textAlign(o.footerAlign),n.textBaseline="middle",g=Wo(o.footerFont),n.fillStyle=o.footerColor,n.font=g.string,i=0;i<d;++i)n.fillText(u[i],E.x(t.x),t.y+g.lineHeight/2),t.y+=g.lineHeight+o.footerSpacing}}drawBackground(t,n,o,u){const{xAlign:d,yAlign:g}=this,{x:i,y:E}=t,{width:P,height:I}=o,{topLeft:D,topRight:F,bottomLeft:$,bottomRight:Z}=Hg(u.cornerRadius);n.fillStyle=u.backgroundColor,n.strokeStyle=u.borderColor,n.lineWidth=u.borderWidth,n.beginPath(),n.moveTo(i+D,E),g==="top"&&this.drawCaret(t,n,o,u),n.lineTo(i+P-F,E),n.quadraticCurveTo(i+P,E,i+P,E+F),g==="center"&&d==="right"&&this.drawCaret(t,n,o,u),n.lineTo(i+P,E+I-Z),n.quadraticCurveTo(i+P,E+I,i+P-Z,E+I),g==="bottom"&&this.drawCaret(t,n,o,u),n.lineTo(i+$,E+I),n.quadraticCurveTo(i,E+I,i,E+I-$),g==="center"&&d==="left"&&this.drawCaret(t,n,o,u),n.lineTo(i,E+D),n.quadraticCurveTo(i,E,i+D,E),n.closePath(),n.fill(),u.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,o=this.$animations,u=o&&o.x,d=o&&o.y;if(u||d){const g=ex[t.position].call(this,this._active,this._eventPosition);if(!g)return;const i=this._size=E3(this,t),E=Object.assign({},g,this._size),P=A3(n,t,E),I=C3(t,E,P,n);(u._to!==I.x||d._to!==I.y)&&(this.xAlign=P.xAlign,this.yAlign=P.yAlign,this.width=i.width,this.height=i.height,this.caretX=g.x,this.caretY=g.y,this._resolveAnimations().update(this,I))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let o=this.opacity;if(!o)return;this._updateAnimationTarget(n);const u={width:this.width,height:this.height},d={x:this.x,y:this.y};o=Math.abs(o)<.001?0:o;const g=dl(n.padding),i=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&i&&(t.save(),t.globalAlpha=o,this.drawBackground(d,t,u,n),DV(t,n.textDirection),d.y+=g.top,this.drawTitle(d,t,n),this.drawBody(d,t,n),this.drawFooter(d,t,n),LV(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const o=this._active,u=t.map(({datasetIndex:i,index:E})=>{const P=this.chart.getDatasetMeta(i);if(!P)throw new Error("Cannot find a dataset at index "+i);return{datasetIndex:i,element:P.data[E],index:E}}),d=!K1(o,u),g=this._positionChanged(u,n);(d||g)&&(this._active=u,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,o=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const u=this.options,d=this._active||[],g=this._getActiveElements(t,d,n,o),i=this._positionChanged(g,t),E=n||!K1(g,d)||i;return E&&(this._active=g,(u.enabled||u.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),E}_getActiveElements(t,n,o,u){const d=this.options;if(t.type==="mouseout")return[];if(!u)return n.filter(i=>this.chart.data.datasets[i.datasetIndex]&&this.chart.getDatasetMeta(i.datasetIndex).controller.getParsed(i.index)!==void 0);const g=this.chart.getElementsAtEventForMode(t,d.mode,d,o);return d.reverse&&g.reverse(),g}_positionChanged(t,n){const{caretX:o,caretY:u,options:d}=this,g=ex[d.position].call(this,t,n);return g!==!1&&(o!==g.x||u!==g.y)}}zn(ZA,"positioners",ex);var zme={id:"tooltip",_element:ZA,positioners:ex,afterInit(e,t,n){n&&(e.tooltip=new ZA({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:a6},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Nme=Object.freeze({__proto__:null,Colors:Ype,Decimation:eme,Filler:xme,Legend:Ame,SubTitle:Ime,Title:Pme,Tooltip:zme});const Fme=(e,t,n,o)=>(typeof t=="string"?(n=e.push(t)-1,o.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function Bme(e,t,n,o){const u=e.indexOf(t);if(u===-1)return Fme(e,t,n,o);const d=e.lastIndexOf(t);return u!==d?n:u}const Ume=(e,t)=>e===null?null:la(Math.round(e),0,t);function M3(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class XA extends h_{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const o=this.getLabels();for(const{index:u,label:d}of n)o[u]===d&&o.splice(u,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(Ei(t))return null;const o=this.getLabels();return n=isFinite(n)&&o[n]===t?n:Bme(o,t,Kr(n,t),this._addedLabels),Ume(n,o.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:o,max:u}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(o=0),n||(u=this.getLabels().length-1)),this.min=o,this.max=u}buildTicks(){const t=this.min,n=this.max,o=this.options.offset,u=[];let d=this.getLabels();d=t===0&&n===d.length-1?d:d.slice(t,n+1),this._valueRange=Math.max(d.length-(o?0:1),1),this._startValue=this.min-(o?.5:0);for(let g=t;g<=n;g++)u.push({value:g});return u}getLabelForValue(t){return M3.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}zn(XA,"id","category"),zn(XA,"defaults",{ticks:{callback:M3}});function Vme(e,t){const n=[],{bounds:u,step:d,min:g,max:i,precision:E,count:P,maxTicks:I,maxDigits:D,includeBounds:F}=e,$=d||1,Z=I-1,{min:q,max:X}=t,re=!Ei(g),le=!Ei(i),ue=!Ei(P),ye=(X-q)/(D+1);let ge=EN((X-q)/Z/$)*$,we,Le,Ze,Ge;if(ge<1e-14&&!re&&!le)return[{value:q},{value:X}];Ge=Math.ceil(X/ge)-Math.floor(q/ge),Ge>Z&&(ge=EN(Ge*ge/Z/$)*$),Ei(E)||(we=Math.pow(10,E),ge=Math.ceil(ge*we)/we),u==="ticks"?(Le=Math.floor(q/ge)*ge,Ze=Math.ceil(X/ge)*ge):(Le=q,Ze=X),re&&le&&d&&Dhe((i-g)/d,ge/1e3)?(Ge=Math.round(Math.min((i-g)/ge,I)),ge=(i-g)/Ge,Le=g,Ze=i):ue?(Le=re?g:Le,Ze=le?i:Ze,Ge=P-1,ge=(Ze-Le)/Ge):(Ge=(Ze-Le)/ge,ix(Ge,Math.round(Ge),ge/1e3)?Ge=Math.round(Ge):Ge=Math.ceil(Ge));const gt=Math.max(AN(ge),AN(Le));we=Math.pow(10,Ei(E)?gt:E),Le=Math.round(Le*we)/we,Ze=Math.round(Ze*we)/we;let lt=0;for(re&&(F&&Le!==g?(n.push({value:g}),Le<g&&lt++,ix(Math.round((Le+lt*ge)*we)/we,g,k3(g,ye,e))&&lt++):Le<g&&lt++);lt<Ge;++lt){const qe=Math.round((Le+lt*ge)*we)/we;if(le&&qe>i)break;n.push({value:qe})}return le&&F&&Ze!==i?n.length&&ix(n[n.length-1].value,i,k3(i,ye,e))?n[n.length-1].value=i:n.push({value:i}):(!le||Ze===i)&&n.push({value:Ze}),n}function k3(e,t,{horizontal:n,minRotation:o}){const u=kh(o),d=(n?Math.sin(u):Math.cos(u))||.001,g=.75*t*(""+e).length;return Math.min(t/d,g)}class iw extends h_{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return Ei(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:o}=this.getUserBounds();let{min:u,max:d}=this;const g=E=>u=n?u:E,i=E=>d=o?d:E;if(t){const E=Vd(u),P=Vd(d);E<0&&P<0?i(0):E>0&&P>0&&g(0)}if(u===d){let E=d===0?1:Math.abs(d*.05);i(d+E),t||g(u-E)}this.min=u,this.max=d}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:o}=t,u;return o?(u=Math.ceil(this.max/o)-Math.floor(this.min/o)+1,u>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${o} would result generating up to ${u} ticks. Limiting to 1000.`),u=1e3)):(u=this.computeTickLimit(),n=n||11),n&&(u=Math.min(n,u)),u}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let o=this.getTickLimit();o=Math.max(2,o);const u={maxTicks:o,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},d=this._range||this,g=Vme(u,d);return t.bounds==="ticks"&&_V(g,this,"value"),t.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){const t=this.ticks;let n=this.min,o=this.max;if(super.configure(),this.options.offset&&t.length){const u=(o-n)/Math.max(t.length-1,1)/2;n-=u,o+=u}this._startValue=n,this._endValue=o,this._valueRange=o-n}getLabelForValue(t){return u0(t,this.chart.options.locale,this.options.ticks.format)}}class YA extends iw{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=to(t)?t:0,this.max=to(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,o=kh(this.options.ticks.minRotation),u=(t?Math.sin(o):Math.cos(o))||.001,d=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,d.lineHeight/u))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}zn(YA,"id","linear"),zn(YA,"defaults",{ticks:{callback:iS.formatters.numeric}});const Dx=e=>Math.floor(xm(e)),Cg=(e,t)=>Math.pow(10,Dx(e)+t);function R3(e){return e/Math.pow(10,Dx(e))===1}function O3(e,t,n){const o=Math.pow(10,n),u=Math.floor(e/o);return Math.ceil(t/o)-u}function $me(e,t){const n=t-e;let o=Dx(n);for(;O3(e,t,o)>10;)o++;for(;O3(e,t,o)<10;)o--;return Math.min(o,Dx(e))}function Hme(e,{min:t,max:n}){t=kc(e.min,t);const o=[],u=Dx(t);let d=$me(t,n),g=d<0?Math.pow(10,Math.abs(d)):1;const i=Math.pow(10,d),E=u>d?Math.pow(10,u):0,P=Math.round((t-E)*g)/g,I=Math.floor((t-E)/i/10)*i*10;let D=Math.floor((P-I)/Math.pow(10,d)),F=kc(e.min,Math.round((E+I+D*Math.pow(10,d))*g)/g);for(;F<n;)o.push({value:F,major:R3(F),significand:D}),D>=10?D=D<15?15:20:D++,D>=20&&(d++,D=2,g=d>=0?1:g),F=Math.round((E+I+D*Math.pow(10,d))*g)/g;const $=kc(e.max,F);return o.push({value:$,major:R3($),significand:D}),o}class KA extends h_{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const o=iw.prototype.parse.apply(this,[t,n]);if(o===0){this._zero=!0;return}return to(o)&&o>0?o:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=to(t)?Math.max(0,t):null,this.max=to(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!to(this._userMin)&&(this.min=t===Cg(this.min,0)?Cg(this.min,-1):Cg(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let o=this.min,u=this.max;const d=i=>o=t?o:i,g=i=>u=n?u:i;o===u&&(o<=0?(d(1),g(10)):(d(Cg(o,-1)),g(Cg(u,1)))),o<=0&&d(Cg(u,-1)),u<=0&&g(Cg(o,1)),this.min=o,this.max=u}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},o=Hme(n,this);return t.bounds==="ticks"&&_V(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}getLabelForValue(t){return t===void 0?"0":u0(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=xm(t),this._valueRange=xm(this.max)-xm(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(xm(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}zn(KA,"id","logarithmic"),zn(KA,"defaults",{ticks:{callback:iS.formatters.logarithmic,major:{enabled:!0}}});function JA(e){const t=e.ticks;if(t.display&&e.display){const n=dl(t.backdropPadding);return Kr(t.font&&t.font.size,Os.font.size)+n.height}return 0}function Gme(e,t,n){return n=ks(n)?n:[n],{w:Khe(e,t.string,n),h:n.length*t.lineHeight}}function D3(e,t,n,o,u){return e===o||e===u?{start:t-n/2,end:t+n/2}:e<o||e>u?{start:t-n,end:t}:{start:t,end:t+n}}function Wme(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),o=[],u=[],d=e._pointLabels.length,g=e.options.pointLabels,i=g.centerPointLabels?Vi/d:0;for(let E=0;E<d;E++){const P=g.setContext(e.getPointLabelContext(E));u[E]=P.padding;const I=e.getPointPosition(E,e.drawingArea+u[E],i),D=Wo(P.font),F=Gme(e.ctx,D,e._pointLabels[E]);o[E]=F;const $=ll(e.getIndexAngle(E)+i),Z=Math.round(nI($)),q=D3(Z,I.x,F.w,0,180),X=D3(Z,I.y,F.h,90,270);qme(n,t,$,q,X)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=Yme(e,o,u)}function qme(e,t,n,o,u){const d=Math.abs(Math.sin(n)),g=Math.abs(Math.cos(n));let i=0,E=0;o.start<t.l?(i=(t.l-o.start)/d,e.l=Math.min(e.l,t.l-i)):o.end>t.r&&(i=(o.end-t.r)/d,e.r=Math.max(e.r,t.r+i)),u.start<t.t?(E=(t.t-u.start)/g,e.t=Math.min(e.t,t.t-E)):u.end>t.b&&(E=(u.end-t.b)/g,e.b=Math.max(e.b,t.b+E))}function Zme(e,t,n){const o=e.drawingArea,{extra:u,additionalAngle:d,padding:g,size:i}=n,E=e.getPointPosition(t,o+u+g,d),P=Math.round(nI(ll(E.angle+mo))),I=Qme(E.y,i.h,P),D=Kme(P),F=Jme(E.x,i.w,D);return{visible:!0,x:E.x,y:I,textAlign:D,left:F,top:I,right:F+i.w,bottom:I+i.h}}function Xme(e,t){if(!t)return!0;const{left:n,top:o,right:u,bottom:d}=e;return!(ap({x:n,y:o},t)||ap({x:n,y:d},t)||ap({x:u,y:o},t)||ap({x:u,y:d},t))}function Yme(e,t,n){const o=[],u=e._pointLabels.length,d=e.options,{centerPointLabels:g,display:i}=d.pointLabels,E={extra:JA(d)/2,additionalAngle:g?Vi/u:0};let P;for(let I=0;I<u;I++){E.padding=n[I],E.size=t[I];const D=Zme(e,I,E);o.push(D),i==="auto"&&(D.visible=Xme(D,P),D.visible&&(P=D))}return o}function Kme(e){return e===0||e===180?"center":e<180?"left":"right"}function Jme(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function Qme(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function ege(e,t,n){const{left:o,top:u,right:d,bottom:g}=n,{backdropColor:i}=t;if(!Ei(i)){const E=Hg(t.borderRadius),P=dl(t.backdropPadding);e.fillStyle=i;const I=o-P.left,D=u-P.top,F=d-o+P.width,$=g-u+P.height;Object.values(E).some(Z=>Z!==0)?(e.beginPath(),Rx(e,{x:I,y:D,w:F,h:$,radius:E}),e.fill()):e.fillRect(I,D,F,$)}}function tge(e,t){const{ctx:n,options:{pointLabels:o}}=e;for(let u=t-1;u>=0;u--){const d=e._pointLabelItems[u];if(!d.visible)continue;const g=o.setContext(e.getPointLabelContext(u));ege(n,g,d);const i=Wo(g.font),{x:E,y:P,textAlign:I}=d;i_(n,e._pointLabels[u],E,P+i.lineHeight/2,i,{color:g.color,textAlign:I,textBaseline:"middle"})}}function l6(e,t,n,o){const{ctx:u}=e;if(n)u.arc(e.xCenter,e.yCenter,t,0,Ts);else{let d=e.getPointPosition(0,t);u.moveTo(d.x,d.y);for(let g=1;g<o;g++)d=e.getPointPosition(g,t),u.lineTo(d.x,d.y)}}function nge(e,t,n,o,u){const d=e.ctx,g=t.circular,{color:i,lineWidth:E}=t;!g&&!o||!i||!E||n<0||(d.save(),d.strokeStyle=i,d.lineWidth=E,d.setLineDash(u.dash||[]),d.lineDashOffset=u.dashOffset,d.beginPath(),l6(e,n,g,o),d.closePath(),d.stroke(),d.restore())}function rge(e,t,n){return Bm(e,{label:n,index:t,type:"pointLabel"})}class tx extends iw{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=dl(JA(this.options)/2),n=this.width=this.maxWidth-t.width,o=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+o/2+t.top),this.drawingArea=Math.floor(Math.min(n,o)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=to(t)&&!isNaN(t)?t:0,this.max=to(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/JA(this.options))}generateTickLabels(t){iw.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,o)=>{const u=xs(this.options.pointLabels.callback,[n,o],this);return u||u===0?u:""}).filter((n,o)=>this.chart.getDataVisibility(o))}fit(){const t=this.options;t.display&&t.pointLabels.display?Wme(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,o,u){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((o-u)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,o,u))}getIndexAngle(t){const n=Ts/(this._pointLabels.length||1),o=this.options.startAngle||0;return ll(t*n+kh(o))}getDistanceFromCenterForValue(t){if(Ei(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(Ei(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const o=n[t];return rge(this.getContext(),t,o)}}getPointPosition(t,n,o=0){const u=this.getIndexAngle(t)-mo+o;return{x:Math.cos(u)*n+this.xCenter,y:Math.sin(u)*n+this.yCenter,angle:u}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:o,right:u,bottom:d}=this._pointLabelItems[t];return{left:n,top:o,right:u,bottom:d}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const o=this.ctx;o.save(),o.beginPath(),l6(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),o.closePath(),o.fillStyle=t,o.fill(),o.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:o,grid:u,border:d}=n,g=this._pointLabels.length;let i,E,P;if(n.pointLabels.display&&tge(this,g),u.display&&this.ticks.forEach((I,D)=>{if(D!==0||D===0&&this.min<0){E=this.getDistanceFromCenterForValue(I.value);const F=this.getContext(D),$=u.setContext(F),Z=d.setContext(F);nge(this,$,E,g,Z)}}),o.display){for(t.save(),i=g-1;i>=0;i--){const I=o.setContext(this.getPointLabelContext(i)),{color:D,lineWidth:F}=I;!F||!D||(t.lineWidth=F,t.strokeStyle=D,t.setLineDash(I.borderDash),t.lineDashOffset=I.borderDashOffset,E=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),P=this.getPointPosition(i,E),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(P.x,P.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,o=n.ticks;if(!o.display)return;const u=this.getIndexAngle(0);let d,g;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(u),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((i,E)=>{if(E===0&&this.min>=0&&!n.reverse)return;const P=o.setContext(this.getContext(E)),I=Wo(P.font);if(d=this.getDistanceFromCenterForValue(this.ticks[E].value),P.showLabelBackdrop){t.font=I.string,g=t.measureText(i.label).width,t.fillStyle=P.backdropColor;const D=dl(P.backdropPadding);t.fillRect(-g/2-D.left,-d-I.size/2-D.top,g+D.width,I.size+D.height)}i_(t,i.label,0,-d,I,{color:P.color,strokeColor:P.textStrokeColor,strokeWidth:P.textStrokeWidth})}),t.restore()}drawTitle(){}}zn(tx,"id","radialLinear"),zn(tx,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:iS.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),zn(tx,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),zn(tx,"descriptors",{angleLines:{_fallback:"grid"}});const hS={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ec=Object.keys(hS);function L3(e,t){return e-t}function j3(e,t){if(Ei(t))return null;const n=e._adapter,{parser:o,round:u,isoWeekday:d}=e._parseOpts;let g=t;return typeof o=="function"&&(g=o(g)),to(g)||(g=typeof o=="string"?n.parse(g,o):n.parse(g)),g===null?null:(u&&(g=u==="week"&&(by(d)||d===!0)?n.startOf(g,"isoWeek",d):n.startOf(g,u)),+g)}function z3(e,t,n,o){const u=ec.length;for(let d=ec.indexOf(e);d<u-1;++d){const g=hS[ec[d]],i=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((n-t)/(i*g.size))<=o)return ec[d]}return ec[u-1]}function ige(e,t,n,o,u){for(let d=ec.length-1;d>=ec.indexOf(n);d--){const g=ec[d];if(hS[g].common&&e._adapter.diff(u,o,g)>=t-1)return g}return ec[n?ec.indexOf(n):0]}function sge(e){for(let t=ec.indexOf(e)+1,n=ec.length;t<n;++t)if(hS[ec[t]].common)return ec[t]}function N3(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:o,hi:u}=rI(n,t),d=n[o]>=t?n[o]:n[u];e[d]=!0}}function oge(e,t,n,o){const u=e._adapter,d=+u.startOf(t[0].value,o),g=t[t.length-1].value;let i,E;for(i=d;i<=g;i=+u.add(i,1,o))E=n[i],E>=0&&(t[E].major=!0);return t}function F3(e,t,n){const o=[],u={},d=t.length;let g,i;for(g=0;g<d;++g)i=t[g],u[i]=g,o.push({value:i,major:!1});return d===0||!n?o:oge(e,o,u,n)}class Lx extends h_{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const o=t.time||(t.time={}),u=this._adapter=new pfe._date(t.adapters.date);u.init(n),rx(o.displayFormats,u.formats()),this._parseOpts={parser:o.parser,round:o.round,isoWeekday:o.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:j3(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,o=t.time.unit||"day";let{min:u,max:d,minDefined:g,maxDefined:i}=this.getUserBounds();function E(P){!g&&!isNaN(P.min)&&(u=Math.min(u,P.min)),!i&&!isNaN(P.max)&&(d=Math.max(d,P.max))}(!g||!i)&&(E(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&E(this.getMinMax(!1))),u=to(u)&&!isNaN(u)?u:+n.startOf(Date.now(),o),d=to(d)&&!isNaN(d)?d:+n.endOf(Date.now(),o)+1,this.min=Math.min(u,d-1),this.max=Math.max(u+1,d)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],o=t[t.length-1]),{min:n,max:o}}buildTicks(){const t=this.options,n=t.time,o=t.ticks,u=o.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&u.length&&(this.min=this._userMin||u[0],this.max=this._userMax||u[u.length-1]);const d=this.min,g=this.max,i=Nhe(u,d,g);return this._unit=n.unit||(o.autoSkip?z3(n.minUnit,this.min,this.max,this._getLabelCapacity(d)):ige(this,i.length,n.minUnit,this.min,this.max)),this._majorUnit=!o.major.enabled||this._unit==="year"?void 0:sge(this._unit),this.initOffsets(u),t.reverse&&i.reverse(),F3(this,i,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,o=0,u,d;this.options.offset&&t.length&&(u=this.getDecimalForValue(t[0]),t.length===1?n=1-u:n=(this.getDecimalForValue(t[1])-u)/2,d=this.getDecimalForValue(t[t.length-1]),t.length===1?o=d:o=(d-this.getDecimalForValue(t[t.length-2]))/2);const g=t.length<3?.5:.25;n=la(n,0,g),o=la(o,0,g),this._offsets={start:n,end:o,factor:1/(n+1+o)}}_generate(){const t=this._adapter,n=this.min,o=this.max,u=this.options,d=u.time,g=d.unit||z3(d.minUnit,n,o,this._getLabelCapacity(n)),i=Kr(u.ticks.stepSize,1),E=g==="week"?d.isoWeekday:!1,P=by(E)||E===!0,I={};let D=n,F,$;if(P&&(D=+t.startOf(D,"isoWeek",E)),D=+t.startOf(D,P?"day":g),t.diff(o,n,g)>1e5*i)throw new Error(n+" and "+o+" are too far apart with stepSize of "+i+" "+g);const Z=u.ticks.source==="data"&&this.getDataTimestamps();for(F=D,$=0;F<o;F=+t.add(F,i,g),$++)N3(I,F,Z);return(F===o||u.bounds==="ticks"||$===1)&&N3(I,F,Z),Object.keys(I).sort(L3).map(q=>+q)}getLabelForValue(t){const n=this._adapter,o=this.options.time;return o.tooltipFormat?n.format(t,o.tooltipFormat):n.format(t,o.displayFormats.datetime)}format(t,n){const u=this.options.time.displayFormats,d=this._unit,g=n||u[d];return this._adapter.format(t,g)}_tickFormatFunction(t,n,o,u){const d=this.options,g=d.ticks.callback;if(g)return xs(g,[t,n,o],this);const i=d.time.displayFormats,E=this._unit,P=this._majorUnit,I=E&&i[E],D=P&&i[P],F=o[n],$=P&&D&&F&&F.major;return this._adapter.format(t,u||($?D:I))}generateTickLabels(t){let n,o,u;for(n=0,o=t.length;n<o;++n)u=t[n],u.label=this._tickFormatFunction(u.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,o=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+o)*n.factor)}getValueForPixel(t){const n=this._offsets,o=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+o*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,o=this.ctx.measureText(t).width,u=kh(this.isHorizontal()?n.maxRotation:n.minRotation),d=Math.cos(u),g=Math.sin(u),i=this._resolveTickFontOptions(0).size;return{w:o*d+i*g,h:o*g+i*d}}_getLabelCapacity(t){const n=this.options.time,o=n.displayFormats,u=o[n.unit]||o.millisecond,d=this._tickFormatFunction(t,0,F3(this,[t],this._majorUnit),u),g=this._getLabelSize(d),i=Math.floor(this.isHorizontal()?this.width/g.w:this.height/g.h)-1;return i>0?i:1}getDataTimestamps(){let t=this._cache.data||[],n,o;if(t.length)return t;const u=this.getMatchingVisibleMetas();if(this._normalized&&u.length)return this._cache.data=u[0].controller.getAllParsedValues(this);for(n=0,o=u.length;n<o;++n)t=t.concat(u[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,o;if(t.length)return t;const u=this.getLabels();for(n=0,o=u.length;n<o;++n)t.push(j3(this,u[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return xV(t.sort(L3))}}zn(Lx,"id","time"),zn(Lx,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Db(e,t,n){let o=0,u=e.length-1,d,g,i,E;n?(t>=e[o].pos&&t<=e[u].pos&&({lo:o,hi:u}=op(e,"pos",t)),{pos:d,time:i}=e[o],{pos:g,time:E}=e[u]):(t>=e[o].time&&t<=e[u].time&&({lo:o,hi:u}=op(e,"time",t)),{time:d,pos:i}=e[o],{time:g,pos:E}=e[u]);const P=g-d;return P?i+(E-i)*(t-d)/P:i}class QA extends Lx{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=Db(n,this.min),this._tableRange=Db(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:o}=this,u=[],d=[];let g,i,E,P,I;for(g=0,i=t.length;g<i;++g)P=t[g],P>=n&&P<=o&&u.push(P);if(u.length<2)return[{time:n,pos:0},{time:o,pos:1}];for(g=0,i=u.length;g<i;++g)I=u[g+1],E=u[g-1],P=u[g],Math.round((I+E)/2)!==P&&d.push({time:P,pos:g/(i-1)});return d}_generate(){const t=this.min,n=this.max;let o=super.getDataTimestamps();return(!o.includes(t)||!o.length)&&o.splice(0,0,t),(!o.includes(n)||o.length===1)&&o.push(n),o.sort((u,d)=>u-d)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),o=this.getLabelTimestamps();return n.length&&o.length?t=this.normalize(n.concat(o)):t=n.length?n:o,t=this._cache.all=t,t}getDecimalForValue(t){return(Db(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,o=this.getDecimalForPixel(t)/n.factor-n.end;return Db(this._table,o*this._tableRange+this._minPos,!0)}}zn(QA,"id","timeseries"),zn(QA,"defaults",Lx.defaults);var age=Object.freeze({__proto__:null,CategoryScale:XA,LinearScale:YA,LogarithmicScale:KA,RadialLinearScale:tx,TimeScale:Lx,TimeSeriesScale:QA});const lge=[ffe,$pe,Nme,age],c6="label";function B3(e,t){typeof e=="function"?e(t):e&&(e.current=t)}function cge(e,t){const n=e.options;n&&t&&Object.assign(n,t)}function u6(e,t){e.labels=t}function h6(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c6;const o=[];e.datasets=t.map(u=>{const d=e.datasets.find(g=>g[n]===u[n]);return!d||!u.data||o.includes(d)?{...u}:(o.push(d),Object.assign(d,u),d)})}function uge(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c6;const n={labels:[],datasets:[]};return u6(n,e.labels),h6(n,e.datasets,t),n}function hge(e,t){const{height:n=150,width:o=300,redraw:u=!1,datasetIdKey:d,type:g,data:i,options:E,plugins:P=[],fallbackContent:I,updateMode:D,...F}=e,$=te.useRef(null),Z=te.useRef(null),q=()=>{$.current&&(Z.current=new cS($.current,{type:g,data:uge(i,d),options:E&&{...E},plugins:P}),B3(t,Z.current))},X=()=>{B3(t,null),Z.current&&(Z.current.destroy(),Z.current=null)};return te.useEffect(()=>{!u&&Z.current&&E&&cge(Z.current,E)},[u,E]),te.useEffect(()=>{!u&&Z.current&&u6(Z.current.config.data,i.labels)},[u,i.labels]),te.useEffect(()=>{!u&&Z.current&&i.datasets&&h6(Z.current.config.data,i.datasets,d)},[u,i.datasets]),te.useEffect(()=>{Z.current&&(u?(X(),setTimeout(q)):Z.current.update(D))},[u,E,i.labels,i.datasets,D]),te.useEffect(()=>{Z.current&&(X(),setTimeout(q))},[g]),te.useEffect(()=>(q(),()=>X()),[]),sw.createElement("canvas",{ref:$,role:"img",height:n,width:o,...F},I)}const dge=te.forwardRef(hge);function d6(e,t){return cS.register(t),te.forwardRef((n,o)=>sw.createElement(dge,{...n,ref:o,type:e}))}const Om=d6("line",lx),Ty=d6("bar",ax);cS.register(...lge);const ry={primary:{main:"#3B82F6",fill:"rgba(59, 130, 246, 0.15)"},baseline:{main:"#6B7280"},rainfall:{main:"#0EA5E9"},temp:{main:"#F59E0B",fill:"rgba(245, 158, 11, 0.15)"}},fge=({zone:e})=>{const[t,n]=te.useState(null),[o,u]=te.useState(null),[d,g]=te.useState(!1),[i,E]=te.useState(null),[P,I]=te.useState("gdd");te.useEffect(()=>{if(!(e!=null&&e.slug)){n(null),u(null);return}(async()=>{try{g(!0),E(null);const[ge,we]=await Promise.all([Wue(e.slug,{recent_days:30}),que(e.slug)]);n(ge),u(we)}catch(ge){console.error("Error loading current season:",ge),E("Failed to load current season data")}finally{g(!1)}})()},[e==null?void 0:e.slug]);const D=({value:ye,inverted:ge=!1})=>ye==null||Math.abs(ye)<.5?b.jsx(fF,{size:16,className:"trend-icon neutral"}):(ge?ye<0:ye>0)?b.jsx(Am,{size:16,className:"trend-icon positive"}):b.jsx(mF,{size:16,className:"trend-icon negative"}),F=te.useMemo(()=>{if(!(o!=null&&o.daily_data))return null;const ye=o.daily_data;return{labels:ye.map(ge=>ym(ge.date)),datasets:[{label:"Actual GDD0",data:ye.map(ge=>ge.gdd_actual),borderColor:ry.primary.main,backgroundColor:ry.primary.fill,fill:!0,tension:.3,pointRadius:0,pointHoverRadius:4},{label:"Baseline GDD0 (1986-2005)",data:ye.map(ge=>ge.gdd_baseline),borderColor:ry.baseline.main,borderDash:[5,5],backgroundColor:"transparent",fill:!1,tension:.3,pointRadius:0}]}},[o]),$=te.useMemo(()=>{var ge;if(!((ge=t==null?void 0:t.chart_data)!=null&&ge.daily))return null;const ye=t.chart_data.daily;return{labels:ye.map(we=>ym(we.date)),datasets:[{label:"Max Temp",data:ye.map(we=>we.temp_max),borderColor:"#EF4444",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!1,tension:.3,pointRadius:2},{label:"Mean Temp",data:ye.map(we=>we.temp_mean),borderColor:ry.temp.main,backgroundColor:ry.temp.fill,fill:!0,tension:.3,pointRadius:2},{label:"Min Temp",data:ye.map(we=>we.temp_min),borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!1,tension:.3,pointRadius:2}]}},[t]),Z=te.useMemo(()=>{var ge;if(!((ge=t==null?void 0:t.chart_data)!=null&&ge.daily))return null;const ye=t.chart_data.daily;return{labels:ye.map(we=>ym(we.date)),datasets:[{label:"Rainfall (mm)",data:ye.map(we=>we.rainfall||0),backgroundColor:ry.rainfall.main,borderRadius:2}]}},[t]),q={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15}},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:P==="gdd",title:{display:!0,text:P==="gdd"?"Cumulative GDD (Cdays)":"Temperature (C)"}},x:{ticks:{maxTicksLimit:10}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},X={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Rainfall (mm)"}},x:{ticks:{maxTicksLimit:10}}}};if(!e)return b.jsx("div",{className:"current-season-explorer",children:b.jsxs("div",{className:"no-zone-message",children:[b.jsx(tq,{size:48}),b.jsx("h3",{children:"Select a Climate Zone"}),b.jsx("p",{children:"Choose a wine region above to view current season climate data"})]})});if(d)return b.jsx("div",{className:"current-season-explorer",children:b.jsxs("div",{className:"loading-state",children:[b.jsx(sc,{size:32,className:"spinning"}),b.jsx("p",{children:"Loading current season data..."})]})});if(i)return b.jsx("div",{className:"current-season-explorer",children:b.jsxs("div",{className:"error-state",children:[b.jsx(Sm,{size:32}),b.jsx("p",{children:i})]})});if(!t)return b.jsx("div",{className:"current-season-explorer",children:b.jsxs("div",{className:"no-data-message",children:[b.jsx(hp,{size:48}),b.jsx("h3",{children:"No Current Season Data"}),b.jsxs("p",{children:["Climate data for ",e.name," is not yet available for this season"]})]})});const{season:re}=t,le=re.gdd_vs_baseline,ue=re.rainfall_vs_baseline;return b.jsxs("div",{className:"current-season-explorer",children:[b.jsxs("div",{className:"season-header",children:[b.jsxs("div",{className:"season-title",children:[b.jsx("h3",{children:e.name}),b.jsxs("span",{className:"season-label",children:[re.label," Season"]})]}),b.jsx("div",{className:"season-meta",children:b.jsxs("span",{className:"data-date",children:[b.jsx(Wg,{size:14}),"Data to ",Y1(re.latest_data_date)]})})]}),b.jsxs("div",{className:"summary-cards",children:[b.jsxs("div",{className:"summary-card gdd-card",children:[b.jsx("div",{className:"card-icon",children:b.jsx(Xg,{size:24})}),b.jsxs("div",{className:"card-content",children:[b.jsx("span",{className:"card-label",children:"Growing Degree Days Base-0"}),b.jsx("span",{className:"card-value",children:X1(re.gdd_total)}),le&&b.jsxs("div",{className:"card-comparison",children:[b.jsx(D,{value:Number(le.difference_pct)}),b.jsxs("span",{className:"comparison-value",style:{color:_N(le.status)},children:[gN(le.difference_pct)," vs baseline"]})]})]}),(le==null?void 0:le.status)&&b.jsx("div",{className:`status-badge ${le.status}`,children:le.status==="ahead"?"Ahead":le.status==="behind"?"Behind":"Normal"})]}),b.jsxs("div",{className:"summary-card rainfall-card",children:[b.jsx("div",{className:"card-icon",children:b.jsx(Zg,{size:24})}),b.jsxs("div",{className:"card-content",children:[b.jsx("span",{className:"card-label",children:"Total Rainfall"}),b.jsx("span",{className:"card-value",children:mN(re.rainfall_total)}),ue&&b.jsxs("div",{className:"card-comparison",children:[b.jsx(D,{value:Number(ue.difference_pct),inverted:!0}),b.jsxs("span",{className:"comparison-value",style:{color:_N(ue.status==="ahead"?"behind":ue.status==="behind"?"ahead":"normal")},children:[gN(ue.difference_pct)," vs baseline"]})]})]})]}),b.jsxs("div",{className:"summary-card temp-card",children:[b.jsx("div",{className:"card-icon",children:b.jsx(fy,{size:24})}),b.jsxs("div",{className:"card-content",children:[b.jsx("span",{className:"card-label",children:"Season Avg Temp"}),b.jsx("span",{className:"card-value",children:ey(re.temp_mean_avg)}),b.jsxs("div",{className:"temp-range",children:[b.jsxs("span",{className:"temp-min",children:["Min: ",ey(re.temp_min_avg)]}),b.jsxs("span",{className:"temp-max",children:["Max: ",ey(re.temp_max_avg)]})]})]})]})]}),b.jsxs("div",{className:"chart-section",children:[b.jsxs("div",{className:"chart-controls",children:[b.jsxs("button",{className:`chart-tab ${P==="gdd"?"active":""}`,onClick:()=>I("gdd"),children:[b.jsx(Xg,{size:16}),"GDD Progress"]}),b.jsxs("button",{className:`chart-tab ${P==="temperature"?"active":""}`,onClick:()=>I("temperature"),children:[b.jsx(fy,{size:16}),"Temperature"]}),b.jsxs("button",{className:`chart-tab ${P==="rainfall"?"active":""}`,onClick:()=>I("rainfall"),children:[b.jsx(Zg,{size:16}),"Rainfall"]})]}),b.jsxs("div",{className:"chart-container",children:[P==="gdd"&&F&&b.jsx(Om,{data:F,options:q}),P==="temperature"&&$&&b.jsx(Om,{data:$,options:q}),P==="rainfall"&&Z&&b.jsx(Ty,{data:Z,options:X})]})]}),b.jsxs("div",{className:"recent-days-section",children:[b.jsx("h4",{children:"Recent Daily Data"}),b.jsx("div",{className:"recent-days-table-wrapper",children:b.jsxs("table",{className:"recent-days-table",children:[b.jsx("thead",{children:b.jsxs("tr",{children:[b.jsx("th",{children:"Date"}),b.jsx("th",{children:"Temp Min"}),b.jsx("th",{children:"Temp Max"}),b.jsx("th",{children:"Temp Mean"}),b.jsx("th",{children:"Rainfall"}),b.jsx("th",{children:"GDD"}),b.jsx("th",{children:"Cumulative GDD"})]})}),b.jsx("tbody",{children:t.recent_days.slice(0,10).map((ye,ge)=>b.jsxs("tr",{children:[b.jsx("td",{children:ym(ye.date)}),b.jsx("td",{children:ey(ye.temp_min)}),b.jsx("td",{children:ey(ye.temp_max)}),b.jsx("td",{children:ey(ye.temp_mean)}),b.jsx("td",{children:mN(ye.rainfall_mm)}),b.jsx("td",{children:ye.gdd_daily?Number(ye.gdd_daily).toFixed(1):"-"}),b.jsx("td",{children:X1(ye.gdd_cumulative)})]},ge))})]})})]})]})},Lb={early:"#22C55E",mid:"#EAB308",late:"#8B5CF6",ready:"#EF4444"},pge=({zone:e})=>{var re;const[t,n]=te.useState(null),[o,u]=te.useState([]),[d,g]=te.useState(!1),[i,E]=te.useState(null),[P,I]=te.useState(null),[D,F]=te.useState(["PN","CH","SB"]);te.useEffect(()=>{(async()=>{try{const ue=await Zue();u(ue.varieties||[])}catch(ue){console.error("Error loading varieties:",ue)}})()},[]),te.useEffect(()=>{if(!(e!=null&&e.slug)){n(null);return}(async()=>{var ue;try{g(!0),E(null);const ye=await Xue(e.slug,{varieties:D.join(",")});n(ye),((ue=ye.varieties)==null?void 0:ue.length)>0&&I(ye.varieties[0].variety_code)}catch(ye){console.error("Error loading phenology:",ye),E("Failed to load phenology data")}finally{g(!1)}})()},[e==null?void 0:e.slug,D]);const $=le=>fN[le]||fN.unknown,Z=le=>le<30?Lb.early:le<60?Lb.mid:le<90?Lb.late:Lb.ready,q=le=>{I(P===le?null:le)},X=le=>{D.includes(le)?D.length>1&&F(D.filter(ue=>ue!==le)):F([...D,le])};return e?d?b.jsx("div",{className:"phenology-explorer",children:b.jsxs("div",{className:"loading-state",children:[b.jsx(sc,{size:32,className:"spinning"}),b.jsx("p",{children:"Loading phenology data..."})]})}):i?b.jsx("div",{className:"phenology-explorer",children:b.jsxs("div",{className:"error-state",children:[b.jsx(Sm,{size:32}),b.jsx("p",{children:i})]})}):!t||!((re=t.varieties)!=null&&re.length)?b.jsx("div",{className:"phenology-explorer",children:b.jsxs("div",{className:"no-data-message",children:[b.jsx(v7,{size:48}),b.jsx("h3",{children:"No Phenology Data"}),b.jsxs("p",{children:["Phenology estimates for ",e.name," are not yet available"]})]})}):b.jsxs("div",{className:"phenology-explorer",children:[b.jsxs("div",{className:"phenology-header",children:[b.jsxs("div",{className:"header-title",children:[b.jsx("h3",{children:e.name}),b.jsxs("span",{className:"vintage-label",children:[t.vintage_year-1,"/",String(t.vintage_year).slice(2)," Season"]})]}),b.jsx("div",{className:"header-meta",children:b.jsxs("span",{className:"estimate-date",children:[b.jsx(Wg,{size:14}),"Estimated ",Y1(t.estimate_date)]})})]}),o.length>0&&b.jsxs("div",{className:"variety-filter",children:[b.jsx("span",{className:"filter-label",children:"Varieties:"}),b.jsx("div",{className:"variety-chips",children:o.slice(0,8).map(le=>b.jsx("button",{className:`variety-chip ${D.includes(le.variety_code)?"selected":""}`,onClick:()=>X(le.variety_code),children:le.variety_name},le.variety_code))})]}),b.jsx("div",{className:"variety-cards",children:t.varieties.map(le=>{var Le,Ze,Ge,gt,lt;$(le.current_stage);const ue=P===le.variety_code,ye=Number(le.season_progress_pct)||0,ge=(Le=le.stages)==null?void 0:Le.find(qe=>qe.stage_name==="Flowering");(Ze=le.stages)==null||Ze.find(qe=>qe.stage_name==="Vraison");const we=(Ge=le.stages)==null?void 0:Ge.find(qe=>qe.stage_name.includes("200g/L"));return b.jsxs("div",{className:`variety-card ${ue?"expanded":""}`,children:[b.jsxs("div",{className:"variety-card-header",onClick:()=>q(le.variety_code),children:[b.jsxs("div",{className:"variety-info",children:[b.jsx("span",{className:"variety-name",children:le.variety_name}),b.jsx("span",{className:"variety-code",children:le.variety_code})]}),b.jsxs("div",{className:"variety-gdd",children:[b.jsx(Xg,{size:16}),b.jsx("span",{children:X1(le.gdd_accumulated)})]}),b.jsx("div",{className:"expand-icon",children:ue?b.jsx(Iy,{size:20}):b.jsx(Fd,{size:20})})]}),b.jsxs("div",{className:"progress-bar-container",children:[b.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,ye)}%`,backgroundColor:Z(ye)}}),b.jsxs("span",{className:"progress-label",children:[ye.toFixed(0),"% to harvest"]})]}),b.jsxs("div",{className:"key-dates-summary",children:[ge&&b.jsxs("div",{className:`date-chip ${ge.is_actual?"actual":""}`,children:[b.jsx("span",{className:"date-label",children:"Flowering"}),b.jsxs("span",{className:"date-value",children:[ge.is_actual?" ":"",ym(ge.predicted_date)]})]}),we&&b.jsxs("div",{className:"date-chip harvest",children:[b.jsx("span",{className:"date-label",children:"Harvest"}),b.jsx("span",{className:"date-value",children:ym(we.predicted_date)}),we.days_from_now&&we.days_from_now>0&&b.jsxs("span",{className:"days-away",children:[we.days_from_now,"d"]})]})]}),ue&&b.jsxs("div",{className:"variety-card-expanded",children:[b.jsxs("div",{className:"stage-timeline",children:[b.jsx("h4",{children:"Phenology Timeline"}),b.jsx("div",{className:"timeline",children:(gt=le.stages)==null?void 0:gt.map((qe,en)=>{const Jt=qe.is_actual||qe.predicted_date&&new Date(qe.predicted_date)<new Date,Nt=qe.stage_name.toLowerCase().includes(le.current_stage);return b.jsxs("div",{className:`timeline-item ${Jt?"past":""} ${Nt?"current":""}`,children:[b.jsx("div",{className:"timeline-marker",children:Jt?b.jsx(fO,{size:18,className:"marker-icon completed"}):b.jsx(pO,{size:18,className:"marker-icon pending"})}),b.jsxs("div",{className:"timeline-content",children:[b.jsxs("div",{className:"timeline-header",children:[b.jsx("span",{className:"stage-name",children:qe.stage_name}),qe.gdd_threshold&&b.jsx("span",{className:"gdd-threshold",children:X1(qe.gdd_threshold)})]}),b.jsx("div",{className:"timeline-date",children:qe.predicted_date?b.jsxs(b.Fragment,{children:[b.jsx(hp,{size:14}),b.jsxs("span",{children:[Y1(qe.predicted_date),qe.is_actual&&b.jsx("em",{children:" (actual)"})]}),qe.days_from_now&&qe.days_from_now>0&&b.jsxs("span",{className:"days-from-now",children:["(",qe.days_from_now," days away)"]})]}):b.jsx("span",{className:"no-date",children:"Date TBD"})}),qe.days_vs_baseline&&b.jsxs("div",{className:"baseline-diff",children:[qe.days_vs_baseline>0?"+":"",qe.days_vs_baseline," days vs baseline"]})]})]},en)})})]}),b.jsxs("div",{className:"harvest-windows",children:[b.jsx("h4",{children:"Harvest Windows by Sugar Level"}),b.jsx("div",{className:"harvest-grid",children:(lt=le.stages)==null?void 0:lt.filter(qe=>qe.stage_name.includes("Harvest")).map((qe,en)=>{const Jt=Jue(qe.predicted_date);return b.jsxs("div",{className:"harvest-item",children:[b.jsx("span",{className:"harvest-label",children:qe.stage_name.replace("Harvest ","")}),b.jsx("span",{className:"harvest-date",children:ym(qe.predicted_date)}),Jt!==null&&Jt>0&&b.jsxs("span",{className:"harvest-days",children:[Jt,"d"]})]},en)})})]})]})]},le.variety_code)})}),b.jsxs("div",{className:"phenology-legend",children:[b.jsxs("span",{className:"legend-item",children:[b.jsx(fO,{size:14,className:"completed"})," Completed/Actual"]}),b.jsxs("span",{className:"legend-item",children:[b.jsx(pO,{size:14,className:"pending"})," Predicted"]}),b.jsxs("span",{className:"legend-item",children:[b.jsx(Xg,{size:14})," GDD = Growing Degree Days"]})]})]}):b.jsx("div",{className:"phenology-explorer",children:b.jsxs("div",{className:"no-zone-message",children:[b.jsx($d,{size:48}),b.jsx("h3",{children:"Select a Climate Zone"}),b.jsx("p",{children:"Choose a wine region above to view phenology estimates"})]})})},Pg={downy_mildew:{main:"#3B82F6",light:"#93C5FD",fill:"rgba(59, 130, 246, 0.15)"},powdery_mildew:{main:"#F59E0B",light:"#FCD34D",fill:"rgba(245, 158, 11, 0.15)"},botrytis:{main:"#8B5CF6",light:"#C4B5FD",fill:"rgba(139, 92, 246, 0.15)"}},U3=({level:e,size:t=24})=>{switch(e){case"low":return b.jsx(dy,{size:t,className:"risk-icon low"});case"moderate":return b.jsx(pF,{size:t,className:"risk-icon moderate"});case"high":return b.jsx(X7,{size:t,className:"risk-icon high"});case"extreme":return b.jsx(o_,{size:t,className:"risk-icon extreme"});default:return b.jsx(dy,{size:t,className:"risk-icon unknown"})}},mge=({zone:e})=>{var re;const[t,n]=te.useState(null),[o,u]=te.useState(!1),[d,g]=te.useState(null),[i,E]=te.useState(null),[P,I]=te.useState(14);te.useEffect(()=>{if(!(e!=null&&e.slug)){n(null);return}(async()=>{var ue,ye;try{u(!0),g(null);const ge=await Yue(e.slug,{recent_days:P});if(n(ge),((ye=(ue=ge.current_pressure)==null?void 0:ue.diseases)==null?void 0:ye.length)>0){const we={extreme:4,high:3,moderate:2,low:1},Le=ge.current_pressure.diseases.reduce((Ze,Ge)=>(we[Ge.risk_level]||0)>(we[Ze.risk_level]||0)?Ge:Ze);E(Le.disease)}}catch(ge){console.error("Error loading disease pressure:",ge),g("Failed to load disease pressure data")}finally{u(!1)}})()},[e==null?void 0:e.slug,P]);const D=le=>{E(i===le?null:le)},F=te.useMemo(()=>{var ue;if(!((ue=t==null?void 0:t.chart_data)!=null&&ue.daily))return null;const le=t.chart_data.daily;return{labels:le.map(ye=>ym(ye.date)),datasets:[{label:"Downy Mildew",data:le.map(ye=>ye.downy_mildew),borderColor:Pg.downy_mildew.main,backgroundColor:Pg.downy_mildew.fill,fill:!1,tension:.3,pointRadius:2,pointHoverRadius:5},{label:"Powdery Mildew",data:le.map(ye=>ye.powdery_mildew),borderColor:Pg.powdery_mildew.main,backgroundColor:Pg.powdery_mildew.fill,fill:!1,tension:.3,pointRadius:2,pointHoverRadius:5},{label:"Botrytis",data:le.map(ye=>ye.botrytis),borderColor:Pg.botrytis.main,backgroundColor:Pg.botrytis.fill,fill:!1,tension:.3,pointRadius:2,pointHoverRadius:5}]}},[t]),$={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15}},tooltip:{mode:"index",intersect:!1,callbacks:{label:le=>{const ue=le.raw;return ue==null?`${le.dataset.label}: N/A`:`${le.dataset.label}: ${ue.toFixed(1)}`}}}},scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Risk Score"},ticks:{callback:le=>`${le}`}},x:{ticks:{maxTicksLimit:10}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},Z=le=>pN[le]||pN.unknown;if(!e)return b.jsx("div",{className:"disease-pressure-explorer",children:b.jsxs("div",{className:"no-zone-message",children:[b.jsx(dy,{size:48}),b.jsx("h3",{children:"Select a Climate Zone"}),b.jsx("p",{children:"Choose a wine region above to view disease pressure indicators"})]})});if(o)return b.jsx("div",{className:"disease-pressure-explorer",children:b.jsxs("div",{className:"loading-state",children:[b.jsx(sc,{size:32,className:"spinning"}),b.jsx("p",{children:"Loading disease pressure data..."})]})});if(d)return b.jsx("div",{className:"disease-pressure-explorer",children:b.jsxs("div",{className:"error-state",children:[b.jsx(Sm,{size:32}),b.jsx("p",{children:d})]})});if(!t||!t.current_pressure)return b.jsx("div",{className:"disease-pressure-explorer",children:b.jsxs("div",{className:"no-data-message",children:[b.jsx(dy,{size:48}),b.jsx("h3",{children:"No Disease Pressure Data"}),b.jsxs("p",{children:["Disease pressure data for ",e.name," is not yet available"]})]})});const{current_pressure:q}=t,X=Z(q.overall_risk);return b.jsxs("div",{className:"disease-pressure-explorer",children:[b.jsxs("div",{className:"disease-header",children:[b.jsxs("div",{className:"header-title",children:[b.jsx("h3",{children:e.name}),b.jsxs("div",{className:"overall-risk-badge",style:{backgroundColor:X.bgColor,color:X.color},children:[b.jsx(U3,{level:q.overall_risk,size:16}),b.jsxs("span",{children:[X.name," Risk"]})]})]}),b.jsx("div",{className:"header-meta",children:b.jsxs("span",{className:"data-date",children:[b.jsx(Wg,{size:14}),"Updated ",Y1(t.latest_date)]})})]}),b.jsx("div",{className:"disease-cards",children:(re=q.diseases)==null?void 0:re.map(le=>{var Le;const ue=Z(le.risk_level),ye=i===le.disease,ge=((Le=Pg[le.disease])==null?void 0:Le.main)||"#6B7280",we=Kue[le.disease]||le.disease;return b.jsxs("div",{className:`disease-card ${ye?"expanded":""}`,style:{borderLeftColor:ge},children:[b.jsxs("div",{className:"disease-card-header",onClick:()=>D(le.disease),children:[b.jsxs("div",{className:"disease-info",children:[b.jsx(U3,{level:le.risk_level,size:28}),b.jsxs("div",{className:"disease-name-wrapper",children:[b.jsx("span",{className:"disease-name",children:we}),b.jsx("span",{className:"risk-label",style:{color:ue.color},children:ue.name})]})]}),le.score!==null&&le.score!==void 0&&b.jsxs("div",{className:"disease-score",children:[b.jsx("span",{className:"score-value",children:Number(le.score).toFixed(0)}),b.jsx("span",{className:"score-label",children:"/ 100"})]}),b.jsx("div",{className:"expand-icon",children:ye?b.jsx(Iy,{size:20}):b.jsx(Fd,{size:20})})]}),b.jsxs("div",{className:"risk-bar-container",children:[b.jsx("div",{className:"risk-bar",style:{width:`${Math.min(100,le.score||0)}%`,backgroundColor:ue.color}}),b.jsxs("div",{className:"risk-thresholds",children:[b.jsx("span",{className:"threshold",style:{left:"25%"},children:"25"}),b.jsx("span",{className:"threshold",style:{left:"50%"},children:"50"}),b.jsx("span",{className:"threshold",style:{left:"75%"},children:"75"})]})]}),ye&&b.jsxs("div",{className:"disease-card-expanded",children:[le.description&&b.jsxs("div",{className:"disease-description",children:[b.jsx(uC,{size:16}),b.jsx("p",{children:le.description})]}),le.contributing_factors&&Object.keys(le.contributing_factors).length>0&&b.jsxs("div",{className:"contributing-factors",children:[b.jsx("h4",{children:"Contributing Factors"}),b.jsxs("div",{className:"factors-grid",children:[le.contributing_factors.temp_favorable!==void 0&&b.jsxs("div",{className:"factor-item",children:[b.jsx(fy,{size:16}),b.jsx("span",{className:"factor-label",children:"Temperature"}),b.jsx("span",{className:`factor-value ${le.contributing_factors.temp_favorable?"favorable":""}`,children:le.contributing_factors.temp_favorable?"Favorable":"Unfavorable"})]}),le.contributing_factors.humidity_favorable!==void 0&&b.jsxs("div",{className:"factor-item",children:[b.jsx(Zg,{size:16}),b.jsx("span",{className:"factor-label",children:"Humidity"}),b.jsx("span",{className:`factor-value ${le.contributing_factors.humidity_favorable?"favorable":""}`,children:le.contributing_factors.humidity_favorable?"Favorable":"Unfavorable"})]}),le.contributing_factors.wet_hours!==void 0&&b.jsxs("div",{className:"factor-item",children:[b.jsx(Zg,{size:16}),b.jsx("span",{className:"factor-label",children:"Wet Hours"}),b.jsxs("span",{className:"factor-value",children:[le.contributing_factors.wet_hours,"h"]})]}),le.contributing_factors.consecutive_wet_days!==void 0&&b.jsxs("div",{className:"factor-item",children:[b.jsx(hp,{size:16}),b.jsx("span",{className:"factor-label",children:"Wet Days"}),b.jsxs("span",{className:"factor-value",children:[le.contributing_factors.consecutive_wet_days," days"]})]})]})]}),le.spray_recommendation&&b.jsxs("div",{className:"spray-recommendation",children:[b.jsx("h4",{children:"Recommendation"}),b.jsx("p",{children:le.spray_recommendation})]})]})]},le.disease)})}),b.jsxs("div",{className:"chart-section",children:[b.jsxs("div",{className:"chart-header",children:[b.jsx("h4",{children:"Risk Trend"}),b.jsxs("div",{className:"days-selector",children:[b.jsx("span",{children:"Show:"}),[7,14,30].map(le=>b.jsxs("button",{className:`days-btn ${P===le?"active":""}`,onClick:()=>I(le),children:[le,"d"]},le))]})]}),b.jsx("div",{className:"chart-container",children:F&&b.jsx(Om,{data:F,options:$})})]}),q.recommendations&&b.jsxs("div",{className:"general-recommendations",children:[b.jsx("h4",{children:"General Recommendations"}),Array.isArray(q.recommendations)?b.jsx("ul",{children:q.recommendations.map((le,ue)=>b.jsx("li",{children:le},ue))}):b.jsx("p",{children:q.recommendations})]}),!q.humidity_available&&b.jsxs("div",{className:"data-quality-note",children:[b.jsx(Sm,{size:14}),b.jsx("span",{children:"Humidity data not available for this zone. Disease pressure estimates may be less accurate."})]})]})},pI=["Oct","Nov","Dec","Jan","Feb","Mar","Apr"],Tu=[10,11,12,1,2,3,4],Eh=[{main:"#3B82F6",light:"#93C5FD",fill:"rgba(59, 130, 246, 0.15)"},{main:"#10B981",light:"#6EE7B7",fill:"rgba(16, 185, 129, 0.15)"},{main:"#F59E0B",light:"#FCD34D",fill:"rgba(245, 158, 11, 0.15)"},{main:"#EF4444",light:"#FCA5A5",fill:"rgba(239, 68, 68, 0.15)"},{main:"#8B5CF6",light:"#C4B5FD",fill:"rgba(139, 92, 246, 0.15)"}],ux={main:"#6B7280",light:"#9CA3AF",fill:"rgba(107, 114, 128, 0.1)"},gge=({zone:e,comparisonZones:t=[],onComparisonZonesChange:n})=>{var $n,fr,kn;const[o,u]=te.useState(null),[d,g]=te.useState(null),[i,E]=te.useState(null),[P,I]=te.useState(null),[D,F]=te.useState(!1),[$,Z]=te.useState(null),[q,X]=te.useState("overview"),[re,le]=te.useState(null),[ue,ye]=te.useState([]),[ge,we]=te.useState("gdd"),[Le,Ze]=te.useState(10),[Ge,gt]=te.useState(!0),[lt,qe]=te.useState(0),en=6;te.useEffect(()=>{if(!(e!=null&&e.slug)){u(null);return}(async()=>{var En;try{F(!0),Z(null);const[Tt,wn]=await Promise.all([Fue(e.slug,{limit:50}),hV(e.slug)]);u(Tt),E(wn),((En=Tt.seasons)==null?void 0:En.length)>0&&le(Tt.seasons[0].vintage_year)}catch(Tt){console.error("Error loading seasons:",Tt),Z("Failed to load season data")}finally{F(!1)}})()},[e==null?void 0:e.slug]),te.useEffect(()=>{if(!(e!=null&&e.slug)||!re||q!=="monthly"&&q!=="season-compare")return;(async()=>{try{F(!0);const En=await KP(e.slug,{vintage_year:re,months:Tu.join(",")});g(En)}catch(En){console.error("Error loading monthly data:",En)}finally{F(!1)}})()},[e==null?void 0:e.slug,re,q]),te.useEffect(()=>{if(q!=="zone-compare"||t.length===0){I(null);return}(async()=>{try{F(!0);const En=[e.slug,...t.map(wn=>wn.slug)].join(","),Tt=await Uue({zones:En,metric:ge,vintage_year:Ge?null:re});I(Tt)}catch(En){console.error("Error loading zone comparison:",En)}finally{F(!1)}})()},[e==null?void 0:e.slug,t,q,ge,re,Ge]);const Jt=({value:Bt})=>Bt==null||Bt===0?b.jsx(fF,{size:14,className:"trend-icon neutral"}):Bt>0?b.jsx(Am,{size:14,className:"trend-icon positive"}):b.jsx(mF,{size:14,className:"trend-icon negative"}),Nt=(Bt,En)=>{if(!(i!=null&&i.monthly))return null;const Tt=i.monthly.find(wn=>wn.month===Bt);if(!Tt)return null;switch(En){case"gdd":return Tt.gdd;case"rain":return Tt.rain;case"tmean":return Tt.tmean;case"tmax":return Tt.tmax;case"tmin":return Tt.tmin;default:return null}},St=te.useMemo(()=>{if(!(o!=null&&o.seasons))return null;const Bt=Math.min(Le,o.seasons.length),En=[...o.seasons].slice(0,Bt).reverse(),Tt=ge==="rain",wn=tn=>{switch(ge){case"gdd":return tn.gdd_total;case"rain":return tn.rain_total;case"tmean":return tn.tmean_avg;case"tmax":return tn.tmax_avg;default:return tn.gdd_total}},mr=[{label:ge==="gdd"?"Season GDD":ge==="rain"?"Season Rainfall (mm)":ge==="tmean"?"Season Avg Temp (C)":"Season Max Temp (C)",data:En.map(tn=>wn(tn)?Number(wn(tn)):null),borderColor:Eh[0].main,backgroundColor:Tt?Eh[0].main+"99":Eh[0].fill,fill:!Tt,tension:.3,pointRadius:5,pointHoverRadius:7}];if(o.baseline&&Ge){const tn=ge==="gdd"?o.baseline.gdd_total:ge==="rain"?o.baseline.rain_total:ge==="tmean"?o.baseline.tmean_avg:o.baseline.tmax_avg;tn&&mr.push({label:"LTA (1986-2005)",data:En.map(()=>Number(tn)),borderColor:ux.main,borderDash:[5,5],borderWidth:2,pointRadius:0,fill:!1})}return{labels:En.map(tn=>tn.season_label),datasets:mr}},[o,ge,Ge,Le]),an=te.useMemo(()=>{if(!(d!=null&&d.data)||d.data.length===0)return null;const Bt=ge==="rain",En=[...d.data].sort((Hn,nr)=>Tu.indexOf(Hn.month)-Tu.indexOf(nr.month)),Tt=Hn=>{var nr,Mi,Sn,si,Fi;switch(ge){case"gdd":return(nr=Hn.gdd)==null?void 0:nr.mean;case"rain":return(Mi=Hn.rain)==null?void 0:Mi.mean;case"tmean":return(Sn=Hn.tmean)==null?void 0:Sn.mean;case"tmax":return(si=Hn.tmax)==null?void 0:si.mean;default:return(Fi=Hn.gdd)==null?void 0:Fi.mean}},wn=Hn=>{var nr,Mi,Sn,si,Fi;switch(ge){case"gdd":return(nr=Hn.gdd)==null?void 0:nr.sd;case"rain":return(Mi=Hn.rain)==null?void 0:Mi.sd;case"tmean":return(Sn=Hn.tmean)==null?void 0:Sn.sd;case"tmax":return(si=Hn.tmax)==null?void 0:si.sd;default:return(Fi=Hn.gdd)==null?void 0:Fi.sd}},mr=En.map(Hn=>{const nr=Tt(Hn);return nr!=null?Number(nr):null}),tn=En.map(Hn=>{const nr=wn(Hn);return nr!=null?Number(nr):null}),Ii=[];if(!Bt&&tn.some(Hn=>Hn!=null)&&(Ii.push({label:"Upper SD",data:mr.map((Hn,nr)=>Hn!=null&&tn[nr]!=null?Hn+tn[nr]:null),borderColor:"transparent",backgroundColor:Eh[0].fill,fill:"+1",pointRadius:0,tension:.3,order:2}),Ii.push({label:"Lower SD",data:mr.map((Hn,nr)=>Hn!=null&&tn[nr]!=null?Math.max(0,Hn-tn[nr]):null),borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.3,order:2})),Ii.push({label:`${re-1}/${String(re).slice(2)}`,data:mr,borderColor:Eh[0].main,backgroundColor:Bt?Eh[0].main+"99":Eh[0].main,fill:!1,tension:.3,pointRadius:5,pointHoverRadius:7,order:1,errorBars:Bt?tn:null}),i!=null&&i.monthly&&Ge){const Hn=Tu.map(nr=>{const Mi=Nt(nr,ge);return Mi!=null?Number(Mi):null});Ii.push({label:"LTA (1986-2005)",data:Hn,borderColor:ux.main,backgroundColor:Bt?ux.main+"60":"transparent",borderDash:Bt?[]:[5,5],borderWidth:2,pointRadius:Bt?0:3,fill:!1,order:0})}return{labels:pI,datasets:Ii}},[d,ge,re,i,Ge]),Kt=()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,filter:Bt=>!Bt.text.includes("SD")}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",callbacks:{label:Bt=>{var Tt;if((Tt=Bt.dataset.label)!=null&&Tt.includes("SD"))return null;const En=Bt.parsed.y;return En==null?null:`${Bt.dataset.label}: ${Ml(En,ge)}`}}}},scales:{y:{beginAtZero:ge!=="tmean"&&ge!=="tmax",title:{display:!0,text:ge==="gdd"?"GDD (Cdays)":ge==="rain"?"Rainfall (mm)":"Temperature (C)"}},x:{title:{display:q==="monthly"||q==="season-compare"||q==="zone-compare",text:"Growing Season Month"}}},interaction:{mode:"nearest",axis:"x",intersect:!1}}),hn=()=>({...Kt(),plugins:{...Kt().plugins}}),Xt=Bt=>{q==="season-compare"?ue.includes(Bt)?ye(ue.filter(En=>En!==Bt)):ue.length<3&&ye([...ue,Bt]):(le(Bt),q==="overview"&&X("monthly"))},et=te.useMemo(()=>{if(!(o!=null&&o.seasons))return[];const Bt=lt*en;return o.seasons.slice(Bt,Bt+en)},[o,lt]),zt=Math.ceil(((($n=o==null?void 0:o.seasons)==null?void 0:$n.length)||0)/en);if(!e)return b.jsx("div",{className:"season-explorer",children:b.jsxs("div",{className:"explorer-placeholder",children:[b.jsx(hp,{size:48}),b.jsx("p",{children:"Select a climate zone to explore historical seasons"})]})});if(D&&!o)return b.jsx("div",{className:"season-explorer",children:b.jsx("div",{className:"explorer-loading",children:b.jsxs("p",{children:["Loading season data for ",e.name,"..."]})})});if($)return b.jsx("div",{className:"season-explorer",children:b.jsx("div",{className:"explorer-error",children:b.jsx("p",{children:$})})});if(!o)return null;const Zn=ge==="rain";return b.jsxs("div",{className:"season-explorer",children:[b.jsxs("div",{className:"explorer-header",children:[b.jsxs("h3",{children:["Climate History: ",e.name]}),e.region_name&&b.jsx("span",{className:"zone-region",children:e.region_name})]}),b.jsxs("div",{className:"view-mode-selector",children:[b.jsxs("button",{className:`mode-btn ${q==="overview"?"active":""}`,onClick:()=>X("overview"),children:[b.jsx(NW,{size:16}),"Overview"]}),b.jsxs("button",{className:`mode-btn ${q==="monthly"?"active":""}`,onClick:()=>X("monthly"),children:[b.jsx(lC,{size:16}),"Monthly View"]}),b.jsxs("button",{className:`mode-btn ${q==="season-compare"?"active":""}`,onClick:()=>{X("season-compare"),ye(re?[re]:[])},children:[b.jsx(hp,{size:16}),"Compare Seasons"]}),b.jsxs("button",{className:`mode-btn ${q==="zone-compare"?"active":""}`,onClick:()=>X("zone-compare"),children:[b.jsx(aa,{size:16}),"Compare Zones"]})]}),o.baseline&&b.jsxs("div",{className:"baseline-summary",children:[b.jsxs("div",{className:"baseline-header",children:[b.jsx("span",{className:"baseline-label",children:"Long-term Average (1986-2005)"}),b.jsxs("label",{className:"include-lta-toggle",children:[b.jsx("input",{type:"checkbox",checked:Ge,onChange:Bt=>gt(Bt.target.checked)}),"Show on chart"]})]}),b.jsxs("div",{className:"baseline-stats",children:[b.jsxs("div",{className:"baseline-stat",children:[b.jsx(Xg,{size:16}),b.jsx("span",{className:"stat-value",children:Ml(o.baseline.gdd_total,"gdd")}),b.jsx("span",{className:"stat-label",children:"GDD"})]}),b.jsxs("div",{className:"baseline-stat",children:[b.jsx(Zg,{size:16}),b.jsx("span",{className:"stat-value",children:Ml(o.baseline.rain_total,"rain")}),b.jsx("span",{className:"stat-label",children:"Rainfall"})]}),b.jsxs("div",{className:"baseline-stat",children:[b.jsx(fy,{size:16}),b.jsx("span",{className:"stat-value",children:Ml(o.baseline.tmean_avg,"tmean")}),b.jsx("span",{className:"stat-label",children:"Avg Temp"})]})]})]}),b.jsxs("div",{className:"chart-controls",children:[b.jsxs("div",{className:"chart-metric-selector",children:[b.jsx("button",{className:`chart-type-btn ${ge==="gdd"?"active":""}`,onClick:()=>we("gdd"),children:"GDD"}),b.jsx("button",{className:`chart-type-btn ${ge==="rain"?"active":""}`,onClick:()=>we("rain"),children:"Rainfall"}),b.jsx("button",{className:`chart-type-btn ${ge==="tmean"?"active":""}`,onClick:()=>we("tmean"),children:"Avg Temp"}),b.jsx("button",{className:`chart-type-btn ${ge==="tmax"?"active":""}`,onClick:()=>we("tmax"),children:"Max Temp"})]}),q==="overview"&&b.jsxs("select",{className:"season-limit-select",value:Le,onChange:Bt=>Ze(Number(Bt.target.value)),children:[b.jsx("option",{value:10,children:"Last 10 seasons"}),b.jsx("option",{value:20,children:"Last 20 seasons"}),b.jsx("option",{value:37,children:"All seasons"})]}),(q==="monthly"||q==="zone-compare")&&re&&b.jsxs("div",{className:"season-selector",children:[b.jsx("label",{children:"Season:"}),b.jsx("select",{className:"season-select",value:re,onChange:Bt=>le(Number(Bt.target.value)),children:(fr=o.seasons)==null?void 0:fr.map(Bt=>b.jsx("option",{value:Bt.vintage_year,children:Bt.season_label},Bt.vintage_year))})]}),q==="zone-compare"&&b.jsxs("div",{className:"compare-type-toggle",children:[b.jsxs("label",{children:[b.jsx("input",{type:"radio",checked:Ge,onChange:()=>gt(!0)}),"Compare LTA"]}),b.jsxs("label",{children:[b.jsx("input",{type:"radio",checked:!Ge,onChange:()=>gt(!1)}),"Compare Season"]})]})]}),q==="season-compare"&&b.jsxs("div",{className:"comparison-season-selector",children:[b.jsx("span",{className:"selector-label",children:"Select seasons to compare (max 3):"}),b.jsx("div",{className:"season-pills",children:(kn=o.seasons)==null?void 0:kn.slice(0,15).map(Bt=>b.jsx("button",{className:`season-pill ${ue.includes(Bt.vintage_year)?"selected":""}`,onClick:()=>{ue.includes(Bt.vintage_year)?ye(ue.filter(En=>En!==Bt.vintage_year)):ue.length<3&&ye([...ue,Bt.vintage_year])},disabled:!ue.includes(Bt.vintage_year)&&ue.length>=3,children:Bt.season_label},Bt.vintage_year))})]}),b.jsxs("div",{className:"chart-container",children:[q==="overview"&&St&&(Zn?b.jsx(Ty,{data:St,options:hn()}):b.jsx(Om,{data:St,options:Kt()})),q==="monthly"&&an&&(Zn?b.jsx(Ty,{data:an,options:hn()}):b.jsx(Om,{data:an,options:Kt()})),q==="season-compare"&&b.jsx(_ge,{zone:e,seasons:ue,metric:ge,includeLTA:Ge,baselineData:i}),q==="zone-compare"&&b.jsx(yge,{mainZone:e,comparisonZones:t,metric:ge,selectedSeason:re,useLTA:Ge,baselineData:i}),D&&b.jsx("div",{className:"chart-loading-overlay",children:"Loading..."})]}),b.jsxs("div",{className:"seasons-section",children:[b.jsxs("div",{className:"seasons-header",children:[b.jsx("h4",{children:"Season Summaries"}),zt>1&&b.jsxs("div",{className:"seasons-pagination",children:[b.jsx("button",{className:"page-btn",onClick:()=>qe(Bt=>Math.max(0,Bt-1)),disabled:lt===0,children:b.jsx(cC,{size:18})}),b.jsxs("span",{className:"page-info",children:[lt+1," / ",zt]}),b.jsx("button",{className:"page-btn",onClick:()=>qe(Bt=>Math.min(zt-1,Bt+1)),disabled:lt>=zt-1,children:b.jsx(Fd,{size:18})})]})]}),b.jsx("div",{className:"seasons-grid",children:et.map(Bt=>{var En,Tt,wn,mr;return b.jsxs("div",{className:`season-card ${re===Bt.vintage_year?"selected":""} ${ue.includes(Bt.vintage_year)?"comparing":""}`,onClick:()=>Xt(Bt.vintage_year),children:[b.jsxs("div",{className:"season-card-header",children:[b.jsx("span",{className:"season-label",children:Bt.season_label}),((En=Bt.rankings)==null?void 0:En[0])&&b.jsx("span",{className:"season-ranking",children:Bt.rankings[0].label})]}),b.jsxs("div",{className:"season-card-stats",children:[b.jsxs("div",{className:"season-stat",children:[b.jsx("span",{className:"stat-label",children:"GDD"}),b.jsx("span",{className:"stat-value",children:Ml(Bt.gdd_total,"gdd")}),((Tt=Bt.vs_baseline)==null?void 0:Tt.gdd_pct)&&b.jsxs("span",{className:`stat-diff ${Number(Bt.vs_baseline.gdd_pct)>=0?"positive":"negative"}`,children:[b.jsx(Jt,{value:Number(Bt.vs_baseline.gdd_pct)}),Z1(Bt.vs_baseline.gdd_pct)]})]}),b.jsxs("div",{className:"season-stat",children:[b.jsx("span",{className:"stat-label",children:"Rain"}),b.jsx("span",{className:"stat-value",children:Ml(Bt.rain_total,"rain")}),((wn=Bt.vs_baseline)==null?void 0:wn.rain_pct)&&b.jsxs("span",{className:`stat-diff ${Number(Bt.vs_baseline.rain_pct)<=0?"positive":"negative"}`,children:[b.jsx(Jt,{value:Number(Bt.vs_baseline.rain_pct)}),Z1(Bt.vs_baseline.rain_pct)]})]}),b.jsxs("div",{className:"season-stat",children:[b.jsx("span",{className:"stat-label",children:"Avg"}),b.jsx("span",{className:"stat-value",children:Ml(Bt.tmean_avg,"tmean")}),((mr=Bt.vs_baseline)==null?void 0:mr.tmean_diff)&&b.jsxs("span",{className:`stat-diff ${Number(Bt.vs_baseline.tmean_diff)>=0?"positive":"negative"}`,children:[Number(Bt.vs_baseline.tmean_diff)>=0?"+":"",Number(Bt.vs_baseline.tmean_diff).toFixed(1),""]})]})]})]},Bt.vintage_year)})})]})]})},_ge=({zone:e,seasons:t,metric:n,includeLTA:o,baselineData:u})=>{const[d,g]=te.useState(null),[i,E]=te.useState(!1),P=n==="rain";if(te.useEffect(()=>{if(!(e!=null&&e.slug)||t.length===0){g(null);return}(async()=>{try{E(!0);const F=t.map(q=>KP(e.slug,{vintage_year:q,months:Tu.join(",")})),$=await Promise.all(F),Z=[];if($.forEach((q,X)=>{const re=[...q.data||[]].sort((we,Le)=>Tu.indexOf(we.month)-Tu.indexOf(Le.month)),le=re.map(we=>{var Le,Ze,Ge,gt,lt;switch(n){case"gdd":return(Le=we.gdd)==null?void 0:Le.mean;case"rain":return(Ze=we.rain)==null?void 0:Ze.mean;case"tmean":return(Ge=we.tmean)==null?void 0:Ge.mean;case"tmax":return(gt=we.tmax)==null?void 0:gt.mean;default:return(lt=we.gdd)==null?void 0:lt.mean}}).map(we=>we!=null?Number(we):null),ue=re.map(we=>{var Le,Ze,Ge,gt,lt;switch(n){case"gdd":return(Le=we.gdd)==null?void 0:Le.sd;case"rain":return(Ze=we.rain)==null?void 0:Ze.sd;case"tmean":return(Ge=we.tmean)==null?void 0:Ge.sd;case"tmax":return(gt=we.tmax)==null?void 0:gt.sd;default:return(lt=we.gdd)==null?void 0:lt.sd}}).map(we=>we!=null?Number(we):null),ye=Eh[X%Eh.length],ge=t[X];!P&&ue.some(we=>we!=null)&&(Z.push({label:`${ge} Upper SD`,data:le.map((we,Le)=>we!=null&&ue[Le]!=null?we+ue[Le]:null),borderColor:"transparent",backgroundColor:ye.fill,fill:"+1",pointRadius:0,tension:.3,order:10+X}),Z.push({label:`${ge} Lower SD`,data:le.map((we,Le)=>we!=null&&ue[Le]!=null?Math.max(0,we-ue[Le]):null),borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.3,order:10+X})),Z.push({label:`${ge-1}/${String(ge).slice(2)}`,data:le,borderColor:ye.main,backgroundColor:P?ye.main+"99":ye.main,fill:!1,tension:.3,pointRadius:4,pointHoverRadius:6,order:X})}),o&&(u!=null&&u.monthly)){const q=Tu.map(X=>{const re=u.monthly.find(le=>le.month===X);if(!re)return null;switch(n){case"gdd":return re.gdd;case"rain":return re.rain;case"tmean":return re.tmean;case"tmax":return re.tmax;default:return null}}).map(X=>X!=null?Number(X):null);Z.push({label:"LTA (1986-2005)",data:q,borderColor:ux.main,backgroundColor:P?ux.main+"60":"transparent",borderDash:P?[]:[5,5],borderWidth:2,pointRadius:P?0:3,fill:!1,order:100})}g({labels:pI,datasets:Z})}catch(F){console.error("Error loading comparison data:",F)}finally{E(!1)}})()},[e==null?void 0:e.slug,t,n,o,u,P]),i)return b.jsx("div",{className:"chart-loading",children:"Loading comparison..."});if(!d||t.length===0)return b.jsx("div",{className:"chart-placeholder",children:"Select seasons to compare"});const I=P?Ty:Om;return b.jsx(I,{data:d,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{filter:D=>!D.text.includes("SD")}},tooltip:{mode:"index",intersect:!1,callbacks:{label:D=>{var F,$;return(F=D.dataset.label)!=null&&F.includes("SD")?null:`${D.dataset.label}: ${($=D.parsed.y)==null?void 0:$.toFixed(1)}`}}}},scales:{y:{beginAtZero:n!=="tmean"&&n!=="tmax",title:{display:!0,text:n==="gdd"?"GDD (Cdays)":n==="rain"?"Rainfall (mm)":"Temperature (C)"}},x:{title:{display:!0,text:"Growing Season Month"}}}}})},yge=({mainZone:e,comparisonZones:t=[],metric:n,selectedSeason:o,useLTA:u,baselineData:d})=>{const[g,i]=te.useState(null),[E,P]=te.useState(!1),[I,D]=te.useState(null),F=n==="rain";if(te.useEffect(()=>{const q=[e,...t].filter(Boolean);if(!e){i(null);return}(async()=>{try{P(!0),D(null);const re=[];for(let le=0;le<q.length;le++){const ue=q[le],ye=Eh[le%Eh.length];let ge=[],we=[];try{if(u){const Le=await hV(ue.slug);ge=Tu.map(Ze=>{var gt;const Ge=(gt=Le.monthly)==null?void 0:gt.find(lt=>lt.month===Ze);if(!Ge)return null;switch(n){case"gdd":return Ge.gdd;case"rain":return Ge.rain;case"tmean":return Ge.tmean;case"tmax":return Ge.tmax;default:return null}}).map(Ze=>Ze!=null?Number(Ze):null),we=ge.map(()=>null)}else if(o){const Ze=[...(await KP(ue.slug,{vintage_year:o,months:Tu.join(",")})).data||[]].sort((Ge,gt)=>Tu.indexOf(Ge.month)-Tu.indexOf(gt.month));ge=Ze.map(Ge=>{var gt,lt,qe,en,Jt;switch(n){case"gdd":return(gt=Ge.gdd)==null?void 0:gt.mean;case"rain":return(lt=Ge.rain)==null?void 0:lt.mean;case"tmean":return(qe=Ge.tmean)==null?void 0:qe.mean;case"tmax":return(en=Ge.tmax)==null?void 0:en.mean;default:return(Jt=Ge.gdd)==null?void 0:Jt.mean}}).map(Ge=>Ge!=null?Number(Ge):null),we=Ze.map(Ge=>{var gt,lt,qe,en,Jt;switch(n){case"gdd":return(gt=Ge.gdd)==null?void 0:gt.sd;case"rain":return(lt=Ge.rain)==null?void 0:lt.sd;case"tmean":return(qe=Ge.tmean)==null?void 0:qe.sd;case"tmax":return(en=Ge.tmax)==null?void 0:en.sd;default:return(Jt=Ge.gdd)==null?void 0:Jt.sd}}).map(Ge=>Ge!=null?Number(Ge):null)}}catch(Le){console.error(`Error loading data for zone ${ue.slug}:`,Le);continue}ge.length===0||ge.every(Le=>Le===null)||(!F&&!u&&we.some(Le=>Le!=null)&&(re.push({label:`${ue.name} Upper SD`,data:ge.map((Le,Ze)=>Le!=null&&we[Ze]!=null?Le+we[Ze]:null),borderColor:"transparent",backgroundColor:ye.fill,fill:"+1",pointRadius:0,tension:.3,order:10+le}),re.push({label:`${ue.name} Lower SD`,data:ge.map((Le,Ze)=>Le!=null&&we[Ze]!=null?Math.max(0,Le-we[Ze]):null),borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.3,order:10+le})),re.push({label:ue.name,data:ge,borderColor:ye.main,backgroundColor:F?ye.main+"99":ye.main,fill:!1,tension:.3,pointRadius:4,pointHoverRadius:6,order:le}))}re.length>0?i({labels:pI,datasets:re}):(i(null),D("No data available for selected zones"))}catch(re){console.error("Error loading zone comparison:",re),D("Failed to load zone comparison data"),i(null)}finally{P(!1)}})()},[e,t,n,o,u,F]),E)return b.jsx("div",{className:"chart-loading",children:"Loading zone comparison..."});if(I)return b.jsx("div",{className:"chart-placeholder",children:I});if(!g)return b.jsx("div",{className:"chart-placeholder",children:e?"No data available. Try selecting a different season or metric.":"Select a zone to view data"});const $=F?Ty:Om,Z=u?"Long-term Average Comparison (1986-2005)":`Season ${o-1}/${String(o).slice(2)} Comparison`;return b.jsx($,{data:g,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{filter:q=>!q.text.includes("SD")}},tooltip:{mode:"index",intersect:!1,callbacks:{label:q=>{var re;if((re=q.dataset.label)!=null&&re.includes("SD"))return null;const X=q.parsed.y;return X==null?null:`${q.dataset.label}: ${Ml(X,n)}`}}},title:{display:!0,text:Z,font:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:n!=="tmean"&&n!=="tmax",title:{display:!0,text:n==="gdd"?"GDD (Cdays)":n==="rain"?"Rainfall (mm)":"Temperature (C)"}},x:{title:{display:!0,text:"Growing Season Month"}}}}})},vge=({zone:e})=>{var re,le;const[t,n]=te.useState(null),[o,u]=te.useState(!1),[d,g]=te.useState(null),[i,E]=te.useState("SSP245"),[P,I]=te.useState("2041_2060"),[D,F]=te.useState("tmean");te.useEffect(()=>{if(!(e!=null&&e.slug)){n(null);return}(async()=>{try{u(!0),g(null);const ye=await Bue(e.slug,{ssp:"all",period:"all"});n(ye)}catch(ye){console.error("Error loading projections:",ye),g("Failed to load projection data")}finally{u(!1)}})()},[e==null?void 0:e.slug]);const $=te.useMemo(()=>t!=null&&t.projections?t.projections.find(ue=>ue.scenario.code===i&&ue.period.code===P):null,[t,i,P]),Z=te.useMemo(()=>{var en,Jt;if(!($!=null&&$.monthly))return null;const ue=[10,11,12,1,2,3,4],ye=[...$.monthly].filter(Nt=>ue.includes(Nt.month)).sort((Nt,St)=>{const an=ue.indexOf(Nt.month),Kt=ue.indexOf(St.month);return an-Kt}),ge=ye.map(Nt=>Nt.month_name),we=(Nt,St)=>{switch(D){case"tmean":return St==="baseline"?Nt.baseline.tmean:Nt.projected.tmean;case"tmax":return St==="baseline"?Nt.baseline.tmax:Nt.projected.tmax;case"rain":return St==="baseline"?Nt.baseline.rain:Nt.projected.rain;case"gdd":return St==="baseline"?Nt.baseline.gdd:Nt.projected.gdd;default:return null}},Le=Nt=>{var St,an,Kt;switch(D){case"tmean":return(St=Nt.delta_sd)==null?void 0:St.tmean;case"tmax":return(an=Nt.delta_sd)==null?void 0:an.tmax;case"rain":return(Kt=Nt.delta_sd)==null?void 0:Kt.rain;default:return null}},Ze=ye.map(Nt=>we(Nt,"baseline")),Ge=ye.map(Nt=>we(Nt,"projected")),gt=ye.map(Nt=>Le(Nt)),lt=((en=yE[i])==null?void 0:en.color)||"#3B82F6",qe=[{label:"Baseline (1986-2005)",data:Ze,borderColor:"#9CA3AF",backgroundColor:"transparent",borderWidth:2,borderDash:[5,5],tension:.3,pointRadius:4,order:0}];return D!=="rain"&&gt.some(Nt=>Nt!=null)&&(qe.push({label:"Upper SD",data:Ge.map((Nt,St)=>Nt!=null&&gt[St]!=null?Number(Nt)+Number(gt[St]):null),borderColor:"transparent",backgroundColor:`${lt}15`,fill:"+1",pointRadius:0,tension:.3,order:2}),qe.push({label:"Lower SD",data:Ge.map((Nt,St)=>Nt!=null&&gt[St]!=null?Number(Nt)-Number(gt[St]):null),borderColor:"transparent",backgroundColor:"transparent",fill:!1,pointRadius:0,tension:.3,order:2})),qe.push({label:`Projected (${(Jt=vE[P])==null?void 0:Jt.label})`,data:Ge,borderColor:lt,backgroundColor:D==="rain"?`${lt}40`:lt,fill:!1,borderWidth:3,tension:.3,pointRadius:5,order:1}),{labels:ge,datasets:qe}},[$,D,i,P]),q={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,filter:ue=>!ue.text.includes("SD")}},title:{display:!0,text:`${D==="tmean"?"Mean Temperature":D==="tmax"?"Maximum Temperature":D==="rain"?"Rainfall":"GDD"} - Growing Season`,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{mode:"index",intersect:!1,callbacks:{label:ue=>{var ge;if((ge=ue.dataset.label)!=null&&ge.includes("SD"))return null;const ye=ue.parsed.y;return`${ue.dataset.label}: ${Ml(ye,D)}`}}}},scales:{y:{beginAtZero:D==="rain"||D==="gdd",title:{display:!0,text:D==="tmean"||D==="tmax"?"Temperature (C)":D==="rain"?"Rainfall (mm)":"GDD (Cdays)"}}},interaction:{mode:"nearest",axis:"x",intersect:!1}},X=D==="rain";return e?o?b.jsx("div",{className:"projections-explorer",children:b.jsx("div",{className:"explorer-loading",children:b.jsxs("p",{children:["Loading projections for ",e.name,"..."]})})}):d?b.jsx("div",{className:"projections-explorer",children:b.jsx("div",{className:"explorer-error",children:b.jsx("p",{children:d})})}):t?b.jsxs("div",{className:"projections-explorer",children:[b.jsx("div",{className:"explorer-header",children:b.jsxs("h3",{children:["Climate Projections: ",e.name]})}),b.jsxs("div",{className:"ssp-selector",children:[b.jsx("label",{className:"selector-label",children:"Emissions Scenario"}),b.jsx("div",{className:"ssp-tabs",children:Object.values(yE).map(ue=>b.jsxs("button",{className:`ssp-tab ${i===ue.code?"active":""}`,onClick:()=>E(ue.code),style:{"--ssp-color":ue.color,borderColor:i===ue.code?ue.color:"transparent"},children:[b.jsx("span",{className:"ssp-name",children:ue.name}),b.jsx("span",{className:"ssp-short",children:ue.shortName})]},ue.code))}),b.jsxs("p",{className:"ssp-description",children:[b.jsx(uC,{size:14}),(re=yE[i])==null?void 0:re.description]})]}),b.jsxs("div",{className:"period-selector",children:[b.jsx("label",{className:"selector-label",children:"Time Period"}),b.jsx("div",{className:"period-buttons",children:Object.values(vE).map(ue=>b.jsxs("button",{className:`period-btn ${P===ue.code?"active":""}`,onClick:()=>I(ue.code),children:[b.jsx("span",{className:"period-name",children:ue.name}),b.jsx("span",{className:"period-years",children:ue.label})]},ue.code))})]}),($==null?void 0:$.season_summary)&&b.jsxs("div",{className:"projection-summary",children:[b.jsxs("h4",{children:["Growing Season Changes (",(le=vE[P])==null?void 0:le.label,")"]}),b.jsxs("div",{className:"summary-grid",children:[b.jsxs("div",{className:"summary-card",children:[b.jsx("div",{className:"summary-icon gdd",children:b.jsx(Am,{size:20})}),b.jsxs("div",{className:"summary-content",children:[b.jsx("span",{className:"summary-label",children:"GDD Change"}),b.jsx("span",{className:"summary-value",children:Ml($.season_summary.gdd_projected,"gdd")}),b.jsxs("span",{className:`summary-change ${Number($.season_summary.gdd_change_pct)>=0?"positive":"negative"}`,children:[Z1($.season_summary.gdd_change_pct)," vs baseline"]})]})]}),b.jsxs("div",{className:"summary-card",children:[b.jsx("div",{className:"summary-icon temp",children:b.jsx(IW,{size:20})}),b.jsxs("div",{className:"summary-content",children:[b.jsx("span",{className:"summary-label",children:"Temperature Change"}),b.jsxs("span",{className:"summary-value",children:["+",Number($.season_summary.tmean_change).toFixed(1),"C"]}),b.jsx("span",{className:"summary-change",children:"Average warming"})]})]}),b.jsxs("div",{className:"summary-card",children:[b.jsx("div",{className:"summary-icon rain",children:b.jsx(o_,{size:20})}),b.jsxs("div",{className:"summary-content",children:[b.jsx("span",{className:"summary-label",children:"Rainfall Change"}),b.jsx("span",{className:"summary-value",children:Ml($.season_summary.rain_projected,"rain")}),b.jsxs("span",{className:`summary-change ${Number($.season_summary.rain_change_pct)>=0?"positive":"negative"}`,children:[Z1($.season_summary.rain_change_pct)," vs baseline"]})]})]})]})]}),b.jsx("div",{className:"chart-controls",children:b.jsxs("div",{className:"chart-metric-selector",children:[b.jsx("button",{className:`chart-type-btn ${D==="tmean"?"active":""}`,onClick:()=>F("tmean"),children:"Mean Temp"}),b.jsx("button",{className:`chart-type-btn ${D==="tmax"?"active":""}`,onClick:()=>F("tmax"),children:"Max Temp"}),b.jsx("button",{className:`chart-type-btn ${D==="rain"?"active":""}`,onClick:()=>F("rain"),children:"Rainfall"}),b.jsx("button",{className:`chart-type-btn ${D==="gdd"?"active":""}`,onClick:()=>F("gdd"),children:"GDD"})]})}),Z&&b.jsx("div",{className:"chart-container",children:X?b.jsx(Ty,{data:Z,options:q}):b.jsx(Om,{data:Z,options:q})}),($==null?void 0:$.monthly)&&b.jsxs("div",{className:"monthly-details",children:[b.jsx("h4",{children:"Monthly Breakdown"}),b.jsx("div",{className:"monthly-table-wrapper",children:b.jsxs("table",{className:"monthly-table",children:[b.jsx("thead",{children:b.jsxs("tr",{children:[b.jsx("th",{children:"Month"}),b.jsx("th",{children:"Baseline Temp"}),b.jsx("th",{children:"Projected Temp"}),b.jsx("th",{children:"Change"}),b.jsx("th",{children:"Baseline Rain"}),b.jsx("th",{children:"Projected Rain"})]})}),b.jsx("tbody",{children:$.monthly.filter(ue=>[10,11,12,1,2,3,4].includes(ue.month)).sort((ue,ye)=>{const ge=[10,11,12,1,2,3,4];return ge.indexOf(ue.month)-ge.indexOf(ye.month)}).map(ue=>b.jsxs("tr",{children:[b.jsx("td",{children:ue.month_name}),b.jsx("td",{children:Ml(ue.baseline.tmean,"tmean")}),b.jsx("td",{children:Ml(ue.projected.tmean,"tmean")}),b.jsxs("td",{className:Number(ue.delta.tmean)>=0?"positive":"negative",children:["+",Number(ue.delta.tmean).toFixed(1),"C"]}),b.jsx("td",{children:Ml(ue.baseline.rain,"rain")}),b.jsx("td",{children:Ml(ue.projected.rain,"rain")})]},ue.month))})]})})]})]}):null:b.jsx("div",{className:"projections-explorer",children:b.jsxs("div",{className:"explorer-placeholder",children:[b.jsx(Am,{size:48}),b.jsx("p",{children:"Select a climate zone to explore future projections"})]})})},xge=({onClose:e,activeView:t="seasons"})=>{const n=()=>b.jsxs(b.Fragment,{children:[b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(Xg,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Live Climate Monitoring"}),b.jsx("p",{children:"Current Season displays real-time climate data collected from weather stations within New Zealand wine regions. Data is ingested daily and processed to provide up-to-date growing conditions for the current vintage."}),b.jsxs("p",{children:[b.jsx("strong",{children:"Update frequency:"})," Daily (always before 6pm NZST)",b.jsx("br",{}),b.jsx("strong",{children:"Data sources:"})," Regional weather station network",b.jsx("br",{}),b.jsx("strong",{children:"Season:"})," October 1 to April 30 (Southern Hemisphere growing season)"]})]})]}),b.jsx("section",{className:"about-section",children:b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Contribute Data"}),b.jsx("p",{children:'Some climate zones in wine growing regions are not yet added to the "Current Season", "Phenology", or "Disease Pressures" insights as we do not have enough weather stations contributing to our insights.'}),b.jsxs("p",{children:[b.jsx("strong",{children:"We need your help:"})," Do you have a weather station, and would like to contribute?",b.jsx("br",{}),b.jsx("a",{href:"https://auxein.co.nz/contact",target:"_blank",rel:"noopener noreferrer",children:b.jsx("strong",{children:"Contact Auxein"})}),b.jsx("br",{})]})]})}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(fy,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Growing Degree Days (GDD)"}),b.jsx("p",{children:"GDD measures accumulated heat units above a base temperature, indicating the thermal energy available for vine growth and grape ripening. We calculate and present GDD using base 0C for broader applicability across cool-climate regions."}),b.jsx("code",{children:"GDD =  max(0, Tmean)"}),b.jsx("p",{className:"formula-note",children:"Accumulated from October 1 each season. Baseline comparison uses the 1986-2005 average GDD accumulation for the same date."})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("h3",{children:"Status Indicators"}),b.jsxs("div",{className:"variables-grid",children:[b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Ahead of Baseline"}),b.jsx("p",{children:"Current GDD accumulation is higher than the 1986-2005 average for this point in the season. May indicate earlier phenology and harvest dates."})]}),b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Behind Baseline"}),b.jsx("p",{children:"Current GDD accumulation is lower than average. May indicate later phenological development and extended hang time."})]}),b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Normal"}),b.jsx("p",{children:"Within 5% of baseline accumulation. Season is tracking close to historical averages."})]})]})]})]}),o=()=>b.jsxs(b.Fragment,{children:[b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx($d,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Phenology Prediction Models"}),b.jsx("p",{children:"Phenology estimates predict key grapevine developmental stages based on accumulated Growing Degree Days. These predictions help with harvest planning, spray timing, and resource allocation."}),b.jsx("p",{children:"Our models are built using two studies on international wine growing regions that use GDD threshold to derive phenological timing. Presented in our first release are flowering and harvest estimates as veraison estimates contain higher estimation error."})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(hy,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Scientific Basis"}),b.jsxs("div",{className:"citations-list",children:[b.jsxs("div",{className:"citation-item",children:[b.jsx("strong",{children:"Parker et al. (2011)"}),b.jsx("p",{children:'"General phenological model to characterise the timing of flowering and veraison of Vitis vinifera L."'})]}),b.jsxs("div",{className:"citation-item",children:[b.jsx("strong",{children:"Parker et al. (2020)"}),b.jsx("p",{children:'"Temperature-based grapevine sugar ripeness modelling for a wide range of Vitis vinifera L. cultivars.""'})]})]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon warning",children:b.jsx(Sm,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Interpretation Notes"}),b.jsxs("ul",{className:"guidelines-list",children:[b.jsxs("li",{children:[b.jsx("strong",{children:"Predictions are estimates."})," Actual dates depend on site-specific conditions, vine age, crop load, and management practices."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Vraison predictions have higher uncertainty."})," We are currently not reporting vraison results while we refine our vraison model with local calibration data."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Harvest windows assume typical ripening."})," Actual harvest timing depends on winemaking style and weather conditions."]})]})]})]})]}),u=()=>b.jsxs(b.Fragment,{children:[b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(pF,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Disease Pressure Monitoring"}),b.jsx("p",{children:"Disease pressure indicators are calculated daily using peer-reviewed epidemiological models. These models assess environmental conditions favorable for disease development and infection risk."}),b.jsxs("p",{children:[b.jsx("strong",{children:"Diseases monitored:"})," Powdery Mildew, Downy Mildew, Botrytis",b.jsx("br",{}),b.jsx("strong",{children:"Update frequency:"})," Daily",b.jsx("br",{}),b.jsx("strong",{children:"Data inputs:"})," Temperature, humidity, rainfall, leaf wetness (estimated)"]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("h3",{children:"Disease Models"}),b.jsxs("div",{className:"variables-grid",children:[b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Powdery Mildew"}),b.jsxs("p",{children:[b.jsx("strong",{children:"UC Davis Risk Index"})," (Gubler et al., 1999)",b.jsx("br",{}),"Accumulates risk based on hours in the favorable temperature range (21-30C), with decay during unfavorable conditions and reset after lethal heat events (35C for 6+ hours)."]}),b.jsxs("div",{className:"model-thresholds",children:[b.jsx("span",{children:"Low: <30"}),b.jsx("span",{children:"Moderate: 30-50"}),b.jsx("span",{children:"High: 50-60"}),b.jsx("span",{children:"Extreme: >60"})]})]}),b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Botrytis (Grey Mould)"}),b.jsxs("p",{children:[b.jsx("strong",{children:"Gonzlez-Domnguez Model"})," (2015)",b.jsx("br",{}),"Calculates infection severity based on wetness duration, temperature, and sporulation conditions."]}),b.jsxs("div",{className:"model-thresholds",children:[b.jsx("span",{children:"Low: <25"}),b.jsx("span",{children:"Moderate: 25-50"}),b.jsx("span",{children:"High: 50-75"}),b.jsx("span",{children:"Extreme: >75"})]})]}),b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Downy Mildew"}),b.jsxs("p",{children:[b.jsx("strong",{children:"3-10 Rule + Goidanich Index"}),b.jsx("br",{}),"Primary infection requires: shoots 10mm, 24hr rainfall 10mm, temperature 10C. Secondary spread tracked via the Goidanich sporulation index based on humidity and temperature."]}),b.jsxs("div",{className:"model-thresholds",children:[b.jsx("span",{children:"Low: <25"}),b.jsx("span",{children:"Moderate: 25-50"}),b.jsx("span",{children:"High: 50-75"}),b.jsx("span",{children:"Extreme: >75"})]})]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(Zg,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Leaf Wetness Estimation"}),b.jsx("p",{children:"Where direct leaf wetness sensors are not available, we estimate wetness probability using the Magnus-Tetens dewpoint formula and humidity thresholds:"}),b.jsxs("ul",{className:"guidelines-list",children:[b.jsx("li",{children:"Rainfall occurring  100% wet probability"}),b.jsx("li",{children:"Relative humidity 95%  95% wet probability"}),b.jsx("li",{children:"Dewpoint depression 1C  90% wet probability"}),b.jsx("li",{children:"Post-rain period (6 hours)  Declining probability"})]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon warning",children:b.jsx(Sm,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Important Limitations"}),b.jsxs("ul",{className:"guidelines-list",children:[b.jsxs("li",{children:[b.jsx("strong",{children:"Models indicate environmental risk, not actual infection. "}),"Field scouting remains essential for confirming disease presence."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Zone-level data may not reflect microclimate. "})," Conditions at your specific site may differ from the regional average."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Spray decisions require professional judgment. "})," These indicators support but do not replace viticulturist judgement."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Historical fungicide applications not considered. "})," Actual risk depends on your spray program and product efficacy."]})]})]})]}),b.jsxs("section",{className:"about-section citations",children:[b.jsx("h3",{children:"Scientific References"}),b.jsxs("ul",{className:"citations-list",children:[b.jsxs("li",{children:['Gubler, W.D. et al. (1999). "Control of Powdery Mildew Using the UC Davis Powdery Mildew Risk Index"  UC Davis',b.jsx("a",{href:"https://www.apsnet.org/edcenter/apsnetfeatures/Pages/UCDavisRisk.aspx",target:"_blank",rel:"noopener noreferrer",children:b.jsx(Nd,{size:14})})]}),b.jsxs("li",{children:['Gonzlez-Domnguez, E. et al. (2015). "A Mechanistic Model of Botrytis cinerea on Grapevines That Includes Weather, Vine Growth Stage, and the Main Infection Pathways"',b.jsx("a",{href:"https://www.researchgate.net/publication/282811797_A_Mechanistic_Model_of_Botrytis_cinerea_on_Grapevines_That_Includes_Weather_Vine_Growth_Stage_and_the_Main_Infection_Pathways",target:"_blank",rel:"noopener noreferrer",children:b.jsx(Nd,{size:14})})]}),b.jsxs("li",{children:['Rossi, V. et al. (2008). "A mechanistic model simulating primary infections of downy mildew in grapevine"',b.jsx("a",{href:"https://www.sciencedirect.com/science/article/abs/pii/S0304380007005881",target:"_blank",rel:"noopener noreferrer",children:b.jsx(Nd,{size:14})})]})]})]})]}),d=()=>b.jsxs(b.Fragment,{children:[b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(hy,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Data Source"}),b.jsx("p",{children:"Climate data is sourced from a network of weather stations and the former NIWA CliFlo database. These data were processed through an Auxein-developed interpolation model to determine daily climate at every vineyard in NZ, producing gridded climate data at ~5km resolution."}),b.jsxs("p",{children:[b.jsx("strong",{children:"Historical data:"})," 1986 - 2024",b.jsx("br",{}),b.jsx("strong",{children:"Coverage:"})," Daily climate history for every NZ vineyard",b.jsx("br",{}),b.jsx("strong",{children:"Presented:"})," 20 wine climate zones across NZ"]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(hp,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Baseline Period (1986-2005)"}),b.jsx("p",{children:"All comparisons reference the 1986-2005 baseline period, representing the 20-year average climate conditions. This period aligns with international climate models for projecting future climates and contains reliable instrumental records."}),b.jsx("p",{children:'When you see "vs baseline" comparisons, positive values indicate conditions warmer/wetter than the 1986-2005 average.'})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("h3",{children:"Climate Variables"}),b.jsxs("div",{className:"variables-grid",children:[b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Growing Degree Days (GDD)"}),b.jsx("p",{children:"Accumulated heat units above 10C base temperature during the growing season (October-April). Higher GDD indicates more heat accumulation for grape ripening."}),b.jsx("code",{children:"GDD =  max(0, Tmean - 10)"})]}),b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Temperature"}),b.jsx("p",{children:"Mean (Tmean), maximum (Tmax), and minimum (Tmin) temperatures. Values shown are spatial averages across the climate zone."})]}),b.jsxs("div",{className:"variable-card",children:[b.jsx("h4",{children:"Rainfall"}),b.jsx("p",{children:"Total precipitation in millimetres. Growing season totals (October-April) are particularly relevant for vineyard management."})]})]})]})]}),g=()=>b.jsxs(b.Fragment,{children:[b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(Am,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"SSP Climate Scenarios"}),b.jsx("p",{children:"Future projections are based on Shared Socioeconomic Pathways (SSPs) from the IPCC's 6th Assessment Report and CMIP6 climate models."}),b.jsxs("div",{className:"ssp-list",children:[b.jsxs("div",{className:"ssp-item ssp126",children:[b.jsx("span",{className:"ssp-badge",children:"SSP1-2.6"}),b.jsxs("span",{className:"ssp-desc",children:[b.jsx("strong",{children:"Sustainability pathway"}),"  Strong emissions reductions, limiting warming to ~1.8C by 2100"]})]}),b.jsxs("div",{className:"ssp-item ssp245",children:[b.jsx("span",{className:"ssp-badge",children:"SSP2-4.5"}),b.jsxs("span",{className:"ssp-desc",children:[b.jsx("strong",{children:"Middle of the road"}),"  Intermediate emissions, warming of ~2.7C by 2100"]})]}),b.jsxs("div",{className:"ssp-item ssp370",children:[b.jsx("span",{className:"ssp-badge",children:"SSP3-7.0"}),b.jsxs("span",{className:"ssp-desc",children:[b.jsx("strong",{children:"Regional rivalry"}),"  Limited mitigation, warming of ~3.6C by 2100"]})]})]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("h3",{children:"Projection Time Periods"}),b.jsxs("div",{className:"periods-grid",children:[b.jsxs("div",{className:"period-item",children:[b.jsx("span",{className:"period-label",children:"Near-term"}),b.jsx("span",{className:"period-years",children:"2021-2040"}),b.jsx("span",{className:"period-desc",children:"Changes already locked in, regardless of emissions pathway"})]}),b.jsxs("div",{className:"period-item",children:[b.jsx("span",{className:"period-label",children:"Mid-century"}),b.jsx("span",{className:"period-years",children:"2041-2060"}),b.jsx("span",{className:"period-desc",children:"Scenarios begin to diverge based on emissions"})]}),b.jsxs("div",{className:"period-item",children:[b.jsx("span",{className:"period-label",children:"End of century"}),b.jsx("span",{className:"period-years",children:"2080-2099"}),b.jsx("span",{className:"period-desc",children:"Large differences between low and high emissions scenarios"})]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon warning",children:b.jsx(Sm,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h3",{children:"Interpretation Guidelines"}),b.jsxs("ul",{className:"guidelines-list",children:[b.jsxs("li",{children:[b.jsx("strong",{children:"Projections show trends, not predictions."})," Individual years will vary around projected averages."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Uncertainty increases with time."})," Near-term projections are more reliable than end-of-century projections."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Zone averages smooth local variation."})," Conditions at specific vineyard sites may differ from zone-level summaries."]}),b.jsxs("li",{children:[b.jsx("strong",{children:"Climate is only one factor."})," Vineyard success depends on many factors including soils, management, and variety selection."]})]})]})]}),b.jsxs("section",{className:"about-section citations",children:[b.jsx("h3",{children:"Data Sources & References"}),b.jsxs("ul",{className:"citations-list",children:[b.jsxs("li",{children:["IPCC AR6 Climate Projections",b.jsx("a",{href:"https://www.ipcc.ch/report/ar6/wg1/",target:"_blank",rel:"noopener noreferrer",children:b.jsx(Nd,{size:14})})]}),b.jsxs("li",{children:["Ministry for the Environment - Climate Change Projections for NZ",b.jsx("a",{href:"https://environment.govt.nz/publications/climate-change-projections-for-new-zealand/",target:"_blank",rel:"noopener noreferrer",children:b.jsx(Nd,{size:14})})]})]})]})]}),i={currentseason:"About Current Season Data",phenology:"About Phenology Predictions",disease:"About Disease Pressure Models",seasons:"About Historical Climate Data",projections:"About Climate Projections"},E=()=>{switch(t){case"currentseason":return b.jsx(n,{});case"phenology":return b.jsx(o,{});case"disease":return b.jsx(u,{});case"projections":return b.jsx(g,{});case"seasons":default:return b.jsx(d,{})}};return b.jsx("div",{className:"climate-about-overlay",onClick:e,children:b.jsxs("div",{className:"climate-about-modal",onClick:P=>P.stopPropagation(),children:[b.jsxs("div",{className:"about-header",children:[b.jsx("h2",{children:i[t]||"About Climate Data"}),b.jsx("button",{className:"close-btn",onClick:e,"aria-label":"Close",children:b.jsx(hl,{size:24})})]}),b.jsx("div",{className:"about-content",children:E()}),b.jsxs("div",{className:"about-footer",children:[b.jsx("p",{children:"Data prepared by Auxein Limited for Regional Intelligence. For commercial vineyard-specific analysis, contact us about Auxein Insights Pro."}),b.jsx("button",{className:"close-about-btn",onClick:e,children:"Close"})]})]})})},DE={currentseason:{label:"Current Season",shortLabel:"Season",description:"Live climate data and GDD accumulation",component:fge,allowComparison:!1,useRealtimeSelector:!0,icon:hF},phenology:{label:"Phenology",shortLabel:"Phenology",description:"Growth stage estimates and harvest predictions",component:pge,allowComparison:!1,useRealtimeSelector:!0,icon:$d},disease:{label:"Disease Pressure",shortLabel:"Disease",description:"Risk indicators for downy mildew, powdery mildew, and botrytis",component:mge,allowComparison:!1,useRealtimeSelector:!0,icon:dy},seasons:{label:"Climate History",shortLabel:"History",description:"Historical growing season analysis",component:gge,allowComparison:!0,useRealtimeSelector:!1,icon:dF},projections:{label:"Future Projections",shortLabel:"Projections",description:"SSP climate scenarios to 2100",component:vge,allowComparison:!1,useRealtimeSelector:!1,icon:cF}},bge=["currentseason","phenology","disease","seasons","projections"],wge=({initialView:e="currentseason",onClose:t})=>{const[n,o]=te.useState(null),[u,d]=te.useState([]),[g,i]=te.useState(e),[E,P]=te.useState(!1),I=te.useRef(null);te.useEffect(()=>{i(e)},[e]);const D=DE[g]||DE.currentseason,F=D.component,$=le=>{o(le),d([])},Z=le=>{const ue=le.filter(ye=>ye.slug!==(n==null?void 0:n.slug));d(ue.slice(0,4))},q=le=>{if(i(le),I.current){const ue=I.current.querySelector(`[data-view="${le}"]`);ue&&ue.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}},X=()=>D.useRealtimeSelector?b.jsx(ehe,{selectedZone:n,onZoneChange:$,label:"Climate Zone"}):b.jsx(Vue,{selectedZone:n,onZoneChange:$,comparisonZones:u,onComparisonZonesChange:Z,allowComparison:D.allowComparison}),re=()=>["currentseason","phenology","disease"].includes(g)?"Real-time data from weather station network. Updated daily.":"Climate Baseline: 1986-2005. Projections: CMIP6 models (SSP1-2.6, SSP2-4.5, SSP3-7.0).";return b.jsxs("div",{className:"public-climate-container",children:[b.jsxs("div",{className:"climate-header",children:[b.jsxs("div",{className:"header-title",children:[b.jsx("h2",{children:D.label}),b.jsxs("button",{className:"about-btn",onClick:()=>P(!0),title:"About this data",children:[b.jsx(KW,{size:18}),b.jsx("span",{children:"About"})]})]}),t&&b.jsx("button",{className:"close-btn",onClick:t,"aria-label":"Close",children:b.jsx(hl,{size:24})})]}),b.jsx("div",{className:"climate-view-tabs-wrapper",children:b.jsx("div",{className:"climate-view-tabs",ref:I,children:bge.map(le=>{const ue=DE[le],ye=ue.icon,ge=g===le;return b.jsxs("button",{"data-view":le,className:`view-tab ${ge?"active":""}`,onClick:()=>q(le),"aria-pressed":ge,title:ue.description,children:[b.jsx(ye,{size:18}),b.jsx("span",{className:"tab-label-full",children:ue.label}),b.jsx("span",{className:"tab-label-short",children:ue.shortLabel})]},le)})})}),b.jsx("div",{className:"zone-selector-container",children:X()}),b.jsx("div",{className:"climate-content",children:b.jsx(F,{zone:n,comparisonZones:u,onComparisonZonesChange:Z})}),b.jsxs("div",{className:"climate-attribution",children:[b.jsx(uC,{size:14}),b.jsx("span",{children:re()})]}),E&&b.jsx(xge,{onClose:()=>P(!1),activeView:g})]})},Sge="auxein.co.nz",Tge=e=>e?e.toLowerCase().endsWith(`@${Sge}`):!1;function Ege(){const[e,t]=te.useState("up"),[n,o]=te.useState(!0),u=te.useRef(0),d=te.useRef(!1);return te.useEffect(()=>{const E=()=>{const I=window.scrollY;if(o(I<50),Math.abs(I-u.current)<10){d.current=!1;return}t(I>u.current?"down":"up"),u.current=I>0?I:0,d.current=!1},P=()=>{d.current||(window.requestAnimationFrame(E),d.current=!0)};return window.addEventListener("scroll",P,{passive:!0}),()=>window.removeEventListener("scroll",P)},[]),{scrollDirection:e,isAtTop:n}}function Age(){const[e,t]=te.useState(null),{isAuthenticated:n,user:o,logout:u}=Ry(),[d,g]=te.useState(!1),[i,E]=te.useState(""),[P,I]=te.useState(!1),[D,F]=te.useState(!1),[$,Z]=te.useState(!1),[q,X]=te.useState(!1),{scrollDirection:re,isAtTop:le}=Ege(),[ue,ye]=te.useState(!1),ge=n&&Tge(o==null?void 0:o.email),[we,Le]=iF(),Ze=we.get("token");te.useEffect(()=>{Ze&&Z(!0)},[Ze]),te.useEffect(()=>{const Xt=()=>ye(window.innerWidth<=768);return Xt(),window.addEventListener("resize",Xt),()=>window.removeEventListener("resize",Xt)},[]),te.useEffect(()=>{const Xt=()=>{window.innerWidth>768&&X(!1)};return window.addEventListener("resize",Xt),()=>window.removeEventListener("resize",Xt)},[]),te.useEffect(()=>(q?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[q]);const Ge=()=>{Z(!1),Ze&&(we.delete("token"),Le(we))},gt=[{id:"marlborough",name:"Marlborough",temp:"15.2C",gdd:1250,lat:-41.5,lon:173.9},{id:"central-otago",name:"Central Otago",temp:"11.8C",gdd:1050,lat:-45,lon:169.1},{id:"waipara",name:"Waipara",temp:"13.5C",gdd:1150,lat:-43,lon:172.7},{id:"hawkes-bay",name:"Hawke's Bay",temp:"15.8C",gdd:1400,lat:-39.6,lon:176.9}],lt=[{id:"currentseason",icon:b.jsx(hF,{size:28}),label:"Current Season",hasComponent:!0,initialView:"currentseason"},{id:"phenology",icon:b.jsx($d,{size:28}),label:"Phenology",hasComponent:!0,initialView:"phenology"},{id:"disease",icon:b.jsx(dy,{size:28}),label:"Disease Pressures",hasComponent:!0,initialView:"disease"},{id:"climatehistory",icon:b.jsx(dF,{size:28}),label:"Climate History",hasComponent:!0,initialView:"seasons"},{id:"climateprojections",icon:b.jsx(cF,{size:28}),label:"Climate Projections",hasComponent:!0,initialView:"projections"}],qe=Xt=>{if(!n){E("insights"),g(!0);return}t(e===Xt?null:Xt),e!==Xt&&setTimeout(()=>{var et;(et=document.getElementById("insights-section"))==null||et.scrollIntoView({behavior:"smooth",block:"start"})},100)},en=()=>n?!0:(E("map"),g(!0),!1),Jt=()=>{u(),F(!1),X(!1),t(null)},Nt=()=>{F(!1),X(!1),I(!0)},St=()=>{g(!1),E("")},an=()=>{X(!1)},Kt=()=>{const Xt=lt.find(et=>et.id===e);return Xt?Xt.hasComponent?b.jsx("div",{className:"insight-content-wrapper",children:b.jsx(wge,{initialView:Xt.initialView,onClose:()=>t(null)})}):b.jsxs("div",{className:"insight-content-wrapper",children:[b.jsxs("div",{className:"insight-header",children:[b.jsx("h3",{children:Xt.label}),b.jsx("button",{className:"close-insight-btn",onClick:()=>t(null),"aria-label":`Close ${Xt.label}`,children:b.jsx(hl,{size:24})})]}),b.jsx("div",{className:"insight-placeholder",children:b.jsx("p",{children:Xt.placeholder})})]}):null},hn=ue&&re==="down"&&!le&&!q;return b.jsxs("div",{className:"landing-page",children:[b.jsx("header",{className:`landing-header ${hn?"header-hidden":""}`,children:b.jsxs("div",{className:"header-container",children:[b.jsxs("div",{className:"header-brand",children:[b.jsx("img",{src:uV,alt:"Auxein Logo",className:"header-logo"}),b.jsxs("div",{className:"header-title-block",children:[b.jsx("h1",{children:"Auxein Insights"}),b.jsx("p",{children:"Regional Intelligence"})]})]}),b.jsxs("nav",{className:"header-nav desktop-nav",children:[b.jsx(La,{to:"/about",children:"About"}),b.jsx("a",{href:"https://auxein.co.nz/log-in",target:"_blank",rel:"noopener noreferrer",children:"Insights-Pro"}),b.jsx("a",{href:"https://auxein.co.nz",target:"_blank",rel:"noopener noreferrer",children:"Auxein"}),ge&&b.jsxs(La,{to:"/admin",className:"admin-header-link",children:[b.jsx(Fg,{size:16}),"Admin"]}),n?b.jsxs("div",{className:"user-menu-container",children:[b.jsxs("button",{className:"user-menu-trigger",onClick:()=>F(!D),children:[b.jsx(Bb,{size:18}),b.jsx("span",{children:(o==null?void 0:o.first_name)||"Account"})]}),D&&b.jsxs("div",{className:"user-dropdown",children:[b.jsxs("div",{className:"user-dropdown-header",children:[b.jsx("strong",{children:(o==null?void 0:o.full_name)||(o==null?void 0:o.email)}),(o==null?void 0:o.user_type)&&b.jsx("small",{children:o.user_type.replace("_"," ")})]}),ge&&b.jsxs(La,{to:"/admin",className:"user-dropdown-item",onClick:()=>F(!1),children:[b.jsx(Fg,{size:16}),"Admin Dashboard"]}),b.jsxs("button",{className:"user-dropdown-item",onClick:Nt,children:[b.jsx(_O,{size:16}),"Preferences"]}),b.jsxs("button",{className:"user-dropdown-item",onClick:Jt,children:[b.jsx(mO,{size:16}),"Sign Out"]})]})]}):b.jsx("button",{className:"auth-header-btn",onClick:()=>{E("header"),g(!0)},children:"Sign In"})]}),b.jsx("button",{className:"mobile-menu-btn",onClick:()=>X(!q),"aria-label":"Toggle menu","aria-expanded":q,children:q?b.jsx(hl,{size:24}):b.jsx(A7,{size:24})})]})}),q&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"mobile-menu-overlay",onClick:an}),b.jsxs("nav",{className:"mobile-nav",children:[b.jsx("button",{className:"mobile-nav-close",onClick:an,"aria-label":"Close menu",children:b.jsx(hl,{size:24})}),b.jsx(La,{to:"/about",onClick:an,children:"About"}),b.jsx("a",{href:"https://auxein.co.nz/log-in",target:"_blank",rel:"noopener noreferrer",onClick:an,children:"Insights-Pro"}),b.jsx("a",{href:"https://auxein.co.nz",target:"_blank",rel:"noopener noreferrer",onClick:an,children:"Auxein"}),ge&&b.jsxs(La,{to:"/admin",className:"mobile-admin-link",onClick:an,children:[b.jsx(Fg,{size:18}),"Admin Dashboard"]}),b.jsx("div",{className:"mobile-nav-divider"}),n?b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"mobile-user-info",children:[b.jsx(Bb,{size:20}),b.jsxs("div",{children:[b.jsx("strong",{children:(o==null?void 0:o.full_name)||(o==null?void 0:o.first_name)||"Account"}),(o==null?void 0:o.email)&&b.jsx("small",{children:o.email})]})]}),b.jsxs("button",{className:"mobile-nav-item",onClick:()=>{an(),Nt()},children:[b.jsx(_O,{size:18}),"Preferences"]}),b.jsxs("button",{className:"mobile-nav-item mobile-logout",onClick:()=>{an(),Jt()},children:[b.jsx(mO,{size:18}),"Sign Out"]})]}):b.jsxs("button",{className:"mobile-auth-btn",onClick:()=>{an(),E("header"),g(!0)},children:[b.jsx(Bb,{size:18}),"Sign In"]})]})]}),b.jsxs("section",{id:"insights-section",className:"insights-section",children:[b.jsxs("div",{className:"section-header",children:[b.jsx("h2",{children:"Vine - Sights"}),!n&&b.jsxs("span",{className:"auth-hint",children:[b.jsx(O2,{size:14})," Sign in to access insights"]})]}),b.jsx("div",{className:"insights-grid",children:lt.map(Xt=>b.jsxs("button",{className:`insight-card ${e===Xt.id?"active":""} ${n?"":"locked"}`,onClick:()=>qe(Xt.id),children:[b.jsx("div",{className:"insight-icon",children:Xt.icon}),b.jsx("div",{className:"insight-label",children:Xt.label}),!n&&b.jsx("div",{className:"card-lock-overlay",children:b.jsx(O2,{size:20})})]},Xt.id))}),e&&n&&b.jsx("div",{className:"active-insight-container",children:Kt()})]}),b.jsxs("section",{className:"map-section",children:[b.jsxs("div",{className:"section-header",children:[b.jsx("h2",{children:"Regional Explorer"}),!n&&b.jsxs("span",{className:"auth-hint",children:[b.jsx(O2,{size:14})," Sign in to explore the map"]})]}),b.jsx("div",{className:`map-container-wrapper ${n?"":"locked"}`,children:n?b.jsx(dN,{regions:gt}):b.jsxs("div",{className:"map-locked-overlay",onClick:en,children:[b.jsxs("div",{className:"map-lock-content",children:[b.jsx("h3",{children:"Vine Atlas"}),b.jsx("p",{children:"Sign in to explore New Zealand wine regions"})]}),b.jsx("div",{className:"map-preview-blur",children:b.jsx(dN,{regions:gt})})]})})]}),b.jsx("section",{className:"about-cta-section",children:b.jsx("div",{className:"about-content",children:b.jsxs("div",{className:"premium-cta",children:[b.jsx("h3",{children:"Vineyard Management & Insights"}),b.jsx("p",{children:"Our premium Auxein Insights platform offers vineyard-specific climate analysis, risk management tools, and comprehensive management features."}),b.jsx("a",{href:"https://auxein.co.nz/",target:"_blank",rel:"noopener noreferrer",className:"premium-btn",children:"Explore Auxein Insights "})]})})}),b.jsx("footer",{className:"landing-footer",children:b.jsxs("div",{className:"footer-content",children:[b.jsxs("div",{className:"footer-brand",children:[b.jsx("img",{src:Pue,alt:"Auxein Logo",className:"footer-logo"}),b.jsx("p",{children:"Auxein Insights"})]}),b.jsxs("div",{className:"footer-links",children:[b.jsx(La,{to:"/about",children:"About"}),b.jsx("a",{href:"https://auxein.co.nz",target:"_blank",rel:"noopener noreferrer",children:"Auxein"}),b.jsx("a",{href:"https://auxein.co.nz/contact",target:"_blank",rel:"noopener noreferrer",children:"Contact"})]}),b.jsxs("div",{className:"footer-copyright",children:[" ",new Date().getFullYear()," Auxein Limited. All rights reserved."]})]})}),b.jsx(Rue,{isOpen:d,onClose:St,context:i}),b.jsx(Oue,{isOpen:P,onClose:()=>I(!1)}),b.jsx(Due,{isOpen:$,onClose:Ge,token:Ze}),D&&b.jsx("div",{className:"user-menu-overlay",onClick:()=>F(!1)})]})}const Cge=()=>b.jsxs("div",{className:"about-page",children:[b.jsxs("header",{className:"about-page-header",children:[b.jsxs(La,{to:"/",className:"back-link",children:[b.jsx(aF,{size:20}),b.jsx("span",{children:"Back to Regional Intelligence"})]}),b.jsx("img",{src:uV,alt:"Auxein",className:"about-logo"})]}),b.jsx("main",{className:"about-page-content",children:b.jsxs("div",{className:"about-container",children:[b.jsxs("section",{className:"about-hero",children:[b.jsx("h1",{children:"About Auxein Insights"}),b.jsx("p",{className:"hero-subtitle",children:"Climate intelligence for New Zealand viticulture"})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx($d,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h2",{children:"Our Mission"}),b.jsx("p",{children:"Auxein Insights provides comprehensive climate intelligence for New Zealand's wine industry, helping viticulturists and wine professionals make informed decisions based on robust climate data and forward-looking projections."}),b.jsx("p",{children:"We believe that understanding climatepast, present, and futureis essential for sustainable viticulture and informed vineyard management decisions."})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("h2",{children:"Regional Intelligence Platform"}),b.jsxs("div",{className:"features-grid",children:[b.jsxs("div",{className:"feature-card",children:[b.jsx("div",{className:"feature-icon",children:b.jsx(hy,{size:20})}),b.jsx("h3",{children:"Climate History"}),b.jsx("p",{children:"37 years of historical climate data (1987-2023) for 20 wine climate zones, derived from NIWA's Virtual Climate Station Network."})]}),b.jsxs("div",{className:"feature-card",children:[b.jsx("div",{className:"feature-icon",children:b.jsx(Am,{size:20})}),b.jsx("h3",{children:"Future Projections"}),b.jsx("p",{children:"CMIP6 climate projections under three SSP scenarios, showing how conditions may change through to 2100."})]}),b.jsxs("div",{className:"feature-card",children:[b.jsx("div",{className:"feature-icon",children:b.jsx(aa,{size:20})}),b.jsx("h3",{children:"Zone Comparison"}),b.jsx("p",{children:"Compare climate patterns across New Zealand's wine regions to understand regional differences and identify analogues."})]}),b.jsxs("div",{className:"feature-card",children:[b.jsx("div",{className:"feature-icon",children:b.jsx(qg,{size:20})}),b.jsx("h3",{children:"Season Analysis"}),b.jsx("p",{children:"Detailed growing season breakdowns showing monthly patterns for GDD, rainfall, and temperature metrics."})]})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("div",{className:"section-icon",children:b.jsx(Fg,{size:24})}),b.jsxs("div",{className:"section-content",children:[b.jsx("h2",{children:"About Auxein Limited"}),b.jsx("p",{children:"Auxein Limited is a New Zealand climate technology company focused on the wine industry. Founded with a vision to democratise access to climate intelligence, we develop tools that help the wine sector understand and adapt to changing conditions."}),b.jsx("p",{children:"Our team combines expertise in climatology, viticulture, and software development to create practical tools for the wine industry."})]})]}),b.jsxs("section",{className:"about-section",children:[b.jsx("h2",{children:"Data Sources"}),b.jsxs("div",{className:"data-sources-list",children:[b.jsxs("div",{className:"data-source-item",children:[b.jsx("h4",{children:"Historical Climate Data"}),b.jsx("p",{children:"NIWA Virtual Climate Station Network (VCSN)  daily gridded climate data at ~5km resolution, aggregated to monthly values for wine climate zones."}),b.jsxs("a",{href:"https://niwa.co.nz/climate/our-services/virtual-climate-stations",target:"_blank",rel:"noopener noreferrer",className:"source-link",children:["Learn more ",b.jsx(Nd,{size:14})]})]}),b.jsxs("div",{className:"data-source-item",children:[b.jsx("h4",{children:"Climate Projections"}),b.jsx("p",{children:"CMIP6 climate model ensemble, downscaled for New Zealand conditions. Based on IPCC AR6 Shared Socioeconomic Pathways (SSPs)."}),b.jsxs("a",{href:"https://www.ipcc.ch/report/ar6/wg1/",target:"_blank",rel:"noopener noreferrer",className:"source-link",children:["IPCC AR6 Report ",b.jsx(Nd,{size:14})]})]}),b.jsxs("div",{className:"data-source-item",children:[b.jsx("h4",{children:"Wine Climate Zones"}),b.jsx("p",{children:"20 climate zones defined based on New Zealand's wine-growing regions, aligned with Geographical Indications where applicable."})]})]})]}),b.jsx("section",{className:"about-section premium-section",children:b.jsxs("div",{className:"premium-content",children:[b.jsx("h2",{children:"Auxein Insights Pro"}),b.jsx("p",{children:"For vineyard-specific climate analysis, risk management tools, and comprehensive vineyard management features, explore our premium platform."}),b.jsxs("div",{className:"premium-features",children:[b.jsx("span",{className:"premium-feature",children:"Vineyard-specific climate data"}),b.jsx("span",{className:"premium-feature",children:"Custom risk assessments"}),b.jsx("span",{className:"premium-feature",children:"Block-level management"}),b.jsx("span",{className:"premium-feature",children:"Observation tracking"}),b.jsx("span",{className:"premium-feature",children:"Compliance reporting"})]}),b.jsx("a",{href:"https://auxein.co.nz",target:"_blank",rel:"noopener noreferrer",className:"premium-btn",children:"Explore Auxein Insights Pro "})]})}),b.jsxs("section",{className:"about-section contact-section",children:[b.jsx("h2",{children:"Get in Touch"}),b.jsxs("div",{className:"contact-grid",children:[b.jsxs("a",{href:"mailto:hello@auxein.co.nz",className:"contact-card",children:[b.jsx(cw,{size:20}),b.jsx("span",{children:"hello@auxein.co.nz"})]}),b.jsxs("a",{href:"https://auxein.co.nz",target:"_blank",rel:"noopener noreferrer",className:"contact-card",children:[b.jsx(Nd,{size:20}),b.jsx("span",{children:"auxein.co.nz"})]})]})]})]})}),b.jsxs("footer",{className:"about-page-footer",children:[b.jsxs("p",{children:[" ",new Date().getFullYear()," Auxein Limited. All rights reserved."]}),b.jsx("p",{className:"footer-location",children:"Canterbury, New Zealand"})]})]}),Dh=({children:e,title:t,subtitle:n,backLink:o,backText:u})=>{const d=Bh(),g=[{path:"/admin",icon:_7,label:"Dashboard"},{path:"/admin/users",icon:FE,label:"Users"},{path:"/admin/weather",icon:qg,label:"Weather"}],i=E=>E==="/admin"?d.pathname==="/admin":d.pathname.startsWith(E);return b.jsxs("div",{className:"admin-page",children:[b.jsx("nav",{className:"admin-nav-bar",children:b.jsxs("div",{className:"admin-nav-container",children:[b.jsx("div",{className:"admin-nav-brand",children:b.jsxs(La,{to:"/",className:"admin-nav-logo",children:[b.jsx("span",{className:"admin-nav-logo-text",children:"Auxein"}),b.jsx("span",{className:"admin-nav-logo-badge",children:"Admin"})]})}),b.jsx("div",{className:"admin-nav-links",children:g.map(E=>b.jsxs(La,{to:E.path,className:`admin-nav-link ${i(E.path)?"active":""}`,children:[b.jsx(E.icon,{size:18}),b.jsx("span",{children:E.label})]},E.path))}),b.jsx("div",{className:"admin-nav-right",children:b.jsx(La,{to:"/",className:"admin-nav-exit",children:"Exit Admin"})})]})}),b.jsx("main",{className:"admin-main",children:b.jsxs("div",{className:"admin-container",children:[o&&b.jsxs(La,{to:o,className:"back-link",children:[b.jsx(aF,{size:16}),u||"Back"]}),t&&b.jsx("div",{className:"admin-header",children:b.jsxs("div",{children:[b.jsx("h1",{children:t}),n&&b.jsx("p",{children:n})]})}),e]})})]})},Go="/admin",Pge={getStats:async()=>(await ui.get(`${Go}/users/stats`)).data,listUsers:async(e={})=>(await ui.get(`${Go}/users`,{params:e})).data,getUser:async e=>(await ui.get(`${Go}/users/${e}`)).data,updateUser:async(e,t)=>(await ui.patch(`${Go}/users/${e}`,t)).data,exportUsers:async(e={})=>{const t=await ui.get(`${Go}/users/export`,{params:e,responseType:"blob"}),n=new Blob([t.data],{type:"text/csv"}),o=window.URL.createObjectURL(n),u=document.createElement("a");u.href=o,u.download=`users_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(o)},getSegments:async()=>(await ui.get(`${Go}/users/segments`)).data,getActivity:async(e=7,t=50)=>(await ui.get(`${Go}/users/activity`,{params:{days:e,limit:t}})).data},Ige={getStationStats:async()=>(await ui.get(`${Go}/weather/stations/stats`)).data,listStations:async(e={})=>(await ui.get(`${Go}/weather/stations`,{params:e})).data,getStation:async e=>(await ui.get(`${Go}/weather/stations/${e}`)).data,getStationHealth:async e=>(await ui.get(`${Go}/weather/stations/${e}/health`)).data,getIngestionLogs:async(e={})=>(await ui.get(`${Go}/weather/ingestion/logs`,{params:e})).data,getIngestionSummary:async(e=7)=>(await ui.get(`${Go}/weather/ingestion/summary`,{params:{days:e}})).data,cleanupLogs:async(e=30)=>(await ui.delete(`${Go}/weather/ingestion/logs/cleanup`,{params:{days_to_keep:e}})).data},Mge={getOverview:async()=>(await ui.get(`${Go}/data/overview`)).data,getGaps:async(e={})=>(await ui.get(`${Go}/data/gaps`,{params:e})).data,getQualityIssues:async(e={})=>(await ui.get(`${Go}/data/quality-issues`,{params:e})).data,getCoverage:async(e={})=>(await ui.get(`${Go}/data/coverage`,{params:e})).data,getClimateStatus:async()=>(await ui.get(`${Go}/data/climate/status`)).data},Eu={users:Pge,weather:Ige,data:Mge},fm=({title:e,value:t,subtitle:n,icon:o,color:u="blue"})=>b.jsx("div",{className:`stats-card ${u}`,children:b.jsxs("div",{className:"stats-card-content",children:[b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-title",children:e}),b.jsx("p",{className:"stats-card-value",children:t}),n&&b.jsx("p",{className:"stats-card-subtitle",children:n})]}),b.jsx("div",{className:"stats-card-icon",children:b.jsx(o,{size:24})})]})}),kge=()=>{var $,Z,q,X;const[e,t]=te.useState(!0),[n,o]=te.useState(null),[u,d]=te.useState(null),[g,i]=te.useState(null),[E,P]=te.useState(null),[I,D]=te.useState(null),F=async()=>{t(!0),o(null);try{const[re,le,ue,ye]=await Promise.all([Eu.users.getStats(),Eu.weather.getStationStats(),Eu.users.getActivity(7,10),Eu.weather.getIngestionSummary(7)]);d(re),i(le),P(ue),D(ye)}catch(re){console.error("Failed to fetch dashboard data:",re),o("Failed to load dashboard data. Please try again.")}finally{t(!1)}};return te.useEffect(()=>{F()},[]),e?b.jsx(Dh,{title:"Admin Dashboard",subtitle:"Loading...",children:b.jsx("div",{className:"loading-container",children:b.jsx("div",{className:"loading-spinner",children:b.jsx(sc,{size:32})})})}):n?b.jsx(Dh,{title:"Admin Dashboard",children:b.jsxs("div",{className:"error-container",children:[b.jsx("p",{className:"error-text",children:n}),b.jsx("button",{onClick:F,className:"btn btn-primary mt-2",children:"Try again"})]})}):b.jsxs(Dh,{title:"Admin Dashboard",subtitle:"Regional Intelligence monitoring overview",children:[b.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"1rem"},children:b.jsxs("button",{onClick:F,className:"btn btn-secondary",children:[b.jsx(sc,{size:16}),"Refresh"]})}),b.jsxs("section",{className:"mb-6",children:[b.jsxs("div",{className:"section-header",children:[b.jsxs("h2",{className:"section-title",children:[b.jsx(FE,{size:20})," User Overview"]}),b.jsx(La,{to:"/admin/users",className:"section-link",children:"View all users "})]}),b.jsxs("div",{className:"stats-grid",children:[b.jsx(fm,{title:"Total Users",value:(u==null?void 0:u.total_users)||0,subtitle:`${(u==null?void 0:u.verified_users)||0} verified`,icon:FE,color:"blue"}),b.jsx(fm,{title:"Active (30 days)",value:(u==null?void 0:u.active_last_30_days)||0,subtitle:`${(u==null?void 0:u.active_last_7_days)||0} in last 7 days`,icon:aq,color:"green"}),b.jsx(fm,{title:"New This Month",value:(u==null?void 0:u.signups_this_month)||0,subtitle:`${(u==null?void 0:u.signups_this_week)||0} this week`,icon:cq,color:"purple"}),b.jsx(fm,{title:"Newsletter Opt-ins",value:(($=u==null?void 0:u.opt_ins)==null?void 0:$.newsletter)||0,subtitle:`${((Z=u==null?void 0:u.opt_ins)==null?void 0:Z.newsletter_pct)||0}% of verified`,icon:Am,color:"indigo"})]}),(u==null?void 0:u.by_type)&&u.by_type.length>0&&b.jsx("div",{className:"card mt-4",children:b.jsxs("div",{className:"card-body",children:[b.jsx("h3",{className:"text-sm font-medium text-gray mb-3",children:"Users by Type"}),b.jsx("div",{className:"breakdown-grid",children:u.by_type.map(re=>{var le;return b.jsxs("div",{className:"breakdown-item",children:[b.jsx("p",{className:"breakdown-value",children:re.count}),b.jsx("p",{className:"breakdown-label",children:((le=re.user_type)==null?void 0:le.replace(/_/g," "))||"Unknown"})]},re.user_type)})})]})}),(u==null?void 0:u.by_region)&&u.by_region.length>0&&b.jsx("div",{className:"card mt-4",children:b.jsxs("div",{className:"card-body",children:[b.jsx("h3",{className:"text-sm font-medium text-gray mb-3",children:"Users by Region of Interest"}),b.jsx("div",{className:"breakdown-grid",children:u.by_region.map(re=>{var le;return b.jsxs("div",{className:"breakdown-item",children:[b.jsx("p",{className:"breakdown-value",children:re.count}),b.jsx("p",{className:"breakdown-label",children:((le=re.region_of_interest)==null?void 0:le.replace(/_/g," "))||"Not specified"})]},re.region_of_interest||"none")})})]})})]}),b.jsxs("section",{className:"mb-6",children:[b.jsxs("div",{className:"section-header",children:[b.jsxs("h2",{className:"section-title",children:[b.jsx(qg,{size:20})," Weather Infrastructure"]}),b.jsx(La,{to:"/admin/weather",className:"section-link",children:"View all stations "})]}),b.jsxs("div",{className:"stats-grid",children:[b.jsx(fm,{title:"Active Stations",value:(g==null?void 0:g.active_stations)||0,subtitle:`${(g==null?void 0:g.total_stations)||0} total`,icon:qg,color:"cyan"}),b.jsx(fm,{title:"Healthy",value:(g==null?void 0:g.healthy_stations)||0,icon:s_,color:"green"}),b.jsx(fm,{title:"Stale",value:(g==null?void 0:g.stale_stations)||0,icon:o_,color:"yellow"}),b.jsx(fm,{title:"Offline",value:(g==null?void 0:g.offline_stations)||0,icon:lw,color:"red"})]}),(g==null?void 0:g.by_source)&&b.jsx("div",{className:"card mt-4",children:b.jsxs("div",{className:"card-body",children:[b.jsx("h3",{className:"text-sm font-medium text-gray mb-3",children:"Stations by Source"}),b.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem"},children:Object.entries(g.by_source).map(([re,le])=>b.jsxs("div",{className:"breakdown-item",style:{padding:"0.5rem 1rem"},children:[b.jsx("span",{className:"font-medium",children:re}),b.jsxs("span",{className:"text-muted",children:[" (",le,")"]})]},re))})]})}),(I==null?void 0:I.by_source)&&I.by_source.length>0&&b.jsx("div",{className:"card mt-4",children:b.jsxs("div",{className:"card-body",children:[b.jsxs("h3",{className:"text-sm font-medium text-gray mb-3",children:["Ingestion Success (Last 7 Days)  ",I.overall_success_rate_pct,"% overall"]}),I.by_source.map(re=>b.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[b.jsx("span",{className:"text-sm",children:re.data_source}),b.jsxs("div",{className:"progress-with-label",children:[b.jsx("div",{className:"progress-bar",children:b.jsx("div",{className:`progress-bar-fill ${re.success_rate_pct>=95?"green":re.success_rate_pct>=80?"yellow":"red"}`,style:{width:`${re.success_rate_pct}%`}})}),b.jsxs("span",{className:`progress-label ${re.success_rate_pct>=95?"green":re.success_rate_pct>=80?"yellow":"red"}`,children:[re.success_rate_pct,"%"]})]})]},re.data_source))]})}),(g==null?void 0:g.records_last_7d)!==void 0&&b.jsx("div",{className:"card mt-4",children:b.jsx("div",{className:"card-body",children:b.jsxs("div",{style:{display:"flex",justifyContent:"space-around",textAlign:"center"},children:[b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-value",children:((q=g.records_last_7d)==null?void 0:q.toLocaleString())||0}),b.jsx("p",{className:"text-sm text-muted",children:"Records (7 days)"})]}),b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-value",children:((X=g.records_last_24h)==null?void 0:X.toLocaleString())||0}),b.jsx("p",{className:"text-sm text-muted",children:"Records (24 hours)"})]})]})})})]}),(E==null?void 0:E.events)&&E.events.length>0&&b.jsxs("section",{children:[b.jsxs("h2",{className:"section-title mb-4",children:[b.jsx(uy,{size:20})," Recent Activity"]}),b.jsx("div",{className:"card",children:b.jsx("ul",{className:"activity-list",children:E.events.slice(0,10).map((re,le)=>b.jsxs("li",{className:"activity-item",children:[b.jsxs("div",{className:"activity-item-left",children:[b.jsx("span",{className:`activity-dot ${re.event_type}`}),b.jsxs("div",{children:[b.jsx("p",{className:"activity-user-name",children:re.user_name}),b.jsx("p",{className:"activity-user-email",children:re.user_email})]})]}),b.jsxs("div",{className:"activity-item-right",children:[b.jsx("p",{className:"activity-type",children:re.event_type}),b.jsx("p",{className:"activity-time",children:new Date(re.timestamp).toLocaleString()})]})]},le))})})]})]})},Rge=({filters:e,onFilterChange:t,onClear:n})=>{const o=[{value:"",label:"All Types"},{value:"wine_company_owner",label:"Wine Company Owner"},{value:"wine_company_employee",label:"Wine Company Employee"},{value:"consultant",label:"Consultant"},{value:"wine_enthusiast",label:"Wine Enthusiast"},{value:"researcher",label:"Researcher"}],u=[{value:"",label:"All Regions"},{value:"marlborough",label:"Marlborough"},{value:"hawkes_bay",label:"Hawke's Bay"},{value:"central_otago",label:"Central Otago"},{value:"waipara",label:"Waipara"},{value:"martinborough",label:"Martinborough"},{value:"nelson",label:"Nelson"}];return b.jsxs("div",{className:"filters-panel",children:[b.jsxs("div",{className:"filters-header",children:[b.jsxs("h3",{children:[b.jsx(h7,{size:16}),"Filters"]}),b.jsx("button",{onClick:n,className:"filters-clear",children:"Clear all"})]}),b.jsxs("div",{className:"filters-grid",children:[b.jsxs("div",{className:"filter-group",children:[b.jsx("label",{children:"User Type"}),b.jsx("select",{value:e.user_type||"",onChange:d=>t("user_type",d.target.value||null),children:o.map(d=>b.jsx("option",{value:d.value,children:d.label},d.value))})]}),b.jsxs("div",{className:"filter-group",children:[b.jsx("label",{children:"Region"}),b.jsx("select",{value:e.region_of_interest||"",onChange:d=>t("region_of_interest",d.target.value||null),children:u.map(d=>b.jsx("option",{value:d.value,children:d.label},d.value))})]}),b.jsxs("div",{className:"filter-group",children:[b.jsx("label",{children:"Verified"}),b.jsxs("select",{value:e.is_verified??"",onChange:d=>t("is_verified",d.target.value===""?null:d.target.value==="true"),children:[b.jsx("option",{value:"",children:"All"}),b.jsx("option",{value:"true",children:"Verified"}),b.jsx("option",{value:"false",children:"Unverified"})]})]}),b.jsxs("div",{className:"filter-group",children:[b.jsx("label",{children:"Status"}),b.jsxs("select",{value:e.is_active??"",onChange:d=>t("is_active",d.target.value===""?null:d.target.value==="true"),children:[b.jsx("option",{value:"",children:"All"}),b.jsx("option",{value:"true",children:"Active"}),b.jsx("option",{value:"false",children:"Inactive"})]})]})]})]})},Oge=({users:e,sortBy:t,sortOrder:n,onSort:o})=>{const u=g=>g?new Date(g).toLocaleDateString("en-NZ",{day:"numeric",month:"short",year:"numeric"}):"-",d=g=>g?g.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()):"-";return b.jsx("div",{className:"card",children:b.jsx("div",{className:"table-container",children:b.jsxs("table",{className:"admin-table",children:[b.jsx("thead",{children:b.jsxs("tr",{children:[b.jsxs("th",{className:"sortable",onClick:()=>o("email"),children:["User ",t==="email"&&(n==="asc"?"":"")]}),b.jsx("th",{children:"Type"}),b.jsx("th",{children:"Region"}),b.jsx("th",{children:"Status"}),b.jsxs("th",{className:"sortable",onClick:()=>o("login_count"),children:["Logins ",t==="login_count"&&(n==="asc"?"":"")]}),b.jsxs("th",{className:"sortable",onClick:()=>o("last_active"),children:["Last Active ",t==="last_active"&&(n==="asc"?"":"")]}),b.jsxs("th",{className:"sortable",onClick:()=>o("created_at"),children:["Joined ",t==="created_at"&&(n==="asc"?"":"")]}),b.jsx("th",{})]})}),b.jsx("tbody",{children:e.map(g=>b.jsxs("tr",{children:[b.jsx("td",{children:b.jsxs("div",{children:[b.jsx("p",{className:"font-medium",children:g.full_name}),b.jsxs("p",{className:"text-xs text-muted flex items-center gap-1",children:[b.jsx(cw,{size:12}),g.email]}),g.company_name&&b.jsxs("p",{className:"text-xs text-muted flex items-center gap-1",children:[b.jsx(lF,{size:12}),g.company_name]})]})}),b.jsx("td",{children:d(g.user_type)}),b.jsx("td",{children:g.region_of_interest?b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx(aa,{size:12}),d(g.region_of_interest)]}):"-"}),b.jsx("td",{children:b.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[b.jsx("span",{className:`badge ${g.is_verified?"badge-green":"badge-yellow"}`,children:g.is_verified?b.jsxs(b.Fragment,{children:[b.jsx(s_,{size:12})," Verified"]}):b.jsxs(b.Fragment,{children:[b.jsx(hl,{size:12})," Unverified"]})}),!g.is_active&&b.jsx("span",{className:"badge badge-red",children:"Inactive"})]})}),b.jsx("td",{children:g.login_count||0}),b.jsx("td",{children:u(g.last_active)}),b.jsx("td",{children:u(g.created_at)}),b.jsx("td",{children:b.jsx(La,{to:`/admin/users/${g.id}`,className:"table-link",children:b.jsx(Fb,{size:16})})})]},g.id))})]})})})},Dge=({page:e,totalPages:t,total:n,pageSize:o,onPageChange:u})=>b.jsxs("div",{className:"pagination",children:[b.jsxs("p",{className:"pagination-info",children:["Showing ",(e-1)*o+1," - ",Math.min(e*o,n)," of ",n," users"]}),b.jsxs("div",{className:"pagination-controls",children:[b.jsx("button",{onClick:()=>u(e-1),disabled:e<=1,className:"pagination-btn",children:b.jsx(cC,{size:16})}),b.jsxs("span",{className:"pagination-text",children:["Page ",e," of ",t]}),b.jsx("button",{onClick:()=>u(e+1),disabled:e>=t,className:"pagination-btn",children:b.jsx(Fd,{size:16})})]})]}),Lge=()=>{const[e,t]=iF(),[n,o]=te.useState(!0),[u,d]=te.useState(null),[g,i]=te.useState([]),[E,P]=te.useState(0),[I,D]=te.useState(1),[F,$]=te.useState(!1),Z=te.useMemo(()=>({search:e.get("search")||"",user_type:e.get("user_type")||null,region_of_interest:e.get("region")||null,is_verified:e.get("verified")==="true"?!0:e.get("verified")==="false"?!1:null,is_active:e.get("active")==="true"?!0:e.get("active")==="false"?!1:null,page:parseInt(e.get("page")||"1"),page_size:parseInt(e.get("size")||"25"),sort_by:e.get("sort")||"created_at",sort_order:e.get("order")||"desc"}),[e]),q=async()=>{o(!0),d(null);try{const Le={...Z};Object.keys(Le).forEach(Ge=>{(Le[Ge]===null||Le[Ge]==="")&&delete Le[Ge]});const Ze=await Eu.users.listUsers(Le);i(Ze.users),P(Ze.total),D(Ze.total_pages)}catch(Le){console.error("Failed to fetch users:",Le),d("Failed to load users. Please try again.")}finally{o(!1)}};te.useEffect(()=>{q()},[e]);const X=Le=>{const Ze=new URLSearchParams(e);Object.entries(Le).forEach(([Ge,gt])=>{gt===null||gt===""||gt===void 0?Ze.delete(Ge):Ze.set(Ge,String(gt))}),t(Ze)},re=(Le,Ze)=>{X({[Le==="region_of_interest"?"region":Le==="is_verified"?"verified":Le==="is_active"?"active":Le]:Ze,page:1})},le=()=>t(new URLSearchParams),ue=Le=>{Le.preventDefault();const Ze=new FormData(Le.target);X({search:Ze.get("search"),page:1})},ye=Le=>{const Ze=Z.sort_by===Le&&Z.sort_order==="desc"?"asc":"desc";X({sort:Le,order:Ze,page:1})},ge=Le=>X({page:Le}),we=async()=>{$(!0);try{const Le={...Z};delete Le.page,delete Le.page_size,await Eu.users.exportUsers(Le)}catch(Le){console.error("Export failed:",Le),alert("Failed to export users.")}finally{$(!1)}};return b.jsxs(Dh,{title:"User Management",subtitle:`${E} total users`,children:[b.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5rem",marginBottom:"1rem"},children:[b.jsxs("button",{onClick:q,className:"btn btn-secondary",children:[b.jsx(sc,{size:16,className:n?"loading-spinner":""}),"Refresh"]}),b.jsxs("button",{onClick:we,disabled:F,className:"btn btn-primary",children:[b.jsx(s7,{size:16}),F?"Exporting...":"Export CSV"]})]}),b.jsx("form",{onSubmit:ue,style:{marginBottom:"1rem"},children:b.jsxs("div",{className:"search-input-wrapper",children:[b.jsx(V7,{size:20}),b.jsx("input",{type:"text",name:"search",defaultValue:Z.search,placeholder:"Search by email, name, or company...",className:"form-input",style:{paddingLeft:"2.5rem"}})]})}),b.jsx(Rge,{filters:Z,onFilterChange:re,onClear:le}),u&&b.jsx("div",{className:"error-container",children:b.jsx("p",{className:"error-text",children:u})}),n?b.jsx("div",{className:"loading-container",children:b.jsx("div",{className:"loading-spinner",children:b.jsx(sc,{size:32})})}):g.length===0?b.jsx("div",{className:"card",children:b.jsxs("div",{className:"empty-state",children:[b.jsx("p",{className:"empty-state-text",children:"No users found matching your filters."}),b.jsx("button",{onClick:le,className:"section-link mt-2",children:"Clear filters"})]})}):b.jsxs(b.Fragment,{children:[b.jsx(Oge,{users:g,sortBy:Z.sort_by,sortOrder:Z.sort_order,onSort:ye}),b.jsx(Dge,{page:Z.page,totalPages:I,total:E,pageSize:Z.page_size,onPageChange:ge})]})]})},bu=({icon:e,label:t,value:n})=>b.jsxs("div",{className:"info-row",children:[b.jsx("div",{className:"info-row-icon",children:b.jsx(e,{size:20})}),b.jsxs("div",{className:"info-row-content",children:[b.jsx("p",{className:"info-row-label",children:t}),b.jsx("p",{className:"info-row-value",children:n||"-"})]})]}),jge=({active:e,verified:t})=>b.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[b.jsx("span",{className:`badge ${t?"badge-green":"badge-yellow"}`,children:t?b.jsxs(b.Fragment,{children:[b.jsx(s_,{size:12})," Verified"]}):b.jsxs(b.Fragment,{children:[b.jsx(hl,{size:12})," Unverified"]})}),b.jsx("span",{className:`badge ${e?"badge-blue":"badge-red"}`,children:e?"Active":"Inactive"})]}),zge=({newsletter:e,marketing:t,research:n})=>b.jsxs("div",{className:"opt-in-badges",children:[e&&b.jsx("span",{className:"badge badge-purple",children:"Newsletter"}),t&&b.jsx("span",{className:"badge badge-indigo",children:"Marketing"}),n&&b.jsx("span",{className:"badge badge-cyan",children:"Research"}),!e&&!t&&!n&&b.jsx("span",{className:"text-muted",children:"No opt-ins"})]}),Nge=()=>{const{id:e}=Y3(),[t,n]=te.useState(!0),[o,u]=te.useState(!1),[d,g]=te.useState(null),[i,E]=te.useState(null),[P,I]=te.useState(!0),[D,F]=te.useState(""),[$,Z]=te.useState(!1),q=async()=>{n(!0),g(null);try{const ue=await Eu.users.getUser(e);E(ue),I(ue.is_active),F(ue.notes||""),Z(!1)}catch{g("Failed to load user details.")}finally{n(!1)}};te.useEffect(()=>{q()},[e]),te.useEffect(()=>{i&&Z(P!==i.is_active||D!==(i.notes||""))},[P,D,i]);const X=async()=>{u(!0),g(null);try{const ue=await Eu.users.updateUser(e,{is_active:P,notes:D||null});E(ue),Z(!1)}catch{g("Failed to save changes.")}finally{u(!1)}},re=ue=>ue?new Date(ue).toLocaleString("en-NZ",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",le=ue=>ue?ue.replace(/_/g," ").replace(/\b\w/g,ye=>ye.toUpperCase()):"-";return t?b.jsx(Dh,{backLink:"/admin/users",backText:"Back to users",children:b.jsx("div",{className:"loading-container",children:b.jsx("div",{className:"loading-spinner",children:b.jsx(sc,{size:32})})})}):d&&!i?b.jsx(Dh,{backLink:"/admin/users",backText:"Back to users",children:b.jsx("div",{className:"error-container",children:b.jsx("p",{className:"error-text",children:d})})}):b.jsxs(Dh,{backLink:"/admin/users",backText:"Back to users",children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem"},children:[b.jsxs("div",{children:[b.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:700,margin:0},children:i.full_name}),b.jsx("p",{className:"text-muted",children:i.email})]}),b.jsx(jge,{active:i.is_active,verified:i.is_verified})]}),d&&b.jsx("div",{className:"error-container mb-4",children:b.jsx("p",{className:"error-text",children:d})}),b.jsxs("div",{className:"two-column-grid",children:[b.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Profile"})}),b.jsxs("div",{className:"card-body",children:[b.jsx(bu,{icon:Bb,label:"Full Name",value:i.full_name}),b.jsx(bu,{icon:cw,label:"Email",value:i.email}),b.jsx(bu,{icon:dO,label:"User Type",value:le(i.user_type)}),b.jsx(bu,{icon:lF,label:"Company",value:i.company_name}),b.jsx(bu,{icon:dO,label:"Job Title",value:i.job_title}),b.jsx(bu,{icon:aa,label:"Region",value:le(i.region_of_interest)}),b.jsx(bu,{icon:Fg,label:"Segment",value:le(i.marketing_segment)})]})]}),b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Activity"})}),b.jsxs("div",{className:"card-body",children:[b.jsx(bu,{icon:hp,label:"Joined",value:re(i.created_at)}),b.jsx(bu,{icon:s_,label:"Verified",value:re(i.verified_at)}),b.jsx(bu,{icon:uy,label:"Logins",value:i.login_count||0}),b.jsx(bu,{icon:Wg,label:"Last Login",value:re(i.last_login)}),b.jsx(bu,{icon:Wg,label:"Last Active",value:re(i.last_active)})]})]}),b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Communication Preferences"})}),b.jsx("div",{className:"card-body",children:b.jsx(zge,{newsletter:i.newsletter_opt_in,marketing:i.marketing_opt_in,research:i.research_opt_in})})]})]}),b.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Admin Controls"})}),b.jsxs("div",{className:"card-body",children:[b.jsxs("div",{className:"form-group",children:[b.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer"},children:[b.jsx("span",{children:"Account Active"}),b.jsx("button",{type:"button",onClick:()=>I(!P),className:`toggle-switch ${P?"active":""}`,children:b.jsx("span",{className:"toggle-switch-handle"})})]}),b.jsx("p",{className:"text-xs text-muted mt-1",children:"Inactive users cannot log in"})]}),b.jsxs("div",{className:"form-group",children:[b.jsxs("label",{className:"form-label",children:[b.jsx(P7,{size:14})," Admin Notes"]}),b.jsx("textarea",{value:D,onChange:ue=>F(ue.target.value),rows:4,placeholder:"Add notes...",className:"form-textarea"})]}),b.jsxs("button",{onClick:X,disabled:!$||o,className:`btn ${$?"btn-primary":"btn-secondary"}`,style:{width:"100%"},children:[o?b.jsx(sc,{size:16}):b.jsx(B7,{size:16}),o?"Saving...":"Save Changes"]}),$&&b.jsx("p",{className:"text-xs text-yellow mt-2",style:{textAlign:"center"},children:"Unsaved changes"})]})]}),b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Quick Stats"})}),b.jsxs("div",{className:"card-body",children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[b.jsx("span",{className:"text-muted",children:"User ID"}),b.jsxs("span",{className:"font-mono",children:["#",i.id]})]}),b.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[b.jsx("span",{className:"text-muted",children:"Days Since Signup"}),b.jsx("span",{children:Math.floor((new Date-new Date(i.created_at))/864e5)})]})]})]})]})]})]})},Fge=({status:e,size:t="md"})=>{const n={healthy:{icon:s_,label:"Healthy"},stale:{icon:o_,label:"Stale"},offline:{icon:lw,label:"Offline"}},{icon:o,label:u}=n[e]||n.offline;return b.jsxs("span",{className:`status-badge status-${e}`,children:[b.jsx(o,{size:t==="lg"?16:12}),u]})},Bge=({station:e})=>{const{health:t}=e,n=u=>u==null?"Never":u<1?`${Math.round(u*60)}m ago`:u<24?`${Math.round(u)}h ago`:`${Math.round(u/24)}d ago`,o=u=>u>=95?"green":u>=80?"yellow":"red";return b.jsxs(La,{to:`/admin/weather/${e.station_id}`,className:"station-card",children:[b.jsxs("div",{className:"station-card-header",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"station-card-title",children:e.station_name||e.station_code}),b.jsx("p",{className:"station-card-subtitle",children:e.station_code})]}),b.jsx(Fge,{status:t.status})]}),b.jsxs("div",{className:"station-card-stats",children:[b.jsxs("div",{className:"station-card-stat",children:[b.jsxs("span",{className:"station-card-stat-label",children:[b.jsx(hy,{size:16})," Source"]}),b.jsx("span",{className:"station-card-stat-value",children:e.data_source})]}),e.region&&b.jsxs("div",{className:"station-card-stat",children:[b.jsxs("span",{className:"station-card-stat-label",children:[b.jsx(aa,{size:16})," Region"]}),b.jsx("span",{className:"station-card-stat-value",children:e.region})]}),b.jsxs("div",{className:"station-card-stat",children:[b.jsxs("span",{className:"station-card-stat-label",children:[b.jsx(Wg,{size:16})," Last Data"]}),b.jsx("span",{className:"station-card-stat-value",children:n(t.hours_since_last_data)})]}),b.jsxs("div",{className:"station-card-stat",children:[b.jsxs("span",{className:"station-card-stat-label",children:[b.jsx(uy,{size:16})," 24h Complete"]}),b.jsxs("span",{className:`station-card-stat-value ${o(t.completeness_24h_pct)}`,children:[t.completeness_24h_pct,"%"]})]})]}),e.variables_available&&e.variables_available.length>0&&b.jsxs("div",{className:"station-card-variables",children:[e.variables_available.slice(0,4).map(u=>b.jsx("span",{className:"station-card-variable",children:u},u)),e.variables_available.length>4&&b.jsxs("span",{className:"station-card-variable",children:["+",e.variables_available.length-4]})]}),b.jsxs("div",{className:"station-card-footer",children:["View details ",b.jsx(Fd,{size:16})]})]})},Uge=({logs:e,summary:t})=>!e||e.length===0?b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h3",{children:"Recent Ingestion Runs"})}),b.jsx("div",{className:"card-body",children:b.jsx("p",{className:"text-muted",children:"No ingestion logs found."})})]}):b.jsxs("div",{className:"card",children:[b.jsxs("div",{className:"card-header",children:[b.jsx("h3",{children:"Recent Ingestion Runs"}),t&&b.jsxs("p",{children:[t.overall_success_rate_pct,"% success rate over ",t.period_days," days"]})]}),b.jsx("div",{style:{maxHeight:"24rem",overflowY:"auto"},children:e.slice(0,20).map(n=>b.jsxs("div",{className:"ingestion-log-item",children:[b.jsxs("div",{className:"ingestion-log-header",children:[b.jsxs("div",{className:"ingestion-log-source",children:[b.jsx("span",{className:`ingestion-log-dot ${n.status==="success"?"success":n.status==="failed"?"failed":"pending"}`}),b.jsx("span",{className:"ingestion-log-name",children:n.data_source}),n.station_code&&b.jsxs("span",{className:"ingestion-log-station",children:["(",n.station_code,")"]})]}),b.jsx("span",{className:`badge ${n.status==="success"?"badge-green":n.status==="failed"?"badge-red":"badge-gray"}`,children:n.status})]}),b.jsxs("div",{className:"ingestion-log-meta",children:[b.jsx("span",{children:new Date(n.start_time).toLocaleString()}),n.duration_seconds&&b.jsxs("span",{children:[Math.round(n.duration_seconds),"s"]}),n.records_inserted!==null&&b.jsxs("span",{children:[n.records_inserted," records"]})]}),n.error_msg&&b.jsx("p",{className:"ingestion-log-error",children:n.error_msg})]},n.log_id))})]}),Vge=()=>{var lt;const[e,t]=te.useState(!0),[n,o]=te.useState(null),[u,d]=te.useState([]),[g,i]=te.useState(null),[E,P]=te.useState([]),[I,D]=te.useState(null),[F,$]=te.useState(""),[Z,q]=te.useState(""),[X,re]=te.useState(""),[le,ue]=te.useState(""),ye=async()=>{t(!0),o(null);try{const[qe,en,Jt]=await Promise.all([Eu.weather.listStations({status:F||void 0,data_source:Z||void 0,region:X||void 0}),Eu.weather.getIngestionLogs({days:7,page_size:50}),Eu.weather.getIngestionSummary(7)]);d(qe.stations),i(qe.summary),P(en.logs),D(Jt)}catch(qe){console.error("Failed to fetch weather data:",qe),o("Failed to load weather infrastructure data.")}finally{t(!1)}};te.useEffect(()=>{ye()},[F,Z,X]);const ge=g!=null&&g.by_source?Object.keys(g.by_source):[],we=g!=null&&g.by_region?Object.keys(g.by_region).filter(qe=>qe!=="unspecified"):[],Le=te.useMemo(()=>{const qe=new Set;return u.forEach(en=>{(en.variables_available||[]).forEach(Jt=>qe.add(Jt))}),Array.from(qe).sort()},[u]),Ze=te.useMemo(()=>le?u.filter(qe=>(qe.variables_available||[]).includes(le)):u,[u,le]),Ge=()=>{$(""),q(""),re(""),ue("")},gt=F||Z||X||le;return b.jsxs(Dh,{title:"Weather Infrastructure",subtitle:`${(g==null?void 0:g.active_stations)||0} active stations across ${ge.length} sources`,children:[b.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"1rem"},children:b.jsxs("button",{onClick:ye,className:"btn btn-secondary",children:[b.jsx(sc,{size:16,className:e?"loading-spinner":""}),"Refresh"]})}),g&&b.jsxs("div",{className:"stats-grid mb-6",children:[b.jsx("div",{className:"stats-card green",children:b.jsxs("div",{className:"stats-card-content",children:[b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-title",children:"Healthy"}),b.jsx("p",{className:"stats-card-value",children:g.healthy_stations})]}),b.jsx("div",{className:"stats-card-icon",children:b.jsx(s_,{size:24})})]})}),b.jsx("div",{className:"stats-card yellow",children:b.jsxs("div",{className:"stats-card-content",children:[b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-title",children:"Stale"}),b.jsx("p",{className:"stats-card-value",children:g.stale_stations})]}),b.jsx("div",{className:"stats-card-icon",children:b.jsx(o_,{size:24})})]})}),b.jsx("div",{className:"stats-card red",children:b.jsxs("div",{className:"stats-card-content",children:[b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-title",children:"Offline"}),b.jsx("p",{className:"stats-card-value",children:g.offline_stations})]}),b.jsx("div",{className:"stats-card-icon",children:b.jsx(lw,{size:24})})]})}),b.jsx("div",{className:"stats-card blue",children:b.jsxs("div",{className:"stats-card-content",children:[b.jsxs("div",{children:[b.jsx("p",{className:"stats-card-title",children:"Records (7d)"}),b.jsx("p",{className:"stats-card-value",children:(lt=g.records_last_7d)==null?void 0:lt.toLocaleString()})]}),b.jsx("div",{className:"stats-card-icon",children:b.jsx(hy,{size:24})})]})})]}),b.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",marginBottom:"1.5rem",alignItems:"center"},children:[b.jsxs("select",{value:F,onChange:qe=>$(qe.target.value),className:"form-select",style:{width:"auto"},children:[b.jsx("option",{value:"",children:"All Status"}),b.jsx("option",{value:"healthy",children:"Healthy"}),b.jsx("option",{value:"stale",children:"Stale"}),b.jsx("option",{value:"offline",children:"Offline"})]}),b.jsxs("select",{value:Z,onChange:qe=>q(qe.target.value),className:"form-select",style:{width:"auto"},children:[b.jsx("option",{value:"",children:"All Sources"}),ge.map(qe=>b.jsx("option",{value:qe,children:qe},qe))]}),b.jsxs("select",{value:X,onChange:qe=>re(qe.target.value),className:"form-select",style:{width:"auto"},children:[b.jsx("option",{value:"",children:"All Regions"}),we.map(qe=>b.jsx("option",{value:qe,children:qe},qe))]}),b.jsxs("select",{value:le,onChange:qe=>ue(qe.target.value),className:"form-select",style:{width:"auto"},children:[b.jsx("option",{value:"",children:"All Variables"}),Le.map(qe=>b.jsx("option",{value:qe,children:qe},qe))]}),gt&&b.jsx("button",{onClick:Ge,className:"btn btn-secondary",style:{marginLeft:"auto"},children:"Clear Filters"})]}),n&&b.jsx("div",{className:"error-container",children:b.jsx("p",{className:"error-text",children:n})}),e?b.jsx("div",{className:"loading-container",children:b.jsx("div",{className:"loading-spinner",children:b.jsx(sc,{size:32})})}):b.jsxs("div",{className:"two-column-grid",children:[b.jsxs("div",{children:[b.jsxs("h2",{className:"section-title mb-4",children:["Weather Stations (",Ze.length,")"]}),Ze.length===0?b.jsx("div",{className:"card",children:b.jsxs("div",{className:"empty-state",children:[b.jsx("div",{className:"empty-state-icon",children:b.jsx(qg,{size:48})}),b.jsx("p",{className:"empty-state-text",children:"No stations found matching filters."})]})}):b.jsx("div",{className:"stations-grid",children:Ze.map(qe=>b.jsx(Bge,{station:qe},qe.station_id))})]}),b.jsxs("div",{children:[b.jsx("h2",{className:"section-title mb-4",children:"Ingestion Activity"}),b.jsx(Uge,{logs:E,summary:I}),(I==null?void 0:I.by_source)&&I.by_source.length>0&&b.jsxs("div",{className:"card mt-4",children:[b.jsx("div",{className:"card-header",children:b.jsx("h3",{children:"Success by Source"})}),b.jsx("div",{className:"card-body",children:I.by_source.map(qe=>b.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[b.jsx("span",{className:"text-sm",children:qe.data_source}),b.jsxs("div",{className:"progress-with-label",children:[b.jsx("div",{className:"progress-bar",children:b.jsx("div",{className:`progress-bar-fill ${qe.success_rate_pct>=95?"green":qe.success_rate_pct>=80?"yellow":"red"}`,style:{width:`${qe.success_rate_pct}%`}})}),b.jsxs("span",{className:`progress-label ${qe.success_rate_pct>=95?"green":qe.success_rate_pct>=80?"yellow":"red"}`,children:[qe.success_rate_pct,"%"]})]})]},qe.data_source))})]})]})]})]})},$ge=({status:e,size:t="md"})=>{const n={healthy:{icon:s_,label:"Healthy"},stale:{icon:o_,label:"Stale"},offline:{icon:lw,label:"Offline"}},{icon:o,label:u}=n[e]||n.offline;return b.jsxs("span",{className:`status-badge status-${e}`,children:[b.jsx(o,{size:t==="lg"?16:12})," ",u]})},jb=({label:e,value:t,unit:n,icon:o,color:u="blue"})=>b.jsxs("div",{className:`metric-card ${u}`,children:[b.jsxs("div",{className:"metric-card-label",children:[b.jsx(o,{size:16}),e]}),b.jsxs("p",{className:"metric-card-value",children:[t,n&&b.jsx("span",{className:"metric-card-unit",children:n})]})]}),Hge=({coverage:e})=>{if(!(e!=null&&e.length))return b.jsx("p",{className:"text-muted",children:"No coverage data."});const t=n=>n>=95?"green":n>=80?"yellow":"red";return b.jsx("div",{className:"table-container",children:b.jsxs("table",{className:"admin-table",children:[b.jsx("thead",{children:b.jsxs("tr",{children:[b.jsx("th",{children:"Variable"}),b.jsx("th",{children:"Records (7d)"}),b.jsx("th",{children:"Expected"}),b.jsx("th",{children:"Coverage"})]})}),b.jsx("tbody",{children:e.map(n=>b.jsxs("tr",{children:[b.jsx("td",{className:"font-medium",children:n.variable}),b.jsx("td",{children:n.record_count.toLocaleString()}),b.jsx("td",{className:"text-muted",children:n.expected_count.toLocaleString()}),b.jsx("td",{children:b.jsxs("div",{className:"progress-with-label",children:[b.jsx("div",{className:"progress-bar",children:b.jsx("div",{className:`progress-bar-fill ${t(n.coverage_pct)}`,style:{width:`${Math.min(100,n.coverage_pct)}%`}})}),b.jsxs("span",{className:`progress-label ${t(n.coverage_pct)}`,children:[n.coverage_pct,"%"]})]})})]},n.variable))})]})})},Gge=({data:e})=>{const[t,n]=te.useState(!1);if(!(e!=null&&e.length))return b.jsx("p",{className:"text-muted",children:"No recent data."});const o=t?e:e.slice(0,20),u=d=>{const g=d.toLowerCase();return g.includes("temp")?fy:g.includes("rain")||g.includes("humid")?Zg:g.includes("wind")?mq:g.includes("solar")?Xg:uy};return b.jsxs("div",{children:[b.jsx("div",{className:"scrollable-table",children:b.jsxs("table",{className:"admin-table",children:[b.jsx("thead",{children:b.jsxs("tr",{children:[b.jsx("th",{children:"Time"}),b.jsx("th",{children:"Variable"}),b.jsx("th",{children:"Value"}),b.jsx("th",{children:"Quality"})]})}),b.jsx("tbody",{children:o.map((d,g)=>{const i=u(d.variable);return b.jsxs("tr",{children:[b.jsx("td",{className:"text-muted",children:new Date(d.timestamp).toLocaleString("en-NZ",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),b.jsxs("td",{children:[b.jsx(i,{size:12})," ",d.variable]}),b.jsxs("td",{className:"font-medium",children:[d.value!==null?d.value.toFixed(2):"-",d.unit&&b.jsxs("span",{className:"text-muted",children:[" ",d.unit]})]}),b.jsx("td",{children:d.quality?b.jsx("span",{className:`badge ${d.quality==="good"?"badge-green":"badge-yellow"}`,children:d.quality}):"-"})]},g)})})]})}),e.length>20&&b.jsxs("button",{onClick:()=>n(!t),className:`show-more-btn ${t?"expanded":""}`,children:[t?"Show less":`Show all ${e.length} records`,t?b.jsx(uF,{size:16}):b.jsx(Iy,{size:16})]})]})},Wge=()=>{var D;const{id:e}=Y3(),[t,n]=te.useState(!0),[o,u]=te.useState(null),[d,g]=te.useState(null),i=async()=>{n(!0),u(null);try{const F=await Eu.weather.getStation(e);g(F)}catch{u("Failed to load station details.")}finally{n(!1)}};te.useEffect(()=>{i()},[e]);const E=F=>F==null?"Never":F<1?`${Math.round(F*60)} min ago`:F<24?`${Math.round(F)} hrs ago`:F<48?"Yesterday":`${Math.round(F/24)} days ago`,P=F=>F>=95?"green":F>=80?"yellow":"red";if(t)return b.jsx(Dh,{backLink:"/admin/weather",backText:"Back to weather",children:b.jsx("div",{className:"loading-container",children:b.jsx("div",{className:"loading-spinner",children:b.jsx(sc,{size:32})})})});if(o&&!d)return b.jsx(Dh,{backLink:"/admin/weather",backText:"Back to weather",children:b.jsx("div",{className:"error-container",children:b.jsx("p",{className:"error-text",children:o})})});const{health:I}=d;return b.jsxs(Dh,{backLink:"/admin/weather",backText:"Back to weather",children:[b.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1.5rem"},children:[b.jsxs("div",{children:[b.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:700,margin:0},children:d.station_name||d.station_code}),b.jsxs("p",{className:"text-muted",children:[b.jsx("span",{className:"font-mono",children:d.station_code}),"  ",d.data_source,d.region&&b.jsxs(b.Fragment,{children:["  ",b.jsx(aa,{size:14})," ",d.region]})]})]}),b.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[b.jsx($ge,{status:I.status,size:"lg"}),b.jsx("button",{onClick:i,className:"btn btn-icon btn-secondary",children:b.jsx(sc,{size:20})})]})]}),b.jsxs("div",{className:"stats-grid mb-6",children:[b.jsx(jb,{label:"Last Data",value:E(I.hours_since_last_data),icon:Wg,color:I.hours_since_last_data<2?"green":I.hours_since_last_data<24?"yellow":"red"}),b.jsx(jb,{label:"24h Records",value:I.records_last_24h.toLocaleString(),unit:`/ ${I.expected_records_24h}`,icon:hy,color:P(I.completeness_24h_pct)}),b.jsx(jb,{label:"24h Complete",value:I.completeness_24h_pct,unit:"%",icon:uy,color:P(I.completeness_24h_pct)}),b.jsx(jb,{label:"7d Complete",value:I.completeness_7d_pct,unit:"%",icon:uy,color:P(I.completeness_7d_pct)})]}),b.jsxs("div",{className:"two-column-grid",children:[b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Station Info"})}),b.jsxs("div",{className:"card-body",children:[b.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Station ID"}),b.jsx("p",{className:"font-mono",children:d.station_id})]}),d.source_id&&b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Source ID"}),b.jsx("p",{className:"font-mono",children:d.source_id})]}),b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Data Source"}),b.jsx("p",{children:d.data_source})]}),d.latitude&&d.longitude&&b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Location"}),b.jsxs("p",{children:[parseFloat(d.latitude).toFixed(4),", ",parseFloat(d.longitude).toFixed(4)]})]}),d.elevation&&b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Elevation"}),b.jsxs("p",{children:[d.elevation,"m"]})]}),b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Status"}),b.jsx("p",{className:d.is_active?"text-green":"text-red",children:d.is_active?"Active":"Inactive"})]}),b.jsxs("div",{children:[b.jsx("p",{className:"text-muted text-sm",children:"Created"}),b.jsx("p",{children:new Date(d.created_at).toLocaleDateString("en-NZ")})]})]}),((D=d.variables_available)==null?void 0:D.length)>0&&b.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid #e5e7eb"},children:[b.jsx("p",{className:"text-muted text-sm mb-2",children:"Available Variables"}),b.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:d.variables_available.map(F=>b.jsx("span",{className:"badge badge-gray",children:F},F))})]})]})]}),b.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Variable Coverage (7 Days)"})}),b.jsx("div",{className:"card-body",children:b.jsx(Hge,{coverage:d.variable_coverage})})]}),b.jsxs("div",{className:"card",children:[b.jsx("div",{className:"card-header",children:b.jsx("h2",{children:"Recent Data"})}),b.jsx("div",{className:"card-body",children:b.jsx(Gge,{data:d.recent_data})})]})]})]})]})},qge="auxein.co.nz",Zge=e=>e?e.toLowerCase().endsWith(`@${qge}`):!1,qv=({children:e})=>{const{user:t,isAuthenticated:n,loading:o}=Ry(),u=Bh();return o?b.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:b.jsxs("div",{className:"text-center",children:[b.jsx(sc,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto"}),b.jsx("p",{className:"mt-2 text-gray-500",children:"Checking authentication..."})]})}):n?Zge(t==null?void 0:t.email)?e:b.jsx(jE,{to:"/",replace:!0}):b.jsx(jE,{to:"/login",state:{from:u.pathname},replace:!0})};function Xge(){return b.jsx(HF,{children:b.jsx(hW,{children:b.jsxs(UG,{children:[b.jsx(Kf,{path:"/",element:b.jsx(Age,{})}),b.jsx(Kf,{path:"/about",element:b.jsx(Cge,{})}),b.jsx(Kf,{path:"/admin",element:b.jsx(qv,{children:b.jsx(kge,{})})}),b.jsx(Kf,{path:"/admin/users",element:b.jsx(qv,{children:b.jsx(Lge,{})})}),b.jsx(Kf,{path:"/admin/users/:id",element:b.jsx(qv,{children:b.jsx(Nge,{})})}),b.jsx(Kf,{path:"/admin/weather",element:b.jsx(qv,{children:b.jsx(Vge,{})})}),b.jsx(Kf,{path:"/admin/weather/:id",element:b.jsx(qv,{children:b.jsx(Wge,{})})}),b.jsx(Kf,{path:"*",element:b.jsx(jE,{to:"/",replace:!0})})]})})})}KH.createRoot(document.getElementById("root")).render(b.jsx(sw.StrictMode,{children:b.jsx(HF,{children:b.jsx(Xge,{})})}));
